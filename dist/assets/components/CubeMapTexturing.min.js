/* X_ITE v8.2.0 */(()=>{"use strict";var e={355:e=>{e.exports=window[Symbol.for("X_ITE.X3D-8.2.0")].require("lib/jquery")}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Components");var t=r.n(e);const i=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Fields");var n=r.n(i);const o=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Base/X3DFieldDefinition");var s=r.n(o);const a=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Base/FieldDefinitionArray");var u=r.n(a);const h=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Components/Texturing/X3DSingleTextureNode");var d=r.n(h);const l=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Base/X3DConstants");var c=r.n(l);function g(e){d().call(this,e),this.addType(c().X3DEnvironmentTextureNode);const t=this.getBrowser().getContext();this.target=t.TEXTURE_CUBE_MAP,this.targets=[t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y]}g.prototype=Object.assign(Object.create(d().prototype),{constructor:g,getTarget:function(){return this.target},getTextureType:function(){return 4},getTextureTypeString:function(){return"CUBE"},getTargets:function(){return this.targets},clearTexture:function(){const e=new Uint8Array([255,255,255,255]);return function(){const t=this.getBrowser().getContext();t.bindTexture(this.getTarget(),this.getTexture());for(const r of this.getTargets())t.texImage2D(r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e)}}(),updateTextureParameters:function(){d().prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,128,128,!1,!1,!1)},setShaderUniforms:function(e,t,r,i=t.x3d_Texture[0]){const n=this.getBrowser().getTextureCubeUnit();e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_CUBE_MAP,this.getTexture()),e.uniform1i(i.textureCube,n)}});const p=g,x=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Base/X3DCast");var _=r.n(x);const T=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Utility/BitSet");var w=r.n(T);function f(e){p.call(this,e),this.addType(c().ComposedCubeMapTexture),this.addAlias("front",this._frontTexture),this.addAlias("back",this._backTexture),this.addAlias("left",this._leftTexture),this.addAlias("right",this._rightTexture),this.addAlias("bottom",this._bottomTexture),this.addAlias("top",this._topTexture),this.textures=[null,null,null,null,null,null],this.symbols=[Symbol(),Symbol(),Symbol(),Symbol(),Symbol(),Symbol()],this.loadStateBits=new(w())}f.prototype=Object.assign(Object.create(p.prototype),{constructor:f,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(u())([new(s())(c().inputOutput,"metadata",new(n().SFNode)),new(s())(c().inputOutput,"description",new(n().SFString)),new(s())(c().inputOutput,"frontTexture",new(n().SFNode)),new(s())(c().inputOutput,"backTexture",new(n().SFNode)),new(s())(c().inputOutput,"leftTexture",new(n().SFNode)),new(s())(c().inputOutput,"rightTexture",new(n().SFNode)),new(s())(c().inputOutput,"bottomTexture",new(n().SFNode)),new(s())(c().inputOutput,"topTexture",new(n().SFNode)),new(s())(c().initializeOnly,"textureProperties",new(n().SFNode))]),getTypeName:function(){return"ComposedCubeMapTexture"},getComponentName:function(){return"CubeMapTexturing"},getContainerField:function(){return"texture"},initialize:function(){p.prototype.initialize.call(this),this.clearTexture(),this._frontTexture.addInterest("set_texture__",this,0),this._backTexture.addInterest("set_texture__",this,1),this._leftTexture.addInterest("set_texture__",this,2),this._rightTexture.addInterest("set_texture__",this,3),this._topTexture.addInterest("set_texture__",this,5),this._bottomTexture.addInterest("set_texture__",this,4),this.set_texture__(this._frontTexture,0),this.set_texture__(this._backTexture,1),this.set_texture__(this._leftTexture,2),this.set_texture__(this._rightTexture,3),this.set_texture__(this._topTexture,4),this.set_texture__(this._bottomTexture,5)},set_texture__:function(e,t){let r=this.textures[t];r&&(r.removeInterest("set_loadState__",this),r._loadState.removeFieldCallback(this.symbols[t])),r=this.textures[t]=_()(c().X3DTexture2DNode,e),r&&(r.addInterest("set_loadState__",this,r,t),r._loadState.addFieldCallback(this.symbols[t],this.set_loadState__.bind(this,r,t))),this.set_loadState__(r,t)},set_loadState__:function(e,t){e?this.setLoadStateBit(t,e.checkLoadState(),e.getData()):this.setLoadStateBit(t,c().NOT_STARTED,null),this.updateTextures()},setLoadStateBit:function(e,t,r){this.loadStateBits.set(e,t===c().COMPLETE_STATE||r)},isComplete:function(){if(63!=+this.loadStateBits)return!1;const e=this.textures,t=e[0].getWidth();for(const r of e){if(r.getWidth()!==t)return!1;if(r.getHeight()!==t)return!1}return!0},updateTextures:function(){const e=this.getBrowser().getContext();if(e.bindTexture(this.getTarget(),this.getTexture()),this.isComplete()){const t=this.textures;for(let r=0;r<6;++r){const i=t[r],n=i.getWidth(),o=i.getHeight(),s=i.getData();e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!i.getFlipY()),s instanceof Uint8Array?e.texImage2D(this.getTargets()[r],0,e.RGBA,n,o,!1,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(this.getTargets()[r],0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s)}e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),this.updateTextureParameters()}else this.clearTexture();this.set_transparent__()},set_transparent__:function(){const e=!1;if(this.isComplete())for(const t of this.textures)if(t._transparent.getValue()){e=!0;break}this.setTransparent(e)}});const m=f,b=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Base/X3DBaseNode");var S=r.n(b);const E=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Rendering/X3DRenderObject");var y=r.n(E);const I=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Rendering/TraverseType");var M=r.n(I);function B(e){S().call(this,e),y().call(this,e),this.renderObject=null}B.prototype=Object.assign(Object.create(S().prototype),y().prototype,{constructor:B,initialize:function(){S().prototype.initialize.call(this),y().prototype.initialize.call(this)},isIndependent:function(){return!1},setRenderer:function(e){this.renderObject=e},getLayer:function(){return this.renderObject.getLayer()},getBackground:function(){return this.renderObject.getBackground()},getFog:function(){return this.renderObject.getFog()},getNavigationInfo:function(){return this.renderObject.getNavigationInfo()},getViewpoint:function(){return this.renderObject.getViewpoint()},getLightContainer:function(){return this.renderObject.getLights()[this.lightIndex++]},render:function(e,t,r){switch(e){case M().COLLISION:case M().SHADOW:y().prototype.render.call(this,e,t,r);break;case M().DISPLAY:this.lightIndex=0,y().prototype.render.call(this,e,t,r);for(const e of this.renderObject.getLights())e.getModelViewMatrix().pop()}}});for(const e of Reflect.ownKeys(B.prototype))Object.defineProperty(B.prototype,e,{enumerable:!1});const X=B,C=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Rendering/TextureBuffer");var N=r.n(C);const O=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Math/Geometry/Camera");var D=r.n(O);const A=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Math/Geometry/ViewVolume");var R=r.n(A);const v=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Math/Numbers/Rotation4");var U=r.n(v);const F=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Math/Numbers/Vector3");var P=r.n(F);const V=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Math/Numbers/Vector4");var L=r.n(V);const G=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Math/Numbers/Matrix4");var j=r.n(G);const z=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Math/Algorithm");var q=r.n(z);function k(e){p.call(this,e),this.addType(c().GeneratedCubeMapTexture),this.dependentRenderer=new X(e),this.projectionMatrix=new(j()),this.modelMatrix=new(j()),this.viewVolume=new(R())}k.prototype=Object.assign(Object.create(p.prototype),{constructor:k,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(u())([new(s())(c().inputOutput,"metadata",new(n().SFNode)),new(s())(c().inputOutput,"description",new(n().SFString)),new(s())(c().inputOutput,"update",new(n().SFString)("NONE")),new(s())(c().initializeOnly,"size",new(n().SFInt32)(128)),new(s())(c().initializeOnly,"textureProperties",new(n().SFNode))]),getTypeName:function(){return"GeneratedCubeMapTexture"},getComponentName:function(){return"CubeMapTexturing"},getContainerField:function(){return"texture"},initialize:function(){p.prototype.initialize.call(this),this._size.addInterest("set_size__",this),this.dependentRenderer.setup(),this.set_size__()},set_size__:function(){const e=this.getBrowser().getContext(),t=e.getVersion()>=2?this._size.getValue():q().nextPowerOfTwo(this._size.getValue());if(t>0){const r=new Uint8Array(t*t*4);e.bindTexture(this.getTarget(),this.getTexture());for(const i of this.getTargets())e.texImage2D(i,0,e.RGBA,t,t,0,e.RGBA,e.UNSIGNED_BYTE,r);this.viewport=new(L())(0,0,t,t),this.frameBuffer=new(N())(this.getBrowser(),t,t)}else this.frameBuffer=null},traverse:function(e,t){"NONE"!==this._update.getValue()&&t.isIndependent()&&this.frameBuffer&&(t.getGeneratedCubeMapTextures().push(this),this.modelMatrix.assign(t.getModelViewMatrix().get()).multRight(t.getCameraSpaceMatrix().get()))},renderTexture:function(){const e=[new(U())(P().zAxis,new(P())(0,0,-1)),new(U())(P().zAxis,new(P())(0,0,1)),new(U())(P().zAxis,new(P())(1,0,0)),new(U())(P().zAxis,new(P())(-1,0,0)),new(U())(P().zAxis,new(P())(0,-1,0)),new(U())(P().zAxis,new(P())(0,1,0))],t=[new(P())(-1,-1,1),new(P())(-1,-1,1),new(P())(-1,-1,1),new(P())(-1,-1,1),new(P())(1,1,1),new(P())(1,1,1)],r=new(j());return function(i){this.dependentRenderer.setRenderer(i);const n=this.dependentRenderer,o=this.getBrowser(),s=i.getLayer(),a=o.getContext(),u=n.getBackground(),h=n.getNavigationInfo(),d=n.getViewpoint(),l=o.getHeadlight(),c=h._headlight.getValue(),g=h.getNearValue(),p=h.getFarValue(d),x=D().perspective(q().radians(90),g,p,1,1,this.projectionMatrix);this.setTransparent(u.getTransparent()),this.frameBuffer.bind(),n.getViewVolumes().push(this.viewVolume.set(x,this.viewport,this.viewport)),n.getProjectionMatrix().pushMatrix(x),a.bindTexture(this.getTarget(),this.getTexture());for(let i=0;i<6;++i){a.clear(a.COLOR_BUFFER_BIT),n.getCameraSpaceMatrix().pushMatrix(this.modelMatrix),n.getCameraSpaceMatrix().rotate(e[i]),n.getCameraSpaceMatrix().scale(t[i]),n.getViewMatrix().pushMatrix(r.assign(n.getCameraSpaceMatrix().get()).inverse()),n.getModelViewMatrix().pushMatrix(r),c&&(l.getModelViewMatrix().pushMatrix(r),l.getModelViewMatrix().multLeft(d.getCameraSpaceMatrix())),s.traverse(M().DISPLAY,n),c&&l.getModelViewMatrix().pop(),n.getModelViewMatrix().pop(),n.getCameraSpaceMatrix().pop(),n.getViewMatrix().pop();const o=this.frameBuffer.readPixels(),u=this.frameBuffer.getWidth(),h=this.frameBuffer.getHeight();a.bindTexture(this.getTarget(),this.getTexture()),a.texImage2D(this.getTargets()[i],0,a.RGBA,u,h,!1,a.RGBA,a.UNSIGNED_BYTE,o)}this.updateTextureParameters(),n.getProjectionMatrix().pop(),n.getViewVolumes().pop(),this.frameBuffer.unbind(),"NEXT_FRAME_ONLY"===this._update.getValue()&&(this._update="NONE")}}(),setShaderUniforms:function(){const e=new Float32Array(16);return function(t,r,i,n){p.prototype.setShaderUniforms.call(this,t,r,i,n),i===this.dependentRenderer&&t.uniformMatrix4fv(r.x3d_ModelViewMatrix,!1,e)}}()});const Y=k,W=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/Components/Networking/X3DUrlObject");var H=r.n(W);const K=window[Symbol.for("X_ITE.X3D-8.2.0")].require("standard/Math/Numbers/Vector2");var Z=r.n(K);const J=window[Symbol.for("X_ITE.X3D-8.2.0")].require("x_ite/DEBUG");var Q=r.n(J),$=r(355);const ee=new Uint8Array([255,255,255,255]),te=[new(Z())(1,1),new(Z())(3,1),new(Z())(0,1),new(Z())(2,1),new(Z())(1,0),new(Z())(1,2)];function re(e){p.call(this,e),H().call(this,e),this.addType(c().ImageCubeMapTexture),this.image=$("<img></img>"),this.canvas=$("<canvas></canvas>"),this.urlStack=new(n().MFString)}re.prototype=Object.assign(Object.create(p.prototype),H().prototype,{constructor:re,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(u())([new(s())(c().inputOutput,"metadata",new(n().SFNode)),new(s())(c().inputOutput,"description",new(n().SFString)),new(s())(c().inputOutput,"load",new(n().SFBool)(!0)),new(s())(c().inputOutput,"url",new(n().MFString)),new(s())(c().inputOutput,"autoRefresh",new(n().SFTime)),new(s())(c().inputOutput,"autoRefreshTimeLimit",new(n().SFTime)(3600)),new(s())(c().initializeOnly,"textureProperties",new(n().SFNode))]),getTypeName:function(){return"ImageCubeMapTexture"},getComponentName:function(){return"CubeMapTexturing"},getContainerField:function(){return"texture"},initialize:function(){p.prototype.initialize.call(this),H().prototype.initialize.call(this);const e=this.getBrowser().getContext();e.bindTexture(this.getTarget(),this.getTexture());for(let t=0;t<6;++t)e.texImage2D(this.getTargets()[t],0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ee);this.image.on("load",this.setImage.bind(this)),this.image.on("abort error",this.setError.bind(this)),this.image[0].crossOrigin="Anonymous",this.requestImmediateLoad()},unLoadNow:function(){this.clearTexture()},loadNow:function(){this.urlStack.setValue(this._url),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.clearTexture(),void this.setLoadState(c().FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.image.attr("src",this.URL.href)},setError:function(){"data:"!==this.URL.protocol&&console.warn("Error loading image:",decodeURI(this.URL.href)),this.loadNext()},setImage:function(){Q()&&"data:"!==this.URL.protocol&&console.info("Done loading image cube map texture:",decodeURI(this.URL.href));try{const e=this.image[0],t=this.canvas[0],r=t.getContext("2d",{willReadFrequently:!0});let i=e.width,n=e.height,o=Math.floor(i/4),s=Math.floor(n/3);q().isPowerOfTwo(o)&&q().isPowerOfTwo(s)&&4*o===i&&3*s===n?(t.width=i,t.height=n,r.drawImage(e,0,0)):(o=q().nextPowerOfTwo(o),s=q().nextPowerOfTwo(s),i=4*o,n=3*s,t.width=i,t.height=n,r.drawImage(e,0,0,e.width,e.height,0,0,i,n));const a=this.getBrowser().getContext();let u=!0;a.bindTexture(this.getTarget(),this.getTexture());for(let e=0;e<6;++e){const t=r.getImageData(te[e].x*o,te[e].y*s,o,s).data;if(u)for(let e=3;e<t.length;e+=4)if(255!==t[e]){u=!1;break}a.texImage2D(this.getTargets()[e],0,a.RGBA,o,s,!1,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(t.buffer))}this.updateTextureParameters(),this.setTransparent(!u),this.setLoadState(c().COMPLETE_STATE)}catch(e){console.log(e.message),this.setError()}},dispose:function(){H().prototype.dispose.call(this),p.prototype.dispose.call(this)}});const ie=re;t().addComponent({name:"CubeMapTexturing",types:{ComposedCubeMapTexture:m,GeneratedCubeMapTexture:Y,ImageCubeMapTexture:ie},abstractTypes:{X3DEnvironmentTextureNode:p}})})()})();