/* X_ITE v7.0.0 */(()=>{"use strict";let t=0,n=0,i=0;const o={CONNECTION_ERROR:t++,BROWSER_EVENT:t++,INITIALIZED_EVENT:t++,SHUTDOWN_EVENT:t++,INITIALIZED_ERROR:t++,NOT_STARTED_STATE:n++,IN_PROGRESS_STATE:n++,COMPLETE_STATE:n++,FAILED_STATE:n++,initializeOnly:1,inputOnly:2,outputOnly:4,inputOutput:7,SFBool:i++,SFColor:i++,SFColorRGBA:i++,SFDouble:i++,SFFloat:i++,SFImage:i++,SFInt32:i++,SFMatrix3d:i++,SFMatrix3f:i++,SFMatrix4d:i++,SFMatrix4f:i++,SFNode:i++,SFRotation:i++,SFString:i++,SFTime:i++,SFVec2d:i++,SFVec2f:i++,SFVec3d:i++,SFVec3f:i++,SFVec4d:i++,SFVec4f:i++,VrmlMatrix:i++,MFBool:i++,MFColor:i++,MFColorRGBA:i++,MFDouble:i++,MFFloat:i++,MFImage:i++,MFInt32:i++,MFMatrix3d:i++,MFMatrix3f:i++,MFMatrix4d:i++,MFMatrix4f:i++,MFNode:i++,MFRotation:i++,MFString:i++,MFTime:i++,MFVec2d:i++,MFVec2f:i++,MFVec3d:i++,MFVec3f:i++,MFVec4d:i++,MFVec4f:i++,X3DBaseNode:0};function r(){this.indent="",this.indentChar="  ",this.precision=6,this.doublePrecision=14,this.removeTrailingZeros=/\.?0*(?=$|[eE])/,this.executionContextStack=[null],this.importedNodesIndex=new Map,this.exportedNodesIndex=new Map,this.nodes=new Set,this.names=new Map,this.namesByNode=new Map,this.importedNames=new Map,this.routeNodes=new Set,this.level=0,this.newName=0,this.containerFields=[],this.units=!0,this.unitCategories=[],this.names.set(null,new Map)}r.prototype={constructor:r,Indent:function(){return this.indent},IncIndent:function(){this.indent+=this.indentChar},DecIndent:function(){this.indent=this.indent.substr(0,this.indent.length-this.indentChar.length)},PadRight:function(t,e){for(let n=0,i=e-t.length;n<i;++n)t+=" ";return t},Precision:function(t){return Math.fround(t).toPrecision(this.precision).replace(this.removeTrailingZeros,"")},DoublePrecision:function(t){return t.toPrecision(this.doublePrecision).replace(this.removeTrailingZeros,"")},PushExecutionContext:function(t){this.executionContextStack.push(t),this.names.has(t)||this.names.set(t,new Map),this.importedNodesIndex.has(t)||this.importedNodesIndex.set(t,new Set),this.exportedNodesIndex.has(t)||this.exportedNodesIndex.set(t,new Set)},PopExecutionContext:function(){this.executionContextStack.pop(),this.ExecutionContext()||(this.importedNodesIndex.clear(),this.exportedNodesIndex.clear())},ExecutionContext:function(){return this.executionContextStack.at(-1)},EnterScope:function(){0===this.level&&(this.newName=0),++this.level},LeaveScope:function(){--this.level,0===this.level&&(this.nodes.clear(),this.namesByNode.clear(),this.importedNames.clear())},ExportedNodes:function(t){const e=this.exportedNodesIndex.get(this.ExecutionContext());t.forEach((function(t){try{e.add(t.getLocalNode())}catch(t){}}))},ImportedNodes:function(t){const e=this.importedNodesIndex.get(this.ExecutionContext());t.forEach((function(t){try{e.add(t.getInlineNode())}catch(t){}}))},AddImportedNode:function(t,e){this.importedNames.set(t,e)},AddRouteNode:function(t){this.routeNodes.add(t)},ExistsRouteNode:function(t){return this.routeNodes.has(t)},IsSharedNode:function(t){return this.ExecutionContext()!==t.getExecutionContext()},AddNode:function(t){this.nodes.add(t),this.AddRouteNode(t)},ExistsNode:function(t){return this.nodes.has(t)},Name:function(){const t=/_\d+$/;return function(e){const n=this.namesByNode.get(e);if(void 0!==n)return n;{const n=this.names.get(this.ExecutionContext());if(0===e.getName().length){if(this.NeedsName(e)){const t=this.UniqueName();return n.set(t,e),this.namesByNode.set(e,t),t}return e.getName()}let i=e.getName();const o=null!==i.match(t);if(i=i.replace(t,""),0===i.length){if(!this.NeedsName(e))return"";i=this.UniqueName()}else{let t=0,e=o?i+"_"+ ++t:i;for(;n.has(e);)e=i+"_"+ ++t;i=e}return n.set(i,e),this.namesByNode.set(e,i),i}}}(),NeedsName:function(t){if(t.getCloneCount()>1)return!0;if(t.hasRoutes())return!0;const e=t.getExecutionContext(),n=this.importedNodesIndex.get(e);if(!n){const n=this.exportedNodesIndex.get(e);return!(!n||!n.has(t))}return!!n.has(t)||void 0},UniqueName:function(){const t=this.names.get(this.ExecutionContext());for(;;){const e="_"+ ++this.newName;if(!t.has(e))return e}},LocalName:function(t){const e=this.importedNames.get(t);if(void 0!==e)return e;if(this.ExistsNode(t))return this.Name(t);throw new Error("Couldn't get local name for node '"+t.getTypeName()+"'.")},PushContainerField:function(t){this.containerFields.push(t)},PopContainerField:function(){this.containerFields.pop()},ContainerField:function(){return this.containerFields.length?this.containerFields[this.containerFields.length-1]:null},AccessType:function(t){switch(t){case o.initializeOnly:return"initializeOnly";case o.inputOnly:return"inputOnly";case o.outputOnly:return"outputOnly";case o.inputOutput:return"inputOutput"}},SetUnits:function(t){this.units=t},GetUnits:function(){return this.units},PushUnitCategory:function(t){this.unitCategories.push(t)},PopUnitCategory:function(){this.unitCategories.pop()},Unit:function(t){return 0==this.unitCategories.length?t:this.unitCategories.at(-1)},ToUnit:function(t,e){if(this.units){const n=this.ExecutionContext();if(n)return n.toUnit(t,e)}return e},XMLEncode:function(t){return t.replace(/&/g,"&amp;").replace(/\\/g,"&#92;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,'\\"')},escapeCDATA:function(t){return t.replace(/\]\]\>/g,"\\]\\]\\>")}};for(const t of Reflect.ownKeys(r.prototype))Object.defineProperty(r.prototype,t,{enumerable:!1});r.Get=function(t){return t.generator||(t.generator=new r),t.generator};const s=r,a={assign:function(){function t(t,e){this.set(e,t)}return function(e,n){return e.clear(),n.forEach(t,e),e}}(),values:function(){function t(t){this.push(t)}return function(e,n){return e.length=0,n.forEach(t,e),e}}()},u=a,c=Symbol(),l=Symbol(),h=Symbol();function d(){}d.prototype={constructor:d,[c]:"",[l]:new Map,[h]:[],getId:function(){return d.getId(this)},getTypeName:function(){return"X3DObject"},setName:function(t){this[c]=t},getName:function(){return this[c]},getDisplayName:function(){return this[c]},getInterestId:function(t,e){return d.getId(e)+"."+String(t)},hasInterest:function(t,e){return this[l].has(this.getInterestId(t,e))},addInterest:function(t,e){this[l]===d.prototype[l]&&(this[l]=new Map,this[h]=[]);const n=this.getInterestId(t,e),i=e[t];if(arguments.length>2){const t=Array.prototype.slice.call(arguments,2);t.unshift(e),t.push(this),this[l].set(n,Function.prototype.bind.apply(i,t))}else this[l].set(n,i.bind(e,this))},removeInterest:function(t,e){this[l].delete(this.getInterestId(t,e))},getInterests:function(){return this[l]},processInterests:function(){if(this[l].size)for(const t of u.values(this[h],this[l]))t()},toString:function(t){const e={string:""};return t&&s.Get(e).PushExecutionContext(t),this.toStream(e),e.string},toVRMLString:function(){const t={string:""};return this.toVRMLStream(t),t.string},toXMLString:function(){const t={string:""};return this.toXMLStream(t),t.string},toJSONString:function(){const t={string:""};return this.toVRMLStream(t),t.string},toStream:function(t){t.string="[object "+this.getTypeName()+"]"},dispose:function(){}};for(const t of Reflect.ownKeys(d.prototype))Object.defineProperty(d.prototype,t,{enumerable:!1});d.getId=function(){const t=new WeakMap;let e=0;return function(n){const i=t.get(n);return void 0!==i?i:(t.set(n,++e),e)}}();const f=d,p=Symbol(),g=Symbol(),m=Symbol();function _(){f.call(this)}_.prototype=Object.assign(Object.create(f.prototype),{constructor:_,[p]:0,[g]:!1,[m]:new Set,setModificationTime:function(t){this[p]=t},getModificationTime:function(){return this[p]},setTainted:function(t){this[g]=t},isTainted:function(){return this[g]},addEvent:function(){this.setModificationTime(performance.now());for(const t of this[m])t.addEvent(this)},addEventObject:function(t,e){this.setModificationTime(performance.now());for(const t of this[m])t.addEventObject(this,e)},addParent:function(t){this[m]===_.prototype[m]&&(this[m]=new Set),this[m].add(t)},removeParent:function(t){this[m].delete(t)},getParents:function(){return this[m]},dispose:function(){this[m].clear(),f.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(_.prototype))Object.defineProperty(_.prototype,t,{enumerable:!1});const x=_,y=Symbol();function w(){this[y]=[]}w.prototype={create:function(t){if(this[y].length){const e=this[y].pop();return e.field=t,e.clear(),e}const e=new Set;return e.field=t,e},copy:function(t){if(this[y].length){const e=this[y].pop();e.field=t.field,e.clear();for(const n of t)e.add(n);return e}const e=new Set(t);return e.field=t.field,e},push:function(t){this[y].push(t)},clear:function(){this[y].length=0}};for(const t of Reflect.ownKeys(w.prototype))Object.defineProperty(w.prototype,t,{enumerable:!1});const T=new w,S=Symbol(),b=Symbol(),v=Symbol(),E=Symbol(),C=Symbol(),O=Symbol(),F=Symbol(),N=Symbol(),M=Symbol(),V=Symbol(),I=Symbol.for("X3DField.uniformLocation");function D(t){return x.call(this),this[S]=t,this}D.prototype=Object.assign(Object.create(x.prototype),{constructor:D,[S]:null,[b]:o.initializeOnly,[v]:null,[I]:null,[E]:new Set,[C]:new Map,[O]:new Set,[F]:new Map,[N]:new Set,[M]:new Set,[V]:new Map,create:function(){return new this.constructor},equals:function(t){return this[S]===t.valueOf()},assign:function(t){this.set(t.getValue()),this.addEvent()},set:function(t){this[S]=t},setValue:function(t){this.set(t instanceof this.constructor?t.getValue():t),this.addEvent()},getValue:function(){return this[S]},setAccessType:function(t){this[b]=t},getAccessType:function(){return this[b]},isInitializable:function(){return this[b]&o.initializeOnly},isInput:function(){return this[b]&o.inputOnly},isOutput:function(){return this[b]&o.outputOnly},isReadable:function(){return this[b]!==o.inputOnly},isWritable:function(){return this[b]!==o.initializeOnly},setUnit:function(t){this[v]=t},getUnit:function(){return this[v]},hasReferences:function(){return 0!==this[E].size},isReference:function(t){return t===this[b]||t===o.inputOutput},addReference:function(t){const e=this.getReferences();if(!e.has(t)){switch(e.add(t),this.getAccessType()&t.getAccessType()){case o.initializeOnly:t.addFieldInterest(this),this.assign(t);break;case o.inputOnly:t.addFieldInterest(this);break;case o.outputOnly:this.addFieldInterest(t);break;case o.inputOutput:t.addFieldInterest(this),this.addFieldInterest(t),this.assign(t)}this.processReferencesCallbacks()}},removeReference:function(t){switch(this.getReferences().delete(t),this.getAccessType()&t.getAccessType()){case o.initializeOnly:case o.inputOnly:t.removeFieldInterest(this);break;case o.outputOnly:this.removeFieldInterest(t);break;case o.inputOutput:t.removeFieldInterest(this),this.removeFieldInterest(t)}this.processReferencesCallbacks()},getReferences:function(){return this[E]===D.prototype[E]&&(this[E]=new Set),this[E]},addReferencesCallback:function(t,e){this[C]===D.prototype[C]&&(this[C]=new Map),this[C].set(t,e)},removeReferencesCallback:function(t){this[C].delete(t)},getReferencesCallbacks:function(){return this[C]},processReferencesCallbacks:function(){const t=[];return function(){if(this[C].size)for(const e of u.values(t,this[C]))e()}}(),addFieldInterest:function(t){this[O]===D.prototype[O]&&(this[O]=new Set),this[O].add(t)},removeFieldInterest:function(t){this[O].delete(t)},getFieldInterests:function(){return this[O]},addFieldCallback:function(t,e){this[F]===D.prototype[F]&&(this[F]=new Map),this[F].set(t,e)},removeFieldCallback:function(t){this[F].delete(t)},getFieldCallbacks:function(){return this[F]},addInputRoute:function(t){this[N]===D.prototype[N]&&(this[N]=new Set),this[N].add(t),this.processRouteCallbacks()},removeInputRoute:function(t){this[N].delete(t),this.processRouteCallbacks()},getInputRoutes:function(){return this[N]},addOutputRoute:function(t){this[M]===D.prototype[M]&&(this[M]=new Set),this[M].add(t),this.processRouteCallbacks()},removeOutputRoute:function(t){this[M].delete(t),this.processRouteCallbacks()},getOutputRoutes:function(){return this[M]},addRouteCallback:function(t,e){this[V]===D.prototype[V]&&(this[V]=new Map),this[V].set(t,e)},removeRouteCallback:function(t){this[V].delete(t)},getRouteCallbacks:function(){return this[V]},processRouteCallbacks:function(){const t=[];return function(){if(this[V].size)for(const e of u.values(t,this[V]))e()}}(),processEvent:function(){const t=[];return function(e=T.create(this)){if(e.has(this))return;e.add(this),this.setTainted(!1);const n=e.field;n!==this&&this.set(n.getValue(),n.length),this.processInterests();let i=!0;if(this[O].size)for(const t of this[O].values())i?(i=!1,t.addEventObject(this,e)):t.addEventObject(this,T.copy(e));if(i&&T.push(e),this[F].size)for(const e of u.values(t,this[F]))e(this.valueOf())}}(),addCloneCount:Function.prototype,removeCloneCount:Function.prototype,valueOf:function(){return this},fromString:function(t,e){const n=new(window[Symbol.for("X_ITE.X3D-7.0.0")].require("VRMLParser"))(e);if(n.setUnits(!!e),n.setInput(t),!n.fieldValue(this))throw new Error("Couldn't read value for field '"+this.getName()+"'.")},dispose:function(){for(const t of new Set(this[N]))t.dispose();for(const t of new Set(this[M]))t.dispose();x.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(D.prototype))Object.defineProperty(D.prototype,t,{enumerable:!1});const R=D;function P(t){return R.call(this,arguments.length?+t:0)}P.prototype=Object.assign(Object.create(R.prototype),{constructor:P,copy:function(){return new P(this.getValue())},getTypeName:function(){return"SFTime"},getType:function(){return o.SFTime},isDefaultValue:function(){return 0===this.getValue()},set:function(t){R.prototype.set.call(this,+t)},valueOf:R.prototype.getValue,toStream:function(t){t.string+=this.getValue()},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)}});for(const t of Reflect.ownKeys(P.prototype))Object.defineProperty(P.prototype,t,{enumerable:!1});const A=P,L=Symbol.for("X3DEventObject.browser");function B(t){x.call(this),this[L]=t}B.prototype=Object.assign(Object.create(x.prototype),{constructor:B,getBrowser:function(){return this[L]},getExtendedEventHandling:function(){return!0},addEvent:function(t){t.isTainted()||(t.setTainted(!0),this.addEventObject(t,T.create(t)))},addEventObject:function(t,e){const n=this.getBrowser();n.addBrowserEvent(),n.addTaintedField(t,e),this.isTainted()||(t.isInput()||this.getExtendedEventHandling()&&!t.isOutput())&&this.addNodeEvent()},addNodeEvent:function(){if(this.isTainted())return;const t=this.getBrowser();this.setTainted(!0),t.addTaintedNode(this),t.addBrowserEvent()},processEvents:function(){this.setTainted(!1),this.processInterests()}});for(const t of Reflect.ownKeys(B.prototype))Object.defineProperty(B.prototype,t,{enumerable:!1});const X=B;function U(t,e,n){this.accessType=t,this.dataType=n.getType(),this.name=e,this.value=n}U.prototype=Object.assign(Object.create(f.prototype),{constructor:U,getTypeName:function(){return"X3DFieldDefinition"}});for(const t of Reflect.ownKeys(U.prototype))Object.defineProperty(U.prototype,t,{enumerable:!1});const z=U,j=Symbol(),k=Symbol(),G={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=+e;return Number.isInteger(n)?t[j][n]:void 0}},set:function(t,e,n){return void 0!==t[e]&&(t[e]=n,!0)},has:function(t,e){return Number.isInteger(+e)?e<t[j].length:e in t},ownKeys:function(t){return Object.keys(t[j])},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;if(Number.isInteger(n)&&n<t[j].length){const n=Object.getOwnPropertyDescriptor(t[j],e);return n&&(n.writable=!1),n}}};function H(t){if(this[j]=[],this[k]=new Map,this[Symbol.iterator]=this[j][Symbol.iterator],t)for(const e of t)this.add(e.name,e);return new Proxy(this,G)}H.prototype={constructor:H,equals:function(t){const e=this[j],n=t[j]||t,i=e.length;if(e===n)return!0;if(i!==n.length)return!1;for(let t=0;t<i;++t)if(e[t]!==n[t])return!1;return!0},has:function(t){return this[k].has(t)},get:function(t){return this[k].get(t)},add:function(t,e){this[j].push(e),this[k].set(t,e)},addAlias:function(t,e){this[k].set(t,this[k].get(e))},update:function(t,e,n){const i=this[k].get(t);if(t!==e&&this.remove(e),this[k].delete(t),this[k].set(e,n),void 0!==i){const t=this[j].indexOf(i);t>-1&&(this[j][t]=n)}else this[j].push(n)},remove:function(t){const e=this[k].get(t);if(void 0===e)return;const n=this[j].indexOf(e);this[k].delete(t),n>-1&&this[j].splice(n,1)},at:Array.prototype.at,concat:Array.prototype.concat,every:Array.prototype.every,fill:Array.prototype.fill,filter:Array.prototype.filter,find:Array.prototype.find,findIndex:Array.prototype.findIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:function(){return Array(this.length).keys()},lastIndexOf:Array.prototype.lastIndexOf,map:Array.prototype.map,reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice:Array.prototype.slice,some:Array.prototype.some,values:function(){return this[Symbol.iterator]},toString:function(t){const e={string:""};return t&&Generator.Get(e).PushExecutionContext(t),this.toStream(e),e.string},toVRMLStream:function(t){for(const e of this[j])try{e.toVRMLStream(t),t.string+="\n",e instanceof Zn&&(t.string+="\n")}catch(t){console.error(t)}},toXMLStream:function(t){for(const e of this[j])try{e.toXMLStream(t),t.string+="\n"}catch(t){console.error(t)}},toStream:function(t){t.string="[object "+this.getTypeName()+"]"}};for(const t of Reflect.ownKeys(H.prototype))Object.defineProperty(H.prototype,t,{enumerable:!1});Object.defineProperty(H.prototype,"length",{get:function(){return this[j].length},enumerable:!1,configurable:!1});const q=H;function Y(t){return q.call(this,t)}Y.prototype=Object.assign(Object.create(q.prototype),{constructor:Y,getTypeName:function(){return"FieldDefinitionArray"}});for(const t of Reflect.ownKeys(Y.prototype))Object.defineProperty(Y.prototype,t,{enumerable:!1});const W=Y;function K(){return q.call(this)}K.prototype=Object.assign(Object.create(q.prototype),{constructor:K,getTypeName:function(){return"FieldArray"}});for(const t of Reflect.ownKeys(K.prototype))Object.defineProperty(K.prototype,t,{enumerable:!1});const Q=K;function Z(t){return R.call(this,!!t)}Z.prototype=Object.assign(Object.create(R.prototype),{constructor:Z,copy:function(){return new Z(this.getValue())},isDefaultValue:function(){return!1===this.getValue()},set:function(t){R.prototype.set.call(this,!!t)},getTypeName:function(){return"SFBool"},getType:function(){return o.SFBool},valueOf:function(){return this.getValue()},toStream:function(t){t.string+=this.getValue()?"TRUE":"FALSE"},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){t.string+=this.getValue()?"true":"false"}});for(const t of Reflect.ownKeys(Z.prototype))Object.defineProperty(Z.prototype,t,{enumerable:!1});const J=Z;function tt(){}tt.prototype={constructor:tt,radians:function(t){return t*(Math.PI/180)},degrees:function(t){return t*(180/Math.PI)},random:function(t,e){return t+Math.random()*(e-t)},fract:function(t){return t%1},clamp:function(t,e,n){return Math.min(Math.max(t,e),n)},interval:function(t,e,n){return t>=n?(t-e)%(n-e)+e:t<e?(t-n)%(n-e)+n:t},lerp:function(t,e,n){return t+n*(e-t)},slerp:function(t,e,n){let i=t.dot(e);if(i>=1)return t;i<0&&(i=-i,e.negate());const o=Math.acos(i),r=Math.sin(o),s=Math.sin((1-n)*o)/r,a=Math.sin(n*o)/r;return t.x=t.x*s+e.x*a,t.y=t.y*s+e.y*a,t.z=t.z*s+e.z*a,t.w=t.w*s+e.w*a,t},simpleSlerp:function(t,e,n){const i=t.dot(e);if(i>=1)return t;const o=Math.acos(i),r=Math.sin(o),s=Math.sin((1-n)*o)/r,a=Math.sin(n*o)/r;return t.x=t.x*s+e.x*a,t.y=t.y*s+e.y*a,t.z=t.z*s+e.z*a,t.w=t.w*s+e.w*a,t},isPowerOfTwo:function(t){return 0==(t-1&t)},nextPowerOfTwo:function(t){return this.isPowerOfTwo(t)?t:1<<32-Math.clz32(t)},cmp:function(t,e){return t>e?1:t<e?-1:0},less:function(t,e){return t<e},greater:function(t,e){return t>e},lowerBound:function(t,e,n,i,o=this.less){let r=0,s=0,a=n-e;for(;a>0;)s=a>>>1,r=e+s,o(t[r],i)?(e=++r,a-=s+1):a=s;return e},upperBound:function(t,e,n,i,o=this.less){let r=0,s=0,a=n-e;for(;a>0;)s=a>>>1,r=e+s,o(i,t[r])?a=s:(e=++r,a-=s+1);return e},set_difference:function(t,e,n){for(const i of t)e.has(i)||n.add(i);return n}};const et=new tt,nt=et.clamp,it=Symbol.for("X_ITE.Color3.r"),ot=Symbol.for("X_ITE.Color3.g"),rt=Symbol.for("X_ITE.Color3.b");function st(t,e,n){arguments.length?(this[it]=nt(t,0,1),this[ot]=nt(e,0,1),this[rt]=nt(n,0,1)):(this[it]=0,this[ot]=0,this[rt]=0)}st.prototype={constructor:st,length:3,[Symbol.iterator]:function*(){yield this[it],yield this[ot],yield this[rt]},copy:function(){const t=Object.create(st.prototype);return t[it]=this[it],t[ot]=this[ot],t[rt]=this[rt],t},assign:function(t){this[it]=t[it],this[ot]=t[ot],this[rt]=t[rt]},set:function(t,e,n){this[it]=nt(t,0,1),this[ot]=nt(e,0,1),this[rt]=nt(n,0,1)},equals:function(t){return this[it]===t[it]&&this[ot]===t[ot]&&this[rt]===t[rt]},getHSV:function(t){let e,n,i;const o=Math.min(this[it],this[ot],this[rt]),r=Math.max(this[it],this[ot],this[rt]);i=r;const s=r-o;return 0!==r&&0!==s?(n=s/r,e=this[it]===r?(this[ot]-this[rt])/s:this[ot]===r?2+(this[rt]-this[it])/s:4+(this[it]-this[ot])/s,e*=Math.PI/3,e<0&&(e+=2*Math.PI)):n=e=0,t[0]=e,t[1]=n,t[2]=i,t},setHSV:function(t,e,n){if(e=nt(e,0,1),n=nt(n,0,1),0===e)this[it]=this[ot]=this[rt]=n;else{const i=et.degrees(et.interval(t,0,2*Math.PI))/60,o=Math.floor(i),r=i-o,s=n*(1-e),a=n*(1-e*r),u=n*(1-e*(1-r));switch(o%6){case 0:this[it]=n,this[ot]=u,this[rt]=s;break;case 1:this[it]=a,this[ot]=n,this[rt]=s;break;case 2:this[it]=s,this[ot]=n,this[rt]=u;break;case 3:this[it]=s,this[ot]=a,this[rt]=n;break;case 4:this[it]=u,this[ot]=s,this[rt]=n;break;default:this[it]=n,this[ot]=s,this[rt]=a}}},toString:function(){return this[it]+" "+this[ot]+" "+this[rt]}};const at={get:function(){return this[it]},set:function(t){this[it]=nt(t,0,1)},enumerable:!0,configurable:!1},ut={get:function(){return this[ot]},set:function(t){this[ot]=nt(t,0,1)},enumerable:!0,configurable:!1},ct={get:function(){return this[rt]},set:function(t){this[rt]=nt(t,0,1)},enumerable:!0,configurable:!1};Object.defineProperty(st.prototype,"r",at),Object.defineProperty(st.prototype,"g",ut),Object.defineProperty(st.prototype,"b",ct),at.enumerable=!1,ut.enumerable=!1,ct.enumerable=!1,Object.defineProperty(st.prototype,"0",at),Object.defineProperty(st.prototype,"1",ut),Object.defineProperty(st.prototype,"2",ct),Object.assign(st,{HSV:function(t,e,n){const i=Object.create(this.prototype);return i.setHSV(t,e,n),i},lerp:function(t,e,n,i){let o=t[0],r=e[0];const s=t[1],a=e[1],u=t[2],c=e[2];0===s&&(o=r),0===a&&(r=o);const l=Math.abs(r-o);if(l<=Math.PI)return i[0]=o+n*(r-o),i[1]=s+n*(a-s),i[2]=u+n*(c-u),i;const h=2*Math.PI,d=(h-l)*n;let f=o<r?o-d:o+d;return f<0?f+=h:f>h&&(f-=h),i[0]=f,i[1]=s+n*(a-s),i[2]=u+n*(c-u),i}});const lt=st;function ht(t,e,n){switch(arguments.length){case 0:return R.call(this,new lt);case 1:return R.call(this,arguments[0]);case 3:return R.call(this,new lt(+t,+e,+n))}throw new Error("Invalid arguments.")}ht.prototype=Object.assign(Object.create(R.prototype),{constructor:ht,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new ht(this.getValue().copy())},getTypeName:function(){return"SFColor"},getType:function(){return o.SFColor},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return 0===this.getValue().r&&0===this.getValue().g&&0===this.getValue().b},set:function(t){this.getValue().assign(t)},getHSV:function(){return this.getValue().getHSV([])},setHSV:function(t,e,n){this.getValue().setHSV(t,e,n),this.addEvent()},lerp:function(){const t=[],e=[],n=[];return function(i,o){const r=new ht;return this.getValue().getHSV(t),i.getValue().getHSV(e),lt.lerp(t,e,o,n),r.setHSV(n[0],n[1],n[2],n[3]),r}}(),toStream:function(t){const e=s.Get(t),n=this.getValue(),i=n.length-1;for(let o=0;o<i;++o)t.string+=e.Precision(n[o]),t.string+=" ";t.string+=e.Precision(n[i])},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)}});for(const t of Reflect.ownKeys(ht.prototype))Object.defineProperty(ht.prototype,t,{enumerable:!1});const dt={get:function(){return this.getValue().r},set:function(t){this.getValue().r=+t,this.addEvent()},enumerable:!0,configurable:!1},ft={get:function(){return this.getValue().g},set:function(t){this.getValue().g=+t,this.addEvent()},enumerable:!0,configurable:!1},pt={get:function(){return this.getValue().b},set:function(t){this.getValue().b=+t,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(ht.prototype,"r",dt),Object.defineProperty(ht.prototype,"g",ft),Object.defineProperty(ht.prototype,"b",pt),dt.enumerable=!1,ft.enumerable=!1,pt.enumerable=!1,Object.defineProperty(ht.prototype,"0",dt),Object.defineProperty(ht.prototype,"1",ft),Object.defineProperty(ht.prototype,"2",pt);const gt=ht,mt=et.clamp,_t=Symbol.for("X_ITE.Color3.r"),xt=Symbol.for("X_ITE.Color3.g"),yt=Symbol.for("X_ITE.Color3.b"),wt=Symbol();function Tt(t,e,n,i){arguments.length?(this[_t]=mt(t,0,1),this[xt]=mt(e,0,1),this[yt]=mt(n,0,1),this[wt]=mt(i,0,1)):(this[_t]=0,this[xt]=0,this[yt]=0,this[wt]=0)}Tt.prototype={constructor:Tt,length:4,[Symbol.iterator]:function*(){yield this[_t],yield this[xt],yield this[yt],yield this[wt]},copy:function(){const t=Object.create(Tt.prototype);return t[_t]=this[_t],t[xt]=this[xt],t[yt]=this[yt],t[wt]=this[wt],t},assign:function(t){this[_t]=t[_t],this[xt]=t[xt],this[yt]=t[yt],this[wt]=t[wt]},set:function(t,e,n,i){this[_t]=mt(t,0,1),this[xt]=mt(e,0,1),this[yt]=mt(n,0,1),this[wt]=mt(i,0,1)},equals:function(t){return this[_t]===t[_t]&&this[xt]===t[xt]&&this[yt]===t[yt]&&this[wt]===t[wt]},getHSVA:function(t){return lt.prototype.getHSV.call(this,t),t[3]=this[wt],t},setHSVA:function(t,e,n,i){lt.prototype.setHSV.call(this,t,e,n),this[wt]=mt(i,0,1)},toString:function(){return this[_t]+" "+this[xt]+" "+this[yt]+" "+this[wt]}};const St={get:function(){return this[_t]},set:function(t){this[_t]=mt(t,0,1)},enumerable:!0,configurable:!1},bt={get:function(){return this[xt]},set:function(t){this[xt]=mt(t,0,1)},enumerable:!0,configurable:!1},vt={get:function(){return this[yt]},set:function(t){this[yt]=mt(t,0,1)},enumerable:!0,configurable:!1},Et={get:function(){return this[wt]},set:function(t){this[wt]=mt(t,0,1)},enumerable:!0,configurable:!1};Object.defineProperty(Tt.prototype,"r",St),Object.defineProperty(Tt.prototype,"g",bt),Object.defineProperty(Tt.prototype,"b",vt),Object.defineProperty(Tt.prototype,"a",Et),St.enumerable=!1,bt.enumerable=!1,vt.enumerable=!1,Et.enumerable=!1,Object.defineProperty(Tt.prototype,"0",St),Object.defineProperty(Tt.prototype,"1",bt),Object.defineProperty(Tt.prototype,"2",vt),Object.defineProperty(Tt.prototype,"3",Et),Object.assign(Tt,{HSVA:function(t,e,n,i){const o=Object.create(this.prototype);return o.setHSVA(t,e,n,i),o},lerp:function(t,e,n,i){const o=t[3];return lt.lerp(t,e,n,i),i[3]=o+n*(e[3]-o),i}});const Ct=Tt;function Ot(t,e,n,i){switch(arguments.length){case 0:return R.call(this,new Ct);case 1:return R.call(this,arguments[0]);case 4:return R.call(this,new Ct(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}Ot.prototype=Object.assign(Object.create(R.prototype),{constructor:Ot,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Ot(this.getValue().copy())},getTypeName:function(){return"SFColorRGBA"},getType:function(){return o.SFColorRGBA},equals:gt.prototype.equals,isDefaultValue:function(){return 0===this.getValue().r&&0===this.getValue().g&&0===this.getValue().b&&0===this.getValue().a},set:gt.prototype.set,getHSVA:function(){return this.getValue().getHSVA([])},setHSVA:function(t,e,n,i){this.getValue().setHSVA(t,e,n,i),this.addEvent()},lerp:function(){const t=[],e=[],n=[];return function(i,o){const r=new Ot;return this.getValue().getHSVA(t),i.getValue().getHSVA(e),Ct.lerp(t,e,o,n),r.setHSVA(n[0],n[1],n[2],n[3]),r}}(),toStream:gt.prototype.toStream,toVRMLStream:gt.prototype.toVRMLStream,toXMLStream:gt.prototype.toXMLStream});for(const t of Reflect.ownKeys(Ot.prototype))Object.defineProperty(Ot.prototype,t,{enumerable:!1});const Ft={get:function(){return this.getValue().r},set:function(t){this.getValue().r=+t,this.addEvent()},enumerable:!0,configurable:!1},Nt={get:function(){return this.getValue().g},set:function(t){this.getValue().g=+t,this.addEvent()},enumerable:!0,configurable:!1},Mt={get:function(){return this.getValue().b},set:function(t){this.getValue().b=+t,this.addEvent()},enumerable:!0,configurable:!1},Vt={get:function(){return this.getValue().a},set:function(t){this.getValue().a=+t,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(Ot.prototype,"r",Ft),Object.defineProperty(Ot.prototype,"g",Nt),Object.defineProperty(Ot.prototype,"b",Mt),Object.defineProperty(Ot.prototype,"a",Vt),Ft.enumerable=!1,Nt.enumerable=!1,Mt.enumerable=!1,Vt.enumerable=!1,Object.defineProperty(Ot.prototype,"0",Ft),Object.defineProperty(Ot.prototype,"1",Nt),Object.defineProperty(Ot.prototype,"2",Mt),Object.defineProperty(Ot.prototype,"3",Vt);const It=Ot;function Dt(t){return R.call(this,arguments.length?+t:0)}Dt.prototype=Object.assign(Object.create(R.prototype),{constructor:Dt,copy:function(){return new Dt(this.getValue())},getTypeName:function(){return"SFDouble"},getType:function(){return o.SFDouble},isDefaultValue:function(){return 0===this.getValue()},set:function(t){R.prototype.set.call(this,+t)},valueOf:R.prototype.getValue,toStream:function(t){const e=s.Get(t),n=e.Unit(this.getUnit());t.string+=e.DoublePrecision(e.ToUnit(n,this.getValue()))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)}});for(const t of Reflect.ownKeys(Dt.prototype))Object.defineProperty(Dt.prototype,t,{enumerable:!1});const Rt=Dt;function Pt(t){return R.call(this,arguments.length?+t:0)}Pt.prototype=Object.assign(Object.create(R.prototype),{constructor:Pt,copy:function(){return new Pt(this.getValue())},getTypeName:function(){return"SFFloat"},getType:function(){return o.SFFloat},isDefaultValue:function(){return 0===this.getValue()},set:function(t){R.prototype.set.call(this,+t)},valueOf:R.prototype.getValue,toStream:function(t){const e=s.Get(t),n=e.Unit(this.getUnit());t.string+=e.Precision(e.ToUnit(n,this.getValue()))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)}});for(const t of Reflect.ownKeys(Pt.prototype))Object.defineProperty(Pt.prototype,t,{enumerable:!1});const At=Pt;function Lt(t){return R.call(this,~~t)}Lt.prototype=Object.assign(Object.create(R.prototype),{constructor:Lt,copy:function(){return new Lt(this.getValue())},getTypeName:function(){return"SFInt32"},getType:function(){return o.SFInt32},isDefaultValue:function(){return 0===this.getValue()},set:function(t){R.prototype.set.call(this,~~t)},valueOf:R.prototype.getValue,toStream:function(t,e){t.string+=this.getValue().toString(e)},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){t.string+=this.getValue().toString()}});for(const t of Reflect.ownKeys(Lt.prototype))Object.defineProperty(Lt.prototype,t,{enumerable:!1});const Bt=Lt;function Xt(t,e,n){return Object.assign(Object.create(R.prototype),{[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new this.constructor(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(t.Identity)},set:function(t){this.getValue().assign(t)},setTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e?e.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,o=o?o.getValue():null,this.getValue().set(t,e,n,i,o)},getTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e?e.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,o=o?o.getValue():null,this.getValue().get(t,e,n,i,o)},determinant:function(){return this.getValue().determinant()},transpose:function(){return new this.constructor(t.transpose(this.getValue()))},inverse:function(){return new this.constructor(t.inverse(this.getValue()))},multLeft:function(e){return new this.constructor(t.multLeft(this.getValue(),e.getValue()))},multRight:function(e){return new this.constructor(t.multRight(this.getValue(),e.getValue()))},multVecMatrix:function(t){return new e(this.getValue().multVecMatrix(t.getValue().copy()))},multMatrixVec:function(t){return new e(this.getValue().multMatrixVec(t.getValue().copy()))},multDirMatrix:function(t){return new e(this.getValue().multDirMatrix(t.getValue().copy()))},multMatrixDir:function(t){return new e(this.getValue().multMatrixDir(t.getValue().copy()))},toStream:function(t){const e=Generator.Get(t),i=this.getValue(),o=i.length-1;for(let r=0;r<o;++r)t.string+=n?e.DoublePrecision(i[r]):e.Precision(i[r]),t.string+=" ";t.string+=n?e.DoublePrecision(i[o]):e.Precision(i[o])},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)}})}function Ut(t,e){return Object.assign(Object.create(R.prototype),{[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new this.constructor(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(t.Zero)},set:function(t){this.getValue().assign(t)},abs:function(){return new this.constructor(t.abs(this.getValue()))},add:function(e){return new this.constructor(t.add(this.getValue(),e.getValue()))},distance:function(t){return this.getValue().distance(t.getValue())},divide:function(e){return new this.constructor(t.divide(this.getValue(),e))},divVec:function(e){return new this.constructor(t.divVec(this.getValue(),e.getValue()))},dot:function(t){return this.getValue().dot(t.getValue())},inverse:function(){return new this.constructor(t.inverse(this.getValue()))},length:function(){return this.getValue().magnitude()},lerp:function(e,n){return new this.constructor(t.lerp(this.getValue(),e,n))},max:function(e){return new this.constructor(t.max(this.getValue(),e.getValue()))},min:function(e){return new this.constructor(t.min(this.getValue(),e.getValue()))},multiply:function(e){return new this.constructor(t.multiply(this.getValue(),e))},multVec:function(e){return new this.constructor(t.multVec(this.getValue(),e.getValue()))},negate:function(){return new this.constructor(t.negate(this.getValue()))},normalize:function(e){return new this.constructor(t.normalize(this.getValue()))},subtract:function(e){return new this.constructor(t.subtract(this.getValue(),e.getValue()))},toStream:function(t){const n=s.Get(t),i=this.getValue(),o=n.Unit(this.getUnit()),r=i.length-1;for(let s=0;s<r;++s)t.string+=e?n.DoublePrecision(n.ToUnit(o,i[s])):n.Precision(n.ToUnit(o,i[s])),t.string+=" ";t.string+=e?n.DoublePrecision(n.ToUnit(o,i[r])):n.Precision(n.ToUnit(o,i[r]))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)}})}function zt(t,e){this.x=t,this.y=e}zt.prototype={constructor:zt,length:2,[Symbol.iterator]:function*(){yield this.x,yield this.y},copy:function(){const t=Object.create(zt.prototype);return t.x=this.x,t.y=this.y,t},assign:function(t){return this.x=t.x,this.y=t.y,this},set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this.x===t.x&&this.y===t.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},multiply:function(t){return this.x*=t,this.y*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this},divide:function(t){return this.x/=t,this.y/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this},normalize:function(){const t=Math.hypot(this.x,this.y);return t&&(this.x/=t,this.y/=t),this},dot:function(t){return this.x*t.x+this.y*t.y},norm:function(){const t=this.x,e=this.y;return t*t+e*e},magnitude:function(){return Math.hypot(this.x,this.y)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y)},lerp:function(t,e){const n=this.x,i=this.y;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},min:function(t){let e=this.x,n=this.y;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y);return this.x=e,this.y=n,this},max:function(t){let e=this.x,n=this.y;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y);return this.x=e,this.y=n,this},toString:function(){return this.x+" "+this.y}},Object.defineProperty(zt.prototype,"0",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!1,configurable:!1}),Object.defineProperty(zt.prototype,"1",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!1,configurable:!1}),Object.assign(zt,{Zero:new zt(0,0),One:new zt(1,1),xAxis:new zt(1,0),yAxis:new zt(0,1),negate:function(t){return t.copy().negate()},inverse:function(t){return t.copy().inverse()},add:function(t,e){return t.copy().add(e)},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},multVec:function(t,e){return t.copy().multVec(e)},divide:function(t,e){return t.copy().divide(e)},divVec:function(t,e){return t.copy().divVec(e)},normalize:function(t){return t.copy().normalize()},dot:function(t,e){return t.dot(e)},magnitude:function(t){return t.magnitude()},distance:function(t,e){return t.distance(e)},lerp:function(t,e,n){return t.copy().lerp(e,n)},abs:function(t){return t.copy().abs()},min:function(t,e){return this.prototype.min.apply(t.copy(),arguments)},max:function(t,e){return this.prototype.max.apply(t.copy(),arguments)}});const jt=zt;function kt(t,e,n){function i(t,e){switch(arguments.length){case 0:return R.call(this,new jt(0,0));case 1:return R.call(this,arguments[0]);case 2:return R.call(this,new jt(+t,+e))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(R.prototype),Ut(jt,n),{constructor:i,getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),o.enumerable=!1,r.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),i}const Gt={SFVec2d:kt("SFVec2d",o.SFVec2d,!0),SFVec2f:kt("SFVec2f",o.SFVec2f,!1)};function Ht(t,e,n){this.x=t,this.y=e,this.z=n}Ht.prototype={constructor:Ht,length:3,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z},copy:function(){const t=Object.create(Ht.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},cross:function(t){const e=this.x,n=this.y,i=this.z,o=t.x,r=t.y,s=t.z;return this.x=n*s-i*r,this.y=i*o-e*s,this.z=e*r-n*o,this},normalize:function(){const t=Math.hypot(this.x,this.y,this.z);return t&&(this.x/=t,this.y/=t,this.z/=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},norm:function(){let t=this.x,e=this.y,n=this.z;return t*t+e*e+n*n},magnitude:function(){return Math.hypot(this.x,this.y,this.z)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)},lerp:function(t,e){const n=this.x,i=this.y,o=this.z;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=o+e*(t.z-o),this},slerp:function(){const t=new Ht(0,0,0);return function(e,n){return et.simpleSlerp(this,t.assign(e),n)}}(),abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},min:function(t){let e=this.x,n=this.y,i=this.z;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y),i=Math.min(i,t.z);return this.x=e,this.y=n,this.z=i,this},max:function(t){let e=this.x,n=this.y,i=this.z;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y),i=Math.max(i,t.z);return this.x=e,this.y=n,this.z=i,this},toString:function(){return this.x+" "+this.y+" "+this.z}},Object.defineProperty(Ht.prototype,"0",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!1,configurable:!1}),Object.defineProperty(Ht.prototype,"1",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!1,configurable:!1}),Object.defineProperty(Ht.prototype,"2",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!1,configurable:!1}),Object.assign(Ht,{Zero:new Ht(0,0,0),One:new Ht(1,1,1),xAxis:new Ht(1,0,0),yAxis:new Ht(0,1,0),zAxis:new Ht(0,0,1),negate:function(t){return t.copy().negate()},inverse:function(t){return t.copy().inverse()},add:function(t,e){return t.copy().add(e)},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},multVec:function(t,e){return t.copy().multVec(e)},divide:function(t,e){return t.copy().divide(e)},divVec:function(t,e){return t.copy().divVec(e)},cross:function(t,e){return t.copy().cross(e)},normalize:function(t){return t.copy().normalize()},dot:function(t,e){return t.dot(e)},magnitude:function(t){return t.magnitude()},distance:function(t,e){return t.distance(e)},lerp:function(t,e,n){return t.copy().lerp(e,n)},slerp:function(t,e,n){return t.copy().slerp(e,n)},abs:function(t){return t.copy().abs()},min:function(t,e){return this.prototype.min.apply(t.copy(),arguments)},max:function(t,e){return this.prototype.max.apply(t.copy(),arguments)}});const qt=Ht;function Yt(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3]):this.identity()}Yt.prototype={constructor:Yt,order:2,length:4,[Symbol.iterator]:function*(){const t=this.length;for(let e=0;e<t;++e)yield this[e]},copy:function(){const t=Object.create(Yt.prototype);return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[3],t},assign:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]},set1:function(t,e,n){this[t*this.order+e]=n},get1:function(t,e){return this[t*this.order+e]},set:function(){switch(arguments.length){case 0:this.identity();break;case 4:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3]}return this},determinant1:function(){return this[0]},determinant:function(){return this[0]*this[3]-this[1]*this[2]},transpose:function(){const t=this[1];return this[1]=this[2],this[2]=t,this},inverse:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=t*i-e*n;return this[0]=i/o,this[1]=-e/o,this[2]=-n/o,this[3]=t/o,this},multLeft:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=t[0],s=t[1],a=t[2],u=t[3];return this[0]=e*r+i*s,this[1]=n*r+o*s,this[2]=e*a+i*u,this[3]=n*a+o*u,this},multRight:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=t[0],s=t[1],a=t[2],u=t[3];return this[0]=r*e+a*n,this[1]=s*e+u*n,this[2]=r*i+a*o,this[3]=s*i+u*o,this},multVecMatrix:function(t){if("number"==typeof t){const e=t,n=e*this[2]+this[3];return(e*this[0]+this[1])/n}const e=t.x,n=t.y;return t.x=e*this[0]+n*this[2],t.y=e*this[1]+n*this[3],t},multMatrixVec:function(t){if("number"==typeof t){const e=t,n=e*this[2]+this[3];return(e*this[0]+this[1])/n}const e=t.x,n=t.y;return t.x=e*this[0]+n*this[1],t.y=e*this[2]+n*this[3],t},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=1},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]}},Object.defineProperty(Yt.prototype,"x",{get:function(){const t=new jt(0,0);return function(){return t.set(this[0],this[1])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Yt.prototype,"y",{get:function(){const t=new jt(0,0);return function(){return t.set(this[2],this[3])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Yt.prototype,"xAxis",{get:function(){return this[0]},enumerable:!1,configurable:!1}),Object.defineProperty(Yt.prototype,"origin",{get:function(){return this[2]},enumerable:!1,configurable:!1}),Object.defineProperty(Yt.prototype,"submatrix",{get:function(){return this[0]},enumerable:!1,configurable:!1}),Object.assign(Yt,{Identity:new Yt});const Wt=Yt,$t=[],Kt=[],Qt=[];function Zt(t,e){const n=t.order,i=e.values,o=e.vectors;let r,s,a,u,c,l,h,d,f,p,g,m,_,x=t.length;for(m=0;m<n;++m)for($t[m]=$t[m]||new Array(n),Kt[m]=i[m]=t.get1(m,m),Qt[m]=0,_=0;_<n;++_)o[m][_]=m===_?1:0,$t[m][_]=t.get1(_,m);for(m=0;m<50;++m){for(r=0,p=0;p<n-1;++p)for(g=p+1;g<n;++g)r+=Math.abs($t[p][g]);if(0===r)break;for(f=m<3?.2*r/x:0,p=0;p<n-1;++p)for(g=p+1;g<n;++g)if(d=100*Math.abs($t[p][g]),m>3&&Math.abs(i[p])+d===Math.abs(i[p])&&Math.abs(i[g])+d===Math.abs(i[g]))$t[p][g]=0;else if(Math.abs($t[p][g])>f){for(h=i[g]-i[p],Math.abs(h)+d===Math.abs(h)?c=$t[p][g]/h:(s=.5*h/$t[p][g],c=1/(Math.abs(s)+Math.sqrt(1+s*s)),s<0&&(c=-c)),a=1/Math.sqrt(1+c*c),u=c*a,l=u/(1+a),h=c*$t[p][g],Qt[p]-=h,Qt[g]+=h,i[p]-=h,i[g]+=h,$t[p][g]=0,_=0;_<p;++_)d=$t[_][p],h=$t[_][g],$t[_][p]=d-u*(h+d*l),$t[_][g]=h+u*(d-h*l);for(_=p+1;_<g;++_)d=$t[p][_],h=$t[_][g],$t[p][_]=d-u*(h+d*l),$t[_][g]=h+u*(d-h*l);for(_=g+1;_<n;++_)d=$t[p][_],h=$t[g][_],$t[p][_]=d-u*(h+d*l),$t[g][_]=h+u*(d-h*l);for(_=0;_<n;++_)d=o[_][p],h=o[_][g],o[_][p]=d-u*(h+d*l),o[_][g]=h+u*(d-h*l)}for(p=0;p<n;++p)i[p]=Kt[p]+=Qt[p],Qt[p]=0}return e}function Jt(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8]):this.identity()}Jt.prototype={constructor:Jt,order:3,length:9,[Symbol.iterator]:function*(){const t=this.length;for(let e=0;e<t;++e)yield this[e]},copy:function(){const t=Object.create(Jt.prototype);return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[3],t[4]=this[4],t[5]=this[5],t[6]=this[6],t[7]=this[7],t[8]=this[8],t},assign:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]&&this[4]===t[4]&&this[5]===t[5]&&this[6]===t[6]&&this[7]===t[7]&&this[8]===t[8]},rotation:function(){return math.atan2(this[1],this[0])},set1:function(t,e,n){return this[t*this.order+e]=n,this},get1:function(t,e){return this[t*this.order+e]},set:function(){const t=new jt(0,0);return function(e,n,i,o,r){switch(arguments.length){case 0:this.identity();break;case 1:null===e&&(e=jt.Zero),this.identity(),this.translate(e);break;case 2:null===e&&(e=jt.Zero),null===n&&(n=0),this.identity(),this.translate(e),0!==n&&this.rotate(n);break;case 3:null===e&&(e=jt.Zero),null===n&&(n=0),null===i&&(i=jt.One),this.identity(),this.translate(e),0!==n&&this.rotate(n),i.equals(jt.One)||this.scale(i);break;case 4:if(null===e&&(e=jt.Zero),null===n&&(n=0),null===i&&(i=jt.One),null===o&&(o=0),this.identity(),this.translate(e),0!==n&&this.rotate(n),!i.equals(jt.One)){0!==o?(this.rotate(o),this.scale(i),this.rotate(-o)):this.scale(i)}break;case 5:{null===e&&(e=jt.Zero),null===n&&(n=0),null===i&&(i=jt.One),null===o&&(o=0),null===r&&(r=jt.Zero),this.identity(),this.translate(e);const s=!r.equals(jt.Zero);s&&this.translate(r),0!==n&&this.rotate(n),i.equals(jt.One)||(0!==o?(this.rotate(o),this.scale(i),this.rotate(-o)):this.scale(i)),s&&this.translate(t.assign(r).negate());break}case 9:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8]}return this}}(),get:function(){const t=new jt(0,0),e=new qt(0,0,0),n=new jt(0,0),i=new qt(0,0,0),o=new jt(0,0),r=new Wt,s=new Wt,a=new jt(0,0);return function(u,c,l,h,d){switch(null===u&&(u=t),null===c&&(c=e),null===l&&(l=n),null===h&&(h=i),null===d&&(d=o),arguments.length){case 1:u.set(this[6],this[7]);break;case 2:this.factor(u,r,n,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]);break;case 3:this.factor(u,r,l,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]);break;case 4:this.factor(u,r,l,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]),h[0]=s[0],h[1]=s[1],h[2]=Math.atan2(s[1],s[0]);break;case 5:te.set(a.assign(d).negate()),te.multLeft(this),te.translate(d),te.get(u,c,l,h)}}}(),factor:function(){const t=new Wt,e=new Wt,n=new Wt,i={values:[],vectors:[[],[]]};return function(o,r,s,a){o.set(this[6],this[7]);const u=this.submatrix,c=u.determinant()<0?-1:1;n.assign(u).transpose().multLeft(u);const l=Zt(n,i);a.set(l.vectors[0][0],l.vectors[1][0],l.vectors[0][1],l.vectors[1][1]),s.x=c*Math.sqrt(l.values[0]),s.y=c*Math.sqrt(l.values[1]),t[0]=1/s.x,t[3]=1/s.y,r.assign(e.assign(a).transpose().multRight(t).multRight(a).multRight(u))}}(),determinant2:function(){return this[0]*this[4]-this[1]*this[3]},determinant:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8];return t*(o*u-r*a)-e*(i*u-r*s)+n*(i*a-o*s)},transpose:function(){let t;return t=this[1],this[1]=this[3],this[3]=t,t=this[2],this[2]=this[6],this[6]=t,t=this[5],this[5]=this[7],this[7]=t,this},inverse:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],c=t*o,l=t*a,h=i*e,d=i*a,f=s*e,p=s*o;let g=c*u-l*r-h*u+d*n+f*r-p*n;g=1/g;const m=(o*u-a*r)*g,_=-(e*u-a*n)*g,x=(e*r-o*n)*g,y=-(i*u-s*r)*g,w=(t*u-s*n)*g,T=-(t*r-i*n)*g;return this[0]=m,this[1]=_,this[2]=x,this[3]=y,this[4]=w,this[5]=T,this[6]=(d-p)*g,this[7]=-(l-f)*g,this[8]=(c-h)*g,this},multLeft:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],c=this[8],l=t[0],h=t[1],d=t[2],f=t[3],p=t[4],g=t[5],m=t[6],_=t[7],x=t[8];return this[0]=e*l+o*h+a*d,this[1]=n*l+r*h+u*d,this[2]=i*l+s*h+c*d,this[3]=e*f+o*p+a*g,this[4]=n*f+r*p+u*g,this[5]=i*f+s*p+c*g,this[6]=e*m+o*_+a*x,this[7]=n*m+r*_+u*x,this[8]=i*m+s*_+c*x,this},multRight:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],c=this[8],l=t[0],h=t[1],d=t[2],f=t[3],p=t[4],g=t[5],m=t[6],_=t[7],x=t[8];return this[0]=e*l+n*f+i*m,this[1]=e*h+n*p+i*_,this[2]=e*d+n*g+i*x,this[3]=o*l+r*f+s*m,this[4]=o*h+r*p+s*_,this[5]=o*d+r*g+s*x,this[6]=a*l+u*f+c*m,this[7]=a*h+u*p+c*_,this[8]=a*d+u*g+c*x,this},multVecMatrix:function(t){if(2===t.length){const e=t.x,n=t.y,i=e*this[2]+n*this[5]+this[8];return t.x=(e*this[0]+n*this[3]+this[6])/i,t.y=(e*this[1]+n*this[4]+this[7])/i,t}const e=t.x,n=t.y,i=t.z;return t.x=e*this[0]+n*this[3]+i*this[6],t.y=e*this[1]+n*this[4]+i*this[7],t.z=e*this[2]+n*this[5]+i*this[8],t},multMatrixVec:function(t){if(2===t.length){const e=t.x,n=t.y,i=e*this[6]+n*this[7]+this[8];return t.x=(e*this[0]+n*this[1]+this[2])/i,t.y=(e*this[3]+n*this[4]+this[5])/i,t}const e=t.x,n=t.y,i=t.z;return t.x=e*this[0]+n*this[1]+i*this[2],t.y=e*this[3]+n*this[4]+i*this[5],t.z=e*this[6]+n*this[7]+i*this[8],t},multDirMatrix:function(t){const e=t.x,n=t.y;return t.x=e*this[0]+n*this[3],t.y=e*this[1]+n*this[4],t},multMatrixDir:function(t){const e=t.x,n=t.y;return t.x=e*this[0]+n*this[1],t.y=e*this[3]+n*this[4],t},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this[6]=0,this[7]=0,this[8]=1},translate:function(t){const e=t.x,n=t.y;return this[6]+=this[0]*e+this[3]*n,this[7]+=this[1]*e+this[4]*n,this},rotate:function(t){return this.multLeft(Jt.Rotation(t)),this},scale:function(t){const e=t.x,n=t.y;return this[0]*=e,this[3]*=n,this[1]*=e,this[4]*=n,this},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]+" "+this[4]+" "+this[5]+" "+this[6]+" "+this[7]+" "+this[8]}},Object.defineProperty(Jt.prototype,"x",{get:function(){const t=new qt(0,0,0);return function(){return t.set(this[0],this[1],this[2])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Jt.prototype,"y",{get:function(){const t=new qt(0,0,0);return function(){return t.set(this[3],this[4],this[5])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Jt.prototype,"z",{get:function(){const t=new qt(0,0,0);return function(){return t.set(this[6],this[7],this[8])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Jt.prototype,"xAxis",{get:function(){const t=new jt(0,0);return function(){return t.set(this[0],this[1])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Jt.prototype,"yAxis",{get:function(){const t=new jt(0,0);return function(){return t.set(this[3],this[4])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Jt.prototype,"origin",{get:function(){const t=new jt(0,0);return function(){return t.set(this[6],this[7])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Jt.prototype,"submatrix",{get:function(){const t=new Wt;return function(){return t[0]=this[0],t[1]=this[1],t[2]=this[3],t[3]=this[4],t}}(),enumerable:!1,configurable:!1}),Object.assign(Jt,{Identity:new Jt,Rotation:function(t){const e=Math.sin(t),n=Math.cos(t);return new Jt(n,e,0,-e,n,0,0,0,1)},Matrix2:function(t){return new Jt(t[0],t[1],0,t[2],t[3],0,0,0,1)},transpose:function(t){return t.copy().transpose()},inverse:function(t){return t.copy().inverse()},multLeft:function(t,e){return t.copy().multLeft(e)},multRight:function(t,e){return t.copy().multRight(e)}});const te=new Jt,ee=Jt;function ne(t,e,n,i){function o(t,e,n,i,o,r,s,a,u){switch(arguments.length){case 0:return R.call(this,new ee);case 1:return R.call(this,arguments[0]);case 9:return R.call(this,new ee(+t,+e,+n,+i,+o,+r,+s,+a,+u))}throw new Error("Invalid arguments.")}o.prototype=Object.assign(Object.create(R.prototype),Xt(ee,n,i),{constructor:o,getTypeName:function(){return t},getType:function(){return e},setTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e||0,n=n?n.getValue():null,i=i||0,o=o?o.getValue():null,this.getValue().set(t,e,n,i,o)}});for(const t of Reflect.ownKeys(o.prototype))Object.defineProperty(o.prototype,t,{enumerable:!1});function r(t){Object.defineProperty(o.prototype,t,{get:function(){return this.getValue()[t]},set:function(e){this.getValue()[t]=+e,this.addEvent()},enumerable:!0,configurable:!1})}for(let t=0,e=ee.prototype.length;t<e;++t)r(t);return o}const ie={SFMatrix3d:ne("SFMatrix3d",o.SFMatrix3d,Gt.SFVec2d,!0),SFMatrix3f:ne("SFMatrix3f",o.SFMatrix3f,Gt.SFVec2f,!1)};function oe(t,e,n){function i(t,e,n){switch(arguments.length){case 0:return R.call(this,new qt(0,0,0));case 1:return R.call(this,arguments[0]);case 3:return R.call(this,new qt(+t,+e,+n))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(R.prototype),Ut(qt,n),{constructor:i,getTypeName:function(){return t},getType:function(){return e},cross:function(t){return new this.constructor(qt.cross(this.getValue(),t.getValue()))}});for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()},enumerable:!0,configurable:!1},s={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),Object.defineProperty(i.prototype,"z",s),o.enumerable=!1,r.enumerable=!1,s.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),Object.defineProperty(i.prototype,"2",s),i}const re={SFVec3d:oe("SFVec3d",o.SFVec3d,!0),SFVec3f:oe("SFVec3f",o.SFVec3f,!1)};function se(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i}se.prototype={constructor:se,length:4,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z,yield this.w},copy:function(){const t=Object.create(se.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},getReal:function(t){t.x=this.x/this.w,t.y=this.y/this.w,t.z=this.z/this.w},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this.w=1/this.w,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},normalize:function(){const t=Math.hypot(this.x,this.y,this.z,this.w);return t&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},norm:function(){const t=this.x,e=this.y,n=this.z,i=this.w;return t*t+e*e+n*n+i*i},magnitude:function(){return Math.hypot(this.x,this.y,this.z,this.w)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},lerp:function(t,e){const n=this.x,i=this.y,o=this.z,r=this.w;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=o+e*(t.z-o),this.w=r+e*(t.w-r),this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},min:function(t){let e=this.x,n=this.y,i=this.z,o=this.w;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y),i=Math.min(i,t.z),o=Math.min(o,t.w);return this.x=e,this.y=n,this.z=i,this.w=o,this},max:function(t){let e=this.x,n=this.y,i=this.z,o=this.w;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y),i=Math.max(i,t.z),o=Math.max(o,t.w);return this.x=e,this.y=n,this.z=i,this.w=o,this},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}},Object.defineProperty(se.prototype,"0",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!1,configurable:!1}),Object.defineProperty(se.prototype,"1",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!1,configurable:!1}),Object.defineProperty(se.prototype,"2",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!1,configurable:!1}),Object.defineProperty(se.prototype,"3",{get:function(){return this.w},set:function(t){this.w=t},enumerable:!1,configurable:!1}),Object.assign(se,{Zero:new se(0,0,0,0),One:new se(1,1,1,1),xAxis:new se(1,0,0,0),yAxis:new se(0,1,0,0),zAxis:new se(0,0,1,0),wAxis:new se(0,0,0,1),negate:function(t){return t.copy().negate()},inverse:function(t){return t.copy().inverse()},add:function(t,e){return t.copy().add(e)},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},multVec:function(t,e){return t.copy().multVec(e)},divide:function(t,e){return t.copy().divide(e)},divVec:function(t,e){return t.copy().divVec(e)},normalize:function(t){return t.copy().normalize()},dot:function(t,e){return t.dot(e)},magnitude:function(t){return t.magnitude()},distance:function(t,e){return t.distance(e)},lerp:function(t,e,n){return t.copy().lerp(e,n)},abs:function(t){return t.copy().abs()},min:function(t,e){return this.prototype.min.apply(t.copy(),arguments)},max:function(t,e){return this.prototype.max.apply(t.copy(),arguments)}});const ae=se;function ue(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i}ue.prototype={constructor:ue,length:4,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z,yield this.w},copy:function(){const t=Object.create(ue.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},setMatrix:function(t){let e;e=t[0]>t[4]?t[0]>t[8]?0:2:t[4]>t[8]?1:2;const n=t[0]+t[4]+t[8];if(n>t[3*e+e]){this[3]=Math.sqrt(n+1)/2;const e=4*this[3];this[0]=(t[5]-t[7])/e,this[1]=(t[6]-t[2])/e,this[2]=(t[1]-t[3])/e}else{const n=(e+1)%3,i=(e+2)%3;this[e]=Math.sqrt(t[3*e+e]-t[3*n+n]-t[3*i+i]+1)/2;const o=4*this[e];this[n]=(t[3*e+n]+t[3*n+e])/o,this[i]=(t[3*e+i]+t[3*i+e])/o,this[3]=(t[3*n+i]-t[3*i+n])/o}return this},getMatrix:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=e*e,s=e*n,a=n*n,u=n*i,c=i*e,l=i*i,h=o*e,d=o*n,f=o*i;return t[0]=1-2*(a+l),t[1]=2*(s+f),t[2]=2*(c-d),t[3]=2*(s-f),t[4]=1-2*(l+r),t[5]=2*(u+h),t[6]=2*(c+d),t[7]=2*(u-h),t[8]=1-2*(a+r),t},isReal:function(){return!(this.x||this.y||this.z)},isImag:function(){return!this.w},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},multLeft:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=t.x,s=t.y,a=t.z,u=t.w;return this.x=o*r+e*u+n*a-i*s,this.y=o*s+n*u+i*r-e*a,this.z=o*a+i*u+e*s-n*r,this.w=o*u-e*r-n*s-i*a,this},multRight:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=t.x,s=t.y,a=t.z,u=t.w;return this.x=u*e+r*o+s*i-a*n,this.y=u*n+s*o+a*e-r*i,this.z=u*i+a*o+r*n-s*e,this.w=u*o-r*e-s*n-a*i,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},multVecQuat:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=t.x,s=t.y,a=t.z,u=o*o-e*e-n*n-i*i,c=2*(r*e+s*n+a*i),l=2*o;return t.x=u*r+c*e+l*(n*a-i*s),t.y=u*s+c*n+l*(i*r-e*a),t.z=u*a+c*i+l*(e*s-n*r),t},multQuatVec:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=t.x,s=t.y,a=t.z,u=o*o-e*e-n*n-i*i,c=2*(r*e+s*n+a*i),l=2*o;return t.x=u*r+c*e-l*(n*a-i*s),t.y=u*s+c*n-l*(i*r-e*a),t.z=u*a+c*i-l*(e*s-n*r),t},normalize:function(){let t=Math.hypot(this.x,this.y,this.z,this.w);return t&&(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},norm:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},magnitude:function(){return Math.hypot(this.x,this.y,this.z,this.w)},pow:function(t){if(t instanceof ue)return this.assign(e.assign(t).multRight(this.log()).exp());if(this.isReal())return this.set(0,0,0,Math.pow(this.w,t));const n=this.magnitude(),i=Math.acos(this.w/n),o=this.imag.magnitude(),r=Math.pow(n,t),s=t*i,a=r/o*Math.sin(s);return this.x*=a,this.y*=a,this.z*=a,this.w=r*Math.cos(s),this},log:function(){if(this.isReal())return this.w>0?this.set(0,0,0,Math.log(this.w)):this.set(Math.PI,0,0,Math.log(-this.w));const t=this.magnitude(),e=this.imag.normalize().multiply(Math.acos(this.w/t)),n=Math.log(t);return this.x=e.x,this.y=e.y,this.z=e.z,this.w=n,this},exp:function(){if(this.isReal())return this.set(0,0,0,Math.exp(this.w));const t=this.imag,e=t.magnitude(),n=Math.exp(this.w),i=n*Math.cos(e),o=t.multiply(n*Math.sin(e)/e);return this.x=o.x,this.y=o.y,this.z=o.z,this.w=i,this},slerp:function(t,e){return et.slerp(this,ce.assign(t),e)},squad:function(t,e,n,i){return et.slerp(et.slerp(this,ce.assign(n),i),et.slerp(le.assign(t),he.assign(e),i),2*i*(1-i))},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}},Object.defineProperty(ue.prototype,"0",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!1,configurable:!1}),Object.defineProperty(ue.prototype,"1",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!1,configurable:!1}),Object.defineProperty(ue.prototype,"2",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!1,configurable:!1}),Object.defineProperty(ue.prototype,"3",{get:function(){return this.w},set:function(t){this.w=t},enumerable:!1,configurable:!1}),Object.defineProperty(ue.prototype,"real",{get:function(){return this.w},enumerable:!1,configurable:!1}),Object.defineProperty(ue.prototype,"imag",{get:function(){const t=new qt(0,0,0);return function(){return t.set(this.x,this.y,this.z)}}(),enumerable:!1,configurable:!1}),Object.assign(ue,{negate:function(t){return t.copy().negate()},inverse:function(t){return t.copy().inverse()},add:function(t,e){return t.copy().add(e)},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},multLeft:function(t,e){return t.copy().multLeft(e)},multRight:function(t,e){return t.copy().multRight(e)},divide:function(t,e){return t.copy().divide(e)},normalize:function(t){return t.copy().normalize()},slerp:function(t,e,n){return t.copy().slerp(e,n)},squad:function(t,e,n,i,o){return t.copy().squad(e,n,i,o)},spline:function(t,e,n){return de.assign(t),fe.assign(e),pe.assign(n),de.dot(fe)<0&&de.negate(),pe.dot(fe)<0&&pe.negate(),ge.assign(fe).inverse(),fe.multRight(ce.assign(ge).multRight(de).log().add(le.assign(ge).multRight(pe).log()).divide(-4).exp()).normalize().copy()}});const ce=new ue(0,0,0,1),le=new ue(0,0,0,1),he=new ue(0,0,0,1),de=new ue(0,0,0,1),fe=new ue(0,0,0,1),pe=new ue(0,0,0,1),ge=new ue(0,0,0,1),me=ue,_e=Symbol(),xe=Symbol(),ye=Symbol(),we=Symbol();function Te(t,e,n,i){switch(this[_e]=0,this[xe]=0,this[ye]=1,this[we]=0,arguments.length){case 0:return void(this.value=new me(0,0,0,1));case 1:return this.value=arguments[0],void this.update();case 2:{const t=arguments[0],e=arguments[1];return this.value=new me(0,0,0,1),e instanceof qt?this.setFromToVec(t,e):void this.set(t.x,t.y,t.z,e)}case 4:return this.value=new me(0,0,0,1),void this.set(t,e,n,i)}}Te.prototype={constructor:Te,length:4,[Symbol.iterator]:function*(){yield this[_e],yield this[xe],yield this[ye],yield this[we]},update:function(){const t=this.get();return this[_e]=t.x,this[xe]=t.y,this[ye]=t.z,this[we]=t.w,this},copy:function(){const t=Object.create(Te.prototype);return t[_e]=this[_e],t[xe]=this[xe],t[ye]=this[ye],t[we]=this[we],t.value=this.value.copy(),t},assign:function(t){return this[_e]=t[_e],this[xe]=t[xe],this[ye]=t[ye],this[we]=t[we],this.value.assign(t.value),this},set:function(t,e,n,i){this[_e]=t,this[xe]=e,this[ye]=n,this[we]=i;const o=Math.hypot(t,e,n);if(0===o)return this.value.set(0,0,0,1),this;const r=et.interval(i/2,0,Math.PI),s=Math.sin(r)/o;return this.value.set(t*s,e*s,n*s,Math.cos(r)),this},get:function(){const t=new ae(0,0,0,0);return function(){const e=this.value;if(Math.abs(e.w)>1)return ae.zAxis;{const n=2*Math.acos(e.w),i=Math.sin(n/2);if(0===i)return ae.zAxis;{const o=e.imag.divide(i);return t.set(o.x,o.y,o.z,n)}}}}(),setAxisAngle:function(t,e){return this.set(t.x,t.y,t.z,e)},setFromToVec:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0);return function(o,r){t.assign(o).normalize(),e.assign(r).normalize();const s=et.clamp(t.dot(e),-1,1),a=n.assign(t).cross(e).normalize();return 0===a.magnitude()?s>0?this.value.set(0,0,0,1):(i.assign(t).cross(qt.xAxis),0===i.norm()&&i.assign(t).cross(qt.yAxis),i.normalize(),this.value.set(i.x,i.y,i.z,0)):(a.multiply(Math.sqrt(Math.abs(1-s)/2)),this.value.set(a.x,a.y,a.z,Math.sqrt(Math.abs(1+s)/2))),this.update(),this}}(),setAxis:function(t){this.set(t.x,t.y,t.z,this[we])},getAxis:function(){const t=new qt(0,0,0);return function(){return t.set(this[_e],this[xe],this[ye])}}(),setMatrix:function(t){return this.value.setMatrix(t).normalize(),this.update(),this},getMatrix:function(t){return this.value.getMatrix(t)},equals:function(t){return this.value.equals(t.value)},inverse:function(){return this.value.inverse(),this.update(),this},multLeft:function(t){return this.value.multLeft(t.value).normalize(),this.update(),this},multRight:function(t){return this.value.multRight(t.value).normalize(),this.update(),this},multVecRot:function(t){return this.value.multVecQuat(t)},multRotVec:function(t){return this.value.multQuatVec(t)},normalize:function(){return this.value.normalize(),this.update(),this},pow:function(t){return this.value.pow(t),this.update(),this},slerp:function(t,e){return this.value.slerp(t.value,e),this.update(),this},squad:function(t,e,n,i){return this.value.squad(t.value,e.value,n.value,i),this.update(),this},toString:function(){return this[_e]+" "+this[xe]+" "+this[ye]+" "+this[we]}};const Se={get:function(){return this[_e]},set:function(t){this[_e]=t,this.set(t,this[xe],this[ye],this[we])},enumerable:!0,configurable:!1},be={get:function(){return this[xe]},set:function(t){this[xe]=t,this.set(this[_e],t,this[ye],this[we])},enumerable:!0,configurable:!1},ve={get:function(){return this[ye]},set:function(t){this[ye]=t,this.set(this[_e],this[xe],t,this[we])},enumerable:!0,configurable:!1},Ee={get:function(){return this[we]},set:function(t){this[we]=t,this.set(this[_e],this[xe],this[ye],t)},enumerable:!0,configurable:!1};Object.defineProperty(Te.prototype,"x",Se),Object.defineProperty(Te.prototype,"y",be),Object.defineProperty(Te.prototype,"z",ve),Object.defineProperty(Te.prototype,"angle",Ee),Se.enumerable=!1,be.enumerable=!1,ve.enumerable=!1,Ee.enumerable=!1,Object.defineProperty(Te.prototype,"0",Se),Object.defineProperty(Te.prototype,"1",be),Object.defineProperty(Te.prototype,"2",ve),Object.defineProperty(Te.prototype,"3",Ee),Object.assign(Te,{Identity:new Te,inverse:function(t){return t.copy().inverse()},multRight:function(t,e){return t.copy().multRight(e)},normalize:function(t){return t.copy().normalize()},slerp:function(t,e,n){return t.copy().slerp(e,n)},squad:function(t,e,n,i,o){return t.copy().squad(e,n,i,o)},spline:function(t,e,n){const i=Object.create(this.prototype);return i.value=me.spline(t.value,e.value,n.value),i.update(),i}});const Ce=Te;function Oe(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8],this[9]=arguments[9],this[10]=arguments[10],this[11]=arguments[11],this[12]=arguments[12],this[13]=arguments[13],this[14]=arguments[14],this[15]=arguments[15]):this.identity()}Oe.prototype={constructor:Oe,order:4,length:16,[Symbol.iterator]:function*(){const t=this.length;for(let e=0;e<t;++e)yield this[e]},copy:function(){const t=Object.create(Oe.prototype);return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[3],t[4]=this[4],t[5]=this[5],t[6]=this[6],t[7]=this[7],t[8]=this[8],t[9]=this[9],t[10]=this[10],t[11]=this[11],t[12]=this[12],t[13]=this[13],t[14]=this[14],t[15]=this[15],t},assign:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]&&this[4]===t[4]&&this[5]===t[5]&&this[6]===t[6]&&this[7]===t[7]&&this[8]===t[8]&&this[9]===t[9]&&this[10]===t[10]&&this[11]===t[11]&&this[12]===t[12]&&this[13]===t[13]&&this[14]===t[14]&&this[15]===t[15]},set1:function(t,e,n){return this[t*this.order+e]=n,this},get1:function(t,e){return this[t*this.order+e]},set:function(){const t=new Ce,e=new qt(0,0,0);return function(n,i,o,r,s){switch(arguments.length){case 0:this.identity();break;case 1:null===n&&(n=qt.Zero),this.identity(),this.translate(n);break;case 2:null===n&&(n=qt.Zero),null===i&&(i=Ce.Identity),this.identity(),this.translate(n),i.equals(Ce.Identity)||this.rotate(i);break;case 3:null===n&&(n=qt.Zero),null===i&&(i=Ce.Identity),null===o&&(o=qt.One),this.identity(),this.translate(n),i.equals(Ce.Identity)||this.rotate(i),o.equals(qt.One)||this.scale(o);break;case 4:if(null===n&&(n=qt.Zero),null===i&&(i=Ce.Identity),null===o&&(o=qt.One),null===r&&(r=Ce.Identity),this.identity(),this.translate(n),i.equals(Ce.Identity)||this.rotate(i),!o.equals(qt.One)){!r.equals(Ce.Identity)?(this.rotate(r),this.scale(o),this.rotate(t.assign(r).inverse())):this.scale(o)}break;case 5:{null===n&&(n=qt.Zero),null===i&&(i=Ce.Identity),null===o&&(o=qt.One),null===r&&(r=Ce.Identity),null===s&&(s=qt.Zero),this.identity(),this.translate(n);const a=!s.equals(qt.Zero);a&&this.translate(s),i.equals(Ce.Identity)||this.rotate(i),o.equals(qt.One)||(r.equals(Ce.Identity)?this.scale(o):(this.rotate(r),this.scale(o),this.rotate(t.assign(r).inverse()))),a&&this.translate(e.assign(s).negate());break}case 16:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8],this[9]=arguments[9],this[10]=arguments[10],this[11]=arguments[11],this[12]=arguments[12],this[13]=arguments[13],this[14]=arguments[14],this[15]=arguments[15]}return this}}(),get:function(){const t=new qt(0,0,0),e=new Ce,n=new qt(0,0,0),i=new Ce,o=new qt(0,0,0),r=new ee,s=new ee,a=new qt(0,0,0);return function(u,c,l,h,d){switch(null===u&&(u=t),null===c&&(c=e),null===l&&(l=n),null===h&&(h=i),null===d&&(d=o),arguments.length){case 1:u.set(this[12],this[13],this[14]);break;case 2:this.factor(u,r,n,s),c.setMatrix(r);break;case 3:this.factor(u,r,l,s),c.setMatrix(r);break;case 4:this.factor(u,r,l,s),c.setMatrix(r),h.setMatrix(s);break;case 5:Fe.set(a.assign(d).negate()),Fe.multLeft(this),Fe.translate(d),Fe.get(u,c,l,h)}}}(),setRotation:function(t){return this.setQuaternion(t.value)},setQuaternion:function(t){const e=t.x,n=t.y,i=t.z,o=t.w,r=n*n,s=i*i,a=e*n,u=i*o,c=i*e,l=n*o,h=e*e,d=n*i,f=e*o;return this[0]=1-2*(r+s),this[1]=2*(a+u),this[2]=2*(c-l),this[3]=0,this[4]=2*(a-u),this[5]=1-2*(s+h),this[6]=2*(d+f),this[7]=0,this[8]=2*(c+l),this[9]=2*(d-f),this[10]=1-2*(r+h),this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},factor:function(){const t=new ee,e=new ee,n=new ee,i={values:[],vectors:[[],[],[]]};return function(o,r,s,a){o.set(this[12],this[13],this[14]);const u=this.submatrix,c=u.determinant()<0?-1:1;n.assign(u).transpose().multLeft(u);const l=Zt(n,i);a.set(l.vectors[0][0],l.vectors[1][0],l.vectors[2][0],l.vectors[0][1],l.vectors[1][1],l.vectors[2][1],l.vectors[0][2],l.vectors[1][2],l.vectors[2][2]),s.x=c*Math.sqrt(l.values[0]),s.y=c*Math.sqrt(l.values[1]),s.z=c*Math.sqrt(l.values[2]),t[0]=1/s.x,t[4]=1/s.y,t[8]=1/s.z,r.assign(e.assign(a).transpose().multRight(t).multRight(a).multRight(u))}}(),determinant3:function(){const t=this[0],e=this[1],n=this[2],i=this[4],o=this[5],r=this[6],s=this[8],a=this[9],u=this[10];return t*(o*u-r*a)-e*(i*u-r*s)+n*(i*a-o*s)},determinant:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],c=this[9],l=this[10],h=this[11],d=this[12],f=this[13],p=this[14],g=this[15],m=l*g,_=p*h,x=s*g,y=p*a,w=s*h,T=l*a,S=n*g,b=p*i,v=n*h,E=l*i,C=n*a,O=s*i;return t*(m*r+y*c+w*f-_*r-x*c-T*f)+o*(_*e+S*c+E*f-m*e-b*c-v*f)+u*(x*e+b*r+C*f-y*e-S*r-O*f)+d*(T*e+v*r+O*c-w*e-E*r-C*c)},transpose:function(){let t;return t=this[1],this[1]=this[4],this[4]=t,t=this[2],this[2]=this[8],this[8]=t,t=this[3],this[3]=this[12],this[12]=t,t=this[6],this[6]=this[9],this[9]=t,t=this[7],this[7]=this[13],this[13]=t,t=this[11],this[11]=this[14],this[14]=t,this},inverse:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],c=this[9],l=this[10],h=this[11],d=this[12],f=this[13],p=this[14],g=this[15],m=l*g,_=p*h,x=s*g,y=p*a,w=s*h,T=l*a,S=n*g,b=p*i,v=n*h,E=l*i,C=n*a,O=s*i,F=u*f,N=d*c,M=o*f,V=d*r,I=o*c,D=u*r,R=t*f,P=d*e,A=t*c,L=u*e,B=t*r,X=o*e,U=m*r+y*c+w*f-(_*r+x*c+T*f),z=_*e+S*c+E*f-(m*e+b*c+v*f),j=x*e+b*r+C*f-(y*e+S*r+O*f),k=T*e+v*r+O*c-(w*e+E*r+C*c);let G=t*U+o*z+u*j+d*k;return G=1/G,this[0]=G*U,this[1]=G*z,this[2]=G*j,this[3]=G*k,this[4]=G*(_*o+x*u+T*d-m*o-y*u-w*d),this[5]=G*(m*t+b*u+v*d-_*t-S*u-E*d),this[6]=G*(y*t+S*o+O*d-x*t-b*o-C*d),this[7]=G*(w*t+E*o+C*u-T*t-v*o-O*u),this[8]=G*(F*a+V*h+I*g-N*a-M*h-D*g),this[9]=G*(N*i+R*h+L*g-F*i-P*h-A*g),this[10]=G*(M*i+P*a+B*g-V*i-R*a-X*g),this[11]=G*(D*i+A*a+X*h-I*i-L*a-B*h),this[12]=G*(M*l+D*p+N*s-I*p-F*s-V*l),this[13]=G*(A*p+F*n+P*l-R*l-L*p-N*n),this[14]=G*(R*s+X*p+V*n-B*p-M*n-P*s),this[15]=G*(B*l+I*n+L*s-A*s-X*l-D*n),this},multLeft:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],c=this[8],l=this[9],h=this[10],d=this[11],f=this[12],p=this[13],g=this[14],m=this[15],_=t[0],x=t[1],y=t[2],w=t[3],T=t[4],S=t[5],b=t[6],v=t[7],E=t[8],C=t[9],O=t[10],F=t[11],N=t[12],M=t[13],V=t[14],I=t[15];return this[0]=e*_+r*x+c*y+f*w,this[1]=n*_+s*x+l*y+p*w,this[2]=i*_+a*x+h*y+g*w,this[3]=o*_+u*x+d*y+m*w,this[4]=e*T+r*S+c*b+f*v,this[5]=n*T+s*S+l*b+p*v,this[6]=i*T+a*S+h*b+g*v,this[7]=o*T+u*S+d*b+m*v,this[8]=e*E+r*C+c*O+f*F,this[9]=n*E+s*C+l*O+p*F,this[10]=i*E+a*C+h*O+g*F,this[11]=o*E+u*C+d*O+m*F,this[12]=e*N+r*M+c*V+f*I,this[13]=n*N+s*M+l*V+p*I,this[14]=i*N+a*M+h*V+g*I,this[15]=o*N+u*M+d*V+m*I,this},multRight:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],c=this[8],l=this[9],h=this[10],d=this[11],f=this[12],p=this[13],g=this[14],m=this[15],_=t[0],x=t[1],y=t[2],w=t[3],T=t[4],S=t[5],b=t[6],v=t[7],E=t[8],C=t[9],O=t[10],F=t[11],N=t[12],M=t[13],V=t[14],I=t[15];return this[0]=e*_+n*T+i*E+o*N,this[1]=e*x+n*S+i*C+o*M,this[2]=e*y+n*b+i*O+o*V,this[3]=e*w+n*v+i*F+o*I,this[4]=r*_+s*T+a*E+u*N,this[5]=r*x+s*S+a*C+u*M,this[6]=r*y+s*b+a*O+u*V,this[7]=r*w+s*v+a*F+u*I,this[8]=c*_+l*T+h*E+d*N,this[9]=c*x+l*S+h*C+d*M,this[10]=c*y+l*b+h*O+d*V,this[11]=c*w+l*v+h*F+d*I,this[12]=f*_+p*T+g*E+m*N,this[13]=f*x+p*S+g*C+m*M,this[14]=f*y+p*b+g*O+m*V,this[15]=f*w+p*v+g*F+m*I,this},multVecMatrix:function(t){if(3===t.length){const e=t.x,n=t.y,i=t.z,o=1/(e*this[3]+n*this[7]+i*this[11]+this[15]);return t.x=(e*this[0]+n*this[4]+i*this[8]+this[12])*o,t.y=(e*this[1]+n*this[5]+i*this[9]+this[13])*o,t.z=(e*this[2]+n*this[6]+i*this[10]+this[14])*o,t}const e=t.x,n=t.y,i=t.z,o=t.w;return t.x=e*this[0]+n*this[4]+i*this[8]+o*this[12],t.y=e*this[1]+n*this[5]+i*this[9]+o*this[13],t.z=e*this[2]+n*this[6]+i*this[10]+o*this[14],t.w=e*this[3]+n*this[7]+i*this[11]+o*this[15],t},multMatrixVec:function(t){if(3===t.length){const e=t.x,n=t.y,i=t.z,o=1/(e*this[12]+n*this[13]+i*this[14]+this[15]);return t.x=(e*this[0]+n*this[1]+i*this[2]+this[3])*o,t.y=(e*this[4]+n*this[5]+i*this[6]+this[7])*o,t.z=(e*this[8]+n*this[9]+i*this[10]+this[11])*o,t}const e=t.x,n=t.y,i=t.z,o=t.w;return t.x=e*this[0]+n*this[1]+i*this[2]+o*this[3],t.y=e*this[4]+n*this[5]+i*this[6]+o*this[7],t.z=e*this[8]+n*this[9]+i*this[10]+o*this[11],t.w=e*this[12]+n*this[13]+i*this[14]+o*this[15],t},multDirMatrix:function(t){const e=t.x,n=t.y,i=t.z;return t.x=e*this[0]+n*this[4]+i*this[8],t.y=e*this[1]+n*this[5]+i*this[9],t.z=e*this[2]+n*this[6]+i*this[10],t},multMatrixDir:function(t){const e=t.x,n=t.y,i=t.z;return t.x=e*this[0]+n*this[1]+i*this[2],t.y=e*this[4]+n*this[5]+i*this[6],t.z=e*this[8]+n*this[9]+i*this[10],t},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1},translate:function(t){const e=t.x,n=t.y,i=t.z;return this[12]+=this[0]*e+this[4]*n+this[8]*i,this[13]+=this[1]*e+this[5]*n+this[9]*i,this[14]+=this[2]*e+this[6]*n+this[10]*i,this},rotate:function(t){return this.multLeft(Fe.setQuaternion(t.value)),this},scale:function(t){const e=t.x,n=t.y,i=t.z;return this[0]*=e,this[4]*=n,this[8]*=i,this[1]*=e,this[5]*=n,this[9]*=i,this[2]*=e,this[6]*=n,this[10]*=i,this},getDepth:function(t){const e=t.x,n=t.y,i=t.z,o=1/(e*this[3]+n*this[7]+i*this[11]+this[15]);return(e*this[2]+n*this[6]+i*this[10]+this[14])*o},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]+" "+this[4]+" "+this[5]+" "+this[6]+" "+this[7]+" "+this[8]+" "+this[9]+" "+this[10]+" "+this[11]+" "+this[12]+" "+this[13]+" "+this[14]+" "+this[15]}},Object.defineProperty(Oe.prototype,"x",{get:function(){const t=new ae(0,0,0,0);return function(){return t.set(this[0],this[1],this[2],this[3])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"y",{get:function(){const t=new ae(0,0,0,0);return function(){return t.set(this[4],this[5],this[6],this[7])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"z",{get:function(){const t=new ae(0,0,0,0);return function(){return t.set(this[8],this[9],this[10],this[11])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"w",{get:function(){const t=new ae(0,0,0,0);return function(){return t.set(this[12],this[13],this[14],this[15])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"xAxis",{get:function(){const t=new qt(0,0,0);return function(){return t.set(this[0],this[1],this[2])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"yAxis",{get:function(){const t=new qt(0,0,0);return function(){return t.set(this[4],this[5],this[6])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"zAxis",{get:function(){const t=new qt(0,0,0);return function(){return t.set(this[8],this[9],this[10])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"origin",{get:function(){const t=new qt(0,0,0);return function(){return t.set(this[12],this[13],this[14])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"submatrix",{get:function(){const t=new ee;return function(){return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[4],t[4]=this[5],t[5]=this[6],t[6]=this[8],t[7]=this[9],t[8]=this[10],t}}(),enumerable:!1,configurable:!1}),Object.assign(Oe,{Identity:new Oe,Rotation:function(t){return Object.create(this.prototype).setQuaternion(t.value)},Quaternion:function(t){return Object.create(this.prototype).setQuaternion(t)},Matrix3:function(t){return new Oe(t[0],t[1],t[2],0,t[3],t[4],t[5],0,t[6],t[7],t[8],0,0,0,0,1)},transpose:function(t){return t.copy().transpose()},inverse:function(t){return t.copy().inverse()},multLeft:function(t,e){return t.copy().multLeft(e)},multRight:function(t,e){return t.copy().multRight(e)}});const Fe=new Oe,Ne=Oe;function Me(t,e,n,i){function o(t,e,n,i,o,r,s,a,u,c,l,h,d,f,p,g){switch(arguments.length){case 0:return R.call(this,new Ne);case 1:return R.call(this,arguments[0]);case 16:return R.call(this,new Ne(+t,+e,+n,+i,+o,+r,+s,+a,+u,+c,+l,+h,+d,+f,+p,+g))}throw new Error("Invalid arguments.")}o.prototype=Object.assign(Object.create(R.prototype),Xt(Ne,n,i),{constructor:o,getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(o.prototype))Object.defineProperty(o.prototype,t,{enumerable:!1});function r(t){Object.defineProperty(o.prototype,t,{get:function(){return this.getValue()[t]},set:function(e){this.getValue()[t]=e,this.addEvent()},enumerable:!0,configurable:!1})}for(let t=0,e=Ne.prototype.length;t<e;++t)r(t);return o}const Ve={SFMatrix4d:Me("SFMatrix4d",o.SFMatrix4d,re.SFVec3d,!0),SFMatrix4f:Me("SFMatrix4f",o.SFMatrix4f,re.SFVec3f,!1),VrmlMatrix:Me("VrmlMatrix",o.VrmlMatrix,re.SFVec3f,!1)},Ie=new WeakMap;function De(){}De.prototype={get:function(t){const e=Ie.get(t);if(e)return e;{const e=new Ue(t);return Ie.set(t,e),e}}};const Re=new De,Pe=Symbol(),Ae=Symbol(),Le=Symbol(),Be={get:function(t,e){try{const n=t[e];if(void 0!==n)return n;const i=t.getValue().getField(e);if(i.getAccessType()===o.inputOnly)return;return i.valueOf()}catch(t){return}},set:function(t,e,n){if(e in t)return t[e]=n,!0;try{const i=t.getValue().getField(e);return i.getAccessType()!==o.outputOnly&&i.setValue(n),!0}catch(n){return console.error(t,e,n),!1}},has:function(t,e){try{return Boolean(t.getValue().getField(e))}catch(n){return e in t}},ownKeys:function(t){const e=t.getValue(),n=[];if(e)for(const t of e.getFieldDefinitions())n.push(t.name);return n},getOwnPropertyDescriptor:function(t,e){const n=t.getValue();if(n){const i=n.getFieldDefinitions().get(e);if(i)return{value:this.get(t,e),writable:i.accessType!==o.outputOnly,enumerable:!0,configurable:!0}}}};function Xe(t){const e=new Proxy(this,Be);return this[Pe]=this,this[Ae]=e,t?(t.addParent(e),R.call(this,t)):R.call(this,null),e}Xe.prototype=Object.assign(Object.create(R.prototype),{constructor:Xe,[Pe]:null,[Ae]:null,[Le]:0,copy:function(t){const e=this[Pe].getValue();return e?new Xe(t?e.copy(t):e):new Xe},getTypeName:function(){return"SFNode"},getType:function(){return o.SFNode},equals:function(t){const e=this[Pe];return t?e.getValue()===t.getValue():null===e.getValue()},isDefaultValue:function(){return null===this[Pe].getValue()},set:function(t){const e=this[Pe],n=e.getValue();n&&(n.removeCloneCount(e[Le]),n.removeParent(e[Ae])),t?(t.addParent(e[Ae]),t.addCloneCount(e[Le]),R.prototype.set.call(e,t)):R.prototype.set.call(e,null)},getNodeTypeName:function(){const t=this[Pe].getValue();if(t)return t.getTypeName();throw new Error("SFNode.getNodeTypeName: node is null.")},getNodeName:function(){const t=this[Pe].getValue();if(t)return t.getName();throw new Error("SFNode.getNodeName: node is null.")},getNodeDisplayName:function(){const t=this[Pe].getValue();if(t)return t.getDisplayName();throw new Error("SFNode.getNodeDisplayName: node is null.")},getNodeType:function(){const t=this[Pe].getValue();if(t)return t.getType().slice();throw new Error("SFNode.getNodeType: node is null.")},getFieldDefinitions:function(){const t=this[Pe].getValue();if(t)return t.getFieldDefinitions();throw new Error("SFNode.getFieldDefinitions: node is null.")},addFieldCallback:function(t,e,n){const i=this[Pe];switch(arguments.length){case 2:return R.prototype.addFieldCallback.apply(i,arguments);case 3:{const o=i.getValue();if(o)return o.getField(t).addFieldCallback(e,n);throw new Error("SFNode.addFieldCallback: node is null.")}}},removeFieldCallback:function(t,e){const n=this[Pe];switch(arguments.length){case 1:return R.prototype.removeFieldCallback.apply(n,arguments);case 2:{const i=n.getValue();if(i)return i.getField(t).removeFieldCallback(e);throw new Error("SFNode.removeFieldCallback: node is null.")}}},addCloneCount:function(t){const e=this[Pe],n=e.getValue();e[Le]+=t,n&&n.addCloneCount(t)},removeCloneCount:function(t){const e=this[Pe],n=e.getValue();e[Le]-=t,n&&n.removeCloneCount(t)},valueOf:function(){const t=this[Pe].getValue();return t?Re.get(t):null},toStream:function(t){const e=this[Pe].getValue();e?e.toStream(t):t.string+="NULL"},toVRMLStream:function(t){const e=this[Pe].getValue();e?e.toVRMLStream(t):t.string+="NULL"},toXMLString:function(){const t=this[Pe],e={string:""},n=s.Get(e),i=t.getValue();return n.PushExecutionContext(i.getExecutionContext()),t.toXMLStream(e),n.PopExecutionContext(),e.string},toXMLStream:function(t){const e=this[Pe].getValue();e?e.toXMLStream(t):t.string+="\x3c!-- NULL --\x3e"},dispose:function(){const t=this[Pe],e=t.getValue();e&&e.dispose(),R.prototype.dispose.call(t)}});for(const t of Reflect.ownKeys(Xe.prototype))Object.defineProperty(Xe.prototype,t,{enumerable:!1});const Ue=Xe,ze=re.SFVec3f;function je(t,e,n,i){switch(arguments.length){case 0:return R.call(this,new Ce);case 1:return R.call(this,arguments[0]);case 2:return arguments[1]instanceof ze?R.call(this,new Ce(arguments[0].getValue(),arguments[1].getValue())):R.call(this,new Ce(arguments[0].getValue(),+arguments[1]));case 4:return R.call(this,new Ce(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}je.prototype=Object.assign(Object.create(R.prototype),{constructor:je,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new je(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(Ce.Identity)},getTypeName:function(){return"SFRotation"},getType:function(){return o.SFRotation},set:function(t){this.getValue().assign(t)},setAxis:function(t){this.getValue().setAxis(t.getValue()),this.addEvent()},getAxis:function(){return new ze(this.getValue().getAxis().copy())},inverse:function(){return new je(Ce.inverse(this.getValue()))},multiply:function(t){return new je(Ce.multRight(this.getValue(),t.getValue()))},multVec:function(t){return new ze(this.getValue().multVecRot(t.getValue().copy()))},slerp:function(t,e){return new je(Ce.slerp(this.getValue(),t.getValue(),e))},toStream:function(t){const e=s.Get(t),n=this.getValue();t.string+=e.DoublePrecision(n.x)+" "+e.DoublePrecision(n.y)+" "+e.DoublePrecision(n.z)+" "+e.DoublePrecision(e.ToUnit("angle",n.angle))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)}});for(const t of Reflect.ownKeys(je.prototype))Object.defineProperty(je.prototype,t,{enumerable:!1});const ke={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()},enumerable:!0,configurable:!1},Ge={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()},enumerable:!0,configurable:!1},He={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()},enumerable:!0,configurable:!1},qe={get:function(){return this.getValue().angle},set:function(t){this.getValue().angle=+t,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(je.prototype,"x",ke),Object.defineProperty(je.prototype,"y",Ge),Object.defineProperty(je.prototype,"z",He),Object.defineProperty(je.prototype,"angle",qe),ke.enumerable=!1,Ge.enumerable=!1,He.enumerable=!1,qe.enumerable=!1,Object.defineProperty(je.prototype,"0",ke),Object.defineProperty(je.prototype,"1",Ge),Object.defineProperty(je.prototype,"2",He),Object.defineProperty(je.prototype,"3",qe);const Ye=je,We=/\\(.)/g,$e=/([\\"])/g;function Ke(t){return R.call(this,arguments.length?""+t:"")}Object.assign(Ke,{unescape:function(t){return t.replace(We,"$1")},escape:function(t){return t.replace($e,"\\$1")}}),Ke.prototype=Object.assign(Object.create(R.prototype),{constructor:Ke,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Ke(this.getValue())},getTypeName:function(){return"SFString"},getType:function(){return o.SFString},isDefaultValue:function(){return""===this.getValue()},set:function(t){R.prototype.set.call(this,""+t)},valueOf:R.prototype.getValue,toStream:function(t){t.string+='"'+Ke.escape(this.getValue())+'"'},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){t.string+=s.Get(t).XMLEncode(this.getValue())}});for(const t of Reflect.ownKeys(Ke.prototype))Object.defineProperty(Ke.prototype,t,{enumerable:!1});Object.defineProperty(Ke.prototype,"length",{get:function(){return this.getValue().length},enumerable:!0,configurable:!1});const Qe=Ke;function Ze(t,e,n){function i(t,e,n,i){switch(arguments.length){case 0:return R.call(this,new ae(0,0,0,0));case 1:return R.call(this,arguments[0]);case 4:return R.call(this,new ae(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(R.prototype),Ut(ae,n),{constructor:i,getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()},enumerable:!0,configurable:!1},s={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()},enumerable:!0,configurable:!1},a={get:function(){return this.getValue().w},set:function(t){this.getValue().w=+t,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),Object.defineProperty(i.prototype,"z",s),Object.defineProperty(i.prototype,"w",a),o.enumerable=!1,r.enumerable=!1,s.enumerable=!1,a.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),Object.defineProperty(i.prototype,"2",s),Object.defineProperty(i.prototype,"3",a),i}const Je={SFVec4d:Ze("SFVec4d",o.SFVec4d,!0),SFVec4f:Ze("SFVec4f",o.SFVec4f,!1)};function tn(t){R.call(this,t)}tn.prototype=Object.assign(Object.create(R.prototype),{constructor:tn,at:Array.prototype.at,concat:Array.prototype.concat,every:Array.prototype.every,fill:Array.prototype.fill,filter:Array.prototype.filter,find:Array.prototype.find,findIndex:Array.prototype.findIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:function(){return Array(this.length).keys()},lastIndexOf:Array.prototype.lastIndexOf,map:Array.prototype.map,reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice:Array.prototype.slice,some:Array.prototype.some,values:function(){return this[Symbol.iterator]}});for(const t of Reflect.ownKeys(tn.prototype))Object.defineProperty(tn.prototype,t,{enumerable:!1});const en=tn,nn=Symbol(),on=Symbol(),rn={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=t.getValue(),i=+e;return Number.isInteger(i)?(i>=n.length&&t.resize(i+1),n[i].valueOf()):t[e]}},set:function(t,e,n){if(e in t)return t[e]=n,!0;const i=t.getValue(),o=+e;return o>=i.length&&t.resize(o+1),i[o].setValue(n),!0},has:function(t,e){return Number.isInteger(+e)?e<t.getValue().length:e in t},ownKeys:function(t){return Object.keys(t.getValue())},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;return Number.isInteger(n)&&n<t.getValue().length?Object.getOwnPropertyDescriptor(t.getValue(),e):void 0}};function sn(t){const e=new Proxy(this,rn);return en.call(this,[]),this[nn]=this,this[on]=e,t[0]instanceof Array&&(t=t[0]),sn.prototype.push.apply(this,t),e}sn.prototype=Object.assign(Object.create(en.prototype),{constructor:sn,[nn]:null,[on]:null,[Symbol.iterator]:function*(){const t=this[nn].getValue();for(const e of t)yield e.valueOf()},getTarget:function(){return this[nn]},copy:function(){const t=this[nn],e=t.create(),n=t.getValue();return sn.prototype.push.apply(e,n),e.setModificationTime(0),e},equals:function(t){const e=this[nn].getValue(),n=t.getValue(),i=e.length;if(e===n)return!0;if(i!==n.length)return!1;for(let t=0;t<i;++t)if(!e[t].equals(n[t]))return!1;return!0},set:function(t){const e=this[nn];e.resize(t.length,void 0,!0);const n=e.getValue();for(let e=0,i=t.length;e<i;++e)n[e].set(t[e]instanceof R?t[e].getValue():t[e])},isDefaultValue:function(){return 0===this.length},setValue:function(t){const e=this[nn];e.set(t instanceof sn?t.getValue():t),e.addEvent()},unshift:function(t){const e=this[nn],n=e.getValue();for(let t=arguments.length-1;t>=0;--t){const i=new(e.getSingleType());i.setValue(arguments[t]),e.addChildObject(i),n.unshift(i)}return e.addEvent(),n.length},shift:function(){const t=this[nn],e=t.getValue();if(e.length){const n=e.shift();return t.removeChildObject(n),t.addEvent(),n.valueOf()}},push:function(t){const e=this[nn],n=e.getValue();for(const t of arguments){const i=new(e.getSingleType());i.setValue(t),e.addChildObject(i),n.push(i)}return e.addEvent(),n.length},pop:function(){const t=this[nn],e=t.getValue();if(e.length){const n=e.pop();return t.removeChildObject(n),t.addEvent(),n.valueOf()}},splice:function(t,e){const n=this[nn],i=n.getValue();t>i.length&&(t=i.length),t+e>i.length&&(e=i.length-t);const o=n.erase(t,t+e);return arguments.length>2&&n.insert(t,arguments,2,arguments.length),o},insert:function(t,e,n,i){const o=this[nn],r=[t,0];for(let t=n;t<i;++t){const n=new(o.getSingleType());n.setValue(e[t]),o.addChildObject(n),r.push(n)}Array.prototype.splice.apply(o.getValue(),r),o.addEvent()},find:function(t,e,n){const i=this[nn].getValue();if("function"==typeof n){for(let o=t;o<e;++o)if(n(i[o].valueOf()))return o;return e}for(let o=t;o<e;++o)if(i[o].equals(n))return o;return e},remove:function(t,e,n){const i=this[nn],o=i.getValue();if("function"==typeof n){if((t=i.find(t,e,n))!==e)for(let i=t;++i<e;){const e=o[i];if(!n(e.valueOf())){const n=o[t];o[t++]=e,o[i]=n}}return t!==e&&i.addEvent(),t}if((t=i.find(t,e,n))!==e)for(let i=t;++i<e;){const e=o[i];if(!e.equals(n)){const n=o[t];o[t++]=e,o[i]=n}}return t!==e&&i.addEvent(),t},erase:function(t,e){const n=this[nn],i=n.getValue().splice(t,e-t);for(const t of i)n.removeChildObject(t);return n.addEvent(),i.map((function(t){return t.valueOf()}))},resize:function(t,e,n){const i=this[nn],o=i.getValue();if(t<o.length){for(let e=t,n=o.length;e<n;++e)i.removeChildObject(o[e]);o.length=t,n||i.addEvent()}else if(t>o.length){for(let n=o.length;n<t;++n){const t=new(i.getSingleType());void 0!==e&&t.setValue(e),i.addChildObject(t),o.push(t)}n||i.addEvent()}},addChildObject:function(t){t.addParent(this[on])},removeChildObject:function(t){t.removeParent(this[on])},toStream:function(t){const e=this[nn],n=e.getValue(),i=s.Get(t);switch(n.length){case 0:t.string+="[ ]";break;case 1:i.PushUnitCategory(e.getUnit()),n[0].toStream(t),i.PopUnitCategory();break;default:i.PushUnitCategory(e.getUnit()),t.string+="[\n",i.IncIndent();for(let e=0,o=n.length-1;e<o;++e)t.string+=i.Indent(),n[e].toStream(t),t.string+=",\n";t.string+=i.Indent(),n.at(-1).toStream(t),t.string+="\n",i.DecIndent(),t.string+=i.Indent(),t.string+="]",i.PopUnitCategory()}},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){const e=this[nn];if(e.length){const n=s.Get(t),i=e.getValue();n.PushUnitCategory(e.getUnit());for(const e of i)e.toXMLStream(t),t.string+=", ";i.at(-1).toXMLStream(t),n.PopUnitCategory()}},dispose:function(){const t=this[nn],e=t.getValue();for(const n of e)t.removeChildObject(n);e.length=0,en.prototype.dispose.call(t)}});for(const t of Reflect.ownKeys(sn.prototype))Object.defineProperty(sn.prototype,t,{enumerable:!1});Object.defineProperty(sn.prototype,"length",{get:function(){return this[nn].getValue().length},set:function(t){this[nn].resize(t)},enumerable:!1,configurable:!1});const an=sn,un=Symbol(),cn=Symbol(),ln=Symbol(),hn={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=+e;if(Number.isInteger(n)){const e=t.getComponents(),i=t.getValueType();let o=t.getValue();if(n>=t[ln]&&(o=t.resize(n+1)),1===e)return i(o[n]);{const o=new i,r=o.getValue(),s=n*e;return o.addEvent=pn.bind(t,s,r,e),o.getValue=fn.bind(t,s,r,e),o}}return t[e]}},set:function(t,e,n){if(e in t)return t[e]=n,!0;const i=t.getComponents();let o=+e,r=t.getValue();if(o>=t[ln]&&(r=t.resize(o+1)),1===i)r[o]=n;else{o*=i;for(let t=0;t<i;++t,++o)r[o]=n[t]}return t.addEvent(),!0},has:function(t,e){return Number.isInteger(+e)?e<t[ln]:e in t},ownKeys:function(t){const e=[];for(let n=0,i=t[ln];n<i;++n)e.push(String(n));return e},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;return Number.isInteger(n)&&n<t[ln]?Object.getOwnPropertyDescriptor(t.getValue(),e):void 0}};function dn(t){return en.call(this,new(this.getArrayType())(2)),this[un]=this,this[cn]=[],t[0]instanceof Array&&(t=t[0]),dn.prototype.push.apply(this,t),new Proxy(this,hn)}dn.prototype=Object.assign(Object.create(en.prototype),{constructor:dn,[un]:null,[cn]:null,[ln]:0,[Symbol.iterator]:function*(){const t=this[un],e=t.getValue(),n=t.getComponents(),i=t.getValueType(),o=t[ln];if(1===n)for(let t=0;t<o;++t)yield i(e[t]);else for(let e=0;e<o;++e){const o=new i,r=o.getValue(),s=e*n;o.addEvent=pn.bind(t,s,r,n),o.getValue=fn.bind(t,s,r,n),yield o}},getTarget:function(){return this[un]},copy:function(){const t=this[un],e=t.getValue(),n=t.create(),i=new(t.getArrayType())(e);return n[ln]=t[ln],en.prototype.set.call(n,i,t[ln]),n.setModificationTime(0),n},equals:function(t){if(this===t)return!0;const e=this[un],n=e[ln];if(n!==t[ln])return!1;const i=e.getValue(),o=t.getValue();for(let t=0,r=n*e.getComponents();t<r;++t)if(i[t]!==o[t])return!1;return!0},assign:function(t){const e=this[un];e.set(t.getValue(),t.length),e.addEvent()},set:function(t,e){const n=this[un],i=n.getComponents(),o=n[ln];let r=n.getValue(),s=void 0!==e?e*i:t.length;const a=s%i;a&&(s-=a,console.warn("Array length must be multiple of components size, which is "+i+".")),s/=i,r.length<t.length?(r=n.grow(t.length),r.set(t),a&&r.fill(0,s*i,s*i+a)):(r.set(t),s<o&&r.fill(0,s*i,o*i)),n[ln]=s},isDefaultValue:function(){return 0===this[ln]},setValue:function(t){const e=this[un];t instanceof e.constructor?e.assign(t):(e.set(t),e.addEvent())},unshift:function(t){const e=this[un],n=e.getComponents(),i=e[ln],o=arguments.length,r=e.grow((i+o)*n);if(r.copyWithin(o*n,0,i*n),1===n)r.set(arguments,0);else for(let t=0,e=0;e<o;++e){const i=arguments[e];for(let e=0;e<n;++e,++t)r[t]=i[e]}return e[ln]+=o,e.addEvent(),r.length},shift:function(){const t=this[un],e=t[ln];if(e){const i=t.getValue(),o=t.getComponents(),r=t.getValueType(),s=e-1;if(1===o)var n=r(i[0]);else{const e=t[cn];for(let t=0;t<o;++t)e[t]=i[t];n=Object.create(r.prototype);r.apply(n,e)}return i.copyWithin(0,o,e*o),i.fill(0,o*s,e*o),t[ln]=s,t.addEvent(),n}},push:function(t){const e=this[un],n=e.getComponents(),i=e[ln],o=arguments.length,r=e.grow((i+o)*n);if(1===n)r.set(arguments,i);else for(let t=i*n,e=0;e<o;++e){const i=arguments[e];for(let e=0;e<n;++e,++t)r[t]=i[e]}return e[ln]+=o,e.addEvent(),e[ln]},pop:function(){const t=this[un],e=t[ln];if(e){const i=t.getValue(),o=t.getComponents(),r=t.getValueType(),s=e-1;if(1===o)var n=r(i[e-1]);else{const e=t[cn];for(let t=0,n=s*o;t<o;++t,++n)e[t]=i[n];n=Object.create(r.prototype);r.apply(n,e)}return i.fill(0,s*o,e*o),t[ln]=s,t.addEvent(),n}},splice:function(t,e){const n=this[un],i=n[ln];t>i&&(t=i),t+e>i&&(e=i-t);const o=n.erase(t,t+e);return arguments.length>2&&n.spliceInsert(t,Array.prototype.splice.call(arguments,2)),n.addEvent(),o},spliceInsert:function(t,e){const n=this[un],i=n.getComponents(),o=n[ln],r=e.length,s=n.grow((o+r)*i);if(t*=i,s.copyWithin(t+r*i,t,o*i),1===i)s.set(e,t);else for(let n=0,o=t;n<r;++n){const t=e[n];for(let e=0;e<i;++e,++o)s[o]=t[e]}n[ln]+=r},insert:function(t,e,n,i){const o=this[un],r=o[ln],s=e.getValue(),a=o.getComponents(),u=i-n,c=o.grow((r+u)*a);for(t*=a,n*=a,i*=a,c.copyWithin(t+u*a,t,r*a);n<i;++t,++n)c[t]=s[n];o[ln]+=u,o.addEvent()},erase:function(t,e){const n=this[un],i=n.getValue(),o=n.getComponents(),r=e-t,s=n[ln],a=s-r,u=n.create(),c=u.grow(r*o);e*=o;for(let n=0,r=t*=o;r<e;++n,++r)c[n]=i[r];return i.copyWithin(t,e,s*o),i.fill(0,a*o,s*o),n[ln]=a,u[ln]=r,n.addEvent(),u.slice()},resize:function(t,e,n){const i=this[un],o=i[ln],r=i.getComponents();let s=i.getValue();if(t<o)s.fill(0,t*r,o*r),n||i.addEvent();else if(t>o){if(s=i.grow(t*r),void 0!==e)if(1===r)s.fill(e,o*r,t*r);else for(let n=o*r,i=t*r;n<i;)for(let t=0;t<r;++t,++n)s[n]=e[t];n||i.addEvent()}return i[ln]=t,s},grow:function(t){const e=this[un],n=e.getValue();if(t<n.length)return n;const i=et.nextPowerOfTwo(t),o=new(e.getArrayType())(i);return o.set(n),en.prototype.set.call(e,o),o},shrinkToFit:function(){const t=this[un],e=t.getValue(),n=t[ln]*t.getComponents();if(e.length==n)return e;const i=e.subarray(0,n);return en.prototype.set.call(t,i),i},toStream:function(t){const e=this[un],n=s.Get(t),i=e.getValue(),o=e[ln],r=e.getComponents(),a=new(e.getSingleType());switch(o){case 0:t.string+="[ ]";break;case 1:if(n.PushUnitCategory(e.getUnit()),1===r)a.set(i[0]),a.toStream(t);else{for(let t=0,e=0;t<r;++t,++e)a[t]=i[e];a.toStream(t)}n.PopUnitCategory();break;default:if(n.PushUnitCategory(e.getUnit()),t.string+="[\n",n.IncIndent(),1===r){for(let e=0,s=o-1;e<s;++e)t.string+=n.Indent(),a.set(i[e*r]),a.toStream(t),t.string+=",\n";t.string+=n.Indent(),a.set(i[(o-1)*r]),a.toStream(t),t.string+="\n"}else{for(let e=0,s=o-1;e<s;++e){t.string+=n.Indent();for(let t=0,n=e*r;t<r;++t,++n)a[t]=i[n];a.toStream(t),t.string+=",\n"}t.string+=n.Indent();for(let t=0,e=(o-1)*r;t<r;++t,++e)a[t]=i[e];a.toStream(t),t.string+="\n"}n.DecIndent(),t.string+=n.Indent(),t.string+="]",n.PopUnitCategory()}},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){const e=this[un],n=e[ln];if(n){const i=s.Get(t),o=e.getValue(),r=e.getComponents(),a=new(e.getSingleType());if(i.PushUnitCategory(e.getUnit()),1===r){for(let e=0,i=n-1;e<i;++e)a.set(o[e*r]),a.toXMLStream(t),t.string+=", ";a.set(o[(n-1)*r]),a.toXMLStream(t)}else{for(let e=0,i=n-1;e<i;++e){for(let t=0,n=e*r;t<r;++t,++n)a[t]=o[n];a.toXMLStream(t),t.string+=", "}for(let t=0,e=(n-1)*r;t<r;++t,++e)a[t]=o[e];a.toXMLStream(t)}i.PopUnitCategory()}},dispose:function(){en.prototype.dispose.call(this[un])}});for(const t of Reflect.ownKeys(dn.prototype))Object.defineProperty(dn.prototype,t,{enumerable:!1});function fn(t,e,n){const i=this.getValue(),o=this[cn];for(let e=0;e<n;++e,++t)o[e]=i[t];return e.set.apply(e,o),e}function pn(t,e,n){const i=this.getValue();for(let o=0;o<n;++o,++t)i[t]=e[o];this.addEvent()}Object.defineProperty(dn.prototype,"length",{get:function(){return this[ln]},set:function(t){this[un].resize(t)},enumerable:!1,configurable:!1});const gn=dn,mn=ie.SFMatrix3d,_n=ie.SFMatrix3f,xn=Ve.SFMatrix4d,yn=Ve.SFMatrix4f,wn=Gt.SFVec2d,Tn=Gt.SFVec2f,Sn=re.SFVec3d,bn=re.SFVec3f,vn=Je.SFVec4d,En=Je.SFVec4f,Cn=Symbol();function On(t){return an.call(this,arguments)}On.prototype=Object.assign(Object.create(an.prototype),{constructor:On,[Cn]:0,getSingleType:function(){return Ue},getValueType:function(){return Ue},getArrayType:function(){return Array},getComponents:function(){return 1},getTypeName:function(){return"MFNode"},getType:function(){return o.MFNode},copy:function(t){if(t){const e=new On;for(const n of this.getValue())e.push(n.copy(t));return e.setModificationTime(0),e}return an.prototype.copy.call(this)},addCloneCount:function(t){this[Cn]+=t;for(const e of this.getValue())e.addCloneCount(t)},removeCloneCount:function(t){this[Cn]-=t;for(const e of this.getValue())e.removeCloneCount(t)},addChildObject:function(t){an.prototype.addChildObject.call(this,t),t.addCloneCount(this[Cn])},removeChildObject:function(t){an.prototype.removeChildObject.call(this,t),t.removeCloneCount(this[Cn])},toStream:function(t){const e=this.getTarget(),n=e.getValue(),i=s.Get(t);switch(n.length){case 0:t.string+="[ ]";break;case 1:i.PushUnitCategory(e.getUnit()),n[0].toStream(t),i.PopUnitCategory();break;default:i.PushUnitCategory(e.getUnit()),t.string+="[\n",i.IncIndent();for(let e=0,o=n.length;e<o;++e)t.string+=i.Indent(),n[e].toStream(t),t.string+="\n";i.DecIndent(),t.string+=i.Indent(),t.string+="]",i.PopUnitCategory()}},toVRMLString:function(){this.addCloneCount(1);const t=an.prototype.toVRMLString.call(this);return this.removeCloneCount(1),t},toVRMLStream:function(t){const e=this.getTarget().getValue(),n=s.Get(t);switch(e.length){case 0:t.string+="[ ]";break;case 1:n.EnterScope(),e[0].toVRMLStream(t),n.LeaveScope();break;default:n.EnterScope(),t.string+="[\n",n.IncIndent();for(const i of e)t.string+=n.Indent(),i.toVRMLStream(t),t.string+="\n";n.DecIndent(),t.string+=n.Indent(),t.string+="]",n.LeaveScope()}},toXMLString:function(){this.addCloneCount(1);const t=an.prototype.toXMLString.call(this);return this.removeCloneCount(1),t},toXMLStream:function(t){const e=s.Get(t),n=this.length;if(n){e.EnterScope();const i=this.getValue();for(let o=0,r=n-1;o<r;++o){const n=i[o].getValue();if(n)n.toXMLStream(t),t.string+="\n";else{t.string+=e.Indent(),t.string+="<",t.string+="NULL";const n=e.ContainerField();n&&(t.string+=" ",t.string+="containerField='",t.string+=e.XMLEncode(n.getName()),t.string+="'"),t.string+="/>"}}const o=i.at(-1).getValue();if(o)o.toXMLStream(t);else{t.string+=e.Indent(),t.string+="<",t.string+="NULL";const n=e.ContainerField();n&&(t.string+=" ",t.string+="containerField='",t.string+=e.XMLEncode(n.getName()),t.string+="'")}e.LeaveScope()}},dispose:function(){this.resize(0),an.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(On.prototype))Object.defineProperty(On.prototype,t,{enumerable:!1});function Fn(t){return an.call(this,arguments)}Fn.prototype=Object.assign(Object.create(an.prototype),{constructor:Fn,getValueType:function(){return String},getSingleType:function(){return Qe},getArrayType:function(){return Array},getComponents:function(){return 1},getTypeName:function(){return"MFString"},getType:function(){return o.MFString},toXMLStream:function(t){const e=this.length;if(e){const n=this.getValue();for(let i=0,o=e-1;i<o;++i)t.string+='"',n[i].toXMLStream(t),t.string+='"',t.string+=", ";t.string+='"',n.at(-1).toXMLStream(t),t.string+='"'}}});for(const t of Reflect.ownKeys(Fn.prototype))Object.defineProperty(Fn.prototype,t,{enumerable:!1});function Nn(t,e,n,i,o,r){function s(t){return gn.call(this,arguments)}s.prototype=Object.assign(Object.create(gn.prototype),{constructor:s,getSingleType:function(){return n},getValueType:function(){return i},getArrayType:function(){return o},getComponents:function(){return r},getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(s.prototype))Object.defineProperty(s.prototype,t,{enumerable:!1});return s}function Mn(t){return t}const Vn={MFBool:Nn("MFBool",o.MFBool,J,Boolean,Uint8Array,1),MFColor:Nn("MFColor",o.MFColor,gt,gt,Float32Array,3),MFColorRGBA:Nn("MFColorRGBA",o.MFColorRGBA,It,It,Float32Array,4),MFDouble:Nn("MFDouble",o.MFDouble,Rt,Mn,Float64Array,1),MFFloat:Nn("MFFloat",o.MFFloat,At,Mn,Float32Array,1),MFImage:function(t,e,n,i,o,r){function s(t){return an.call(this,arguments)}s.prototype=Object.assign(Object.create(an.prototype),{constructor:s,getSingleType:function(){return Ln},getValueType:function(){return Ln},getArrayType:function(){return o},getComponents:function(){return r},getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(s.prototype))Object.defineProperty(s.prototype,t,{enumerable:!1});return s}("MFImage",o.MFImage,0,0,Array,1),MFInt32:Nn("MFInt32",o.MFInt32,Bt,Mn,Int32Array,1),MFMatrix3d:Nn("MFMatrix3d",o.MFMatrix3d,mn,mn,Float64Array,9),MFMatrix3f:Nn("MFMatrix3f",o.MFMatrix3f,_n,_n,Float32Array,9),MFMatrix4d:Nn("MFMatrix4d",o.MFMatrix4d,xn,xn,Float64Array,16),MFMatrix4f:Nn("MFMatrix4f",o.MFMatrix4f,yn,yn,Float32Array,16),MFNode:On,MFRotation:Nn("MFRotation",o.MFRotation,Ye,Ye,Float64Array,4),MFString:Fn,MFTime:Nn("MFTime",o.MFTime,A,Mn,Float64Array,1),MFVec2d:Nn("MFVec2d",o.MFVec2d,wn,wn,Float64Array,2),MFVec2f:Nn("MFVec2f",o.MFVec2f,Tn,Tn,Float32Array,2),MFVec3d:Nn("MFVec3d",o.MFVec3d,Sn,Sn,Float64Array,3),MFVec3f:Nn("MFVec3f",o.MFVec3f,bn,bn,Float32Array,3),MFVec4d:Nn("MFVec4d",o.MFVec4d,vn,vn,Float64Array,4),MFVec4f:Nn("MFVec4f",o.MFVec4f,En,En,Float32Array,4)},In=Vn;function Dn(t,e,n,i){const o=In.MFInt32;this.width=~~t,this.height=~~e,this.comp=~~n,this.array=new o,this.array.setValue(i),this.array.length=this.width*this.height}function Rn(t,e,n,i){const o=In.MFInt32;return arguments[0]instanceof Dn?R.call(this,arguments[0]):4===arguments.length?R.call(this,new Dn(t,e,n,i)):R.call(this,new Dn(0,0,0,new o)),this.getValue().getArray().addParent(this),this.addInterest("set_size__",this),this}Dn.prototype={constructor:Dn,copy:function(){return new Dn(this.width,this.height,this.comp,this.array)},equals:function(t){return this.width===t.width&&this.height===t.height&&this.comp===t.comp&&this.array.equals(t.array)},assign:function(t){this.width=t.width,this.height=t.height,this.comp=t.comp,this.array.assign(t.array)},set:function(t,e,n,i){this.width=~~t,this.height=~~e,this.comp=~~n,this.array.assign(i)},setWidth:function(t){this.width=~~t,this.array.length=this.width*this.height},getWidth:function(){return this.width},setHeight:function(t){this.height=~~t,this.array.length=this.width*this.height},getHeight:function(){return this.height},setComp:function(t){this.comp=~~t},getComp:function(){return this.comp},setArray:function(t){this.array.setValue(t),this.array.length=this.width*this.height},getArray:function(){return this.array}},Rn.prototype=Object.assign(Object.create(R.prototype),{constructor:Rn,set_size__:function(){this.getValue().getArray().length=this.width*this.height},copy:function(){return new Rn(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return 0===this.width&&0===this.height&&0===this.comp},set:function(t){this.getValue().assign(t)},getTypeName:function(){return"SFImage"},getType:function(){return o.SFImage},toStream:function(t){t.string+=this.width+" "+this.height+" "+this.comp;for(const e of this.array)t.string+=" 0x"+e.toString(16)},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)}});for(const t of Reflect.ownKeys(Rn.prototype))Object.defineProperty(Rn.prototype,t,{enumerable:!1});const Pn={get:function(){return this.getValue().getWidth()},set:function(t){this.getValue().setWidth(t),this.addEvent()},enumerable:!0,configurable:!1},An={get:function(){return this.getValue().getHeight()},set:function(t){this.getValue().setHeight(t),this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(Rn.prototype,"width",Pn),Object.defineProperty(Rn.prototype,"height",An),Object.defineProperty(Rn.prototype,"comp",{get:function(){return this.getValue().getComp()},set:function(t){this.getValue().setComp(t),this.addEvent()},enumerable:!0,configurable:!1}),Object.defineProperty(Rn.prototype,"array",{get:function(){return this.getValue().getArray()},set:function(t){this.getValue().setArray(t),this.addEvent()},enumerable:!0,configurable:!1}),Pn.enumerable=!1,An.enumerable=!1,Object.defineProperty(Rn.prototype,"x",Pn),Object.defineProperty(Rn.prototype,"y",An);const Ln=Rn,Bn=Object.assign({SFBool:J,SFColor:gt,SFColorRGBA:It,SFDouble:Rt,SFFloat:At,SFImage:Ln,SFInt32:Bt,SFMatrix3d:ie.SFMatrix3d,SFMatrix3f:ie.SFMatrix3f,SFMatrix4d:Ve.SFMatrix4d,SFMatrix4f:Ve.SFMatrix4f,SFNode:Ue,SFRotation:Ye,SFString:Qe,SFTime:A,SFVec2d:Gt.SFVec2d,SFVec2f:Gt.SFVec2f,SFVec3d:re.SFVec3d,SFVec3f:re.SFVec3f,SFVec4d:Je.SFVec4d,SFVec4f:Je.SFVec4f,VrmlMatrix:Ve.VrmlMatrix},In),Xn=Symbol(),Un=Symbol(),zn=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),jn=Symbol(),kn=Symbol(),Gn=Symbol(),Hn=Symbol(),qn=Symbol(),Yn=Symbol(),Wn=Symbol("X3DBaseNode.set_live__"),$n=Symbol(),Kn=Symbol();function Qn(t){if(!this[Xn]){X.call(this,t.getBrowser()),this[Xn]=t,this[Un]=[o.X3DBaseNode],this[jn]=new Q,this[kn]=new Q,this[Gn]=new Map,this[Hn]=new Q,this[Yn]=!0,this[qn]=!1,this[$n]=!1,this[Kn]=0,this.canUserDefinedFields()&&(this[zn]=new W(this[zn]));for(const t of this[zn])this.addField(t);this.addChildObjects("name_changed",new Bn.SFTime,"typeName_changed",new Bn.SFTime,"fields_changed",new Bn.SFTime,"cloneCount_changed",new Bn.SFTime)}}Qn.prototype=Object.assign(Object.create(X.prototype),{constructor:Qn,[zn]:new W([]),setName:function(t){X.prototype.setName.call(this,t),this[qn]&&(this._name_changed=this.getBrowser().getCurrentTime())},getMainScene:function(){let t=this[Xn].getScene();for(;!t.isMainScene();)t=t.getScene();return t},getScene:function(){let t=this[Xn];for(;!t.isScene();)t=t.getExecutionContext();return t},getExecutionContext:function(){return this[Xn]},setExecutionContext:function(t){this[Xn]=t},addType:function(t){this[Un].push(t)},getType:function(){return this[Un]},getInnerNode:function(){return this},isLive:function(){function t(){return this._isLive}return function(){return Object.defineProperty(this,"isLive",{value:t,enumerable:!1,configurable:!0}),this.addChildObjects("isLive",new Bn.SFBool(this.getLiveState())),this._isLive.removeParent(this),this.getOuterNode&&this.getOuterNode()?this.getOuterNode().isLive().addInterest(Wn,this):this[Xn]!==this&&this[Xn].isLive().addInterest(Wn,this),this.isLive()}}(),setLive:function(t){this[Yn]=t.valueOf(),this[Wn]()},getLive:function(){return this[Yn]},getLiveState:function(){return this.getOuterNode&&this.getOuterNode()?this.getLive()&&this.getOuterNode().isLive().getValue():this!==this[Xn]?this.getLive()&&this[Xn].isLive().getValue():this.getLive()},[Wn]:function(){const t=this.getLiveState(),e=this.isLive();if(t){if(e.getValue())return;e.set(!0),e.processEvent()}else e.getValue()&&(e.set(!1),e.processEvent())},create:function(t){return new this.constructor(t||this[Xn])},setup:function(){const t={value:Function.prototype,enumerable:!1};return function(){Object.defineProperty(this,"setup",t);for(const t of this[jn])t.setTainted(!1);this.initialize(),this[qn]=!0}}(),initialize:function(){},isInitialized:function(){return this[qn]},copy:function(t){const e=this.create(t);if(this.canUserDefinedFields())for(const t of this[zn])e.getFields().has(t.name)||e.addUserDefinedField(t.accessType,t.name,t.value.copy());for(const t of this[jn])e.getFields().get(t.getName()).assign(t);return e.setup(),e},addChildObjects:function(t,e){for(let t=0,e=arguments.length;t<e;t+=2)this.addChildObject(arguments[t],arguments[t+1])},addChildObject:function(t,e){e.addParent(this),e.setName(t),Object.defineProperty(this,"_"+t,{get:function(){return e},set:function(t){e.setValue(t)},enumerable:!1,configurable:!1})},getFieldDefinitions:function(){return this[zn]},getFieldsAreEnumerable:function(){return!1},addField:function(t){const e=t.accessType,n=t.name,i=t.value.copy();i.setTainted(!this[qn]),i.addParent(this),i.setName(n),i.setAccessType(e),this[jn].add(n,i),this[kn].add(n,i),Object.defineProperty(this,"_"+n,{get:function(){return i},set:function(t){i.setValue(t)},enumerable:this.getFieldsAreEnumerable(),configurable:!0}),this.isPrivate()||i.addCloneCount(1),this[qn]&&(this._fields_changed=this.getBrowser().getCurrentTime())},getField:function(){const t=/^set_(.*?)$/,e=/^(.*?)_changed$/;return function(n){const i=this[jn].get(n)||this[Gn].get(n);if(i)return i;const r=n.match(t);if(r){const t=this[jn].get(r[1])||this[Gn].get(r[1]);if(t&&t.getAccessType()===o.inputOutput)return t}else{const t=n.match(e);if(t){const e=this[jn].get(t[1])||this[Gn].get(t[1]);if(e&&e.getAccessType()===o.inputOutput)return e}}throw new Error("Unknown field '"+n+"' in node class "+this.getTypeName()+".")}}(),addAlias:function(t,e){this[Gn].set(t,e),Object.defineProperty(this,"_"+t,{get:function(){return e},set:function(t){e.setValue(t)},enumerable:!0,configurable:!1})},removeField:function(t){const e=this[kn].get(t);e&&(e.removeParent(this),this[jn].remove(t),this[kn].remove(t),delete this["_"+e.getName()],this.isPrivate()||e.removeCloneCount(1),this[qn]&&(this._fields_changed=this.getBrowser().getCurrentTime()))},canUserDefinedFields:function(){return!1},addUserDefinedField:function(t,e,n){this[Hn].has(e)&&this.removeUserDefinedField(e),n.setTainted(!this[qn]),n.addParent(this),n.setName(e),n.setAccessType(t),this[zn].add(e,new z(t,e,n)),this[jn].add(e,n),this[Hn].add(e,n),this.isPrivate()||n.addCloneCount(1),this[qn]&&(this._fields_changed=this.getBrowser().getCurrentTime())},removeUserDefinedField:function(t){const e=this[Hn].get(t);e&&(e.removeParent(this),this[jn].remove(t),this[Hn].remove(t),this[zn].remove(t),this.isPrivate()||e.removeCloneCount(1),this[qn]&&(this._fields_changed=this.getBrowser().getCurrentTime()))},getUserDefinedFields:function(){return this[Hn]},getPredefinedFields:function(){return this[kn]},getChangedFields:function(t){const e=[];if(t)for(const t of this[Hn])e.push(t);for(const n of this[kn])if(t&&(n.getInputRoutes().size||n.getOutputRoutes().size))e.push(n);else{if(0===n.getReferences().size){if(!n.isInitializable())continue;if(this.isDefaultValue(n))continue}e.push(n)}return e},isDefaultValue:function(t){const e=this.getFieldDefinitions().get(t.getName());return e?e.value.equals(t):!t.getModificationTime()},getFields:function(){return this[jn]},getSourceText:function(){return null},hasRoutes:function(){for(const t of this[jn]){if(t.getInputRoutes().size)return!0;if(t.getOutputRoutes().size)return!0}return!1},isPrivate:function(){return this[$n]},setPrivate:function(t){if(this[$n]=t,t)for(const t of this[jn])t.removeCloneCount(1);else for(const t of this[jn])t.addCloneCount(1)},getCloneCount:function(){return this[Kn]},addCloneCount:function(t){if(0===t)return;const e=this.getBrowser().getCurrentTime();this[Kn]+=t,this[Xn]._sceneGraph_changed=e,this[qn]&&(this._cloneCount_changed=e)},removeCloneCount:function(t){if(0===t)return;const e=this.getBrowser().getCurrentTime();this[Kn]-=t,this[Xn]._sceneGraph_changed=e,this[qn]&&(this._cloneCount_changed=e)},getEnum:function(t,e,n){return t.hasOwnProperty(e)?t[e]:n},dispose:function(){for(const t of this.getFields())t.dispose();X.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(Qn.prototype))Object.defineProperty(Qn.prototype,t,{enumerable:!1});const Zn=Qn,Jn=!1,ti=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_sRGB","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","EXT_float_blend","OES_fbo_render_mipmap","WEBGL_get_buffer_sub_data_async","WEBGL_multiview","WEBGL_security_sensitive_resources","WEBGL_shared_resources","EXT_clip_cull_distance","WEBGL_debug","WEBGL_dynamic_texture","WEBGL_subarray_uploads","WEBGL_texture_multisample","WEBGL_texture_source_iframe","WEBGL_video_texture","EXT_texture_storage","OES_depth24","WEBGL_debug_shader_precision","WEBGL_draw_elements_no_range_check","WEBGL_subscribe_uniform","WEBGL_texture_from_depth_video"],ei={create:function(t,e,n){const i={preserveDrawingBuffer:n};let o=null;if(e>=2&&!o&&(o=t.getContext("webgl2",i),o&&(o.getVersion=function(){return 2})),e>=1&&!o&&(o=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),o)){o.getVersion=function(){return 1};{const t=o.getExtension("OES_vertex_array_object");o.bindVertexArray=t.bindVertexArrayOES.bind(t),o.createVertexArray=t.createVertexArrayOES.bind(t),o.deleteVertexArray=t.deleteVertexArrayOES.bind(t),o.isVertexArray=t.isVertexArrayOES.bind(t)}}if(!o)throw new Error("Couldn't create WebGL context.");const r=o.getParameter(o.ALIASED_LINE_WIDTH_RANGE);1===r[0]&&1===r[1]?(o.lineWidth=Function.prototype,o.HAS_FEATURE_TRANSFORMED_LINES=o.getVersion()>=2):o.HAS_FEATURE_TRANSFORMED_LINES=!1,o.HAS_FEATURE_DEPTH_TEXTURE=o.getVersion()>=2||!!o.getExtension("WEBGL_depth_texture"),o.HAS_FEATURE_FRAG_DEPTH=o.getVersion()>=2||!!o.getExtension("EXT_frag_depth");for(const t of ti)o.getExtension(t);return o}};const ni={en:"C",de:'msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:56+0100\n"\n"PO-Revision-Date: 2015-12-23 04:57+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: de\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Weniger Eigenschaften"\n\nmsgid "More Properties"\nmsgstr "Mehr Eigenschaften"\n\nmsgid "Frame rate"\nmsgstr "Bildrate"\n\nmsgid "fps"\nmsgstr "BpS"\n\nmsgid "Speed"\nmsgstr "Geschwindigkeit"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr ""\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D gesamt"\n\nmsgid "Event Processing"\nmsgstr "Ereignisverarbeitung"\n\nmsgid "Pointer"\nmsgstr "Zeigegerät"\n\nmsgid "Camera"\nmsgstr "Kamera"\n\nmsgid "Collision Detection"\nmsgstr "Kollisionserkennung"\n\nmsgid "Rendering"\nmsgstr "Rendering"\n\nmsgid "Number of Shapes"\nmsgstr "Anzahl der Formen"\n\nmsgid "Number of Sensors"\nmsgstr "Anzahl der Sensoren"\n\nmsgid "Browser Timings"\nmsgstr "Zeitberechnung"\n\nmsgid "X_ITE Browser"\nmsgstr ""\n\nmsgid "Viewpoints"\nmsgstr "Ansichtspunkte"\n\nmsgid "Available Viewers"\nmsgstr "Verfügbare Betrachter"\n\nmsgid "Straighten Horizon"\nmsgstr "Horizont gerade richten"\n\nmsgid "Primitive Quality"\nmsgstr "Qualität der Grundobjekte"\n\nmsgid "High"\nmsgstr "Hoch"\n\nmsgid "high"\nmsgstr "hoch"\n\nmsgid "Medium"\nmsgstr "Mittel"\n\nmsgid "medium"\nmsgstr "mittel"\n\nmsgid "Low"\nmsgstr "Niedrig"\n\nmsgid "low"\nmsgstr "niedrig"\n\nmsgid "Texture Quality"\nmsgstr "Textur Qualität"\n\nmsgid "Display Rubberband"\nmsgstr "Gummiband anzeigen"\n\nmsgid "Rubberband"\nmsgstr "Gummiband"\n\nmsgid "on"\nmsgstr "an"\n\nmsgid "off"\nmsgstr "aus"\n\nmsgid "Mute Browser"\nmsgstr "Browser stumm schalten"\n\nmsgid "Browser muted"\nmsgstr "Browser stumm geschalten"\n\nmsgid "Browser unmuted"\nmsgstr "Browser Ton an"\n\nmsgid "Leave Fullscreen"\nmsgstr "Vollbild verlassen"\n\nmsgid "Fullscreen"\nmsgstr "Vollbild"\n\nmsgid "About X_ITE"\nmsgstr "Über X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Untersuchen"\n\nmsgid "Walk Viewer"\nmsgstr "Laufen"\n\nmsgid "Fly Viewer"\nmsgstr "Fliegen"\n\nmsgid "Plane Viewer"\nmsgstr "Ebenen Betrachter"\n\nmsgid "Look At Viewer"\nmsgstr "Auf Objekte zielen"\n\nmsgid "None Viewer"\nmsgstr "Kein Betrachter"\n\nmsgid "Loading %1 file"\nmsgstr "Lade %1 Datei"\n\nmsgid "Loading %1 files"\nmsgstr "Lade %1 Dateien"\n\nmsgid "Loading done"\nmsgstr "Fertig mit Laden"\n\nmsgid "Failed loading world."\nmsgstr "Laden der Dateien fehlgeschlagen."\n\nmsgid "Show World Info"\nmsgstr "World Info anzeigen"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Ansichtspunkt wurde in die Zwischenablage kopiert."\n',fr:'msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:58+0100\n"\n"PO-Revision-Date: 2015-12-23 05:07+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: fr\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Moins de propriétés"\n\nmsgid "More Properties"\nmsgstr "Plus de propriétés"\n\nmsgid "Frame rate"\nmsgstr "Fréquence"\n\nmsgid "fps"\nmsgstr "fps"\n\nmsgid "Speed"\nmsgstr "Vélocité"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D total"\n\nmsgid "Traitement des événements"\nmsgstr "Routes"\n\nmsgid "Pointer"\nmsgstr "Pointeur"\n\nmsgid "Camera"\nmsgstr "Caméra"\n\nmsgid "Collision Detection"\nmsgstr "Détection des collisions"\n\nmsgid "Rendering"\nmsgstr "Rendement"\n\nmsgid "Number of Shapes"\nmsgstr "Nombre de formes"\n\nmsgid "Number of Sensors"\nmsgstr "Nombre de senseurs"\n\nmsgid "Browser Timings"\nmsgstr "Calcul du temps"\n\nmsgid "X_ITE Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "Viewpoints"\nmsgstr "Points de vue"\n\nmsgid "Available Viewers"\nmsgstr "Visionneurs disponibles"\n\nmsgid "Straighten Horizon"\nmsgstr "Redresser l\'horizon"\n\nmsgid "Primitive Quality"\nmsgstr "Qualité des objets simples"\n\nmsgid "High"\nmsgstr "Haut"\n\nmsgid "high"\nmsgstr "haut"\n\nmsgid "Medium"\nmsgstr "Moyenne"\n\nmsgid "medium"\nmsgstr "moyenne"\n\nmsgid "Low"\nmsgstr "Faible"\n\nmsgid "low"\nmsgstr "faible"\n\nmsgid "Texture Quality"\nmsgstr "Qualité des textures"\n\nmsgid "Display Rubberband"\nmsgstr "Présenter le bande élastique"\n\nmsgid "Rubberband"\nmsgstr "Bande élastique"\n\nmsgid "on"\nmsgstr "marche"\n\nmsgid "off"\nmsgstr "arrêt"\n\nmsgid "Mute Browser"\nmsgstr "Rendre navigateur muet"\n\nmsgid "Browser muted"\nmsgstr "Navigateur muet"\n\nmsgid "Browser unmuted"\nmsgstr "Son de navigateur réactivé"\n\nmsgid "Leave Fullscreen"\nmsgstr "Sortie en plein écran"\n\nmsgid "Fullscreen"\nmsgstr "Plein écran"\n\nmsgid "About X_ITE"\nmsgstr "À propos de X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Examiner"\n\nmsgid "Walk Viewer"\nmsgstr "Aller"\n\nmsgid "Fly Viewer"\nmsgstr "Voler"\n\nmsgid "Plane Viewer"\nmsgstr "Visionneur de la plaine"\n\nmsgid "Look At Viewer"\nmsgstr "Regarder un objet de près"\n\nmsgid "None Viewer"\nmsgstr "Pas de visionneur"\n\nmsgid "Loading %1 file"\nmsgstr "Télécharger %1 fichier"\n\nmsgid "Loading %1 files"\nmsgstr "Télécharger %1 fichiers"\n\nmsgid "Loading done"\nmsgstr "Téléchargement fini"\n\nmsgid "Failed loading world."\nmsgstr "Le chargement des fichiers a échoué."\n\nmsgid "Show World Info"\nmsgstr "Afficher World Info"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Le point de vue est copié dans le presse-papiers."\n'},ii=/msgid\s+"(.*?)"\nmsgstr\s+"(.*?)"\n/g,oi=function(){for(const t of navigator.languages){const e=t.split("-")[0];if(ni[e])return e}return(navigator.language||navigator.userLanguage).split("-")[0]}();!function(t){if(ni[t]){const i=function(t,e){const n=[];let i=null;for(;i=t.exec(e);)n.push(i);return n}(ii,ni[t]),o=ni[t]={};for(var e=0,n=i.length;e<n;++e)i[e][2].length&&(o[i[e][1]]=i[e][2])}}(oi);const ri=function(t){const e=ni[oi];if(void 0===e)return t;const n=e[t];return void 0===n?t:n};function si(t){return t.toFixed(2)}function ai(t){Zn.call(this,t),this.localStorage=this.getBrowser().getLocalStorage().addNameSpace("BrowserTimings."),this.enabled=!1}ai.prototype=Object.assign(Object.create(Zn.prototype),{constructor:ai,getTypeName:function(){return"BrowserTimings"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserTimings"},initialize:function(){Zn.prototype.initialize.call(this),this.localStorage.addDefaultValues({type:"LESS"}),this.localeOptions={minimumFractionDigits:2,maximumFractionDigits:2},this.startTime=0,this.frames=0,this.element=$("<div></div>").hide().addClass("x_ite-private-browser-timings").appendTo(this.getBrowser().getSurface()),this.table=$("<table></table>").appendTo(this.element),this.header=$("<thead></thead>").append($("<tr></tr>").append($("<th colspan='2'></th>"))).appendTo(this.table),this.body=$("<tbody></tbody>").appendTo(this.table),this.footer=$("<tfoot></tfoot>").append($("<tr></tr>").append($("<td colspan='2'></td>"))).appendTo(this.table),this.button=$("<button></button>").attr("type","button").appendTo(this.footer.find("td")),this.rows=[],this.button.on("click touchend",this.set_type__.bind(this)),this.set_button__()},getEnabled:function(){return this.enabled},setEnabled:function(t){this.enabled!==t&&(this.enabled=t,t?(this.element.stop(!0,!0).fadeIn(),this.getBrowser().prepareEvents().addInterest("update",this),this.update()):(this.element.stop(!0,!0).fadeOut(),this.getBrowser().prepareEvents().removeInterest("update",this)))},set_type__:function(){"MORE"===this.localStorage.type?this.localStorage.type="LESS":this.localStorage.type="MORE",this.set_button__(),this.build()},set_button__:function(){"MORE"===this.localStorage.type?this.button.text(ri("Less Properties")):this.button.text(ri("More Properties"))},update:function(){const t=this.getBrowser().getCurrentTime();t-this.startTime>1?(this.build(),this.frames=0,this.startTime=t):++this.frames},build:function(){const t=this.getBrowser(),e=t.getCurrentTime(),n=navigator.language||navigator.userLanguage,i=this.localeOptions,o=this.rows;let r=0;if(o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Frame rate")+":")).append($("<td></td>").text(si(this.frames/(e-this.startTime)).toLocaleString(n,i)+" "+ri("fps"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Speed")+":")).append($("<td></td>").text(si(this.getSpeed(t.currentSpeed)).toLocaleString(n,i)+" "+this.getSpeedUnit(t.currentSpeed))),"MORE"===this.localStorage.type){const e=t.getWorld().getLayerSet().getLayers(),s=t.getActiveLayer(),a=t.getSystemTime(),u=s&&t.getCollisionCount()?s.collisionTime:0,c=t.getCollisionTime()+u,l=t.getBrowserTime()-(t.getCameraTime()+t.getCollisionTime()+t.getDisplayTime()+u),h=t.prepareEvents().getInterests().size-1,d=t.sensorEvents().getInterests().size;let f=0,p=0;for(const t of e)f+=t.numOpaqueShapes,p+=t.numTransparentShapes;o[1].addClass("x_ite-private-more"),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Browser")+":")).append($("<td></td>").text(si(a).toLocaleString(n,i)+" "+ri("ms"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("X3D total")+":")).append($("<td></td>").text(si(t.getBrowserTime()).toLocaleString(n,i)+" "+ri("ms"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Event Processing")+":")).append($("<td></td>").text(si(l).toLocaleString(n,i)+" "+ri("ms"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Pointer")+":")).append($("<td></td>").text(si(t.getPointerTime()).toLocaleString(n,i)+" "+ri("ms"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Camera")+":")).append($("<td></td>").text(si(t.getCameraTime()).toLocaleString(n,i)+" "+ri("ms"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Picking")+":")).append($("<td></td>").text(si(t.getPickingTime()).toLocaleString(n,i)+" "+ri("ms"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Collision Detection")+":")).append($("<td></td>").text(si(c).toLocaleString(n,i)+" "+ri("ms"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Rendering")+":")).append($("<td></td>").text(si(t.getDisplayTime()).toLocaleString(n,i)+" "+ri("ms"))),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Number of Shapes")+":")).append($("<td></td>").text(f+" + "+p)),o[r++]=$("<tr></tr>").append($("<td></td>").text(ri("Number of Sensors")+":")).append($("<td></td>").text(h+d))}o.length=r,this.header.find("th").text(ri("Browser Timings")),this.body.empty(),this.body.append(o)},getSpeed:function(t){return t<15?t:3.6*t},getSpeedUnit:function(t){return ri(t<15?"m/s":"km/h")}});const ui=ai;let ci=0;const li={LOW:ci++,MEDIUM:ci++,HIGH:ci++};let hi=0;const di={POINT:hi++,WIREFRAME:hi++,FLAT:hi++,GOURAUD:hi++,PHONG:hi++};let fi=0;const pi={LOW:fi++,MEDIUM:fi++,HIGH:fi++};function gi(t){Zn.call(this,t),this.addAlias("AntiAliased",this._Antialiased);const e=this.getBrowser();this.localStorage=e.getLocalStorage().addNameSpace("BrowserOptions."),this.textureQuality=pi.MEDIUM,this.primitiveQuality=li.MEDIUM,this.shading=di.GOURAUD,this.setAttributeSplashScreen()}function mi(t,e){return"TRUE"===(t=String(t).toUpperCase())||"FALSE"!==t&&e}gi.prototype=Object.assign(Object.create(Zn.prototype),{constructor:gi,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"SplashScreen",new Bn.SFBool(!0)),new z(o.inputOutput,"Dashboard",new Bn.SFBool(!0)),new z(o.inputOutput,"Rubberband",new Bn.SFBool(!0)),new z(o.inputOutput,"EnableInlineViewpoints",new Bn.SFBool(!0)),new z(o.inputOutput,"Antialiased",new Bn.SFBool(!0)),new z(o.inputOutput,"TextureQuality",new Bn.SFString("MEDIUM")),new z(o.inputOutput,"PrimitiveQuality",new Bn.SFString("MEDIUM")),new z(o.inputOutput,"QualityWhenMoving",new Bn.SFString("MEDIUM")),new z(o.inputOutput,"Shading",new Bn.SFString("GOURAUD")),new z(o.inputOutput,"MotionBlur",new Bn.SFBool),new z(o.inputOutput,"Gravity",new Bn.SFFloat(9.80665)),new z(o.inputOutput,"StraightenHorizon",new Bn.SFBool(!0)),new z(o.inputOutput,"LogarithmicDepthBuffer",new Bn.SFBool(!1)),new z(o.inputOutput,"Timings",new Bn.SFBool(!1))]),getTypeName:function(){return"BrowserOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserOptions"},initialize:function(){Zn.prototype.initialize.call(this),this.localStorage.addDefaultValues({Rubberband:this._Rubberband.getValue(),PrimitiveQuality:this._PrimitiveQuality.getValue(),TextureQuality:this._TextureQuality.getValue(),StraightenHorizon:this._StraightenHorizon.getValue(),Timings:this._Timings.getValue()}),this._SplashScreen.addInterest("set_splashScreen__",this),this._Rubberband.addInterest("set_rubberband__",this),this._PrimitiveQuality.addInterest("set_primitiveQuality__",this),this._TextureQuality.addInterest("set_textureQuality__",this),this._Shading.addInterest("set_shading__",this),this._StraightenHorizon.addInterest("set_straightenHorizon__",this),this._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this._Timings.addInterest("set_timings__",this),this.configure()},configure:function(){const t=this.localStorage;for(const e of this.getFieldDefinitions()){const n=this.getField(e.name);void 0===t[e.name]&&(n.equals(e.value)||n.assign(e.value))}const e=t.Rubberband,n=t.PrimitiveQuality,i=t.TextureQuality,o=t.StraightenHorizon,r=t.Timings;this.setAttributeSplashScreen(),e!==this._Rubberband.getValue()&&(this._Rubberband=e),n!==this._PrimitiveQuality.getValue()&&(this._PrimitiveQuality=n),i!==this._TextureQuality.getValue()&&(this._TextureQuality=i),o!==this._StraightenHorizon.getValue()&&(this._StraightenHorizon=o),r!==this._Timings.getValue()&&(this._Timings=r)},setAttributeSplashScreen:function(){this._SplashScreen.set(this.getSplashScreen())},getCache:function(){return mi(this.getBrowser().getElement().attr("cache"),!0)},getContextMenu:function(){return mi(this.getBrowser().getElement().attr("contextMenu"),!0)},getDebug:function(){return mi(this.getBrowser().getElement().attr("debug"),!1)},getNotifications:function(){return mi(this.getBrowser().getElement().attr("notifications"),!0)},getSplashScreen:function(){return mi(this.getBrowser().getElement().attr("splashScreen"),!0)},getPrimitiveQuality:function(){return this.primitiveQuality},getShading:function(){return this.shading},getTextureQuality:function(){return this.textureQuality},set_splashScreen__:function(t){this.getBrowser().getElement().attr("splashScreen",t.getValue()?"true":"false")},set_rubberband__:function(t){this.localStorage.Rubberband=t.getValue()},set_primitiveQuality__:function(t){const e=this.getBrowser(),n=t.getValue().toUpperCase();this.localStorage.PrimitiveQuality=n,this.primitiveQuality=this.getEnum(li,n,li.MEDIUM),"function"==typeof e.setPrimitiveQuality2D&&e.setPrimitiveQuality2D(this.primitiveQuality),"function"==typeof e.setPrimitiveQuality3D&&e.setPrimitiveQuality3D(this.primitiveQuality)},set_textureQuality__:function(t){const e=this.getBrowser(),n=t.getValue().toUpperCase();this.localStorage.TextureQuality=n,this.textureQuality=this.getEnum(pi,n,pi.MEDIUM),"function"==typeof e.setTextureQuality&&e.setTextureQuality(this.textureQuality)},set_shading__:function(){const t={[di.POINT]:"POINT",[di.WIREFRAME]:"WIREFRAME",[di.FLAT]:"FLAT",[di.GOURAUD]:"GOURAUD",[di.PHONG]:"PHONG"};return function(e){const n=this.getBrowser(),i=e.getValue().toUpperCase().replace("POINTSET","POINT");this.shading=this.getEnum(di,i,di.GOURAUD),n.getRenderingProperties()._Shading=t[this.shading],n.setShading(this.shading)}}(),set_straightenHorizon__:function(t){this.localStorage.StraightenHorizon=t.getValue()},set_logarithmicDepthBuffer__:function(t){const e=this.getBrowser(),n=e.getContext();e.getRenderingProperties()._LogarithmicDepthBuffer=t.getValue()&&n.HAS_FEATURE_FRAG_DEPTH},set_timings__:function(t){this.localStorage.Timings=t.getValue(),this.getBrowser().getBrowserTimings().setEnabled(t.getValue())}});const _i=gi;function xi(t){Zn.call(this,t)}xi.prototype=Object.assign(Object.create(Zn.prototype),{constructor:xi,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.initializeOnly,"ABSTRACT_NODES",new Bn.SFBool(!0)),new z(o.initializeOnly,"CONCRETE_NODES",new Bn.SFBool(!0)),new z(o.initializeOnly,"EXTERNAL_INTERACTIONS",new Bn.SFBool(!0)),new z(o.initializeOnly,"PROTOTYPE_CREATE",new Bn.SFBool(!0)),new z(o.initializeOnly,"DOM_IMPORT",new Bn.SFBool(!0)),new z(o.initializeOnly,"XML_ENCODING",new Bn.SFBool(!0)),new z(o.initializeOnly,"CLASSIC_VRML_ENCODING",new Bn.SFBool(!0)),new z(o.initializeOnly,"BINARY_ENCODING",new Bn.SFBool)]),getTypeName:function(){return"BrowserProperties"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserProperties"}});const yi=xi;function wi(t){Zn.call(this,t),this.addAlias("AntiAliased",this._Antialiased)}wi.prototype=Object.assign(Object.create(Zn.prototype),{constructor:wi,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.outputOnly,"Shading",new Bn.SFString),new z(o.outputOnly,"MaxTextureSize",new Bn.SFInt32),new z(o.outputOnly,"TextureUnits",new Bn.SFInt32),new z(o.outputOnly,"MaxLights",new Bn.SFInt32),new z(o.outputOnly,"Antialiased",new Bn.SFBool(!0)),new z(o.outputOnly,"ColorDepth",new Bn.SFInt32),new z(o.outputOnly,"TextureMemory",new Bn.SFDouble),new z(o.outputOnly,"LogarithmicDepthBuffer",new Bn.SFBool(!1))]),getTypeName:function(){return"RenderingProperties"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"renderingProperties"},initialize:function(){Zn.prototype.initialize.call(this);const t=this.getBrowser();this._MaxTextureSize=t.getMaxTextureSize(),this._TextureUnits=t.getMaxCombinedTextureUnits(),this._MaxLights=t.getMaxLights(),this._ColorDepth=t.getColorDepth(),this._TextureMemory=t.getTextureMemory()}});const Ti=wi;function Si(t){Zn.call(this,t),this.addChildObjects("string",new Qe)}$.fn.textWidth=function(t){const e=$(this).children(),n="<span>"+$(this).html()+"</span>";$(this).html(n);const i=$(this).find("span:first").width();return $(this).empty(),$(this).append(e),i},Si.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Si,getTypeName:function(){return"Notification"},getComponentName:function(){return"X_ITE"},initialize:function(){Zn.prototype.initialize.call(this),this.element=$("<div></div>").hide().addClass("x_ite-private-notification").appendTo(this.getBrowser().getSurface()).animate({width:0}),$("<span></span>").appendTo(this.element),this._string.addInterest("set_string__",this)},set_string__:function(){this.getBrowser().getBrowserOptions().getNotifications()&&0!==this._string.length&&(this.element.children().text(this._string.getValue()),this.element.stop(!0,!0).fadeIn(0).animate({width:this.element.textWidth()}).animate({delay:1},5e3).animate({width:0}).fadeOut(0))}});const bi=Si;function vi(t){var e,n;return this.length?((e=this[0]).ownerDocument?n=e.ownerDocument:e=(n=e).documentElement,null==t?n.exitFullscreen||n.webkitExitFullscreen||n.webkitCancelFullScreen||n.msExitFullscreen||n.mozCancelFullScreen?(t=!!(n.fullscreenElement||n.msFullscreenElement||n.webkitIsFullScreen||n.mozFullScreen))&&(n.fullscreenElement||n.webkitFullscreenElement||n.webkitCurrentFullScreenElement||n.msFullscreenElement||n.mozFullScreenElement)||t:null:(t?(t=e.requestFullscreen||e.webkitRequestFullscreen||e.webkitRequestFullScreen||e.msRequestFullscreen||e.mozRequestFullScreen)&&t.call(e):(t=n.exitFullscreen||n.webkitExitFullscreen||n.webkitCancelFullScreen||n.msExitFullscreen||n.mozCancelFullScreen)&&t.call(n),this)):this}var Ei,Ci,Oi;jQuery.fn.fullScreen=vi,jQuery.fn.toggleFullScreen=function(){return vi.call(this,!vi.call(this))},(Ei=document).webkitCancelFullScreen?(Ci="webkitfullscreenchange",Oi="webkitfullscreenerror"):Ei.msExitFullscreen?(Ci="MSFullscreenChange",Oi="MSFullscreenError"):Ei.mozCancelFullScreen?(Ci="mozfullscreenchange",Oi="mozfullscreenerror"):(Ci="fullscreenchange",Oi="fullscreenerror"),jQuery(document).bind(Ci,(function(){jQuery(document).trigger(new jQuery.Event("fullscreenchange"))})),jQuery(document).bind(Oi,(function(){jQuery(document).trigger(new jQuery.Event("fullscreenerror"))}));const Fi=Symbol();function Ni(t){Zn.call(this,t),this[Fi]=null}Ni.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Ni,getTypeName:function(){return"ContextMenu"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"contextMenu"},initialize:function(){Zn.prototype.initialize.call(this);const t=this.getBrowser();this.init({element:t.getElement(),appendTo:t.getShadow(),build:this.build.bind(this),animation:{duration:500,show:"fadeIn",hide:"fadeOut"}})},getUserMenu:function(){return this[Fi]},setUserMenu:function(t){this[Fi]=t},createUserMenu:function(){const t={};if("function"==typeof this[Fi]){const e=this[Fi]();if($.isPlainObject(e))for(const n in e)t["user-"+n]=e[n]}return t},build:function(t){const e=this.getBrowser(),n=e.getActiveLayer(),i=(n&&n.getViewpoint(),e.getElement().fullScreen());if(!e.getBrowserOptions().getContextMenu())return;const o={className:"x_ite-private-menu",items:{title:{name:e.getName()+" Browser v"+e.getVersion(),className:"context-menu-title context-menu-not-selectable"},separator0:"--------",viewpoints:{name:ri("Viewpoints"),className:"context-menu-icon x_ite-private-icon-viewpoint",items:this.getViewpoints()},"available-viewers":{name:ri("Available Viewers"),items:this.getAvailableViewers()},"straighten-horizon":{name:ri("Straighten Horizon"),type:"checkbox",selected:e.getBrowserOption("StraightenHorizon"),events:{click:function(t){const n=$(t.target).is(":checked");if(e.setBrowserOption("StraightenHorizon",n),n){e.getNotification()._string=ri("Straighten Horizon")+": "+ri("on");const t=e.getActiveViewpoint();t&&t.straighten(e.getActiveLayer(),!0)}else e.getNotification()._string=ri("Straighten Horizon")+": "+ri("off")}.bind(this)}},"display-rubberband":{name:ri("Display Rubberband"),type:"checkbox",selected:e.getBrowserOption("Rubberband"),events:{click:function(t){const n=$(t.target).is(":checked");e.setBrowserOption("Rubberband",n),e.getNotification()._string=n?ri("Rubberband")+": "+ri("on"):ri("Rubberband")+": "+ri("off")}.bind(this)}},separator1:"--------","primitive-quality":{name:ri("Primitive Quality"),className:"context-menu-icon x_ite-private-icon-primitive-quality",items:{high:{name:ri("High"),type:"radio",radio:"primitive-quality",selected:"HIGH"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","HIGH"),e.getNotification()._string=ri("Primitive Quality")+": "+ri("high")}.bind(this)}},medium:{name:ri("Medium"),type:"radio",radio:"primitive-quality",selected:"MEDIUM"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","MEDIUM"),e.getNotification()._string=ri("Primitive Quality")+": "+ri("medium")}.bind(this)}},low:{name:ri("Low"),type:"radio",radio:"primitive-quality",selected:"LOW"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","LOW"),e.getNotification()._string=ri("Primitive Quality")+": "+ri("low")}.bind(this)}}}},"texture-quality":{name:ri("Texture Quality"),className:"context-menu-icon x_ite-private-icon-texture-quality",items:{high:{name:ri("High"),type:"radio",radio:"texture-quality",selected:"HIGH"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","HIGH"),e.getNotification()._string=ri("Texture Quality")+": "+ri("high")}.bind(this)}},medium:{name:ri("Medium"),type:"radio",radio:"texture-quality",selected:"MEDIUM"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","MEDIUM"),e.getNotification()._string=ri("Texture Quality")+": "+ri("medium")}.bind(this)}},low:{name:ri("Low"),type:"radio",radio:"texture-quality",selected:"LOW"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","LOW"),e.getNotification()._string=ri("Texture Quality")+": "+ri("low")}.bind(this)}}}},shading:{name:ri("Shading"),className:"context-menu-icon x_ite-private-icon-shading",items:{point:{name:ri("Point"),type:"radio",radio:"shading",selected:"POINT"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","POINT"),e.getNotification()._string=ri("Shading")+": "+ri("Point")}.bind(this)}},wireframe:{name:ri("Wireframe"),type:"radio",radio:"shading",selected:"WIREFRAME"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","WIREFRAME"),e.getNotification()._string=ri("Shading")+": "+ri("Wireframe")}.bind(this)}},flat:{name:ri("Flat"),type:"radio",radio:"shading",selected:"FLAT"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","FLAT"),e.getNotification()._string=ri("Shading")+": "+ri("Flat")}.bind(this)}},gouraud:{name:ri("Gouraud"),type:"radio",radio:"shading",selected:"GOURAUD"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","GOURAUD"),e.getNotification()._string=ri("Shading")+": "+ri("Gouraud")}.bind(this)}},phong:{name:ri("Phong"),type:"radio",radio:"shading",selected:"PHONG"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","PHONG"),e.getNotification()._string=ri("Shading")+": "+ri("Phong")}.bind(this)}}}},separator2:"--------","browser-timings":{name:ri("Browser Timings"),type:"checkbox",selected:e.getBrowserOption("Timings"),events:{click:function(t){e.setBrowserOption("Timings",$(t.target).is(":checked")),e.getSurface().focus()}.bind(this)}},fullscreen:{name:ri(i?"Leave Fullscreen":"Fullscreen"),className:"context-menu-icon "+(i?"x_ite-private-icon-leave-fullscreen":"x_ite-private-icon-enter-fullscreen"),callback:function(){e.getElement().toggleFullScreen()}.bind(this)},separator3:"--------"}};Object.assign(o.items,this.createUserMenu()),Object.assign(o.items,{separator4:"--------","world-info":{name:ri("Show World Info"),className:"context-menu-icon x_ite-private-icon-world-info",callback:function(){const t=e.getShadow().find(".x_ite-private-browser"),n=$("<div></div>").addClass("x_ite-private-world-info-overlay").appendTo(t),i=$("<div></div>").addClass("x_ite-private-world-info").appendTo(n),o=e.getExecutionContext().getWorldInfos()[0],r=o.title,s=o.info;e.getShadow().find(".x_ite-private-world-info").remove(),$("<div></div>").addClass("x_ite-private-world-info-top").text("World Info").appendTo(i),r.length&&$("<div></div>").addClass("x_ite-private-world-info-title").text(r).appendTo(i);for(const t of s)$("<div></div>").addClass("x_ite-private-world-info-info").text(t).appendTo(i);i.find("a").on("click",(function(t){t.stopPropagation()})),i.find("a[href^=http]").each((function(){-1===this.href.indexOf(location.hostname)&&$(this).attr("target","_blank")})),n.on("click",(function(){n.remove()}))}},about:{name:ri("About X_ITE"),className:"context-menu-icon x_ite-private-icon-help-about",callback:function(){window.open(e.getProviderUrl())}}}),$.isEmptyObject(o.items.viewpoints.items)&&delete o.items.viewpoints,Object.keys(o.items["available-viewers"].items).length<2&&delete o.items["available-viewers"],e.getCurrentViewer().match(/^(?:EXAMINE|FLY)$/)||delete o.items["straighten-horizon"],e.getDebug()||delete o.items.shading;const r=e.getExecutionContext().getWorldInfos()[0];return(!r||0===r.title.length&&0===r.info.length)&&delete o.items["world-info"],o},getViewpoints:function(){const t=this.getBrowser(),e=t.getActiveLayer();if(!e)return{};const n=t.getBrowserOption("EnableInlineViewpoints"),i=t.currentScene,o=e.getViewpoints().get(),r=e.getViewpoint(),s={};for(const e of o){const o=e._description.getValue();if(""===o)continue;if(!n&&e.getScene()!==i)continue;const a={name:o,callback:function(e){t.bindViewpoint(t.getActiveLayer(),e),t.getSurface().focus()}.bind(this,e)};e===r&&(a.className="context-menu-selected"),s["Viewpoint"+e.getId()]=a}return s},getAvailableViewers:function(){const t=this.getBrowser(),e=t._viewer.getValue(),n=t._availableViewers,i={};for(const o of n)i[o]={name:ri(this.getViewerName(o)),className:"context-menu-icon x_ite-private-icon-"+o.toLowerCase()+"-viewer",callback:function(e){t._viewer=e,t.getNotification()._string=ri(this.getViewerName(e)),t.getSurface().focus()}.bind(this,o)},o===e&&(i[o].className+=" context-menu-selected");return i},getViewerName:function(t){switch(t){case"EXAMINE":return ri("Examine Viewer");case"WALK":return ri("Walk Viewer");case"FLY":return ri("Fly Viewer");case"PLANE":return ri("Plane Viewer");case"LOOKAT":return ri("Look At Viewer");case"NONE":return ri("None Viewer")}},init:function(t){this.show=this.createRoot.bind(this,t),t.element.on("contextmenu",this.show)},show:function(t){},hide:function(t){},createRoot:function(t,e){const n=t.build(e);if(!n)return;const i=$("<div></div>").addClass("context-menu-layer").addClass(n.className).appendTo(t.appendTo),o=this.hide=function(){return delete this.hide,i.remove(),a[t.animation.hide](t.animation.duration,(function(){a.remove(),t.events&&"function"==typeof t.events.hide&&t.events.hide()})),!1}.bind(this),r=e.pageX-$(document).scrollLeft(),s=e.pageY-$(document).scrollTop(),a=$("<ul></ul>").hide().addClass("context-menu-list").addClass(n.className).addClass("context-menu-root").css({left:r,top:s}).appendTo(t.appendTo);for(const t in n.items)a.append(this.createItem(n.items[t],"context-menu-root",t,2,o));return a[t.animation.show](t.animation.duration),a.offset().left-$(document).scrollLeft()+a.outerWidth()>$(window).width()&&a.offset({left:$(document).scrollLeft()+Math.max(0,$(window).width()-a.outerWidth())}),a.offset().top-$(document).scrollTop()+a.outerHeight()>$(window).height()&&a.offset({top:$(document).scrollTop()+Math.max(0,$(window).height()-a.outerHeight())}),a.find("ul").each((function(t,e){const n=(e=$(e)).outerWidth()+a.outerWidth(),i=a.offset().left-$(document).scrollLeft()+n>$(window).width()?"right":"left";e.css("width",e.outerWidth()),e.css(i,e.parent().closest("ul").width()),e.outerHeight()>=$(window).height()&&e.css({"max-height":"100vh","overflow-y":"scroll"})})),a.find("li").on("mouseenter touchstart",(function(t){t.stopImmediatePropagation();const e=$(t.target).closest("li").children("ul");if(!e.length)return;e.css("top","");const n=e.offset().top+e.outerHeight()-$(window).scrollTop()-$(window).height();n>0&&e.offset({top:e.offset().top-n})})),i.on("click contextmenu",o),a.on("contextmenu",o),t.events&&"function"==typeof t.events.show&&t.events.show(a),!1},createItem:function(t,e,n,i,o){const r=$("<li></li>").addClass("context-menu-item");switch(typeof t){case"string":t.match(/^-+$/)&&r.addClass(["context-menu-separator","context-menu-not-selectable"]);break;case"object":switch(t.className&&r.addClass(t.className),t.type){case"radio":case"checkbox":{const n=$("<label></label>").appendTo(r),i=$("<input></input>").appendTo(n);i.attr("type",t.type).attr("name","context-menu-input-"+(t.radio||e)),$("<span></span>").text(t.name).appendTo(n),t.selected&&i.attr("checked","checked");for(const e in t.events)"function"==typeof t.events[e]&&i.on(e,t.events[e]);r.addClass("context-menu-input");break}default:t.name&&$("<span></span>").text(t.name).appendTo(r),"function"==typeof t.callback&&r.on("click",t.callback).on("click",o)}}if("object"==typeof t.items&&i<3){const e=$("<ul></ul>").addClass("context-menu-list").css({"z-index":i}).appendTo(r);for(const r in t.items)e.append(this.createItem(t.items[r],n,r,i+1,o));r.addClass("context-menu-submenu")}return r}});const Mi=Ni,Vi=new Map,Ii=new Map,Di={addNodeTypeName:function(t){Vi.set(t,t),Vi.set(t.toUpperCase(),t)},getNodeTypeName:function(t){return Vi.get(t)},addFieldName:function(t){Ii.set(t,t),Ii.set(t.toLowerCase(),t)},getFieldName:function(t){return Ii.get(t)}},Ri=new Map,Pi=new Map;let Ai=o.X3DBaseNode;function Li(){}Li.prototype={addType:function(t,e){o[t]=++Ai,Ri.set(t,e),Di.addNodeTypeName(t);for(const t of e.prototype[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]){const e=t.name;t.accessType&o.initializeOnly&&Di.addFieldName(e)}},getType:function(t){return Ri.get(t)},getTypes:()=>Array.from(Ri.values()),addAbstractType:function(t,e){o[t]=++Ai,Pi.set(t,e)},getAbstractType:function(t){return Pi.get(t)},getAbstractTypes:()=>Array.from(Pi.values())};for(const t of Reflect.ownKeys(Li.prototype))Object.defineProperty(Li.prototype,t,{enumerable:!1});const Bi=new Li;function Xi(t){return q.call(this,t)}Xi.prototype=Object.assign(Object.create(q.prototype),{constructor:Xi,getTypeName:function(){return"NamedNodesArray"}});for(const t of Reflect.ownKeys(Xi.prototype))Object.defineProperty(Xi.prototype,t,{enumerable:!1});const Ui=Xi;function zi(t){Zn.call(this,t),this.addType(o.X3DNode)}zi.prototype=Object.assign(Object.create(Zn.prototype),{constructor:zi,copy:function(t){if(!t||t.getType().includes(o.X3DExecutionContext))return Zn.prototype.copy.call(this,t);{const e=t.getBody();if(this.getName().length){const t=e.getNamedNodes().get(this.getName());if(t)return t}const n=this.create(e);this.getNeedsName()&&this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(),this),this.getName().length&&e.updateNamedNode(this.getName(),n);for(const e of this.getPredefinedFields())try{const i=n.getField(e.getName());if(e.hasReferences())for(const n of e.getReferences())try{i.addReference(t.getField(n.getName()))}catch(t){console.error(t.message)}else if(e.getAccessType()&o.initializeOnly)switch(e.getType()){case o.SFNode:case o.MFNode:i.assign(e.copy(t));break;default:i.assign(e)}i.setModificationTime(e.getModificationTime())}catch(t){console.log(t.message)}for(const e of this.getUserDefinedFields()){const i=e.copy(t);if(n.addUserDefinedField(e.getAccessType(),e.getName(),i),e.hasReferences())for(const n of e.getReferences())try{i.addReference(t.getField(n.getName()))}catch(e){console.error("No reference '"+n.getName()+"' inside execution context "+t.getTypeName()+" '"+t.getName()+"'.")}i.setModificationTime(e.getModificationTime())}return n.setup(),n}},getDisplayName:function(){const t=/_\d+$/;return function(){return this.getName().replace(t,"")}}(),getNeedsName:function(){if(this.getName().length)return!1;if(this.getCloneCount()>1)return!0;if(this.hasRoutes())return!0;const t=this.getExecutionContext();for(const e of t.getImportedNodes())if(e.getInlineNode()===this)return!0;if(t.isScene())for(const e of t.getExportedNodes())if(e.getLocalNode()===this)return!0;return!1},getFieldsAreEnumerable:function(){return!0},traverse:function(){},toStream:function(t){t.string+=this.getTypeName()+" { }"},toVRMLStream:function(t){const e=s.Get(t);e.EnterScope();const n=e.Name(this);if(n.length&&e.ExistsNode(this))return t.string+="USE",t.string+=" ",t.string+=n,void e.LeaveScope();n.length&&(e.AddNode(this),t.string+="DEF",t.string+=" ",t.string+=n,t.string+=" "),t.string+=this.getTypeName(),t.string+=" ",t.string+="{";const i=this.getChangedFields(),o=this.getUserDefinedFields();let r=0,a=0;if(this.canUserDefinedFields()){for(const t of o)r=Math.max(r,t.getTypeName().length),a=Math.max(a,e.AccessType(t.getAccessType()).length);if(o.length){t.string+="\n",e.IncIndent();for(const e of o)this.toVRMLStreamUserDefinedField(t,e,r,a),t.string+="\n";e.DecIndent(),0!==i.length&&(t.string+="\n")}}0===i.length?o.length?t.string+=e.Indent():t.string+=" ":(0===o.length&&(t.string+="\n"),e.IncIndent(),i.forEach((function(e){this.toVRMLStreamField(t,e,r,a),t.string+="\n"}),this),e.DecIndent(),t.string+=e.Indent()),t.string+="}",e.LeaveScope()},toVRMLStreamField:function(t,e,n,i){const r=s.Get(t),a=r.IsSharedNode(this);if(0===e.getReferences().size||!r.ExecutionContext()||a)e.isInitializable()&&(t.string+=r.Indent(),t.string+=e.getName(),t.string+=" ",e.toVRMLStream(t));else{let n=0,i=!1;e.getReferences().forEach((function(o){i=i||o.isInitializable(),t.string+=r.Indent(),t.string+=e.getName(),t.string+=" ",t.string+="IS",t.string+=" ",t.string+=o.getName(),++n,n!==e.getReferences().size&&(t.string+="\n")})),e.getAccessType()!==o.inputOutput||i||this.isDefaultValue(e)||(t.string+="\n",t.string+=r.Indent(),t.string+=e.getName(),t.string+=" ",e.toVRMLStream(t))}},toVRMLStreamUserDefinedField:function(t,e,n,i){const r=s.Get(t),a=r.IsSharedNode(this);if(0===e.getReferences().size||!r.ExecutionContext()||a)t.string+=r.Indent(),t.string+=r.PadRight(r.AccessType(e.getAccessType()),i),t.string+=" ",t.string+=r.PadRight(e.getTypeName(),n),t.string+=" ",t.string+=e.getName(),e.isInitializable()&&(t.string+=" ",e.toVRMLStream(t));else{let s=0,a=!1;e.getReferences().forEach((function(o){a=a||o.isInitializable(),t.string+=r.Indent(),t.string+=r.PadRight(r.AccessType(e.getAccessType()),i),t.string+=" ",t.string+=r.PadRight(e.getTypeName(),n),t.string+=" ",t.string+=e.getName(),t.string+=" ",t.string+="IS",t.string+=" ",t.string+=o.getName(),++s,s!==e.getReferences().size&&(t.string+="\n")})),e.getAccessType()!==o.inputOutput||a||e.isDefaultValue()||(t.string+="\n",t.string+=r.Indent(),t.string+=r.PadRight(r.AccessType(e.getAccessType()),i),t.string+=" ",t.string+=r.PadRight(e.getTypeName(),n),t.string+=" ",t.string+=e.getName(),e.isInitializable()&&(t.string+=" ",e.toVRMLStream(t)))}},toXMLStream:function(t){const e=s.Get(t),n=e.IsSharedNode(this);e.EnterScope();const i=e.Name(this);if(i.length&&e.ExistsNode(this)){t.string+=e.Indent(),t.string+="<",t.string+=this.getTypeName(),t.string+=" ",t.string+="USE='",t.string+=e.XMLEncode(i),t.string+="'";const n=e.ContainerField();return n&&n.getName()!==this.getContainerField()&&(t.string+=" ",t.string+="containerField='",t.string+=e.XMLEncode(n.getName()),t.string+="'"),t.string+="/>",void e.LeaveScope()}t.string+=e.Indent(),t.string+="<",t.string+=this.getTypeName(),i.length&&(e.AddNode(this),t.string+=" ",t.string+="DEF='",t.string+=e.XMLEncode(i),t.string+="'");const r=e.ContainerField();r&&r.getName()!==this.getContainerField()&&(t.string+=" ",t.string+="containerField='",t.string+=e.XMLEncode(r.getName()),t.string+="'");const a=this.getChangedFields(),u=this.getUserDefinedFields(),c=[],l=[];let h=this.getSourceText();h&&0===h.length&&(h=null),e.IncIndent(),e.IncIndent();for(const i of a){let r=!1;if(e.ExecutionContext()&&i.getAccessType()===o.inputOutput&&0!==i.getReferences().size){let t=!1;i.getReferences().forEach((function(e){t=t||e.isInitializable()})),t||(r=!this.isDefaultValue(i))}if(0===i.getReferences().size||!e.ExecutionContext()||n||r){if(r&&c.push(i),i.isInitializable())switch(i.getType()){case o.SFNode:case o.MFNode:l.push(i);break;default:if(i===h)break;t.string+="\n",t.string+=e.Indent(),t.string+=i.getName(),t.string+="='",i.toXMLStream(t),t.string+="'"}}else c.push(i)}if(e.DecIndent(),e.DecIndent(),this.canUserDefinedFields()&&u.length||c.length&&!n||l.length||h){if(t.string+=">\n",e.IncIndent(),this.canUserDefinedFields())for(const i of u){t.string+=e.Indent(),t.string+="<field",t.string+=" ",t.string+="accessType='",t.string+=e.AccessType(i.getAccessType()),t.string+="'",t.string+=" ",t.string+="type='",t.string+=i.getTypeName(),t.string+="'",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(i.getName()),t.string+="'";let r=!1;if(i.getAccessType()===o.inputOutput&&0!==i.getReferences().size){let t=!1;i.getReferences().forEach((function(e){t=t||e.isInitializable()})),t||(r=!0)}if(0===i.getReferences().size||!e.ExecutionContext()||n||r)if(r&&e.ExecutionContext()&&c.push(i),!i.isInitializable()||i.isDefaultValue())t.string+="/>\n";else switch(i.getType()){case o.SFNode:case o.MFNode:e.PushContainerField(i),t.string+=">\n",e.IncIndent(),i.toXMLStream(t),t.string+="\n",e.DecIndent(),t.string+=e.Indent(),t.string+="</field>\n",e.PopContainerField();break;default:t.string+=" ",t.string+="value='",i.toXMLStream(t),t.string+="'",t.string+="/>\n"}else e.ExecutionContext()&&c.push(i),t.string+="/>\n"}if(c.length&&!n){t.string+=e.Indent(),t.string+="<IS>",t.string+="\n",e.IncIndent();for(const n of c){n.getReferences().forEach((function(i){t.string+=e.Indent(),t.string+="<connect",t.string+=" ",t.string+="nodeField='",t.string+=e.XMLEncode(n.getName()),t.string+="'",t.string+=" ",t.string+="protoField='",t.string+=e.XMLEncode(i.getName()),t.string+="'",t.string+="/>\n"}))}e.DecIndent(),t.string+=e.Indent(),t.string+="</IS>\n"}for(const n of l)e.PushContainerField(n),n.toXMLStream(t),t.string+="\n",e.PopContainerField();if(h)for(const n of h)t.string+="<![CDATA[",t.string+=e.escapeCDATA(n),t.string+="]]>\n";e.DecIndent(),t.string+=e.Indent(),t.string+="</",t.string+=this.getTypeName(),t.string+=">"}else t.string+="/>";e.LeaveScope()},dispose:function(){const t=this.getExecutionContext();if(this.getName()&&t.removeNamedNode(this.getName()),!t.isMainScene()){const e=t.getExecutionContext();for(const t of e.getImportedNodes())try{t.getExportedNode()===this&&e.removeImportedNode(t.getImportedName())}catch(t){}}if(t.isScene())for(const e of t.getExportedNodes())e.getLocalNode()===this&&t.removeExportedNode(e.getExportedName());for(const t of this.getFields())t.dispose();for(const t of new Set(this.getParents()))if(t instanceof Bn.SFNode){for(const e of new Set(t.getParents()))if(e instanceof Bn.MFNode){const n=e.length;e.erase(e.remove(0,n,t),n)}t.setValue(null)}Zn.prototype.dispose.call(this)}});const ji=zi,ki=Symbol(),Gi=Symbol(),Hi=Symbol(),qi=Symbol();function Yi(t,e,n,i){ji.call(this,t),this[ki]=e,this[Gi]=n,this[Hi]=i,this[qi]=new Set,this[ki]._loadState.addInterest("set_loadState__",this)}Yi.prototype=Object.assign(Object.create(ji.prototype),{constructor:Yi,getInlineNode:function(){return this[ki]},getExportedName:function(){return this[Gi]},getExportedNode:function(){return this[ki].getInternalScene().getExportedNode(this[Gi]).getValue()},getImportedName:function(){return this[Hi]},addRoute:function(t,e,n,i){const r={sourceNode:t,sourceField:e,destinationNode:n,destinationField:i};this[qi].add(r),this[ki].checkLoadState()===o.COMPLETE_STATE&&this.resolveRoute(r)},resolveRoute:function(t){try{const e=t.sourceField,n=t.destinationField;let i=t.sourceNode,o=t.destinationNode;t.real&&t.real.dispose(),i instanceof Yi&&(i=i.getExportedNode()),o instanceof Yi&&(o=o.getExportedNode()),t.real=this.getExecutionContext().addSimpleRoute(i,e,o,n)}catch(t){console.error(t.message)}},deleteRoute:function(t){for(const e of this[qi])e.real===t&&this[qi].delete(e)},deleteRoutes:function(){for(const t of this[qi]){const e=t.real;e&&(delete t.real,this.getExecutionContext().deleteSimpleRoute(e))}},set_loadState__:function(){switch(this[ki].checkLoadState()){case o.NOT_STARTED_STATE:case o.FAILED_STATE:this.deleteRoutes();break;case o.COMPLETE_STATE:this.deleteRoutes();for(const t of this[qi])this.resolveRoute(t)}},toVRMLStream:function(t){const e=s.Get(t);if(!e.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");t.string+=e.Indent(),t.string+="IMPORT",t.string+=" ",t.string+=e.Name(this.getInlineNode()),t.string+=".",t.string+=this.getExportedName(),this.getImportedName()!==this.getExportedName()&&(t.string+=" ",t.string+="AS",t.string+=" ",t.string+=this.getImportedName());try{e.AddRouteNode(this),e.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(n){for(const n of this[qi]){const i=n.sourceNode,o=n.sourceField,r=n.destinationNode,s=n.destinationField;if(e.ExistsRouteNode(i)&&e.ExistsRouteNode(r)){const n=i instanceof Yi?i.getImportedName():e.Name(i),a=r instanceof Yi?r.getImportedName():e.Name(r);t.string+="\n",t.string+="\n",t.string+=e.Indent(),t.string+="ROUTE",t.string+=" ",t.string+=n,t.string+=".",t.string+=o,t.string+=" ",t.string+="TO",t.string+=" ",t.string+=a,t.string+=".",t.string+=s}}}},toXMLStream:function(t){const e=s.Get(t);if(!e.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");t.string+=e.Indent(),t.string+="<IMPORT",t.string+=" ",t.string+="inlineDEF='",t.string+=e.XMLEncode(e.Name(this.getInlineNode())),t.string+="'",t.string+=" ",t.string+="importedDEF='",t.string+=e.XMLEncode(this.getExportedName()),t.string+="'",this.getImportedName()!==this.getExportedName()&&(t.string+=" ",t.string+="AS='",t.string+=e.XMLEncode(this.getImportedName()),t.string+="'"),t.string+="/>";try{e.AddRouteNode(this),e.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(n){for(const n of this[qi]){const i=n.sourceNode,o=n.sourceField,r=n.destinationNode,s=n.destinationField;if(e.ExistsRouteNode(i)&&e.ExistsRouteNode(r)){const n=i instanceof Yi?i.getImportedName():e.Name(i),a=r instanceof Yi?r.getImportedName():e.Name(r);t.string+="\n",t.string+="\n",t.string+=e.Indent(),t.string+="<ROUTE",t.string+=" ",t.string+="fromNode='",t.string+=e.XMLEncode(n),t.string+="'",t.string+=" ",t.string+="fromField='",t.string+=e.XMLEncode(o),t.string+="'",t.string+=" ",t.string+="toNode='",t.string+=e.XMLEncode(a),t.string+="'",t.string+=" ",t.string+="toField='",t.string+=e.XMLEncode(s),t.string+="'",t.string+="/>"}}}},dispose:function(){this[ki]._loadState.removeInterest("set_loadState__",this),this.deleteRoutes(),ji.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(Yi.prototype))Object.defineProperty(Yi.prototype,t,{enumerable:!1});Object.defineProperty(Yi.prototype,"inlineNode",{get:function(){return Re.get(this[ki])},enumerable:!0,configurable:!1}),Object.defineProperty(Yi.prototype,"exportedName",{get:function(){return this[Gi]},enumerable:!0,configurable:!1}),Object.defineProperty(Yi.prototype,"exportedNode",{get:function(){return this[ki].getInternalScene().getExportedNode(this[Gi])},enumerable:!0,configurable:!1}),Object.defineProperty(Yi.prototype,"importedName",{get:function(){return this[Hi]},enumerable:!0,configurable:!1});const Wi=Yi;function $i(t){return q.call(this,t)}$i.prototype=Object.assign(Object.create(q.prototype),{constructor:$i,getTypeName:function(){return"ImportedNodesArray"}});for(const t of Reflect.ownKeys($i.prototype))Object.defineProperty($i.prototype,t,{enumerable:!1});const Ki=$i;function Qi(t){return q.call(this,t)}Qi.prototype=Object.assign(Object.create(q.prototype),{constructor:Qi,getTypeName:function(){return"ExternProtoDeclarationArray"}});for(const t of Reflect.ownKeys(Qi.prototype))Object.defineProperty(Qi.prototype,t,{enumerable:!1});const Zi=Qi;function Ji(t){return q.call(this,t)}Ji.prototype=Object.assign(Object.create(q.prototype),{constructor:Ji,getTypeName:function(){return"ProtoDeclarationArray"}});for(const t of Reflect.ownKeys(Ji.prototype))Object.defineProperty(Ji.prototype,t,{enumerable:!1});const to=Ji,eo=Symbol(),no=Symbol(),io=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),oo=Symbol();function ro(t,e){this[eo]=e,this[no]=new Map(e.getFields().map((t=>[t,t.getName()]))),this[io]=e.getFieldDefinitions(),this[oo]=null,ji.call(this,t),this.addType(o.X3DPrototypeInstance)}ro.prototype=Object.assign(Object.create(ji.prototype),{constructor:ro,create:function(t){return new ro(t,this[eo])},getTypeName:function(){return this[eo].getName()},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},initialize:function(){ji.prototype.initialize.call(this),this.setProtoNode(this[eo])},construct:function(){this[oo]&&this[oo].dispose();const t=this[eo].getProtoDeclaration();if(!t)return this[oo]=new ya(this.getExecutionContext()),this[oo].setOuterNode(this),this[oo].setup(),void(this.isInitialized()&&x.prototype.addEvent.call(this));if(this[eo].isExternProto)for(const e of t.getUserDefinedFields())try{const t=this.getField(e.getName());if(t.getAccessType()!==e.getAccessType())continue;if(t.getType()!==e.getType())continue;if(!t.isInitializable())continue;if(t.getModificationTime())continue;if(t.hasReferences())continue;if(t.equals(e))continue;t.assign(e)}catch(n){this.addField(t.getFieldDefinitions().get(e.getName()))}this[oo]=new ya(t.getExecutionContext()),this[oo].setOuterNode(this),this.importExternProtos(t.getBody().externprotos),this.importProtos(t.getBody().protos),this.copyRootNodes(t.getBody().rootNodes),this.copyImportedNodes(t.getBody(),t.getBody().getImportedNodes()),this.copyRoutes(t.getBody(),t.getBody().routes),this[oo].setup(),this.isInitialized()&&x.prototype.addEvent.call(this),this[eo]._updateInstances.removeInterest("construct",this),this[eo]._updateInstances.addInterest("update",this)},update:function(){const t=this[no],e=new Map(this.getFields().map((t=>[t.getName(),t])));for(const t of e.values())this.removeField(t.getName());this[no]=new Map(this[eo].getFields().map((t=>[t,t.getName()])));for(const t of this.getFieldDefinitions())this.addField(t);for(const n of this[no].keys()){const i=t.get(n);if(!i)continue;const o=this.getFields().get(n.getName()),r=e.get(i);r.addParent(this),r.setAccessType(o.getAccessType()),r.setName(o.getName()),this.getPredefinedFields().update(o.getName(),o.getName(),r),this.getFields().update(o.getName(),o.getName(),r),this.isPrivate()||r.addCloneCount(1),e.delete(i),o.dispose()}for(const t of e.values())t.dispose();this.construct()},getExtendedEventHandling:function(){return!1},getProtoNode:function(){return this[eo]},setProtoNode:function(t){if(t!==this[eo]){if(this[eo]){const t=this[eo];t._name_changed.removeFieldInterest(this._typeName_changed),t._updateInstances.removeInterest("construct",this),t._updateInstances.removeInterest("update",this)}this[no]=new Map(t.getFields().map((t=>[t,t.getName()]))),this[io]=t.getFieldDefinitions()}this[eo]=t,t._name_changed.addFieldInterest(this._typeName_changed);const e=this.getExecutionContext().getOuterNode();e&&e.getType().includes(o.X3DProtoDeclaration)||(t.isExternProto?this[eo].checkLoadState()===o.COMPLETE_STATE?this.construct():(t._updateInstances.addInterest("construct",this),t.requestImmediateLoad()):this.construct())},getBody:function(){return this[oo]},getInnerNode:function(){const t=this[oo].getRootNodes().getValue();if(t.length){const e=t[0];if(e)return e.getValue().getInnerNode()}throw new Error("Root node not available.")},importExternProtos:function(t){const e=this[oo].externprotos;for(const n of t)e.add(n.getName(),n)},importProtos:function(t){const e=this[oo].protos;for(const n of t)e.add(n.getName(),n)},copyRootNodes:function(t){const e=this[oo].getRootNodes();for(const n of t)e.push(n.copy(this))},copyImportedNodes:function(t,e){for(const t of e)try{const e=this[oo].getNamedNode(t.getInlineNode().getName()),n=t.getImportedName(),i=t.getExportedName();this[oo].addImportedNode(e,i,n)}catch(t){console.error("Bad IMPORT specification in copy: ",t)}},copyRoutes:function(t,e){for(const n of e)try{const e=this[oo].getLocalNode(t.getLocalName(n.sourceNode)),i=this[oo].getLocalNode(t.getLocalName(n.destinationNode));this[oo].addRoute(e,n.sourceField,i,n.destinationField)}catch(t){console.error(t)}},toXMLStream:function(t){const e=s.Get(t),n=e.IsSharedNode(this);e.EnterScope();const i=e.Name(this);if(i.length&&e.ExistsNode(this)){t.string+=e.Indent(),t.string+="<ProtoInstance",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(this.getTypeName()),t.string+="'",t.string+=" ",t.string+="USE='",t.string+=e.XMLEncode(i),t.string+="'";const n=e.ContainerField();return n&&n.getName()!==this.getContainerField()&&(t.string+=" ",t.string+="containerField='",t.string+=e.XMLEncode(n.getName()),t.string+="'"),t.string+="/>",void e.LeaveScope()}t.string+=e.Indent(),t.string+="<ProtoInstance",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(this.getTypeName()),t.string+="'",i.length&&(e.AddNode(this),t.string+=" ",t.string+="DEF='",t.string+=e.XMLEncode(i),t.string+="'");const r=e.ContainerField();r&&r.getName()!==this.getContainerField()&&(t.string+=" ",t.string+="containerField='",t.string+=e.XMLEncode(r.getName()),t.string+="'");const a=this.getChangedFields();if(0===a.length)t.string+="/>";else{t.string+=">\n",e.IncIndent();const i=[];for(const r of a){let s=!1;if(e.ExecutionContext()&&r.getAccessType()===o.inputOutput&&0!==r.getReferences().size){let t=!1;r.getReferences().forEach((function(e){t=t||e.isInitializable()})),t||(s=!this.isDefaultValue(r))}if(0===r.getReferences().size||!e.ExecutionContext()||n||s)switch(s&&i.push(r),r.getType()){case o.MFNode:t.string+=e.Indent(),t.string+="<fieldValue",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(r.getName()),t.string+="'",0===r.length?t.string+="/>\n":(e.PushContainerField(r),t.string+=">\n",e.IncIndent(),r.toXMLStream(t),t.string+="\n",e.DecIndent(),t.string+=e.Indent(),t.string+="</fieldValue>\n",e.PopContainerField());break;case o.SFNode:if(null!==r.getValue()){e.PushContainerField(r),t.string+=e.Indent(),t.string+="<fieldValue",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(r.getName()),t.string+="'",t.string+=">\n",e.IncIndent(),r.toXMLStream(t),t.string+="\n",e.DecIndent(),t.string+=e.Indent(),t.string+="</fieldValue>\n",e.PopContainerField();break}default:t.string+=e.Indent(),t.string+="<fieldValue",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(r.getName()),t.string+="'",t.string+=" ",t.string+="value='",r.toXMLStream(t),t.string+="'",t.string+="/>\n"}else i.push(r)}if(i.length&&!n){t.string+=e.Indent(),t.string+="<IS>",t.string+="\n",e.IncIndent();for(const n of i){n.getReferences().forEach((function(i){t.string+=e.Indent(),t.string+="<connect",t.string+=" ",t.string+="nodeField='",t.string+=e.XMLEncode(n.getName()),t.string+="'",t.string+=" ",t.string+="protoField='",t.string+=e.XMLEncode(i.getName()),t.string+="'",t.string+="/>\n"}))}e.DecIndent(),t.string+=e.Indent(),t.string+="</IS>\n"}e.DecIndent(),t.string+=e.Indent(),t.string+="</ProtoInstance>"}e.LeaveScope()},dispose:function(){this[eo]._updateInstances.removeInterest("construct",this),this[eo]._updateInstances.removeInterest("update",this),this[oo]&&this[oo].dispose(),ji.prototype.dispose.call(this)}});const so=ro;function ao(t){Zn.call(this,t),this.addType(o.X3DProtoDeclarationNode),this.addChildObjects("updateInstances",new Bn.SFTime)}Bi.addAbstractType("X3DProtoDeclarationNode",ao),ao.prototype=Object.assign(Object.create(Zn.prototype),{constructor:ao,canUserDefinedFields:function(){return!0},createInstance:function(t,e=!0){if(!1===e)return new so(t,this);{const e=new so(t,this);return e.setup(),Re.get(e)}},newInstance:function(){return this.createInstance(this.getExecutionContext())},requestUpdateInstances:function(){this._updateInstances=this.getBrowser().getCurrentTime()},updateInstances:function(){this._updateInstances.processEvent()}});for(const t of Reflect.ownKeys(ao.prototype))Object.defineProperty(ao.prototype,t,{enumerable:!1});const uo=ao;Bi.addAbstractType("X3DProtoDeclaration",lo);const co=Symbol();function lo(t){uo.call(this,t),this.addType(o.X3DProtoDeclaration),this.addChildObjects("loadState",new Bn.SFInt32(o.NOT_STARTED_STATE)),this[co]=new ya(t),this[co].setOuterNode(this),this[co].setLive(!1),this.setLive(!1)}lo.prototype=Object.assign(Object.create(uo.prototype),{constructor:lo,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode)]),getTypeName:function(){return"X3DProtoDeclaration"},initialize:function(){uo.prototype.initialize.call(this),this[co].setup(),this._loadState=o.COMPLETE_STATE},getProtoDeclaration:function(){return this},getBody:function(){return this[co]},checkLoadState:function(){return this._loadState.getValue()},canUserDefinedFields:function(){return!0},toVRMLStream:function(t){const e=s.Get(t);t.string+=e.Indent(),t.string+="PROTO",t.string+=" ",t.string+=this.getName(),t.string+=" ",t.string+="[",e.EnterScope();const n=this.getUserDefinedFields();let i=0,o=0;if(0===n.length)t.string+=" ";else{for(const t of n)i=Math.max(i,t.getTypeName().length),o=Math.max(o,e.AccessType(t.getAccessType()).length);t.string+="\n",e.IncIndent();for(const e of n)this.toVRMLStreamUserDefinedField(t,e,i,o),t.string+="\n";e.DecIndent(),t.string+=e.Indent()}e.LeaveScope(),t.string+="]",t.string+="\n",t.string+=e.Indent(),t.string+="{",t.string+="\n",e.IncIndent(),this[co].toVRMLStream(t),e.DecIndent(),t.string+=e.Indent(),t.string+="}"},toVRMLStreamUserDefinedField:function(t,e,n,i){const o=s.Get(t);t.string+=o.Indent(),t.string+=o.PadRight(o.AccessType(e.getAccessType()),i),t.string+=" ",t.string+=o.PadRight(e.getTypeName(),n),t.string+=" ",t.string+=e.getName(),e.isInitializable()&&(t.string+=" ",e.toVRMLStream(t))},toXMLStream:function(t){const e=s.Get(t);t.string+=e.Indent(),t.string+="<ProtoDeclare",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(this.getName()),t.string+="'",t.string+=">",t.string+="\n",e.EnterScope();const n=this.getUserDefinedFields();if(0!==n.length){e.IncIndent(),t.string+=e.Indent(),t.string+="<ProtoInterface>\n",e.IncIndent();for(const i of n)if(t.string+=e.Indent(),t.string+="<field",t.string+=" ",t.string+="accessType='",t.string+=e.AccessType(i.getAccessType()),t.string+="'",t.string+=" ",t.string+="type='",t.string+=i.getTypeName(),t.string+="'",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(i.getName()),t.string+="'",i.isDefaultValue())t.string+="/>\n";else switch(i.getType()){case o.SFNode:case o.MFNode:e.PushContainerField(i),t.string+=">\n",e.IncIndent(),i.toXMLStream(t),t.string+="\n",e.DecIndent(),t.string+=e.Indent(),t.string+="</field>\n",e.PopContainerField();break;default:t.string+=" ",t.string+="value='",i.toXMLStream(t),t.string+="'",t.string+="/>\n"}e.DecIndent(),t.string+=e.Indent(),t.string+="</ProtoInterface>\n",e.DecIndent()}e.LeaveScope(),e.IncIndent(),t.string+=e.Indent(),t.string+="<ProtoBody>\n",e.IncIndent(),this[co].toXMLStream(t),e.DecIndent(),t.string+=e.Indent(),t.string+="</ProtoBody>\n",e.DecIndent(),t.string+=e.Indent(),t.string+="</ProtoDeclare>"}});for(const t of Reflect.ownKeys(lo.prototype))Object.defineProperty(lo.prototype,t,{enumerable:!1});Object.defineProperty(lo.prototype,"name",{get:function(){return this.getName()},enumerable:!0,configurable:!1}),Object.defineProperty(lo.prototype,"fields",{get:function(){return this.getFieldDefinitions()},enumerable:!0,configurable:!1}),Object.defineProperty(lo.prototype,"isExternProto",{get:function(){return!1},enumerable:!0,configurable:!1});const ho=lo,fo=Symbol(),po=Symbol(),go=Symbol(),mo=Symbol();function _o(t){this.addType(o.X3DUrlObject),this.addChildObjects("loadState",new Bn.SFInt32(o.NOT_STARTED_STATE),"loadNow",new Bn.SFTime),this[fo]=!0,this[po]=performance.now()}_o.prototype={constructor:_o,initialize:function(){this.isLive().addInterest("set_live__",this),this._load.addInterest("set_load__",this),this._url.addInterest("set_url__",this),this._loadNow.addInterest("loadNow",this),this._autoRefresh.addInterest("set_autoRefresh__",this),this._autoRefreshTimeLimit.addInterest("set_autoRefresh__",this)},setLoadState:function(t,e=!0){if(this._loadState=t,t===o.COMPLETE_STATE&&(this[go]=performance.now(),this.setAutoRefreshTimer(this._autoRefresh.getValue())),e)switch(t){case o.NOT_STARTED_STATE:break;case o.IN_PROGRESS_STATE:this.getScene().addLoadCount(this);break;case o.COMPLETE_STATE:case o.FAILED_STATE:this.getScene().removeLoadCount(this)}},checkLoadState:function(){return this._loadState.getValue()},getLoadState:function(){return this._loadState},setCache:function(t){this[fo]=t},getCache:function(){return this[fo]},requestImmediateLoad:function(t=!0){const e=this.checkLoadState();e!==o.COMPLETE_STATE&&e!==o.IN_PROGRESS_STATE&&this._load.getValue()&&0!==this._url.length&&(this.setCache(t),this.setLoadState(o.IN_PROGRESS_STATE),this.isInitialized()?this._loadNow=this.getBrowser().getCurrentTime():this.loadNow())},loadNow:function(){},requestUnload:function(){const t=this.checkLoadState();t!==o.NOT_STARTED_STATE&&t!==o.FAILED_STATE&&(this.setLoadState(o.NOT_STARTED_STATE),this.unLoadNow())},unLoadNow:function(){},setAutoRefreshTimer:function(t){if(clearTimeout(this[mo]),this._autoRefresh.getValue()<=0)return;const e=this._autoRefreshTimeLimit.getValue();0!==e&&(performance.now()-this[po])/1e3>e-t||(this[mo]=setTimeout(this.performAutoRefresh.bind(this),1e3*t))},performAutoRefresh:function(){this.setLoadState(o.NOT_STARTED_STATE),this.requestImmediateLoad(!1)},set_live__:function(){this.isLive().getValue()?this.set_autoRefresh__():clearTimeout(this[mo])},set_load__:function(){this._load.getValue()?this.requestImmediateLoad():this.requestUnload()},set_url__:function(){this._load.getValue()&&(this.setLoadState(o.NOT_STARTED_STATE),this.requestImmediateLoad())},set_autoRefresh__:function(){if(this.checkLoadState()!==o.COMPLETE_STATE)return;const t=(performance.now()-this[go])/1e3,e=this._autoRefresh.getValue();let n=e-t;n<0&&(n=Math.ceil(t/e)*e-t),this.setAutoRefreshTimer(n)},dispose:function(){}};const xo=_o;function yo(t){this.scene=t,this.executionContexts=[t],this.prototypes=[],this.units=!0}yo.prototype={constructor:yo,getScene:function(){return this.scene},getBrowser:function(){return this.scene.getBrowser()},getExecutionContext:function(){return this.executionContexts.at(-1)},pushExecutionContext:function(t){return this.executionContexts.push(t)},popExecutionContext:function(){this.executionContexts.pop()},getPrototype:function(){return this.prototypes.at(-1)},pushPrototype:function(t){return this.prototypes.push(t)},popPrototype:function(){this.prototypes.pop()},isInsideProtoDefinition:function(){return Boolean(this.prototypes.length)},addRootNode:function(t){this.getExecutionContext().rootNodes.push(t)},getProviderUrls:function(){const t=/\.js$/;return function(){const e=this.getScene(),n=(e.getProfile()||e.getBrowser().getProfile("Full")).components,i=e.getComponents(),o=new Set;for(const e of n){const n=e.providerUrl;n.match(t)&&o.add(n)}for(const e of i){const n=e.providerUrl;n.match(t)&&o.add(n)}if("function"==typeof __global_require__)for(const t of o)__global_require__(__global_require__("url").fileURLToPath(t));return Array.from(o)}}(),setUnits:function(t){if("boolean"==typeof arguments[0])return void(this.units=arguments[0]);const e=/Titania\s+V(\d+).*/,n=t.match(e);if(n){if(parseInt(n[1])<4)return void(this.units=!1)}this.units=!0},getUnits:function(){return this.units},fromUnit:function(t,e){return this.units?this.scene.fromUnit(t,e):e}};const wo=yo;var To={Whitespaces:new RegExp("([\\x20\\n,\\t\\r]+)","gy"),Comment:new RegExp("#(.*?)(?=[\\n\\r])","gy"),Header:new RegExp("^#(VRML|X3D) V(.*?) (utf8)(?:[ \\t]+(.*?))?[ \\t]*[\\n\\r]","gy"),AS:new RegExp("AS","gy"),COMPONENT:new RegExp("COMPONENT","gy"),DEF:new RegExp("DEF","gy"),EXPORT:new RegExp("EXPORT","gy"),EXTERNPROTO:new RegExp("EXTERNPROTO","gy"),FALSE:new RegExp("FALSE|false","gy"),IMPORT:new RegExp("IMPORT","gy"),IS:new RegExp("IS","gy"),META:new RegExp("META","gy"),NULL:new RegExp("NULL","gy"),TRUE:new RegExp("TRUE|true","gy"),PROFILE:new RegExp("PROFILE","gy"),PROTO:new RegExp("PROTO","gy"),ROUTE:new RegExp("ROUTE","gy"),TO:new RegExp("TO","gy"),UNIT:new RegExp("UNIT","gy"),USE:new RegExp("USE","gy"),OpenBrace:new RegExp("\\{","gy"),CloseBrace:new RegExp("\\}","gy"),OpenBracket:new RegExp("\\[","gy"),CloseBracket:new RegExp("\\]","gy"),Period:new RegExp("\\.","gy"),Colon:new RegExp("\\:","gy"),Id:new RegExp("([^\\x30-\\x39\\x00-\\x20\\x22\\x23\\x27\\x2b\\x2c\\x2d\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f]{1}[^\\x00-\\x20\\x22\\x23\\x27\\x2c\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f]*)","gy"),ComponentNameId:new RegExp("([^\\x30-\\x39\\x00-\\x20\\x22\\x23\\x27\\x2b\\x2c\\x2d\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f\\x3a]{1}[^\\x00-\\x20\\x22\\x23\\x27\\x2c\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f\\x3a]*)","gy"),initializeOnly:new RegExp("initializeOnly","gy"),inputOnly:new RegExp("inputOnly","gy"),outputOnly:new RegExp("outputOnly","gy"),inputOutput:new RegExp("inputOutput","gy"),field:new RegExp("field","gy"),eventIn:new RegExp("eventIn","gy"),eventOut:new RegExp("eventOut","gy"),exposedField:new RegExp("exposedField","gy"),FieldType:new RegExp("(MFBool|MFColorRGBA|MFColor|MFDouble|MFFloat|MFImage|MFInt32|MFMatrix3d|MFMatrix3f|MFMatrix4d|MFMatrix4f|MFNode|MFRotation|MFString|MFTime|MFVec2d|MFVec2f|MFVec3d|MFVec3f|MFVec4d|MFVec4f|SFBool|SFColorRGBA|SFColor|SFDouble|SFFloat|SFImage|SFInt32|SFMatrix3d|SFMatrix3f|SFMatrix4d|SFMatrix4f|SFNode|SFRotation|SFString|SFTime|SFVec2d|SFVec2f|SFVec3d|SFVec3f|SFVec4d|SFVec4f)","gy"),int32:new RegExp("((?:0[xX][\\da-fA-F]+)|(?:[+-]?\\d+))","gy"),double:new RegExp("([+-]?(?:(?:(?:\\d*\\.\\d+)|(?:\\d+(?:\\.)?))(?:[eE][+-]?\\d+)?))","gy"),string:new RegExp('"((?:[^\\\\"]|\\\\\\\\|\\\\\\")*)"',"gy"),Inf:new RegExp("[+]?(?:inf|Infinity)","gy"),NegativeInf:new RegExp("-(?:inf|Infinity)","gy"),NaN:new RegExp("[+-]?(nan|NaN)","gy"),Break:new RegExp("\\r?\\n","g")};function So(t){return this.lastIndex=t.lastIndex,t.result=this.exec(t.input),!!t.result&&(t.lastIndex=this.lastIndex,!0)}for(var bo in To)To[bo].parse=So;function vo(t){wo.call(this,t)}vo.prototype=Object.assign(Object.create(wo.prototype),{constructor:vo,accessTypes:{field:o.initializeOnly,eventIn:o.inputOnly,eventOut:o.outputOnly,exposedField:o.inputOutput,initializeOnly:o.initializeOnly,inputOnly:o.inputOnly,outputOnly:o.outputOnly,inputOutput:o.inputOutput},SFBool:new Bn.SFBool,SFColor:new Bn.SFColor,SFColorRGBA:new Bn.SFColorRGBA,SFDouble:new Bn.SFDouble,SFFloat:new Bn.SFFloat,SFImage:new Bn.SFImage,SFInt32:new Bn.SFInt32,SFMatrix3f:new Bn.SFMatrix3f,SFMatrix3d:new Bn.SFMatrix3d,SFMatrix4f:new Bn.SFMatrix4f,SFMatrix4d:new Bn.SFMatrix4d,SFNode:new Bn.SFNode,SFRotation:new Bn.SFRotation,SFString:new Bn.SFString,SFTime:new Bn.SFTime,SFVec2d:new Bn.SFVec2d,SFVec2f:new Bn.SFVec2f,SFVec3d:new Bn.SFVec3d,SFVec3f:new Bn.SFVec3f,SFVec4d:new Bn.SFVec4d,SFVec4f:new Bn.SFVec4f,MFBool:new Bn.MFBool,MFColor:new Bn.MFColor,MFColorRGBA:new Bn.MFColorRGBA,MFDouble:new Bn.MFDouble,MFFloat:new Bn.MFFloat,MFImage:new Bn.MFImage,MFInt32:new Bn.MFInt32,MFMatrix3d:new Bn.MFMatrix3d,MFMatrix3f:new Bn.MFMatrix3f,MFMatrix4d:new Bn.MFMatrix4d,MFMatrix4f:new Bn.MFMatrix4f,MFNode:new Bn.MFNode,MFRotation:new Bn.MFRotation,MFString:new Bn.MFString,MFTime:new Bn.MFTime,MFVec2d:new Bn.MFVec2d,MFVec2f:new Bn.MFVec2f,MFVec3d:new Bn.MFVec3d,MFVec3f:new Bn.MFVec3f,MFVec4d:new Bn.MFVec4d,MFVec4f:new Bn.MFVec4f,isValid:function(){return!!this.input.match(/^(?:#X3D|#VRML|(?:[\x20\n,\t\r]*|#.*?[\r\n])*(PROFILE|COMPONENT|META|UNIT|EXTERNPROTO|PROTO|DEF|NULL|IMPORT|EXPORT|ROUTE|\w+(?:[\x20\n,\t\r]*|#.*?[\r\n])\{|$))/)},getInput:function(){return this.input},setInput:function(t){this.input=t,this.lineNumber=1,this.lastIndex=0},parseIntoScene:function(t,e){try{this.success=t,this.error=e,this.getScene().setEncoding("VRML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.x3dScene()}catch(e){throw new Error(this.getError(e))}},exception:function(t){if(this.getBrowser().isStrict())throw new Error(t);console.warn(t)},getError:function(t){var e=t.message,n=this.getLine(),i=this.getLastLine(),o=this.getLastLine(),r=i.length-n.length+1;return i.length>80&&(i=i.substr(r-40,80),o="",r=40),"\n********************************************************************************\nParser error at line "+this.lineNumber+":"+r+"\nin '"+this.getScene().getWorldURL()+"'\n\n"+o+"\n"+i+"\n"+Array(r).join(" ")+"^\n"+e+"\n********************************************************************************\n"},getLine:function(){for(var t=this.input,e=this.lastIndex,n="";e<t.length&&"\n"!==t[e]&&"\r"!==t[e];)n+=t[e++];return this.lastIndex=e,n},getLastLine:function(){var t=this.input,e=this.lastIndex,n="";for(e<t.length&&("\n"!==t[e]||"\r"!==t[e])&&--e;e>=0&&"\n"!==t[e]&&"\r"!==t[e];)n=t[e--]+n;return this.lastIndex=e,n},comments:function(){for(;this.comment(););},comment:function(){return!!this.whitespaces()||To.Comment.parse(this)},whitespaces:function(){return!!To.Whitespaces.parse(this)&&(this.xml||this.lines(this.result[1]),!0)},lines:function(t){var e=t.match(To.Break);e&&(this.lineNumber+=e.length)},x3dScene:function(){this.headerStatement(),this.profileStatement(),this.componentStatements(),this.unitStatements(),this.metaStatements();try{this.setUnits(this.getScene().getMetaData("generator"))}catch(t){}if(this.success)Promise.all(this.getProviderUrls().map((t=>import(t)))).then(function(){try{if(this.statements(),this.lastIndex<this.input.length)throw new Error("Unknown statement.");this.success(this.getScene())}catch(t){this.error(new Error(this.getError(t)))}}.bind(this)).catch(function(t){this.error(t)}.bind(this));else if(this.statements(),this.lastIndex<this.input.length)throw new Error("Unknown statement.")},headerStatement:function(){To.Header.lastIndex=0;var t=To.Header.exec(this.input);return!!t&&(this.getScene().setSpecificationVersion(t[2]),this.getScene().setEncoding("VRML"),!0)},profileStatement:function(){if(this.comments(),To.PROFILE.parse(this)){if(this.profileNameId()){var t=this.getBrowser().getProfile(this.result[1]);return void this.getScene().setProfile(t)}throw new Error("Expected a profile name.")}},componentStatements:function(){for(var t=this.componentStatement();t;)this.getScene().addComponent(t),t=this.componentStatement()},componentStatement:function(){if(this.comments(),To.COMPONENT.parse(this)){if(this.componentNameId()){var t=this.result[1];if(this.comments(),To.Colon.parse(this)){if(this.componentSupportLevel()){var e=this.value;return this.getBrowser().getComponent(t,e)}throw new Error("Expected a component support level.")}throw new Error("Expected a ':' after component name.")}throw new Error("Expected a component name.")}return null},componentSupportLevel:function(){return this.int32()},unitStatements:function(){for(;this.unitStatement(););},unitStatement:function(){if(this.comments(),To.UNIT.parse(this)){if(this.categoryNameId()){var t=this.result[1];if(this.unitNameId()){var e=this.result[1];if(this.unitConversionFactor()){var n=this.value;try{return this.getScene().updateUnit(t,e,n),!0}catch(t){return console.log(t.message),!0}}throw new Error("Expected unit conversion factor.")}throw new Error("Expected unit name identifier.")}throw new Error("Expected category name identifier after UNIT statement.")}return!1},unitConversionFactor:function(){return this.double()},metaStatements:function(){for(;this.metaStatement(););},metaStatement:function(){if(this.comments(),To.META.parse(this)){if(this.metakey()){var t=this.value;if(this.metavalue()){var e=this.value;return this.getScene().setMetaData(t,e),!0}throw new Error("Expected metadata value.")}throw new Error("Expected metadata key.")}return!1},metakey:function(){return this.string()},metavalue:function(){return this.string()},exportStatement:function(){if(this.comments(),To.EXPORT.parse(this)){if(this.nodeNameId()){var t=this.result[1],e="";this.comments();var n=this.getScene().getLocalNode(t);if(To.AS.parse(this)){if(!this.exportedNodeNameId())throw new Error("No name given after AS.");e=this.result[1]}else e=t;if(this.getScene()===this.getExecutionContext())return this.getScene().updateExportedNode(e,n),!0;throw new Error("Export statement not allowed here.")}throw new Error("No name given after EXPORT.")}return!1},importStatement:function(){if(this.comments(),To.IMPORT.parse(this)){if(this.nodeNameId()){var t=this.result[1],e=this.getExecutionContext().getNamedNode(t);if(this.comments(),To.Period.parse(this)){if(this.exportedNodeNameId()){var n=this.result[1],i=n;if(this.comments(),To.AS.parse(this)){if(!this.nodeNameId())throw new Error("No name given after AS.");i=this.result[1]}return this.getExecutionContext().updateImportedNode(e,n,i),!0}throw new Error("Expected exported node name.")}throw new Error("Expected a '.' after exported node name.")}throw new Error("No name given after IMPORT statement.")}return!1},statements:function(){for(;this.statement(););},statement:function(){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.importStatement())return!0;if(this.exportStatement())return!0;var t=this.nodeStatement();return!1!==t&&(this.addRootNode(t),!0)},nodeStatement:function(){if(this.comments(),To.DEF.parse(this)){if(this.nodeNameId())return this.node(this.result[1]);throw new Error("No name given after DEF.")}if(To.USE.parse(this)){if(this.nodeNameId())return this.getExecutionContext().getNamedNode(this.result[1]).getValue();throw new Error("No name given after USE.")}return To.NULL.parse(this)?null:this.node("")},protoStatement:function(){return!!this.proto()||!!this.externproto()},protoStatements:function(){for(;this.protoStatement(););},proto:function(){if(this.comments(),To.PROTO.parse(this)){if(this.nodeTypeId()){var t=this.result[1];if(this.comments(),To.OpenBracket.parse(this)){var e=this.interfaceDeclarations();if(this.comments(),To.CloseBracket.parse(this)){if(this.comments(),To.OpenBrace.parse(this)){for(var n=new ho(this.getExecutionContext()),i=0,o=e.length;i<o;++i){var r=e[i];n.addUserDefinedField(r.getAccessType(),r.getName(),r)}if(this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.protoBody(),this.popExecutionContext(),this.popPrototype(),this.comments(),To.CloseBrace.parse(this)){n.setup();try{const e=this.getExecutionContext().getProtoDeclaration(t);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(t),e)}catch(t){}return this.getExecutionContext().updateProtoDeclaration(t,n),!0}throw new Error("Expected a '}' at the end of PROTO body.")}throw new Error("Expected a '{' at the beginning of PROTO body.")}throw new Error("Expected a ']' at the end of PROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of PROTO interface declaration.")}throw new Error("Invalid PROTO definition name.")}return!1},protoBody:function(){this.protoStatements();var t=this.rootNodeStatement();!1!==t&&this.addRootNode(t),this.statements()},rootNodeStatement:function(){if(this.comments(),To.DEF.parse(this)){if(this.nodeNameId()){var t=this.result[0];if(!1!==(e=this.node(t)))return e;throw new Error("Expected node type name after DEF.")}throw new Error("No name given after DEF.")}var e;return!1!==(e=this.node(""))&&e},interfaceDeclarations:function(){for(var t=[],e=this.interfaceDeclaration();e;)t.push(e),e=this.interfaceDeclaration();return t},restrictedInterfaceDeclaration:function(){if(this.comments(),To.inputOnly.parse(this)||To.eventIn.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOnlyId()){var e=this.result[1];return(n=this[t].create()).setAccessType(o.inputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(To.outputOnly.parse(this)||To.eventOut.parse(this)){if(this.fieldType()){t=this.result[1];if(this.outputOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(o.outputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(To.initializeOnly.parse(this)||To.field.parse(this)){if(this.fieldType()){t=this.result[1];if(this.initializeOnlyId()){e=this.result[1];var n=this[t].create();if(this.fieldValue(n))return n.setAccessType(o.initializeOnly),n.setName(e),n;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},interfaceDeclaration:function(){if(n=this.restrictedInterfaceDeclaration())return n;if(this.comments(),To.inputOutput.parse(this)||To.exposedField.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOutputId()){var e=this.result[1],n=this[t].create();if(this.fieldValue(n))return n.setAccessType(o.inputOutput),n.setName(e),n;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},externproto:function(){if(this.comments(),To.EXTERNPROTO.parse(this)){if(this.nodeTypeId()){var t=this.result[1];if(this.comments(),To.OpenBracket.parse(this)){var e=this.externInterfaceDeclarations();if(this.comments(),To.CloseBracket.parse(this)){if(this.URLList(this.MFString)){for(var n=new ea(this.getExecutionContext(),this.MFString),i=0,o=e.length;i<o;++i){var r=e[i];n.addUserDefinedField(r.getAccessType(),r.getName(),r)}n.setup();try{const e=this.getExecutionContext().getExternProtoDeclaration(t);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(t),e)}catch(t){}return this.getExecutionContext().updateExternProtoDeclaration(t,n),!0}throw new Error("Expected a URL list after EXTERNPROTO interface declaration '"+t+"'.")}throw new Error("Expected a ']' at the end of EXTERNPROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of EXTERNPROTO interface declaration.")}throw new Error("Invalid EXTERNPROTO definition name.")}return!1},externInterfaceDeclarations:function(){for(var t=[],e=this.externInterfaceDeclaration();e;)t.push(e),e=this.externInterfaceDeclaration();return t},externInterfaceDeclaration:function(){if(this.comments(),To.inputOnly.parse(this)||To.eventIn.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOnlyId()){var e=this.result[1];return(n=this[t].create()).setAccessType(o.inputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(To.outputOnly.parse(this)||To.eventOut.parse(this)){if(this.fieldType()){t=this.result[1];if(this.outputOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(o.outputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(To.initializeOnly.parse(this)||To.field.parse(this)){if(this.fieldType()){t=this.result[1];if(this.initializeOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(o.initializeOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(To.inputOutput.parse(this)||To.exposedField.parse(this)){if(this.fieldType()){t=this.result[1];if(this.inputOutputId()){var n;e=this.result[1];return(n=this[t].create()).setAccessType(o.inputOutput),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},URLList:function(t){return this.mfstringValue(t)},routeStatement:function(){if(this.comments(),To.ROUTE.parse(this)){if(this.nodeNameId()){var t=this.result[1],e=this.getExecutionContext().getLocalNode(t);if(this.comments(),To.Period.parse(this)){if(this.outputOnlyId()){var n=this.result[1];if(this.comments(),To.TO.parse(this)){if(this.nodeNameId()){var i=this.result[1],o=this.getExecutionContext().getLocalNode(i);if(this.comments(),To.Period.parse(this)){if(this.inputOnlyId())try{var r=this.result[1];return this.getExecutionContext().addRoute(e,n,o,r),!0}catch(t){return this.exception(t.message),!0}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}throw new Error("Bad ROUTE specification: Expected a 'TO'.")}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}return!1},node:function(t){if(this.nodeTypeId()){var e=this.result[1],n=this.getExecutionContext().createNode(e,!1);if(!n&&!(n=this.getExecutionContext().createProto(e,!1)))throw new Error("Unknown node type or proto '"+e+"', you probably have insufficient component/profile statements.");if(t.length){try{var i=this.getExecutionContext().getNamedNode(t);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(t),i)}catch(t){}this.getExecutionContext().updateNamedNode(t,n)}if(this.comments(),To.OpenBrace.parse(this)){if(n.canUserDefinedFields()?this.scriptBody(n):this.nodeBody(n),this.comments(),To.CloseBrace.parse(this))return this.isInsideProtoDefinition()||n.setup(),n;throw new Error("Expected '}' at the end of node body.")}throw new Error("Expected '{' at the beginning of node body.")}return!1},scriptBody:function(t){for(;this.scriptBodyElement(t););},scriptBodyElement:function(t){var e=this.lastIndex,n=this.lineNumber;if(this.Id()){var i=this.accessTypes[this.result[1]];if(i&&this.fieldType()){var r=this.result[1];if(this.Id()){var s=this.result[1];if(this.comments(),To.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){var a=this.result[1];try{var u=this.getPrototype().getField(a)}catch(t){return this.exception("No such event or field '"+a+"' inside PROTO "+this.getPrototype().getName()+" interface declaration."),!0}var c=this[r];if(c.getType()===u.getType()){if(u.isReference(i)){try{i===(l=t.getField(s)).getAccessType()&&u.getType()===l.getType()||(l=this.createUserDefinedField(t,i,s,c))}catch(e){var l=this.createUserDefinedField(t,i,s,c)}return l.addReference(u),!0}throw new Error("Field '"+s+"' and '"+u.getName()+"' in PROTO '"+this.getPrototype().getName()+"' are incompatible as an IS mapping.")}throw new Error("Field '"+s+"' and '"+u.getName()+"' in PROTO '"+this.getPrototype().getName()+"' have different types.")}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}}}}if(this.lastIndex=e,this.lineNumber=n,l=this.interfaceDeclaration()){try{if(l.getAccessType()===o.inputOutput){var h=t.getField(l.getName());if(h.getAccessType()===o.inputOutput&&l.getType()===h.getType())return h.setValue(l),!0}}catch(t){}return t.addUserDefinedField(l.getAccessType(),l.getName(),l),!0}return this.nodeBodyElement(t)},createUserDefinedField:function(t,e,n,i){var o=i.create();return t.addUserDefinedField(e,n,o),o},nodeBody:function(t){for(;this.nodeBodyElement(t););},nodeBodyElement:function(t){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.Id()){var e=this.result[1];try{var n=t.getField(e)}catch(n){throw new Error("Unknown field '"+e+"' in class '"+t.getTypeName()+"'.")}if(this.comments(),To.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){var i=this.result[1];try{var o=this.getPrototype().getField(i)}catch(t){return this.exception("No such event or field '"+i+"' inside PROTO "+this.getPrototype().getName()),!0}if(n.getType()===o.getType()){if(o.isReference(n.getAccessType()))return n.addReference(o),!0;throw new Error("Field '"+n.getName()+"' and '"+o.getName()+"' in PROTO "+this.getPrototype().getName()+" are incompatible as an IS mapping.")}throw new Error("Field '"+n.getName()+"' and '"+o.getName()+"' in PROTO "+this.getPrototype().getName()+" have different types.")}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}if(n.isInitializable()){if(this.fieldValue(n))return!0;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Couldn't assign value to "+this.accessTypeToString(n.getAccessType())+" field '"+e+"'.")}return!1},profileNameId:function(){return this.Id()},componentNameId:function(){return this.comments(),To.ComponentNameId.parse(this)},categoryNameId:function(){return this.Id()},unitNameId:function(){return this.Id()},exportedNodeNameId:function(){return this.Id()},nodeNameId:function(){return this.Id()},nodeTypeId:function(){return this.Id()},initializeOnlyId:function(){return this.Id()},inputOnlyId:function(){return this.Id()},outputOnlyId:function(){return this.Id()},inputOutputId:function(){return this.Id()},Id:function(){return this.comments(),To.Id.parse(this)},fieldType:function(){return this.comments(),To.FieldType.parse(this)},fieldValue:function(t){return this.fieldTypes[t.getType()].call(this,t)},double:function(){return this.comments(),To.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):To.Inf.parse(this)?(this.value=Number.POSITIVE_INFINITY,!0):To.NegativeInf.parse(this)?(this.value=Number.NEGATIVE_INFINITY,!0):!!To.NaN.parse(this)&&(this.value=Number.NaN,!0)},int32:function(){return this.comments(),!!To.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},string:function(){return this.comments(),!!To.string.parse(this)&&(this.value=Bn.SFString.unescape(this.result[1]),this.lines(this.value),!0)},sfboolValue:function(t){return this.comments(),To.TRUE.parse(this)?(t.setValue(!0),!0):!!To.FALSE.parse(this)&&(t.setValue(!1),!0)},mfboolValue:function(t){if(t.length=0,this.sfboolValue(this.SFBool))return t.push(this.SFBool),!0;if(To.OpenBracket.parse(this)){if(this.sfboolValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfboolValues:function(t){for(t.length=0,t=t.getTarget();this.sfboolValue(this.SFBool);)t.push(this.SFBool)},sfcolorValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;return t.r=e,t.g=n,t.b=i,!0}}}return!1},mfcolorValue:function(t){if(t.length=0,this.sfcolorValue(this.SFColor))return t.push(this.SFColor),!0;if(To.OpenBracket.parse(this)){if(this.sfcolorValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorValues:function(t){for(t.length=0,t=t.getTarget();this.sfcolorValue(this.SFColor);)t.push(this.SFColor)},sfcolorrgbaValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;return t.r=e,t.g=n,t.b=i,t.a=o,!0}}}}return!1},mfcolorrgbaValue:function(t){if(t.length=0,this.sfcolorrgbaValue(this.SFColorRGBA))return t.push(this.SFColorRGBA),!0;if(To.OpenBracket.parse(this)){if(this.sfcolorrgbaValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorrgbaValues:function(t){for(t.length=0,t=t.getTarget();this.sfcolorrgbaValue(this.SFColorRGBA);)t.push(this.SFColorRGBA)},sfdoubleValue:function(t){return!!this.double()&&(t.setValue(this.fromUnit(t.getUnit(),this.value)),!0)},mfdoubleValue:function(t){if(t.length=0,this.SFDouble.setUnit(t.getUnit()),this.sfdoubleValue(this.SFDouble))return t.push(this.SFDouble),!0;if(To.OpenBracket.parse(this)){if(this.sfdoubleValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfdoubleValues:function(t){for(t.length=0,t=t.getTarget(),this.SFDouble.setUnit(t.getUnit());this.sfdoubleValue(this.SFDouble);)t.push(this.SFDouble)},sffloatValue:function(t){return this.sfdoubleValue(t)},mffloatValue:function(t){if(t.length=0,this.SFFloat.setUnit(t.getUnit()),this.sffloatValue(this.SFFloat))return t.push(this.SFFloat),!0;if(To.OpenBracket.parse(this)){if(this.sffloatValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sffloatValues:function(t){for(t.length=0,t=t.getTarget(),this.SFFloat.setUnit(t.getUnit());this.sffloatValue(this.SFFloat);)t.push(this.SFFloat)},sfimageValue:function(t){if(this.int32()){var e=this.value;if(this.int32()){var n=this.value;if(this.int32()){var i=this.value,o=e*n;t.width=e,t.height=n,t.comp=i;for(var r=t.array,s=0;s<o;++s){if(!this.int32())return!1;r[s]=this.value}return!0}}}return!1},mfimageValue:function(t){if(t.length=0,this.sfimageValue(this.SFImage))return t.push(this.SFImage),!0;if(To.OpenBracket.parse(this)){if(this.sfimageValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfimageValues:function(t){for(t.length=0,t=t.getTarget();this.sfimageValue(this.SFImage);)t.push(this.SFImage)},sfint32Value:function(t){return!!this.int32()&&(t.setValue(this.value),!0)},mfint32Value:function(t){if(t.length=0,this.sfint32Value(this.SFInt32))return t.push(this.SFInt32),!0;if(To.OpenBracket.parse(this)){if(this.sfint32Values(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfint32Values:function(t){for(t.length=0,t=t.getTarget();this.sfint32Value(this.SFInt32);)t.push(this.SFInt32)},sfmatrix3dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;if(this.double()){var s=this.value;if(this.double()){var a=this.value;if(this.double()){var u=this.value;if(this.double()){var c=this.value;return t[0]=e,t[1]=n,t[2]=i,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=c,!0}}}}}}}}}return!1},mfmatrix3dValue:function(t){if(t.length=0,this.sfmatrix3dValue(this.SFMatrix3d))return t.push(this.SFMatrix3d),!0;if(To.OpenBracket.parse(this)){if(this.sfmatrix3dValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3dValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix3dValue(this.SFMatrix3d);)t.push(this.SFMatrix3d)},sfmatrix3fValue:function(t){return this.sfmatrix3dValue(t)},mfmatrix3fValue:function(t){if(t.length=0,this.sfmatrix3fValue(this.SFMatrix3f))return t.push(this.SFMatrix3f),!0;if(To.OpenBracket.parse(this)){if(this.sfmatrix3fValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3fValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix3fValue(this.SFMatrix3f);)t.push(this.SFMatrix3f)},sfmatrix4dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;if(this.double()){var s=this.value;if(this.double()){var a=this.value;if(this.double()){var u=this.value;if(this.double()){var c=this.value;if(this.double()){var l=this.value;if(this.double()){var h=this.value;if(this.double()){var d=this.value;if(this.double()){var f=this.value;if(this.double()){var p=this.value;if(this.double()){var g=this.value;if(this.double()){var m=this.value;return t[0]=e,t[1]=n,t[2]=i,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=c,t[9]=l,t[10]=h,t[11]=d,t[12]=f,t[13]=p,t[14]=g,t[15]=m,!0}}}}}}}}}}}}}}}}return!1},mfmatrix4dValue:function(t){if(t.length=0,this.sfmatrix4dValue(this.SFMatrix4d))return t.push(this.SFMatrix4d),!0;if(To.OpenBracket.parse(this)){if(this.sfmatrix4dValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4dValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix4dValue(this.SFMatrix4d);)t.push(this.SFMatrix4d)},sfmatrix4fValue:function(t){return this.sfmatrix4dValue(t)},mfmatrix4fValue:function(t){if(t.length=0,this.sfmatrix4fValue(this.SFMatrix4f))return t.push(this.SFMatrix4f),!0;if(To.OpenBracket.parse(this)){if(this.sfmatrix4fValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4fValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix4fValue(this.SFMatrix4f);)t.push(this.SFMatrix4f)},sfnodeValue:function(t){var e=this.nodeStatement();return!1!==e&&(t.setValue(e),!0)},mfnodeValue:function(t){t.length=0;var e=this.nodeStatement();if(!1!==e)return t.push(e),!0;if(To.OpenBracket.parse(this)){if(this.nodeStatements(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},nodeStatements:function(t){for(var e=this.nodeStatement();!1!==e;)t.push(e),e=this.nodeStatement()},sfrotationValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;return t.x=e,t.y=n,t.z=i,t.angle=this.fromUnit("angle",o),!0}}}}return!1},mfrotationValue:function(t){if(t.length=0,this.sfrotationValue(this.SFRotation))return t.push(this.SFRotation),!0;if(To.OpenBracket.parse(this)){if(this.sfrotationValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfrotationValues:function(t){for(t.length=0,t=t.getTarget();this.sfrotationValue(this.SFRotation);)t.push(this.SFRotation)},sfstringValue:function(t){return!!this.string()&&(t.setValue(this.value),!0)},mfstringValue:function(t){if(t.length=0,this.sfstringValue(this.SFString))return t.push(this.SFString),!0;if(To.OpenBracket.parse(this)){if(this.sfstringValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfstringValues:function(t){for(t.length=0,t=t.getTarget();this.sfstringValue(this.SFString);)t.push(this.SFString)},sftimeValue:function(t){return this.sfdoubleValue(t)},mftimeValue:function(t){if(t.length=0,this.sftimeValue(this.SFTime))return t.push(this.SFTime),!0;if(To.OpenBracket.parse(this)){if(this.sftimeValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sftimeValues:function(t){for(t.length=0,t=t.getTarget();this.sftimeValue(this.SFTime);)t.push(this.SFTime)},sfvec2dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value,i=t.getUnit();return t.x=this.fromUnit(i,e),t.y=this.fromUnit(i,n),!0}}return!1},mfvec2dValue:function(t){if(t.length=0,this.SFVec2d.setUnit(t.getUnit()),this.sfvec2dValue(this.SFVec2d))return t.push(this.SFVec2d),!0;if(To.OpenBracket.parse(this)){if(this.sfvec2dValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec2d.setUnit(t.getUnit());this.sfvec2dValue(this.SFVec2d);)t.push(this.SFVec2d)},sfvec2fValue:function(t){return this.sfvec2dValue(t)},mfvec2fValue:function(t){if(t.length=0,this.SFVec2f.setUnit(t.getUnit()),this.sfvec2fValue(this.SFVec2f))return t.push(this.SFVec2f),!0;if(To.OpenBracket.parse(this)){if(this.sfvec2fValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec2f.setUnit(t.getUnit());this.sfvec2fValue(this.SFVec2f);)t.push(this.SFVec2f)},sfvec3dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value,o=t.getUnit();return t.x=this.fromUnit(o,e),t.y=this.fromUnit(o,n),t.z=this.fromUnit(o,i),!0}}}return!1},mfvec3dValue:function(t){if(t.length=0,this.SFVec3d.setUnit(t.getUnit()),this.sfvec3dValue(this.SFVec3d))return t.push(this.SFVec3d),!0;if(To.OpenBracket.parse(this)){if(this.sfvec3dValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec3d.setUnit(t.getUnit());this.sfvec3dValue(this.SFVec3d);)t.push(this.SFVec3d)},sfvec3fValue:function(t){return this.sfvec3dValue(t)},mfvec3fValue:function(t){if(t.length=0,this.SFVec3f.setUnit(t.getUnit()),this.sfvec3fValue(this.SFVec3f))return t.push(this.SFVec3f),!0;if(To.OpenBracket.parse(this)){if(this.sfvec3fValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec3f.setUnit(t.getUnit());this.sfvec3fValue(this.SFVec3f);)t.push(this.SFVec3f)},sfvec4dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value,r=t.getUnit();return t.x=this.fromUnit(r,e),t.y=this.fromUnit(r,n),t.z=this.fromUnit(r,i),t.w=this.fromUnit(r,o),!0}}}}return!1},mfvec4dValue:function(t){if(t.length=0,this.SFVec4d.setUnit(t.getUnit()),this.sfvec4dValue(this.SFVec4d))return t.push(this.SFVec4d),!0;if(To.OpenBracket.parse(this)){if(this.sfvec4dValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec4d.setUnit(t.getUnit());this.sfvec4dValue(this.SFVec4d);)t.push(this.SFVec4d)},sfvec4fValue:function(t){return this.sfvec4dValue(t)},mfvec4fValue:function(t){if(t.length=0,this.SFVec4f.setUnit(t.getUnit()),this.sfvec4fValue(this.SFVec4f))return t.push(this.SFVec4f),!0;if(To.OpenBracket.parse(this)){if(this.sfvec4fValues(t),this.comments(),To.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec4f.setUnit(t.getUnit());this.sfvec4fValue(this.SFVec4f);)t.push(this.SFVec4f)},accessTypeToString:function(t){switch(t){case o.initializeOnly:return"initializeOnly";case o.inputOnly:return"inputOnly";case o.outputOnly:return"outputOnly";case o.inputOutput:return"inputOutput"}}}),vo.prototype.fieldTypes=[],vo.prototype.fieldTypes[o.SFBool]=vo.prototype.sfboolValue,vo.prototype.fieldTypes[o.SFColor]=vo.prototype.sfcolorValue,vo.prototype.fieldTypes[o.SFColorRGBA]=vo.prototype.sfcolorrgbaValue,vo.prototype.fieldTypes[o.SFDouble]=vo.prototype.sfdoubleValue,vo.prototype.fieldTypes[o.SFFloat]=vo.prototype.sffloatValue,vo.prototype.fieldTypes[o.SFImage]=vo.prototype.sfimageValue,vo.prototype.fieldTypes[o.SFInt32]=vo.prototype.sfint32Value,vo.prototype.fieldTypes[o.SFMatrix3f]=vo.prototype.sfmatrix3dValue,vo.prototype.fieldTypes[o.SFMatrix3d]=vo.prototype.sfmatrix3fValue,vo.prototype.fieldTypes[o.SFMatrix4f]=vo.prototype.sfmatrix4dValue,vo.prototype.fieldTypes[o.SFMatrix4d]=vo.prototype.sfmatrix4fValue,vo.prototype.fieldTypes[o.SFNode]=vo.prototype.sfnodeValue,vo.prototype.fieldTypes[o.SFRotation]=vo.prototype.sfrotationValue,vo.prototype.fieldTypes[o.SFString]=vo.prototype.sfstringValue,vo.prototype.fieldTypes[o.SFTime]=vo.prototype.sftimeValue,vo.prototype.fieldTypes[o.SFVec2d]=vo.prototype.sfvec2dValue,vo.prototype.fieldTypes[o.SFVec2f]=vo.prototype.sfvec2fValue,vo.prototype.fieldTypes[o.SFVec3d]=vo.prototype.sfvec3dValue,vo.prototype.fieldTypes[o.SFVec3f]=vo.prototype.sfvec3fValue,vo.prototype.fieldTypes[o.SFVec4d]=vo.prototype.sfvec4dValue,vo.prototype.fieldTypes[o.SFVec4f]=vo.prototype.sfvec4fValue,vo.prototype.fieldTypes[o.MFBool]=vo.prototype.mfboolValue,vo.prototype.fieldTypes[o.MFColor]=vo.prototype.mfcolorValue,vo.prototype.fieldTypes[o.MFColorRGBA]=vo.prototype.mfcolorrgbaValue,vo.prototype.fieldTypes[o.MFDouble]=vo.prototype.mfdoubleValue,vo.prototype.fieldTypes[o.MFFloat]=vo.prototype.mffloatValue,vo.prototype.fieldTypes[o.MFImage]=vo.prototype.mfimageValue,vo.prototype.fieldTypes[o.MFInt32]=vo.prototype.mfint32Value,vo.prototype.fieldTypes[o.MFMatrix3d]=vo.prototype.mfmatrix3dValue,vo.prototype.fieldTypes[o.MFMatrix3f]=vo.prototype.mfmatrix3fValue,vo.prototype.fieldTypes[o.MFMatrix4d]=vo.prototype.mfmatrix4dValue,vo.prototype.fieldTypes[o.MFMatrix4f]=vo.prototype.mfmatrix4fValue,vo.prototype.fieldTypes[o.MFNode]=vo.prototype.mfnodeValue,vo.prototype.fieldTypes[o.MFRotation]=vo.prototype.mfrotationValue,vo.prototype.fieldTypes[o.MFString]=vo.prototype.mfstringValue,vo.prototype.fieldTypes[o.MFTime]=vo.prototype.mftimeValue,vo.prototype.fieldTypes[o.MFVec2d]=vo.prototype.mfvec2dValue,vo.prototype.fieldTypes[o.MFVec2f]=vo.prototype.mfvec2fValue,vo.prototype.fieldTypes[o.MFVec3d]=vo.prototype.mfvec3dValue,vo.prototype.fieldTypes[o.MFVec3f]=vo.prototype.mfvec3fValue,vo.prototype.fieldTypes[o.MFVec4d]=vo.prototype.mfvec4dValue,vo.prototype.fieldTypes[o.MFVec4f]=vo.prototype.mfvec4fValue;const Eo=vo,Co=Symbol.for("X_ITE.dom"),Oo={initializeOnly:o.initializeOnly,inputOnly:o.inputOnly,outputOnly:o.outputOnly,inputOutput:o.inputOutput};function Fo(t){wo.call(this,t),this.protoDeclarations=[],this.parents=[],this.parser=new Eo(t),this.url=new Bn.MFString;try{this.setUnits(this.getScene().getMetaData("generator")),this.parser.setUnits(this.getUnits())}catch(t){}}Fo.prototype=Object.assign(Object.create(wo.prototype),{constructor:Fo,isValid:function(){return this.input instanceof XMLDocument||this.input instanceof HTMLElement||null===this.input},getInput:function(){return this.input},setInput(t){try{"string"==typeof t&&(t=$.parseXML(t)),this.input=t}catch(t){this.input=void 0}},parseIntoScene:function(t,e){this.scene[Co]=this.input,this.success=t,this.error=e,this.getScene().setEncoding("XML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.xmlElement(this.input)},parseIntoNode:function(t,e){this.pushExecutionContext(t.getExecutionContext()),this.pushParent(t),this.childElement(e),this.popParent(),this.popExecutionContext()},xmlElement:function(t){if(null===t&&this.success)return this.success(this.getScene());switch(t.nodeName){case"#document":var e=$(t).children("X3D");if(e.length)for(var n=0;n<e.length;++n)this.x3dElement(e[n]);else this.success?Promise.all(this.getProviderUrls().map((t=>import(t)))).then(function(){this.childrenElements(t),this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this)):this.childrenElements(t);break;case"X3D":this.x3dElement(t);break;case"Scene":case"SCENE":this.success?Promise.all(this.getProviderUrls().map((t=>import(t)))).then(function(){this.sceneElement(t),this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this)):this.sceneElement(t);break;default:this.success?Promise.all(this.getProviderUrls().map((t=>import(t)))).then(function(){this.childrenElements(t),this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this)):this.childrenElements(t)}},x3dElement:function(t){try{var e=t.getAttribute("profile"),n=this.getBrowser().getProfile(e||"Full");this.getScene().setProfile(n)}catch(t){console.error(t)}var i=t.getAttribute("version");i&&this.getScene().setSpecificationVersion(i);for(var o=t.childNodes,r=0;r<o.length;++r)this.x3dElementChildHead(o[r]);if(this.success)Promise.all(this.getProviderUrls().map((t=>import(t)))).then(function(){for(var t=0;t<o.length;++t)this.x3dElementChildScene(o[t]);this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this));else for(r=0;r<o.length;++r)this.x3dElementChildScene(o[r])},x3dElementChildHead:function(t){switch(t.nodeName){case"head":case"HEAD":return void this.headElement(t)}},x3dElementChildScene:function(t){switch(t.nodeName){case"Scene":case"SCENE":return void this.sceneElement(t)}},headElement:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.headElementChild(e[n]);try{this.setUnits(this.getScene().getMetaData("generator")),this.parser.setUnits(this.getUnits())}catch(t){}},headElementChild:function(t){switch(t.nodeName){case"component":case"COMPONENT":return void this.componentElement(t);case"unit":case"UNIT":return void this.unitElement(t);case"meta":case"META":return void this.metaElement(t)}},componentElement:function(t){try{var e=t.getAttribute("name"),n=parseInt(t.getAttribute("level"));if(null===e)return console.warn("XML Parser Error: Bad component statement: Expected name attribute.");if(null===n)return console.warn("XML Parser Error: Bad component statement: Expected level attribute.");var i=this.getBrowser().getComponent(e,n);this.getScene().addComponent(i)}catch(t){console.log(t.message)}},unitElement:function(t){var e=t.getAttribute("category"),n=t.getAttribute("name"),i=t.getAttribute("conversionFactor");return null===e?console.warn("XML Parser Error: Bad unit statement: Expected category attribute."):null===n?console.warn("XML Parser Error: Bad unit statement: Expected name attribute."):null===i?console.warn("XML Parser Error: Bad unit statement: Expected conversionFactor attribute."):void this.getScene().updateUnit(e,n,parseFloat(i))},metaElement:function(t){var e=t.getAttribute("name"),n=t.getAttribute("content");return null===e?console.warn("XML Parser Error: Bad meta statement: Expected name attribute."):null===n?console.warn("XML Parser Error: Bad meta statement: Expected content attribute."):void this.getScene().setMetaData(e,n)},sceneElement:function(t){this.childrenElements(t)},childrenElements:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.childElement(e[n])},childElement:function(t){switch(t.nodeName){case"#comment":case"#text":return;case"#cdata-section":return void this.cdataNode(t);case"ExternProtoDeclare":case"EXTERNPROTODECLARE":return void this.externProtoDeclareElement(t);case"ProtoDeclare":case"PROTODECLARE":return void this.protoDeclareElement(t);case"IS":return void this.isElement(t);case"ProtoInstance":case"PROTOINSTANCE":return void this.protoInstanceElement(t);case"fieldValue":case"FIELDVALUE":return void this.fieldValueElement(t);case"field":case"FIELD":return void this.fieldElement(t);case"ROUTE":return void this.routeElement(t);case"IMPORT":return void this.importElement(t);case"EXPORT":return void this.exportElement(t);default:return void this.nodeElement(t)}},externProtoDeclareElement:function(t){var e=t.getAttribute("name");if(this.id(e)){var n=t.getAttribute("url");if(null===n)return console.warn("XML Parser Error: Bad ExternProtoDeclare statement: Expected url attribute.");this.parser.setInput(n),Eo.prototype.sfstringValues.call(this.parser,this.url);var i=new ea(this.getExecutionContext(),this.url);this.pushParent(i),this.protoInterfaceElement(t),this.popParent(),i.setup();try{const t=this.getExecutionContext().getExternProtoDeclaration(e);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(e),t)}catch(t){}this.getExecutionContext().updateExternProtoDeclaration(e,i)}},protoDeclareElement:function(t){var e=t.getAttribute("name");if(this.id(e)){for(var n=new ho(this.getExecutionContext()),i=t.childNodes,o=0;o<i.length;++o){switch((r=i[o]).nodeName){case"ProtoInterface":case"PROTOINTERFACE":this.pushParent(n),this.protoInterfaceElement(r),this.popParent();break;default:continue}break}for(o=0;o<i.length;++o){var r;switch((r=i[o]).nodeName){case"ProtoBody":case"PROTOBODY":this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.pushParent(n),this.protoBodyElement(r),this.popParent(),this.popExecutionContext(),this.popPrototype();break;default:continue}break}n.setup();try{const t=this.getExecutionContext().getProtoDeclaration(e);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(e),t)}catch(t){}this.getExecutionContext().updateProtoDeclaration(e,n)}},protoInterfaceElement:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.protoInterfaceElementChild(e[n])},protoInterfaceElementChild:function(t){switch(t.nodeName){case"field":case"FIELD":return void this.fieldElement(t)}},fieldElement:function(t){try{if(0===this.getParents().length)return;var e=this.getParent();if(!(e instanceof Zn))return;if(!e.canUserDefinedFields())return;var n=Oo[t.getAttribute("accessType")];void 0===n&&(n=o.initializeOnly);var i=Bn[t.getAttribute("type")];if(void 0===i)return;var r=t.getAttribute("name");if(!this.id(r))return;var s=new i;n&o.initializeOnly&&(this.fieldValue(s,t.getAttribute("value")),this.pushParent(s),this.childrenElements(t),this.popParent()),e.addUserDefinedField(n,r,s)}catch(t){}},protoBodyElement:function(t){this.childrenElements(t)},isElement:function(t){if(this.isInsideProtoDefinition())for(var e=t.childNodes,n=0;n<e.length;++n)this.isElementChild(e[n])},isElementChild:function(t){switch(t.nodeName){case"connect":case"CONNECT":return void this.connectElement(t)}},connectElement:function(t){var e=t.getAttribute("nodeField"),n=t.getAttribute("protoField");if(null===e)return console.warn("XML Parser Error: Bad connect statement: Expected nodeField attribute.");if(null===n)return console.warn("XML Parser Error: Bad connect statement: Expected protoField attribute.");try{if(0===this.getParents().length)return;var i=this.getParent(),o=this.getPrototype();if(!(i instanceof Zn))return;var r=i.getField(e),s=o.getField(n);if(r.getType()!==s.getType())throw new Error("Field '"+r.getName()+"' and '"+s.getName()+"' in PROTO "+this.proto.getName()+" have different types.");if(!s.isReference(r.getAccessType()))throw new Error("Field '"+r.getName()+"' and '"+s.getName()+"' in PROTO "+o.getName()+" are incompatible as an IS mapping.");r.addReference(s)}catch(t){console.warn("XML Parser Error: Couldn't create IS reference: "+t.message)}},protoInstanceElement:function(t){try{if(this.useAttribute(t))return;var e=t.getAttribute("name");if(this.id(e)){var n=this.getExecutionContext().createProto(e,!1);if(!n)throw new Error("Unknown proto or externproto type '"+e+"'.");t.x3d=n,this.defAttribute(t,n),this.addNode(t,n),this.pushParent(n),this.childrenElements(t),this.isInsideProtoDefinition()||n.setup(),this.popParent()}}catch(t){console.warn("XML Parser Error: ",t.message)}},fieldValueElement:function(t){try{if(0===this.getParents().length)return;var e=this.getParent(),n=t.getAttribute("name");if(!(e instanceof so))return;if(!this.id(n))return;var i=e.getField(n);i.getAccessType()&o.initializeOnly&&(i.getType()===o.MFNode&&(i.length=0),this.fieldValue(i,t.getAttribute("value")),this.pushParent(i),this.childrenElements(t),this.popParent())}catch(t){console.warn("XML Parser Error: Couldn't assign field value: "+t.message)}},nodeElement:function(t){try{if(this.useAttribute(t))return;var e=this.getExecutionContext().createNode(this.nodeNameToCamelCase(t.nodeName),!1);if(!e)throw new Error("Unknown node type '"+t.nodeName+"', you probably have insufficient component/profile statements.");t.x3d=e,this.defAttribute(t,e),this.addNode(t,e),this.pushParent(e),this.nodeAttributes(t,e),this.childrenElements(t),this.isInsideProtoDefinition()||e.setup(),this.popParent()}catch(e){if("NULL"==t.nodeName)return void this.addNode(t,null);console.error(e),console.error("XML Parser Error: "+e.message)}},routeElement:function(t){try{var e=t.getAttribute("fromNode"),n=t.getAttribute("fromField"),i=t.getAttribute("toNode"),o=t.getAttribute("toField");if(null===e)throw new Error("Bad ROUTE statement: Expected fromNode attribute.");if(null===n)throw new Error("Bad ROUTE statement: Expected fromField attribute.");if(null===i)throw new Error("Bad ROUTE statement: Expected toNode attribute.");if(null===o)throw new Error("Bad ROUTE statement: Expected toField attribute.");var r=this.getExecutionContext(),s=r.getLocalNode(e),a=r.getLocalNode(i),u=r.addRoute(s,n,a,o);t.x3d=u}catch(t){console.error(t),console.warn("XML Parser Error: "+t.message)}},importElement:function(t){try{var e=t.getAttribute("inlineDEF"),n=t.getAttribute("importedDEF")||t.getAttribute("exportedDEF"),i=t.getAttribute("AS");if(null===e)throw new Error("Bad IMPORT statement: Expected inlineDEF attribute.");if(null===n)throw new Error("Bad IMPORT statement: Expected importedDEF attribute.");i||(i=n);var o=this.getExecutionContext().getNamedNode(e);this.getExecutionContext().updateImportedNode(o,n,i)}catch(t){console.warn("XML Parser Error: "+t.message)}},exportElement:function(t){try{if(this.getScene()!==this.getExecutionContext())return void console.warn("XML Parser Error: Export statement not allowed here.");var e=t.getAttribute("localDEF"),n=t.getAttribute("AS");if(null===e)throw new Error("Bad EXPORT statement: Expected localDEF attribute.");n||(n=e);var i=this.getExecutionContext().getLocalNode(e);this.getScene().updateExportedNode(n,i)}catch(t){console.warn("XML Parser Error: "+t.message)}},cdataNode:function(t){if(0!==this.getParents().length){var e=this.getParent();if(e instanceof Zn){var n=e.getSourceText();n&&n.push(t.data)}}},useAttribute:function(t){try{var e=t.getAttribute("USE");if(this.id(e)){var n=this.getExecutionContext().getNamedNode(e);return this.addNode(t,n.getValue()),!0}}catch(t){console.warn("Invalid USE name: "+t.message)}return!1},defAttribute:function(t,e){try{var n=t.getAttribute("DEF");if(n){try{var i=this.getExecutionContext().getNamedNode(n);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(n),i)}catch(t){}this.getExecutionContext().updateNamedNode(n,e)}}catch(t){console.warn("Invalid DEF name: "+t.message)}},nodeAttributes:function(t,e){for(var n=t.attributes,i=0;i<n.length;++i)this.nodeAttribute(n[i],e)},nodeAttribute:function(t,e){try{var n=e.getField(this.attributeToCamelCase(t.name));n.getAccessType()&o.initializeOnly&&this.fieldValue(n,t.value)}catch(t){}},fieldValue:function(t,e){null!==e&&(this.parser.pushExecutionContext(this.getExecutionContext()),this.parser.setInput(e),this.fieldTypes[t.getType()].call(this.parser,t),this.parser.popExecutionContext())},addNode:function(t,e){if(0===this.parents.length||this.getParent()instanceof ho)this.getExecutionContext().rootNodes.push(e);else{var n=this.getParent();if(n instanceof R)switch(n.getType()){case o.SFNode:return void n.setValue(e);case o.MFNode:return void n.push(e)}else try{var i=t.getAttribute("containerField");if(!i){if(!e)throw new Error("NULL node must have a container field attribute.");i=e.getContainerField()}var r=n.getField(i);switch(r.getType()){case o.SFNode:return void r.setValue(e);case o.MFNode:return void r.push(e)}}catch(t){}}},getParents:function(){return this.parents},getParent:function(){return this.parents.at(-1)},pushParent:function(t){return this.parents.push(t)},popParent:function(){this.parents.pop()},id:function(t){return null!==t&&0!==t.length},nodeNameToCamelCase:function(t){return Di.getNodeTypeName(t)},attributeToCamelCase:function(t){return Di.getFieldName(t)}}),Fo.prototype.fieldTypes=[],Fo.prototype.fieldTypes[o.SFBool]=Eo.prototype.sfboolValue,Fo.prototype.fieldTypes[o.SFColor]=Eo.prototype.sfcolorValue,Fo.prototype.fieldTypes[o.SFColorRGBA]=Eo.prototype.sfcolorrgbaValue,Fo.prototype.fieldTypes[o.SFDouble]=Eo.prototype.sfdoubleValue,Fo.prototype.fieldTypes[o.SFFloat]=Eo.prototype.sffloatValue,Fo.prototype.fieldTypes[o.SFImage]=Eo.prototype.sfimageValue,Fo.prototype.fieldTypes[o.SFInt32]=Eo.prototype.sfint32Value,Fo.prototype.fieldTypes[o.SFMatrix3f]=Eo.prototype.sfmatrix3dValue,Fo.prototype.fieldTypes[o.SFMatrix3d]=Eo.prototype.sfmatrix3fValue,Fo.prototype.fieldTypes[o.SFMatrix4f]=Eo.prototype.sfmatrix4dValue,Fo.prototype.fieldTypes[o.SFMatrix4d]=Eo.prototype.sfmatrix4fValue,Fo.prototype.fieldTypes[o.SFNode]=function(t){t.setValue(null)},Fo.prototype.fieldTypes[o.SFRotation]=Eo.prototype.sfrotationValue,Fo.prototype.fieldTypes[o.SFString]=function(t){t.setValue(Bn.SFString.unescape(this.input))},Fo.prototype.fieldTypes[o.SFTime]=Eo.prototype.sftimeValue,Fo.prototype.fieldTypes[o.SFVec2d]=Eo.prototype.sfvec2dValue,Fo.prototype.fieldTypes[o.SFVec2f]=Eo.prototype.sfvec2fValue,Fo.prototype.fieldTypes[o.SFVec3d]=Eo.prototype.sfvec3dValue,Fo.prototype.fieldTypes[o.SFVec3f]=Eo.prototype.sfvec3fValue,Fo.prototype.fieldTypes[o.SFVec4d]=Eo.prototype.sfvec4dValue,Fo.prototype.fieldTypes[o.SFVec4f]=Eo.prototype.sfvec4fValue,Fo.prototype.fieldTypes[o.MFBool]=Eo.prototype.sfboolValues,Fo.prototype.fieldTypes[o.MFColor]=Eo.prototype.sfcolorValues,Fo.prototype.fieldTypes[o.MFColorRGBA]=Eo.prototype.sfcolorrgbaValues,Fo.prototype.fieldTypes[o.MFDouble]=Eo.prototype.sfdoubleValues,Fo.prototype.fieldTypes[o.MFFloat]=Eo.prototype.sffloatValues,Fo.prototype.fieldTypes[o.MFImage]=Eo.prototype.sfimageValues,Fo.prototype.fieldTypes[o.MFInt32]=Eo.prototype.sfint32Values,Fo.prototype.fieldTypes[o.MFMatrix3d]=Eo.prototype.sfmatrix3dValues,Fo.prototype.fieldTypes[o.MFMatrix3f]=Eo.prototype.sfmatrix3fValues,Fo.prototype.fieldTypes[o.MFMatrix4d]=Eo.prototype.sfmatrix4dValues,Fo.prototype.fieldTypes[o.MFMatrix4f]=Eo.prototype.sfmatrix4fValues,Fo.prototype.fieldTypes[o.MFNode]=function(t){t.length=0},Fo.prototype.fieldTypes[o.MFRotation]=Eo.prototype.sfrotationValues,Fo.prototype.fieldTypes[o.MFString]=Eo.prototype.sfstringValues,Fo.prototype.fieldTypes[o.MFTime]=Eo.prototype.sftimeValues,Fo.prototype.fieldTypes[o.MFVec2d]=Eo.prototype.sfvec2dValues,Fo.prototype.fieldTypes[o.MFVec2f]=Eo.prototype.sfvec2fValues,Fo.prototype.fieldTypes[o.MFVec3d]=Eo.prototype.sfvec3dValues,Fo.prototype.fieldTypes[o.MFVec3f]=Eo.prototype.sfvec3fValues,Fo.prototype.fieldTypes[o.MFVec4d]=Eo.prototype.sfvec4dValues,Fo.prototype.fieldTypes[o.MFVec4f]=Eo.prototype.sfvec4fValues;var No=/\binf\b/g,Mo=/\bnan\b/g,Vo=/^[\x20\n,\t\r"]+|[\x20\n,\t\r"]+$/g,Io=/[\x20\n,\t\r"]+/,Do=new RegExp('"((?:[^\\\\"]|\\\\\\\\|\\\\\\")*)"',"g");function Ro(t){return t.replace(No,"Infinity").replace(Mo,"NaN").replace(Vo,"").split(Io)}Fo.prototype.fieldTypes[o.MFColor]=Fo.prototype.fieldTypes[o.MFColorRGBA]=Fo.prototype.fieldTypes[o.MFMatrix3d]=Fo.prototype.fieldTypes[o.MFMatrix3f]=Fo.prototype.fieldTypes[o.MFMatrix4d]=Fo.prototype.fieldTypes[o.MFMatrix4f]=Fo.prototype.fieldTypes[o.MFVec4d]=Fo.prototype.fieldTypes[o.MFVec4f]=function(t){t.setValue(Ro(this.getInput()).map((function(t){return parseFloat(t)})))},Fo.prototype.fieldTypes[o.MFBool]=function(t){var e;t.setValue((e=this.getInput(),e.replace(Vo,"").split(Io)).map((function(t){return"true"===t||"TRUE"===t})))},Fo.prototype.fieldTypes[o.MFInt32]=function(t){var e;t.setValue((e=this.getInput(),e.replace(Vo,"").split(Io)).map((function(t){return parseInt(t)})))},Fo.prototype.fieldTypes[o.MFDouble]=Fo.prototype.fieldTypes[o.MFFloat]=Fo.prototype.fieldTypes[o.MFVec2d]=Fo.prototype.fieldTypes[o.MFVec2f]=Fo.prototype.fieldTypes[o.MFVec3d]=Fo.prototype.fieldTypes[o.MFVec3f]=function(t){var e=t.getUnit();t.setValue(Ro(this.getInput()).map((function(t){return this.fromUnit(e,parseFloat(t))}),this))},Fo.prototype.fieldTypes[o.MFString]=function(t){t.setValue(function(t){for(var e=null,n=[];e=Do.exec(t);)n.push(e[1]);return n.map(Bn.SFString.unescape)}(this.getInput()))};const Po=Fo;function Ao(t){wo.call(this,t),this.x3djsonNS="http://www.web3d.org/specifications/x3d-namespace"}Ao.prototype=Object.assign(Object.create(wo.prototype),{constructor:Ao,isValid:function(){return this.input instanceof Object},getInput:function(){return this.input},setInput:function(t){try{"string"==typeof t&&(t=JSON.parse(t)),this.input=t}catch(t){this.input=void 0}},parseIntoScene:function(t,e){const n=this.createElement("X3D");this.convertToDOM(this.input,"",n);const i=new Po(this.getScene());return i.setInput(n),i.parseIntoScene(t,e),n},elementSetAttribute:function(t,e,n){switch(e){case"SON schema":case"ncoding":break;default:"function"==typeof t.setAttribute&&t.setAttribute(e,n)}},convertChildren:function(t,e,n){for(const i in e)"object"==typeof e[i]&&(isNaN(parseInt(i))?this.convertObject(i,e,n,t.substr(1)):this.convertToDOM(e[i],i,n,t.substr(1)))},createElement:function(t,e){if(void 0===this.x3djsonNS)var n=document.createElement(t);else null==(n=document.createElementNS(this.x3djsonNS,t))&&(console.error("Trouble creating element for",t),n=document.createElement(t));return void 0!==e&&this.elementSetAttribute(n,"containerField",e),n},createCDATA:function(t,e,n){let i=n.trim().replace(/\\"/g,'\\"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");do{i=(n=i).replace(/'([^'\r\n]*)\n([^']*)'/g,"'$1\\n$2'"),n!==i&&console.log("CDATA Replacing",n,"with",i)}while(i!==n);const o="<script> <![CDATA[ "+i+" ]]> <\/script>",r=(new DOMParser).parseFromString(o,"application/xml").children[0].childNodes[1];e.appendChild(r)},convertObject:function(t,e,n,i){if(null!==e&&"object"==typeof e[t])if("@"===t.substr(0,1))this.convertToDOM(e[t],t,n);else if("-"===t.substr(0,1))this.convertChildren(t,e[t],n);else if("#comment"===t)for(const i in e[t]){const o=document.createComment(this.commentStringToXML(e[t][i]));n.appendChild(o)}else if("#sourceCode"===t||"@sourceCode"===t||"#sourceText"===t)this.createCDATA(document,n,e[t].join("\r\n")+"\r\n");else if("connect"===t||"fieldValue"===t||"field"===t||"meta"===t||"component"===t){for(const o in e[t])if("object"==typeof e[t][o]){const r=this.createElement(t,i);this.convertToDOM(e[t][o],o,r),n.appendChild(r),n.appendChild(document.createTextNode("\n"))}}else{const o=this.createElement(t,i);this.convertToDOM(e[t],t,o),n.appendChild(o),n.appendChild(document.createTextNode("\n"))}},commentStringToXML:function(t){let e=t;return e!==(t=t.replace(/\\\\/g,"\\"))&&console.log("X3DJSONLD <!-> replacing",e,"with",t),t},SFStringToXML:function(t){const e=t;return e!==(t=(t=t.replace(/\\/g,"\\\\")).replace(/"/g,'\\"'))&&console.log("X3DJSONLD [] replacing",e,"with",t),t},JSONStringToXML:function(t){const e=t;return e!==(t=(t=t.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n"))&&console.log("X3DJSONLD replacing",e,"with",t),t},convertToDOM:function(t,e,n,i){let o=!1,r=[],s=!1;for(const e in t)if(o=!isNaN(parseInt(e)),o)switch(typeof t[e]){case"number":case"boolean":r.push(t[e]);break;case"string":r.push(t[e]),s=!0;break;case"object":this.convertToDOM(t[e],e,n);break;case"undefined":break;default:console.error("Unknown type found in array "+typeof t[e])}else switch(typeof t[e]){case"object":"X3D"===e?this.convertToDOM(t[e],e,n):this.convertObject(e,t,n,i);break;case"number":case"boolean":this.elementSetAttribute(n,e.substr(1),t[e]);break;case"string":if("#comment"!==e)this.elementSetAttribute(n,e.substr(1),this.JSONStringToXML(t[e]));else{const i=document.createComment(this.commentStringToXML(t[e]));n.appendChild(i)}break;case"undefined":break;default:console.error("Unknown type found in object "+typeof t[e]),console.error(t)}if(o){if("@"===e.substr(0,1))if(s){s=!1;for(const t in r)r[t]=this.SFStringToXML(r[t]);this.elementSetAttribute(n,e.substr(1),'"'+r.join('" "')+'"')}else this.elementSetAttribute(n,e.substr(1),r.join(" "));o=!1}return n}});const Lo=Ao;function Bo(t){wo.call(this,t)}Bo.prototype=Object.assign(Object.create(wo.prototype),{constructor:Bo,parseIntoScene:function(t,e,n){for(const i of Bo.Parser)try{const o=new i(this.getScene());if(o.setInput(t),o.isValid())return o.pushExecutionContext(this.getExecutionContext()),o.parseIntoScene(e,n),void o.popExecutionContext()}catch(t){if(!n)throw t;return void n(t)}throw this.getScene().worldURL.startsWith("data:")?new Error("Couldn't parse X3D. No suitable file handler found for 'data:' URL."):new Error("Couldn't parse X3D. No suitable file handler found for '"+this.getScene().worldURL+"'.")}}),Bo.Parser=[Po,Lo,Eo];const Xo=Bo,Uo=new qt(0,0,0),zo=new qt(0,0,0),jo=new Ne;function ko(t,e){this.normal=e.copy(),this.distanceFromOrigin=e.dot(t)}ko.prototype={constructor:ko,copy:function(){const t=Object.create(ko.prototype);return t.normal=this.normal.copy(),t.distanceFromOrigin=this.distanceFromOrigin,t},assign:function(t){return this.normal.assign(t.normal),this.distanceFromOrigin=t.distanceFromOrigin,this},set:function(t,e){return this.normal.assign(e),this.distanceFromOrigin=e.dot(t),this},multRight:function(t){return zo.assign(this.normal).multiply(this.distanceFromOrigin),jo.assign(t).inverse(),jo.multMatrixDir(Uo.assign(this.normal)).normalize(),t.multVecMatrix(zo),this.normal.assign(Uo),this.distanceFromOrigin=Uo.dot(zo),this},multLeft:function(t){return zo.assign(this.normal).multiply(this.distanceFromOrigin),jo.assign(t).inverse(),jo.multDirMatrix(Uo.assign(this.normal)).normalize(),t.multMatrixVec(zo),this.normal.assign(Uo),this.distanceFromOrigin=Uo.dot(zo),this},getDistanceToPoint:function(t){return qt.dot(t,this.normal)-this.distanceFromOrigin},intersectsLine:function(t,e){const n=t.point,i=t.direction,o=i.dot(this.normal);if(0===o)return!1;const r=(this.distanceFromOrigin-this.normal.dot(n))/o;return e.x=n.x+i.x*r,e.y=n.y+i.y*r,e.z=n.z+i.z*r,!0},toString:function(){return this.normal.toString()+" "+this.distanceFromOrigin}};const Go=ko,Ho={area:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i,o){return t.assign(i).subtract(n).cross(e.assign(o).subtract(n)).magnitude()/2}}(),normal:function(t,e,n,i){const o=n.x-e.x,r=n.y-e.y,s=n.z-e.z,a=t.x-e.x,u=t.y-e.y,c=t.z-e.z;return i.set(r*c-s*u,s*a-o*c,o*u-r*a),i.normalize()},quadNormal:function(t,e,n,i,o){const r=n.x-t.x,s=n.y-t.y,a=n.z-t.z,u=i.x-e.x,c=i.y-e.y,l=i.z-e.z;return o.set(s*l-a*c,a*u-r*l,r*c-s*u),o.normalize()},triangulatePolygon:function(){const t=function(){const t=new libtess.GluTesselator;return t.gluTessCallback(libtess.gluEnum.GLU_TESS_VERTEX_DATA,(function(t,e){e[e.length]=t})),t.gluTessCallback(libtess.gluEnum.GLU_TESS_BEGIN,(function(t){t!==libtess.primitiveType.GL_TRIANGLES&&console.log("expected TRIANGLES but got type: "+t)})),t.gluTessCallback(libtess.gluEnum.GLU_TESS_ERROR,(function(t){console.log("error callback"),console.log("error number: "+t)})),t.gluTessCallback(libtess.gluEnum.GLU_TESS_COMBINE,(function(t,e,n){return e[0]})),t.gluTessCallback(libtess.gluEnum.GLU_TESS_EDGE_FLAG,(function(t){})),t.gluTessProperty(libtess.gluEnum.GLU_TESS_TOLERANCE,0),t.gluTessProperty(libtess.gluEnum.GLU_TESS_WINDING_RULE,libtess.windingRule.GLU_TESS_WINDING_ODD),t}();return function(){const e=arguments[arguments.length-1];t.gluTessBeginPolygon(e);for(let e=0,n=arguments.length-1;e<n;++e){t.gluTessBeginContour();for(const n of arguments[e])t.gluTessVertex(n,n);t.gluTessEndContour()}return t.gluTessEndPolygon(),e}}(),triangulateConvexPolygon:function(t,e){for(let n=1,i=t.length-1;n<i;++n)e.push(t[0],t[n],t[n+1])},getPolygonNormal:function(t,e){e.set(0,0,0);var n=t[0];for(let o=0,r=t.length;o<r;++o){var i=n;n=t[(o+1)%r];e.x+=(i.y-n.y)*(i.z+n.z),e.y+=(i.z-n.z)*(i.x+n.x),e.z+=(i.x-n.x)*(i.y+n.y)}return e.normalize()}},qo={min:0,max:0},Yo={min:0,max:0};function Wo(){}function $o(t,e,n){n.min=Number.POSITIVE_INFINITY,n.max=Number.NEGATIVE_INFINITY;for(const i of t){const t=i.dot(e);t<n.min&&(n.min=t),t>n.max&&(n.max=t)}}function Ko(t,e,n){return e<=t&&t<=n}Wo.isSeparated=function(t,e,n){for(const s of t)if($o(e,s,qo),$o(n,s,Yo),r=Yo.max,!Ko(o=Yo.min,i=qo.min,qo.max)&&!Ko(i,o,r))return!0;var i,o,r;return!1};const Qo=Wo;function Zo(t,e,n){this.viewport=new ae(0,0,0,0),this.scissor=new ae(0,0,0,0),this.points=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],this.normals=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],this.edges=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],this.planes=[new Go(qt.Zero,qt.Zero),new Go(qt.Zero,qt.Zero),new Go(qt.Zero,qt.Zero),new Go(qt.Zero,qt.Zero),new Go(qt.Zero,qt.Zero),new Go(qt.Zero,qt.Zero)],arguments.length&&this.set(t,e,n)}Zo.prototype={constructor:Zo,set:function(){const t=new Ne;return function(e,n,i){this.viewport.assign(n),this.scissor.assign(i);const o=this.points,r=o[0],s=o[1],a=o[2],u=o[3],c=o[4],l=o[5],h=o[6],d=o[7],f=i[0],p=f+i[2],g=i[1],m=g+i[3];t.assign(e).inverse(),Zo.unProjectPointMatrix(f,g,0,t,n,r),Zo.unProjectPointMatrix(p,g,0,t,n,s),Zo.unProjectPointMatrix(p,m,0,t,n,a),Zo.unProjectPointMatrix(f,m,0,t,n,u),Zo.unProjectPointMatrix(f,g,1,t,n,c),Zo.unProjectPointMatrix(p,g,1,t,n,l),Zo.unProjectPointMatrix(p,m,1,t,n,h),Zo.unProjectPointMatrix(f,m,1,t,n,d);const _=this.normals;Ho.normal(r,s,a,_[0]),Ho.normal(d,c,r,_[1]),Ho.normal(h,a,s,_[2]),Ho.normal(a,h,d,_[3]),Ho.normal(s,r,c,_[4]),Ho.normal(c,d,h,_[5]);const x=this.planes;return x[0].set(s,_[0]),x[1].set(c,_[1]),x[2].set(a,_[2]),x[3].set(h,_[3]),x[4].set(r,_[4]),x[5].set(d,_[5]),this.edges.tainted=!0,this}}(),getViewport:function(){return this.viewport},getScissor:function(){return this.scissor},getEdges:function(){const t=this.edges;if(t.tainted){const e=this.points;t[0].assign(e[0]).subtract(e[1]),t[1].assign(e[1]).subtract(e[2]),t[2].assign(e[2]).subtract(e[3]),t[3].assign(e[3]).subtract(e[0]),t[4].assign(e[0]).subtract(e[4]),t[5].assign(e[1]).subtract(e[5]),t[6].assign(e[2]).subtract(e[6]),t[7].assign(e[3]).subtract(e[7]),t.tainted=!1}return t},intersectsSphere:function(t,e){const n=this.planes;return!(n[0].getDistanceToPoint(e)>t)&&(!(n[1].getDistanceToPoint(e)>t)&&(!(n[2].getDistanceToPoint(e)>t)&&(!(n[3].getDistanceToPoint(e)>t)&&(!(n[4].getDistanceToPoint(e)>t)&&!(n[5].getDistanceToPoint(e)>t)))))},intersectsBox:function(){const t=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],e=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],n=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],i=[];for(let t=0;t<24;++t)i.push(new qt(0,0,0));return function(o){o.getPoints(t);const r=this.points;if(Qo.isSeparated(o.getNormals(e),t,r))return!1;if(Qo.isSeparated(this.normals,t,r))return!1;o.getAxes(n);const s=this.getEdges();for(let t=0;t<3;++t)for(let e=0;e<8;++e)i[3*t+e].assign(n[t]).cross(s[e]);return!Qo.isSeparated(i,t,r)}}()},Object.assign(Zo,{unProjectPoint:function(){const t=new Ne;return function(e,n,i,o,r,s,a){return this.unProjectPointMatrix(e,n,i,t.assign(o).multRight(r).inverse(),s,a)}}(),unProjectPointMatrix:function(){const t=new ae(0,0,0,0);return function(e,n,i,o,r,s){t.set((e-r[0])/r[2]*2-1,(n-r[1])/r[3]*2-1,2*i-1,1),o.multVecMatrix(t);const a=1/t.w;return s.set(t.x*a,t.y*a,t.z*a,1)}}(),unProjectRay:function(){const t=new Ne;return function(e,n,i,o,r,s){return this.unProjectRayMatrix(e,n,t.assign(i).multRight(o).inverse(),r,s)}}(),unProjectRayMatrix:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i,o,r,s){return Zo.unProjectPointMatrix(n,i,0,o,r,t),Zo.unProjectPointMatrix(n,i,.9,o,r,e),s.setPoints(t,e)}}(),projectPoint:function(){const t=new ae(0,0,0,0);return function(e,n,i,o,r){4===e.length?t.assign(e):t.set(e.x,e.y,e.z,1),i.multVecMatrix(n.multVecMatrix(t));const s=1/(2*t.w);return r.set((t.x*s+.5)*o[2]+o[0],(t.y*s+.5)*o[3]+o[1],t.z*s+.5)}}(),projectPointMatrix:function(){const t=new ae(0,0,0,0);return function(e,n,i,o){4===e.length?t.assign(e):t.set(e.x,e.y,e.z,1),n.multVecMatrix(t);const r=1/(2*t.w);return o.set((t.x*r+.5)*i[2]+i[0],(t.y*r+.5)*i[3]+i[1],t.z*r+.5)}}(),projectLine:function(){const t=new Ne;return function(e,n,i,o,r){return this.projectLineMatrix(e,t.assign(n).multRight(i),o,r)}}(),projectLineMatrix:function(){const t=new jt(0,0),e=new jt(0,0),n=new qt(0,0,0);return function(i,o,r,s){return Zo.projectPointMatrix(i.point,o,r,t),Zo.projectPointMatrix(n.assign(i.direction).multiply(1e9).add(i.point),o,r,e),s.setPoints(t,e)}}()});const Jo=Zo;function tr(t,e,n){const i=t.getContext();if(this.browser=t,this.width=e,this.height=n,this.array=new Uint8Array(e*n*4),this.lastBuffer=i.getParameter(i.FRAMEBUFFER_BINDING),this.buffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this.buffer),this.colorTexture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.colorTexture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.colorTexture,0),i.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.depthTexture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST);const t=i.getVersion()>=2?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT;i.texImage2D(i.TEXTURE_2D,0,t,e,n,0,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,n),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this.depthBuffer);const o=i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE;if(i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,this.lastBuffer),!o)throw new Error("Couldn't create frame buffer.")}tr.prototype={constructor:tr,getWidth:function(){return this.width},getHeight:function(){return this.height},getColorTexture:function(){return this.colorTexture},getDepthTexture:function(){return this.depthTexture},readPixels:function(){const t=this.browser.getContext(),e=this.array,n=this.width,i=this.height;return t.readPixels(0,0,n,i,t.RGBA,t.UNSIGNED_BYTE,e),e},getDepth:function(){const t=new Ne,e=new qt(0,0,0);return function(n,i){const o=this.browser.getContext(),r=this.array,s=this.width,a=this.height;let u=0,c=0,l=Number.POSITIVE_INFINITY;t.assign(n).inverse(),o.readPixels(0,0,s,a,o.RGBA,o.UNSIGNED_BYTE,r);for(let t=0,e=0;t<a;++t)for(let n=0;n<s;++n,e+=4){const i=r[e]/255+r[e+1]/65025+r[e+2]/16581375+r[e+3]/4228250625;i<l&&(u=n,c=t,l=i)}return Jo.unProjectPointMatrix(u,c,l,t,i,e),e.z}}(),bind:function(){const t=this.browser.getContext();this.lastBuffer=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this.buffer)},unbind:function(){const t=this.browser.getContext();t.bindFramebuffer(t.FRAMEBUFFER,this.lastBuffer)},delete:function(){const t=this.browser.getContext();t.deleteFramebuffer(this.buffer),t.deleteTexture(this.colorTexture),t.HAS_FEATURE_DEPTH_TEXTURE?t.deleteTexture(this.depthTexture):t.deleteRenderbuffer(this.depthBuffer)}};for(const t of Reflect.ownKeys(tr.prototype))Object.defineProperty(tr.prototype,t,{enumerable:!1});const er=tr;let nr=0;const ir={POINTER:nr++,CAMERA:nr++,PICKING:nr++,COLLISION:nr++,SHADOW:nr++,DISPLAY:nr++};function or(t,e){this.array=t,this.auxiliary=[],e&&(this.compare=e)}or.prototype={compare:function(t,e){return t<e},sort:function(t,e){this.mergeSort(t,e-1)},mergeSort:function(t,e){if(t<e){const n=t+e>>>1;this.mergeSort(t,n),this.mergeSort(n+1,e),this.merge(t,n,e)}},merge:function(t,e,n){let i,o,r;for(i=0,o=t;o<=e;)this.auxiliary[i++]=this.array[o++];for(i=0,r=t;r<o&&o<=n;)this.compare(this.array[o],this.auxiliary[i])?this.array[r++]=this.array[o++]:this.array[r++]=this.auxiliary[i++];for(;r<o;)this.array[r++]=this.auxiliary[i++]}};const rr=or,sr={frustum:function(t,e,n,i,o,r,s){const a=e-t,u=i-n,c=r-o,l=2*o,h=(e+t)/a,d=(i+n)/u,f=-(r+o)/c,p=-l*r/c,g=l/a,m=l/u;return s.set(g,0,0,0,0,m,0,0,h,d,f,-1,0,0,p,0)},perspective:function(t,e,n,i,o,r){const s=Math.tan(t/2)*e;if(i>o){const t=i*s/o;return this.frustum(-t,t,-s,s,e,n,r)}{const t=o*s/i;return this.frustum(-s,s,-t,t,e,n,r)}},perspective2:function(t,e,n,i,o,r){const s=Math.tan(t/2)*e;return this.frustum(-s,s,-s,s,e,n,r)},ortho:function(t,e,n,i,o,r,s){const a=e-t,u=i-n,c=r-o,l=2/a,h=2/u,d=-2/c,f=-(e+t)/a,p=-(i+n)/u,g=-(r+o)/c;return s.set(l,0,0,0,0,h,0,0,0,0,d,0,f,p,g,1)},orthoBox:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i){return n.getExtents(t,e),this.ortho(t.x,e.x,t.y,e.y,-e.z,-t.z,i)}}()};function ar(t,e){switch(arguments.length){case 0:return void(this.matrix=new Ne(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0));case 2:return void(this.matrix=new Ne(t.x/2,0,0,0,0,t.y/2,0,0,0,0,t.z/2,0,e.x,e.y,e.z,1));case 3:{const t=arguments[0],e=arguments[1],n=(e.x-t.x)/2,i=(e.y-t.y)/2,o=(e.z-t.z)/2,r=(e.x+t.x)/2,s=(e.y+t.y)/2,a=(e.z+t.z)/2;return void(this.matrix=new Ne(n,0,0,0,0,i,0,0,0,0,o,0,r,s,a,1))}}}ar.prototype={constructor:ar,copy:function(){const t=Object.create(ar.prototype);return t.matrix=this.matrix.copy(),t},assign:function(t){return this.matrix.assign(t.matrix),this},equals:function(t){return this.matrix.equals(t.matrix)},getMatrix:function(){return this.matrix},set:function(t,e){const n=this.matrix;switch(arguments.length){case 0:return n[0]=.5,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=.5,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=.5,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=0,this;case 2:return n[0]=t.x/2,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t.y/2,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t.z/2,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this;case 3:{const t=arguments[0],e=arguments[1],n=(e.x-t.x)/2,i=(e.y-t.y)/2,o=(e.z-t.z)/2,r=(e.x+t.x)/2,s=(e.y+t.y)/2,a=(e.z+t.z)/2;return this.matrix.set(n,0,0,0,0,i,0,0,0,0,o,0,r,s,a,1),this}}},setExtents:function(t,e){const n=this.matrix,i=(e.x-t.x)/2,o=(e.y-t.y)/2,r=(e.z-t.z)/2,s=(e.x+t.x)/2,a=(e.y+t.y)/2,u=(e.z+t.z)/2;return n[0]=i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r,n[11]=0,n[12]=s,n[13]=a,n[14]=u,n[15]=1,this},getExtents:function(t,e){this.getAbsoluteExtents(t,e),t.add(this.center),e.add(this.center)},getAbsoluteExtents:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0);return function(i,o){const r=this.matrix,s=r.xAxis,a=r.yAxis,u=r.zAxis;t.assign(a).add(u);const c=u.subtract(a);e.assign(s).add(t),n.assign(s).add(c);const l=t.subtract(s),h=c.subtract(s);i.assign(e),o.assign(e),i.min(l,h,n),o.max(l,h,n),e.negate(),l.negate(),h.negate(),n.negate(),i.min(e,l,h,n),o.max(e,l,h,n)}}(),getPoints:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0);return function(o){const r=this.matrix;t.assign(r.xAxis),e.assign(r.yAxis),n.assign(r.zAxis),i.assign(e).add(n);const s=n.subtract(e);o[0].assign(t).add(i),o[1].assign(i).subtract(t),o[2].assign(s).subtract(t),o[3].assign(t).add(s),o[4].assign(o[2]).negate(),o[5].assign(o[3]).negate(),o[6].assign(o[0]).negate(),o[7].assign(o[1]).negate();const a=this.center;return o[0].add(a),o[1].add(a),o[2].add(a),o[3].add(a),o[4].add(a),o[5].add(a),o[6].add(a),o[7].add(a),o}}(),getAxes:function(t){const e=this.matrix;return t[0].assign(e.xAxis),t[1].assign(e.yAxis),t[2].assign(e.zAxis),t},getNormals:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=[qt.xAxis,qt.yAxis,qt.zAxis];return function(o){const r=this.matrix;if(t.assign(r.xAxis),e.assign(r.yAxis),n.assign(r.zAxis),0===t.norm()&&(t.assign(e).cross(n),0===t.norm())){for(const n of i)if(t.assign(n).cross(e),0!==t.norm())break;if(0===t.norm()){for(const e of i)if(t.assign(e).cross(n),0!==t.norm())break;0===t.norm()&&t.assign(qt.xAxis)}}if(0===e.norm()&&(e.assign(n).cross(t),0===e.norm())){for(const t of i)if(e.assign(t).cross(n),0!==e.norm())break;if(0===e.norm()){for(const n of i)if(e.assign(n).cross(t),0!==e.norm())break;0===e.norm()&&e.assign(qt.yAxis)}}if(0===n.norm()&&(n.assign(t).cross(e),0===n.norm())){for(const e of i)if(n.assign(e).cross(t),0!==n.norm())break;if(0===n.norm()){for(const t of i)if(n.assign(t).cross(e),0!==n.norm())break;0===n.norm()&&n.assign(qt.zAxis)}}return o[0].assign(e).cross(n).normalize(),o[1].assign(n).cross(t).normalize(),o[2].assign(t).cross(e).normalize(),o}}(),isEmpty:function(){return 0===this.matrix[15]},add:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0);return function(o){return this.isEmpty()?this.assign(o):o.isEmpty()?this:(this.getExtents(t,e),o.getExtents(n,i),this.set(t.min(n),e.max(i),!0))}}(),multLeft:function(t){return this.matrix.multLeft(t),this},multRight:function(t){return this.matrix.multRight(t),this},containsPoint:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n){return this.getExtents(t,e),t.x<=n.x&&e.x>=n.x&&t.y<=n.y&&e.y>=n.y&&t.z<=n.z&&e.z>=n.z}}(),intersectsBox:function(){const t=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],e=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],n=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],i=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],o=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],r=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)];return function(s){if(this.isEmpty())return!1;if(s.isEmpty())return!1;if(this.getPoints(t),s.getPoints(e),Qo.isSeparated(this.getNormals(r),t,e))return!1;if(Qo.isSeparated(s.getNormals(r),t,e))return!1;this.getAxes(n),s.getAxes(i);for(let t=0;t<3;++t)for(let e=0;e<3;++e)o[3*t+e].assign(n[t]).cross(i[e]);return!Qo.isSeparated(o,t,e)}}(),intersectsTriangle:function(){const t=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],e=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],n=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],i=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)],o=[],r=[new qt(0,0,0)],s=[new qt(0,0,0),new qt(0,0,0),new qt(0,0,0)];return function(a,u,c){if(this.isEmpty())return!1;if(this.getPoints(t),o[0]=a,o[1]=u,o[2]=c,Qo.isSeparated(this.getNormals(i),t,o))return!1;if(Ho.normal(a,u,c,r[0]),Qo.isSeparated(r,t,o))return!1;this.getAxes(e),s[0].assign(a).subtract(u),s[1].assign(u).subtract(c),s[2].assign(c).subtract(a);for(let t=0;t<3;++t)for(let i=0;i<3;++i)n[3*t+i].assign(e[t]).cross(s[i]);return!Qo.isSeparated(n,t,o)}}(),toString:function(){return this.size+", "+this.center}},Object.defineProperty(ar.prototype,"size",{get:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(){return this.getAbsoluteExtents(t,e),e.subtract(t)}}(),enumerable:!0,configurable:!1}),Object.defineProperty(ar.prototype,"center",{get:function(){return this.matrix.origin},enumerable:!0,configurable:!1});const ur=ar;const cr=function(t){return Object.assign([new t],{top:0,set:function(t){this[this.top].assign(t)},get:function(){return this[this.top]},push:function(){const t=++this.top;t<this.length?this[t].assign(this[t-1]):this[t]=this[t-1].copy()},pushMatrix:function(t){const e=++this.top;e<this.length?this[e].assign(t):this[e]=t.copy()},pop:function(){--this.top},clear:function(){this.top=0},size:function(){return this.top+1},identity:function(){this[this.top].identity()},multLeft:function(t){this[this.top].multLeft(t)},translate:function(t){this[this.top].translate(t)},rotate:function(t){this[this.top].rotate(t)},scale:function(t){this[this.top].scale(t)}})};function lr(t,e){return t.distance<e.distance}function hr(t){this.viewVolumes=[],this.cameraSpaceMatrix=new cr(Ne),this.viewMatrix=new cr(Ne),this.projectionMatrix=new cr(Ne),this.modelViewMatrix=new cr(Ne),this.viewportArray=new Int32Array(4),this.projectionMatrixArray=new Float32Array(16),this.cameraSpaceMatrixArray=new Float32Array(16),this.localObjectsCount=[0,0,0],this.globalObjects=[],this.localObjects=[],this.lights=[],this.globalShadows=[!1],this.localShadows=[!1],this.localFogs=[null],this.layouts=[],this.textureProjectors=[],this.generatedCubeMapTextures=[],this.collisions=[],this.numOpaqueShapes=0,this.numTransparentShapes=0,this.numCollisionShapes=0,this.numShadowShapes=0,this.opaqueShapes=[],this.transparentShapes=[],this.transparencySorter=new rr(this.transparentShapes,lr),this.collisionShapes=[],this.activeCollisions=new Set,this.shadowShapes=[],this.speed=0;try{this.depthBuffer=new er(t.getBrowser(),16,16)}catch(t){console.error(t),this.getDepth=function(){return 0}}}function dr(t,e){for(var n=0,i=e.length;n<i;++n)t[n]=e[n];t.length=i}hr.prototype={constructor:hr,initialize:function(){},isIndependent:function(){return!0},getRenderTime:function(){return this.renderTime},getViewVolumes:function(){return this.viewVolumes},getViewVolume:function(){return this.viewVolumes.at(-1)},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getViewMatrix:function(){return this.viewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getModelViewMatrix:function(){return this.modelViewMatrix},getViewportArray:function(){return this.viewportArray},getProjectionMatrixArray:function(){return this.projectionMatrixArray},getCameraSpaceMatrixArray:function(){return this.cameraSpaceMatrixArray},getGlobalObjects:function(){return this.globalObjects},getLocalObjects:function(){return this.localObjects},getLocalObjectsCount:function(){return this.localObjectsCount},getLights:function(){return this.lights},pushGlobalShadows:function(t){this.globalShadows.push(t||this.globalShadows.at(-1))},pushLocalShadows:function(t){this.localShadows.push(t||this.localShadows.at(-1))},popLocalShadows:function(){this.localShadows.pop()},setGlobalFog:function(){const t=new Ne;return function(e){if(e.getFogType()){const n=this.localFogs[0]||e.getFogs().pop();t.assign(e.getModelMatrix()).multRight(this.getViewMatrix().get()),n.set(e,t),this.localFogs[0]=n}else this.localFogs[0]=null}}(),getLocalFogs:function(){return this.localFogs},getLayouts:function(){return this.layouts},getParentLayout:function(){return this.layouts.at(-1)},getTextureProjectors:function(){return this.textureProjectors},getGeneratedCubeMapTextures:function(){return this.generatedCubeMapTextures},getCollisions:function(){return this.collisions},setNumCollisionShapes:function(t){this.numCollisionShapes=t},getNumCollisionShapes:function(){return this.numCollisionShapes},getCollisionShapes:function(){return this.collisionShapes},setNumShadowShapes:function(t){this.numShadowShapes=t},getNumShadowShapes:function(){return this.numShadowShapes},getShadowShapes:function(){return this.shadowShapes},setNumOpaqueShapes:function(t){this.numOpaqueShapes=t},getNumOpaqueShapes:function(){return this.numOpaqueShapes},getOpaqueShapes:function(){return this.opaqueShapes},setNumTransparentShapes:function(t){this.numTransparentShapes=t},getNumTransparentShapes:function(){return this.numTransparentShapes},getTransparentShapes:function(){return this.transparentShapes},constrainTranslation:function(t,e){const n=this.getDistance(t)-this.getNavigationInfo().getCollisionRadius();if(n>0){return t.magnitude()>n?t.normalize().multiply(n):t}return e?this.constrainTranslation(t.normalize().multiply(n),!1):t.assign(qt.Zero)},getDistance:function(){const t=new Ne,e=new Ne,n=new Ce(0,0,1,0),i=new qt(0,0,0),o=new Ce(0,0,1,0);return function(r){const s=performance.now(),a=this.getViewpoint(),u=this.getNavigationInfo(),c=u.getCollisionRadius(),l=u.getStepHeight()-u.getAvatarHeight(),h=u.getNearValue(),d=u.getAvatarHeight();sr.ortho(-c,c,Math.min(l,-c),c,h,Math.max(2*c,2*d),t),n.assign(a._orientation.getValue()).inverse().multRight(a.getOrientation()),o.setFromToVec(qt.zAxis,i.assign(r).negate()).multRight(n),a.straightenHorizon(o),e.assign(a.getModelMatrix()),e.translate(a.getUserPosition()),e.rotate(o),e.inverse(),e.multRight(t),e.multLeft(a.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(e);const f=this.getDepth(t);return this.getProjectionMatrix().pop(),this.collisionTime+=performance.now()-s,-f}}(),getDepth:function(){const t=new ae(0,0,16,16),e=new Jo;return e.set(Ne.Identity,t,t),function(n){this.depthBuffer.bind(),this.viewVolumes.push(e),this.depth(this.collisionShapes,this.numCollisionShapes);const i=this.depthBuffer.getDepth(n,t);return this.viewVolumes.pop(),this.depthBuffer.unbind(),i}}(),render:function(t,e,n){switch(t){case ir.COLLISION:this.numCollisionShapes=0,e.call(n,t,this),this.collide(),this.gravite();break;case ir.SHADOW:this.numShadowShapes=0,e.call(n,t,this),this.depth(this.shadowShapes,this.numShadowShapes);break;case ir.DISPLAY:this.lightIndex=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.setGlobalFog(this.getFog()),e.call(n,t,this),this.draw()}},addCollisionShape:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){const t=this.numCollisionShapes++;t===this.collisionShapes.length&&this.collisionShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),collisions:[],clipPlanes:[]});const e=this.collisionShapes[t];return e.modelViewMatrix.set(i),e.shapeNode=n,e.scissor=r.getScissor(),dr(e.collisions,this.collisions),dr(e.clipPlanes,this.localObjects),!0}return!1}}(),addShadowShape:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){const t=this.numShadowShapes++;t===this.shadowShapes.length&&this.shadowShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[]});const e=this.shadowShapes[t];return e.modelViewMatrix.set(i),e.shapeNode=n,e.scissor=r.getScissor(),dr(e.clipPlanes,this.localObjects),!0}return!1}}(),addDisplayShape:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){if(n.getTransparent()){const t=this.numTransparentShapes++;t===this.transparentShapes.length&&this.transparentShapes.push(this.createRenderContext(!0));var s=this.transparentShapes[t]}else{const t=this.numOpaqueShapes++;t===this.opaqueShapes.length&&this.opaqueShapes.push(this.createRenderContext(!1));s=this.opaqueShapes[t]}return s.modelViewMatrix.set(i),s.scissor.assign(r.getScissor()),s.shadows=this.localShadows.at(-1),s.fogNode=this.localFogs.at(-1),s.shapeNode=n,s.appearanceNode=n.getAppearance(),s.distance=e.z,dr(s.objectsCount,this.localObjectsCount),dr(s.localObjects,this.localObjects),!0}return!1}}(),createRenderContext:function(t){return{renderObject:this,transparent:t,modelViewMatrix:new Float32Array(16),scissor:new ae(0,0,0,0),localObjects:[],objectsCount:[0,0,0]}},collide:function(){const t=new Ne,e=new Ne,n=new ur(qt.Zero,qt.Zero),i=new qt(0,0,0);return function(){const o=new Set,r=2.2*this.getNavigationInfo().getCollisionRadius();i.set(r,r,r);for(let r=0,s=this.numCollisionShapes;r<s;++r){const s=this.collisionShapes[r],a=s.collisions;if(a.length&&(n.set(i,qt.Zero),n.multRight(t.assign(s.modelViewMatrix).inverse()),s.shapeNode.intersectsBox(n,s.clipPlanes,e.assign(s.modelViewMatrix))))for(const t of a)o.add(t)}if(this.activeCollisions.size){const t=o.size?et.set_difference(this.activeCollisions,o,new Set):this.activeCollisions;for(const e of t)e.set_active(!1)}this.activeCollisions=o;for(const t of o)t.set_active(!0)}}(),gravite:function(){const t=new Ne,e=new Ne,n=new qt(0,0,0),i=new Ce(0,0,1,0);return function(){const o=this.getBrowser();if(o.getActiveLayer()===this){if("WALK"!==o.getCurrentViewer())return}else if("WALK"!==this.getNavigationInfo().getViewer())return;const r=this.getNavigationInfo(),s=this.getViewpoint(),a=r.getCollisionRadius(),u=r.getNearValue(),c=r.getAvatarHeight(),l=r.getStepHeight();sr.ortho(-a,a,-a,a,u,Math.max(2*a,2*c),t);const h=s.getUpVector(),d=i.setFromToVec(qt.zAxis,h);e.assign(s.getModelMatrix()),e.translate(s.getUserPosition()),e.rotate(d),e.inverse(),e.multRight(t),e.multLeft(s.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(e);let f=-this.getDepth(t);this.getProjectionMatrix().pop(),f-=c;const p=i.setFromToVec(qt.yAxis,h);if(f>0){const t=this.speed?o.getCurrentFrameRate():1e6;this.speed-=o.getBrowserOptions()._Gravity.getValue()/t;let e=this.speed/t;e<-f&&(e=-f,this.speed=0),s._positionOffset=s._positionOffset.getValue().add(p.multVecRot(n.set(0,e,0)))}else this.speed=0,f=-f,f>.01&&f<l&&(this.constrainTranslation(p.multVecRot(n.set(0,f,0)),!1),s._positionOffset=n.add(s._positionOffset.getValue()))}}(),depth:function(){const t=new Float32Array(16);return function(e,n){const i=this.getBrowser().getContext(),o=this.getViewVolume().getViewport();t.set(this.getProjectionMatrix().get()),i.viewport(o[0],o[1],o[2],o[3]),i.scissor(o[0],o[1],o[2],o[3]),i.clearColor(1,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.depthMask(!0),i.enable(i.DEPTH_TEST),i.disable(i.BLEND),i.disable(i.CULL_FACE);for(let o=0;o<n;++o){const n=e[o],r=n.scissor;i.scissor(r.x,r.y,r.z,r.w),n.shapeNode.depth(i,n,t)}}}(),draw:function(){const t=this.getBrowser(),e=t.getContext(),n=this.getViewVolume().getViewport(),i=this.lights,o=this.textureProjectors,r=this.generatedCubeMapTextures,s=this.globalShadows,a=s.at(-1),u=this.getNavigationInfo()._headlight.getValue(),c=i.reduce(((t,e)=>t+e.lightNode.getGlobal()),+u),l=o.reduce(((t,e)=>t+e.textureProjectorNode.getGlobal()),0);if(this.renderTime=performance.now(),this.isIndependent()){for(const t of i)t.renderShadowMap(this);for(const t of r)t.renderTexture(this)}u&&t.getHeadlight().setGlobalVariables(this);for(const t of i)t.setGlobalVariables(this);for(const t of o)t.setGlobalVariables(this);this.viewportArray.set(n),this.cameraSpaceMatrixArray.set(this.getCameraSpaceMatrix().get()),this.projectionMatrixArray.set(this.getProjectionMatrix().get()),e.viewport(n.x,n.y,n.z,n.w),e.scissor(n.x,n.y,n.z,n.w),e.clear(e.DEPTH_BUFFER_BIT),this.getBackground().display(e,this,n),e.depthMask(!0),e.enable(e.DEPTH_TEST),e.disable(e.BLEND);const h=this.opaqueShapes;for(let n=0,i=this.numOpaqueShapes;n<i;++n){const i=h[n],o=i.scissor;e.scissor(o.x,o.y,o.z,o.w),i.shadows=i.shadows||a,i.objectsCount[1]+=c,i.objectsCount[2]+=l,i.shapeNode.display(e,i),t.resetTextureUnits()}e.depthMask(!1),e.enable(e.BLEND);const d=this.transparentShapes;this.transparencySorter.sort(0,this.numTransparentShapes);for(let n=0,i=this.numTransparentShapes;n<i;++n){const i=d[n],o=i.scissor;e.scissor(o.x,o.y,o.z,o.w),i.shadows=i.shadows||a,i.objectsCount[1]+=c,i.objectsCount[2]+=l,i.shapeNode.display(e,i),t.resetTextureUnits()}e.depthMask(!0),e.disable(e.BLEND);const f=this.globalObjects;if(this.isIndependent()){const e=t.getLocalObjects();for(const t of e)t.dispose();e.length=0;for(const t of f)t.dispose()}f.length=0,i.length=0,s.length=1,o.length=0,r.length=0}};const fr=hr;function pr(t){this.getExecutionContext()||(ji.call(this,t),this.addType(o.X3DChildNode),this.addChildObjects("isCameraObject",new Bn.SFBool),this.addChildObjects("isPickableObject",new Bn.SFBool),this._isCameraObject.setAccessType(o.outputOnly),this._isPickableObject.setAccessType(o.outputOnly))}pr.prototype=Object.assign(Object.create(ji.prototype),{constructor:pr,setCameraObject:function(t){t!==this._isCameraObject.getValue()&&(this._isCameraObject=t)},getCameraObject:function(){return this._isCameraObject.getValue()},setPickableObject:function(t){t!==this._isPickableObject.getValue()&&(this._isPickableObject=t)},getPickableObject:function(){return this._isPickableObject.getValue()}});const gr=pr;function mr(t,e,n=!0){try{if(e&&(e instanceof Bn.SFNode&&(e=e.getValue()),e&&(n&&(e=e.getInnerNode()),e.getType().includes(t))))return e}catch(t){}return null}function _r(t){this.addType(o.X3DBoundedObject),this.addChildObjects("transformSensors_changed",new Bn.SFTime),this._bboxSize.setUnit("length"),this._bboxCenter.setUnit("length"),this.childBBox=new ur,this.transformSensorNodes=new Set}_r.prototype={constructor:_r,initialize:function(){},getDefaultBBoxSize:function(){const t=new qt(-1,-1,-1);return function(){return t}}(),getBBox:function(t,e,n){const i=this.childBBox;e.set();for(var o=0,r=t.length;o<r;++o){const r=t[o];r.getBBox&&e.add(r.getBBox(i,n))}return e},displayBBox:function(){const t=new ur,e=new Ne;return function(n,i){const o=i.getModelViewMatrix();this.getBBox(t),e.set(t.center,null,t.size),o.push(),o.multLeft(e),this.getBrowser().getBBoxNode().traverse(n,i),o.pop()}}(),addTransformSensor:function(t){this.transformSensorNodes.add(t),this._transformSensors_changed=this.getBrowser().getCurrentTime()},removeTransformSensor:function(t){this.transformSensorNodes.delete(t),this._transformSensors_changed=this.getBrowser().getCurrentTime()},getTransformSensors:function(){return this.transformSensorNodes},dispose:function(){}};const xr=_r;function yr(t){gr.call(this,t),xr.call(this,t),this.addType(o.X3DGroupingNode),this.hidden=!1,this.allowedTypes=new Set,this.clipPlaneNodes=[],this.localFogNodes=[],this.lightNodes=[],this.textureProjectorNodes=[],this.pointingDeviceSensorNodes=[],this.maybeCameraObjects=[],this.cameraObjects=[],this.maybePickableSensorNodes=[],this.pickableSensorNodes=[],this.pickableObjects=[],this.childNodes=[],this.displayNodes=[],this.visibleNodes=[],this.boundedObjects=[],this.sensors=new Map}function wr(t,e,n,i,o,r){const s=new Set;for(let t=o;t<r;++t)s.add(i[t]);return t.remove(e,n,(function(t){return s.has(t)}))}yr.prototype=Object.assign(Object.create(gr.prototype),xr.prototype,{constructor:yr,initialize:function(){gr.prototype.initialize.call(this),xr.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this._addChildren.addInterest("set_addChildren__",this),this._removeChildren.addInterest("set_removeChildren__",this),this._children.addInterest("set_children__",this),this.set_children__()},getBBox:function(t,e){return this.getSubBBox(t,e)},getSubBBox:function(t,e){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?xr.prototype.getBBox.call(this,this.visibleNodes,t,e):t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},setHidden:function(t){t!==this.hidden&&(this.hidden=t,this.set_children__())},setAllowedTypes:function(){const t=this.allowedTypes;t.clear();for(const e of arguments)t.add(e)},set_addChildren__:function(){0!==this._addChildren.length&&(this._addChildren.setTainted(!0),this._addChildren.erase(wr(this._addChildren,0,this._addChildren.length,this._children,0,this._children.length),this._addChildren.length),this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.insert(this._children.length,this._addChildren,0,this._addChildren.length),this.add(this._addChildren),this._addChildren.length=0,this._addChildren.setTainted(!1))},set_removeChildren__:function(){0!==this._removeChildren.length&&(this._removeChildren.setTainted(!0),this._children.length>0&&(this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.erase(wr(this._children,0,this._children.length,this._removeChildren,0,this._removeChildren.length),this._children.length),this.remove(this._removeChildren)),this._removeChildren.length=0,this._removeChildren.setTainted(!1))},set_children__:function(){this.clear(),this.add(this._children)},connectChildren:function(){this._children.removeInterest("connectChildren",this),this._children.addInterest("set_children__",this)},clear:function(){for(const t of this.maybePickableSensorNodes)t._isPickableObject.removeInterest("set_pickableObjects__",this);for(const t of this.childNodes)t._isCameraObject.removeInterest("set_cameraObjects__",this),t._isPickableObject.removeInterest("set_pickableObjects__",this),mr(o.X3DBoundedObject,t)&&(t._visible.removeInterest("set_visibles__",this),t._bboxDisplay.removeInterest("set_bboxDisplays__",this));this.clipPlaneNodes.length=0,this.localFogNodes.length=0,this.lightNodes.length=0,this.textureProjectorNodes.length=0,this.pointingDeviceSensorNodes.length=0,this.maybeCameraObjects.length=0,this.maybePickableSensorNodes.length=0,this.childNodes.length=0},add:function(t){if(!this.hidden){for(const e of t)if(e)try{const t=e.getValue().getInnerNode(),n=t.getType();for(let e=n.length-1;e>=0;--e){switch(n[e]){case o.X3DPointingDeviceSensorNode:this.pointingDeviceSensorNodes.push(t);break;case o.ClipPlane:this.clipPlaneNodes.push(t);break;case o.LocalFog:this.localFogNodes.push(t);break;case o.X3DTextureProjectorNode:this.textureProjectorNodes.push(t);break;case o.X3DLightNode:this.lightNodes.push(t);break;case o.X3DBindableNode:this.maybeCameraObjects.push(t);break;case o.TransformSensor:case o.X3DPickSensorNode:t._isPickableObject.addInterest("set_pickableObjects__",this),this.maybePickableSensorNodes.push(t);break;case o.X3DBackgroundNode:case o.X3DChildNode:t._isCameraObject.addInterest("set_cameraObjects__",this),t._isPickableObject.addInterest("set_pickableObjects__",this),mr(o.X3DBoundedObject,t)&&(t._visible.addInterest("set_visibles__",this),t._bboxDisplay.addInterest("set_bboxDisplays__",this)),this.maybeCameraObjects.push(t),this.childNodes.push(t);break;case o.BooleanFilter:case o.BooleanToggle:case o.NurbsOrientationInterpolator:case o.NurbsPositionInterpolator:case o.NurbsSurfaceInterpolator:case o.TimeSensor:case o.X3DFollowerNode:case o.X3DInfoNode:case o.X3DInterpolatorNode:case o.X3DKeyDeviceSensorNode:case o.X3DLayoutNode:case o.X3DScriptNode:case o.X3DSequencerNode:case o.X3DTriggerNode:break;default:continue}break}}catch(t){}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()}},remove:function(t){for(const n of t)if(n)try{const t=n.getValue().getInnerNode(),i=t.getType();for(let n=i.length-1;n>=0;--n){switch(i[n]){case o.X3DPointingDeviceSensorNode:{const e=this.pointingDeviceSensorNodes.indexOf(t);e>=0&&this.pointingDeviceSensorNodes.splice(e,1);break}case o.ClipPlane:{const e=this.clipPlaneNodes.indexOf(t);e>=0&&this.clipPlaneNodes.splice(e,1);break}case o.LocalFog:{const e=this.localFogNodes.indexOf(t);e>=0&&this.localFogNodes.splice(e,1);break}case o.X3DTextureProjectorNode:{const e=this.textureProjectorNodes.indexOf(t);e>=0&&this.textureProjectorNodes.splice(e,1);break}case o.X3DLightNode:{const e=this.lightNodes.indexOf(t);e>=0&&this.lightNodes.splice(e,1);break}case o.X3DBindableNode:{const e=this.maybeCameraObjects.indexOf(t);e>=0&&this.maybeCameraObjects.splice(e,1);break}case o.TransformSensor:case o.X3DPickSensorNode:{t._isPickableObject.removeInterest("set_pickableObjects__",this);const e=this.maybePickableSensorNodes.indexOf(t);e>=0&&this.maybePickableSensorNodes.splice(e,1);break}case o.X3DBackgroundNode:case o.X3DChildNode:var e;t._isCameraObject.removeInterest("set_cameraObjects__",this),t._isPickableObject.removeInterest("set_pickableObjects__",this),mr(o.X3DBoundedObject,t)&&(t._visible.removeInterest("set_visibles__",this),t._bboxDisplay.removeInterest("set_bboxDisplays__",this)),(e=this.maybeCameraObjects.indexOf(t))>=0&&this.maybeCameraObjects.splice(e,1),(e=this.childNodes.indexOf(t))>=0&&this.childNodes.splice(e,1);break;case o.BooleanFilter:case o.BooleanToggle:case o.NurbsOrientationInterpolator:case o.NurbsPositionInterpolator:case o.NurbsSurfaceInterpolator:case o.TimeSensor:case o.X3DFollowerNode:case o.X3DInfoNode:case o.X3DInterpolatorNode:case o.X3DKeyDeviceSensorNode:case o.X3DLayoutNode:case o.X3DScriptNode:case o.X3DSequencerNode:case o.X3DTriggerNode:break;default:continue}break}}catch(t){}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()},set_cameraObjects__:function(){const t=this.cameraObjects;t.length=0;for(const e of this.maybeCameraObjects)e.getCameraObject()&&(mr(o.X3DBoundedObject,e)?e._visible.getValue()&&t.push(e):t.push(e));this.setCameraObject(Boolean(t.length))},set_pickableObjects__:function(){const t=this.pickableSensorNodes,e=this.pickableObjects;t.length=0,e.length=0;for(const e of this.maybePickableSensorNodes)e.getPickableObject()&&t.push(e);for(const t of this.childNodes)t.getPickableObject()&&e.push(t);this.set_transformSensors__()},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.pickableSensorNodes.length||this.pickableObjects.length))},set_displayNodes__:function(){const t=this.displayNodes;t.length=0;for(const e of this.clipPlaneNodes)t.push(e);for(const e of this.localFogNodes)t.push(e);for(const e of this.lightNodes)t.push(e);for(const e of this.textureProjectorNodes)t.push(e)},set_visibles__:function(){const t=this.childNodes,e=this.visibleNodes;e.length=0;for(const n of t)mr(o.X3DBoundedObject,n)?n._visible.getValue()&&e.push(n):e.push(n);this.set_cameraObjects__()},set_bboxDisplays__:function(){const t=this.boundedObjects;t.length=0;for(const e of this.childNodes)mr(o.X3DBoundedObject,e)&&e._bboxDisplay.getValue()&&t.push(e)},traverse:function(t,e){switch(t){case ir.POINTER:{const n=this.pointingDeviceSensorNodes,i=this.clipPlaneNodes,o=this.sensors;if(o.clear(),n.length){for(const t of n)t.push(e,o);o.size&&this.getBrowser().getSensors().push(o)}for(const t of i)t.push(e);for(const n of this.childNodes)n.traverse(t,e);for(const t of i)t.pop(e);return void(o.size&&this.getBrowser().getSensors().pop())}case ir.CAMERA:for(const n of this.cameraObjects)n.traverse(t,e);return;case ir.PICKING:{if(this.getTransformSensors().size){const t=e.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}for(const n of this.pickableSensorNodes)n.traverse(t,e);const n=this.getBrowser(),i=n.getPickingHierarchy();if(i.push(this),n.getPickable().at(-1))for(const n of this.childNodes)n.traverse(t,e);else for(const n of this.pickableObjects)n.traverse(t,e);return void i.pop()}case ir.COLLISION:{const n=this.clipPlaneNodes;for(const t of n)t.push(e);for(const n of this.childNodes)n.traverse(t,e);for(const t of n)t.pop(e);return}case ir.SHADOW:{const n=this.clipPlaneNodes;for(const t of n)t.push(e);for(const n of this.visibleNodes)n.traverse(t,e);for(const t of n)t.push(e);return}case ir.DISPLAY:{const n=this.displayNodes;for(const t of n)t.push(e,this);for(const n of this.visibleNodes)n.traverse(t,e);for(const n of this.boundedObjects)n.displayBBox(t,e);for(const t of n)t.pop(e);return}}}});const Tr=yr;function Sr(t){Tr.call(this,t),this.addType(o.X3DViewportNode)}Sr.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Sr});const br=Sr;function vr(t,e){Zn.call(this,t),this.array=[e],this.transitionNode=e.create(t)}vr.prototype=Object.assign(Object.create(Zn.prototype),{constructor:vr,getTypeName:function(){return"BindableStack"},get:function(){return this.array},top:function(){return this.transitionNode._transitionActive.getValue()?this.transitionNode:this.array.at(-1)},pushOnTop:function(t){t!==this.array[0]&&(this.array.at(-1)._isBound=!1,this.array.push(t)),t._isBound=!0,t._bindTime=this.getBrowser().getCurrentTime(),this.addNodeEvent()},update:function(t,e,n){if(0===e.length&&0===n.length)return;const i=this.top(),o=this.array.at(-1);for(const t of e){const e=this.array.indexOf(t);e>0&&this.array.splice(e,1)}o!==this.array[0]&&n.some((t=>!t._set_bind.getValue()&&t===o))&&this.array.pop();for(const t of n)if(t._set_bind.getValue()){const e=this.array.indexOf(t);e>-1&&this.array.splice(e,1),this.array.push(t)}const r=this.array.at(-1);r!==o&&(o._set_bind=!1,o._isBound=!1,r._set_bind=!0,r._isBound=!0,r._bindTime=this.getBrowser().getCurrentTime(),this.transitionNode=r.create(this.getExecutionContext()),this.transitionNode.setup(),this.transitionNode.transitionStart(t,i,r),this.transitionNode._transitionActive.getValue()&&this.transitionNode._transitionActive.addInterest("set_transitionActive__",this),this.addNodeEvent())},set_transitionActive__:function(t){t.getValue()||(this.transitionNode._transitionActive.removeInterest("set_transitionActive__",this),this.addNodeEvent())}});for(const t of Reflect.ownKeys(vr.prototype))Object.defineProperty(vr.prototype,t,{enumerable:!1});const Er=vr;function Cr(t,e){Zn.call(this,t),this.collected=[e],this.array=[e],this.updateTime=0,this.removedNodes=[]}Cr.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Cr,getTypeName:function(){return"BindableList"},get:function(){return this.array},getBound:function(t){if(this.array.length>1){const e=!1,n=this.getMainScene();if(t&&t.length)for(let i=1,o=this.array.length;i<o;++i){const o=this.array[i],r=o.getExecutionContext().getOuterNode(),s=r instanceof so?r.getScene():o.getScene();if((e||s===n)&&o.getName()==t)return o}for(let t=1,i=this.array.length;t<i;++t){const i=this.array[t],o=i.getExecutionContext().getOuterNode(),r=o instanceof so?o.getScene():i.getScene();if((e||r===n)&&i._isBound.getValue())return i}for(let t=1,i=this.array.length;t<i;++t){const i=this.array[t],o=i.getExecutionContext().getOuterNode(),r=o instanceof so?o.getScene():i.getScene();if(e||r===n)return i}}return this.array[0]},push:function(t){return this.collected.push(t)},update:function(t,e){const n=this.collected.filter((t=>t._set_bind.getModificationTime()>this.updateTime)),i=this.removedNodes;if(!function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this.collected,this.array)){for(const t of this.array)-1===this.collected.indexOf(t)&&i.push(t);const t=this.array;this.array=this.collected,this.collected=t}this.collected.length=1,e.update(t,i,n),i.length=0,this.updateTime=performance.now()}});for(const t of Reflect.ownKeys(Cr.prototype))Object.defineProperty(Cr.prototype,t,{enumerable:!1});const Or=Cr;function Fr(t){gr.call(this,t),this.addType(o.X3DBindableNode),this.addChildObjects("transitionActive",new Bn.SFBool)}Fr.prototype=Object.assign(Object.create(gr.prototype),{constructor:Fr,getCameraObject:function(){return!0},transitionStart:function(){}});const Nr=Fr,Mr={TELEPORT:!0,LINEAR:!0,ANIMATE:!0};function Vr(t){Nr.call(this,t),this.addType(o.NavigationInfo),this.addChildObjects("transitionStart",new Bn.SFBool,"availableViewers",new Bn.MFString,"viewer",new Bn.SFString("EXAMINE")),this._avatarSize.setUnit("length"),this._speed.setUnit("speed"),this._visibilityLimit.setUnit("speed")}Vr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Vr,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_bind",new Bn.SFBool),new z(o.inputOutput,"type",new Bn.MFString("EXAMINE","ANY")),new z(o.inputOutput,"avatarSize",new Bn.MFFloat(.25,1.6,.75)),new z(o.inputOutput,"speed",new Bn.SFFloat(1)),new z(o.inputOutput,"headlight",new Bn.SFBool(!0)),new z(o.inputOutput,"visibilityLimit",new Bn.SFFloat),new z(o.inputOutput,"transitionType",new Bn.MFString("LINEAR")),new z(o.inputOutput,"transitionTime",new Bn.SFTime(1)),new z(o.outputOnly,"transitionComplete",new Bn.SFBool),new z(o.outputOnly,"isBound",new Bn.SFBool),new z(o.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"NavigationInfo"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Nr.prototype.initialize.call(this),this._type.addInterest("set_type__",this),this._headlight.addInterest("set_headlight__",this),this._transitionStart.addInterest("set_transitionStart__",this),this._transitionComplete.addInterest("set_transitionComplete__",this),this._isBound.addInterest("set_isBound__",this),this.set_type__(),this.set_headlight__()},getViewer:function(){return this._viewer.getValue()},getCollisionRadius:function(){return this._avatarSize.length>0&&this._avatarSize[0]>0?this._avatarSize[0]:.25},getAvatarHeight:function(){return this._avatarSize.length>1?this._avatarSize[1]:1.6},getStepHeight:function(){return this._avatarSize.length>2?this._avatarSize[2]:.75},getNearValue:function(){const t=this.getCollisionRadius();return 0===t?1e-5:t/2},getFarValue:function(t){return this._visibilityLimit.getValue()?this._visibilityLimit.getValue():t.getMaxFarValue()},getTransitionType:function(){for(const t of this._transitionType){if(Mr[t])return t}return"LINEAR"},set_type__:function(){this._viewer="EXAMINE";for(const t of this._type){switch(t){case"EXAMINE":case"WALK":case"FLY":case"LOOKAT":case"PLANE":case"NONE":this._viewer=t;break;case"PLANE_create3000.de":this._viewer="PLANE";break;default:continue}break}let t=!1,e=!1,n=!1,i=!1,o=!1,r=!1;if(this._type.length)for(const s of this._type){switch(s){case"EXAMINE":default:t=!0;continue;case"WALK":e=!0;continue;case"FLY":n=!0;continue;case"LOOKAT":r=!0;continue;case"PLANE":i=!0;continue;case"NONE":o=!0;continue;case"ANY":t=!0,e=!0,n=!0,i=!0,o=!0,r=!0}break}else t=!0,e=!0,n=!0,i=!0,o=!0,r=!0;this._availableViewers.length=0,t&&this._availableViewers.push("EXAMINE"),e&&this._availableViewers.push("WALK"),n&&this._availableViewers.push("FLY"),i&&this._availableViewers.push("PLANE"),r&&this._availableViewers.push("LOOKAT"),o&&this._availableViewers.push("NONE")},set_headlight__:function(){this._headlight.getValue()?delete this.enable:this.enable=Function.prototype},set_transitionStart__:function(){this._transitionActive.getValue()||(this._transitionActive=!0)},set_transitionComplete__:function(){this._transitionActive.getValue()&&(this._transitionActive=!1)},set_isBound__:function(){this._isBound.getValue()||this._transitionActive.getValue()&&(this._transitionActive=!1)},enable:function(t,e){t===ir.DISPLAY&&this._headlight.getValue()&&e.getGlobalObjects().push(this.getBrowser().getHeadlight())},traverse:function(t,e){t===ir.CAMERA&&e.getLayer().getNavigationInfos().push(this)}});const Ir=Vr;function Dr(t){const e=[];return{size:0,pop:function(){return 0!==this.size?e[--this.size]:new t},push:function(t){e[this.size++]=t},clear:function(){e.length=0,this.size=0}}}const Rr=Dr(Pr);function Pr(){this.fogMatrix=new Float32Array(9)}function Ar(t){this.addType(o.X3DFogObject),this._visibilityRange.setUnit("length"),this.hidden=!1,this.colorArray=new Float32Array(3)}Pr.prototype={constructor:Pr,set:function(t,e){this.fogNode=t,this.fogKey=String(t.getFogType()),this.fogMatrix.set(e.submatrix.inverse())},getFogKey:function(){return this.fogKey},setShaderUniforms:function(t,e){if(e.hasFog(this))return;const n=this.fogNode;t.uniform3fv(e.x3d_FogColor,n.colorArray),t.uniform1f(e.x3d_FogVisibilityRange,n.visibilityRange),t.uniformMatrix3fv(e.x3d_FogMatrix,!1,this.fogMatrix)},dispose:function(){Rr.push(this)}},Ar.prototype={constructor:Ar,initialize:function(){this._fogType.addInterest("set_fogType__",this),this._color.addInterest("set_color__",this),this._visibilityRange.addInterest("set_visibilityRange__",this),this.set_color__(),this.set_visibilityRange__()},setHidden:function(t){this.hidden=t,this.set_fogType__(),this.getBrowser().addBrowserEvent()},getHidden:function(){return this.hidden},getFogType:function(){return this.fogType},getFogs:function(){return Rr},set_fogType__:function(){const t=new Map([["LINEAR",1],["EXPONENTIAL",2]]);return function(){this.hidden||0===this.visibilityRange?this.fogType=0:this.fogType=t.get(this._fogType.getValue())||1}}(),set_color__:function(){const t=this._color.getValue(),e=this.colorArray;e[0]=t.r,e[1]=t.g,e[2]=t.b},set_visibilityRange__:function(){this.visibilityRange=Math.max(0,this._visibilityRange.getValue()),this.set_fogType__()},dispose:function(){}};const Lr=Ar;function Br(t){Nr.call(this,t),Lr.call(this,t),this.addType(o.Fog),this.modelMatrix=new Ne}Br.prototype=Object.assign(Object.create(Nr.prototype),Lr.prototype,{constructor:Br,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_bind",new Bn.SFBool),new z(o.inputOutput,"fogType",new Bn.SFString("LINEAR")),new z(o.inputOutput,"color",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"visibilityRange",new Bn.SFFloat),new z(o.outputOnly,"isBound",new Bn.SFBool),new z(o.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"Fog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){Nr.prototype.initialize.call(this),Lr.prototype.initialize.call(this)},getModelMatrix:function(){return this.modelMatrix},traverse:function(t,e){t===ir.CAMERA&&(e.getLayer().getFogs().push(this),this.modelMatrix.assign(e.getModelViewMatrix().get()))}});const Xr=Br;function Ur(){this.vertexArray=null,this.shaderNode=null,this.tainted=!0}Ur.prototype={update:function(t=!0){return this.tainted=this.tainted||t,this},enable:function(t,e){return this.tainted||this.shaderNode!==e?(t.deleteVertexArray(this.vertexArray),this.vertexArray=t.createVertexArray(),this.shaderNode=e,this.tainted=!1,t.bindVertexArray(this.vertexArray),!0):(t.bindVertexArray(this.vertexArray),!1)},disable:function(t){t.bindVertexArray(null)},delete:function(t){t.deleteVertexArray(this.vertexArray)}};const zr=Ur,jr=[new qt(0,0,1),new qt(0,0,-1),new qt(0,1,0),new qt(0,-1,0),new qt(1,0,0)];function kr(t){ji.call(this,t),this.addType(o.X3DGeometryNode),this.addChildObjects("transparent",new Bn.SFBool,"bbox_changed",new Bn.SFTime,"rebuild",new Bn.SFTime),this._transparent.setAccessType(o.outputOnly),this._bbox_changed.setAccessType(o.outputOnly),this._rebuild.setAccessType(o.outputOnly);const e=this.getBrowser();this.min=new qt(0,0,0),this.max=new qt(0,0,0),this.bbox=new ur(this.min,this.max,!0),this.solid=!0,this.primitiveMode=e.getContext().TRIANGLES,this.geometryType=3,this.flatShading=void 0,this.colorMaterial=!1,this.attribNodes=[],this.attribArrays=[],this.textureCoordinateMapping=new Map,this.multiTexCoords=[],this.texCoords=kr.createArray(),this.fogDepths=kr.createArray(),this.colors=kr.createArray(),this.normals=kr.createArray(),this.flatNormals=kr.createArray(),this.vertices=kr.createArray(),this.hasFogCoords=!1,this.hasNormals=!1,this.geometryKey="",this.vertexCount=0,this.planes=[];for(let t=0;t<5;++t)this.planes[t]=new Go(qt.Zero,qt.zAxis)}kr.createArray=function(){const t=[];return t.typedArray=new Float32Array,t.assign=function(t){const e=t.length;for(let n=0;n<e;++n)this[n]=t[n];this.length=e},t.getValue=function(){return this.typedArray},t.shrinkToFit=function(){this.length===this.typedArray.length?this.typedArray.set(this):this.typedArray=new Float32Array(this)},t},kr.prototype=Object.assign(Object.create(ji.prototype),{constructor:kr,setup:function(){ji.prototype.setup.call(this),this.rebuild()},initialize:function(){ji.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getContext();this.isLive().addInterest("set_live__",this),this.addInterest("requestRebuild",this),this._rebuild.addInterest("rebuild",this),this.frontFace=e.CCW,this.backFace=new Map([[e.CCW,e.CW],[e.CW,e.CCW]]),this.attribBuffers=[],this.textureCoordinateNode=t.getDefaultTextureCoordinate(),this.texCoordBuffers=Array.from({length:t.getMaxTextures()},(()=>e.createBuffer())),this.fogDepthBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.normalBuffer=e.createBuffer(),this.vertexBuffer=e.createBuffer(),this.vertexArrayObject=new zr,this.shadowArrayObject=new zr,this.set_live__()},setGeometryType:function(t){this.geometryType=t},getGeometryType:function(){return this.geometryType},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()},getBBox:function(){return this.bbox},setBBox:function(t){if(!t.equals(this.bbox)){t.getExtents(this.min,this.max),this.bbox.assign(t);for(let t=0;t<5;++t)this.planes[t].set(t%2?this.min:this.max,jr[t]);this._bbox_changed.addEvent()}},getMin:function(){return this.min},getMax:function(){return this.max},getMatrix:function(){return Ne.Identity},setPrimitiveMode:function(t){this.primitiveMode=t},getPrimitiveMode:function(){return this.primitiveMode},setSolid:function(t){this.solid=t},setCCW:function(t){const e=this.getBrowser().getContext();this.frontFace=t?e.CCW:e.CW},getAttrib:function(){return this.attribNodes},getAttribs:function(){return this.attribArrays},getAttribBuffers:function(){return this.attribBuffers},setFogDepths:function(t){this.fogDepths.assign(t)},getFogDepths:function(){return this.fogDepths},setColors:function(t){this.colors.assign(t)},getColors:function(){return this.colors},setMultiTexCoords:function(t){const e=this.multiTexCoords,n=t.length;for(let i=0;i<n;++i)e[i]=t[i];e.length=n},getMultiTexCoords:function(){return this.multiTexCoords},getTexCoords:function(){return this.texCoords},getTextureCoordinate:function(){return this.textureCoordinateNode},setTextureCoordinate:function(t){this.textureCoordinateNode.removeInterest("updateTextureCoordinateMapping",this),this.textureCoordinateNode=t||this.getBrowser().getDefaultTextureCoordinate(),this.textureCoordinateNode.addInterest("updateTextureCoordinateMapping",this),this.updateTextureCoordinateMapping()},getTextureCoordinateMapping:function(){return this.textureCoordinateMapping},updateTextureCoordinateMapping:function(){this.textureCoordinateMapping.clear(),this.textureCoordinateNode.getTextureCoordinateMapping(this.textureCoordinateMapping)},setNormals:function(t){this.normals.assign(t)},getNormals:function(){return this.normals},setVertices:function(t){this.vertices.assign(t)},getVertices:function(){return this.vertices},updateVertexArrays:function(){this.vertexArrayObject.update(),this.shadowArrayObject.update(),this.updateParticlesShadow=!0,this.updateParticles=!0},buildTexCoords:function(){const t=this.texCoords;if(0===t.length){const e=this.getTexCoordParams(),n=e.min,i=e.Sindex,o=e.Tindex,r=e.Ssize,s=n[i],a=n[o],u=this.vertices.getValue();for(let e=0,n=u.length;e<n;e+=4)t.push((u[e+i]-s)/r,(u[e+o]-a)/r,0,1);t.shrinkToFit()}this.getMultiTexCoords().push(t)},getTexCoordParams:function(){const t={min:new qt(0,0,0),Ssize:0,Sindex:0,Tindex:0};return function(){const e=this.getBBox(),n=e.size,i=n.x,o=n.y,r=n.z;return t.min.assign(e.center).subtract(n.divide(2)),i>=o&&i>=r?(t.Ssize=i,t.Sindex=0,t.Tindex=o>=r?1:2):o>=i&&o>=r?(t.Ssize=o,t.Sindex=1,t.Tindex=i>=r?0:2):(t.Ssize=r,t.Sindex=2,t.Tindex=i>=o?0:1),t}}(),refineNormals:function(t,e,n){if(0===n)return e;const i=Math.cos(et.clamp(n,0,Math.PI)),o=[];for(const n in t){const r=t[n];for(const t of r){const n=e[t],s=new qt(0,0,0);for(const t of r){const o=e[t];o.dot(n)>=i&&s.add(o)}o[t]=s.normalize()}}return o},transformLine:function(t){},transformMatrix:function(t){},isClipped:function(t,e){return e.some((function(e){return e.isClipped(t)}))},intersectsLine:function(t,e,n,i,o){return this.intersectsLineWithGeometry(t,e.getModelViewMatrix().get(),e.getLocalObjects(),o)},intersectsLineWithGeometry:function(){const t=new Ne,e={u:0,v:0,t:0},n=new qt(0,0,0),i=new qt(0,0,0),o=new qt(0,0,0),r=new qt(0,0,0);return function(s,a,u,c){if(this.intersectsBBox(s)){this.transformLine(s),this.transformMatrix(t.assign(a));const l=this.multiTexCoords[0].getValue(),h=this.normals.getValue(),d=this.vertices.getValue(),f=this.vertexCount;for(let a=0;a<f;a+=3){const f=4*a;if(n.x=d[f],n.y=d[f+1],n.z=d[f+2],i.x=d[f+4],i.y=d[f+5],i.z=d[f+6],o.x=d[f+8],o.y=d[f+9],o.z=d[f+10],s.intersectsTriangle(n,i,o,e)){const n=e.u,i=e.v,o=e.t,s=new qt(o*d[f]+n*d[f+4]+i*d[f+8],o*d[f+1]+n*d[f+5]+i*d[f+9],o*d[f+2]+n*d[f+6]+i*d[f+10]);if(u.length&&this.isClipped(t.multVecMatrix(r.assign(s)),u))continue;const p=new jt(o*l[f]+n*l[f+4]+i*l[f+8],o*l[f+1]+n*l[f+5]+i*l[f+9]),g=3*a,m=new qt(o*h[g]+n*h[g+3]+i*h[g+6],o*h[g+1]+n*h[g+4]+i*h[g+7],o*h[g+2]+n*h[g+5]+i*h[g+8]);c.push({texCoord:p,normal:m,point:this.getMatrix().multVecMatrix(s)})}}}return c.length}}(),getPlanesWithOffset:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=[];for(let t=0;t<5;++t)n[t]=new Go(qt.Zero,qt.zAxis);return function(i,o,r,s,a,u){t.set(i,o,r),e.set(s,a,u);for(let i=0;i<5;++i)n[i].set(i%2?t:e,jr[i]);return n}}(),intersectsBBox:function(){const t=new qt(0,0,0);return function(e,n){if(n)var i=this.min,o=this.max,r=i.x-n.x,s=o.x+n.x,a=i.y-n.y,u=o.y+n.y,c=i.z-n.z,l=o.z+n.z,h=this.getPlanesWithOffset(r,a,c,s,u,l);else i=this.min,o=this.max,r=i.x,s=o.x,a=i.y,u=o.y,c=i.z,l=o.z,h=this.planes;return!!(h[0].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.y>=a&&t.y<=u)||(!!(h[1].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.y>=a&&t.y<=u)||(!!(h[2].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.z>=c&&t.z<=l)||(!!(h[3].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.z>=c&&t.z<=l)||!!(h[4].intersectsLine(e,t)&&t.y>=a&&t.y<=u&&t.z>=c&&t.z<=l))))}}(),intersectsBox:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=new Ne,o=new qt(0,0,0);return function(r,s,a){if(r.intersectsBox(this.bbox)){r.multRight(i.assign(this.getMatrix()).inverse()),this.transformMatrix(a);const u=this.vertices.getValue();for(let i=0,c=this.vertexCount;i<c;i+=3){const c=4*i;if(t.x=u[c],t.y=u[c+1],t.z=u[c+2],e.x=u[c+4],e.y=u[c+5],e.z=u[c+6],n.x=u[c+8],n.y=u[c+9],n.z=u[c+10],r.intersectsTriangle(t,e,n)){if(s.length){if(this.isClipped(a.multVecMatrix(o.assign(t)),s))continue;if(this.isClipped(a.multVecMatrix(o.assign(e)),s))continue;if(this.isClipped(a.multVecMatrix(o.assign(n)),s))continue}return!0}}}return!1}}(),set_live__:function(){this.isLive().getValue()?this.getBrowser().getBrowserOptions()._Shading.addInterest("set_shading__",this):this.getBrowser().getBrowserOptions()._Shading.removeInterest("set_shading__",this)},set_shading__:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0);return function(o){if(this.geometryType<2)return;const r=this.getBrowser(),s=r.getBrowserOptions().getShading()===di.FLAT;if(s===this.flatShading)return;this.flatShading=s;const a=r.getContext();if(s&&!this.flatNormals.length){const o=this.frontFace===a.CW,r=this.flatNormals,s=this.vertices.getValue();for(let a=0,u=s.length;a<u;a+=12)Ho.normal(t.set(s[a],s[a+1],s[a+2]),e.set(s[a+4],s[a+5],s[a+6]),n.set(s[a+8],s[a+9],s[a+10]),i),o&&i.negate(),r.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z);r.shrinkToFit()}a.bindBuffer(a.ARRAY_BUFFER,this.normalBuffer),a.bufferData(a.ARRAY_BUFFER,s?this.flatNormals.getValue():this.normals.getValue(),a.DYNAMIC_DRAW)}}(),requestRebuild:function(){this._rebuild.addEvent()},rebuild:function(){const t=new qt(0,0,0);return function(){this.clear(),this.build();for(const t of this.attribArrays)t.shrinkToFit();for(const t of this.multiTexCoords)t.shrinkToFit();this.fogDepths.shrinkToFit(),this.colors.shrinkToFit(),this.normals.shrinkToFit(),this.vertices.shrinkToFit();const e=this.min,n=this.max,i=this.vertices.getValue();if(i.length){if(e.x===Number.POSITIVE_INFINITY)for(let o=0,r=i.length;o<r;o+=4)t.set(i[o],i[o+1],i[o+2]),e.min(t),n.max(t);this.bbox.setExtents(e,n)}else this.bbox.setExtents(e.set(0,0,0),n.set(0,0,0));this._bbox_changed.addEvent();for(let t=0;t<5;++t)this.planes[t].set(t%2?e:n,jr[t]);if(0===this.multiTexCoords.length&&this.buildTexCoords(),this.multiTexCoords.length){const t=this.getBrowser().getMaxTextures();for(let e=this.multiTexCoords.length;e<t;++e)this.multiTexCoords[e]=this.multiTexCoords.at(-1);this.multiTexCoords.length=t}this.transfer(),this.updateGeometryKey(),this.updateRenderFunctions()}}(),clear:function(){this.min.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.max.set(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);{const t=this.attribArrays;for(const e of t)e.length=0;const e=this.attribNodes.length;for(let n=t.length;n<e;++n)t[n]=kr.createArray();t.length=e}this.flatShading=void 0,this.fogDepths.length=0,this.colors.length=0,this.multiTexCoords.length=0,this.texCoords.length=0,this.normals.length=0,this.flatNormals.length=0,this.vertices.length=0},transfer:function(){const t=this.getBrowser().getContext();for(let e=this.attribBuffers.length,n=this.attribArrays.length;e<n;++e)this.attribBuffers.push(t.createBuffer());for(let e=0,n=this.attribArrays.length;e<n;++e)t.bindBuffer(t.ARRAY_BUFFER,this.attribBuffers[e]),t.bufferData(t.ARRAY_BUFFER,this.attribArrays[e].getValue(),t.DYNAMIC_DRAW);const e=this.hasFogCoords;t.bindBuffer(t.ARRAY_BUFFER,this.fogDepthBuffer),t.bufferData(t.ARRAY_BUFFER,this.fogDepths.getValue(),t.DYNAMIC_DRAW),this.hasFogCoords=!!this.fogDepths.length,this.hasFogCoords!==e&&this.updateVertexArrays();const n=this.colorMaterial;t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors.getValue(),t.DYNAMIC_DRAW),this.colorMaterial=!!this.colors.length,this.colorMaterial!==n&&this.updateVertexArrays();for(let e=0,n=this.multiTexCoords.length;e<n;++e)t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffers[e]),t.bufferData(t.ARRAY_BUFFER,this.multiTexCoords[e].getValue(),t.DYNAMIC_DRAW);const i=this.hasNormals;this.set_shading__(this.getBrowser().getBrowserOptions()._Shading),this.hasNormals=!!this.normals.getValue().length,this.hasNormals!==i&&this.updateVertexArrays(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices.getValue(),t.DYNAMIC_DRAW),this.vertexCount=this.vertices.length/4},updateGeometryKey:function(){this.geometryKey="",this.geometryKey+=this.geometryType,this.geometryKey+=this.hasFogCoords?"1":"0",this.geometryKey+=this.colorMaterial?"1":"0",this.geometryKey+=this.hasNormals?"1":"0"},updateRenderFunctions:function(){this.vertexCount?(delete this.depth,delete this.display,delete this.displayParticlesDepth,delete this.displayParticles):(this.depth=Function.prototype,this.display=Function.prototype,this.displayParticlesDepth=Function.prototype,this.displayParticles=Function.prototype)},traverse:function(t,e){},depth:function(t,e,n){this.shadowArrayObject.enable(t,n)&&n.enableVertexAttribute(t,this.vertexBuffer,0,0),t.drawArrays(this.primitiveMode,0,this.vertexCount)},display:function(t,e){const n=e.appearanceNode,i=n.getShader(this,e);if(this.solid||!n.getBackMaterial()||this.getBrowser().getWireframe())this.displayGeometry(t,e,n,i,!0,!0);else{const o=n.getBackShader(this,e);this.displayGeometry(t,e,n,o,!0,!1),this.displayGeometry(t,e,n,i,!1,!0)}},displayGeometry:function(t,e,n,i,o,r){const s=this.getBrowser(),a=n.getBlendMode(),u=this.attribNodes,c=this.attribBuffers,l=s.getPrimitiveMode(this.primitiveMode);if(a&&a.enable(t),i.enable(t),i.setUniforms(t,this,e,r),this.vertexArrayObject.enable(t,i)){for(let e=0,n=u.length;e<n;++e)u[e].enable(t,i,c[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),i.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),i.enableNormalAttribute(t,this.normalBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0)}if(s.getWireframe())for(let e=0,n=this.vertexCount;e<n;e+=3)t.drawArrays(l,e,3);else{const n=Ne.prototype.determinant3.call(e.modelViewMatrix)>0;t.frontFace(n?this.frontFace:this.backFace.get(this.frontFace)),e.transparent||o!==r?(t.enable(t.CULL_FACE),o&&!this.solid&&(t.cullFace(t.FRONT),t.drawArrays(l,0,this.vertexCount)),r&&(t.cullFace(t.BACK),t.drawArrays(l,0,this.vertexCount))):(this.solid?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.drawArrays(l,0,this.vertexCount))}a&&a.disable(t)},displayParticlesDepth:function(t,e,n,i){const o=i.outputParticles;if(o.shadowArrayObject.update(this.updateParticlesShadow).enable(t,n)){const e=i.particleStride;n.enableParticleAttribute(t,o,e,i.particleOffset,1),n.enableParticleMatrixAttribute(t,o,e,i.matrixOffset,1),n.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticlesShadow=!1}t.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,i.numParticles)},displayParticles:function(t,e,n){const i=e.appearanceNode,o=i.getShader(this,e);if(this.solid||!i.getBackMaterial()||this.getBrowser().getWireframe())this.displayParticlesGeometry(t,e,i,o,!0,!0,n);else{const r=i.getBackShader(this,e);this.displayParticlesGeometry(t,e,i,r,!0,!1,n),this.displayParticlesGeometry(t,e,i,o,!1,!0,n)}},displayParticlesGeometry:function(t,e,n,i,o,r,s){const a=this.getBrowser(),u=n.getBlendMode(),c=this.attribNodes,l=this.attribBuffers,h=a.getPrimitiveMode(this.primitiveMode);u&&u.enable(t),i.enable(t),i.setUniforms(t,this,e,r);const d=s.outputParticles;if(d.vertexArrayObject.update(this.updateParticles).enable(t,i)){const e=s.particleStride;i.enableParticleAttribute(t,d,e,s.particleOffset,1),i.enableParticleMatrixAttribute(t,d,e,s.matrixOffset,1);for(let e=0,n=c.length;e<n;++e)c[e].enable(t,i,l[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),i.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),i.enableNormalAttribute(t,this.normalBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}const f=Ne.prototype.determinant3.call(e.modelViewMatrix)>0;t.frontFace(f?this.frontFace:this.backFace.get(this.frontFace)),e.transparent||o!==r?(t.enable(t.CULL_FACE),o&&!this.solid&&(t.cullFace(t.FRONT),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles)),r&&(t.cullFace(t.BACK),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles))):(this.solid?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles)),u&&u.disable(t)}});const Gr=kr;function Hr(t={}){Object.assign(this,{geometryType:3,hasFogCoords:!1,colorMaterial:!1,hasNormals:!1,textureNode:!1,objectsCount:[0,0,0],textureCoordinateMapping:new Map,textureCoordinateNode:null},t),this.updateGeometryKey()}Hr.prototype={constructor:Hr,updateGeometryKey:Gr.prototype.updateGeometryKey,getTextureCoordinateMapping:function(){return this.textureCoordinateMapping},getTextureCoordinate:function(){return this.textureCoordinateNode}};const qr=Hr;function Yr(t,e){this.real=t,this.imag=e}Yr.prototype={constructor:Yr,[Symbol.iterator]:function*(){yield this.real,yield this.imag},copy:function(){const t=Object.create(Yr.prototype);return t.real=this.real,t.imag=this.imag,t},assign:function(t){return this.real=t.real,this.imag=t.imag,this},equals:function(t){return this.real===t.real&&this.imag===t.imag},setPolar:function(t,e){return this.real=t*Math.cos(e),this.imag=t*Math.sin(e),this},conjugate:function(){return this.imag=-this.imag,this},negate:function(){return this.real=-this.real,this.imag=-this.imag,this},inverse:function(){const t=this.real*this.real+this.imag*this.imag;return this.real/=t,this.imag/=-t,this},add:function(t){return this.real+=t.real,this.imag+=t.imag,this},subtract:function(t){return this.real-=t.real,this.imag-=t.imag,this},multiply:function(t){return this.real*=t,this.imag*=t,this},multComp:function(){const t=this.real,e=this.imag;return this.real=t*value.real-e*value.imag,this.imag=t*value.imag+e*value.real,this},divComp:function(t){const e=this.real,n=this.imag,i=t.real,o=t.imag,r=i*i+o*o;return this.real=(e*i+n*o)/r,this.imag=(n*i-e*o)/r,this},toString:function(){return this.imag?this.real+" "+this.imag+"i":String(this.real)}},Object.defineProperty(Yr.prototype,"magnitude",{get:function(){return this.real?this.imag?Math.hypot(this.real,this.imag):Math.abs(this.real):Math.abs(this.imag)},set:function(t){this.setPolar(t,this.angle)},enumerable:!1,configurable:!1}),Object.defineProperty(Yr.prototype,"angle",{get:function(){return Math.atan2(this.imag,this.real)},set:function(t){this.setPolar(this.magnitude,t)},enumerable:!1,configurable:!1}),Object.assign(Yr,{Polar:function(t,e){return Object.create(Yr.prototype).setPolar(t,e)},multiply:function(t,e){return t.copy().multiply(e)},multComp:function(t,e){return t.copy().multComp(e)}});const Wr=Yr;function $r(t=0){this.value=t}$r.prototype={constructor:$r,get:function(t){const e=1<<t;return!!(this.value&e)},set:function(t,e){const n=1<<t;e?this.value|=n:this.value&=~n},clear:function(){this.value=0},valueOf:function(){return this.value},toString:function(t){return this.value.toString(t)}};const Kr=$r,Qr=Math.SQRT2/2;function Zr(t){Nr.call(this,t),this.addType(o.X3DBackgroundNode),this._skyAngle.setUnit("angle"),this._groundAngle.setUnit("angle");this.getBrowser();this.hidden=!1,this.projectionMatrixArray=new Float32Array(16),this.modelMatrix=new Ne,this.modelViewMatrixArray=new Float32Array(16),this.clipPlanes=[],this.colors=[],this.sphere=[],this.textureBits=new Kr,this.sphereContext=new qr({colorMaterial:!0}),this.texturesContext=new qr({textureNode:!0})}Zr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Zr,initialize:function(){Nr.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getContext();this.colorBuffer=e.createBuffer(),this.sphereBuffer=e.createBuffer(),this.texCoordBuffers=new Array(t.getMaxTextures()).fill(e.createBuffer()),this.frontBuffer=e.createBuffer(),this.backBuffer=e.createBuffer(),this.leftBuffer=e.createBuffer(),this.rightBuffer=e.createBuffer(),this.topBuffer=e.createBuffer(),this.bottomBuffer=e.createBuffer(),this.sphereArrayObject=new zr,this.frontArrayObject=new zr,this.backArrayObject=new zr,this.leftArrayObject=new zr,this.rightArrayObject=new zr,this.topArrayObject=new zr,this.bottomArrayObject=new zr,this._groundAngle.addInterest("build",this),this._groundColor.addInterest("build",this),this._skyAngle.addInterest("build",this),this._skyColor.addInterest("build",this),this.build(),this.transferRectangle()},set_frontTexture__:function(t){this.updateTexture("frontTexture",t,0)},set_backTexture__:function(t){this.updateTexture("backTexture",t,1)},set_leftTexture__:function(t){this.updateTexture("leftTexture",t,2)},set_rightTexture__:function(t){this.updateTexture("rightTexture",t,3)},set_topTexture__:function(t){this.updateTexture("topTexture",t,4)},set_bottomTexture__:function(t){this.updateTexture("bottomTexture",t,5)},updateTexture:function(t,e,n){this[t]&&this[t]._loadState.removeInterest("setTextureBit",this),this[t]=e,e?(e._loadState.addInterest("setTextureBit",this,n,e),this.setTextureBit(n,e,e._loadState)):this.textureBits.set(n,!1)},setTextureBit:function(t,e,n){this.textureBits.set(t,n.getValue()===o.COMPLETE_STATE||e&&e.getData())},setHidden:function(t){this.hidden=t,this.getBrowser().addBrowserEvent()},getHidden:function(){return this.hidden},getTransparent:function(){return!!this.hidden||0!==this._transparency.getValue()&&(!(this.frontTexture&&!this.frontTexture._transparent.getValue())||(!(this.backTexture&&!this.backTexture._transparent.getValue())||(!(this.leftTexture&&!this.leftTexture._transparent.getValue())||(!(this.rightTexture&&!this.rightTexture._transparent.getValue())||(!(this.topTexture&&!this.topTexture._transparent.getValue())||!(this.bottomTexture&&!this.bottomTexture._transparent.getValue()))))))},getColor:function(t,e,n){return e[et.upperBound(n,0,n.length,t)]},build:function(){const t=Qr;if(this.colors.length=0,this.sphere.length=0,0===this._groundColor.length&&1==this._skyColor.length){this.sphere.vertices=36,this.sphere.push(t,t,-t,1,-t,t,-t,1,-t,-t,-t,1,t,t,-t,1,-t,-t,-t,1,t,-t,-t,1,-t,t,t,1,t,t,t,1,-t,-t,t,1,-t,-t,t,1,t,t,t,1,t,-t,t,1,-t,t,-t,1,-t,t,t,1,-t,-t,t,1,-t,t,-t,1,-t,-t,t,1,-t,-t,-t,1,t,t,t,1,t,t,-t,1,t,-t,t,1,t,-t,t,1,t,t,-t,1,t,-t,-t,1,t,t,t,1,-t,t,t,1,-t,t,-t,1,t,t,t,1,-t,t,-t,1,t,t,-t,1,-t,-t,t,1,t,-t,t,1,-t,-t,-t,1,-t,-t,-t,1,t,-t,t,1,t,-t,-t,1);const e=this._skyColor[0];for(let t=0,n=this.sphere.vertices;t<n;++t)this.colors.push(e.r,e.g,e.b,1)}else{if(this._skyColor.length>this._skyAngle.length){const t=this._skyAngle.slice();(0===t.length||t[0]>0)&&t.unshift(0),t.at(-1)<Math.PI&&t.push(Math.PI),2===t.length&&t.splice(1,0,(t[0]+t[1])/2),this.buildSphere(1,t,this._skyAngle,this._skyColor,!1)}if(this._groundColor.length>this._groundAngle.length){const t=this._groundAngle.slice().reverse();(0===t.length||t[0]<Math.PI/2)&&t.unshift(Math.PI/2),t.at(-1)>0&&t.push(0),this.buildSphere(1,t,this._groundAngle,this._groundColor,!0)}}this.transferSphere()},buildSphere:function(){const t=new Wr(0,0),e=new Wr(0,0),n=new Wr(0,0),i=new Wr(0,0),o=new Wr(0,0),r=new Wr(0,0);return function(s,a,u,c,l){const h=l?Math.PI/2:Math.PI,d=a.length-1;for(let f=0;f<d;++f){let d=et.clamp(a[f],0,h),p=et.clamp(a[f+1],0,h);l&&(d=Math.PI-d,p=Math.PI-p),t.setPolar(s,d),e.setPolar(s,p);const g=this.getColor(a[f],c,u),m=this.getColor(a[f+1],c,u);for(let s=0;s<20;++s){const a=s<19?s+1:0;let u=2*Math.PI*(s/20);n.setPolar(-t.imag,u),i.setPolar(-e.imag,u),u=2*Math.PI*(a/20),o.setPolar(-e.imag,u),r.setPolar(-t.imag,u),this.colors.push(g.r,g.g,g.b,1,m.r,m.g,m.b,1,m.r,m.g,m.b,1,g.r,g.g,g.b,1,g.r,g.g,g.b,1,m.r,m.g,m.b,1),this.sphere.push(n.imag,t.real,n.real,1,o.imag,e.real,o.real,1,i.imag,e.real,i.real,1,n.imag,t.real,n.real,1,r.imag,t.real,r.real,1,o.imag,e.real,o.real,1)}}}}(),transferSphere:function(){const t=this.getBrowser().getContext();t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.colors),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.sphereBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.sphere),t.DYNAMIC_DRAW),this.sphereCount=this.sphere.length/4},transferRectangle:function(){const t=[1,1,0,1,0,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,1],e=[Qr,Qr,-Qr,1,-Qr,Qr,-Qr,1,-Qr,-Qr,-Qr,1,Qr,Qr,-Qr,1,-Qr,-Qr,-Qr,1,Qr,-Qr,-Qr,1],n=[-Qr,Qr,Qr,1,Qr,Qr,Qr,1,Qr,-Qr,Qr,1,-Qr,Qr,Qr,1,Qr,-Qr,Qr,1,-Qr,-Qr,Qr,1],i=[-Qr,Qr,-Qr,1,-Qr,Qr,Qr,1,-Qr,-Qr,Qr,1,-Qr,Qr,-Qr,1,-Qr,-Qr,Qr,1,-Qr,-Qr,-Qr,1],o=[Qr,Qr,Qr,1,Qr,Qr,-Qr,1,Qr,-Qr,-Qr,1,Qr,Qr,Qr,1,Qr,-Qr,-Qr,1,Qr,-Qr,Qr,1],r=[Qr,Qr,Qr,1,-Qr,Qr,Qr,1,-Qr,Qr,-Qr,1,Qr,Qr,Qr,1,-Qr,Qr,-Qr,1,Qr,Qr,-Qr,1],s=[Qr,-Qr,-Qr,1,-Qr,-Qr,-Qr,1,-Qr,-Qr,Qr,1,Qr,-Qr,-Qr,1,-Qr,-Qr,Qr,1,Qr,-Qr,Qr,1];return function(){const a=this.getBrowser().getContext();a.bindBuffer(a.ARRAY_BUFFER,this.texCoordBuffers[0]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(t),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.frontBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.backBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(n),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.leftBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(i),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.rightBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(o),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.topBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(r),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.bottomBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(s),a.DYNAMIC_DRAW)}}(),traverse:function(t,e){switch(t){case ir.CAMERA:return e.getLayer().getBackgrounds().push(this),void this.modelMatrix.assign(e.getModelViewMatrix().get());case ir.DISPLAY:{const t=e.getLocalObjects(),n=this.clipPlanes;let i=0;for(let e=0,o=t.length;e<o;++e)t[e].isClipped&&(n[i++]=t[e]);return n.length=i,this.sphereContext.objectsCount[0]=n.length,void(this.texturesContext.objectsCount[0]=n.length)}}},display:function(){const t=new Ne,e=new Ne,n=new Ce,i=new qt(0,0,0),o=new qt(0,0,0);return function(r,s,a){if(this.hidden)return;r.depthMask(!1),r.disable(r.DEPTH_TEST),r.enable(r.CULL_FACE),r.frontFace(r.CCW);const u=.8*-Jo.unProjectPointMatrix(0,0,1,t.assign(s.getProjectionMatrix().get()).inverse(),a,o).z;this.projectionMatrixArray.set(s.getProjectionMatrix().get()),e.assign(this.modelMatrix),e.multRight(s.getViewMatrix().get()),e.get(null,n),e.identity(),e.rotate(n),e.scale(i.set(u,u,u)),this.modelViewMatrixArray.set(e),this.drawSphere(s),+this.textureBits&&this.drawCube(s)}}(),drawSphere:function(t){const e=this._transparency.getValue();if(e>=1)return;const n=this.getBrowser(),i=n.getContext(),o=n.getDefaultMaterial().getShader(this.sphereContext);o.enable(i),o.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniform1f(o.x3d_Transparency,e),i.uniform1i(o.x3d_TextureCoordinateGeneratorMode[0],0),this.sphereArrayObject.enable(i,o)&&(o.enableColorAttribute(i,this.colorBuffer,0,0),o.enableVertexAttribute(i,this.sphereBuffer,0,0)),e?i.enable(i.BLEND):i.disable(i.BLEND),i.drawArrays(i.TRIANGLES,0,this.sphereCount)},drawCube:function(){const t=new Float32Array(Ne.Identity);return function(e){const n=this.getBrowser(),i=n.getContext(),o=n.getDefaultMaterial().getShader(this.texturesContext);o.enable(i),o.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniformMatrix4fv(o.x3d_TextureMatrix[0],!1,t),i.uniform3f(o.x3d_EmissiveColor,1,1,1),i.uniform1f(o.x3d_Transparency,0),i.uniform1i(o.x3d_TextureCoordinateGeneratorMode[0],0),this.drawRectangle(i,n,o,e,this.frontTexture,this.frontBuffer,this.frontArrayObject),this.drawRectangle(i,n,o,e,this.backTexture,this.backBuffer,this.backArrayObject),this.drawRectangle(i,n,o,e,this.leftTexture,this.leftBuffer,this.leftArrayObject),this.drawRectangle(i,n,o,e,this.rightTexture,this.rightBuffer,this.rightArrayObject),this.drawRectangle(i,n,o,e,this.topTexture,this.topBuffer,this.topArrayObject),this.drawRectangle(i,n,o,e,this.bottomTexture,this.bottomBuffer,this.bottomArrayObject)}}(),drawRectangle:function(t,e,n,i,r,s,a){r&&(r.checkLoadState()===o.COMPLETE_STATE||r.getData())&&(r.setShaderUniforms(t,n,i),a.enable(t,n)&&(n.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),n.enableVertexAttribute(t,s,0,0)),r._transparent.getValue()?t.enable(t.BLEND):t.disable(t.BLEND),t.drawArrays(t.TRIANGLES,0,6),e.resetTextureUnits())}});const Jr=Zr;function ts(t){ji.call(this,t),this.addType(o.X3DAppearanceChildNode)}ts.prototype=Object.assign(Object.create(ji.prototype),{constructor:ts});const es=ts;function ns(t){es.call(this,t),this.addType(o.X3DTextureNode),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(o.outputOnly)}ns.prototype=Object.assign(Object.create(es.prototype),{constructor:ns,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()}});const is=ns;function os(t){is.call(this,t),this.addType(o.X3DSingleTextureNode)}os.prototype=Object.assign(Object.create(is.prototype),{constructor:os,initialize:function(){is.prototype.initialize.call(this),this._textureProperties.addInterest("set_textureProperties__",this,!0);const t=this.getBrowser().getContext();this.texture=t.createTexture(),this.set_textureProperties__(!1)},set_textureProperties__:function(t){this.texturePropertiesNode&&this.texturePropertiesNode.removeInterest("updateTextureParameters",this),this.texturePropertiesNode=mr(o.TextureProperties,this._textureProperties),this.texturePropertiesNode||(this.texturePropertiesNode=this.getBrowser().getDefaultTextureProperties()),this.texturePropertiesNode.addInterest("updateTextureParameters",this),t&&this.updateTextureParameters()},getCount:function(){return 1},getTexture:function(){return this.texture},updateTextureParameters:function(){const t=["EXT_texture_filter_anisotropic","MOZ_EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"];return function(e,n,i,o,r,s,a,u){const c=this.getBrowser().getContext();c.bindTexture(e,this.getTexture()),Math.max(o,r)<this.getBrowser().getMinTextureSize()&&!n?(c.texParameteri(e,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(e,c.TEXTURE_MAG_FILTER,c.NEAREST)):(i._generateMipMaps.getValue()&&c.generateMipmap(e),c.texParameteri(e,c.TEXTURE_MIN_FILTER,c[i.getMinificationFilter()]),c.texParameteri(e,c.TEXTURE_MAG_FILTER,c[i.getMagnificationFilter()])),n?(c.texParameteri(e,c.TEXTURE_WRAP_S,c[i.getBoundaryModeS()]),c.texParameteri(e,c.TEXTURE_WRAP_T,c[i.getBoundaryModeT()]),c.getVersion()>=2&&c.texParameteri(e,c.TEXTURE_WRAP_R,c[i.getBoundaryModeR()])):(c.texParameteri(e,c.TEXTURE_WRAP_S,s?c.REPEAT:c.CLAMP_TO_EDGE),c.texParameteri(e,c.TEXTURE_WRAP_T,a?c.REPEAT:c.CLAMP_TO_EDGE),c.getVersion()>=2&&c.texParameteri(e,c.TEXTURE_WRAP_R,u?c.REPEAT:c.CLAMP_TO_EDGE));for(const n of t){const t=c.getExtension(n);if(t){c.texParameterf(e,t.TEXTURE_MAX_ANISOTROPY_EXT,i._anisotropicDegree.getValue());break}}}}(),updateTextureBits:function(t,e=0){const n=this.getTextureType()-1;t.set(2*e+0,1&n),t.set(2*e+1,2&n)},getShaderOptions:function(){const t={2:"2D",3:"3D",4:"CUBE"};return function(e,n=0){e.push("X3D_TEXTURE"+n+"_"+t[this.getTextureType()])}}()});const rs=os,ss=new Uint8Array([255,255,255,255]);function as(t){rs.call(this,t),this.addType(o.X3DTexture2DNode);const e=this.getBrowser().getContext();this.target=e.TEXTURE_2D,this.width=0,this.height=0,this.flipY=!1,this.data=null}as.prototype=Object.assign(Object.create(rs.prototype),{constructor:as,initialize:function(){rs.prototype.initialize.call(this),this._repeatS.addInterest("updateTextureParameters",this),this._repeatT.addInterest("updateTextureParameters",this);const t=this.getBrowser().getContext();t.bindTexture(t.TEXTURE_2D,this.getTexture()),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,ss)},getTarget:function(){return this.target},getTextureType:function(){return 2},getTextureTypeString:function(){return"2D"},getWidth:function(){return this.width},getHeight:function(){return this.height},getFlipY:function(){return this.flipY},getData:function(){return this.data},clearTexture:function(){this.setTexture(1,1,!1,ss,!1),this.data=null},setTexture:function(t,e,n,i,o){this.width=t,this.height=e,this.flipY=o,this.data=i;const r=this.getBrowser().getContext();r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,o),r.bindTexture(r.TEXTURE_2D,this.getTexture()),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,i),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),this.setTransparent(n),this.updateTextureParameters(),this.addNodeEvent()},updateTexture:function(t,e){this.data=t;const n=this.getBrowser().getContext();n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),n.bindTexture(n.TEXTURE_2D,this.getTexture()),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),this.texturePropertiesNode._generateMipMaps.getValue()&&n.generateMipmap(n.TEXTURE_2D),this.addNodeEvent()},updateTextureParameters:function(){rs.prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,this.width,this.height,this._repeatS.getValue(),this._repeatT.getValue(),!1)},setShaderUniforms:function(t,e,n,i=e.x3d_Texture[0]){const o=this.getBrowser().getTexture2DUnit();t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,this.getTexture()),t.uniform1i(i.texture2D,o)}});const us=as;function cs(t){us.call(this,t),xo.call(this,t),this.addType(o.ImageTexture),this.image=$("<img></img>"),this.canvas=$("<canvas></canvas>"),this.urlStack=new Bn.MFString}cs.prototype=Object.assign(Object.create(us.prototype),xo.prototype,{constructor:cs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"load",new Bn.SFBool(!0)),new z(o.inputOutput,"url",new Bn.MFString),new z(o.inputOutput,"autoRefresh",new Bn.SFTime),new z(o.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new z(o.initializeOnly,"repeatS",new Bn.SFBool(!0)),new z(o.initializeOnly,"repeatT",new Bn.SFBool(!0)),new z(o.initializeOnly,"textureProperties",new Bn.SFNode)]),getTypeName:function(){return"ImageTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){us.prototype.initialize.call(this),xo.prototype.initialize.call(this),this.image.on("load",this.setImage.bind(this)),this.image.on("abort error",this.setError.bind(this)),this.image[0].crossOrigin="Anonymous",this.requestImmediateLoad()},unLoadNow:function(){this.clearTexture()},loadNow:function(){this.urlStack.setValue(this._url),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.clearTexture(),void this.setLoadState(o.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.image.attr("src",this.URL.href)},setError:function(t){"data:"!==this.URL.protocol&&console.warn("Error loading image:",decodeURI(this.URL.href),t.type),this.loadNext()},setImage:function(){try{const t=this.getBrowser().getContext(),e=this.image[0],n=this.canvas[0],i=n.getContext("2d",{willReadFrequently:!0});let r=e.width,s=e.height;t.getVersion()>=2||et.isPowerOfTwo(r)&&et.isPowerOfTwo(s)?(n.width=r,n.height=s,i.clearRect(0,0,r,s),i.save(),i.translate(0,s),i.scale(1,-1),i.drawImage(e,0,0),i.restore()):(r=et.nextPowerOfTwo(r),s=et.nextPowerOfTwo(s),n.width=r,n.height=s,i.clearRect(0,0,r,s),i.save(),i.translate(0,s),i.scale(1,-1),i.drawImage(e,0,0,e.width,e.height,0,0,r,s),i.restore());const a=i.getImageData(0,0,r,s).data;let u=!1;for(let t=3,e=a.length;t<e;t+=4)if(255!==a[t]){u=!0;break}this.setTexture(r,s,u,new Uint8Array(a.buffer),!1),this.setLoadState(o.COMPLETE_STATE)}catch(t){console.log(t.message),this.setError()}}});const ls=cs;function hs(t){Jr.call(this,t),this.addType(o.Background)}hs.prototype=Object.assign(Object.create(Jr.prototype),{constructor:hs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_bind",new Bn.SFBool),new z(o.inputOutput,"frontUrl",new Bn.MFString),new z(o.inputOutput,"backUrl",new Bn.MFString),new z(o.inputOutput,"leftUrl",new Bn.MFString),new z(o.inputOutput,"rightUrl",new Bn.MFString),new z(o.inputOutput,"topUrl",new Bn.MFString),new z(o.inputOutput,"bottomUrl",new Bn.MFString),new z(o.inputOutput,"skyAngle",new Bn.MFFloat),new z(o.inputOutput,"skyColor",new Bn.MFColor(new Bn.SFColor)),new z(o.inputOutput,"groundAngle",new Bn.MFFloat),new z(o.inputOutput,"groundColor",new Bn.MFColor),new z(o.inputOutput,"transparency",new Bn.SFFloat),new z(o.outputOnly,"isBound",new Bn.SFBool),new z(o.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"Background"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){Jr.prototype.initialize.call(this);const t=new ls(this.getExecutionContext()),e=new ls(this.getExecutionContext()),n=new ls(this.getExecutionContext()),i=new ls(this.getExecutionContext()),o=new ls(this.getExecutionContext()),r=new ls(this.getExecutionContext()),s=this.getBrowser().getBackgroundTextureProperties();this._frontUrl.addFieldInterest(t._url),this._backUrl.addFieldInterest(e._url),this._leftUrl.addFieldInterest(n._url),this._rightUrl.addFieldInterest(i._url),this._topUrl.addFieldInterest(o._url),this._bottomUrl.addFieldInterest(r._url),t._url=this._frontUrl,e._url=this._backUrl,n._url=this._leftUrl,i._url=this._rightUrl,o._url=this._topUrl,r._url=this._bottomUrl,t._textureProperties=s,e._textureProperties=s,n._textureProperties=s,i._textureProperties=s,o._textureProperties=s,r._textureProperties=s,t.setup(),e.setup(),n.setup(),i.setup(),o.setup(),r.setup(),this.set_frontTexture__(t),this.set_backTexture__(e),this.set_leftTexture__(n),this.set_rightTexture__(i),this.set_topTexture__(o),this.set_bottomTexture__(r)}});const ds=hs;var fs=new Ne;function ps(t,e,n){ji.call(this,t),fr.call(this,t),this.addType(o.X3DLayerNode),this.groupNode=n,this.currentViewport=null,this.defaultNavigationInfo=new Ir(t),this.defaultViewpoint=e,this.defaultBackground=new ds(t),this.defaultFog=new Xr(t),this.navigationInfoStack=new Er(t,this.defaultNavigationInfo),this.viewpointStack=new Er(t,this.defaultViewpoint),this.backgroundStack=new Er(t,this.defaultBackground),this.fogStack=new Er(t,this.defaultFog),this.navigationInfos=new Or(t,this.defaultNavigationInfo),this.viewpoints=new Or(t,this.defaultViewpoint),this.backgrounds=new Or(t,this.defaultBackground),this.fogs=new Or(t,this.defaultFog),this.defaultBackground.setHidden(!0),this.defaultFog.setHidden(!0),this.collisionTime=0}ps.prototype=Object.assign(Object.create(ji.prototype),fr.prototype,{constructor:ps,layer0:!1,initialize:function(){ji.prototype.initialize.call(this),fr.prototype.initialize.call(this),this.defaultNavigationInfo.setup(),this.defaultViewpoint.setup(),this.defaultBackground.setup(),this.defaultFog.setup(),this.navigationInfoStack.setup(),this.viewpointStack.setup(),this.backgroundStack.setup(),this.fogStack.setup(),this.navigationInfos.setup(),this.viewpoints.setup(),this.backgrounds.setup(),this.fogs.setup(),this._viewport.addInterest("set_viewport__",this),this.set_viewport__()},isLayer0:function(t){this.layer0=t,this.defaultBackground.setHidden(!t)},getLayer:function(){return this},getGroup:function(){return this.groupNode},getViewport:function(){return this.currentViewport},getBackground:function(){return this.backgroundStack.top()},getFog:function(){return this.fogStack.top()},getNavigationInfo:function(){return this.navigationInfoStack.top()},getViewpoint:function(){return this.viewpointStack.top()},getBackgrounds:function(){return this.backgrounds},getFogs:function(){return this.fogs},getNavigationInfos:function(){return this.navigationInfos},getViewpoints:function(){return this.viewpoints},getUserViewpoints:function(){for(var t=[],e=0;e<this.viewpoints.get().length;++e){var n=this.viewpoints.get()[e];n._description.length&&t.push(n)}return t},getBackgroundStack:function(){return this.backgroundStack},getFogStack:function(){return this.fogStack},getNavigationInfoStack:function(){return this.navigationInfoStack},getViewpointStack:function(){return this.viewpointStack},getBBox:function(t,e){return this.groupNode.getBBox(t,e)},lookAt:function(t,e){this.getViewpoint().lookAtBBox(this.getBBox(new ur),t,e)},set_viewport__:function(){this.currentViewport=mr(o.X3DViewportNode,this._viewport),this.currentViewport||(this.currentViewport=this.getBrowser().getDefaultViewport())},bindBindables:function(t){this.traverse(ir.CAMERA,this);const e=this.navigationInfos.getBound(),n=this.backgrounds.getBound(),i=this.fogs.getBound(),o=this.viewpoints.getBound(t);this.navigationInfoStack.pushOnTop(e),this.viewpointStack.pushOnTop(o),this.backgroundStack.pushOnTop(n),this.fogStack.pushOnTop(i),o.resetUserOffsets()},traverse:function(t,e){e=e||this;var n=this.getViewpoint();switch(this.getProjectionMatrix().pushMatrix(n.getProjectionMatrix(this)),this.getCameraSpaceMatrix().pushMatrix(n.getCameraSpaceMatrix()),this.getViewMatrix().pushMatrix(n.getViewMatrix()),t){case ir.POINTER:this.pointer(t,e);break;case ir.CAMERA:this.camera(t,e);break;case ir.PICKING:this.picking(t,e);break;case ir.COLLISION:this.collision(t,e);break;case ir.SHADOW:case ir.DISPLAY:this.display(t,e)}this.getViewMatrix().pop(),this.getCameraSpaceMatrix().pop(),this.getProjectionMatrix().pop()},pointer:function(t,e){if(this._isPickable.getValue()){var n=this.getBrowser(),i=this.currentViewport.getRectangle(n);if(n.getSelectedLayer()){if(n.getSelectedLayer()!==this)return}else if(!n.isPointerInRectangle(i))return;n.setHitRay(this.getProjectionMatrix().get(),i),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),this.groupNode.traverse(t,e),this.currentViewport.pop(this),this.getModelViewMatrix().pop()}},camera:function(t,e){this.getModelViewMatrix().pushMatrix(Ne.Identity),this.currentViewport.push(this),this.groupNode.traverse(t,e),this.currentViewport.pop(this),this.getModelViewMatrix().pop(),this.navigationInfos.update(this,this.navigationInfoStack),this.viewpoints.update(this,this.viewpointStack),this.backgrounds.update(this,this.backgroundStack),this.fogs.update(this,this.fogStack),this.getViewpoint().update()},picking:function(t,e){this.getModelViewMatrix().pushMatrix(Ne.Identity),this.currentViewport.push(this),this.groupNode.traverse(t,e),this.currentViewport.pop(this),this.getModelViewMatrix().pop()},collision:function(t,e){var n=this.getNavigationInfo();if(!n._transitionActive.getValue()){var i=n.getCollisionRadius(),o=n.getAvatarHeight(),r=Math.max(2*i,2*o);this.collisionTime=0,sr.ortho(-r,r,-r,r,-r,r,fs),this.getProjectionMatrix().pushMatrix(fs),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),e.render(t,this.groupNode.traverse,this.groupNode),this.currentViewport.pop(this),this.getModelViewMatrix().pop(),this.getProjectionMatrix().pop()}},display:function(t,e){this.getNavigationInfo().enable(t,e),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),e.render(t,this.groupNode.traverse,this.groupNode),this.currentViewport.pop(this),this.getModelViewMatrix().pop()}});const gs=ps;function ms(t){gr.call(this,t),this.addType(o.X3DSensorNode)}ms.prototype=Object.assign(Object.create(gr.prototype),{constructor:ms});const _s=ms;function xs(t){this.addType(o.X3DTimeDependentNode),this.addChildObjects("initialized",new Bn.SFTime,"isEvenLive",new Bn.SFBool),this.startTimeValue=0,this.pauseTimeValue=0,this.resumeTimeValue=0,this.stopTimeValue=0,this.start=0,this.pause=0,this.pauseInterval=0,this.startTimeout=null,this.pauseTimeout=null,this.resumeTimeout=null,this.stopTimeout=null,this.disabled=!1}xs.prototype=Object.assign(Object.create(gr.prototype),{constructor:xs,initialize:function(){this.isLive().addInterest("set_live__",this),this._isEvenLive.addInterest("set_live__",this),this._initialized.addInterest("set_loop__",this),this._enabled.addInterest("set_enabled__",this),this._loop.addInterest("set_loop__",this),this._startTime.addInterest("set_startTime__",this),this._pauseTime.addInterest("set_pauseTime__",this),this._resumeTime.addInterest("set_resumeTime__",this),this._stopTime.addInterest("set_stopTime__",this),this.startTimeValue=this._startTime.getValue(),this.pauseTimeValue=this._pauseTime.getValue(),this.resumeTimeValue=this._resumeTime.getValue(),this.stopTimeValue=this._stopTime.getValue(),this._initialized=this.getBrowser().getCurrentTime()},getDisabled:function(){return this.disabled},getLiveState:function(){return this.getLive()&&(this.getExecutionContext().isLive().getValue()||this._isEvenLive.getValue())},getElapsedTime:function(){return this.getBrowser().getCurrentTime()-this.start-this.pauseInterval},resetElapsedTime:function(){this.start=this.getBrowser().getCurrentTime(),this.pause=this.getBrowser().getCurrentTime(),this.pauseInterval=0},set_live__:function(){this.isLive().getValue()||this._isEvenLive.getValue()?this.disabled&&(this.disabled=!1,this._isActive.getValue()&&!this._isPaused.getValue()&&this.real_resume()):this.disabled||!this._isActive.getValue()||this._isPaused.getValue()||(this.disabled=!0,this.real_pause())},set_enabled__:function(){this._enabled.getValue()?this.set_loop__():this.stop()},set_loop__:function(){this._enabled.getValue()&&this._loop.getValue()&&this.stopTimeValue<=this.startTimeValue&&this.startTimeValue<=this.getBrowser().getCurrentTime()&&this.do_start()},set_startTime__:function(){this.startTimeValue=this._startTime.getValue(),this._enabled.getValue()&&(this.removeTimeout("startTimeout"),this.startTimeValue<=this.getBrowser().getCurrentTime()?this.do_start():this.addTimeout("startTimeout","do_start",this.startTimeValue))},set_pauseTime__:function(){if(this.pauseTimeValue=this._pauseTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("pauseTimeout"),this.pauseTimeValue<=this.resumeTimeValue)return;this.pauseTimeValue<=this.getBrowser().getCurrentTime()?this.do_pause():this.addTimeout("pauseTimeout","do_pause",this.pauseTimeValue)}},set_resumeTime__:function(){if(this.resumeTimeValue=this._resumeTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("resumeTimeout"),this.resumeTimeValue<=this.pauseTimeValue)return;this.resumeTimeValue<=this.getBrowser().getCurrentTime()?this.do_resume():this.addTimeout("resumeTimeout","do_resume",this.resumeTimeValue)}},set_stopTime__:function(){if(this.stopTimeValue=this._stopTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("stopTimeout"),this.stopTimeValue<=this.startTimeValue)return;this.stopTimeValue<=this.getBrowser().getCurrentTime()?this.do_stop():this.addTimeout("stopTimeout","do_stop",this.stopTimeValue)}},do_start:function(){this._isActive.getValue()||(this.resetElapsedTime(),this._isActive=!0,this.set_start(),this.isLive().getValue()?this.getBrowser().timeEvents().addInterest("set_time",this):(this.disabled=!0,this.real_pause()),this._elapsedTime=0)},do_pause:function(){this._isActive.getValue()&&!this._isPaused.getValue()&&(this._isPaused=!0,this.pauseTimeValue!==this.getBrowser().getCurrentTime()&&(this.pauseTimeValue=this.getBrowser().getCurrentTime()),this.isLive().getValue()&&this.real_pause())},real_pause:function(){this.pause=performance.now(),this.set_pause(),this.getBrowser().timeEvents().removeInterest("set_time",this)},do_resume:function(){this._isActive.getValue()&&this._isPaused.getValue()&&(this._isPaused=!1,this.resumeTimeValue!==this.getBrowser().getCurrentTime()&&(this.resumeTimeValue=this.getBrowser().getCurrentTime()),this.isLive().getValue()&&this.real_resume())},real_resume:function(){const t=(performance.now()-this.pause)/1e3;this.pauseInterval+=t,this.set_resume(t),this.getBrowser().timeEvents().addInterest("set_time",this),this.getBrowser().addBrowserEvent()},do_stop:function(){this.stop()},stop:function(){this._isActive.getValue()&&(this.set_stop(),this._elapsedTime=this.getElapsedTime(),this._isPaused.getValue()&&(this._isPaused=!1),this._isActive=!1,this.getBrowser().timeEvents().removeInterest("set_time",this))},timeout:function(t){this._enabled.getValue()&&(this.getBrowser().advanceTime(performance.now()),this[t]())},addTimeout:function(t,e,n){this.removeTimeout(t),this[t]=setTimeout(this.timeout.bind(this,e),1e3*(n-this.getBrowser().getCurrentTime()))},removeTimeout:function(t){clearTimeout(this[t]),this[t]=null},set_start:function(){},set_pause:function(){},set_resume:function(){},set_stop:function(){},set_time:function(){}});const ys=xs;function ws(t){_s.call(this,t),ys.call(this,t),this.addType(o.TimeSensor),this.addChildObjects("range",new Bn.MFFloat(0,0,1)),this.cycle=0,this.interval=0,this.fraction=0,this.first=0,this.last=1,this.scale=1}ws.prototype=Object.assign(Object.create(_s.prototype),ys.prototype,{constructor:ws,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"cycleInterval",new Bn.SFTime(1)),new z(o.inputOutput,"loop",new Bn.SFBool),new z(o.inputOutput,"startTime",new Bn.SFTime),new z(o.inputOutput,"resumeTime",new Bn.SFTime),new z(o.inputOutput,"pauseTime",new Bn.SFTime),new z(o.inputOutput,"stopTime",new Bn.SFTime),new z(o.outputOnly,"isPaused",new Bn.SFBool),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"cycleTime",new Bn.SFTime),new z(o.outputOnly,"elapsedTime",new Bn.SFTime),new z(o.outputOnly,"fraction_changed",new Bn.SFFloat),new z(o.outputOnly,"time",new Bn.SFTime)]),getTypeName:function(){return"TimeSensor"},getComponentName:function(){return"Time"},getContainerField:function(){return"children"},initialize:function(){_s.prototype.initialize.call(this),ys.prototype.initialize.call(this),this._cycleInterval.addInterest("set_cycleInterval__",this),this._range.addInterest("set_range__",this)},setRange:function(t,e,n){const i=this.getBrowser().getCurrentTime(),o=this._startTime.getValue(),r=this._cycleInterval.getValue();this.first=e,this.last=n,this.scale=this.last-this.first,this.interval=r*this.scale,this.fraction=et.fract((t>=1?0:t)+(this.interval?(i-o)/this.interval:0)),this.cycle=i-(this.fraction-this.first)*r},set_cycleInterval__:function(){this._isActive.getValue()&&this.setRange(this.fraction,this._range[1],this._range[2])},set_range__:function(){this._isActive.getValue()&&(this.setRange(this._range[0],this._range[1],this._range[2]),this._isPaused.getValue()||this.set_fraction(this.getBrowser().getCurrentTime()))},set_start:function(){this.setRange(this._range[0],this._range[1],this._range[2]),this.isLive().getValue()&&(this._fraction_changed=this.fraction,this._time=this.getBrowser().getCurrentTime())},set_resume:function(t){const e=this.getBrowser().getCurrentTime(),n=this._startTime.getValue();this.setRange(this.interval?et.fract(this.fraction-(e-n)/this.interval):0,this._range[1],this._range[2])},set_fraction:function(t){this._fraction_changed=this.fraction=this.first+(this.interval?et.fract((t-this.cycle)/this.interval):0)*this.scale},set_time:function(){const t=this.getBrowser().getCurrentTime();t-this.cycle>=this.interval?this._loop.getValue()?this.interval&&(this.cycle+=this.interval*Math.floor((t-this.cycle)/this.interval),this._elapsedTime=this.getElapsedTime(),this._cycleTime=t,this.set_fraction(t)):(this._fraction_changed=this.fraction=this.last,this.stop()):(this._elapsedTime=this.getElapsedTime(),this.set_fraction(t)),this._time=t}});const Ts=ws;function Ss(t){gr.call(this,t),this.addType(o.X3DInterpolatorNode)}Ss.prototype=Object.assign(Object.create(gr.prototype),{constructor:Ss,setup:function(){this.set_key__(),this._key.length&&this.interpolate(0,0,0),gr.prototype.setup.call(this)},initialize:function(){gr.prototype.initialize.call(this),this._set_fraction.addInterest("set_fraction__",this),this._key.addInterest("set_key__",this)},set_fraction__:function(){const t=this._key,e=t.length,n=this._set_fraction.getValue();switch(e){case 0:return;case 1:return this.interpolate(0,0,0);default:{if(n<=t[0])return this.interpolate(0,1,0);const i=et.upperBound(t,0,e,n);if(i!==e){const e=i-1,o=(n-t[e])/(t[i]-t[e]);this.interpolate(e,i,et.clamp(o,0,1))}else this.interpolate(e-2,e-1,1)}}},set_key__:function(){this.set_keyValue__()},set_keyValue__:function(){},interpolate:function(){}});const bs=Ss;function vs(t){bs.call(this,t),this.addType(o.EaseInEaseOut)}vs.prototype=Object.assign(Object.create(bs.prototype),{constructor:vs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"easeInEaseOut",new Bn.MFVec2f),new z(o.outputOnly,"modifiedFraction_changed",new Bn.SFFloat)]),getTypeName:function(){return"EaseInEaseOut"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._easeInEaseOut.addInterest("set_keyValue__",this)},set_keyValue__:function(){this._easeInEaseOut.length<this._key.length&&this._easeInEaseOut.resize(this._key.length,this._easeInEaseOut.length?this._easeInEaseOut[this._easeInEaseOut.length-1]:new Bn.SFVec2f)},interpolate:function(t,e,n){let i=this._easeInEaseOut[t].y,o=this._easeInEaseOut[e].x;const r=i+o;if(r<0)this._modifiedFraction_changed=n;else{r>1&&(o/=r,i/=r);const t=1/(2-i-o);if(n<i)this._modifiedFraction_changed=t/i*n*n;else if(n<=1-o)this._modifiedFraction_changed=t*(2*n-i);else{const e=1-n;this._modifiedFraction_changed=1-t*e*e/o}}}});const Es=vs;function Cs(t){bs.call(this,t),this.addType(o.PositionInterpolator)}Cs.prototype=Object.assign(Object.create(bs.prototype),{constructor:Cs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFVec3f),new z(o.outputOnly,"value_changed",new Bn.SFVec3f)]),getTypeName:function(){return"PositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Bn.SFVec3f)},interpolate:function(){const t=new qt(0,0,0);return function(e,n,i){this._value_changed=t.assign(this._keyValue[e].getValue()).lerp(this._keyValue[n].getValue(),i)}}()});const Os=Cs;function Fs(t){bs.call(this,t),this.addType(o.OrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle")}Fs.prototype=Object.assign(Object.create(bs.prototype),{constructor:Fs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFRotation),new z(o.outputOnly,"value_changed",new Bn.SFRotation)]),getTypeName:function(){return"OrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Bn.SFRotation)},interpolate:function(){const t=new Ce(0,0,1,0),e=new Ce(0,0,1,0);return function(n,i,o){t.assign(this._keyValue[n].getValue()),e.assign(this._keyValue[i].getValue()),this._value_changed=t.slerp(e,o)}}()});const Ns=Fs;function Ms(t){Nr.call(this,t),this.addType(o.X3DViewpointNode),this.addChildObjects("positionOffset",new Bn.SFVec3f,"orientationOffset",new Bn.SFRotation,"scaleOffset",new Bn.SFVec3f(1,1,1),"scaleOrientationOffset",new Bn.SFRotation,"centerOfRotationOffset",new Bn.SFVec3f,"fieldOfViewScale",new Bn.SFFloat(1)),this.userPosition=new qt(0,1,0),this.userOrientation=new Ce(0,0,1,0),this.userCenterOfRotation=new qt(0,0,0),this.modelMatrix=new Ne,this.cameraSpaceMatrix=new Ne(1,0,0,0,0,1,0,0,0,0,1,0,0,0,10,1),this.viewMatrix=new Ne(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-10,1);const e=this.getBrowser();this.timeSensor=new Ts(e.getPrivateScene()),this.easeInEaseOut=new Es(e.getPrivateScene()),this.positionInterpolator=new Os(e.getPrivateScene()),this.orientationInterpolator=new Ns(e.getPrivateScene()),this.scaleInterpolator=new Os(e.getPrivateScene()),this.scaleOrientationInterpolator=new Ns(e.getPrivateScene())}Ms.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Ms,initialize:function(){Nr.prototype.initialize.call(this),this.timeSensor._stopTime=1,this.timeSensor.setup(),this.easeInEaseOut._key=new Bn.MFFloat(0,1),this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,0),new Bn.SFVec2f(0,0)),this.easeInEaseOut.setup(),this.positionInterpolator._key=new Bn.MFFloat(0,1),this.orientationInterpolator._key=new Bn.MFFloat(0,1),this.scaleInterpolator._key=new Bn.MFFloat(0,1),this.scaleOrientationInterpolator._key=new Bn.MFFloat(0,1),this.positionInterpolator.setup(),this.orientationInterpolator.setup(),this.scaleInterpolator.setup(),this.scaleOrientationInterpolator.setup(),this.timeSensor._isActive.addFieldInterest(this._transitionActive),this.timeSensor._fraction_changed.addFieldInterest(this.easeInEaseOut._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.positionInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.orientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleOrientationInterpolator._set_fraction),this.positionInterpolator._value_changed.addFieldInterest(this._positionOffset),this.orientationInterpolator._value_changed.addFieldInterest(this._orientationOffset),this.scaleInterpolator._value_changed.addFieldInterest(this._scaleOffset),this.scaleOrientationInterpolator._value_changed.addFieldInterest(this._scaleOrientationOffset),this._isBound.addInterest("set_bound__",this)},getEaseInEaseOut:function(){return this.easeInEaseOut},setInterpolators:function(){},getPosition:function(){return this._position.getValue()},getUserPosition:function(){return this.userPosition.assign(this.getPosition()).add(this._positionOffset.getValue())},getOrientation:function(){return this._orientation.getValue()},getUserOrientation:function(){return this.userOrientation.assign(this.getOrientation()).multRight(this._orientationOffset.getValue())},getCenterOfRotation:function(){return this._centerOfRotation.getValue()},getUserCenterOfRotation:function(){return this.userCenterOfRotation.assign(this.getCenterOfRotation()).add(this._centerOfRotationOffset.getValue())},getProjectionMatrix:function(t){const e=t.getNavigationInfo();return this.getProjectionMatrixWithLimits(e.getNearValue(),e.getFarValue(this),t.getLayer().getViewport().getRectangle(this.getBrowser()))},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getViewMatrix:function(){return this.viewMatrix},getModelMatrix:function(){return this.modelMatrix},getMaxFarValue:function(){return this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")?1e10:1e5},getUpVector:function(){return qt.yAxis},getSpeedFactor:function(){return 1},setVRMLTransition:function(t){this.VRMLTransition=t},getVRMLTransition:function(){return this.VRMLTransition},transitionStart:function(){const t=new qt(0,0,0),e=new Ce(0,0,1,0),n=new qt(0,0,0),i=new Ce(0,0,1,0);return function(o,r,s){if(this.to=s,s._jump.getValue()){if(s._retainUserOffsets.getValue()||s.resetUserOffsets(),this!==s)for(const t of s.getFields())this.getField(t.getName()).assign(t);const a=o.getNavigationInfo(),u=a._transitionTime.getValue();let c=a.getTransitionType();switch("2.0"==this.getExecutionContext().getSpecificationVersion()&&(c=s.getVRMLTransition()?"LINEAR":"TELEPORT"),s.setVRMLTransition(!1),u<=0&&(c="TELEPORT"),c){case"TELEPORT":return void(a._transitionComplete=!0);case"ANIMATE":this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,1),new Bn.SFVec2f(1,0));break;default:this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,0),new Bn.SFVec2f(0,0))}this.timeSensor._cycleInterval=u,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,a),s.getRelativeTransformation(r,t,e,n,i),this.positionInterpolator._keyValue=new Bn.MFVec3f(t,s._positionOffset),this.orientationInterpolator._keyValue=new Bn.MFRotation(e,s._orientationOffset),this.scaleInterpolator._keyValue=new Bn.MFVec3f(n,s._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Bn.MFRotation(i,s._scaleOrientationOffset),this._positionOffset=t,this._orientationOffset=e,this._scaleOffset=n,this._scaleOrientationOffset=i,this.setInterpolators(r,s),this._transitionActive=!0}else s.getRelativeTransformation(r,t,e,n,i),s._positionOffset=t,s._orientationOffset=e,s._scaleOffset=n,s._scaleOrientationOffset=i,s.setInterpolators(r,s)}}(),transitionStop:function(){this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.removeInterest("set_active__",this)},resetUserOffsets:function(){this._positionOffset=qt.Zero,this._orientationOffset=Ce.Identity,this._scaleOffset=qt.One,this._scaleOrientationOffset=Ce.Identity,this._centerOfRotationOffset=qt.Zero,this._fieldOfViewScale=1},getRelativeTransformation:function(t,e,n,i,o){this.modelMatrix.copy().multRight(t.getViewMatrix()).inverse().get(e,n,i,o),e.subtract(this.getPosition()),n.assign(this.getOrientation().copy().inverse().multRight(n))},lookAtPoint:function(t,e,n,i){this.getCameraSpaceMatrix().multVecMatrix(e),Ne.inverse(this.getModelMatrix()).multVecMatrix(e);const o=2*t.getNavigationInfo().getNearValue();this.lookAt(t,e,o,n,i)},lookAtBBox:function(t,e,n,i){e=e.copy().multRight(Ne.inverse(this.getModelMatrix()));const o=2*t.getNavigationInfo().getNearValue();this.lookAt(t,e.center,o,n,i)},lookAt:function(t,e,n,i,o){const r=e.copy().add(this.getUserOrientation().multVecRot(new qt(0,0,n))).subtract(this.getPosition());t.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=.2,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,t.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,1),new Bn.SFVec2f(1,0));const s=qt.lerp(this._positionOffset.getValue(),r,i),a=qt.add(this.getPosition(),s).subtract(e);let u=Ce.multRight(this._orientationOffset.getValue(),new Ce(this.getUserOrientation().multVecRot(new qt(0,0,1)),a));o&&(u=Ce.inverse(this.getOrientation()).multRight(this.straightenHorizon(Ce.multRight(this.getOrientation(),u)))),this.positionInterpolator._keyValue=new Bn.MFVec3f(this._positionOffset,s),this.orientationInterpolator._keyValue=new Bn.MFRotation(this._orientationOffset,u),this.scaleInterpolator._keyValue=new Bn.MFVec3f(this._scaleOffset,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Bn.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset),this.setInterpolators(this,this),this._centerOfRotationOffset=qt.subtract(e,this.getCenterOfRotation()),this._set_bind=!0},straighten:function(t,e){t.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=.4,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,t.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,1),new Bn.SFVec2f(1,0));const n=Ce.multRight(Ce.inverse(this.getOrientation()),this.straightenHorizon(this.getUserOrientation()));this.positionInterpolator._keyValue=new Bn.MFVec3f(this._positionOffset,this._positionOffset),this.orientationInterpolator._keyValue=new Bn.MFRotation(this._orientationOffset,n),this.scaleInterpolator._keyValue=new Bn.MFVec3f(this._scaleOffset,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Bn.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset),this.setInterpolators(this,this),this._set_bind=!0},straightenHorizon:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new Ce(0,0,1,0);return function(i,o=this.getUpVector()){i.multVecRot(t.assign(qt.xAxis).negate()),i.multVecRot(e.assign(qt.zAxis));const r=e.cross(o);return Math.abs(e.dot(o))>=1||Math.abs(r.dot(t))>=1?i:(n.setFromToVec(t,r),i.multRight(n))}}(),set_active__:function(t,e){this._isBound.getValue()&&!e.getValue()&&1===this.timeSensor._fraction_changed.getValue()&&(t._transitionComplete=!0)},set_bound__:function(){this._isBound.getValue()?this.getBrowser().getNotification()._string=this._description:this.timeSensor._stopTime=this.getBrowser().getCurrentTime()},traverse:function(t,e){t===ir.CAMERA&&(e.getLayer().getViewpoints().push(this),this.modelMatrix.assign(e.getModelViewMatrix().get()))},update:function(){this.cameraSpaceMatrix.set(this.getUserPosition(),this.getUserOrientation(),this._scaleOffset.getValue(),this._scaleOrientationOffset.getValue()),this.cameraSpaceMatrix.multRight((this.to||this).modelMatrix),this.viewMatrix.assign(this.cameraSpaceMatrix).inverse()}});const Vs=Ms;function Is(t){bs.call(this,t),this.addType(o.ScalarInterpolator)}Is.prototype=Object.assign(Object.create(bs.prototype),{constructor:Is,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFFloat),new z(o.outputOnly,"value_changed",new Bn.SFFloat)]),getTypeName:function(){return"ScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:0)},interpolate:function(t,e,n){this._value_changed=et.lerp(this._keyValue[t],this._keyValue[e],n)}});const Ds=Is;function Rs(t){Vs.call(this,t),this.addType(o.Viewpoint),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("angle"),this.projectionMatrix=new Ne,this.fieldOfViewInterpolator=new Ds(this.getBrowser().getPrivateScene())}Rs.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Rs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_bind",new Bn.SFBool),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"position",new Bn.SFVec3f(0,0,10)),new z(o.inputOutput,"orientation",new Bn.SFRotation),new z(o.inputOutput,"centerOfRotation",new Bn.SFVec3f),new z(o.inputOutput,"fieldOfView",new Bn.SFFloat(.7854)),new z(o.inputOutput,"jump",new Bn.SFBool(!0)),new z(o.inputOutput,"retainUserOffsets",new Bn.SFBool),new z(o.outputOnly,"isBound",new Bn.SFBool),new z(o.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"Viewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Vs.prototype.initialize.call(this),this.fieldOfViewInterpolator._key=new Bn.MFFloat(0,1),this.fieldOfViewInterpolator.setup(),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewInterpolator._set_fraction),this.fieldOfViewInterpolator._value_changed.addFieldInterest(this._fieldOfViewScale)},setInterpolators:function(t,e){if(t.getType().includes(o.Viewpoint)||t.getType().includes(o.GeoViewpoint)){const n=t.getFieldOfView()/e.getFieldOfView();this.fieldOfViewInterpolator._keyValue=new Bn.MFFloat(n,e._fieldOfViewScale.getValue()),this._fieldOfViewScale=n}else this.fieldOfViewInterpolator._keyValue=new Bn.MFFloat(e._fieldOfViewScale.getValue(),e._fieldOfViewScale.getValue()),this._fieldOfViewScale=e._fieldOfViewScale.getValue()},getLogarithmicDepthBuffer:function(){return!1},getFieldOfView:function(){const t=this._fieldOfView.getValue()*this._fieldOfViewScale.getValue();return t>0&&t<Math.PI?t:Math.PI/4},getScreenScale:function(t,e,n){const i=e[2],o=e[3];let r=Math.abs(t.z)*Math.tan(this.getFieldOfView()/2)*2;return r/=i>o?o:i,n.set(r,r,r)},getViewportSize:function(){const t=new jt(0,0);return function(e,n){const i=e[2],o=e[3],r=n*Math.tan(this.getFieldOfView()/2)*2,s=i/o;return s>1?t.set(r*s,r):t.set(r,r/s)}}(),getLookAtDistance:function(t){return t.size.magnitude()/2/Math.tan(this.getFieldOfView()/2)},getProjectionMatrixWithLimits:function(t,e,n){return sr.perspective(this.getFieldOfView(),t,e,n[2],n[3],this.projectionMatrix)}});const Ps=Rs;function As(t){Tr.call(this,t),this.addType(o.Group)}As.prototype=Object.assign(Object.create(Tr.prototype),{constructor:As,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Group"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"}});const Ls=As;function Bs(t){gs.call(this,t,new Ps(t),new Ls(t)),this.addType(o.Layer)}Bs.prototype=Object.assign(Object.create(gs.prototype),{constructor:Bs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"isPickable",new Bn.SFBool(!0)),new z(o.inputOutput,"viewport",new Bn.SFNode),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Layer"},getComponentName:function(){return"Layering"},getContainerField:function(){return"layers"},initialize:function(){gs.prototype.initialize.call(this),this._addChildren.addFieldInterest(this.getGroup()._addChildren),this._removeChildren.addFieldInterest(this.getGroup()._removeChildren),this._children.addFieldInterest(this.getGroup()._children),this.getGroup()._children=this._children,this.getGroup().setPrivate(!0),this.getGroup().setup()}});const Xs=Bs;function Us(t){ji.call(this,t),this.addType(o.LayerSet),this.layerNodes=[new Xs(t)],this.layerNode0=this.layerNodes[0],this.activeLayerNode=null}Us.prototype=Object.assign(Object.create(ji.prototype),{constructor:Us,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"activeLayer",new Bn.SFInt32),new z(o.inputOutput,"order",new Bn.MFInt32(0)),new z(o.inputOutput,"layers",new Bn.MFNode)]),getTypeName:function(){return"LayerSet"},getComponentName:function(){return"Layering"},getContainerField:function(){return"children"},initialize:function(){ji.prototype.initialize.call(this),this.layerNode0.setPrivate(!0),this.layerNode0.setup(),this.layerNode0.isLayer0(!0),this._activeLayer.addInterest("set_activeLayer__",this),this._order.addInterest("set_layers__",this),this._layers.addInterest("set_layers__",this),this.set_layers__()},getActiveLayer:function(){return this.activeLayerNode},setLayer0:function(t){this.layerNode0=t,this.set_layers__()},getLayer0:function(){return this.layerNode0},getLayers:function(){return this.layerNodes},set_activeLayer__:function(){if(0===this._activeLayer.getValue())this.activeLayerNode!==this.layerNode0&&(this.activeLayerNode=this.layerNode0);else{const t=this._activeLayer-1;t>=0&&t<this._layers.length?this.activeLayerNode!==this._layers[t].getValue()&&(this.activeLayerNode=mr(o.X3DLayerNode,this._layers[t])):null!==this.activeLayerNode&&(this.activeLayerNode=null)}},set_layers__:function(){const t=this._layers.getValue();this.layerNodes.length=0;for(let e of this._order)if(0===e)this.layerNodes.push(this.layerNode0);else if(--e,e>=0&&e<t.length){const n=mr(o.X3DLayerNode,t[e]);n&&this.layerNodes.push(n)}this.set_activeLayer__()},bindBindables:function(t){const e=this._layers.getValue();this.layerNode0.bindBindables(t);for(let n=0,i=e.length;n<i;++n){const i=mr(o.X3DLayerNode,e[n]);i&&i.bindBindables(t)}},traverse:function(t,e){const n=this.layerNodes;if(t===ir.POINTER)for(let i=0,o=n.length;i<o;++i)this.getBrowser().setLayerNumber(i),n[i].traverse(t,e);else for(const i of n)i.traverse(t,e)}});const zs=Us;function js(t){Zn.call(this,t),this.addType(o.X3DWorld),this.addChildObjects("activeLayer",new Ue(this.layer0)),this.defaultLayerSet=new zs(t),this.layerSet=this.defaultLayerSet,this.layer0=new Xs(t)}Bi.addAbstractType("X3DWorld",js),js.prototype=Object.assign(Object.create(Zn.prototype),{constructor:js,getTypeName:function(){return"X3DWorld"},initialize:function(){Zn.prototype.initialize.call(this),this.layerSet.setPrivate(!0),this.layerSet.setup(),this.layerSet.setLayer0(this.layer0),this.layerSet._activeLayer.addInterest("set_rootNodes__",this),this.getExecutionContext().getRootNodes().addInterest("set_rootNodes__",this),this.set_rootNodes__(),this.layer0.setPrivate(!0),this.layer0.isLayer0(!0),this.layer0.setup(),this.set_activeLayer__()},getCache:function(){return!0},getLayerSet:function(){return this.layerSet},getActiveLayer:function(){return this._activeLayer.getValue()},set_rootNodes__:function(){const t=this.layerSet,e=this.getExecutionContext().getRootNodes();this.layerSet=this.defaultLayerSet,this.layer0._children=e;for(const t of e){const e=mr(o.LayerSet,t);e&&(this.layerSet=e)}this.layerSet!==t&&(this.layerSet.setLayer0(this.layer0),t._activeLayer.removeInterest("set_activeLayer__",this),this.layerSet._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__())},set_activeLayer__:function(){this._activeLayer=this.layerSet.getActiveLayer()},bindBindables:function(){const t=this.getExecutionContext().getWorldURL();this.layerSet.bindBindables(decodeURIComponent(new URL(t,t).hash.substr(1)))},traverse:function(t,e){this.layerSet.traverse(t,e)}});for(const t of Reflect.ownKeys(js.prototype))Object.defineProperty(js.prototype,t,{enumerable:!1});const ks=js;!function(t){t.ajaxTransport("+binary",(function(t,e,n){if(t.dataType&&"binary"==t.dataType)return{send:function(e,n){const i=t.xhr();if(i.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(const e in t.xhrFields)i[e]=t.xhrFields[e];t.mimeType&&i.overrideMimeType&&i.overrideMimeType(t.mimeType);for(const t in e)i.setRequestHeader(t,e[t]);i.onload=function(){i.onload=i.onerror=null;const e={};e[t.dataType]=i.response,n(i.status||200,i.statusText,e,i.getAllResponseHeaders())},i.onerror=function(){i.onload=i.onerror=null,n(i.status||404,i.statusText)},i.responseType=t.responseType||"blob",i.send(t.hasContent&&t.data||null)},abort:function(){const e=t.xhr();e.onload=e.onerror=null,e.abort()}}}))}($);Symbol.for("X_ITE.dom");const Gs=/^\s*(?:vrmlscript|javascript|ecmascript)\:([^]*)$/,Hs=/^data:(.*?)(?:;charset=(.*?))?(?:;(base64))?,([^]*)$/,qs=/^(?:(.*?);(.*?)$)/,Ys=new RegExp(".(?:html|xhtml)$"),Ws={"text/html":!0,"application/xhtml+xml":!0},$s=new Bn.MFString;function Ks(t,e){f.call(this),this.node=t,this.browser=t.getBrowser(),this.external=void 0===e?this.browser.isExternal():e,this.executionContext=this.external?t.getExecutionContext():this.browser.currentScene,this.userAgent=this.browser.getName()+"/"+this.browser.getVersion()+" (X3D Browser; +"+this.browser.getProviderUrl()+")",this.target="",this.url=[],this.URL=new URL(this.getReferer(),this.getReferer()),this.fileReader=new FileReader,this.text=!0}Ks.prototype=Object.assign(Object.create(f.prototype),{constructor:Ks,abort:function(){this.callback=Function.prototype,this.bindViewpoint=Function.prototype,this.foreign=Function.prototype},isPrivate:function(){return!0},getWorldURL:function(){return this.URL},createX3DFromString:function(t,e,n,i){try{const o=this.browser.createScene();return this.node instanceof ks?o.loader=this:o.setExecutionContext(this.executionContext),o.setWorldURL(decodeURI(new URL(t,this.getReferer()).href)),n&&(n=this.setScene.bind(this,o,n,i)),new Xo(o).parseIntoScene(e,n,i),o}catch(t){if(!i)throw i;i(t)}},setScene:function(t,e,n){t._initLoadCount.addInterest("set_initLoadCount__",this,t,e,n),t._initLoadCount.addEvent()},set_initLoadCount__:function(t,e,n,i){if(!i.getValue()){t._initLoadCount.removeInterest("set_initLoadCount__",this),delete t.loader;try{e(t)}catch(t){if(!n)throw t;n(t)}Jn}},createX3DFromURL:function(t,e,n,i,o){return this.bindViewpoint=i,this.foreign=o,this.target=this.getTarget(e||$s),n?this.loadDocument(t,this.createX3DFromURLAsync.bind(this,n)):this.createX3DFromURLSync(t)},createX3DFromURLAsync:function(t,e){null===e?t(null,this.URL):this.createX3DFromString(this.URL,e,t,this.loadDocumentError.bind(this))},createX3DFromURLSync:function(t){if(0===t.length)throw new Error("No URL given.");let e=null,n=!1;for(const i of t)if(this.URL=new URL(i,this.getReferer()),$.ajax({url:decodeURI(this.URL.href),dataType:"text",async:!1,cache:this.browser.getBrowserOptions().getCache()&&this.node.getCache(),global:!1,context:this,success:function(t){try{e=this.createX3DFromString(this.URL,t),n=!0}catch(t){this.error(t)}},error:function(t,e,n){}}),n)return e;throw new Error("Couldn't load any url of '"+Array.prototype.join.call(t,", ")+"'.")},loadScript:function(t,e){this.script=!0,this.loadDocument(t,e)},loadDocument:function(t,e){if(this.url=t.copy(),this.callback=e,0===t.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift())},loadBinaryDocument:function(t,e){if(this.url=t.copy(),this.callback=e,this.text=!1,0===t.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift())},getTarget:function(t){for(const e of t){const t=e.split("=");if(2===t.length&&"target"===t[0])return t[1]}return""},loadDocumentAsync:function(t){try{if(0===t.length)return void this.loadDocumentError(new Error("URL is empty."));if(this.script){const e=Gs.exec(t);if(e)return void this.callback(e[1])}{const e=Hs.exec(t);if(e){let t=e[4];return t="base64"===e[3]?atob(t):unescape(t),void this.callback(t)}}if(this.URL=new URL(t,this.getReferer()),this.bindViewpoint&&this.URL.href.substr(0,this.getReferer().length)===this.getReferer())return void this.bindViewpoint(decodeURIComponent(this.URL.hash.substr(1)));if(this.foreign){if(this.target.length&&"_self"!==this.target)return this.foreign(this.URL.href,this.target);if(this.URL.href.match(Ys))return this.foreign(this.URL.href,this.target)}$.ajax({url:decodeURI(this.URL.href),dataType:"binary",async:!0,cache:this.browser.getBrowserOptions().getCache()&&this.node.getCache(),global:!1,context:this,success:function(t,e,n){if(this.foreign&&Ws[this.getContentType(n)])return this.foreign(this.URL.href,this.target);this.text?(this.fileReader.onload=this.readAsArrayBuffer.bind(this,t),this.fileReader.readAsArrayBuffer(t)):(this.fileReader.onload=this.readAsBinaryString.bind(this),this.fileReader.readAsBinaryString(t))},error:function(t,e,n){this.loadDocumentError(new Error(n))}})}catch(t){return void this.loadDocumentError(t)}},readAsArrayBuffer:function(t){try{this.callback(pako.ungzip(this.fileReader.result,{to:"string"}),this.URL)}catch(e){this.fileReader.onload=this.readAsText.bind(this,t),this.fileReader.readAsText(t)}},readAsText:function(t){try{this.callback(this.fileReader.result,this.URL)}catch(t){this.loadDocumentError(t)}},readAsBinaryString:function(){try{this.callback(this.fileReader.result,this.URL)}catch(t){this.loadDocumentError(t)}},loadDocumentError:function(t){this.error(t),this.url.length?this.loadDocumentAsync(this.url.shift()):this.callback(null)},error:function(t){"data:"===this.URL.protocol?console.warn("Couldn't load URL 'data':",t.message):console.warn("Couldn't load URL '"+decodeURI(this.URL.href)+"':",t.message)},getReferer:function(){return"X3DWorld"===this.node.getTypeName()&&this.external?this.browser.getLocation():this.executionContext.getWorldURL()},getContentType:function(t){const e=t.getResponseHeader("Content-Type"),n=qs.exec(e);return n?n[1]:""}});for(const t of Reflect.ownKeys(Ks.prototype))Object.defineProperty(Ks.prototype,t,{enumerable:!1});const Qs=Ks;Bi.addAbstractType("X3DExternProtoDeclaration",ta);const Zs=Symbol(),Js=Symbol();function ta(t,e){uo.call(this,t),xo.call(this,t),this.addType(o.X3DExternProtoDeclaration),this.addChildObjects("load",new Bn.SFBool(!0),"url",e.copy(),"autoRefresh",new Bn.SFTime,"autoRefreshTimeLimit",new Bn.SFTime(3600))}ta.prototype=Object.assign(Object.create(uo.prototype),xo.prototype,{constructor:ta,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode)]),getTypeName:function(){return"X3DExternProtoDeclaration"},initialize:function(){uo.prototype.initialize.call(this),xo.prototype.initialize.call(this)},set_live__:function(){xo.prototype.set_live__.call(this),this.checkLoadState()===o.COMPLETE_STATE&&this[Js].setLive(this.isLive().getValue())},canUserDefinedFields:function(){return!0},setProtoDeclaration:function(t){if(this[Zs]=t,t){for(const t of this.getUserDefinedFields())this.removeUserDefinedField(t.getName());for(const e of t.getUserDefinedFields())this.addUserDefinedField(e.getAccessType(),e.getName(),e)}this.updateInstances()},getProtoDeclaration:function(){return this[Zs]},loadNow:function(){this.getScene().addInitLoadCount(this),new Qs(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},setInternalSceneAsync:function(t){t?this.setInternalScene(t):this.setError(new Error("File could not be loaded.")),this.getScene().removeInitLoadCount(this)},setInternalScene:function(t){this[Js]=t;const e=decodeURIComponent(new URL(this[Js].getWorldURL()).hash.substr(1)),n=e?this[Js].protos.get(e):this[Js].protos[0];if(!n)throw new Error("PROTO not found");this[Js].setLive(this.isLive().getValue()),this[Js].setPrivate(this.getScene().isPrivate()),this[Js].setExecutionContext(this.getExecutionContext()),this.setLoadState(o.COMPLETE_STATE),this.setProtoDeclaration(n)},getInternalScene:function(){return this[Js]},setError:function(t){console.error("Error loading extern prototype:",t),this[Js]=this.getBrowser().getPrivateScene(),this.setLoadState(o.FAILED_STATE),this.setProtoDeclaration(null)},toVRMLStream:function(t){const e=s.Get(t);t.string+=e.Indent(),t.string+="EXTERNPROTO",t.string+=" ",t.string+=this.getName(),t.string+=" ",t.string+="[";const n=this.getUserDefinedFields();let i=0,o=0;if(0===n.length)t.string+=" ";else{for(const t of n)i=Math.max(i,t.getTypeName().length),o=Math.max(o,e.AccessType(t.getAccessType()).length);t.string+="\n",e.IncIndent();for(const e of n)this.toVRMLStreamUserDefinedField(t,e,i,o),t.string+="\n";e.DecIndent(),t.string+=e.Indent()}t.string+="]",t.string+="\n",t.string+=e.Indent(),this._url.toVRMLStream(t)},toVRMLStreamUserDefinedField:function(t,e,n,i){const o=s.Get(t);t.string+=o.Indent(),t.string+=o.PadRight(o.AccessType(e.getAccessType()),i),t.string+=" ",t.string+=o.PadRight(e.getTypeName(),n),t.string+=" ",t.string+=e.getName()},toXMLStream:function(t){const e=s.Get(t);t.string+=e.Indent(),t.string+="<ExternProtoDeclare",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(this.getName()),t.string+="'",t.string+=" ",t.string+="url='",this._url.toXMLStream(t),t.string+="'",t.string+=">\n",e.IncIndent();const n=this.getUserDefinedFields();for(const i of n)t.string+=e.Indent(),t.string+="<field",t.string+=" ",t.string+="accessType='",t.string+=e.AccessType(i.getAccessType()),t.string+="'",t.string+=" ",t.string+="type='",t.string+=i.getTypeName(),t.string+="'",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(i.getName()),t.string+="'",t.string+="/>\n";e.DecIndent(),t.string+=e.Indent(),t.string+="</ExternProtoDeclare>"}});for(const t of Reflect.ownKeys(ta.prototype))Object.defineProperty(ta.prototype,t,{enumerable:!1});Object.defineProperty(ta.prototype,"name",{get:function(){return this.getName()},enumerable:!0,configurable:!1}),Object.defineProperty(ta.prototype,"fields",{get:function(){return this.getFieldDefinitions()},enumerable:!0,configurable:!1}),Object.defineProperty(ta.prototype,"isExternProto",{get:function(){return!0},enumerable:!0,configurable:!1}),Object.defineProperty(ta.prototype,"urls",{get:function(){return this._url},enumerable:!0,configurable:!1}),Object.defineProperty(ta.prototype,"loadState",{get:function(){return this.checkLoadState()},enumerable:!0,configurable:!1});const ea=ta;function na(){return q.call(this)}na.prototype=Object.assign(Object.create(q.prototype),{constructor:na,getTypeName:function(){return"RouteArray"}});for(const t of Reflect.ownKeys(na.prototype))Object.defineProperty(na.prototype,t,{enumerable:!1});const ia=na,oa=Symbol(),ra=Symbol(),sa=Symbol(),aa=Symbol(),ua=Symbol();function ca(t,e,n,i,o){f.call(this,t),this[oa]=t,this[ra]=e,this[sa]=n,this[aa]=i,this[ua]=o,n.addFieldInterest(o),n.addOutputRoute(this),o.addInputRoute(this)}ca.prototype=Object.assign(Object.create(f.prototype),{getTypeName:function(){return"X3DRoute"},getExecutionContext:function(){return this[oa]},getSourceNode:function(){return this[ra]},getSourceField:function(){return this[sa]},getDestinationNode:function(){return this[aa]},getDestinationField:function(){return this[ua]},disconnect:function(){this[sa].removeFieldInterest(this[ua]),this[sa].removeOutputRoute(this),this[ua].removeInputRoute(this)},toVRMLStream:function(t){const e=s.Get(t),n=e.LocalName(this[ra]),i=e.LocalName(this[aa]);t.string+=e.Indent(),t.string+="ROUTE",t.string+=" ",t.string+=n,t.string+=".",t.string+=this[sa].getName(),this[sa].getAccessType()===o.inputOutput&&(t.string+="_changed"),t.string+=" ",t.string+="TO",t.string+=" ",t.string+=i,t.string+=".",this[ua].getAccessType()===o.inputOutput&&(t.string+="set_"),t.string+=this[ua].getName()},toXMLStream:function(t){const e=s.Get(t),n=e.LocalName(this[ra]),i=e.LocalName(this[aa]);t.string+=e.Indent(),t.string+="<ROUTE",t.string+=" ",t.string+="fromNode='",t.string+=e.XMLEncode(n),t.string+="'",t.string+=" ",t.string+="fromField='",t.string+=e.XMLEncode(this[sa].getName()),this[sa].getAccessType()===o.inputOutput&&(t.string+="_changed"),t.string+="'",t.string+=" ",t.string+="toNode='",t.string+=e.XMLEncode(i),t.string+="'",t.string+=" ",t.string+="toField='",this[ua].getAccessType()===o.inputOutput&&(t.string+="set_"),t.string+=e.XMLEncode(this[ua].getName()),t.string+="'",t.string+="/>"},dispose:function(){this.disconnect(),this[oa].deleteRoute(this),f.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(ca.prototype))Object.defineProperty(ca.prototype,t,{enumerable:!1});Object.defineProperty(ca.prototype,"sourceNode",{get:function(){return Re.get(this[ra])},enumerable:!0,configurable:!1}),Object.defineProperty(ca.prototype,"sourceField",{get:function(){return this[sa].getName()},enumerable:!0,configurable:!1}),Object.defineProperty(ca.prototype,"destinationNode",{get:function(){return Re.get(this[aa])},enumerable:!0,configurable:!1}),Object.defineProperty(ca.prototype,"destinationField",{get:function(){return this[ua].getName()},enumerable:!0,configurable:!1});const la=ca,ha=Symbol(),da=Symbol(),fa=Symbol(),pa=Symbol(),ga=Symbol(),ma=Symbol();function _a(t){Zn.call(this,t),this.addType(o.X3DExecutionContext),this.addChildObjects("rootNodes",new Bn.MFNode,"worldInfos",new Bn.MFNode,"sceneGraph_changed",new Bn.SFTime),this._rootNodes.setAccessType(o.initializeOnly),this._rootNodes.addCloneCount(1),this[ha]=new Ui,this[da]=new Ki,this[fa]=new to,this[pa]=new Zi,this[ga]=new ia,this.addChildObjects("namedNodes_changed",new Bn.SFTime,"importedNodes_changed",new Bn.SFTime,"protos_changed",new Bn.SFTime,"externprotos_changed",new Bn.SFTime,"routes_changed",new Bn.SFTime)}Bi.addAbstractType("X3DExecutionContext",_a),_a.prototype=Object.assign(Object.create(Zn.prototype),{constructor:_a,initialize:function(){Zn.prototype.initialize.call(this),this.isScene()||this._sceneGraph_changed.addInterest("set_sceneGraph",this)},set_sceneGraph:function(){this.getExecutionContext()._sceneGraph_changed=this.getBrowser().getCurrentTime()},isScene:function(){return!1},getTypeName:function(){return"X3DExecutionContext"},[ma]:null,getOuterNode:function(){return this[ma]},setOuterNode:function(t){this[ma]=t},getSpecificationVersion:function(){return this.getExecutionContext().getSpecificationVersion()},getEncoding:function(){return this.getExecutionContext().getEncoding()},getWorldURL:function(){return this.getExecutionContext().getWorldURL()},getProfile:function(){return this.getExecutionContext().getProfile()},getComponents:function(){return this.getExecutionContext().getComponents()},fromUnit:function(t,e){return this.getExecutionContext().fromUnit(t,e)},toUnit:function(t,e){return this.getExecutionContext().toUnit(t,e)},getUnits:function(){return this.getExecutionContext().getUnits()},createNode:function(t,e=!0){if(t=String(t),!1===e){const e=this.getBrowser().getSupportedNode(t);return e?new e(this):null}{const e=this.getBrowser().getSupportedNode(t);if(!e)throw new Error("Unknown node type '"+t+"'.");const n=new e(this);return n.setup(),Re.get(n)}},createProto:function(t,e=!0){t=String(t);let n=this;for(;;){const i=n.protos.get(t);if(i)return i.createInstance(this,e);const o=n.externprotos.get(t);if(o)return o.createInstance(this,e);if(n.isScene())break;n=n.getExecutionContext()}if(!1===e)return null;throw new Error("Unknown proto or externproto type '"+t+"'.")},addNamedNode:function(t,e){if(this[ha].has(t))throw new Error("Couldn't add named node: node named '"+t+"' is already in use.");this.updateNamedNode(t,e)},updateNamedNode:function(t,e){if(t=String(t),!(e=mr(o.X3DNode,e,!1)))throw new Error("Couldn't update named node: node must be of type X3DNode.");if(e.getExecutionContext()!==this)throw new Error("Couldn't update named node: node does not belong to this execution context.");if(0===t.length)throw new Error("Couldn't update named node: node name is empty.");this.removeNamedNode(e.getName()),this.removeNamedNode(t),e.setName(t),this[ha].add(t,e),this._namedNodes_changed=this.getBrowser().getCurrentTime()},removeNamedNode:function(t){t=String(t);const e=this[ha].get(t);e&&(e.setName(""),this[ha].remove(t),this._namedNodes_changed=this.getBrowser().getCurrentTime())},getNamedNode:function(t){t=String(t);const e=this[ha].get(t);if(e)return Re.get(e);throw new Error("Named node '"+t+"' not found.")},getNamedNodes:function(){return this[ha]},getUniqueName:function(t=""){return xa.call(this,ha,t)},addImportedNode:function(t,e,n){if(void 0===n&&(n=e),e=String(e),n=String(n),this[da].has(n))throw new Error("Couldn't add imported node: imported name '"+n+"' already in use.");this.updateImportedNode(t,e,n)},updateImportedNode:function(t,e,n){if(t=mr(o.Inline,t,!1),e=String(e),n=void 0===n?e:String(n),!t)throw new Error("Node must be of type Inline node.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update imported node: Inline node does not belong to this execution context.");if(0===e.length)throw new Error("Couldn't update imported node: exported name is empty.");if(0===n.length)throw new Error("Couldn't update imported node: imported name is empty.");this.removeImportedNode(n);const i=new Wi(this,t,e,n);this[da].add(n,i),i.setup(),this._importedNodes_changed=this.getBrowser().getCurrentTime()},removeImportedNode:function(t){t=String(t);const e=this[da].get(t);e&&(e.dispose(),this[da].remove(t),this._importedNodes_changed=this.getBrowser().getCurrentTime())},getImportedNode:function(t){t=String(t);const e=this[da].get(t);if(e)return Re.get(e.getExportedNode());throw new Error("Imported node '"+t+"' not found.")},getImportedNodes:function(){return this[da]},getLocalNode:function(t){t=String(t);try{return this.getNamedNode(t)}catch(e){const n=this[da].get(t);if(n)return Re.get(n);throw new Error("Unknown named or imported node '"+t+"'.")}},getLocalName:function(t){if(!(t=mr(o.X3DNode,t,!1)))throw new Error("Couldn't get local name: node must be of type X3DNode.");if(t.getExecutionContext()===this)return t.getName();for(const e of this[da])try{if(e.getExportedNode()===t)return e.getImportedName()}catch(t){}throw new Error("Couldn't get local name: node is shared.")},setRootNodes:function(){},getRootNodes:function(){return this._rootNodes},getProtoDeclaration:function(t){t=String(t);const e=this[fa].get(t);if(e)return e;throw new Error("Proto declaration '"+t+"' not found.")},addProtoDeclaration(t,e){if(t=String(t),!(e instanceof ho))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(this[fa].get(t))throw new Error("Couldn't add proto declaration: proto '"+t+"' already in use.");if(0===(t=String(t)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[fa].add(t,e),e.setName(t),this._protos_changed=this.getBrowser().getCurrentTime()},updateProtoDeclaration(t,e){if(t=String(t),!(e instanceof ho))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(0===(t=String(t)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[fa].update(e.getName(),t,e),e.setName(t),this._protos_changed=this.getBrowser().getCurrentTime()},removeProtoDeclaration(t){t=String(t),this[fa].remove(t),this._protos_changed=this.getBrowser().getCurrentTime()},getProtoDeclarations:function(){return this[fa]},getUniqueProtoName:function(t=""){return xa.call(this,fa,t)},getExternProtoDeclaration:function(t){t=String(t);const e=this[pa].get(t);if(e)return e;throw new Error("Extern proto declaration '"+t+"' not found.")},addExternProtoDeclaration(t,e){if(t=String(t),!(e instanceof ea))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(this[pa].get(t))throw new Error("Couldn't add extern proto declaration: extern proto '"+t+"' already in use.");if(0===(t=String(t)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[pa].add(t,e),e.setName(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},updateExternProtoDeclaration(t,e){if(t=String(t),!(e instanceof ea))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(0===(t=String(t)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[pa].update(e.getName(),t,e),e.setName(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},removeExternProtoDeclaration(t){t=String(t),this[pa].remove(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},getExternProtoDeclarations:function(){return this[pa]},getUniqueExternProtoName:function(t=""){return xa.call(this,pa,t)},addRoute:function(t,e,n,i){if(t=mr(o.X3DNode,t,!1),e=String(e),n=mr(o.X3DNode,n,!1),i=String(i),!t)throw new Error("Bad ROUTE specification: source node must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destination node must be of type X3DNode.");let r=t instanceof Wi?t:null,s=n instanceof Wi?n:null;try{t.getExecutionContext()!==this&&(r=this.getLocalNode(this.getLocalName(t)).getValue())}catch(t){}try{n.getExecutionContext()!==this&&(s=this.getLocalNode(this.getLocalName(n)).getValue())}catch(t){}if(r instanceof Wi&&s instanceof Wi?(r.addRoute(r,e,s,i),s.addRoute(r,e,s,i)):r instanceof Wi?r.addRoute(r,e,n,i):s instanceof Wi&&s.addRoute(t,e,s,i),r!==t&&s!==n)return this.addSimpleRoute(t,e,n,i)},addSimpleRoute:function(t,e,n,i){try{if(e=t.getField(e),i=n.getField(i),!e.isOutput())throw new Error("Field named '"+e.getName()+"' in node named '"+t.getName()+"' of type "+t.getTypeName()+" is not an output field.");if(!i.isInput())throw new Error("Field named '"+i.getName()+"' in node named '"+n.getName()+"' of type "+n.getTypeName()+" is not an input field.");if(e.getType()!==i.getType())throw new Error("ROUTE types "+e.getTypeName()+" and "+i.getTypeName()+" do not match.");const o=e.getId()+"."+i.getId();let r=this[ga].get(o);return r||(r=new la(this,t,e,n,i),this[ga].add(o,r),this._routes_changed=this.getBrowser().getCurrentTime(),r)}catch(t){throw new Error("Bad ROUTE specification: "+t.message)}},deleteRoute:function(t){if(4===arguments.length&&!(t=this.getRoute.apply(this,arguments)))return!1;this.deleteSimpleRoute(t)&&this.deleteImportedRoute(t.sourceNode,t.destinationNode,t)},deleteSimpleRoute:function(t){try{const e=t.getSourceField(),n=t.getDestinationField(),i=e.getId()+"."+n.getId();return this[ga].remove(i),t.disconnect(),this._routes_changed=this.getBrowser().getCurrentTime(),!0}catch(t){return console.error(t),!1}},deleteImportedRoute(t,e,n){let i=null,o=null;try{t.getValue().getExecutionContext()!==this&&(i=this.getLocalNode(this.getLocalName(t)).getValue())}catch(t){}try{e.getValue().getExecutionContext()!==this&&(o=this.getLocalNode(this.getLocalName(e)).getValue())}catch(t){}i instanceof Wi&&o instanceof Wi?(i.deleteRoute(n),o.deleteRoute(n)):i instanceof Wi?i.deleteRoute(n):o instanceof Wi&&o.deleteRoute(n)},getRoute:function(t,e,n,i){if(t=mr(o.X3DNode,t,!1),e=String(e),n=mr(o.X3DNode,n,!1),i=String(i),!t)throw new Error("Bad ROUTE specification: sourceNode must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destinationNode must be of type X3DNode.");e=t.getField(e),i=n.getField(i);const r=e.getId()+"."+i.getId();return this[ga].get(r)},getRoutes:function(){return this[ga]},getWorldInfos:function(){return this._worldInfos},addWorldInfo:function(t){this._worldInfos.push(t)},removeWorldInfo:function(t){for(let e=this._worldInfos.length-1;e>=0;--e)this._worldInfos[e].getValue()===t&&this._worldInfos.splice(e,1)},toVRMLStream:function(t){const e=s.Get(t);e.PushExecutionContext(this),e.EnterScope(),e.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toVRMLStream(t),this.getProtoDeclarations().toVRMLStream(t);const n=this.getRootNodes();for(let i=0,o=n.length;i<o;++i){const r=n[i];t.string+=e.Indent(),r?r.toVRMLStream(t):t.string+="NULL",t.string+="\n",i!==o-1&&(t.string+="\n")}const i=this.getImportedNodes();i.size&&(t.string+="\n",i.forEach((function(e){try{e.toVRMLStream(t),t.string+="\n"}catch(t){}})));const o=this.getRoutes();o.length&&(t.string+="\n",o.toVRMLStream(t)),e.LeaveScope(),e.PopExecutionContext()},toXMLStream:function(t){const e=s.Get(t);e.PushExecutionContext(this),e.EnterScope(),e.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toXMLStream(t),this.getProtoDeclarations().toXMLStream(t);const n=this.getRootNodes();n.length&&(n.toXMLStream(t),t.string+="\n");this.getImportedNodes().forEach((function(e){try{e.toXMLStream(t),t.string+="\n"}catch(t){}})),this.getRoutes().toXMLStream(t),e.LeaveScope(),e.PopExecutionContext()},dispose:function(){this._rootNodes.dispose();for(const t of this[ga])this.deleteRoute(t);Zn.prototype.dispose.call(this)}});const xa=function(){const t=/_\d+$/;return function(e,n=""){let i=n=String(n).replace(t,""),o=64;for(;o&&(this[e].has(i)||0===i.length);){const t=o,e=o<<=1;i=n,i+="_",i+=Math.round(et.random(t,e))}return i}}();for(const t of Reflect.ownKeys(_a.prototype))Object.defineProperty(_a.prototype,t,{enumerable:!1});Object.defineProperty(_a.prototype,"specificationVersion",{get:function(){return this.getSpecificationVersion()},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"encoding",{get:function(){return this.getEncoding()},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"profile",{get:function(){return this.getProfile()},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"components",{get:function(){return this.getComponents()},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"worldURL",{get:function(){return this.getWorldURL()},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"units",{get:function(){return this.getUnits()},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"rootNodes",{get:function(){return this.getRootNodes()},set:function(t){this.setRootNodes(t)},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"protos",{get:function(){return this.getProtoDeclarations()},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"externprotos",{get:function(){return this.getExternProtoDeclarations()},enumerable:!0,configurable:!1}),Object.defineProperty(_a.prototype,"routes",{get:function(){return this.getRoutes()},enumerable:!0,configurable:!1});const ya=_a;function wa(t,e,n,i){this.name=t,this.level=e,this.title=n,this.providerUrl=i}wa.prototype=Object.assign(Object.create(f.prototype),{constructor:wa,getTypeName:function(){return"ComponentInfo"},toVRMLStream:function(t){t.string+="COMPONENT",t.string+=" ",t.string+=this.name,t.string+=" ",t.string+=":",t.string+=" ",t.string+=this.level},toXMLStream:function(t){const e=s.Get(t);t.string+=e.Indent(),t.string+="<component",t.string+=" ",t.string+="name='",t.string+=this.name,t.string+="'",t.string+=" ",t.string+="level='",t.string+=this.level,t.string+="'",t.string+="/>"}});for(const t of Reflect.ownKeys(wa.prototype))Object.defineProperty(wa.prototype,t,{enumerable:!1});const Ta=wa;function Sa(t){return q.call(this,t)}Sa.prototype=Object.assign(Object.create(q.prototype),{constructor:Sa,getTypeName:function(){return"ComponentInfoArray"},addComponent:function(t){this.add(t.name,new Ta(t.name,t.level,t.title,t.providerUrl))}});for(const t of Reflect.ownKeys(Sa.prototype))Object.defineProperty(Sa.prototype,t,{enumerable:!1});const ba=Sa;function va(t,e,n){Object.defineProperty(this,"category",{value:t,writable:!1}),this.name=e,this.conversionFactor=n}va.prototype=Object.assign(Object.create(f.prototype),{constructor:va,getTypeName:function(){return"UnitInfo"},toVRMLStream:function(t){t.string+="UNIT",t.string+=" ",t.string+=this.category,t.string+=" ",t.string+=this.name,t.string+=" ",t.string+=this.conversionFactor},toXMLStream:function(t){const e=s.Get(t);t.string+=e.Indent(),t.string+="<unit",t.string+=" ",t.string+="category='",t.string+=this.category,t.string+="'",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(this.name),t.string+="'",t.string+=" ",t.string+="conversionFactor='",t.string+=this.conversionFactor,t.string+="'",t.string+="/>"}});for(const t of Reflect.ownKeys(va.prototype))Object.defineProperty(va.prototype,t,{enumerable:!1});Object.defineProperty(va.prototype,"conversion_factor",{get:function(){return this.conversionFactor},enumerable:!1,configurable:!1});const Ea=va;function Ca(t){return q.call(this,t)}Ca.prototype=Object.assign(Object.create(q.prototype),{constructor:Ca,getTypeName:function(){return"UnitInfoArray"}});for(const t of Reflect.ownKeys(Ca.prototype))Object.defineProperty(Ca.prototype,t,{enumerable:!1});const Oa=Ca,Fa=Symbol(),Na=Symbol();function Ma(t,e){f.call(this),this[Fa]=t,this[Na]=e}Ma.prototype=Object.assign(Object.create(f.prototype),{constructor:Ma,getExportedName:function(){return this[Fa]},getLocalNode:function(){return this[Na]},toVRMLStream:function(t){const e=s.Get(t),n=e.LocalName(this[Na]);t.string+=e.Indent(),t.string+="EXPORT",t.string+=" ",t.string+=n,this[Fa]!==n&&(t.string+=" ",t.string+="AS",t.string+=" ",t.string+=this[Fa])},toXMLStream:function(t){const e=s.Get(t),n=e.LocalName(this[Na]);t.string+=e.Indent(),t.string+="<EXPORT",t.string+=" ",t.string+="localDEF='",t.string+=e.XMLEncode(n),t.string+="'",this[Fa]!==n&&(t.string+=" ",t.string+="AS='",t.string+=e.XMLEncode(this[Fa]),t.string+="'"),t.string+="/>"}});for(const t of Reflect.ownKeys(Ma.prototype))Object.defineProperty(Ma.prototype,t,{enumerable:!1});Object.defineProperty(Ma.prototype,"exportedName",{get:function(){return Re.get(this[Fa])},enumerable:!0,configurable:!1}),Object.defineProperty(Ma.prototype,"localNode",{get:function(){return Re.get(this[Na])},enumerable:!0,configurable:!1});const Va=Ma;function Ia(t){return q.call(this,t)}Ia.prototype=Object.assign(Object.create(q.prototype),{constructor:Ia,getTypeName:function(){return"ExportedNodesArray"}});for(const t of Reflect.ownKeys(Ia.prototype))Object.defineProperty(Ia.prototype,t,{enumerable:!1});const Da=Ia,Ra=Symbol(),Pa=Symbol(),Aa=Symbol(),La=Symbol(),Ba=Symbol(),Xa=Symbol(),Ua=Symbol(),za=Symbol();function ja(t){ya.call(this,t),this.addType(o.X3DScene),this[Ra]="3.3",this[Pa]="SCRIPTED",this[Aa]=null,this[La]=new ba([]),this[Ba]=location.toString(),this[Xa]=new Oa,this[Xa].add("angle",new Ea("angle","radian",1)),this[Xa].add("force",new Ea("force","newton",1)),this[Xa].add("length",new Ea("length","metre",1)),this[Xa].add("mass",new Ea("mass","kilogram",1)),this[Ua]=new Map,this[za]=new Da,this.addChildObjects("profile_changed",new Bn.SFTime,"components_changed",new Bn.SFTime,"units_changed",new Bn.SFTime,"metadata_changed",new Bn.SFTime,"exportedNodes_changed",new Bn.SFTime),this.getRootNodes().setAccessType(o.inputOutput),this.setLive(!1)}Bi.addAbstractType("X3DScene",ja),ja.prototype=Object.assign(Object.create(ya.prototype),{constructor:ja,getTypeName:function(){return"X3DScene"},isMainScene:function(){return this===this.getExecutionContext()},isScene:function(){return!0},setSpecificationVersion:function(t){this[Ra]=String(t)},getSpecificationVersion:function(){return this[Ra]},setEncoding:function(t){this[Pa]=String(t)},getEncoding:function(){return this[Pa]},setWorldURL:function(t){this[Ba]=String(t)},getWorldURL:function(){return this[Ba]},setProfile:function(t){this[Aa]=t,this._profile_changed=this.getBrowser().getCurrentTime()},getProfile:function(){return this[Aa]},addComponent:function(t){this[La].add(t.name,t),this._components_changed=this.getBrowser().getCurrentTime()},removeComponent:function(t){this[La].remove(t.name),this._components_changed=this.getBrowser().getCurrentTime()},getComponents:function(){return this[La]},updateUnit:function(t,e,n){const i=this[Xa].get(t);i&&(i.name=String(e),i.conversionFactor=Number(n),this._units_changed=this.getBrowser().getCurrentTime())},getUnit:function(t){return this[Xa].get(t)},getUnits:function(){return this[Xa]},fromUnit:function(t,e){switch(t){case"angle":case"force":case"length":case"mass":return e*this.getUnits().get(t).conversionFactor;case"acceleration:":case"speed":return e*this.getUnits().get("length").conversionFactor;case"angularRate":return e*this.getUnits().get("angle").conversionFactor;case"area":return e*Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return e*Math.pow(this.getUnits().get("length").conversionFactor,3)}return e},toUnit:function(t,e){switch(t){case"angle":case"force":case"length":case"mass":return e/this.getUnits().get(t).conversionFactor;case"acceleration:":case"speed":return e/this.getUnits().get("length").conversionFactor;case"angularRate":return e/this.getUnits().get("angle").conversionFactor;case"area":return e/Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return e/Math.pow(this.getUnits().get("length").conversionFactor,3)}return e},setMetaData:function(t,e){(t=String(t)).length&&(this[Ua].set(t,String(e)),this._metadata_changed=this.getBrowser().getCurrentTime())},removeMetaData:function(t){t=String(t),this[Ua].delete(t),this._metadata_changed=this.getBrowser().getCurrentTime()},getMetaData:function(t){return t=String(t),this[Ua].get(t)},getMetaDatas:function(){return this[Ua]},addExportedNode:function(t,e){if(t=String(t),this[za].has(t))throw new Error("Couldn't add exported node: exported name '"+t+"' already in use.");this.updateExportedNode(t,e),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},updateExportedNode:function(t,e){if(t=String(t),e=mr(o.X3DNode,e,!1),0===t.length)throw new Error("Couldn't update exported node: node exported name is empty.");if(!e)throw new Error("Couldn't update exported node: node must be of type X3DNode.");this.removeExportedNode(t);const n=new Va(t,e);this[za].add(t,n),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},removeExportedNode:function(t){t=String(t),this[za].remove(t),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},getExportedNode:function(t){t=String(t);const e=this[za].get(t);if(e)return Re.get(e.getLocalNode());throw new Error("Exported node '"+t+"' not found.")},getExportedNodes:function(){return this[za]},addRootNode:function(t){t=Re.get(mr(o.X3DNode,t,!1));const e=this.getRootNodes();for(const n of e)if(n.equals(t))return;e.push(t)},removeRootNode:function(t){t=Re.get(mr(o.X3DNode,t,!1));const e=this.getRootNodes(),n=e.length;e.erase(e.remove(0,n,t),n)},setRootNodes:function(t){if(!(t instanceof Bn.MFNode))throw new Error("Value must be of type MFNode.");this.getRootNodes().assign(t)},toVRMLStream:function(t){const e=s.Get(t);let n=this.getSpecificationVersion();"2.0"===n&&(n="3.3"),t.string+="#X3D V",t.string+=n,t.string+=" ",t.string+="utf8",t.string+=" ",t.string+=this.getBrowser().name,t.string+=" ",t.string+="V",t.string+=this.getBrowser().version,t.string+="\n",t.string+="\n";const i=this.getProfile();i&&(i.toVRMLStream(t),t.string+="\n",t.string+="\n");const o=this.getComponents();o.length&&(o.toVRMLStream(t),t.string+="\n");{let e=!0;for(const n of this.getUnits())1!==n.conversionFactor&&(e=!1,n.toVRMLStream(t),t.string+="\n");e||(t.string+="\n")}const r=this.getMetaDatas();r.size&&(r.forEach((function(e,n){t.string+="META",t.string+=" ",t.string+=new Bn.SFString(n).toString(),t.string+=" ",t.string+=new Bn.SFString(e).toString(),t.string+="\n"})),t.string+="\n");const a=this.getExportedNodes();e.PushExecutionContext(this),e.EnterScope(),e.ExportedNodes(a),ya.prototype.toVRMLStream.call(this,t),a.size&&(t.string+="\n",a.forEach((function(e){try{e.toVRMLStream(t),t.string+="\n"}catch(t){console.error(t)}}))),e.LeaveScope(),e.PopExecutionContext()},toXMLStream:function(t){const e=s.Get(t);let n=this.getSpecificationVersion();"2.0"===n&&(n="3.3"),t.string+='<?xml version="1.0" encoding="UTF-8"?>\n',t.string+='<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D ',t.string+=n,t.string+='//EN" "http://www.web3d.org/specifications/x3d-',t.string+=n,t.string+='.dtd">\n',t.string+="<X3D",t.string+=" ",t.string+="profile='",t.string+=this.getProfile()?this.getProfile().name:"Full",t.string+="'",t.string+=" ",t.string+="version='",t.string+=n,t.string+="'",t.string+=" ",t.string+="xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance'",t.string+=" ",t.string+="xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-",t.string+=n,t.string+=".xsd'>\n",e.IncIndent(),t.string+=e.Indent(),t.string+="<head>\n",e.IncIndent(),this.getComponents().toXMLStream(t);for(const e of this.getUnits())1!==e.conversionFactor&&(e.toXMLStream(t),t.string+="\n");this.getMetaDatas().forEach((function(n,i){t.string+=e.Indent(),t.string+="<meta",t.string+=" ",t.string+="name='",t.string+=e.XMLEncode(i),t.string+="'",t.string+=" ",t.string+="content='",t.string+=e.XMLEncode(n),t.string+="'",t.string+="/>\n"})),e.DecIndent(),t.string+=e.Indent(),t.string+="</head>\n",t.string+=e.Indent(),t.string+="<Scene>\n",e.IncIndent();const i=this.getExportedNodes();e.PushExecutionContext(this),e.EnterScope(),e.ExportedNodes(i),ya.prototype.toXMLStream.call(this,t);for(const e of i)try{e.toXMLStream(t),t.string+="\n"}catch(t){console.error(t)}e.LeaveScope(),e.PopExecutionContext(),e.DecIndent(),t.string+=e.Indent(),t.string+="</Scene>\n",e.DecIndent(),t.string+="</X3D>\n"}});for(const t of Reflect.ownKeys(ja.prototype))Object.defineProperty(ja.prototype,t,{enumerable:!1});const ka=ja,Ga=Symbol.for("X3DEventObject.browser"),Ha=Symbol();function qa(t){this[Ga]=t,ka.call(this,this),this.addChildObjects("initLoadCount",new Bn.SFInt32,"loadCount",new Bn.SFInt32),this[Ha]=new Set}qa.prototype=Object.assign(Object.create(ka.prototype),{constructor:qa,setExecutionContext:function(t){if(!this.isMainScene()){const t=this.getScene();for(const e of this[Ha])t.removeLoadCount(e)}if(ka.prototype.setExecutionContext.call(this,t),!this.isMainScene()){const t=this.getScene();for(const e of this[Ha])t.addLoadCount(e)}},addInitLoadCount:function(t){this._initLoadCount=this._initLoadCount.getValue()+1},removeInitLoadCount:function(t){this._initLoadCount=this._initLoadCount.getValue()-1},addLoadCount:function(t){if(this[Ha].has(t))return;this[Ha].add(t),this._loadCount=this[Ha].size;const e=this.getBrowser(),n=this.getScene();this!==e.getExecutionContext()&&this.loader!==e.loader||e.addLoadCount(t),this.isMainScene()||n.addLoadCount(t)},removeLoadCount:function(t){if(!this[Ha].has(t))return;this[Ha].delete(t),this._loadCount=this[Ha].size;const e=this.getBrowser(),n=this.getScene();this!==e.getExecutionContext()&&this.loader!==e.loader||e.removeLoadCount(t),this.isMainScene()||n.removeLoadCount(t)},getLoadingObjects:function(){return this[Ha]}});for(const t of Reflect.ownKeys(qa.prototype))Object.defineProperty(qa.prototype,t,{enumerable:!1});const Ya=qa,Wa=new WeakMap,$a=new WeakMap,Ka=new WeakMap,Qa={get:function(t,e){const n=t[e];if(void 0!==n)return n;const i=t.getStorage()[t.getNameSpace()+e];if(void 0===i||"undefined"===i||null===i)return t.getDefaultValue(e);return JSON.parse(i)},set:function(t,e,n){return void 0===n?t.getStorage().removeItem(t.getNameSpace()+e):t.getStorage()[t.getNameSpace()+e]=JSON.stringify(n),!0}};function Za(t,e){return this.target=this,Wa.set(this,t),$a.set(this,e),Ka.set(this,{}),new Proxy(this,Qa)}Za.prototype={constructor:Za,getStorage:function(){return Wa.get(this.target)},getNameSpace:function(){return $a.get(this.target)},addNameSpace:function(t){return new Za(this.getStorage(),this.getNameSpace()+t)},addDefaultValues:function(t){Object.assign(Ka.get(this.target),t)},getDefaultValue(t){const e=Ka.get(this.target)[t];return void 0===e?void 0:JSON.parse(JSON.stringify(e))},clear:function(){const t=this.getStorage(),e=this.getNameSpace();for(const n of Object.keys(t))n.startsWith(e)&&t.removeItem(n)}};const Ja=Za,tu=Symbol(),eu=Symbol(),nu=Symbol(),iu=Symbol(),ou=Symbol(),ru=Symbol(),su=Symbol(),au=Symbol(),uu=Symbol(),cu=Symbol(),lu=Symbol(),hu=Symbol(),du=Symbol(),fu=Symbol(),pu=Symbol(),gu=Symbol(),mu=Symbol(),_u=Symbol(),xu=Symbol(),yu=Symbol();let wu=0;function Tu(t){const e=$(t.prop("shadowRoot")),n=$("<div></div>").addClass("x_ite-private-browser").attr("tabindex",0),i=$("<div></div>").addClass("x_ite-private-surface").appendTo(n),o=$("<div></div>").hide().addClass("x_ite-private-splash-screen").appendTo(n),r=($("<div></div>").addClass("x_ite-private-spinner").appendTo(o),$("<div></div>").addClass("x_ite-private-progress").appendTo(o));$("<div></div>").addClass("x_ite-private-x_ite").html(this.getName()+"<span class='x_ite-private-x3d'>X3D</span>").appendTo(r),$("<div></div>").addClass("x_ite-private-progressbar").appendTo(r).append($("<div></div>")),$("<div></div>").addClass("x_ite-private-spinner-text").appendTo(r),this[tu]=++wu,this[eu]=t,this[nu]=e.length?e.append(n.hide()):this[eu].prepend(n),this[iu]=i,this[ou]=$("<canvas></canvas>").addClass("x_ite-private-canvas").prependTo(i),this[ru]=ei.create(this[ou][0],2,"true"===t.attr("preserveDrawingBuffer")),this[su]=o,e.length&&e.prop("loaded").then((function(){n.show()})),this[au]=new Ja(localStorage,"X_ITE.X3DBrowser("+this[tu]+")."),this[uu]=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this[cu]=new ui(this.getPrivateScene()),this[lu]=new _i(this.getPrivateScene()),this[hu]=new yi(this.getPrivateScene()),this[du]=new Ti(this.getPrivateScene()),this[fu]=new bi(this.getPrivateScene()),this[pu]=new Mi(this.getPrivateScene());const s=$("<div></div>").hide().css("height","10in").appendTo(this[nu]);this[yu]=s.height()/720,s.remove(),$(".x_ite-console").empty(),this.addChildObjects("controlKey",new Bn.SFBool,"shiftKey",new Bn.SFBool,"altKey",new Bn.SFBool,"altGrKey",new Bn.SFBool)}Tu.prototype={initialize:function(){this[cu].setup(),this[lu].setup(),this[hu].setup(),this[du].setup(),this[fu].setup(),this[pu].setup(),this[gu]=new MutationObserver(this.processMutations.bind(this)),this[gu].observe(this[eu][0],{attributes:!0,childList:!1,characterData:!1,subtree:!1}),Object.defineProperty(this.getElement().get(0),"src",{get:function(){return this.getExecutionContext().getWorldURL()}.bind(this),set:function(t){this.loadURL(new Bn.MFString(t),new Bn.MFString)}.bind(this),enumerable:!0,configurable:!1}),Object.defineProperty(this.getElement().get(0),"url",{get:function(){return new Bn.MFString(this.getExecutionContext().getWorldURL())}.bind(this),set:function(t){this.loadURL(t,new Bn.MFString)}.bind(this),enumerable:!0,configurable:!1}),this.getElement().on("keydown.X3DCoreContext",this[_u].bind(this)),this.getElement().on("keyup.X3DCoreContext",this[xu].bind(this))},getDebug:function(){return this.getBrowserOptions().getDebug()},getInstanceId:function(){return this[tu]},isStrict:function(){return!1},getElement:function(){return this[eu]},getShadow:function(){return this[nu]},getSurface:function(){return this[iu]},getSplashScreen:function(){return this[su]},getCanvas:function(){return this[ou]},getContext:function(){return this[ru]},getMobile:function(){return this[uu]},getLocalStorage:function(){return this[au]},getBrowserTimings:function(){return this[cu]},getBrowserOptions:function(){return this[lu]},getBrowserProperties:function(){return this[hu]},getRenderingProperties:function(){return this[du]},getNotification:function(){return this[fu]},getContextMenu:function(){return this[pu]},getPrivateScene:function(){return this[mu]||(this[mu]=new Ya(this),this[mu].setPrivate(!0),this[mu].setLive(!0),this[mu].setup()),this[mu]},parseUrlAttribute:function(t){const e=new Bn.MFString;return e.fromString(t,this.getExecutionContext()),e},processMutations:function(t){for(const e of t)this.processMutation(e)},processMutation:function(t){const e=t.target;if("attributes"===t.type)this.processAttribute(t,e)},processAttribute:function(t,e){switch(t.attributeName.toLowerCase()){case"splashscreen":this.getBrowserOptions().setAttributeSplashScreen();break;case"src":{const t=this.getElement().attr("src");this.loadURL(new Bn.MFString(t),new Bn.MFString);break}case"url":{const t=this.getElement().attr("url");this.loadURL(this.parseUrlAttribute(t),new Bn.MFString);break}}},callBrowserEventHandler:function(t){const e=window.jQuery?window.jQuery(this.getElement().get(0)):this.getElement();for(const n of t.split(" "))e.trigger(n)},getShiftKey:function(){return this._shiftKey.getValue()},getControlKey:function(){return this._controlKey.getValue()},getAltKey:function(){return this._altKey.getValue()},getAltGrKey:function(){return this._altGrKey.getValue()},[_u]:function(t){switch(t.keyCode){case 16:this._shiftKey=!0;break;case 17:this._controlKey=!0;break;case 18:this._altKey=!0;break;case 49:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","POINT"),this.getNotification()._string="Shading: Pointset");break;case 50:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","WIREFRAME"),this.getNotification()._string="Shading: Wireframe");break;case 51:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","FLAT"),this.getNotification()._string="Shading: Flat");break;case 52:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","GOURAUD"),this.getNotification()._string="Shading: Gouraud");break;case 53:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","PHONG"),this.getNotification()._string="Shading: Phong");break;case 83:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.isLive().getValue()?this.endUpdate():this.beginUpdate(),this.getNotification()._string=this.isLive().getValue()?"Begin Update":"End Update");break;case 225:this._altGrKey=!0;break;case 171:case 187:this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Timings",!this.getBrowserOption("Timings")));break;case 36:t.preventDefault(),this.firstViewpoint();break;case 35:t.preventDefault(),this.lastViewpoint();break;case 33:t.preventDefault(),this.previousViewpoint();break;case 34:t.preventDefault(),this.nextViewpoint();break;case 119:if(this.getShiftKey()){t.preventDefault();const e=this.getActiveViewpoint();if(!e)break;const n=this.getPrivateScene().createNode(e.getTypeName());switch(e.getTypeName()){case"Viewpoint":n.position=e.getUserPosition(),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getUserCenterOfRotation(),n.fieldOfView=e.getFieldOfView();break;case"OrthoViewpoint":n.position=e.getUserPosition(),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getUserCenterOfRotation(),n.fieldOfView=new Bn.MFFloat(e.getMinimumX(),e.getMinimumY(),e.getMaximumX(),e.getMaximumY());break;case"GeoViewpoint":{const t=e._geoOrigin,i=new qt(0,0,0);if(t.getValue()&&"GeoOrigin"===t.getNodeTypeName()){const e=this.getPrivateScene().createNode("GeoOrigin");n.geoOrigin=e,e.geoSystem=t.geoSystem,e.geoCoords=t.geoCoords,e.rotateYUp=t.rotateYUp}n.geoSystem=e._geoSystem,n.position=e.getGeoCoord(e.getUserPosition(),i),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getGeoCoord(e.getUserCenterOfRotation(),i),n.fieldOfView=e.getFieldOfView();break}}let i;switch(this.getExecutionContext().getEncoding()){case"ASCII":case"VRML":i=n.toVRMLString();break;case"JSON":i=n.toJSONString();break;default:i=n.toXMLString()}i+="\n",this.copyToClipboard(i),this.getNotification()._string=ri("Viewpoint is copied to clipboard."),console.log("Copied Viewpoint to Clipboard."),console.debug(i)}}},[xu]:function(t){switch(t.which){case 16:this._shiftKey=!1;break;case 17:this._controlKey=!1;break;case 18:this._altKey=!1;break;case 225:this._altGrKey=!1}},copyToClipboard:function(t){const e=$("<textarea></textarea>");this.getShadow().find(".x_ite-private-browser").prepend(e),e.text(t).select(),document.execCommand("copy"),e.remove()},getPixelPerPoint:function(){return this[yu]}};const Su=Tu;function bu(t){ji.call(this,t),this.addType(o.TextureProperties)}bu.prototype=Object.assign(Object.create(ji.prototype),{constructor:bu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"borderColor",new Bn.SFColorRGBA),new z(o.inputOutput,"borderWidth",new Bn.SFInt32),new z(o.inputOutput,"anisotropicDegree",new Bn.SFFloat(1)),new z(o.initializeOnly,"generateMipMaps",new Bn.SFBool),new z(o.inputOutput,"minificationFilter",new Bn.SFString("DEFAULT")),new z(o.inputOutput,"magnificationFilter",new Bn.SFString("DEFAULT")),new z(o.inputOutput,"boundaryModeS",new Bn.SFString("REPEAT")),new z(o.inputOutput,"boundaryModeT",new Bn.SFString("REPEAT")),new z(o.inputOutput,"boundaryModeR",new Bn.SFString("REPEAT")),new z(o.inputOutput,"textureCompression",new Bn.SFString("DEFAULT")),new z(o.inputOutput,"texturePriority",new Bn.SFFloat)]),getTypeName:function(){return"TextureProperties"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureProperties"},getBorderWidth:function(){return et.clamp(this._borderWidth.getValue(),0,1)},getBoundaryMode:function(){const t=new Map([["CLAMP","CLAMP_TO_EDGE"],["CLAMP_TO_EDGE","CLAMP_TO_EDGE"],["CLAMP_TO_BOUNDARY","CLAMP_TO_EDGE"],["MIRRORED_REPEAT","MIRRORED_REPEAT"],["REPEAT","REPEAT"]]);return function(e){const n=t.get(e);return void 0!==n?n:"REPEAT"}}(),getBoundaryModeS:function(){return this.getBoundaryMode(this._boundaryModeS.getValue())},getBoundaryModeT:function(){return this.getBoundaryMode(this._boundaryModeT.getValue())},getBoundaryModeR:function(){return this.getBoundaryMode(this._boundaryModeR.getValue())},getMinificationFilter:function(){const t=new Map([["AVG_PIXEL_AVG_MIPMAP","LINEAR_MIPMAP_LINEAR"],["AVG_PIXEL","LINEAR"],["AVG_PIXEL_NEAREST_MIPMAP","LINEAR_MIPMAP_NEAREST"],["NEAREST_PIXEL_AVG_MIPMAP","NEAREST_MIPMAP_LINEAR"],["NEAREST_PIXEL_NEAREST_MIPMAP","NEAREST_MIPMAP_NEAREST"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR_MIPMAP_LINEAR"],["FASTEST","NEAREST"]]);return function(){if(this._generateMipMaps.getValue()){const e=t.get(this._minificationFilter.getValue());return void 0!==e?e:this.getBrowser().getDefaultTextureProperties().getMinificationFilter()}return"LINEAR"}}(),getMagnificationFilter:function(){const t=new Map([["AVG_PIXEL","LINEAR"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR"],["FASTEST","NEAREST"]]);return function(){const e=t.get(this._magnificationFilter.getValue());return void 0!==e?e:this.getBrowser().getDefaultTextureProperties().getMagnificationFilter()}}(),getTextureCompression:function(){const t=new Map([["DEFAULT","RGBA"],["NICEST","RGBA"],["FASTEST","RGBA"],["LOW","RGBA"],["MEDIUM","RGBA"],["HIGH","RGBA"]]);return function(){const e=this.getBrowser().getContext(),n=e.getExtension("WEBGL_compressed_texture_etc"),i=n?n[t.get(this._textureCompression.getValue())]:void 0;return void 0!==i?i:e.RGBA}}()});const vu=bu,Eu=Symbol();function Cu(){}Cu.prototype={initialize:function(){},getBackgroundTextureProperties:function(){return this[Eu]=new vu(this.getPrivateScene()),this[Eu]._boundaryModeS="CLAMP_TO_EDGE",this[Eu]._boundaryModeT="CLAMP_TO_EDGE",this[Eu]._boundaryModeR="CLAMP_TO_EDGE",this[Eu]._minificationFilter="NICEST",this[Eu]._magnificationFilter="NICEST",this[Eu].setup(),this.getBackgroundTextureProperties=function(){return this[Eu]},Object.defineProperty(this,"getBackgroundTextureProperties",{enumerable:!1}),this[Eu]}};const Ou=Cu;function Fu(t){Gr.call(this,t),this.addType(o.X3DComposedGeometryNode),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}Fu.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Fu,initialize:function(){Gr.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__(),this.set_coord__()},getFogCoord:function(){return this.fogCoordNode},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getCoord:function(){return this.coordNode},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=mr(o.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=mr(o.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=mr(o.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_texCoord__:function(){this.texCoordNode&&this.texCoordNode.removeInterest("requestRebuild",this),this.texCoordNode=mr(o.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode&&this.texCoordNode.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=mr(o.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=mr(o.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},getPolygonIndex:function(t){return t},getTriangleIndex:function(t){return t},build:function(t,e,n,i){if(!this.coordNode||this.coordNode.isEmpty())return;e-=e%t,i-=i%n;const o=this._colorPerVertex.getValue(),r=this._normalPerVertex.getValue(),s=this.getAttrib(),a=s.length,u=this.getAttribs(),c=this.getFogCoord(),l=this.getColor(),h=this.getTexCoord(),d=this.getNormal(),f=this.getCoord(),p=this.getFogDepths(),g=this.getColors(),m=this.getMultiTexCoords(),_=this.getNormals(),x=this.getVertices();h&&h.init(m);for(let t=0;t<i;++t){const e=Math.floor(t/n),i=this.getPolygonIndex(this.getTriangleIndex(t));for(let t=0;t<a;++t)s[t].addValue(i,u[t]);c&&c.addDepth(i,p),l&&(o?l.addColor(i,g):l.addColor(e,g)),h&&h.addTexCoord(i,m),d&&(r?d.addVector(i,_):d.addVector(e,_)),f.addPoint(i,x)}this.getNormal()||this.buildNormals(t,e,i),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},buildNormals:function(t,e,n){const i=this.createNormals(t,e),o=this.getNormals();for(let t=0;t<n;++t){const e=i[this.getTriangleIndex(t)];o.push(e.x,e.y,e.z)}},createNormals:function(t,e){const n=this.createFaceNormals(t,e);if(this._normalPerVertex.getValue()){const t=[];for(let n=0;n<e;++n){const e=this.getPolygonIndex(n);let i=t[e];i||(i=t[e]=[]),i.push(n)}return this.refineNormals(t,n,Math.PI)}return n},createFaceNormals:function(t,e){const n=!this._ccw.getValue(),i=this.coordNode,o=[];for(let r=0;r<e;r+=t){const e=this.getPolygonNormal(r,t,i);n&&e.negate();for(let n=0;n<t;++n)o.push(e)}return o},getPolygonNormal:function(){let t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i,o){const r=new qt(0,0,0);o.get1Point(this.getPolygonIndex(n),e);for(let s=0;s<i;++s){const a=t;t=e,e=a,o.get1Point(this.getPolygonIndex(n+(s+1)%i),e),r.x+=(t.y-e.y)*(t.z+e.z),r.y+=(t.z-e.z)*(t.x+e.x),r.z+=(t.x-e.x)*(t.y+e.y)}return r.normalize()}}()});const Nu=Fu;function Mu(t){Nu.call(this,t),this.addType(o.IndexedFaceSet),this._creaseAngle.setUnit("angle")}Mu.prototype=Object.assign(Object.create(Nu.prototype),{constructor:Mu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_colorIndex",new Bn.MFInt32),new z(o.inputOnly,"set_texCoordIndex",new Bn.MFInt32),new z(o.inputOnly,"set_normalIndex",new Bn.MFInt32),new z(o.inputOnly,"set_coordIndex",new Bn.MFInt32),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"convex",new Bn.SFBool(!0)),new z(o.initializeOnly,"creaseAngle",new Bn.SFFloat),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"colorIndex",new Bn.MFInt32),new z(o.initializeOnly,"texCoordIndex",new Bn.MFInt32),new z(o.initializeOnly,"normalIndex",new Bn.MFInt32),new z(o.initializeOnly,"coordIndex",new Bn.MFInt32),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedFaceSet"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Nu.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_texCoordIndex.addFieldInterest(this._texCoordIndex),this._set_normalIndex.addFieldInterest(this._normalIndex),this._set_coordIndex.addFieldInterest(this._coordIndex)},getTexCoordPerVertexIndex:function(t){return t<this._texCoordIndex.length?this._texCoordIndex[t]:this._coordIndex[t]},getColorPerVertexIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:this._coordIndex[t]},getColorIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:t},getNormalPerVertexIndex:function(t){return t<this._normalIndex.length?this._normalIndex[t]:this._coordIndex[t]},getNormalIndex:function(t){return t<this._normalIndex.length?this._normalIndex[t]:t},build:function(){const t=this.triangulate();if(0===t.length)return;const e=this._colorPerVertex.getValue(),n=this._normalPerVertex.getValue(),i=this._coordIndex.getValue(),o=this.getAttrib(),r=o.length,s=this.getAttribs(),a=this.getFogCoord(),u=this.getColor(),c=this.getTexCoord(),l=this.getNormal(),h=this.getCoord(),d=this.getFogDepths(),f=this.getColors(),p=this.getMultiTexCoords(),g=this.getNormals(),m=this.getVertices();c&&c.init(p);for(const _ of t){const t=_.triangles,x=_.face;for(const _ of t){const t=i[_];for(let e=0;e<r;++e)o[e].addValue(t,s[e]);a&&a.addDepth(t,d),u&&(e?u.addColor(this.getColorPerVertexIndex(_),f):u.addColor(this.getColorIndex(x),f)),c&&c.addTexCoord(this.getTexCoordPerVertexIndex(_),p),l&&(n?l.addVector(this.getNormalPerVertexIndex(_),g):l.addVector(this.getNormalIndex(x),g)),h.addPoint(t,m)}}this.getNormal()||this.buildNormals(t),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},triangulate:function(){const t=this._convex.getValue(),e=this._coordIndex.length,n=[];if(!this.getCoord())return n;if(e&&this._coordIndex[e-1]>-1&&this._coordIndex.push(-1),e){const e=this._coordIndex.getValue(),i=this._coordIndex.length;let o=[];for(let r=0,s=0;r<i;++r){if(e[r]>-1)o.push(r);else{if(o.length)switch(o.length){case 0:case 1:case 2:o.length=0;break;case 3:n.push({vertices:o,triangles:o,face:s}),o=[];break;default:{const e=[],i={vertices:o,triangles:e,face:s};t?this.triangulateConvexPolygon(o,e):this.triangulatePolygon(o,e),e.length<3?o.length=0:(n.push(i),o=[]);break}}++s}}}return n},triangulatePolygon:function(){const t=[];return function(e,n){const i=this._coordIndex.getValue(),o=this.getCoord(),r=e.length;for(let n=0;n<r;++n){const r=e[n];let s=t[n];s||(s=t[n]=new qt(0,0,0)),s.index=r,o.get1Point(i[r],s)}t.length=r,Ho.triangulatePolygon(t,n);for(let t=0,e=n.length;t<e;++t)n[t]=n[t].index}}(),triangulateConvexPolygon:function(t,e){for(let n=1,i=t.length-1;n<i;++n)e.push(t[0],t[n],t[n+1])},buildNormals:function(t){const e=this.createNormals(t),n=this.getNormals();for(const i of t)for(const t of i.triangles){const i=e[t];n.push(i.x,i.y,i.z)}},createNormals:function(){const t=[],e=[];return function(n){const i=!this._ccw.getValue(),o=this._coordIndex.getValue(),r=this.getCoord();t.length=0,e.length=0;for(const a of n){const n=a.vertices,u=n.length;switch(u){case 3:var s=r.getNormal(o[n[0]],o[n[1]],o[n[2]]);break;case 4:s=r.getQuadNormal(o[n[0]],o[n[1]],o[n[2]],o[n[3]]);break;default:s=this.getPolygonNormal(n,o,r)}for(let t=0;t<u;++t){const i=n[t],r=o[i];let s=e[r];s||(s=e[r]=[]),s.push(i)}i&&s.negate();for(let e=0;e<u;++e)t[n[e]]=s}return this.refineNormals(e,t,this._creaseAngle.getValue())}}(),getPolygonNormal:function(){let t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i,o){const r=new qt(0,0,0);o.get1Point(i[n[0]],e);for(let s=0,a=n.length;s<a;++s){const u=t;t=e,e=u,o.get1Point(i[n[(s+1)%a]],e),r.x+=(t.y-e.y)*(t.z+e.z),r.y+=(t.z-e.z)*(t.x+e.x),r.z+=(t.x-e.x)*(t.y+e.y)}return r.normalize()}}()});const Vu=Mu;function Iu(t){ji.call(this,t),this.addType(o.X3DGeometricPropertyNode)}Iu.prototype=Object.assign(Object.create(ji.prototype),{constructor:Iu});const Du=Iu;function Ru(t){Du.call(this,t),this.addType(o.X3DCoordinateNode)}Ru.prototype=Object.assign(Object.create(Du.prototype),{constructor:Ru,initialize:function(){Du.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},set1Point:function(t,e){this._point[t]=e},get1Point:function(t,e){if(t<this.length){const n=this.point;return t*=3,e.set(n[t],n[t+1],n[t+2])}return e.set(0,0,0)},addPoint:function(t,e){if(t<this.length){const n=this.point;t*=3,e.push(n[t],n[t+1],n[t+2],1)}else e.push(0,0,0,1)},addPoints:function(t,e){const n=this.point;for(var i=0,o=3*this.length;i<o;i+=3)t.push(n[i],n[i+1],n[i+2],1);for(i=o,o=3*e;i<o;i+=3)t.push(0,0,0,1)},getNormal:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0);return function(i,o,r){const s=this.length;return i<s&&o<s&&r<s?Ho.normal(this.get1Point(i,t),this.get1Point(o,e),this.get1Point(r,n),new qt(0,0,0)):new qt(0,0,0)}}(),getQuadNormal:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0);return function(o,r,s,a){const u=this.length;return o<u&&r<u&&s<u&&a<u?Ho.quadNormal(this.get1Point(o,t),this.get1Point(r,e),this.get1Point(s,n),this.get1Point(a,i),new qt(0,0,0)):new qt(0,0,0)}}()});const Pu=Ru;function Au(t){Pu.call(this,t),this.addType(o.Coordinate),this._point.setUnit("length")}Au.prototype=Object.assign(Object.create(Pu.prototype),{constructor:Au,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"point",new Bn.MFVec3f)]),getTypeName:function(){return"Coordinate"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"coord"}});const Lu=Au;function Bu(t){Du.call(this,t),this.addType(o.X3DTextureCoordinateNode)}Bu.prototype=Object.assign(Object.create(Du.prototype),{constructor:Bu});const Xu=Bu;function Uu(t){Xu.call(this,t),this.addType(o.X3DSingleTextureCoordinateNode),this.texCoordArray=Gr.createArray()}Uu.prototype=Object.assign(Object.create(Xu.prototype),{constructor:Uu,init:function(t){this.texCoordArray.length=0,t.push(this.texCoordArray)},getCount:function(){return 1},addTexCoord:function(t,e){this.addTexCoordToChannel(t,e[0])},getTextureCoordinateMapping:function(t,e=0){this._mapping.getValue()&&t.set(this._mapping.getValue(),e)},setShaderUniforms:function(t,e){for(let n=0,i=e.x3d_MaxTextures;n<i;++n)this.setShaderUniformsToChannel(t,e,n)},setShaderUniformsToChannel:function(t,e,n=0){t.uniform1i(e.x3d_TextureCoordinateGeneratorMode[n],0)}});const zu=Uu;function ju(t){zu.call(this,t),this.addType(o.TextureCoordinate)}ju.prototype=Object.assign(Object.create(zu.prototype),{constructor:ju,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"mapping",new Bn.SFString),new z(o.inputOutput,"point",new Bn.MFVec2f)]),getTypeName:function(){return"TextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){zu.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(t,e){if(t>=0&&t<this.length){const n=this.point;return t*=2,e.set(n[t],n[t+1],0,1)}if(t>=0&&this.length){const n=this.point;return t%=this.length,t*=2,e.set(n[t],n[t+1],0,1)}return e.set(0,0,0,1)},addTexCoordToChannel:function(t,e){if(t>=0&&t<this.length){const n=this.point;t*=2,e.push(n[t],n[t+1],0,1)}else if(t>=0&&this.length){const n=this.point;t%=this.length,t*=2,e.push(n[t],n[t+1],0,1)}else e.push(0,0,0,1)},getTexCoord:function(t){const e=this.point,n=this.length;for(let i=0,o=0;i<n;++i,o+=2)t.push(e[o],e[o+1],0,1);return t}});const ku=ju;function Gu(t){Zn.call(this,t)}Gu.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Gu,getTypeName:function(){return"BoxOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"boxOptions"},initialize:function(){Zn.prototype.initialize.call(this)},getGeometry:function(){if(this.geometry)return this.geometry;this.geometry=new Vu(this.getExecutionContext()),this.geometry._texCoord=new ku(this.getExecutionContext()),this.geometry._coord=new Lu(this.getExecutionContext());const t=this.geometry,e=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();return t._texCoordIndex=new Bn.MFInt32(0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1),t._coordIndex=new Bn.MFInt32(0,1,2,3,-1,5,4,7,6,-1,1,5,6,2,-1,4,0,3,7,-1,4,5,1,0,-1,3,2,6,7,-1),e._point=new Bn.MFVec2f(new Bn.SFVec2f(1,1),new Bn.SFVec2f(0,1),new Bn.SFVec2f(0,0),new Bn.SFVec2f(1,0)),n._point=new Bn.MFVec3f(new Bn.SFVec3f(1,1,1),new Bn.SFVec3f(-1,1,1),new Bn.SFVec3f(-1,-1,1),new Bn.SFVec3f(1,-1,1),new Bn.SFVec3f(1,1,-1),new Bn.SFVec3f(-1,1,-1),new Bn.SFVec3f(-1,-1,-1),new Bn.SFVec3f(1,-1,-1)),e.setup(),n.setup(),t.setup(),this.geometry}});const Hu=Gu;function qu(t){Zn.call(this,t),this.addChildObjects("xDimension",new Bn.SFInt32(20),"yDimension",new Bn.SFInt32(1))}qu.prototype=Object.assign(Object.create(Zn.prototype),{constructor:qu,getTypeName:function(){return"ConeOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"coneOptions"}});const Yu=qu;function Wu(t){Zn.call(this,t),this.addChildObjects("xDimension",new Bn.SFInt32(20),"yDimension",new Bn.SFInt32(1))}Wu.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Wu,getTypeName:function(){return"CylinderOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"cylinderOptions"}});const $u=Wu;function Ku(t){Zn.call(this,t),this.addChildObjects("xDimension",new Bn.SFInt32(32),"yDimension",new Bn.SFInt32(15))}Ku.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Ku,getTypeName:function(){return"QuadSphereOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"quadSphereOptions"},initialize:function(){Zn.prototype.initialize.call(this),this.addInterest("eventsProcessed",this)},getGeometry:function(){return this.geometry||this.eventsProcessed(),this.geometry},createTexCoordIndex:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._texCoordIndex;for(let e=0,i=t-1;e<i;++e)n.push(e),n.push(e+t-1),n.push(e+t),n.push(-1);for(let i=t-1,o=0,r=e-3;o<r;++o,++i)for(let e=0,o=t-1;e<o;++e,++i)n.push(i),n.push(i+t),n.push(i+t+1),n.push(i+1),n.push(-1);let i=(e-2)*t-1;for(let e=0,o=t-1;e<o;++e,++i)n.push(i+t),n.push(i+1),n.push(i),n.push(-1)},createTexCoord:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._texCoord.getValue()._point,i=-.5/(t-1);for(let e=1;e<t;++e){const o=e/(t-1)+i;n.push(new jt(o,1))}for(let i=1,o=e-1;i<o;++i){const o=1-i/(e-1);for(let e=0;e<t;++e){const i=e/(t-1);n.push(new jt(i,o))}}for(let e=1;e<t;++e){const o=e/(t-1)+i;n.push(new jt(o,0))}},createCoordIndex:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._coordIndex;let i=1;for(const e=t-1;i<e;++i)n.push(0),n.push(i),n.push(i+1),n.push(-1);n.push(0),n.push(i),n.push(1),n.push(-1);let o=1;for(let i=0,r=e-3;i<r;++i,++o){for(let e=0,i=t-2;e<i;++e,++o)n.push(o),n.push(o+t-1),n.push(o+t),n.push(o+1),n.push(-1);n.push(o),n.push(o+t-1),n.push(o+1),n.push(o-t+2),n.push(-1)}const r=o+t-1;for(let e=0,i=t-2;e<i;++e,++o)n.push(r),n.push(o+1),n.push(o),n.push(-1);n.push(r),n.push(r-t+1),n.push(o),n.push(-1)},createPoints:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._coord.getValue()._point;n.push(new qt(0,1,0));for(let i=1,o=e-1;i<o;++i){const e=Wr.Polar(1,-Math.PI*i/o);for(let i=0,o=t-1;i<o;++i){const t=Wr.Polar(e.imag,2*Math.PI*i/o);n.push(new qt(t.imag,e.real,t.real))}}n.push(new qt(0,-1,0))},eventsProcessed:function(){this.geometry=new Vu(this.getExecutionContext()),this.geometry._texCoord=new ku(this.getExecutionContext()),this.geometry._coord=new Lu(this.getExecutionContext()),this.createTexCoordIndex(),this.createTexCoord(),this.createCoordIndex(),this.createPoints();const t=this.geometry,e=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();t._creaseAngle=Math.PI,e.setup(),n.setup(),t.setup()}});const Qu=Ku;function Zu(){}function Ju(t,e){const n=new e(this.getPrivateScene());return n.setup(),this[t]=function(){return n},Object.defineProperty(this,t,{enumerable:!1}),n}Zu.prototype={initialize:function(){this.setPrimitiveQuality3D(this.getBrowserOptions().getPrimitiveQuality())},getBoxOptions:function(){return Ju.call(this,"getBoxOptions",Hu)},getConeOptions:function(){return Ju.call(this,"getConeOptions",Yu)},getCylinderOptions:function(){return Ju.call(this,"getCylinderOptions",$u)},getSphereOptions:function(){return Ju.call(this,"getSphereOptions",Qu)},setPrimitiveQuality3D:function(t){const e=this.getConeOptions(),n=this.getCylinderOptions(),i=this.getSphereOptions();switch(t){case li.LOW:e._xDimension=16,n._xDimension=16,i._xDimension=20,i._yDimension=9;break;case li.MEDIUM:e._xDimension=20,n._xDimension=20,i._xDimension=32,i._yDimension=15;break;case li.HIGH:e._xDimension=32,n._xDimension=32,i._xDimension=64,i._yDimension=31}}};const tc=Zu;let ec=0;const nc={AUTO:ec++,OPAQUE:ec++,MASK:ec++,BLEND:ec++};function ic(t){gr.call(this,t),xr.call(this,t),this.addType(o.X3DShapeNode),this.bbox=new ur,this.bboxSize=new qt(0,0,0),this.bboxCenter=new qt(0,0,0)}ic.prototype=Object.assign(Object.create(gr.prototype),xr.prototype,{constructor:ic,initialize:function(){gr.prototype.initialize.call(this),xr.prototype.initialize.call(this),this._bboxSize.addInterest("set_bbox__",this),this._bboxCenter.addInterest("set_bbox__",this),this._appearance.addInterest("set_apparance__",this),this._geometry.addInterest("set_geometry__",this),this._appearance.addInterest("set_transparent__",this),this._geometry.addInterest("set_transparent__",this),this.set_apparance__(),this.set_geometry__(),this.set_transparent__()},getBBox:function(t,e){return e?this._castShadow.getValue()?t.assign(this.bbox):t.set():t.assign(this.bbox)},getBBoxSize:function(){return this.bboxSize},getBBoxCenter:function(){return this.bboxCenter},getAppearance:function(){return this.apparanceNode},getGeometry:function(){return this.geometryNode},setTransparent:function(t){this.transparent=t},getTransparent:function(){return this.transparent},set_bbox__:function(){this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.getGeometry()?this.bbox.assign(this.getGeometry().getBBox()):this.bbox.set():this.bbox.set(this._bboxSize.getValue(),this._bboxCenter.getValue()),this.bboxSize.assign(this.bbox.size),this.bboxCenter.assign(this.bbox.center)},set_apparance__:function(){this.apparanceNode&&this.apparanceNode._transparent.removeInterest("set_transparent__",this),this.apparanceNode=mr(o.X3DAppearanceNode,this._appearance),this.apparanceNode?(this.apparanceNode._alphaMode.addInterest("set_transparent__",this),this.apparanceNode._transparent.addInterest("set_transparent__",this)):this.apparanceNode=this.getBrowser().getDefaultAppearance()},set_geometry__:function(){this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.geometryNode=mr(o.X3DGeometryNode,this._geometry),this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.set_bbox__()},set_transparent__:function(){this.apparanceNode.getAlphaMode()===nc.AUTO?this.transparent=this.apparanceNode.getTransparent()||this.geometryNode&&this.geometryNode.getTransparent():this.transparent=this.apparanceNode.getTransparent()}});const oc=ic;function rc(t,e){this.point=t.copy(),this.direction=e.copy()}rc.prototype={constructor:rc,copy:function(){const t=Object.create(rc.prototype);return t.point=this.point.copy(),t.direction=this.direction.copy(),t},assign:function(t){return this.point.assign(t.point),this.direction.assign(t.direction),this},set:function(t,e){return this.point.assign(t),this.direction.assign(e),this},setPoints:function(t,e){return this.point.assign(t),this.direction.assign(e).subtract(t).normalize(),this},multMatrixLine:function(t){return t.multMatrixVec(this.point),t.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(t){return t.multVecMatrix(this.point),t.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(t,e){const n=e.assign(t).subtract(this.point).dot(this.direction);return e.assign(this.direction).multiply(n).add(this.point)},getClosestPointToLine:function(){const t=new qt(0,0,0);return function(e,n){const i=this.point,o=e.point,r=this.direction,s=e.direction;let a=r.dot(s);return!(Math.abs(a)>=1)&&(t.assign(o).subtract(i),a=(t.dot(r)-a*t.dot(s))/(1-a*a),n.assign(r).multiply(a).add(i),!0)}}(),getPerpendicularVectorToPoint:function(){const t=new qt(0,0,0);return function(e,n){return n.assign(this.point).subtract(e),n.subtract(t.assign(this.direction).multiply(n.dot(this.direction)))}}(),getPerpendicularVectorToLine:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i){const o=i;t.assign(this.point).subtract(n.point);const r=t.dot(this.direction),s=t.dot(n.direction),a=this.direction.dot(n.direction),u=a*a,c=(r-s*a)/(1-u),l=-(s-r*a)/(1-u);return e.assign(this.direction).multiply(c),o.assign(n.direction).multiply(l),o.subtract(e).add(t)}}(),intersectsTriangle:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i,o,r){const s=i.subtract(n),a=o.subtract(n);t.assign(this.direction).cross(a);const u=s.dot(t);if(0===u)return!1;const c=1/u;e.assign(this.point).subtract(n);const l=e.dot(t)*c;if(l<0||l>1)return!1;const h=e.cross(s),d=this.direction.dot(h)*c;return!(d<0||l+d>1)&&(r.u=l,r.v=d,r.t=1-l-d,!0)}}(),toString:function(){return this.point+", "+this.direction}},rc.Points=function(t,e){const n=Object.create(rc.prototype);return n.point=t.copy(),n.direction=qt.subtract(e,t).normalize(),n};const sc=rc;function ac(t,e){this.array=t,e&&(this.compare=e)}ac.prototype={compare:function(t,e){return t<e},sort:function(t,e){e-t>1&&this.quicksort(t,e-1)},quicksort:function(t,e){let n=t,i=e;const o=this.array,r=this.compare,s=o[t+e>>>1];for(;;){for(;r(o[n],s);)++n;for(;r(s,o[i]);)--i;if(!(n<i)){n===i&&(++n,--i);break}{const t=o[n];o[n]=o[i],o[i]=t,n++,i--}}t<i&&this.quicksort(t,i),n<e&&this.quicksort(n,e)}};const uc=ac;function cc(t){oc.call(this,t),this.addType(o.Shape)}cc.prototype=Object.assign(Object.create(oc.prototype),{constructor:cc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"castShadow",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.inputOutput,"appearance",new Bn.SFNode),new z(o.inputOutput,"geometry",new Bn.SFNode)]),getTypeName:function(){return"Shape"},getComponentName:function(){return"Shape"},getContainerField:function(){return"children"},initialize:function(){oc.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this.set_transformSensors__()},getShapeKey:function(){return 0},set_geometry__:function(){oc.prototype.set_geometry__.call(this),this.getGeometry()?delete this.traverse:this.traverse=Function.prototype},set_transformSensors__:function(){this.setPickableObject(this.getTransformSensors().size)},intersectsBox:function(t,e,n){return this.getGeometry().intersectsBox(t,e,n)},traverse:function(t,e){switch(t){case ir.POINTER:this.pointer(e);break;case ir.PICKING:this.picking(e);break;case ir.COLLISION:e.addCollisionShape(this);break;case ir.SHADOW:this._castShadow.getValue()&&e.addShadowShape(this);break;case ir.DISPLAY:e.addDisplayShape(this)&&this.getAppearance().traverse(t,e)}this.getGeometry().traverse(t,e)},pointer:function(){const t=new Ne,e=new Ne,n=new sc(new qt(0,0,0),new qt(0,0,0)),i=[],o=new uc(i,(function(t,e){return t.point.z>e.point.z})),r=function(t,e){return t.point.z>e};return function(s){const a=this.getBrowser();if(a.getPickOnlySensors()&&1===a.getSensors().length)return;const u=this.getGeometry();if(t.assign(s.getModelViewMatrix().get()),e.assign(t).inverse(),n.assign(a.getHitRay()).multLineMatrix(e),u.intersectsLine(n,s,e,this.getAppearance(),i)){for(const e of i)t.multVecMatrix(e.point);o.sort(0,i.length);const n=et.lowerBound(i,0,i.length,-s.getNavigationInfo().getNearValue(),r);n!==i.length&&(e.multMatrixDir(i[n].normal).normalize(),a.addHit(i[n],s.getLayer(),this,t.multRight(s.getCameraSpaceMatrix().get()))),i.length=0}}}(),picking:function(t){const e=t.getModelViewMatrix().get();if(this.getTransformSensors().size)for(const t of this.getTransformSensors())t.collect(e);const n=this.getBrowser(),i=n.getPickSensors(),o=n.getPickingHierarchy();o.push(this);for(const t of i.at(-1))t.collect(this.getGeometry(),e,o);o.pop()},depth:function(t,e,n){const i=e.clipPlanes,o=this.getBrowser().getDepthShader(i.length,!1);o.enable(t),o.setClipPlanes(t,i),t.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,n),t.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,e.modelViewMatrix),this.getGeometry().depth(t,e,o)},display:function(t,e){this.getGeometry().display(t,e)}});const lc=cc;function hc(t,e){this.point=t.copy(),this.direction=e.copy()}hc.prototype={constructor:hc,copy:function(){const t=Object.create(hc.prototype);return t.point=this.point.copy(),t.direction=this.direction.copy(),t},assign:function(t){return this.point.assign(t.point),this.direction.assign(t.direction),this},set:function(t,e){return this.point.assign(t),this.direction.assign(e),this},setPoints:function(t,e){return this.point.assign(t),this.direction.assign(e).subtract(t).normalize(),this},multMatrixLine:function(t){return t.multMatrixVec(this.point),t.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(t){return t.multVecMatrix(this.point),t.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(t,e){const n=e.assign(t).subtract(this.point).dot(this.direction);return e.assign(this.direction).multiply(n).add(this.point)},getPerpendicularVectorToPoint:function(){const t=new jt(0,0);return function(e,n){return n.assign(this.point).subtract(e),n.subtract(t.assign(this.direction).multiply(n.dot(this.direction)))}}(),intersectsLine:function(){const t=new jt(0,0);return function(e,n){const i=this.point,o=e.point,r=this.direction,s=e.direction,a=r.dot(s);if(Math.abs(a)>=1)return!1;t.assign(o).subtract(i);const u=(t.dot(r)-a*t.dot(s))/(1-a*a);return n.assign(r).multiply(u).add(i),!0}}(),toString:function(){return this.point+", "+this.direction}},hc.Points=function(t,e){const n=Object.create(hc.prototype);return n.point=t.copy(),n.direction=jt.subtract(e,t).normalize(),n};const dc=hc;function fc(t){this.getExecutionContext()||Gr.call(this,t);const e=this.getBrowser().getContext();this.transformVertexArrayObject=new zr,this.thickVertexArrayObject=new zr,this.lineStippleBuffer=e.createBuffer(),this.trianglesBuffer=e.createBuffer(),this.setGeometryType(1),this.setPrimitiveMode(e.LINES),this.setSolid(!1)}fc.prototype=Object.assign(Object.create(Gr.prototype),{constructor:fc,updateVertexArrays:function(){Gr.prototype.updateVertexArrays.call(this),this.transformVertexArrayObject.update(),this.thickVertexArrayObject.update()},intersectsLine:function(){const t=new ur,e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0),o=new qt(0,0,0),r=new Ne,s=new qt(0,0,0),a=new qt(0,0,0),u=new jt(0,0),c=new jt(0,0),l=new dc(jt.Zero,jt.yAxis),h=new jt(0,0),d=new sc(qt.Zero,qt.zAxis),f=new sc(qt.Zero,qt.zAxis),p=new qt(0,0,0),g=new Wt,m=new qt(0,0,0);return function(_,x,y,w,T){const S=x.getModelViewMatrix().get(),b=x.getViewVolume().getViewport(),v=(t.assign(this.getBBox()).multRight(S).getExtents(e,n),w.getLineProperties()),E=Math.max(1.5,v&&v.getApplied()?v.getLinewidthScaleFactor()/2:1),C=x.getViewpoint().getScreenScale(e,b,i),O=y.multDirMatrix(C.multiply(E)),F=x.getViewpoint().getScreenScale(n,b,o),N=y.multDirMatrix(F.multiply(E));if(this.intersectsBBox(_,O.abs().max(N.abs()))){const t=this.getBrowser().getPointer(),e=x.getProjectionMatrix().get(),n=x.getLocalObjects(),i=this.getVertices(),o=i.length;r.assign(S).multRight(e);for(let _=0;_<o;_+=8)if(s.set(i[_+0],i[_+1],i[_+2]),a.set(i[_+4],i[_+5],i[_+6]),Jo.projectPointMatrix(s,r,b,u),Jo.projectPointMatrix(a,r,b,c),l.setPoints(u,c),l.getClosestPointToPoint(t,h)){const i=u.distance(c),o=u.distance(h),r=c.distance(h);if(o<=i&&r<=i&&h.distance(t)<=E){if(n.length&&this.isClipped(S.multVecMatrix(m.assign(h)),n))continue;const r=l.direction,u=g.set(r.x,r.y,-r.y,r.x).inverse().multVecMatrix(t.copy().subtract(h)),c=u.set(o/i,(u.y/E+1)/2),_=a.copy().subtract(s).normalize();Jo.unProjectRay(h.x,h.y,S,e,b,d),f.setPoints(s,a).getClosestPointToLine(d,p),T.push({texCoord:c,normal:_,point:p.copy()})}}}return T.length}}(),intersectsLineWithGeometry:function(){return!1},intersectsBox:function(t,e,n){return!1},buildTexCoords:function(){const t=this.getTexCoords();if(t.getValue().length/6!=this.getVertices().length/8){const e=this.getBrowser().getContext(),n=this.getVertices().length/8;t.length=6*n,t.fill(0),t.shrinkToFit(),e.bindBuffer(e.ARRAY_BUFFER,this.lineStippleBuffer),e.bufferData(e.ARRAY_BUFFER,t.getValue(),e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.trianglesBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(72*n),e.DYNAMIC_DRAW)}},updateLengthSoFar:function(){const t=new Ne,e=new ae(0,0,0),n=new ae(0,0,0),i=new jt(0,0),o=new jt(0,0);return function(r,s){const a=s.renderObject.getViewVolume().getViewport(),u=s.renderObject.getProjectionMatrix().get(),c=this.getTexCoords().getValue(),l=this.getVertices(),h=l.length;t.assign(s.modelViewMatrix).multRight(u);let d=0;for(let r=0,s=0;r<h;r+=8,s+=6)e.set(l[r],l[r+1],l[r+2],l[r+3]),n.set(l[r+4],l[r+5],l[r+6],l[r+7]),Jo.projectPointMatrix(e,t,a,i),Jo.projectPointMatrix(n,t,a,o),c[s]=o.x,c[s+1]=o.y,c[s+3]=i.x,c[s+4]=i.y,c[s+5]=d,d+=o.subtract(i).magnitude();r.bindBuffer(r.ARRAY_BUFFER,this.lineStippleBuffer),r.bufferData(r.ARRAY_BUFFER,c,r.DYNAMIC_DRAW)}}(),display:function(){const t=new Ne,e=new Float32Array(16),n=new Float32Array(16);return function(i,o){const r=this.getBrowser(),s=o.appearanceNode,a=s.getLineProperties(),u=s.getShader(this,o),c=s.getBlendMode(),l=this.getAttrib(),h=this.getAttribBuffers();if(a&&(a.getApplied()&&1!==a.getLinetype()&&this.updateLengthSoFar(i,o),a.getTransformLines())){const s=o.renderObject,l=s.getViewVolume().getViewport(),h=s.getProjectionMatrix().get(),d=r.getPrimitiveMode(i.TRIANGLES),f=r.getLineTransformShader();if(e.set(t.assign(o.modelViewMatrix).multRight(h)),n.set(t.inverse()),f.enable(i),i.uniform4f(f.viewport,l.x,l.y,l.z,l.w),i.uniformMatrix4fv(f.modelViewProjectionMatrix,!1,e),i.uniformMatrix4fv(f.invModelViewProjectionMatrix,!1,n),i.uniform1f(f.scale,a.getLinewidthScaleFactor()/2),this.transformVertexArrayObject.enable(i,u)){const t=6*Float32Array.BYTES_PER_ELEMENT,e=0,n=3*Float32Array.BYTES_PER_ELEMENT,o=2*Float32Array.BYTES_PER_ELEMENT,r=0,s=1*Float32Array.BYTES_PER_ELEMENT,a=8*Float32Array.BYTES_PER_ELEMENT,u=0,c=4*Float32Array.BYTES_PER_ELEMENT,l=8*Float32Array.BYTES_PER_ELEMENT,h=0,d=4*Float32Array.BYTES_PER_ELEMENT;f.enableFloatAttrib(i,"x3d_LineStipple0",this.lineStippleBuffer,3,t,e),f.enableFloatAttrib(i,"x3d_LineStipple1",this.lineStippleBuffer,3,t,n),this.hasFogCoords&&(f.enableFloatAttrib(i,"x3d_FogDepth0",this.fogDepthBuffer,1,o,r),f.enableFloatAttrib(i,"x3d_FogDepth1",this.fogDepthBuffer,1,o,s)),this.colorMaterial&&(f.enableFloatAttrib(i,"x3d_Color0",this.colorBuffer,4,a,u),f.enableFloatAttrib(i,"x3d_Color1",this.colorBuffer,4,a,c)),f.enableFloatAttrib(i,"x3d_Vertex0",this.vertexBuffer,4,l,h),f.enableFloatAttrib(i,"x3d_Vertex1",this.vertexBuffer,4,l,d)}if(i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r.getLineTransformFeedback()),i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,0,this.trianglesBuffer),i.enable(i.RASTERIZER_DISCARD),i.beginTransformFeedback(i.POINTS),i.drawArraysInstanced(i.POINTS,0,this.vertexCount/2,2),i.endTransformFeedback(),i.disable(i.RASTERIZER_DISCARD),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),c&&c.enable(i),u.enable(i),u.setUniforms(i,this,o),this.thickVertexArrayObject.enable(i,u)){const t=12*Float32Array.BYTES_PER_ELEMENT,e=0,n=3*Float32Array.BYTES_PER_ELEMENT,o=4*Float32Array.BYTES_PER_ELEMENT,r=8*Float32Array.BYTES_PER_ELEMENT;u.enableLineStippleAttribute(i,this.trianglesBuffer,t,e),this.hasFogCoords&&u.enableFogDepthAttribute(i,this.trianglesBuffer,t,n),this.colorMaterial&&u.enableColorAttribute(i,this.trianglesBuffer,t,o),u.enableVertexAttribute(i,this.trianglesBuffer,t,r),i.bindBuffer(i.ARRAY_BUFFER,null)}if(r.getWireframe())for(let t=0,e=3*this.vertexCount;t<e;t+=3)i.drawArrays(d,t,3);else i.frontFace(i.CCW),i.enable(i.CULL_FACE),i.drawArrays(d,0,3*this.vertexCount);return void(c&&c.disable(i))}const d=r.getPrimitiveMode(this.getPrimitiveMode());if(c&&c.enable(i),u.enable(i),u.setUniforms(i,this,o),this.vertexArrayObject.enable(i,u)){for(let t=0,e=l.length;t<e;++t)l[t].enable(i,u,h[t]);u.enableLineStippleAttribute(i,this.lineStippleBuffer,0,0),this.hasFogCoords&&u.enableFogDepthAttribute(i,this.fogDepthBuffer,0,0),this.colorMaterial&&u.enableColorAttribute(i,this.colorBuffer,0,0),u.enableVertexAttribute(i,this.vertexBuffer,0,0)}i.drawArrays(d,0,this.vertexCount),c&&c.disable(i),i.lineWidth(1)}}(),displayParticles:function(t,e,n){const i=this.getBrowser(),o=e.appearanceNode,r=o.getShader(this,e),s=o.getBlendMode(),a=this.getAttrib(),u=this.getAttribBuffers(),c=i.getPrimitiveMode(this.getPrimitiveMode());s&&s.enable(t),r.enable(t),r.setUniforms(t,this,e);const l=n.outputParticles;if(l.vertexArrayObject.update(this.updateParticles).enable(t,r)){const e=n.particleStride;r.enableParticleAttribute(t,l,e,n.particleOffset,1),r.enableParticleMatrixAttribute(t,l,e,n.matrixOffset,1);for(let e=0,n=a.length;e<n;++e)a[e].enable(t,r,u[e]);this.hasFogCoords&&r.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&r.enableColorAttribute(t,this.colorBuffer,0,0),r.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),r.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}t.drawArraysInstanced(c,0,this.vertexCount,n.numParticles),s&&s.disable(t),t.lineWidth(1)}});const pc=fc;function gc(t){pc.call(this,t),this.addType(o.IndexedLineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}gc.prototype=Object.assign(Object.create(pc.prototype),{constructor:gc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_colorIndex",new Bn.MFInt32),new z(o.inputOnly,"set_coordIndex",new Bn.MFInt32),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"colorIndex",new Bn.MFInt32),new z(o.initializeOnly,"coordIndex",new Bn.MFInt32),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedLineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){pc.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_coordIndex.addFieldInterest(this._coordIndex),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=mr(o.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=mr(o.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=mr(o.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=mr(o.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=mr(o.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},getColorPerVertexIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:this._coordIndex[t]},getColorIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:t},getPolylineIndices:function(){const t=this._coordIndex,e=[];let n=[];if(t.length){for(let i=0,o=t.length;i<o;++i){t[i]>=0?n.push(i):(e.push(n),n=[])}t[t.length-1]>=0&&e.push(n)}return e},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this._coordIndex,e=this.getPolylineIndices(),n=this._colorPerVertex.getValue(),i=this.getAttrib(),o=i.length,r=this.getAttribs(),s=this.fogCoordNode,a=this.colorNode,u=this.coordNode,c=this.getFogDepths(),l=this.getColors(),h=this.getVertices();let d=0;for(const f of e){if(f.length>1)for(let e=0,p=f.length-1;e<p;++e)for(let p=e,g=e+2;p<g;++p){const e=f[p],g=t[e];for(let t=0;t<o;++t)i[t].addValue(g,r[t]);s&&s.addDepth(g,c),a&&(n?a.addColor(this.getColorPerVertexIndex(e),l):a.addColor(this.getColorIndex(d),l)),u.addPoint(g,h)}++d}}});const mc=gc;function _c(t){Du.call(this,t),this.addType(o.X3DColorNode),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(o.outputOnly)}_c.prototype=Object.assign(Object.create(Du.prototype),{constructor:_c,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()}});const xc=_c;function yc(t){xc.call(this,t),this.addType(o.Color)}yc.prototype=Object.assign(Object.create(xc.prototype),{constructor:yc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.MFColor)]),getTypeName:function(){return"Color"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},initialize:function(){xc.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__:function(){this.color=this._color.getValue(),this.length=this._color.length},addColor:function(t,e){if(t>=0&&t<this.length){const n=this.color;t*=3,e.push(n[t],n[t+1],n[t+2],1)}else if(this.length){const n=this.color;t=3*(this.length-1),e.push(n[t],n[t+1],n[t+2],1)}else e.push(1,1,1,1)},addColors:function(t,e){if(this.length){const o=this.color;for(var n=0,i=3*Math.min(e,this.length);n<i;n+=3)t.push(o[n],o[n+1],o[n+2],1);if(this.length<e){const r=o[n=3*(this.length-1)],s=o[n+1],a=o[n+2];for(n=i,i=3*e;n<i;n+=3)t.push(r,s,a,1)}}else for(let n=0;n<e;++n)t.push(1,1,1,1);return t}});const wc=yc,Tc=Symbol();function Sc(){}Sc.prototype={initialize:function(){},getBBoxNode:function(){const t=new lc(this.getPrivateScene()),e=new mc(this.getPrivateScene()),n=new wc(this.getPrivateScene()),i=new Lu(this.getPrivateScene());return t._geometry=e,e._coordIndex=new Bn.MFFloat(0,1,2,3,0,-1,4,5,6,7,4,-1,0,4,-1,1,5,-1,2,6,-1,3,7,-1),e._color=n,e._coord=i,n._color=new Bn.MFColor(new Bn.SFColor(1,1,1)),i._point=new Bn.MFVec3f(new Bn.SFVec3f(.5,.5,.5),new Bn.SFVec3f(-.5,.5,.5),new Bn.SFVec3f(-.5,-.5,.5),new Bn.SFVec3f(.5,-.5,.5),new Bn.SFVec3f(.5,.5,-.5),new Bn.SFVec3f(-.5,.5,-.5),new Bn.SFVec3f(-.5,-.5,-.5),new Bn.SFVec3f(.5,-.5,-.5)),i.setup(),n.setup(),e.setup(),t.setup(),this[Tc]=t,this.getBBoxNode=function(){return this[Tc]},Object.defineProperty(this,"getBBoxNode",{enumerable:!1}),t}};const bc=Sc,vc=Dr(Jo);function Ec(t){br.call(this,t),this.addType(o.Viewport),this.rectangle=new ae(0,0,0,0)}Ec.prototype=Object.assign(Object.create(br.prototype),{constructor:Ec,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"clipBoundary",new Bn.MFFloat(0,1,0,1)),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Viewport"},getComponentName:function(){return"Layering"},getContainerField:function(){return"viewport"},getRectangle:function(t){const e=t.getViewport(),n=Math.floor(e[2]*this.getLeft()),i=Math.floor(e[2]*this.getRight()),o=Math.floor(e[3]*this.getBottom()),r=Math.floor(e[3]*this.getTop());return this.rectangle.set(n,o,Math.max(0,i-n),Math.max(0,r-o)),this.rectangle},getLeft:function(){return this._clipBoundary.length>0?this._clipBoundary[0]:0},getRight:function(){return this._clipBoundary.length>1?this._clipBoundary[1]:1},getBottom:function(){return this._clipBoundary.length>2?this._clipBoundary[2]:0},getTop:function(){return this._clipBoundary.length>3?this._clipBoundary[3]:1},traverse:function(t,e){if(this.push(e),t===ir.POINTER)this.getBrowser().isPointerInRectangle(this.rectangle)&&br.prototype.traverse.call(this,t,e);else br.prototype.traverse.call(this,t,e);this.pop(e)},push:function(t){const e=t.getViewVolumes(),n=this.getRectangle(this.getBrowser()),i=e.length?e.at(-1).getViewport():n,o=vc.pop();o.set(t.getProjectionMatrix().get(),i,n),e.push(o)},pop:function(t){vc.push(t.getViewVolumes().pop())}});const Cc=Ec,Oc=Symbol();function Fc(){this[Oc]=new Cc(this.getPrivateScene())}Fc.prototype={initialize:function(){this[Oc].setPrivate(!0),this[Oc].setup()},getDefaultViewport:function(){return this[Oc]}};const Nc=Fc,Mc=Symbol(),Vc=Symbol();function Ic(){const t=this.getContext(),e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this[Mc]=e>8?8:2,this[Vc]=[]}Ic.prototype={initialize:function(){},getMaxLights:function(){return this[Mc]},popShadowBuffer:function(t){try{const e=this[Vc][t];if(e){if(e.length)return e.pop()}else this[Vc][t]=[];return new er(this,t,t)}catch(t){return console.error(t),null}},pushShadowBuffer:function(t){t&&this[Vc][t.getWidth()].push(t)}};const Dc=Ic;function Rc(t){Vs.call(this,t),this.addType(o.OrthoViewpoint),this.addChildObjects("fieldOfViewOffset",new Bn.MFFloat(0,0,0,0)),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("length"),this.projectionMatrix=new Ne,this.fieldOfViewOffsetInterpolator0=new Ds(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator1=new Ds(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator2=new Ds(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator3=new Ds(this.getBrowser().getPrivateScene()),this.fieldOfViewScaleInterpolator=new Ds(this.getBrowser().getPrivateScene())}Rc.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Rc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_bind",new Bn.SFBool),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"position",new Bn.SFVec3f(0,0,10)),new z(o.inputOutput,"orientation",new Bn.SFRotation),new z(o.inputOutput,"centerOfRotation",new Bn.SFVec3f),new z(o.inputOutput,"fieldOfView",new Bn.MFFloat(-1,-1,1,1)),new z(o.inputOutput,"jump",new Bn.SFBool(!0)),new z(o.inputOutput,"retainUserOffsets",new Bn.SFBool),new z(o.outputOnly,"isBound",new Bn.SFBool),new z(o.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"OrthoViewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Vs.prototype.initialize.call(this),this._fieldOfView.addInterest("set_fieldOfView__",this),this._fieldOfViewOffset.addInterest("set_fieldOfView__",this),this._fieldOfViewScale.addInterest("set_fieldOfView__",this),this.fieldOfViewOffsetInterpolator0._key=new Bn.MFFloat(0,1),this.fieldOfViewOffsetInterpolator1._key=new Bn.MFFloat(0,1),this.fieldOfViewOffsetInterpolator2._key=new Bn.MFFloat(0,1),this.fieldOfViewOffsetInterpolator3._key=new Bn.MFFloat(0,1),this.fieldOfViewScaleInterpolator._key=new Bn.MFFloat(0,1),this.fieldOfViewOffsetInterpolator0.setup(),this.fieldOfViewOffsetInterpolator1.setup(),this.fieldOfViewOffsetInterpolator2.setup(),this.fieldOfViewOffsetInterpolator3.setup(),this.fieldOfViewScaleInterpolator.setup(),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator0._set_fraction),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator1._set_fraction),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator2._set_fraction),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator3._set_fraction),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewScaleInterpolator._set_fraction),this.fieldOfViewOffsetInterpolator0._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator1._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator2._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator3._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewScaleInterpolator._value_changed.addFieldInterest(this._fieldOfViewScale),this.set_fieldOfView__()},set_fieldOfView__:function(){const t=this._fieldOfView.length,e=this._fieldOfViewScale.getValue();this.minimumX=((t>0?this._fieldOfView[0]:-1)+this._fieldOfViewOffset[0])*e,this.minimumY=((t>1?this._fieldOfView[1]:-1)+this._fieldOfViewOffset[1])*e,this.maximumX=((t>2?this._fieldOfView[2]:1)+this._fieldOfViewOffset[2])*e,this.maximumY=((t>3?this._fieldOfView[3]:1)+this._fieldOfViewOffset[3])*e,this.sizeX=this.maximumX-this.minimumX,this.sizeY=this.maximumY-this.minimumY},set_fieldOfViewOffset__:function(){this._fieldOfViewOffset[0]=this.fieldOfViewOffsetInterpolator0._value_changed.getValue(),this._fieldOfViewOffset[1]=this.fieldOfViewOffsetInterpolator1._value_changed.getValue(),this._fieldOfViewOffset[2]=this.fieldOfViewOffsetInterpolator2._value_changed.getValue(),this._fieldOfViewOffset[3]=this.fieldOfViewOffsetInterpolator3._value_changed.getValue()},setInterpolators:function(t,e){if(t.getType().includes(o.OrthoViewpoint)){const n=e._fieldOfView.length,i=t._fieldOfView.length,o=(i>0?t._fieldOfView[0]:-1)-(n>0?e._fieldOfView[0]:-1),r=(i>1?t._fieldOfView[1]:-1)-(n>1?e._fieldOfView[1]:-1),s=(i>2?t._fieldOfView[2]:1)-(n>2?e._fieldOfView[2]:1),a=(i>3?t._fieldOfView[3]:1)-(n>3?e._fieldOfView[3]:1);this.fieldOfViewOffsetInterpolator0._keyValue=new Bn.MFFloat(o,e._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new Bn.MFFloat(r,e._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new Bn.MFFloat(s,e._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new Bn.MFFloat(a,e._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new Bn.MFFloat(t._fieldOfViewScale.getValue(),e._fieldOfViewScale.getValue()),this._fieldOfViewOffset[0]=o,this._fieldOfViewOffset[1]=r,this._fieldOfViewOffset[2]=s,this._fieldOfViewOffset[3]=a,this._fieldOfViewScale=t._fieldOfViewScale.getValue()}else this.fieldOfViewOffsetInterpolator0._keyValue=new Bn.MFFloat(e._fieldOfViewOffset[0],e._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new Bn.MFFloat(e._fieldOfViewOffset[1],e._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new Bn.MFFloat(e._fieldOfViewOffset[2],e._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new Bn.MFFloat(e._fieldOfViewOffset[3],e._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new Bn.MFFloat(e._fieldOfViewScale.getValue(),e._fieldOfViewScale.getValue()),this._fieldOfViewOffset=e._fieldOfViewOffset.getValue(),this._fieldOfViewScale=e._fieldOfViewScale.getValue()},getLogarithmicDepthBuffer:function(){return!1},getMinimumX:function(){return this.minimumX},getMinimumY:function(){return this.minimumY},getMaximumX:function(){return this.maximumX},getMaximumY:function(){return this.maximumY},getSizeX:function(){return this.sizeX},getSizeY:function(){return this.sizeY},getMaxFarValue:function(){return 1e5},getScreenScale:function(t,e,n){const i=e[2],o=e[3],r=this.sizeX,s=this.sizeY;if(i/o>r/s){const t=s/o;return n.set(t,t,t)}{const t=r/i;return n.set(t,t,t)}},getViewportSize:function(){const t=new jt(0,0);return function(e,n){const i=e[2],o=e[3],r=this.sizeX,s=this.sizeY,a=i/o;return a>r/s?t.set(s*a,s):t.set(r,r/a)}}(),getLookAtDistance:function(t){return t.size.magnitude()/2+10},getProjectionMatrixWithLimits:function(t,e,n){const i=n[2]/n[3],o=this.sizeX,r=this.sizeY;if(i>o/r){const n=(this.minimumX+this.maximumX)/2,o=r*i/2;return sr.ortho(n-o,n+o,this.minimumY,this.maximumY,t,e,this.projectionMatrix)}{const n=(this.minimumY+this.maximumY)/2,r=o/i/2;return sr.ortho(this.minimumX,this.maximumX,n-r,n+r,t,e,this.projectionMatrix)}}});const Pc=Rc;function Ac(t){Zn.call(this,t)}Ac.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Ac,getTypeName:function(){return"X3DViewer"},initialize:function(){},getActiveLayer:function(){return this.getBrowser().getActiveLayer()},getViewport:function(){return this.getBrowser().getActiveLayer().getViewport()},getNavigationInfo:function(){return this.getBrowser().getActiveLayer().getNavigationInfo()},getActiveViewpoint:function(){return this.getBrowser().getActiveLayer().getViewpoint()},getStraightenHorizon:function(){return this.getBrowser().getBrowserOption("StraightenHorizon")},getButton:function(t){return 0===t&&this.getBrowser().getAltKey()?1:t},getPointOnCenterPlane:function(){const t=new qt(0,0,-1),e=new qt(0,0,0),n=new qt(0,0,0);return function(i,o,r){const s=this.getNavigationInfo(),a=this.getActiveViewpoint(),u=this.getViewport().getRectangle(this.getBrowser()),c=a.getProjectionMatrixWithLimits(s.getNearValue(),s.getFarValue(a),u);if(Jo.unProjectPoint(i,this.getBrowser().getViewport()[3]-o,.9,Ne.Identity,c,u,n),a instanceof Pc)return r.set(n.x,n.y,-this.getDistanceToCenter(e).magnitude());const l=n.normalize();return r.assign(l).multiply(this.getDistanceToCenter(e).magnitude()/l.dot(t))}}(),getDistanceToCenter:function(t,e){const n=this.getActiveViewpoint();return t.assign(n.getPosition()).add(e||n._positionOffset.getValue()).subtract(n.getUserCenterOfRotation())},trackballProjectToSphere:function(t,e,n){const i=this.getViewport().getRectangle(this.getBrowser());return e=this.getBrowser().getViewport()[3]-e,t=(t-i[0])/i[2]-.5,e=(e-i[1])/i[3]-.5,n.set(t,e,function(t,e,n){const i=Math.hypot(e,n);if(i<t*Math.sqrt(.5))return Math.sqrt(t*t-i*i);const o=t/Math.sqrt(2);return o*o/i}(.5,t,e))},lookAtPoint:function(t,e,n){if(!this.touch(t,e))return;const i=this.getBrowser().getNearestHit();this.getActiveViewpoint().lookAtPoint(this.getActiveLayer(),i.intersection.point,.381966,n)},lookAtBBox:function(){const t=new ur;return function(e,n,i){if(!this.touch(e,n))return;const o=this.getBrowser().getNearestHit();o.shape.getBBox(t).multRight(o.modelViewMatrix),this.getActiveViewpoint().lookAtBBox(this.getActiveLayer(),t,.381966,i)}}(),touch:function(t,e){return this.getBrowser().touch(t,e,!1),this.getBrowser().getHits().length},dispose:function(){}});const Lc=Ac;function Bc(t){gr.call(this,t),this.addType(o.X3DFollowerNode),this.buffer=[],this.a=this.getVector(),this.vector=this.getVector()}Bc.prototype=Object.assign(Object.create(gr.prototype),{constructor:Bc,initialize:function(){gr.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this)},getBuffer:function(){return this.buffer},getValue:function(){return this._set_value.getValue()},getDestination:function(){return this._set_destination.getValue()},getInitialValue:function(){return this._initialValue.getValue()},getInitialDestination:function(){return this._initialDestination.getValue()},setValue:function(t){this._value_changed=t},setDestination:function(t){this.destination.assign(t)},duplicate:function(t){return t.copy()},assign:function(t,e,n){t[e].assign(n)},equals:function(t,e,n){return this.a.assign(t).subtract(e).magnitude()<n},interpolate:function(t,e,n){return this.vector.assign(t).lerp(e,n)},set_live__:function(){(this.isLive().getValue()||this.isPrivate())&&this._isActive.getValue()?(this.getBrowser().prepareEvents().addInterest("prepareEvents",this),this.getBrowser().addBrowserEvent()):this.getBrowser().prepareEvents().removeInterest("prepareEvents",this)},set_active:function(t){t!==this._isActive.getValue()&&(this._isActive=t,this.set_live__())}});const Xc=Bc;function Uc(t){Xc.call(this,t),this.addType(o.X3DChaserNode),this.destination=null,this.previousValue=null,this.bufferEndTime=0,this.stepTime=0,this.deltaOut=this.getVector()}Uc.prototype=Object.assign(Object.create(Xc.prototype),{constructor:Uc,initialize:function(){Xc.prototype.initialize.call(this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this),this._duration.addInterest("set_duration__",this),this.set_duration__();var t=this.getBuffer(),e=this.getInitialValue(),n=this.getInitialDestination(),i=this.getNumBuffers();this.bufferEndTime=this.getBrowser().getCurrentTime(),this.previousValue=this.duplicate(e),t[0]=this.duplicate(n);for(var o=1;o<i;++o)t[o]=this.duplicate(e);this.destination=this.duplicate(n),this.equals(n,e,this.getTolerance())?this.setValue(n):this.set_active(!0)},getNumBuffers:function(){return 60},getTolerance:function(){return 1e-8},getArray:function(){return this.getVector()},setPreviousValue:function(t){this.previousValue.assign(t)},step:function(t,e,n){this.output.add(this.deltaOut.assign(t).subtract(e).multiply(n))},stepResponse:function(t){if(t<=0)return 0;var e=this._duration.getValue();return t>=e?1:.5-.5*Math.cos(t/e*Math.PI)},set_value__:function(){this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime());for(var t=this.getBuffer(),e=this.getValue(),n=0,i=t.length;n<i;++n)this.assign(t,n,e);this.setPreviousValue(e),this.setValue(e),this.set_active(!0)},set_destination__:function(){this.setDestination(this.getDestination()),this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime()),this.set_active(!0)},set_duration__:function(){this.stepTime=this._duration.getValue()/this.getNumBuffers()},prepareEvents:function(){var t=this.getBuffer(),e=t.length,n=this.updateBuffer();this.output=this.interpolate(this.previousValue,t[e-1],this.stepResponse((e-1+n)*this.stepTime));for(var i=e-2;i>=0;--i)this.step(t[i],t[i+1],this.stepResponse((i+n)*this.stepTime));this.setValue(this.output),this.equals(this.output,this.destination,this.getTolerance())&&this.set_active(!1)},updateBuffer:function(){var t=this.getBuffer(),e=t.length,n=(this.getBrowser().getCurrentTime()-this.bufferEndTime)/this.stepTime;if(n>=1){var i=Math.floor(n);if(n-=i,i<e){this.setPreviousValue(t[e-i]);for(var o=e-1;o>=i;--o)this.assign(t,o,t[o-i]);for(o=0;o<i;++o){var r=o/i;this.assign(t,o,this.interpolate(this.destination,t[i],r))}}else{this.setPreviousValue(i==e?t[0]:this.destination);for(o=0;o<e;++o)this.assign(t,o,this.destination)}this.bufferEndTime+=i*this.stepTime}return n}});const zc=Uc;function jc(t){zc.call(this,t),this.addType(o.PositionChaser)}jc.prototype=Object.assign(Object.create(zc.prototype),{constructor:jc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFVec3f),new z(o.inputOnly,"set_destination",new Bn.SFVec3f),new z(o.initializeOnly,"initialValue",new Bn.SFVec3f),new z(o.initializeOnly,"initialDestination",new Bn.SFVec3f),new z(o.initializeOnly,"duration",new Bn.SFTime(1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFVec3f)]),getTypeName:function(){return"PositionChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new qt(0,0,0)}});const kc=jc;var Gc=new Ce(0,0,1,0),Hc=new Ce(0,0,1,0);function qc(t){zc.call(this,t),this.addType(o.OrientationChaser),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}qc.prototype=Object.assign(Object.create(zc.prototype),{constructor:qc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFRotation),new z(o.inputOnly,"set_destination",new Bn.SFRotation),new z(o.initializeOnly,"initialValue",new Bn.SFRotation),new z(o.initializeOnly,"initialDestination",new Bn.SFRotation),new z(o.initializeOnly,"duration",new Bn.SFTime(1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFRotation)]),getTypeName:function(){return"OrientationChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new Ce(0,0,1,0)},equals:function(t,e,n){return Gc.assign(t).inverse().multRight(e),Math.abs(Gc.angle)<n},interpolate:function(t,e,n){return Hc.assign(t).slerp(e,n)},step:function(t,e,n){this.deltaOut.assign(e).inverse().multRight(t).multLeft(this.output),this.output.slerp(this.deltaOut,n)}});const Yc=qc,Wc=/Mac OS X/i.test(navigator.userAgent),$c=Wc?1/120:.05;function Kc(t){Lc.call(this,t),this.button=-1,this.orientationOffset=new Ce(0,0,1,0),this.fromVector=new qt(0,0,0),this.toVector=new qt(0,0,0),this.fromPoint=new qt(0,0,0),this.toPoint=new qt(0,0,0),this.rotation=new Ce(0,0,1,0),this.pressTime=0,this.motionTime=0,this.touchMode=0,this.touch1=new jt(0,0),this.touch2=new jt(0,0),this.tapStart=0,this.dblTapInterval=.4,this.initialPositionOffset=new qt(0,0,0),this.initialOrientationOffset=new Ce(0,0,1,0),this.positionChaser=new kc(t),this.centerOfRotationChaser=new kc(t),this.rotationChaser=new Yc(t)}Kc.prototype=Object.assign(Object.create(Lc.prototype),{constructor:Kc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.outputOnly,"isActive",new Bn.SFBool)]),initialize:function(){Lc.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getSurface();this.getNavigationInfo()._transitionStart.addInterest("disconnect",this),t._activeViewpoint.addInterest("set_activeViewpoint__",this),e.on("mousedown.ExamineViewer",this.mousedown.bind(this)),e.on("mouseup.ExamineViewer",this.mouseup.bind(this)),e.on("dblclick.ExamineViewer",this.dblclick.bind(this)),e.on("mousewheel.ExamineViewer",this.mousewheel.bind(this)),e.on("touchstart.ExamineViewer",this.touchstart.bind(this)),e.on("touchend.ExamineViewer",this.touchend.bind(this)),this.positionChaser._duration=.2,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.2,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.rotationChaser._duration=.2,this.rotationChaser.setPrivate(!0),this.rotationChaser.setup(),this.set_activeViewpoint__()},set_activeViewpoint__:function(){if(this.getStraightenHorizon()){const t=this.getActiveViewpoint();t&&(t._orientationOffset=this.getOrientationOffset(Ce.Identity,t._orientationOffset.getValue(),!1))}this.disconnect()},mousedown:function(t){if(this.button>=0)return;this.pressTime=performance.now();const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,$(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),$(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),$(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),$(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.trackballProjectToSphere(n,i,this.fromVector),this.rotation.assign(Ce.Identity),this.motionTime=0,this._isActive=!0;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,$(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),$(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),$(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),$(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(n,i,this.fromPoint),this._isActive=!0}},mouseup:function(t){if(t.button===this.button)switch(this.button=-1,$(document).off(".ExamineViewer"+this.getId()),this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation();this.getActiveViewpoint();this.getBrowser().setCursor("DEFAULT"),Math.abs(this.rotation.angle)>.003&&performance.now()-this.motionTime<40&&(this.getStraightenHorizon()&&(this.rotation=this.getHorizonRotation(this.rotation)),this.addSpinning(this.rotation)),this._isActive=!1;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1}},dblclick:function(t){t.preventDefault(),t.stopImmediatePropagation();const e=this.getBrowser().getSurface(),n=e.offset(),i=t.pageX-n.left-parseFloat(e.css("borderLeftWidth")),o=e.innerHeight()-(t.pageY-n.top-parseFloat(e.css("borderTopWidth")));this.disconnect(),this.lookAtBBox(i,o,this.getStraightenHorizon())},mousemove:function(){const t=new qt(0,0,0);return function(e){const n=this.getBrowser().getSurface().offset(),i=e.pageX-n.left,o=e.pageY-n.top;switch(this.getButton(this.button)){case 0:{e.preventDefault(),e.stopImmediatePropagation();const t=this.trackballProjectToSphere(i,o,this.toVector);if(this.rotation.setFromToVec(t,this.fromVector),Math.abs(this.rotation.angle)<.003&&performance.now()-this.pressTime<50)return;this.addRotate(this.rotation),this.fromVector.assign(t),this.motionTime=performance.now();break}case 1:{e.preventDefault(),e.stopImmediatePropagation();const n=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(i,o,this.toPoint),s=n.getUserOrientation().multVecRot(t.assign(this.fromPoint).subtract(r));this.addMove(s,s),this.fromPoint.assign(r);break}}}}(),mousewheel:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n){n.preventDefault(),n.stopImmediatePropagation();const i=this.getBrowser(),o=this.getActiveViewpoint();i.prepareEvents().removeInterest("spin",this),o.transitionStop(),this.getDistanceToCenter(t).multiply(n.zoomFactor||$c),o.getUserOrientation().multVecRot(e.set(0,0,t.magnitude())),n.deltaY>0?this.addMove(e.negate(),qt.Zero):n.deltaY<0&&this.addMove(e,qt.Zero)}}(),touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY);break;case 2:this.touchend(t),t.button=1,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY),this.touch2.set(e[1].pageX,e[1].pageY);break;case 3:this.touchend(t)}},touchend:function(t){switch(this.button){case 0:t.button=0,t.pageX=this.touch1.x,t.pageY=this.touch1.y,this.mouseup(t),this.tapedTwice?this.dblclick(t):(this.tapedTwice=!0,setTimeout(function(){this.tapedTwice=!1}.bind(this),300));break;case 1:this.touchMode=0,t.button=1,this.mouseup(t)}},touchmove:function(){const t=new jt(0,0),e=new jt(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:n.pageX=i[0].pageX,n.pageY=i[0].pageY,this.mousemove(n);break;case 2:{t.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),e.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const o=t.dot(e)>.7,r=t.dot(e)<-.7;switch(this.touchMode||(o?1:r?2:0)){case 1:this.touchMode=1,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);break;case 2:{this.touchMode=2;const t=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const e=this.touch1.distance(this.touch2)-t;n.deltaY=e,n.zoomFactor=Math.abs(e)/$(window).width(),this.mousewheel(n);break}}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),spin:function(){const t=this.getActiveViewpoint();this.orientationOffset.assign(t._orientationOffset.getValue()),t._orientationOffset=this.getOrientationOffset(this.rotation,this.orientationOffset),t._positionOffset=this.getPositionOffset(t._positionOffset.getValue(),this.orientationOffset,t._orientationOffset.getValue())},set_positionOffset__:function(t){this.getActiveViewpoint()._positionOffset=t},set_centerOfRotationOffset__:function(t){this.getActiveViewpoint()._centerOfRotationOffset=t},set_rotation__:function(t){const e=this.getActiveViewpoint();e._orientationOffset=this.getOrientationOffset(t.getValue(),this.initialOrientationOffset,!1),e._positionOffset=this.getPositionOffset(this.initialPositionOffset,this.initialOrientationOffset,e._orientationOffset.getValue())},addRotate:function(){const t=new Ce;return function(e){const n=this.getActiveViewpoint();if(this.rotationChaser._isActive.getValue()&&this.rotationChaser._value_changed.hasInterest("set_rotation__",this))try{t.assign(this.rotationChaser._set_destination.getValue()).multLeft(e),this.getOrientationOffset(t,this.initialOrientationOffset,!0),this.rotationChaser._set_destination=t}catch(n){e=this.getHorizonRotation(e),t.assign(this.rotationChaser._set_destination.getValue()).multLeft(e),this.rotationChaser._set_destination=t}else try{this.initialOrientationOffset.assign(n._orientationOffset.getValue()),this.initialPositionOffset.assign(n._positionOffset.getValue()),this.getOrientationOffset(e,this.initialOrientationOffset,!0),this.rotationChaser._set_value=Ce.Identity,this.rotationChaser._set_destination=e}catch(t){this.rotationChaser._set_value=Ce.Identity,this.rotationChaser._set_destination=this.getHorizonRotation(e)}this.disconnect(),this.rotationChaser._value_changed.addInterest("set_rotation__",this)}}(),addSpinning:function(){const t=new Ce(0,0,1,0);return function(e){this.disconnect(),this.getBrowser().prepareEvents().addInterest("spin",this),this.rotation.assign(t.assign(Ce.Identity).slerp(e,.6))}}(),addMove:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i){const o=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(t.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=t):(t.assign(o._positionOffset.getValue()).add(n),this.positionChaser._set_value=o._positionOffset,this.positionChaser._set_destination=t),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(e.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=e):(e.assign(o._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=o._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=e),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),getPositionOffset:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new Ce(0,0,1,0);return function(i,o,r){return this.getDistanceToCenter(t,i),n.assign(o).inverse().multRight(r).multVecRot(e.assign(t)).subtract(t).add(i)}}(),getOrientationOffset:function(){const t=new Ce(0,0,1,0),e=new Ce(0,0,1,0),n=new qt(0,0,0);return function(i,o,r){const s=this.getActiveViewpoint(),a=this.getStraightenHorizon();t.assign(i).multRight(s.getOrientation()).multRight(o),a&&s.straightenHorizon(t,this.getUpVector(s));const u=e.assign(s.getOrientation()).inverse().multRight(t);if(a){if(!r)return u;const e=t.multVecRot(n.assign(qt.zAxis));if(Math.abs(this.getUpVector(s).dot(e))<.97)return u;throw new Error("Critical angle")}return u}}(),getHorizonRotation:function(){const t=new qt(0,0,0);return function(e){const n=e.multVecRot(t.assign(qt.zAxis)),i=qt.cross(qt.yAxis,n),o=qt.cross(i,qt.yAxis);return new Ce(qt.zAxis,o)}}(),getUpVector:function(t){return"GeoViewpoint"!==t.getTypeName()||t.getUserPosition().magnitude()<65e5?t.getUpVector():qt.zAxis},disconnect:function(){const t=this.getBrowser();this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this),this.rotationChaser._value_changed.removeInterest("set_rotation__",this),t.prepareEvents().removeInterest("spin",this)},dispose:function(){const t=this.getBrowser();this.disconnect(),t._activeViewpoint.removeInterest("set_activeViewpoint__",this),t.getSurface().off(".ExamineViewer"),$(document).off(".ExamineViewer"+this.getId())}});const Qc=Kc,Zc=/Mac OS X/i.test(navigator.userAgent),Jc=.007,tl=Zc?Math.PI/512:Math.PI/32;function el(t){Lc.call(this,t);const e=this.getBrowser().getContext();this.button=-1,this.fromVector=new qt(0,0,0),this.toVector=new qt(0,0,0),this.direction=new qt(0,0,0),this.startTime=0,this.event=null,this.lookAround=!1,this.orientationChaser=new Yc(t),this.lineCount=2,this.lineArray=new Float32Array(4*this.lineCount).fill(1),this.lineBuffer=e.createBuffer(),this.lineArrayObject=new zr,this.geometryContext=new qr({geometryType:1})}el.prototype=Object.assign(Object.create(Lc.prototype),{constructor:el,initialize:function(){Lc.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getSurface();e.on("mousedown.X3DFlyViewer",this.mousedown.bind(this)),e.on("mouseup.X3DFlyViewer",this.mouseup.bind(this)),e.on("mousewheel.X3DFlyViewer",this.mousewheel.bind(this)),e.on("touchstart.X3DFlyViewer",this.touchstart.bind(this)),e.on("touchend.X3DFlyViewer",this.touchend.bind(this)),t._controlKey.addInterest("set_controlKey__",this),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},addCollision:function(){},removeCollision:function(){},set_controlKey__:function(){this.event&&0===this.event.button&&(this.button=-1,this.mousedown(this.event))},mousedown:function(t){if(this.button>=0)return;this.event=t;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,$(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),$(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),$(document).on("touchend.X3DFlyViewer"+this.getId(),this.touchend.bind(this)),$(document).on("touchmove.X3DFlyViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.getBrowser().getControlKey()||this.lookAround?this.trackballProjectToSphere(n,i,this.fromVector):(this.fromVector.set(n,0,i),this.toVector.assign(this.fromVector),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.addFly(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finished().addInterest("display",this,0)),this._isActive=!0;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,$(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),$(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.fromVector.set(n,-i,0),this.toVector.assign(this.fromVector),this.direction.set(0,0,0),this.addPan(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finished().addInterest("display",this,1),this._isActive=!0}},mouseup:function(t){t.preventDefault(),t.button===this.button&&(this.event=null,this.button=-1,$(document).off(".X3DFlyViewer"+this.getId()),this.disconnect(),this.getBrowser().setCursor("DEFAULT"),this.removeCollision(),this._isActive=!1)},mousemove:function(t){this.getBrowser().addBrowserEvent(),this.event=t;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.getButton(this.button)){case 0:if(this.getBrowser().getControlKey()||this.lookAround){t.preventDefault(),t.stopImmediatePropagation();const e=this.trackballProjectToSphere(n,i,this.toVector);this.addRotation(this.fromVector,e),this.fromVector.assign(e);break}this.toVector.set(n,0,i),this.getFlyDirection(this.fromVector,this.toVector,this.direction);break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.toVector.set(n,-i,0),this.direction.assign(this.toVector).subtract(this.fromVector)}},mousewheel:function(t){t.preventDefault(),t.stopImmediatePropagation();this.getActiveViewpoint().transitionStop(),t.deltaY>0?this.addRoll(-tl):t.deltaY<0&&this.addRoll(tl)},touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t);break;case 2:this.touchend(t),this.lookAround=!0,t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t);break;case 3:this.touchend(t)}},touchend:function(t){if(0===this.button)this.lookAround=!1,t.button=0,this.mouseup(t)},touchmove:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousemove(t);break;case 2:t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousemove(t)}},fly:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=new Ce(0,0,1,0),o=new Ce(0,0,1,0),r=new Ce(0,0,1,0);return function(){const s=this.getNavigationInfo(),a=this.getActiveViewpoint(),u=performance.now(),c=(u-this.startTime)/1e3;t.assign(a.getUpVector()),this.direction.z>0?r.setFromToVec(this.direction,n.set(0,0,1)):r.setFromToVec(n.set(0,0,-1),this.direction);const l=this.direction.magnitude();let h=1-r.angle/(Math.PI/2);h*=s._speed.getValue(),h*=a.getSpeedFactor(),h*=this.getBrowser().getShiftKey()?.028:Jc,h*=c;const d=this.getTranslationOffset(e.assign(this.direction).multiply(h));this.getActiveLayer().constrainTranslation(d,!0),a._positionOffset=d.add(a._positionOffset.getValue());const f=1.4*c*Math.pow(l/(l+40),2);i.assign(Ce.Identity).slerp(r,f).multRight(a.getUserOrientation()),this.getStraightenHorizon()&&a.straightenHorizon(i),o.assign(a.getOrientation()).inverse().multRight(i),a._orientationOffset=o,this.startTime=u}}(),pan:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(){const n=this.getNavigationInfo(),i=this.getActiveViewpoint(),o=performance.now(),r=(o-this.startTime)/1e3,s=i.getUpVector();this.constrainPanDirection(t.assign(this.direction));let a=1;a*=n._speed.getValue(),a*=i.getSpeedFactor(),a*=this.getBrowser().getShiftKey()?.0098:.007,a*=r;const u=i.getUserOrientation().multRight(new Ce(i.getUserOrientation().multVecRot(e.assign(qt.yAxis)),s)).multVecRot(t.multiply(a));this.getActiveLayer().constrainTranslation(u,!0),i._positionOffset=u.add(i._positionOffset.getValue()),this.startTime=o}}(),set_orientationOffset__:function(t){this.getActiveViewpoint()._orientationOffset=t},addFly:function(){this.startTime||(this.getBrowser().prepareEvents().addInterest("fly",this),this.getBrowser().addBrowserEvent(),this.startTime=performance.now())},addPan:function(){this.startTime||(this.disconnect(),this.getBrowser().prepareEvents().addInterest("pan",this),this.getBrowser().addBrowserEvent(),this.startTime=performance.now())},addRoll:function(){const t=new Ce(0,0,1,0),e=new Ce(0,0,1,0);return function(n){const i=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.assign(i.getOrientation()).inverse().multRight(e.set(1,0,0,n)).multRight(i.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.orientationChaser._set_destination=t):(t.assign(i.getOrientation()).inverse().multRight(e.set(1,0,0,n)).multRight(i.getUserOrientation()),this.orientationChaser._set_value=i._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),addRotation:function(){const t=new Ce(0,0,1,0),e=new Ce(0,0,1,0);return function(n,i){const o=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.setFromToVec(i,n).multRight(o.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.getStraightenHorizon()&&o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_destination=e):(t.setFromToVec(i,n).multRight(o.getUserOrientation()),this.getStraightenHorizon()&&o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_value=o._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),display:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new Ne,i=new Float32Array(Ne.Identity),o=new Float32Array(Ne.Identity),r=[];return function(s){const a=this.getBrowser(),u=a.getContext(),c=a.getViewport(),l=c[2],h=c[3];i.set(sr.ortho(0,l,0,h,-1,1,n)),0===s?(t.set(this.fromVector.x,h-this.fromVector.z,0),e.set(this.toVector.x,h-this.toVector.z,0)):(t.set(this.fromVector.x,h+this.fromVector.y,0),e.set(this.toVector.x,h+this.toVector.y,0)),this.lineArray.set(t,0),this.lineArray.set(e,4),u.bindBuffer(u.ARRAY_BUFFER,this.lineBuffer),u.bufferData(u.ARRAY_BUFFER,this.lineArray,u.DYNAMIC_DRAW);const d=a.getDefaultMaterial().getShader(this.geometryContext);d.enable(u),d.setClipPlanes(u,r),u.uniformMatrix4fv(d.x3d_ProjectionMatrix,!1,i),u.uniformMatrix4fv(d.x3d_ModelViewMatrix,!1,o),this.lineArrayObject.enable(u,d)&&d.enableVertexAttribute(u,this.lineBuffer,0,0),u.disable(u.DEPTH_TEST),u.uniform3f(d.x3d_EmissiveColor,0,0,0),u.uniform1f(d.x3d_Transparency,0),u.drawArrays(u.LINES,0,this.lineCount),u.uniform3f(d.x3d_EmissiveColor,1,1,1),u.drawArrays(u.LINES,0,this.lineCount)}}(),disconnect:function(){const t=this.getBrowser();t.addBrowserEvent(),t.prepareEvents().removeInterest("fly",this),t.prepareEvents().removeInterest("pan",this),t.finished().removeInterest("display",this),this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.startTime=0},dispose:function(){const t=this.getBrowser().getContext();t.deleteBuffer(this.lineBuffer),this.lineArrayObject.delete(t),this.disconnect(),this.getBrowser()._controlKey.removeInterest("set_controlKey__",this),this.getBrowser().getSurface().off(".X3DFlyViewer"),$(document).off(".X3DFlyViewer"+this.getId())}});const nl=el;function il(t){nl.call(this,t)}il.prototype=Object.assign(Object.create(nl.prototype),{constructor:il,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.outputOnly,"isActive",new Bn.SFBool)]),initialize:function(){nl.prototype.initialize.call(this),this.getBrowser().addCollision(this)},getStraightenHorizon:function(){return!0},getFlyDirection:function(t,e,n){return n.assign(e).subtract(t)},getTranslationOffset:function(){const t=new qt(0,0,0),e=new Ce(0,0,1,0),n=new Ce(0,0,1,0);return function(i){const o=this.getActiveViewpoint(),r=o.getUpVector();e.assign(o.getUserOrientation()),e.multVecRot(t.assign(qt.yAxis)),n.setFromToVec(t,r);return e.multRight(n).multVecRot(i)}}(),constrainPanDirection:function(t){return t.y<0&&(t.y=0),t},dispose:function(){this.getBrowser().removeCollision(this),nl.prototype.dispose.call(this)}});const ol=il;function rl(t){nl.call(this,t)}rl.prototype=Object.assign(Object.create(nl.prototype),{constructor:rl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.outputOnly,"isActive",new Bn.SFBool)]),addCollision:function(){this.getBrowser().addCollision(this)},removeCollision:function(){this.getBrowser().removeCollision(this)},getFlyDirection:function(t,e,n){return n.assign(e).subtract(t)},getTranslationOffset:function(t){return this.getActiveViewpoint().getUserOrientation().multVecRot(t)},constrainPanDirection:function(t){return t}});const sl=rl,al=/Mac OS X/i.test(navigator.userAgent)?1/160:.05,ul=new qt(0,0,0),cl=new qt(0,0,0),ll=new qt(0,0,0);function hl(t){Lc.call(this,t),this.button=-1,this.fromPoint=new qt(0,0,0),this.toPoint=new qt(0,0,0)}hl.prototype=Object.assign(Object.create(Lc.prototype),{constructor:hl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.outputOnly,"isActive",new Bn.SFBool)]),initialize:function(){Lc.prototype.initialize.call(this);const t=this.getBrowser().getSurface();t.on("mousedown.PlaneViewer",this.mousedown.bind(this)),t.on("mouseup.PlaneViewer",this.mouseup.bind(this)),t.on("mousemove.PlaneViewer",this.mousemove.bind(this)),t.on("mousewheel.PlaneViewer",this.mousewheel.bind(this))},mousedown:function(t){if(this.button>=0)return;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;if(1===this.getButton(t.button))t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,this.getBrowser().getSurface().off("mousemove.PlaneViewer"),$(document).on("mouseup.PlaneViewer"+this.getId(),this.mouseup.bind(this)),$(document).on("mousemove.PlaneViewer"+this.getId(),this.mousemove.bind(this)),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(n,i,this.fromPoint),this._isActive=!0},mouseup:function(t){t.preventDefault(),t.stopImmediatePropagation(),t.button===this.button&&(this.button=-1,$(document).off(".PlaneViewer"+this.getId()),this.getBrowser().getSurface().on("mousemove.PlaneViewer",this.mousemove.bind(this)),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1)},mousemove:function(t){const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.getButton(this.button)){case 1:{t.preventDefault(),t.stopImmediatePropagation();const e=this.getActiveViewpoint(),o=this.getPointOnCenterPlane(n,i,this.toPoint),r=e.getUserOrientation().multVecRot(this.fromPoint.subtract(o));e._positionOffset=cl.assign(e._positionOffset.getValue()).add(r),e._centerOfRotationOffset=ll.assign(e._centerOfRotationOffset.getValue()).add(r),this.fromPoint.assign(o);break}}},mousewheel:function(t){t.preventDefault(),t.stopImmediatePropagation();const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top,o=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(n,i,this.fromPoint);o.transitionStop(),t.deltaY>0?o._fieldOfViewScale=Math.max(1e-5,o._fieldOfViewScale.getValue()*(1-al)):t.deltaY<0&&(o._fieldOfViewScale=o._fieldOfViewScale.getValue()*(1+al),this.constrainFieldOfViewScale()),o.set_fieldOfView___&&o.set_fieldOfView___();const s=this.getPointOnCenterPlane(n,i,this.toPoint),a=o.getUserOrientation().multVecRot(ul.assign(r).subtract(s));o._positionOffset=cl.assign(o._positionOffset.getValue()).add(a),o._centerOfRotationOffset=ll.assign(o._centerOfRotationOffset.getValue()).add(a)},constrainFieldOfViewScale:function(){const t=this.getActiveViewpoint();t.getTypeName().match(/^(?:Viewpoint|GeoViewpoint)$/)&&t._fieldOfView.getValue()*t._fieldOfViewScale.getValue()>=Math.PI&&(t._fieldOfViewScale=(Math.PI-.001)/t._fieldOfView.getValue())},dispose:function(){this.getBrowser().getSurface().off(".PlaneViewer"),$(document).off(".PlaneViewer"+this.getId())}});const dl=hl;function fl(t){Lc.call(this,t)}fl.prototype=Object.assign(Object.create(Lc.prototype),{constructor:fl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.outputOnly,"isActive",new Bn.SFBool)])});const pl=fl,gl=/Mac OS X/i.test(navigator.userAgent)?1/120:.05;function ml(t){Lc.call(this,t),this.button=-1,this.fromVector=new qt(0,0,0),this.toVector=new qt(0,0,0),this.touch1=new jt(0,0),this.touch2=new jt(0,0),this.tapStart=0,this.dblTapInterval=.4,this.positionChaser=new kc(t),this.centerOfRotationChaser=new kc(t),this.orientationChaser=new Yc(t)}ml.prototype=Object.assign(Object.create(Lc.prototype),{constructor:ml,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.outputOnly,"isActive",new Bn.SFBool)]),initialize:function(){Lc.prototype.initialize.call(this);const t=this.getBrowser().getSurface();t.on("mousedown.LookAtViewer",this.mousedown.bind(this)),t.on("mouseup.LookAtViewer",this.mouseup.bind(this)),t.on("dblclick.LookAtViewer",this.dblclick.bind(this)),t.on("mousewheel.LookAtViewer",this.mousewheel.bind(this)),t.on("touchstart.LookAtViewer",this.touchstart.bind(this)),t.on("touchend.LookAtViewer",this.touchend.bind(this)),this.positionChaser._duration=.3,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.3,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},mousedown:function(t){if(this.button>=0)return;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;if(0===t.button)t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,$(document).on("mouseup.LookAtViewer"+this.getId(),this.mouseup.bind(this)),$(document).on("mousemove.LookAtViewer"+this.getId(),this.mousemove.bind(this)),$(document).on("touchend.LookAtViewer"+this.getId(),this.mouseup.bind(this)),$(document).on("touchmove.LookAtViewer"+this.getId(),this.touchmove.bind(this)),this.getActiveViewpoint().transitionStop(),this.trackballProjectToSphere(n,i,this.fromVector),this._isActive=!0},mouseup:function(t){if(t.button===this.button&&(this.button=-1,$(document).off(".LookAtViewer"+this.getId()),0===t.button))t.preventDefault(),t.stopImmediatePropagation(),this._isActive=!1},dblclick:function(t){t.preventDefault(),t.stopImmediatePropagation();const e=this.getBrowser().getSurface(),n=e.offset(),i=t.pageX-n.left-parseFloat(e.css("borderLeftWidth")),o=e.innerHeight()-(t.pageY-n.top-parseFloat(e.css("borderTopWidth")));this.disconnect(),this.lookAtPoint(i,o,this.getStraightenHorizon())},mousemove:function(t){this.getBrowser().addBrowserEvent(),this.event=t;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.button){case 0:{t.preventDefault(),t.stopImmediatePropagation();const e=this.trackballProjectToSphere(n,i,this.toVector);this.addRotation(this.fromVector,e),this.fromVector.assign(e);break}}},mousewheel:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n){n.preventDefault(),n.stopImmediatePropagation();const i=this.getActiveViewpoint();i.transitionStop(),t=this.getDistanceToCenter(t).multiply(n.zoomFactor||gl),e=i.getUserOrientation().multVecRot(e.set(0,0,t.magnitude())),n.deltaY>0?this.addMove(e.negate(),qt.Zero):n.deltaY<0&&this.addMove(e,qt.Zero)}}(),touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:this.touch1.set(e[0].pageX,e[0].pageY);break;case 2:this.touchend(t),t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY),this.touch2.set(e[1].pageX,e[1].pageY);break;case 3:this.touchend(t)}},touchend:function(t){if(0===this.button)this.mouseup(t);this.getBrowser().getCurrentTime()-this.tapStart<this.dblTapInterval&&(t.button=1,t.pageX=this.touch1.x,t.pageY=this.touch1.y,this.dblclick(t)),this.tapStart=this.getBrowser().getCurrentTime()},touchmove:function(){const t=new jt(0,0),e=new jt(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:break;case 2:{t.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),e.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const o=t.dot(e)>.7,r=t.dot(e)<-.7;if(o)n.button=0,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);else if(r){const t=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const e=this.touch1.distance(this.touch2)-t;n.deltaY=e,n.zoomFactor=Math.abs(e)/$(window).width(),this.mousewheel(n)}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),set_positionOffset__:function(t){this.getActiveViewpoint()._positionOffset=t},set_centerOfRotationOffset__:function(t){this.getActiveViewpoint()._centerOfRotationOffset=t},set_orientationOffset__:function(t){this.getActiveViewpoint()._orientationOffset=t},addMove:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i){const o=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(t.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=t):(t.assign(o._positionOffset.getValue()).add(n),this.positionChaser._set_value=o._positionOffset,this.positionChaser._set_destination=t),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(e.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=e):(e.assign(o._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=o._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=e),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),addRotation:function(){const t=new Ce(0,0,1,0),e=new Ce(0,0,1,0);return function(n,i){const o=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.setFromToVec(i,n).multRight(o.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_destination=e):(t.setFromToVec(i,n).multRight(o.getUserOrientation()),o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_value=o._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),disconnect:function(){this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this)},dispose:function(){this.getBrowser().getSurface().off(".LookAtViewer"),$(document).off(".LookAtViewer"+this.getId())}});const _l=ml;function xl(t){gr.call(this,t),this.addType(o.X3DLightNode)}xl.prototype=Object.assign(Object.create(gr.prototype),{constructor:xl,initialize:function(){gr.prototype.initialize.call(this),this._on.addInterest("set_on__",this),this._intensity.addInterest("set_on__",this),this.set_on__()},set_on__:function(){this._on.getValue()&&this.getIntensity()>0?(delete this.push,delete this.pop):(this.push=Function.prototype,this.pop=Function.prototype)},getGlobal:function(){return this._global.getValue()},getColor:function(){return this._color.getValue()},getIntensity:function(){return Math.max(this._intensity.getValue(),0)},getAmbientIntensity:function(){return et.clamp(this._ambientIntensity.getValue(),0,1)},getDirection:function(){return this._direction.getValue()},getShadows:function(){return this._shadows.getValue()},getShadowColor:function(){return this._shadowColor.getValue()},getShadowIntensity:function(){return this.getShadows()?et.clamp(this._shadowIntensity.getValue(),0,1):0},getShadowBias:function(){return et.clamp(this._shadowBias.getValue(),0,1)},getShadowMapSize:function(){return Math.min(this._shadowMapSize.getValue(),this.getBrowser().getMaxTextureSize())},getBiasMatrix:function(){const t=new Ne(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return t}}(),push:function(t,e){if(t.isIndependent()){const n=this.getLights().pop();this._global.getValue()?(n.set(this,t.getLayer().getGroup(),t.getModelViewMatrix().get()),t.getGlobalObjects().push(n),t.getLights().push(n),t.pushGlobalShadows(!!this.getShadowIntensity())):(n.set(this,e,t.getModelViewMatrix().get()),t.getLocalObjects().push(n),t.getLights().push(n),t.pushLocalShadows(!!this.getShadowIntensity()),++t.getLocalObjectsCount()[1])}else{const e=t.getLightContainer();this._global.getValue()?(e.getModelViewMatrix().pushMatrix(t.getModelViewMatrix().get()),t.getGlobalObjects().push(e),t.getLights().push(e),t.pushGlobalShadows(!!this.getShadowIntensity())):(e.getModelViewMatrix().pushMatrix(t.getModelViewMatrix().get()),t.getLocalObjects().push(e),t.getLights().push(e),t.pushLocalShadows(!!this.getShadowIntensity()),++t.getLocalObjectsCount()[1])}},pop:function(t){this._global.getValue()||(t.isIndependent()?this.getBrowser().getLocalObjects().push(t.getLocalObjects().pop()):t.getLocalObjects().pop(),t.popLocalShadows(),--t.getLocalObjectsCount()[1])}});const yl=xl,wl=Dr(Tl);function Tl(){this.direction=new qt(0,0,0),this.shadowBuffer=null,this.bbox=new ur,this.viewVolume=new Jo,this.viewport=new ae(0,0,0,0),this.projectionMatrix=new Ne,this.modelViewMatrix=new cr(Ne),this.modelMatrix=new Ne,this.invLightSpaceMatrix=new Ne,this.invLightSpaceProjectionMatrix=new Ne,this.shadowMatrix=new Ne,this.shadowMatrixArray=new Float32Array(16),this.rotation=new Ce,this.textureUnit=void 0}function Sl(t){yl.call(this,t),this.addType(o.DirectionalLight),"2.0"===t.getSpecificationVersion()&&(this._global=!0)}Tl.prototype={constructor:Tl,getModelViewMatrix:function(){return this.modelViewMatrix},set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(e.getGlobal()?i:Ne.Identity);o.rotate(this.rotation.setFromToVec(qt.zAxis,this.direction.assign(e.getDirection()).negate())),o.inverse();const r=this.groupNode.getSubBBox(this.bbox,!0).multRight(o),s=e.getShadowMapSize(),a=this.viewport.set(0,0,s,s),u=sr.orthoBox(r,this.projectionMatrix);this.shadowBuffer.bind(),t.getViewVolumes().push(this.viewVolume.set(u,a,a)),t.getProjectionMatrix().pushMatrix(u),t.getModelViewMatrix().pushMatrix(o),t.render(ir.SHADOW,Tr.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop(),this.shadowBuffer.unbind(),e.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o).multRight(u).multRight(e.getBiasMatrix())},setGlobalVariables:function(t){this.modelViewMatrix.get().multDirMatrix(this.direction.assign(this.lightNode.getDirection())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=this.direction;if(t.uniform1i(e.x3d_LightType[n],1),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightDirection[n],r.x,r.y,r.z),this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,wl.push(this)}},Sl.prototype=Object.assign(Object.create(yl.prototype),{constructor:Sl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"global",new Bn.SFBool(!1)),new z(o.inputOutput,"on",new Bn.SFBool(!0)),new z(o.inputOutput,"color",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"intensity",new Bn.SFFloat(1)),new z(o.inputOutput,"ambientIntensity",new Bn.SFFloat),new z(o.inputOutput,"direction",new Bn.SFVec3f(0,0,-1)),new z(o.inputOutput,"shadows",new Bn.SFBool),new z(o.inputOutput,"shadowColor",new Bn.SFColor),new z(o.inputOutput,"shadowIntensity",new Bn.SFFloat(1)),new z(o.inputOutput,"shadowBias",new Bn.SFFloat(.005)),new z(o.initializeOnly,"shadowMapSize",new Bn.SFInt32(1024))]),getTypeName:function(){return"DirectionalLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getLights:function(){return wl}});const bl=Sl,vl=Symbol(),El=Symbol(),Cl=Symbol();function Ol(){this.addChildObjects("activeLayer",new Bn.SFNode,"activeNavigationInfo",new Bn.SFNode,"activeViewpoint",new Bn.SFNode,"availableViewers",new Bn.MFString,"viewer",new Bn.SFString("EXAMINE")),this[vl]=new Set,this[El]=new pl(this)}Ol.prototype={initialize:function(){this._viewer.addInterest("set_viewer__",this),this.initialized().addInterest("set_world__",this),this.shutdown().addInterest("remove_world__",this),this[Cl]=function(t){const e=new bl(t.getPrivateScene());e.setup();const n=e.getLights().pop();return n.set(e,null,Ne.Identity),n.dispose=Function.prototype,n}(this),this[El].setup()},getHeadlight:function(){return this[Cl]},getActiveLayer:function(){return this._activeLayer.getValue()},getActiveNavigationInfo:function(){return this._activeNavigationInfo.getValue()},getActiveViewpoint:function(){return this._activeViewpoint.getValue()},getCurrentViewer:function(){return this._viewer.getValue()},getViewer:function(){return this[El]},addCollision:function(t){this[vl].add(t)},removeCollision:function(t){this[vl].delete(t)},getCollisionCount:function(){return this[vl].size},remove_world__:function(){this.getWorld()._activeLayer.removeInterest("set_activeLayer__",this)},set_world__:function(){this.getWorld()._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__()},set_activeLayer__:function(){this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().removeInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().removeInterest("set_activeViewpoint__",this)),this._activeLayer=this.getWorld().getActiveLayer(),this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().addInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().addInterest("set_activeViewpoint__",this)),this.set_activeNavigationInfo__(),this.set_activeViewpoint__()},set_activeNavigationInfo__:function(){this._activeNavigationInfo.getValue()&&this._activeNavigationInfo.getValue()._viewer.removeFieldInterest(this._viewer),this._activeLayer.getValue()?(this._activeNavigationInfo=this._activeLayer.getValue().getNavigationInfo(),this._activeNavigationInfo.getValue()._viewer.addFieldInterest(this._viewer),this._viewer=this._activeNavigationInfo.getValue()._viewer):(this._activeNavigationInfo=null,this._viewer="NONE")},set_activeViewpoint__:function(){this._activeLayer.getValue()?this._activeViewpoint=this._activeLayer.getValue().getViewpoint():this._activeViewpoint=null},set_viewer__:function(t){switch(this._activeNavigationInfo.getValue()?this._availableViewers=this._activeNavigationInfo.getValue()._availableViewers:this._availableViewers.length=0,this[El]&&this[El].dispose(),t.getValue()){case"EXAMINE":default:this[El]=new Qc(this);break;case"WALK":this[El]=new ol(this);break;case"FLY":this[El]=new sl(this);break;case"PLANE":case"PLANE_create3000.de":this[El]=new dl(this);break;case"NONE":this[El]=new pl(this);break;case"LOOKAT":this[El]=new _l(this)}this[El].setup()}};const Fl=Ol;var Nl="/index.js";function Ml(){}Ml.prototype={getScriptUrl:function(){if(document.currentScript)var t=document.currentScript.src;else if("function"==typeof __global_require__)t=__global_require__("url").pathToFileURL(Nl).href;else t=document.location.href;return function(){return t}}(),getProviderUrl:function(t){return t?(this.getScriptUrl().match(/\.min\.js$/)&&(t+=".min"),new URL("assets/components/"+t+".js",this.getScriptUrl()).href):"https://create3000.github.io/x_ite/"},getFontsUrl:function(t){return new URL("assets/fonts/"+t,this.getScriptUrl()).href},getLinetypeUrl:function(){return new URL("assets/linetype/linetypes.png",this.getScriptUrl()).href},getHatchingUrl:function(t){return new URL("assets/hatching/"+t+".png",this.getScriptUrl()).href}};const Vl=new Ml,Il=Symbol(),Dl=Symbol(),Rl=Symbol(),Pl=Symbol(),Al=Symbol();function Ll(){this.addChildObjects("loadCount",new Bn.SFInt32),this[Il]=0,this[Dl]=new Set,this[Rl]=!1,this[Pl]=function(t){let e=t.baseURI;return e.startsWith("about:")&&(e=document.baseURI),e}(this.getElement()[0]),this.getCanvas().hide(),this.getBrowserOptions().getSplashScreen()&&(this.getContextMenu().hide(),this.getSplashScreen().show())}Ll.prototype={initialize:function(){},getProviderUrl:function(){return Vl.getProviderUrl()},getLocation:function(){return this[Pl]},getDefaultScene:function(){return this[Al]=this.createScene(),this[Al].setPrivate(!0),this[Al].setLive(!0),this[Al].setup(),this.getDefaultScene=function(){return this[Al]},Object.defineProperty(this,"getDefaultScene",{enumerable:!1}),this[Al]},setBrowserLoading:function(t){this[Rl]=t,this.setLoadCount(0),t?(this.resetLoadCount(),this.getShadow().find(".x_ite-private-world-info").remove(),this.getBrowserOptions().getSplashScreen()?(this.getContextMenu().hide(),this.getCanvas().stop(!0,!0).animate({delay:1},1).fadeOut(0),this.getSplashScreen().stop(!0,!0).animate({delay:1},1).fadeIn(0)):this.getCanvas().hide()):this.getBrowserOptions().getSplashScreen()?(this.getSplashScreen().stop(!0,!0).show().fadeOut(2e3),this.getCanvas().stop(!0,!0).hide().fadeIn(2e3)):this.getCanvas().show()},getLoading:function(){return this[Rl]},addLoadCount:function(t){this[Dl].has(t)||(++this[Il],this[Dl].add(t),this.setLoadCount(this[Dl].size),this.setCursor("DEFAULT"))},removeLoadCount:function(t){this[Dl].has(t)&&(this[Dl].delete(t),this.setLoadCount(this[Dl].size))},setLoadCount:function(t){this._loadCount=t;const e=[...this[Dl]].reduce(((t,e)=>t+!e.isPrivate()),0);if(t||this[Rl])var n=ri(1==e?"Loading %1 file":"Loading %1 files").replace("%1",e||1);else{n=ri("Loading done");this.setCursor("DEFAULT")}this[Rl]||(this.getNotification()._string=n),this.getSplashScreen().find(".x_ite-private-spinner-text").text(n),this.getSplashScreen().find(".x_ite-private-progressbar div").css("width",100-100*t/this[Il]+"%")},resetLoadCount:function(){this._loadCount=0,this[Il]=0,this[Dl].clear()}};const Bl=Ll,Xl=Symbol(),Ul=Symbol(),zl=Symbol(),jl=Symbol(),kl=Symbol();function Gl(){this[Xl]=new Set,this[Ul]=[new Set],this[zl]=[],this[jl]=[!1],this[kl]=0}Gl.prototype={initialize:function(){},addTransformSensor:function(t){this[Xl].add(t),this.enablePicking()},removeTransformSensor:function(t){this[Xl].delete(t),this.enablePicking()},addPickSensor:function(t){this[Ul][0].add(t),this.enablePicking()},removePickSensor:function(t){this[Ul][0].delete(t),this.enablePicking()},getPickSensors:function(){return this[Ul]},getPickingHierarchy:function(){return this[zl]},getPickable:function(){return this[jl]},enablePicking:function(){this[Xl].size||this[Ul][0].size?this._sensorEvents.addInterest("picking",this):this._sensorEvents.removeInterest("picking",this)},picking:function(){const t=performance.now();this.getWorld().traverse(ir.PICKING,null);for(const t of this[Xl])t.process();for(const t of this[Ul][0])t.process();this[kl]=performance.now()-t},getPickingTime:function(){return this[kl]}};const Hl=Gl;function ql(t){Zn.call(this,t),this.cursor="DEFAULT",this.isOver=!1,this.motionTime=0}ql.prototype=Object.assign(Object.create(Zn.prototype),{constructor:ql,getTypeName:function(){return"PointingDevice"},initialize:function(){const t=this.getBrowser().getSurface();t.on("mousedown.PointingDevice"+this.getId(),this.mousedown.bind(this)),t.on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),t.on("dblclick.PointingDevice"+this.getId(),this.dblclick.bind(this)),t.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),t.on("mouseout.PointingDevice"+this.getId(),this.onmouseout.bind(this)),t.on("touchstart.PointingDevice"+this.getId(),this.touchstart.bind(this)),t.on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this))},mousewheel:function(t){},mousedown:function(t){const e=this.getBrowser();if(e.getElement().focus(),!(e.getShiftKey()&&e.getControlKey()||0!==t.button)){const n=e.getSurface(),i=n.offset(),o=t.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(t.pageY-i.top-parseFloat(n.css("borderTopWidth")));n.off("mousemove.PointingDevice"+this.getId()),$(document).on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),$(document).on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),$(document).on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this)),$(document).on("touchmove.PointingDevice"+this.getId(),this.touchmove.bind(this)),e.buttonPressEvent(o,r)&&(t.preventDefault(),t.stopImmediatePropagation(),e.setCursor("HAND"),e.finished().addInterest("onverifymotion",this,o,r))}},mouseup:function(t){if(t.preventDefault(),0===t.button){const e=this.getBrowser(),n=e.getSurface(),i=n.offset(),o=t.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(t.pageY-i.top-parseFloat(n.css("borderTopWidth")));$(document).off(".PointingDevice"+this.getId()),n.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),e.buttonReleaseEvent(),e.setCursor(this.isOver?"HAND":"DEFAULT"),e.finished().addInterest("onverifymotion",this,o,r),e.addBrowserEvent(),this.cursor="DEFAULT"}},dblclick:function(t){this.isOver&&t.stopImmediatePropagation()},mousemove:function(t){t.preventDefault();const e=this.getBrowser();if(this.motionTime===e.getCurrentTime())return;this.motionTime=e.getCurrentTime();const n=e.getSurface(),i=n.offset(),o=t.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(t.pageY-i.top-parseFloat(n.css("borderTopWidth")));this.onmotion(o,r)},touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:{t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t);const n=this.getBrowser().getNearestHit();n&&0!==n.sensors.size||(this.touchX=t.pageX,this.touchY=t.pageY,this.touchTimeout=setTimeout(this.showContextMenu.bind(this,t),1200));break}case 2:this.touchend(t)}},touchend:function(t){t.button=0,this.mouseup(t),clearTimeout(this.touchTimeout)},touchmove:function(t){const e=t.originalEvent.touches;if(1===e.length)t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousemove(t),Math.hypot(this.touchX-t.pageX,this.touchY-t.pageY)>7&&clearTimeout(this.touchTimeout)},onmotion:function(t,e){const n=this.getBrowser();n.motionNotifyEvent(t,e)?this.isOver||(this.isOver=!0,this.cursor=n.getCursor(),n.setCursor("HAND")):this.isOver&&(this.isOver=!1,n.setCursor(this.cursor))},onmouseout:function(t){this.getBrowser().leaveNotifyEvent()},onverifymotion:function(t,e){this.getBrowser().finished().removeInterest("onverifymotion",this),this.onmotion(t,e)},showContextMenu:function(t){this.getBrowser().getContextMenu().show(t)}});const Yl=ql,Wl=Symbol(),$l=Symbol(),Kl=Symbol(),Ql=Symbol(),Zl=Symbol(),Jl=Symbol(),th=Symbol(),eh=Symbol(),nh=Symbol(),ih=Symbol(),oh=Symbol(),rh=Symbol(),sh=Symbol(),ah=Symbol(),uh=new sc(qt.Zero,qt.Zero);function ch(){this[Wl]=new Yl(this),this[Kl]=new jt(0,0),this[Ql]=new sc(qt.Zero,qt.Zero),this[Zl]=[],this[Jl]=[new Map],this[eh]=null,this[nh]=new Set,this[ih]=new Set,this[oh]=new rr(this[Zl],(function(t,e){return t.intersection.point.z<e.intersection.point.z})),this[sh]=new rr(this[Zl],(function(t,e){return t.layerNumber<e.layerNumber})),this[ah]=0}ch.prototype={initialize:function(){this.setCursor("DEFAULT"),this[Wl].setup()},setCursor:function(t){const e=this.getSurface();switch(this[$l]=t,t){case"HAND":e.css("cursor","pointer");break;case"MOVE":e.css("cursor","move");break;case"CROSSHAIR":e.css("cursor","crosshair");break;default:this._loadCount.getValue()?e.css("cursor","wait"):this[Wl]&&this[Wl].isOver?e.css("cursor","pointer"):e.css("cursor","default")}},getCursor:function(){return this[$l]},getPointer:function(){return this[Kl]},isPointerInRectangle:function(t){return this[Kl].x>t.x&&this[Kl].x<t.x+t.z&&this[Kl].y>t.y&&this[Kl].y<t.y+t.w},setLayerNumber:function(t){this[rh]=t},getSelectedLayer:function(){return this[eh]},setHitRay:function(t,e){Jo.unProjectRay(this[Kl].x,this[Kl].y,Ne.Identity,t,e,this[Ql])},getHitRay:function(){return this[Ql]},getSensors:function(){return this[Jl]},getPickOnlySensors:function(){return this[th]},addHit:function(t,e,n,i){const o=this[Jl].at(-1);this[Zl].push({pointer:this[Kl],hitRay:this[Ql].copy(),intersection:t,sensors:new Set(o.values()),layer:e,layerNumber:this[rh],shape:n,modelViewMatrix:i.copy()})},getHits:function(){return this[Zl]},getNearestHit:function(){return this[Zl].at(-1)},buttonPressEvent:function(t,e){if(this.touch(t,e,!0),0===this[Zl].length)return!1;const n=this.getNearestHit();this[eh]=n.layer,this[ih]=n.sensors;for(const t of this[ih])t.set_active__(!0,n);return!!n.sensors.size},buttonReleaseEvent:function(){this[eh]=null;for(const t of this[ih])t.set_active__(!1,null);return this[ih]=new Set,!0},motionNotifyEvent:function(t,e){return this.touch(t,e,!0),this.motion(),!(!this[Zl].length||!this[Zl].at(-1).sensors.size)},leaveNotifyEvent:function(){},touch:function(t,e,n){if(this.getViewer()._isActive.getValue())return void(this[ah]=0);const i=performance.now();this[th]=n,this[Kl].set(t,e),this[Zl].length=0,this.getWorld().traverse(ir.POINTER,null),this[oh].sort(0,this[Zl].length),this[sh].sort(0,this[Zl].length),this.addBrowserEvent(),this[ah]=performance.now()-i},motion:function(){if(this[Zl].length)var t=this[Zl].at(-1);else t={pointer:this[Kl],modelViewMatrix:new Ne,hitRay:this[eh]?this[Ql]:uh,intersection:null,sensors:new Set,shape:null,layer:null,layerNumber:0};if(this[Zl].length)var e=et.set_difference(this[nh],t.sensors,new Set);else e=new Set(this[nh]);for(const n of e)n.set_over__(!1,t);if(this[Zl].length){this[nh]=t.sensors;for(const e of this[nh])e.set_over__(!0,t)}else this[nh]=new Set;for(const e of this[ih])e.set_motion__(t)},getPointerTime:function(){return this[ah]}};const lh=ch,hh=Symbol(),dh=Symbol(),fh=Symbol(),ph=Symbol();function gh(){this[hh]=[0,0,300,150],this[dh]=[],this[fh]=new Map}gh.prototype={initialize:function(){const t=this.getContext();t.enable(t.SCISSOR_TEST),t.depthFunc(t.LEQUAL),t.clearDepth(1),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",this.onfullscreen.bind(this)),this[ph]=new ResizeSensor(this.getSurface(),this.reshape.bind(this)),this.getSurface().css("position",""),this.reshape()},getRenderer:function(){const t=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const e=t.getExtension("WEBGL_debug_renderer_info");if(e)return t.getParameter(e.UNMASKED_RENDERER_WEBGL)}return t.getParameter(t.RENDERER)},getVendor:function(){const t=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const e=t.getExtension("WEBGL_debug_renderer_info");if(e)return t.getParameter(e.UNMASKED_VENDOR_WEBGL)}return t.getParameter(t.VENDOR)},getWebGLVersion:function(){const t=this.getContext();return t.getParameter(t.VERSION)},getAntialiased:function(){const t=this.getContext();return t.getParameter(t.SAMPLES)>0},getMaxClipPlanes:function(){return 6},getDepthSize:function(){const t=this.getContext();return t.getParameter(t.DEPTH_BITS)},getColorDepth:function(){const t=this.getContext();return t.getParameter(t.RED_BITS)+t.getParameter(t.BLUE_BITS)+t.getParameter(t.GREEN_BITS)+t.getParameter(t.ALPHA_BITS)},getViewport:function(){return this[hh]},getLocalObjects:function(){return this[dh]},getDepthShader:function(t,e){let n="";return n+=t,n+=e?"1":"0",this[fh].get(n)||this.createDepthShader(n,t,e)},createDepthShader:function(t,e,n){const i=[];e&&(i.push("X3D_CLIP_PLANES"),i.push("X3D_NUM_CLIP_PLANES "+e)),n&&i.push("X3D_PARTICLE_SYSTEM");const o=this.createShader("DepthShader","Depth","Depth",i);return this[fh].set(t,o),o},reshape:function(){const t=this.getContext(),e=this.getCanvas(),n=e.width(),i=e.height(),o=e[0];o.width=n,o.height=i,this[hh][2]=n,this[hh][3]=i,t.viewport(0,0,n,i),t.scissor(0,0,n,i),this.addBrowserEvent()},onfullscreen:function(){const t=this.getElement();t.fullScreen()?t.addClass("x_ite-fullscreen"):t.removeClass("x_ite-fullscreen")}};const mh=gh,_h=Symbol();function xh(){this[_h]=[this]}xh.prototype={initialize:function(){},isExternal:function(){return 1===this[_h].length},getScriptStack:function(){return this[_h]}};const yh=xh,wh={includes:{1:{ClipPlanes:"\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n",Colors:"\n#define MANUAL_SRGB\n\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\nvec4\nGamma (const in vec4 color)\n{\n   #if defined (MANUAL_SRGB)\n      return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n   #else\n      return color;\n   #endif\n}\n",Fog:"\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n",Fragment:'\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   #extension GL_EXT_frag_depth : enable\n#endif\n\nuniform float x3d_AlphaCutoff;\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   varying float depth;\n#endif\n\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Texture.glsl"\n\nvec4\ngetMaterialColor ();\n\nvec4\ngetFinalColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         setTexCoords ();\n\n         return getMaterialColor ();\n       #else\n         return getPointColor (getMaterialColor ());\n      #endif\n   #else\n      return getMaterialColor ();\n   #endif\n}\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   vec4 finalColor = getFinalColor ();\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   if (finalColor .a < x3d_AlphaCutoff)\n      discard;\n\n   gl_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //http://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepthEXT = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n',Hatch:"\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture2D (x3d_FillProperties .texture, gl_FragCoord .xy / 32.0);\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n",Material:'\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n',Normal:"\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE) && ! defined (X3D_NORMAL_TEXTURE_3D)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture2D (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = textureCube (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n",Pack:"\nvec4\npack (const in float value)\n{\n   const vec3 bitShifts = vec3 (255.0,\n                                255.0 * 255.0,\n                                255.0 * 255.0 * 255.0);\n\n   return vec4 (value, fract (value * bitShifts));\n}\n\n#if defined (X3D_DEPTH_TEXTURE)\n\nfloat\nunpack (const in vec4 color)\n{\n   return color .r;\n}\n\n#else\n\nfloat\nunpack (const vec4 color)\n{\n   const vec3 bitShifts = vec3 (1.0 / 255.0,\n                                1.0 / (255.0 * 255.0),\n                                1.0 / (255.0 * 255.0 * 255.0));\n\n   return color .x + dot (color .gba, bitShifts);\n}\n\n#endif\n",Perlin:"\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n",Point:"\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nvarying float pointSize;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoord0 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoord1 = texCoord;\n   #endif\n}\n#endif\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n\n#endif\n",PointSize:"\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nvarying float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue    = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue    = x3d_PointProperties .pointSizeMaxValue;\n   vec3  pointSizeAttenuation = x3d_PointProperties .pointSizeAttenuation;\n   float dL                   = length (vertex);\n   float pointSize            = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (pointSizeAttenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n",Shadow:'\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\n#pragma X3D include "Pack.glsl"\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   #if X3D_NUM_LIGHTS > 0\n   if (index == 0)\n      return unpack (texture2D (x3d_ShadowMap [0], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 1\n   if (index == 1)\n      return unpack (texture2D (x3d_ShadowMap [1], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 2\n   if (index == 2)\n      return unpack (texture2D (x3d_ShadowMap [2], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 3\n   if (index == 3)\n      return unpack (texture2D (x3d_ShadowMap [3], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 4\n   if (index == 4)\n      return unpack (texture2D (x3d_ShadowMap [4], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 5\n   if (index == 5)\n      return unpack (texture2D (x3d_ShadowMap [5], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 6\n   if (index == 6)\n      return unpack (texture2D (x3d_ShadowMap [6], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 7\n   if (index == 7)\n      return unpack (texture2D (x3d_ShadowMap [7], shadowCoord));\n   #endif\n\n   return 0.0;\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize .x;\n         float dy0 = - texelSize .y;\n         float dx1 = + texelSize .x;\n         float dy1 = + texelSize .y;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy, shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize.x;\n         float dy0 = - texelSize.y;\n         float dx1 = + texelSize.x;\n         float dy1 = + texelSize.y;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy, shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * ( 1.0 / 9.0 );\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n',SpotFactor:"\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n",Texture:'\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nmat4\ngetTextureMatrix (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      mat4 textureMatrix = mat4 (0.0);\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 0\n      if (i == 0)\n         textureMatrix = x3d_TextureMatrix [0];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 1\n      else if (i == 1)\n         textureMatrix = x3d_TextureMatrix [1];\n      #endif\n\n      return textureMatrix;\n   #else\n      return x3d_TextureMatrix [0];\n   #endif\n}\n\nvec4\ngetTexCoord (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 texCoord = vec4 (0.0);\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n      if (i == 0)\n         texCoord = texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n      else if (i == 1)\n         texCoord = texCoord1;\n      #endif\n\n      return texCoord;\n   #else\n      return texCoord0;\n   #endif\n}\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   if (mode == x3d_None)\n   {\n      return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n   }\n   else if (mode == x3d_Sphere)\n   {\n      vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceNormal)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (N, 1.0);\n   }\n   else if (mode == x3d_CameraSpacePosition)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceReflectionVector)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (reflect (normalize (vertex), -N), 1.0);\n   }\n   else if (mode == x3d_SphereLocal)\n   {\n      vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_Coord)\n   {\n      return vec4 (localVertex, 1.0);\n   }\n   else if (mode == x3d_CoordEye)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_Noise)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (localVertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_NoiseEye)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (vertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_SphereReflect)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n      float eta = textureCoordinateGenerator .parameter [0];\n\n      return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n   }\n   else if (mode == x3d_SphereReflectLocal)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n      float eta = textureCoordinateGenerator .parameter [0];\n      vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n      return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n   }\n\n   return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord;\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n   if (textureCoordinateMapping == 0)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [0], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n   else if (textureCoordinateMapping == 1)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [1], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   vec4 textureColor = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURES > 0\n   if (i == 0)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   #if X3D_NUM_TEXTURES > 1\n   else if (i == 1)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [1], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [1], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   return textureColor;\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (i, i);\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         if (source == x3d_Diffuse)\n         {\n            arg1 = diffuseColor;\n         }\n         else if (source == x3d_Specular)\n         {\n            arg1 = specularColor;\n         }\n         else if (source == x3d_Factor)\n         {\n            arg1 = x3d_MultiTextureColor;\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         if (function == x3d_Complement)\n         {\n            arg1 = 1.0 - arg1;\n         }\n         else if (function == x3d_AlphaReplicate)\n         {\n            arg1 .a = arg2 .a;\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         if (mode == x3d_Replace)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_Modulate)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .rgb;\n         }\n         else if (mode == x3d_Modulate2X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n         }\n         else if (mode == x3d_Modulate4X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n         }\n         else if (mode == x3d_Add)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb;\n         }\n         else if (mode == x3d_AddSigned)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n         }\n         else if (mode == x3d_AddSigned2X)\n         {\n            currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n         }\n         else if (mode == x3d_AddSmooth)\n         {\n            currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n         }\n         else if (mode == x3d_Subtract)\n         {\n            currentColor .rgb = arg1 .rgb - arg2 .rgb;\n         }\n         else if (mode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n         }\n         else if (mode == x3d_BlendTextureAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n         }\n         else if (mode == x3d_BlendFactorAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (mode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n         }\n         else if (mode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n         }\n         else if (mode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n         }\n         else if (mode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n         }\n         else if (mode == x3d_DotProduct3)\n         {\n            currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n         }\n         else if (mode == x3d_SelectArg1)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_SelectArg2)\n         {\n            currentColor .rgb = arg2 .rgb;\n         }\n         else if (mode == x3d_Off)\n            ;\n\n         // Alpha\n\n         if (alphaMode == x3d_Replace)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_Modulate)\n         {\n            currentColor .a = arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_Modulate2X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n         }\n         else if (alphaMode == x3d_Modulate4X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n         }\n         else if (alphaMode == x3d_Add)\n         {\n            currentColor .a = arg1 .a + arg2 .a;\n         }\n         else if (alphaMode == x3d_AddSigned)\n         {\n            currentColor .a = arg1 .a + arg2 .a - 0.5;\n         }\n         else if (alphaMode == x3d_AddSigned2X)\n         {\n            currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n         }\n         else if (alphaMode == x3d_AddSmooth)\n         {\n            currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n         }\n         else if (alphaMode == x3d_Subtract)\n         {\n            currentColor .a = arg1 .a - arg2 .a;\n         }\n         else if (alphaMode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n         }\n         else if (alphaMode == x3d_BlendTextureAlpha)\n         {\n            currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n         }\n         else if (alphaMode == x3d_BlendFactorAlpha)\n         {\n            currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (alphaMode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n         }\n         else if (alphaMode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_DotProduct3)\n         {\n            currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n         }\n         else if (alphaMode == x3d_SelectArg1)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_SelectArg2)\n         {\n            currentColor .a = arg2 .a;\n         }\n         else if (alphaMode == x3d_Off)\n            ;\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   vec4 color = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 0\n   if (i == 0)\n      color = texture2D (x3d_ProjectiveTexture [0], texCoord);\n   #endif\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 1\n   else if (i == 1)\n      color = texture2D (x3d_ProjectiveTexture [1], texCoord);\n   #endif\n\n   return color;\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalze p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n',Vertex:'\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   attribute float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   attribute vec4 x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         attribute vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         attribute vec4 x3d_TexCoord1;\n      #endif\n   #endif\n#endif\n\nattribute vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   attribute vec3 x3d_Normal;\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   varying float depth;\n#endif\n\n// Main\n\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = x3d_TexCoord0;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = x3d_TexCoord1;\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal      = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n'},2:{ClipPlanes:"\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n",Colors:"\n#define MANUAL_SRGB\n\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\nvec4\nGamma (const in vec4 color)\n{\n   #if defined (MANUAL_SRGB)\n      return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n   #else\n      return color;\n   #endif\n}\n",Fog:"\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n",Fragment:'\nuniform float x3d_AlphaCutoff;\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 texCoord1;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   in vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      in vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nin vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   in vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   in float depth;\n#endif\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Stipple.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Texture.glsl"\n\nvec4\ngetMaterialColor ();\n\nvec4\ngetFinalColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         setTexCoords ();\n\n         return getMaterialColor ();\n       #else\n         return getPointColor (getMaterialColor ());\n      #endif\n   #else\n      return getMaterialColor ();\n   #endif\n}\n\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      stipple ();\n   #endif\n\n   vec4 finalColor = getFinalColor ();\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   if (finalColor .a < x3d_AlphaCutoff)\n      discard;\n\n   x3d_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //http://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepth = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n',Hatch:"\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture (x3d_FillProperties .texture, gl_FragCoord .xy / 32.0);\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n",Line2:"\nstruct Line2\n{\n   vec2 point;\n   vec2 direction;\n};\n\nLine2\nline2 (const in vec2 point1, const in vec2 point2)\n{\n   return Line2 (point1, normalize (point2 - point1));\n}\n\nvec2\nclosest_point (const in Line2 line, const in vec2 point)\n{\n   vec2  r = point - line .point;\n   float d = dot (r, line .direction);\n\n   return line .direction * d + line .point;\n}\n",Material:'\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n',Normal:"\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_3D)\n         vec3 n = texture (x3d_NormalTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = texture (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n",Pack:"\nvec4\npack (const in float value)\n{\n   const vec3 bitShifts = vec3 (255.0,\n                                255.0 * 255.0,\n                                255.0 * 255.0 * 255.0);\n\n   return vec4 (value, fract (value * bitShifts));\n}\n\n#if defined (X3D_DEPTH_TEXTURE)\n\nfloat\nunpack (const in vec4 color)\n{\n   return color .r;\n}\n\n#else\n\nfloat\nunpack (const vec4 color)\n{\n   const vec3 bitShifts = vec3 (1.0 / 255.0,\n                                1.0 / (255.0 * 255.0),\n                                1.0 / (255.0 * 255.0 * 255.0));\n\n   return color .x + dot (color .gba, bitShifts);\n}\n\n#endif\n",Particle:"\n#if defined (X3D_PARTICLE_SYSTEM)\n\nin vec4 x3d_Particle;\nin mat4 x3d_ParticleMatrix;\n\nuniform sampler2D x3d_TexCoordRamp;\n\nvec4\ntexelFetch (const in sampler2D sampler, const in int index, const in int lod)\n{\n   int   x = textureSize (sampler, lod) .x;\n   ivec2 p = ivec2 (index % x, index / x);\n   vec4  t = texelFetch (sampler, p, lod);\n\n   return t;\n}\n\n#if defined (X3D_TEX_COORD_RAMP)\nvec4\ngetTexCoord (const in vec4 texCoord)\n{\n   const int map [6] = int [6] (0, 1, 2, 0, 2, 3);\n\n   int index0 = int (x3d_Particle [3]);\n\n   return texelFetch (x3d_TexCoordRamp, index0 + map [gl_VertexID % 6], 0);\n}\n#else\n   #define getTexCoord(texCoord) texCoord\n#endif\n\nvec4\ngetVertex (const in vec4 vertex)\n{\n   return x3d_ParticleMatrix * vertex;\n}\n\n#else\n\n#define getVertex(vertex) vertex\n#define getTexCoord(texCoord) texCoord\n\n#endif\n",Perlin:"\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n",Point:"\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nin float pointSize;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoord0 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoord1 = texCoord;\n   #endif\n}\n#endif\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n\n#endif\n",PointSize:"\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nout float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue    = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue    = x3d_PointProperties .pointSizeMaxValue;\n   vec3  pointSizeAttenuation = x3d_PointProperties .pointSizeAttenuation;\n   float dL                   = length (vertex);\n   float pointSize            = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (pointSizeAttenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n",Shadow:'\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\n#pragma X3D include "Pack.glsl"\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   switch (index)\n   {\n      #if X3D_NUM_LIGHTS > 0\n      case 0:\n      {\n         return unpack (texture (x3d_ShadowMap [0], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 1\n      case 1:\n      {\n         return unpack (texture (x3d_ShadowMap [1], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 2\n      case 2:\n      {\n         return unpack (texture (x3d_ShadowMap [2], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 3\n      case 3:\n      {\n         return unpack (texture (x3d_ShadowMap [3], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 4\n      case 4:\n      {\n         return unpack (texture (x3d_ShadowMap [4], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 5\n      case 5:\n      {\n         return unpack (texture (x3d_ShadowMap [5], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 6\n      case 6:\n      {\n         return unpack (texture (x3d_ShadowMap [6], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 7\n      case 7:\n      {\n         return unpack (texture (x3d_ShadowMap [7], shadowCoord));\n      }\n      #endif\n      default:\n      {\n         return 0.0;\n      }\n   }\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize .x;\n         float dy0 = - texelSize .y;\n         float dx1 = + texelSize .x;\n         float dy1 = + texelSize .y;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy, shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize.x;\n         float dy0 = - texelSize.y;\n         float dx1 = + texelSize.x;\n         float dy1 = + texelSize.y;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy, shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * ( 1.0 / 9.0 );\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n',Stipple:'\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n\n#pragma X3D include "Line2.glsl"\n\nuniform x3d_LinePropertiesParameters x3d_LineProperties;\n\nflat in float lengthSoFar; // in px\nflat in vec2  startPoint;  // in px\nin vec2       midPoint;    // in px\n\nvoid\nstipple ()\n{\n   vec2  point = closest_point (line2 (startPoint, midPoint), gl_FragCoord .xy);\n   float s     = (lengthSoFar + length (point - startPoint)) * x3d_LineProperties .lineStippleScale;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         texCoord0 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         texCoord1 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n\n   if (x3d_LineProperties .linetype != 16)\n   {\n      int   linetype = x3d_LineProperties .linetype;\n      int   height   = textureSize (x3d_LineProperties .texture, 0) .y;\n      float t        = 1.0 - float (linetype * 2 + 1) / float (height * 2);\n      float alpha    = texture (x3d_LineProperties .texture, vec2 (s, t)) .a;\n\n      if (alpha != 1.0)\n         discard;\n   }\n}\n\n#endif\n',SpotFactor:"\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n",Texture:'\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nvec4\ngetTexCoord (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      switch (i)\n      {\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n         case 0:\n            return texCoord0;\n         #endif\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n         case 1:\n            return texCoord1;\n         #endif\n      }\n\n      return vec4 (0.0);\n   #else\n      return texCoord0;\n   #endif\n}\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   switch (mode)\n   {\n      case x3d_None:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * getTexCoord (textureCoordinateMapping);\n      }\n      case x3d_Sphere:\n      {\n         vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_CameraSpaceNormal:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (N, 1.0);\n      }\n      case x3d_CameraSpacePosition:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_CameraSpaceReflectionVector:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (reflect (normalize (vertex), -N), 1.0);\n      }\n      case x3d_SphereLocal:\n      {\n         vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_Coord:\n      {\n         return vec4 (localVertex, 1.0);\n      }\n      case x3d_CoordEye:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_Noise:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (localVertex * scale + translation), 1.0);\n      }\n      case x3d_NoiseEye:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (vertex * scale + translation), 1.0);\n      }\n      case x3d_SphereReflect:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n         float eta = textureCoordinateGenerator .parameter [0];\n\n         return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n      }\n      case x3d_SphereReflectLocal:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n         float eta = textureCoordinateGenerator .parameter [0];\n         vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n         return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n      }\n      default:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * getTexCoord (textureCoordinateMapping);\n      }\n   }\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord = getTexCoord (x3d_TextureCoordinateGenerator [textureCoordinateMapping], textureTransformMapping, textureCoordinateMapping);\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform int         x3d_TextureType [X3D_NUM_TEXTURES];\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform sampler3D   x3d_Texture3D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURES > 0\n      case 0:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [0], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [0], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [0], texCoord .stp);\n         #endif\n      #endif\n      #if X3D_NUM_TEXTURES > 1\n      case 1:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [1], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [1], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [1], texCoord .stp);\n         #endif\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (i, i);\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         switch (source)\n         {\n            case x3d_Diffuse:\n            {\n               arg1 = diffuseColor;\n               break;\n            }\n            case x3d_Specular:\n            {\n               arg1 = specularColor;\n               break;\n            }\n            case x3d_Factor:\n            {\n               arg1 = x3d_MultiTextureColor;\n               break;\n            }\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         switch (function)\n         {\n            case x3d_Complement:\n            {\n               arg1 = 1.0 - arg1;\n               break;\n            }\n            case x3d_AlphaReplicate:\n            {\n               arg1 .a = arg2 .a;\n               break;\n            }\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         switch (mode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .rgb;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .rgb = arg1 .rgb - arg2 .rgb;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .rgb = arg2 .rgb;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n\n         // Alpha\n\n         switch (alphaMode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .a = arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .a = arg1 .a + arg2 .a;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .a = arg1 .a + arg2 .a - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .a = arg1 .a - arg2 .a;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .a = arg2 .a;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_3D)\n         vec4 textureColor = texture (x3d_Texture3D [0], texCoord .stp);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = texture (x3d_TextureCube [0], texCoord .stp);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif // X3D_TEXTURE\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURE_PROJECTORS > 0\n      case 0:\n         return texture (x3d_ProjectiveTexture [0], texCoord);\n      #endif\n      #if X3D_NUM_TEXTURE_PROJECTORS > 1\n      case 1:\n         return texture (x3d_ProjectiveTexture [1], texCoord);\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalze p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n',Vertex:'\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   in vec3 x3d_LineStipple;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4  x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 x3d_TexCoord1;\n      #endif\n   #endif\n#endif\n\nin vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   out float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   out vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         out vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         out vec4 texCoord1;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   in  vec3 x3d_Normal;\n   out vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      out vec3 localNormal;\n   #endif\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   flat out float lengthSoFar;\n   flat out vec2  startPoint;\n   out vec2       midPoint;\n#endif\n\nout vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   out vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   out float depth;\n#endif\n\n// Main\n\n#pragma X3D include "Particle.glsl"\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      lengthSoFar = x3d_LineStipple .z;\n      startPoint  = x3d_LineStipple .xy;\n      midPoint    = x3d_LineStipple .xy;\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = getTexCoord (x3d_TexCoord0);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = getTexCoord (x3d_TexCoord1);\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n'}},vertex:{1:{Default:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n',Depth:"\nprecision highp float;\nprecision highp int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nattribute vec4 x3d_Vertex;\n\nvarying vec3 vertex;\n\nvoid\nmain ()\n{\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n",Gouraud:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n'},2:{Default:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n',Depth:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nin vec4 x3d_Vertex;\n\nout vec3 vertex;\n\n#pragma X3D include "include/Particle.glsl"\n\nvoid\nmain ()\n{\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n',Gouraud:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nout vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   out vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n',LineTransform:"#version 300 es\n\nprecision highp float;\n\nuniform vec4  viewport;\nuniform mat4  modelViewProjectionMatrix;\nuniform mat4  invModelViewProjectionMatrix;\nuniform float scale;\n\nin vec3 x3d_LineStipple0; in float x3d_FogDepth0; in vec4 x3d_Color0; in vec4 x3d_Vertex0;\nin vec3 x3d_LineStipple1; in float x3d_FogDepth1; in vec4 x3d_Color1; in vec4 x3d_Vertex1;\n\nout vec3 lineStipple0; out float fogDepth0; out vec4 color0; out vec4 vertex0;\nout vec3 lineStipple1; out float fogDepth1; out vec4 color1; out vec4 vertex1;\nout vec3 lineStipple2; out float fogDepth2; out vec4 color2; out vec4 vertex2;\n\nvec3\nprojectPoint (const in vec4 point, const in mat4 modelViewProjectionMatrix, const in vec4 viewport)\n{\n   vec4 vin = modelViewProjectionMatrix * point;\n\n   vin .xyz = vin .xyz / (2.0 * vin .w) + 0.5;\n\n   return vec3 (vin .xy * viewport .zw + viewport .xy, vin .z);\n}\n\nvec4\nunProjectPoint (const in vec3 win, const in mat4 invModelViewProjection, const in vec4 viewport)\n{\n   vec4 vin = vec4 ((win .xy - viewport .xy) / viewport .zw * 2.0 - 1.0, 2.0 * win .z - 1.0, 1.0);\n\n   vin = invModelViewProjection * vin;\n\n   return vec4 (vin .xyz / vin .w, 1.0);\n}\n\nvoid\nmain ()\n{\n   vec3 projected0 = projectPoint (x3d_Vertex0, modelViewProjectionMatrix, viewport);\n   vec3 projected1 = projectPoint (x3d_Vertex1, modelViewProjectionMatrix, viewport);\n   vec2 direction  = normalize (projected1 .xy - projected0 .xy);\n   vec2 offset     = vec2 (-direction .y, direction .x) * scale;\n\n   // 0 - 3\n   // |  |\n   // 1 - 2\n\n   if (gl_InstanceID == 0)\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq1 = projected0 .xy - offset;\n      vec2 pq2 = projected1 .xy - offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p1 = unProjectPoint (vec3 (pq1 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple0; fogDepth1 = x3d_FogDepth0; color1 = x3d_Color0; vertex1 = p1;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; vertex2 = p2;\n   }\n   else\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq2 = projected1 .xy - offset;\n      vec2 pq3 = projected1 .xy + offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p3 = unProjectPoint (vec3 (pq3 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple1; fogDepth1 = x3d_FogDepth1; color1 = x3d_Color1; vertex1 = p2;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; vertex2 = p3;\n   }\n}\n"}},fragment:{1:{Depth:'\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vertex;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Pack.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   gl_FragColor = pack (gl_FragCoord .z);\n}\n',Gouraud:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',PBR:'\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\n#extension GL_EXT_shader_texture_lod: enable\n#extension GL_OES_standard_derivatives : enable\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture2D (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (textureCube (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture2D (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (textureCube (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture2D (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = textureCube (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture2D (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',Phong:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture2D (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * textureCube (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture2D (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * textureCube (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture2D (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * textureCube (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture2D (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * textureCube (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',Unlit:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n'},2:{Depth:'#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nin vec3 vertex;\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Pack.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   x3d_FragColor = pack (gl_FragCoord .z);\n}\n',Gouraud:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nin vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',LineTransform:"#version 300 es\n\nprecision highp float;\n\nvoid\nmain () { }\n",PBR:'#version 300 es\n\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_3D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture3D, texCoord));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture3D, texCoord)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture3D, texCoord);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',Phong:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_3D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * texture (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_3D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture3D, texCoord);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * texture (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_3D)\n         return specularParameter * texture (x3d_SpecularTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * texture (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_3D)\n         return shininess * texture (x3d_ShininessTexture .texture3D, texCoord) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * texture (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',Unlit:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n'}}};function Th(t){es.call(this,t),this.addType(o.X3DShaderNode),this.valid=!1,this.selected=0}Th.prototype=Object.assign(Object.create(es.prototype),{constructor:Th,setValid:function(t){this._isValid=this.valid=t},isValid:function(){return this.valid},select:function(){++this.selected,this._isSelected.getValue()||(this._isSelected=!0)},deselect:function(){--this.selected,0===this.selected&&this._isSelected.getValue()&&(this._isSelected=!1)}});const Sh=Th,bh=Symbol.for("X3DField.uniformLocation");function vh(t){this.addType(o.X3DProgrammableShaderObject),this.uniformNames=[],this.x3d_ClipPlane=[],this.x3d_LightType=[],this.x3d_LightOn=[],this.x3d_LightColor=[],this.x3d_LightIntensity=[],this.x3d_LightAmbientIntensity=[],this.x3d_LightAttenuation=[],this.x3d_LightLocation=[],this.x3d_LightDirection=[],this.x3d_LightBeamWidth=[],this.x3d_LightCutOffAngle=[],this.x3d_LightRadius=[],this.x3d_LightMatrix=[],this.x3d_ShadowIntensity=[],this.x3d_ShadowColor=[],this.x3d_ShadowBias=[],this.x3d_ShadowMatrix=[],this.x3d_ShadowMapSize=[],this.x3d_ShadowMap=[],this.x3d_Texture=[],this.x3d_MultiTextureMode=[],this.x3d_MultiTextureAlphaMode=[],this.x3d_MultiTextureSource=[],this.x3d_MultiTextureFunction=[],this.x3d_TextureCoordinateGeneratorMode=[],this.x3d_TextureCoordinateGeneratorParameter=[],this.x3d_ProjectiveTexture=[],this.x3d_ProjectiveTextureMatrix=[],this.x3d_ProjectiveTextureLocation=[],this.x3d_TexCoord=[],this.x3d_TextureMatrix=[],this.numClipPlanes=0,this.fogNode=null,this.numLights=0,this.numGlobalLights=0,this.lightNodes=[],this.numProjectiveTextures=0,this.numGlobalProjectiveTextures=0,this.projectiveTextureNodes=[],this.textures=new Set}function Eh(t){return t[0].toLowerCase()+t.slice(1)}vh.prototype={constructor:vh,initialize:function(){const t=this.getBrowser();t.getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.x3d_MaxTextures=t.getMaxTextures(),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__:function(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},canUserDefinedFields:function(){return!0},getUniformNames:function(){return this.uniformNames},setUniformNames:function(t){this.uniformNames=t},getDefaultUniformsAndAttributes:function(){const t=this.getProgram(),e=this.getBrowser(),n=e.getContext(),i=e.getMaxClipPlanes(),o=e.getMaxLights(),r=e.getMaxTextures();n.useProgram(t);for(const e of this.uniformNames)this[e]=n.getUniformLocation(t,e);this.x3d_LogarithmicFarFactor1_2=n.getUniformLocation(t,"x3d_LogarithmicFarFactor1_2");for(let e=0;e<i;++e)this.x3d_ClipPlane[e]=n.getUniformLocation(t,"x3d_ClipPlane["+e+"]");this.x3d_FogColor=this.getUniformLocation(n,t,"x3d_Fog.color","x3d_FogColor"),this.x3d_FogVisibilityRange=this.getUniformLocation(n,t,"x3d_Fog.visibilityRange","x3d_FogVisibilityRange"),this.x3d_FogMatrix=this.getUniformLocation(n,t,"x3d_Fog.matrix","x3d_FogMatrix"),this.x3d_AlphaCutoff=n.getUniformLocation(t,"x3d_AlphaCutoff"),this.x3d_PointPropertiesPointSizeScaleFactor=n.getUniformLocation(t,"x3d_PointProperties.pointSizeScaleFactor"),this.x3d_PointPropertiesPointSizeMinValue=n.getUniformLocation(t,"x3d_PointProperties.pointSizeMinValue"),this.x3d_PointPropertiesPointSizeMaxValue=n.getUniformLocation(t,"x3d_PointProperties.pointSizeMaxValue"),this.x3d_PointPropertiesPointSizeAttenuation=n.getUniformLocation(t,"x3d_PointProperties.pointSizeAttenuation"),this.x3d_LinePropertiesApplied=n.getUniformLocation(t,"x3d_LineProperties.applied"),this.x3d_LinePropertiesLinetype=n.getUniformLocation(t,"x3d_LineProperties.linetype"),this.x3d_LineStippleScale=n.getUniformLocation(t,"x3d_LineProperties.lineStippleScale"),this.x3d_LinePropertiesTexture=n.getUniformLocation(t,"x3d_LineProperties.texture"),this.x3d_FillPropertiesFilled=n.getUniformLocation(t,"x3d_FillProperties.filled"),this.x3d_FillPropertiesHatched=n.getUniformLocation(t,"x3d_FillProperties.hatched"),this.x3d_FillPropertiesHatchColor=n.getUniformLocation(t,"x3d_FillProperties.hatchColor"),this.x3d_FillPropertiesTexture=n.getUniformLocation(t,"x3d_FillProperties.texture");for(let e=0;e<o;++e)this.x3d_LightType[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].type","x3d_LightType["+e+"]"),this.x3d_LightColor[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].color","x3d_LightColor["+e+"]"),this.x3d_LightAmbientIntensity[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].ambientIntensity","x3d_LightAmbientIntensity["+e+"]"),this.x3d_LightIntensity[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].intensity","x3d_LightIntensity["+e+"]"),this.x3d_LightAttenuation[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].attenuation","x3d_LightAttenuation["+e+"]"),this.x3d_LightLocation[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].location","x3d_LightLocation["+e+"]"),this.x3d_LightDirection[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].direction","x3d_LightDirection["+e+"]"),this.x3d_LightBeamWidth[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].beamWidth","x3d_LightBeamWidth["+e+"]"),this.x3d_LightCutOffAngle[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].cutOffAngle","x3d_LightCutOffAngle["+e+"]"),this.x3d_LightRadius[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].radius","x3d_LightRadius["+e+"]"),this.x3d_LightMatrix[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].matrix","x3d_LightMatrix["+e+"]"),this.x3d_ShadowIntensity[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowIntensity"),this.x3d_ShadowColor[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowColor"),this.x3d_ShadowBias[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowBias"),this.x3d_ShadowMatrix[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowMatrix"),this.x3d_ShadowMapSize[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowMapSize"),this.x3d_ShadowMap[e]=n.getUniformLocation(t,"x3d_ShadowMap["+e+"]");this.x3d_AmbientIntensity=this.getUniformLocation(n,t,"x3d_Material.ambientIntensity","x3d_FrontMaterial.ambientIntensity"),this.x3d_DiffuseColor=this.getUniformLocation(n,t,"x3d_Material.diffuseColor","x3d_FrontMaterial.diffuseColor"),this.x3d_SpecularColor=this.getUniformLocation(n,t,"x3d_Material.specularColor","x3d_FrontMaterial.specularColor"),this.x3d_EmissiveColor=this.getUniformLocation(n,t,"x3d_Material.emissiveColor","x3d_FrontMaterial.emissiveColor"),this.x3d_Shininess=this.getUniformLocation(n,t,"x3d_Material.shininess","x3d_FrontMaterial.shininess"),this.x3d_BaseColor=n.getUniformLocation(t,"x3d_Material.baseColor"),this.x3d_Metallic=n.getUniformLocation(t,"x3d_Material.metallic"),this.x3d_Roughness=n.getUniformLocation(t,"x3d_Material.roughness"),this.x3d_OcclusionStrength=n.getUniformLocation(t,"x3d_Material.occlusionStrength"),this.x3d_NormalScale=n.getUniformLocation(t,"x3d_Material.normalScale"),this.x3d_Transparency=this.getUniformLocation(n,t,"x3d_Material.transparency","x3d_FrontMaterial.transparency");const s=["x3d_AmbientTexture","x3d_DiffuseTexture","x3d_SpecularTexture","x3d_EmissiveTexture","x3d_ShininessTexture","x3d_BaseTexture","x3d_MetallicRoughnessTexture","x3d_OcclusionTexture","x3d_NormalTexture"];for(const e of s)this[e]={textureTransformMapping:n.getUniformLocation(t,e+".textureTransformMapping"),textureCoordinateMapping:n.getUniformLocation(t,e+".textureCoordinateMapping"),texture2D:n.getUniformLocation(t,e+".texture2D"),texture3D:n.getUniformLocation(t,e+".texture3D"),textureCube:n.getUniformLocation(t,e+".textureCube")};this.x3d_MultiTextureColor=n.getUniformLocation(t,"x3d_MultiTextureColor"),this.x3d_TexCoord.length=0;for(let e=0;e<r;++e){const i=this.getAttribLocation(n,t,"x3d_TexCoord"+e,e?"":"x3d_TexCoord");-1!==i&&this.x3d_TexCoord.push([e,i]),this.x3d_TextureMatrix[e]=n.getUniformLocation(t,"x3d_TextureMatrix["+e+"]"),this.x3d_TextureCoordinateGeneratorMode[e]=n.getUniformLocation(t,"x3d_TextureCoordinateGenerator["+e+"].mode"),this.x3d_TextureCoordinateGeneratorParameter[e]=n.getUniformLocation(t,"x3d_TextureCoordinateGenerator["+e+"].parameter"),this.x3d_Texture[e]={texture2D:n.getUniformLocation(t,"x3d_Texture2D["+e+"]"),texture3D:n.getUniformLocation(t,"x3d_Texture3D["+e+"]"),textureCube:this.getUniformLocation(n,t,"x3d_TextureCube["+e+"]","x3d_CubeMapTexture["+e+"]")},this.x3d_MultiTextureMode[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].mode"),this.x3d_MultiTextureAlphaMode[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].alphaMode"),this.x3d_MultiTextureSource[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].source"),this.x3d_MultiTextureFunction[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].function"),this.x3d_ProjectiveTexture[e]=n.getUniformLocation(t,"x3d_ProjectiveTexture["+e+"]"),this.x3d_ProjectiveTextureMatrix[e]=n.getUniformLocation(t,"x3d_ProjectiveTextureMatrix["+e+"]"),this.x3d_ProjectiveTextureLocation[e]=n.getUniformLocation(t,"x3d_ProjectiveTextureLocation["+e+"]")}this.x3d_TexCoordRamp=n.getUniformLocation(t,"x3d_TexCoordRamp"),this.x3d_Viewport=n.getUniformLocation(t,"x3d_Viewport"),this.x3d_ProjectionMatrix=n.getUniformLocation(t,"x3d_ProjectionMatrix"),this.x3d_ModelViewMatrix=n.getUniformLocation(t,"x3d_ModelViewMatrix"),this.x3d_NormalMatrix=n.getUniformLocation(t,"x3d_NormalMatrix"),this.x3d_CameraSpaceMatrix=n.getUniformLocation(t,"x3d_CameraSpaceMatrix");const a=["LineStipple","FogDepth","Color","Normal","Vertex","Particle","ParticleMatrix"];for(const e of a){const i=n.getAttribLocation(t,`x3d_${e}`);this[`x3d_${e}`]=i,i<0?(this[`enable${e}Attribute`]=Function.prototype,this[`${Eh(e)}AttributeDivisor`]=Function.prototype):(delete this[`enable${e}Attribute`],delete this[`${Eh(e)}AttributeDivisor`])}0===this.x3d_TexCoord.length?(this.enableTexCoordAttribute=Function.prototype,this.texCoordAttributeDivisor=Function.prototype):(delete this.enableTexCoordAttribute,delete this.texCoordAttributeDivisor),n.uniform1f(this.x3d_LineStippleScale,e.getLineStippleScale()),n.uniform1i(this.x3d_LinePropertiesTexture,e.getDefaultTexture2DUnit()),n.uniform1i(this.x3d_FillPropertiesTexture,e.getDefaultTexture2DUnit());for(const t of s)n.uniform1i(this[t].texture2D,e.getDefaultTexture2DUnit()),n.uniform1i(this[t].texture3D,e.getDefaultTexture3DUnit()),n.uniform1i(this[t].textureCube,e.getDefaultTextureCubeUnit());for(const t of this.x3d_Texture)n.uniform1i(t.texture2D,e.getDefaultTexture2DUnit()),n.getVersion()>=2&&n.uniform1i(t.texture3D,e.getDefaultTexture3DUnit()),n.uniform1i(t.textureCube,e.getDefaultTextureCubeUnit());for(const t of this.x3d_ShadowMap)n.uniform1i(t,e.getDefaultTexture2DUnit());for(const t of this.x3d_ProjectiveTexture)n.uniform1i(t,e.getDefaultTexture2DUnit());n.uniform1i(this.x3d_TexCoordRamp,e.getDefaultTexture2DUnit())},getUniformLocation:function(t,e,n,i){let o=t.getUniformLocation(e,n);return o||(i?(o=t.getUniformLocation(e,i),o&&console.warn(this.getTypeName(),this.getName(),"Using uniform location name »"+i+"« is depreciated, use »"+n+"«. See https://create3000.github.io/x_ite/Custom-Shaders.html."),o):0)},getAttribLocation:function(t,e,n,i){let o=t.getAttribLocation(e,n);return o>=0?o:i?(o=t.getAttribLocation(e,i),o>=0&&console.warn(this.getTypeName(),this.getName(),"Using attribute location name »"+i+"« is depreciated, use »"+n+"«. See https://create3000.github.io/x_ite/Custom-Shaders.html."),o):-1},addShaderFields:function(){const t=this.getProgram(),e=this.getBrowser().getContext();e.useProgram(t),this.textures.clear();for(const n of this.getUserDefinedFields()){const i=e.getUniformLocation(t,n.getName());if(i){switch(n.getType()){case o.SFImage:i.array=new Int32Array(3+n.array.length);break;case o.SFMatrix3d:case o.SFMatrix3f:case o.SFRotation:i.array=new Float32Array(9);break;case o.SFMatrix4d:case o.SFMatrix4f:i.array=new Float32Array(16);break;case o.SFNode:break;case o.MFBool:case o.MFInt32:i.array=new Int32Array(this.getLocationLength(e,t,n));break;case o.MFFloat:case o.MFDouble:case o.MFTime:i.array=new Float32Array(this.getLocationLength(e,t,n));break;case o.MFImage:i.array=new Int32Array(this.getImagesLength(n));break;case o.MFMatrix3d:case o.MFMatrix3f:case o.MFRotation:i.array=new Float32Array(9*this.getLocationLength(e,t,n));break;case o.MFMatrix4d:case o.MFMatrix4f:i.array=new Float32Array(16*this.getLocationLength(e,t,n));break;case o.MFNode:{const o=i.locations=[];for(let i=0;;++i){const r=e.getUniformLocation(t,n.getName()+"["+i+"]");if(!r)break;o.push(r)}break}case o.MFVec2d:case o.MFVec2f:i.array=new Float32Array(2*this.getLocationLength(e,t,n));break;case o.MFVec3d:case o.MFVec3f:case o.MFColor:i.array=new Float32Array(3*this.getLocationLength(e,t,n));break;case o.MFVec4d:case o.MFVec4f:case o.MFColorRGBA:i.array=new Float32Array(4*this.getLocationLength(e,t,n))}i.array?n[bh]=i.array.length?i:null:n[bh]=i,n.addInterest("set_field__",this),this.set_field__(n)}}},removeShaderFields:function(){for(const t of this.getUserDefinedFields())t.removeInterest("set_field__",this)},set_field__:function(){const t=new Float32Array(9);return function(e){const n=this.getProgram(),i=this.getBrowser().getContext(),r=e[bh];if(i.useProgram(n),r)switch(e.getType()){case o.SFBool:case o.SFInt32:return void i.uniform1i(r,e.getValue());case o.SFColor:{const t=e.getValue();return void i.uniform3f(r,t.r,t.g,t.b)}case o.SFColorRGBA:{const t=e.getValue();return void i.uniform4f(r,t.r,t.g,t.b,t.a)}case o.SFDouble:case o.SFFloat:case o.SFTime:return void i.uniform1f(r,e.getValue());case o.SFImage:{let t=r.array;const n=e.array,o=3+n.length;o!==t.length&&(t=r.array=new Int32Array(o)),t[0]=e.width,t[1]=e.height,t[2]=e.comp;for(let e=3,i=0,o=n.length;i<o;++i,++e)t[e]=n[i];return void i.uniform1iv(r,t)}case o.SFMatrix3d:case o.SFMatrix3f:return r.array.set(e.getValue()),void i.uniformMatrix3fv(r,!1,r.array);case o.SFMatrix4d:case o.SFMatrix4f:return r.array.set(e.getValue()),void i.uniformMatrix4fv(r,!1,r.array);case o.SFNode:{const t=mr(o.X3DTextureNode,e);return void(t?(r.name=e.getName(),r.texture=t,this.textures.add(r)):this.textures.delete(r))}case o.SFRotation:return e.getValue().getMatrix(r.array),void i.uniformMatrix3fv(r,!1,r.array);case o.SFString:return;case o.SFVec2d:case o.SFVec2f:{const t=e.getValue();return void i.uniform2f(r,t.x,t.y)}case o.SFVec3d:case o.SFVec3f:{const t=e.getValue();return void i.uniform3f(r,t.x,t.y,t.z)}case o.SFVec4d:case o.SFVec4f:{const t=e.getValue();return void i.uniform4f(r,t.x,t.y,t.z,t.w)}case o.MFBool:case o.MFInt32:{const t=r.array;for(var s=0,a=e.length;s<a;++s)t[s]=e[s];for(let e=t.length;s<e;++s)t[s]=0;return void i.uniform1iv(r,t)}case o.MFColor:{const t=r.array;s=0;var u=0;for(a=e.length;s<a;++s){const n=e[s];t[u++]=n.r,t[u++]=n.g,t[u++]=n.b}for(let e=t.length;u<e;++u)t[u]=0;return void i.uniform3fv(r,t)}case o.MFColorRGBA:{const t=r.array;for(s=0,u=0,a=e.length;s<a;++s){const n=e[s];t[u++]=n.r,t[u++]=n.g,t[u++]=n.b,t[u++]=n.a}for(let e=t.length;u<e;++u)t[u]=0;return void i.uniform4fv(r,t)}case o.MFDouble:case o.MFFloat:case o.MFTime:{const t=r.array;for(s=0,a=e.length;s<a;++s)t[s]=e[s];for(let e=t.length;s<e;++s)t[s]=0;return void i.uniform1fv(r,t)}case o.MFImage:{const t=r.array;for(let n=0,i=0,o=e.length;n<o;++n){const o=e[n],r=o.array;t[i++]=o.width,t[i++]=o.height,t[i++]=o.comp;for(let e=0,n=r.length;e<n;++e)t[i++]=r[e]}return void i.uniform1iv(r,t)}case o.MFMatrix3d:case o.MFMatrix3f:{const t=r.array;for(s=0,u=0,a=e.length;s<a;++s){const n=e[s];for(let e=0;e<9;++e)t[u++]=n[e]}for(let e=t.length;u<e;++u)t[u]=0;return void i.uniformMatrix3fv(r,!1,t)}case o.MFMatrix4d:case o.MFMatrix4f:{const t=r.array;for(s=0,u=0,a=e.length;s<a;++s){const n=e[s];for(let e=0;e<16;++e)t[u++]=n[e]}for(let e=t.length;u<e;++u)t[u]=0;return void i.uniformMatrix4fv(r,!1,t)}case o.MFNode:{const t=r.locations;for(let n=0,i=e.length;n<i;++n){const i=mr(o.X3DTextureNode,e[n]);i?(t[n].name=e.getName(),t[n].texture=i,this.textures.add(t[n])):this.textures.delete(t[n])}return}case o.MFRotation:{const n=r.array;for(s=0,u=0,a=e.length;s<a;++s)e[s].getValue().getMatrix(t),n[u++]=t[0],n[u++]=t[1],n[u++]=t[2],n[u++]=t[3],n[u++]=t[4],n[u++]=t[5],n[u++]=t[6],n[u++]=t[7],n[u++]=t[8];for(let t=n.length;u<t;++u)n[u]=0;return void i.uniformMatrix3fv(r,!1,n)}case o.MFString:return;case o.MFVec2d:case o.MFVec2f:{const t=r.array;for(s=0,u=0,a=e.length;s<a;++s){const n=e[s];t[u++]=n.x,t[u++]=n.y}for(let e=t.length;u<e;++u)t[u]=0;return void i.uniform2fv(r,t)}case o.MFVec3d:case o.MFVec3f:{const t=r.array;for(s=0,u=0,a=e.length;s<a;++s){const n=e[s];t[u++]=n.x,t[u++]=n.y,t[u++]=n.z}for(let e=t.length;u<e;++u)t[u]=0;return void i.uniform3fv(r,t)}case o.MFVec4d:case o.MFVec4f:{const t=r.array;for(s=0,u=0,a=e.length;s<a;++s){const n=e[s];t[u++]=n.x,t[u++]=n.y,t[u++]=n.z,t[u++]=n.w}for(let e=t.length;u<e;++u)t[u]=0;return void i.uniform4fv(r,t)}}}}(),getImagesLength:function(t){const e=t.getValue();let n=3*e.length;for(const t of e)n+=t.array.length;return n},getLocationLength:function(t,e,n){const i=n.getName();for(let n=0;;++n){if(!t.getUniformLocation(e,i+"["+n+"]"))return n}},hasFog:function(t){return this.fogNode===t||(this.fogNode=t,!1)},hasLight:function(t,e){return this.lightNodes[t]===e||(this.lightNodes[t]=e,!1)},hasTextureProjector:function(t,e){return this.projectiveTextureNodes[t]===e||(this.projectiveTextureNodes[t]=e,!1)},setClipPlanes:function(t,e){this.numClipPlanes=0;for(const n of e)n.setShaderUniforms(t,this)},setUniforms:function(){const t=new Float32Array(9);return function(e,n,i,o=!0){const r=i.renderObject,s=i.fogNode,a=i.appearanceNode,u=a.getStyleProperties(n.geometryType),c=o?a.getMaterial():a.getBackMaterial(),l=i.textureNode||a.getTexture(),h=i.modelViewMatrix;if(this.renderTime!==r.getRenderTime()){this.renderTime=r.getRenderTime(),e.uniform4iv(this.x3d_Viewport,r.getViewportArray()),e.uniformMatrix4fv(this.x3d_ProjectionMatrix,!1,r.getProjectionMatrixArray()),e.uniformMatrix4fv(this.x3d_CameraSpaceMatrix,!1,r.getCameraSpaceMatrixArray()),this.fogNode=null,this.numLights=0,this.numProjectiveTextures=0,this.lightNodes.length=0,this.projectiveTextureNodes.length=0;const t=r.getGlobalObjects();for(const n of t)n.setShaderUniforms(e,this,r);this.numGlobalLights=this.numLights,this.numGlobalProjectiveTextures=this.numProjectiveTextures;const n=r.getViewpoint();if(this.logarithmicDepthBuffer||n.getLogarithmicDepthBuffer()){const t=r.getNavigationInfo();e.uniform1f(this.x3d_LogarithmicFarFactor1_2,1/Math.log2(t.getFarValue(n)+1))}}e.uniformMatrix4fv(this.x3d_ModelViewMatrix,!1,h),t[0]=h[0],t[3]=h[1],t[6]=h[2],t[1]=h[4],t[4]=h[5],t[7]=h[6],t[2]=h[8],t[5]=h[9],t[8]=h[10],ee.prototype.inverse.call(t),e.uniformMatrix3fv(this.x3d_NormalMatrix,!1,t),s&&s.setShaderUniforms(e,this),this.numClipPlanes=0,this.numLights=this.numGlobalLights,this.numProjectiveTextures=this.numGlobalProjectiveTextures;for(const t of i.localObjects)t.setShaderUniforms(e,this,r);e.uniform1f(this.x3d_AlphaCutoff,a.getAlphaCutoff()),u&&u.setShaderUniforms(e,this),c.setShaderUniforms(e,this,r,a.getTextureTransformMapping(),n.getTextureCoordinateMapping(),o),l&&l.setShaderUniforms(e,this,r),a.getTextureTransform().setShaderUniforms(e,this),n.getTextureCoordinate().setShaderUniforms(e,this)}}(),enable:function(t){t.useProgram(this.getProgram());for(const e of this.textures){const n=e.texture,i=this.getBrowser().getTextureUnit(n.getTextureType());if(void 0===i)return void console.warn("Not enough combined texture units for uniform variable '"+e.name+"' available.");t.activeTexture(t.TEXTURE0+i),t.bindTexture(n.getTarget(),n.getTexture()),t.uniform1i(e,i)}},enableFloatAttrib:function(t,e,n,i,o,r){const s=t.getAttribLocation(this.getProgram(),e);-1!==s&&(t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,i,t.FLOAT,!1,o,r))},enableMatrix3Attrib:function(t,e,n,i,o){const r=t.getAttribLocation(this.getProgram(),e);if(-1!==r){i=i||36,t.bindBuffer(t.ARRAY_BUFFER,n);for(let e=0;e<3;++e){const n=r+e;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,3,t.FLOAT,!1,i,o+12*e)}}},enableMatrix4Attrib:function(t,e,n,i,o){const r=t.getAttribLocation(this.getProgram(),e);if(-1!==r){i=i||64,t.bindBuffer(t.ARRAY_BUFFER,n);for(let e=0;e<4;++e){const n=r+e;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,!1,i,o+16*e)}}},enableLineStippleAttribute:function(t,e,n,i){const o=this.x3d_LineStipple;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,3,t.FLOAT,!1,n,i)},enableFogDepthAttribute:function(t,e,n,i){const o=this.x3d_FogDepth;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,1,t.FLOAT,!1,n,i)},enableColorAttribute:function(t,e,n,i){const o=this.x3d_Color;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,n,i)},colorAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Color,e)},enableTexCoordAttribute:function(t,e,n,i){for(const[o,r]of this.x3d_TexCoord)t.bindBuffer(t.ARRAY_BUFFER,e[o]),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,n,i)},texCoordAttributeDivisor:function(t,e){for(const[n,i]of this.x3d_TexCoord)t.vertexAttribDivisor(i,e)},enableNormalAttribute:function(t,e,n,i){const o=this.x3d_Normal;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,3,t.FLOAT,!1,n,i)},normalAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Normal,e)},enableVertexAttribute:function(t,e,n,i){const o=this.x3d_Vertex;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,n,i)},vertexAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Vertex,e)},enableParticleAttribute:function(t,e,n,i,o){const r=this.x3d_Particle;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,n,i),t.vertexAttribDivisor(r,o)},enableParticleMatrixAttribute:function(t,e,n,i,o){const r=this.x3d_ParticleMatrix;n=n||64,t.bindBuffer(t.ARRAY_BUFFER,e);for(let e=0;e<4;++e){const s=r+e;t.enableVertexAttribArray(s),t.vertexAttribPointer(s,4,t.FLOAT,!1,n,i+16*e),t.vertexAttribDivisor(s,o)}},getProgramInfo:function(){function t(t,e){return t<e?-1:t>e?1:0}const e=this.getProgram(),n=this.getBrowser().getContext(),i={attributes:[],uniforms:[],attributeCount:0,uniformCount:0},o=n.getProgramParameter(e,n.ACTIVE_UNIFORMS),r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES),s={35664:"vec2",35665:"vec3",35666:"vec4",35667:"ivec2",35668:"ivec3",35669:"ivec4",35670:"bool",35671:"bvec2",35672:"bvec3",35673:"bvec4",35674:"mat2",35675:"mat3",35676:"mat4",35678:"sampler2D",35680:"samplerCube",5120:"byte",5121:"ubyte",5122:"short",5123:"ushort",5124:"int",5125:"uint",5126:"float"};for(let t=0;t<o;++t){const o=n.getActiveUniform(e,t);o.typeName=s[o.type],i.uniforms.push(Object.assign({},o)),i.uniformCount+=o.size}for(let t=0;t<r;++t){const o=n.getActiveAttrib(e,t);o.typeName=s[o.type],i.attributes.push(Object.assign({},o)),i.attributeCount+=o.size}return i.uniforms.sort((function(e,n){return t(e.name,n.name)})),i.attributes.sort((function(e,n){return t(e.name,n.name)})),i},printProgramInfo:function(){const t=this.getProgramInfo();console.log(this.getName()),console.table(t.attributes),console.log(this.getName(),"attributeCount",t.attributeCount),console.log(this.getName()),console.table(t.uniforms),console.log(this.getName(),"uniformCount",t.uniformCount)},dispose:function(){}};const Ch=vh;function Oh(t){_s.call(this,t),this.addType(o.X3DNetworkSensorNode)}Oh.prototype=Object.assign(Object.create(_s.prototype),{constructor:Oh});const Fh=Oh;function Nh(t){Fh.call(this,t),this.addType(o.LoadSensor),this.urlObjects=[],this.aborted=!1,this.timeOutId=void 0}Nh.prototype=Object.assign(Object.create(Fh.prototype),{constructor:Nh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"timeOut",new Bn.SFTime),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"isLoaded",new Bn.SFBool),new z(o.outputOnly,"progress",new Bn.SFFloat),new z(o.outputOnly,"loadTime",new Bn.SFTime),new z(o.inputOutput,"watchList",new Bn.MFNode)]),getTypeName:function(){return"LoadSensor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){Fh.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._timeOut.addInterest("set_timeOut__",this),this._watchList.addInterest("set_watchList__",this),this.set_watchList__()},set_enabled__:function(){this._enabled.getValue()?this.reset():(this.abort(),this.remove())},set_timeOut__:function(){this._isActive.getValue()&&(this.clearTimeout(),this.aborted=!1,this._timeOut.getValue()>0&&(this.timeOutId=setTimeout(this.abort.bind(this),1e3*this._timeOut.getValue())))},set_watchList__:function(){this.reset()},set_loadState__:function(t){switch(t.checkLoadState()){case o.NOT_STARTED_STATE:break;case o.IN_PROGRESS_STATE:case o.COMPLETE_STATE:case o.FAILED_STATE:this.count()}},count:function(){const t=this.urlObjects;let e=0,n=0;for(const i of t)e+=i.checkLoadState()==o.COMPLETE_STATE,n+=i.checkLoadState()==o.FAILED_STATE;const i=e==t.length,r=e/t.length;this.aborted||n||i?(this.clearTimeout(),this._isActive=!1,this._isLoaded=i,this._progress=r,i&&(this._loadTime=this.getBrowser().getCurrentTime())):this._isActive.getValue()?this._progress=r:(this._isActive=!0,this._progress=r,this.set_timeOut__())},abort:function(){this.clearTimeout(),this.aborted=!0,this._enabled.getValue()&&this.count()},reset:function(){if(this.remove(),this._enabled.getValue()){const t=this.urlObjects;for(const e of this._watchList){const n=mr(o.X3DUrlObject,e);n&&(t.push(n),n._loadState.addInterest("set_loadState__",this,n))}this.count()}},remove:function(){this.clearTimeout();const t=this.urlObjects;for(const e of t)e._loadState.removeInterest("set_loadState__",this);t.length=0},clearTimeout:function(){clearTimeout(this.timeOutId),this.timeOutId=void 0}});const Mh=Nh;function Vh(t){Sh.call(this,t),Ch.call(this,t),this.addType(o.ComposedShader),this.loadSensor=new Mh(t),this.transformFeedbackVaryings=[]}Vh.prototype=Object.assign(Object.create(Sh.prototype),Ch.prototype,{constructor:Vh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"activate",new Bn.SFBool),new z(o.outputOnly,"isSelected",new Bn.SFBool),new z(o.outputOnly,"isValid",new Bn.SFBool),new z(o.initializeOnly,"language",new Bn.SFString),new z(o.inputOutput,"parts",new Bn.MFNode)]),wireframe:!1,getTypeName:function(){return"ComposedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},initialize:function(){Sh.prototype.initialize.call(this),Ch.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._activate.addInterest("set_activate__",this),this._parts.addFieldInterest(this.loadSensor._watchList),this.loadSensor._isLoaded.addInterest("connectLoaded",this),this.loadSensor._watchList=this._parts,this.loadSensor.setPrivate(!0),this.loadSensor.setup(),this.loadSensor._isLoaded.getValue()?this.set_loaded__():this.connectLoaded()},connectLoaded:function(){this.loadSensor._isLoaded.removeInterest("connectLoaded",this),this.loadSensor._isLoaded.addInterest("set_loaded__",this)},addUserDefinedField:function(t,e,n){const i=this.isInitialized()&&this.isLive().getValue()&&this.isValid();i&&this.removeShaderFields(),Sh.prototype.addUserDefinedField.call(this,t,e,n),i&&this.addShaderFields()},removeUserDefinedField:function(t){const e=this.isInitialized()&&this.isLive().getValue()&&this.isValid();e&&this.removeShaderFields(),Sh.prototype.removeUserDefinedField.call(this,t),e&&this.addShaderFields()},setTransformFeedbackVaryings:function(t){this.transformFeedbackVaryings=t},getProgram:function(){return this.program},set_live__:function(){this.isLive().getValue()?this.isValid()&&this.addShaderFields():this.isValid()&&this.removeShaderFields()},set_activate__:function(){this._activate.getValue()&&this.set_loaded__()},set_loaded__:function(){if(this.loadSensor._isLoaded.getValue()&&"GLSL"===this._language.getValue()){const t=this.getBrowser().getContext(),e=t.createProgram();this.isValid()&&this.removeShaderFields(),t.deleteProgram(this.program),this.program=e;for(const n of this._parts){const i=mr(o.ShaderPart,n);i&&t.attachShader(e,i.getShader())}this.transformFeedbackVaryings.length&&t.transformFeedbackVaryings(e,this.transformFeedbackVaryings,t.INTERLEAVED_ATTRIBS),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?(this.setValid(!0),this.getDefaultUniformsAndAttributes(),this.addShaderFields()):(this.setValid(!1),this._parts.length&&console.warn("Couldn't initialize "+this.getTypeName()+" '"+this.getName()+"': "+t.getProgramInfoLog(e)))}else this.setValid(!1)},dispose:function(){this.getBrowser().getContext().deleteProgram(this.program),Ch.prototype.dispose.call(this),Sh.prototype.dispose.call(this)}});const Ih=Vh,Dh="\n#if defined (X3D_FOG)\nstruct x3d_FogParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float visibilityRange;\n   mediump mat3  matrix;\n};\n#endif\n\n//uniform x3d_FogParameters x3d_Fog;\n\n#if defined (X3D_LIGHTING)\nstruct x3d_LightSourceParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float intensity;\n   mediump float ambientIntensity;\n   mediump vec3  attenuation;\n   mediump vec3  location;\n   mediump vec3  direction;\n   mediump float radius;\n   mediump float beamWidth;\n   mediump float cutOffAngle;\n   mediump mat3  matrix;\n   #if defined (X3D_SHADOWS)\n   mediump vec3  shadowColor;\n   mediump float shadowIntensity;\n   mediump float shadowBias;\n   mediump mat4  shadowMatrix;\n   mediump int   shadowMapSize;\n   #endif\n};\n#endif\n\n//uniform x3d_LightSourceParameters x3d_LightSource [x3d_MaxLights];\n\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_PointPropertiesParameters\n{\n   mediump float pointSizeScaleFactor;\n   mediump float pointSizeMinValue;\n   mediump float pointSizeMaxValue;\n   mediump vec3  pointSizeAttenuation;\n};\n#endif\n\n//uniform x3d_PointPropertiesParameters x3d_PointProperties;\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_LinePropertiesParameters\n{\n   bool          applied;\n   mediump int   linetype;\n   mediump float lineStippleScale;\n   sampler2D     texture;\n};\n#endif\n\n//uniform x3d_LinePropertiesParameters x3d_LineProperties;\n\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_FillPropertiesParameters\n{\n   bool         filled;\n   bool         hatched;\n   mediump vec3 hatchColor;\n   sampler2D    texture;\n};\n#endif\n\n//uniform x3d_FillPropertiesParameters x3d_FillProperties;\n\n#if defined (X3D_UNLIT_MATERIAL)\nstruct x3d_UnlitMaterialParameters\n{\n   mediump vec3  emissiveColor;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_MATERIAL)\nstruct x3d_MaterialParameters\n{\n   mediump float ambientIntensity;\n   mediump vec3  diffuseColor;\n   mediump vec3  specularColor;\n   mediump vec3  emissiveColor;\n   mediump float shininess;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_PHYSICAL_MATERIAL)\nstruct x3d_PhysicalMaterialParameters\n{\n   mediump vec3  baseColor;\n   mediump vec3  emissiveColor;\n   mediump float metallic;\n   mediump float roughness;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (X3D_AMBIENT_TEXTURE)\nstruct x3d_AmbientTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_AMBIENT_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nstruct x3d_DiffuseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_DIFFUSE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n\n#if defined (X3D_SPECULAR_TEXTURE)\nstruct x3d_SpecularTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SPECULAR_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nstruct x3d_EmissiveTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_EMISSIVE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n\n#if defined (X3D_SHININESS_TEXTURE)\nstruct x3d_ShininessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SHININESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n\n#if defined (X3D_BASE_TEXTURE)\nstruct x3d_BaseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_BASE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_BaseTextureParameters x3d_BaseTexture;\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nstruct x3d_MetallicRoughnessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nstruct x3d_OcclusionTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_OCCLUSION_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n\n#if defined (X3D_NORMAL_TEXTURE)\nstruct x3d_NormalTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_NORMAL_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_NormalTextureParameters x3d_NormalTexture;\n\n#if defined (X3D_MULTI_TEXTURING)\nstruct x3d_MultiTextureParameters\n{\n   mediump int mode;\n   mediump int alphaMode;\n   mediump int source;\n   mediump int function;\n};\n#endif\n\n//uniform x3d_MultiTextureParameters x3d_MultiTexture [x3d_MaxTextures];\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nstruct x3d_TextureCoordinateGeneratorParameters\n{\n   mediump int   mode;\n   mediump float parameter [6];\n};\n#endif\n\n//uniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [x3d_MaxTextures];\n";let Rh=0;const Ph={REPLACE:Rh++,MODULATE:Rh++,MODULATE2X:Rh++,MODULATE4X:Rh++,ADD:Rh++,ADDSIGNED:Rh++,ADDSIGNED2X:Rh++,ADDSMOOTH:Rh++,SUBTRACT:Rh++,BLENDDIFFUSEALPHA:Rh++,BLENDTEXTUREALPHA:Rh++,BLENDFACTORALPHA:Rh++,BLENDCURRENTALPHA:Rh++,MODULATEALPHA_ADDCOLOR:Rh++,MODULATEINVALPHA_ADDCOLOR:Rh++,MODULATEINVCOLOR_ADDALPHA:Rh++,DOTPRODUCT3:Rh++,SELECTARG1:Rh++,SELECTARG2:Rh++,OFF:Rh++};let Ah=0;const Lh={DEFAULT:Ah++,DIFFUSE:Ah++,SPECULAR:Ah++,FACTOR:Ah++};let Bh=0;const Xh={DEFAULT:Bh++,COMPLEMENT:Bh++,ALPHAREPLICATE:Bh++};let Uh=0;const zh={NONE:Uh++,SPHERE:Uh++,CAMERASPACENORMAL:Uh++,CAMERASPACEPOSITION:Uh++,CAMERASPACEREFLECTIONVECTOR:Uh++,SPHERE_LOCAL:Uh++,COORD:Uh++,COORD_EYE:Uh++,NOISE:Uh++,NOISE_EYE:Uh++,SPHERE_REFLECT:Uh++,SPHERE_REFLECT_LOCAL:Uh++},jh={getSource:function(t,e,n,i){const o="\\s+|/\\*[\\s\\S]*?\\*/|//.*?\\n",r="#line\\s+.*?\\n|#if\\s+.*?\\n|#elif\\s+.*?\\n|#ifdef\\s+.*?\\n|#ifndef\\s+.*?\\n|#else.*?\\n|#endif.*?\\n|#define\\s+(?:[^\\n\\\\]|\\\\[^\\r\\n]|\\\\\\r?\\n)*\\n|#undef\\s+.*?\\n|#pragma\\s+.*?\\n",s=new RegExp("^((?:"+o+"|"+r+")*(?:#version\\s+.*?\\n)?(?:"+o+"|"+r+"|#extension\\s+.*?\\n)*)([\\s\\S]*)$"),a=n.match(s);if(!a)return n;let u="";u+="#define X_ITE\n",t.HAS_FEATURE_DEPTH_TEXTURE&&(u+="#define X3D_DEPTH_TEXTURE\n");for(const t of i)u+="#define "+t+"\n";let c="";c+="#define x3d_None 0\n",c+="#define x3d_Points      0\n",c+="#define x3d_Lines       1\n",c+="#define x3d_Geometry2D  2\n",c+="#define x3d_Geometry3D  3\n",c+="#define x3d_MaxClipPlanes  "+e.getMaxClipPlanes()+"\n",c+="#define x3d_LinearFog        1\n",c+="#define x3d_ExponentialFog   2\n",c+="#define x3d_Exponential2Fog  3\n",c+="#define x3d_MaxLights         "+e.getMaxLights()+"\n",c+="#define x3d_DirectionalLight  1\n",c+="#define x3d_PointLight        2\n",c+="#define x3d_SpotLight         3\n",c+="#define x3d_MaxTextures      "+e.getMaxTextures()+"\n",c+="#define x3d_TextureType2D    2\n",c+="#define x3d_TextureType3D    3\n",c+="#define x3d_TextureTypeCube  4\n",c+="#define x3d_Replace                   "+Ph.REPLACE+"\n",c+="#define x3d_Modulate                  "+Ph.MODULATE+"\n",c+="#define x3d_Modulate2X                "+Ph.MODULATE2X+"\n",c+="#define x3d_Modulate4X                "+Ph.MODULATE4X+"\n",c+="#define x3d_Add                       "+Ph.ADD+"\n",c+="#define x3d_AddSigned                 "+Ph.ADDSIGNED+"\n",c+="#define x3d_AddSigned2X               "+Ph.ADDSIGNED2X+"\n",c+="#define x3d_AddSmooth                 "+Ph.ADDSMOOTH+"\n",c+="#define x3d_Subtract                  "+Ph.SUBTRACT+"\n",c+="#define x3d_BlendDiffuseAlpha         "+Ph.BLENDDIFFUSEALPHA+"\n",c+="#define x3d_BlendTextureAlpha         "+Ph.BLENDTEXTUREALPHA+"\n",c+="#define x3d_BlendFactorAlpha          "+Ph.BLENDFACTORALPHA+"\n",c+="#define x3d_BlendCurrentAlpha         "+Ph.BLENDCURRENTALPHA+"\n",c+="#define x3d_ModulateAlphaAddColor     "+Ph.MODULATEALPHA_ADDCOLOR+"\n",c+="#define x3d_ModulateInvAlphaAddColor  "+Ph.MODULATEINVALPHA_ADDCOLOR+"\n",c+="#define x3d_ModulateInvColorAddAlpha  "+Ph.MODULATEINVCOLOR_ADDALPHA+"\n",c+="#define x3d_DotProduct3               "+Ph.DOTPRODUCT3+"\n",c+="#define x3d_SelectArg1                "+Ph.SELECTARG1+"\n",c+="#define x3d_SelectArg2                "+Ph.SELECTARG2+"\n",c+="#define x3d_Off                       "+Ph.OFF+"\n",c+="#define x3d_Diffuse  "+Lh.DIFFUSE+"\n",c+="#define x3d_Specular "+Lh.SPECULAR+"\n",c+="#define x3d_Factor   "+Lh.FACTOR+"\n",c+="#define x3d_Complement     "+Xh.COMPLEMENT+"\n",c+="#define x3d_AlphaReplicate "+Xh.ALPHAREPLICATE+"\n",c+="#define x3d_Sphere                      "+zh.SPHERE+"\n",c+="#define x3d_CameraSpaceNormal           "+zh.CAMERASPACENORMAL+"\n",c+="#define x3d_CameraSpacePosition         "+zh.CAMERASPACEPOSITION+"\n",c+="#define x3d_CameraSpaceReflectionVector "+zh.CAMERASPACEREFLECTIONVECTOR+"\n",c+="#define x3d_SphereLocal                 "+zh.SPHERE_LOCAL+"\n",c+="#define x3d_Coord                       "+zh.COORD+"\n",c+="#define x3d_CoordEye                    "+zh.COORD_EYE+"\n",c+="#define x3d_Noise                       "+zh.NOISE+"\n",c+="#define x3d_NoiseEye                    "+zh.NOISE_EYE+"\n",c+="#define x3d_SphereReflect               "+zh.SPHERE_REFLECT+"\n",c+="#define x3d_SphereReflectLocal          "+zh.SPHERE_REFLECT_LOCAL+"\n",c+="#define x3d_GeometryPoints  0\n",c+="#define x3d_GeometryLines   1\n",c+="#define x3d_NoneClipPlane   vec4 (88.0, 51.0, 68.0, 33.0)\n",c+="#define x3d_NoneFog         0\n",c+="#define x3d_NoneLight       0\n",c+="#define x3d_NoneTexture     0\n";const l=n.match(/\s*precision\s+(lowp|mediump|highp)\s+float\s*;/),h=n.match(/\s*precision\s+(lowp|mediump|highp)\s+int\s*;/),d=l?l[1]:"mediump",f=h?h[1]:"mediump",p=Dh.replace(/mediump\s+(float|vec2|vec3|mat3|mat4)/g,d+" $1").replace(/mediump\s+(int)/g,f+" $1"),g=(a[1].match(/\n/g)||[]).length+1;return a[1]+u+c+p+"#line "+(g+1)+" -1\n"+a[2]}};const kh=jh,Gh=/^\s*#pragma\s+X3D\s+include\s+".*?([^\/]+)\.glsl"\s*$/;function Hh(t){this.includes=wh.includes[t.getVersion()],this.sourceFileNumbers={};for(const[t,e]of Object.getOwnPropertyNames(this.includes).entries())this.sourceFileNumbers[e]=t+1}Hh.prototype={getSourceFileName:function(t){return Object.getOwnPropertyNames(this.includes)[t-1]},process:function(t,e=0){const n=t.split("\n");t="";for(let i=0,o=n.length;i<o;++i){const o=n[i],r=o.match(Gh);r?(t+="#line 1 "+this.sourceFileNumbers[r[1]]+"\n",t+=this.process(this.includes[r[1]],this.sourceFileNumbers[r[1]]),t+="\n",t+="#line "+(i+2)+" "+e+"\n"):(t+=o,t+="\n")}return t}};const qh=Hh,Yh=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D","X3D_FOG","X3D_STYLE_PROPERTIES","X3D_UNLIT_MATERIAL","X3D_MATERIAL","X3D_LIGHTING","X3D_TEXTURE","X3D_MULTI_TEXTURING"];function Wh(t){ji.call(this,t),xo.call(this,t),this.addType(o.ShaderPart),this.options=[]}Wh.prototype=Object.assign(Object.create(ji.prototype),xo.prototype,{constructor:Wh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"type",new Bn.SFString("VERTEX")),new z(o.inputOutput,"load",new Bn.SFBool(!0)),new z(o.inputOutput,"url",new Bn.MFString),new z(o.inputOutput,"autoRefresh",new Bn.SFTime),new z(o.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600))]),getTypeName:function(){return"ShaderPart"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"parts"},initialize:function(){ji.prototype.initialize.call(this),xo.prototype.initialize.call(this),this.isPrivate()||(this.options=Yh.slice()),this._type.addInterest("set_type__",this),this.requestImmediateLoad()},set_type__:function(){this.setLoadState(o.NOT_STARTED_STATE),this.requestImmediateLoad()},getSourceText:function(){return this._url},getOptions:function(){return this.options},setOptions:function(t){this.options=t},getShader:function(){return this.shader},getShaderType:function(){const t=new Map([["VERTEX","VERTEX_SHADER"],["TESS_CONTROL","TESS_CONTROL_SHADER"],["TESS_EVALUATION","TESS_EVALUATION_SHADER"],["GEOMETRY","GEOMETRY_SHADER"],["FRAGMENT","FRAGMENT_SHADER"],["COMPUTE","COMPUTE_SHADER"]]);return function(){return t.get(this._type.getValue())||"VERTEX_SHADER"}}(),unLoadNow:function(){this.valid=!1},loadNow:function(){new Qs(this).loadDocument(this._url,function(t,e){if(null===t)this.setLoadState(o.FAILED_STATE);else{const n=this.getBrowser(),i=n.getContext(),r=this.getShaderType(),s=["X3D_"+r].concat(this.options),a=new qh(i),u=kh.getSource(i,n,a.process(t),s),c=i.createShader(i[r]);if(i.deleteShader(this.shader),this.shader=c,i.shaderSource(c,u),i.compileShader(c),!i.getShaderParameter(c,i.COMPILE_STATUS)){const t=this.getTypeName(),n=this.getName(),o=i.getShaderInfoLog(c),r=o.match(/(\d+):(\d+)/);if(r){const i=a.getSourceFileName(r[1])||e||this.getExecutionContext().getWorldURL();throw new Error("Error in "+t+" '"+n+"' in URL '"+i+"', line "+r[2]+", "+o)}{const i=e||this.getExecutionContext().getWorldURL();throw new Error("Error in "+t+" '"+n+"' in URL '"+i+"', "+o)}}this.setLoadState(o.COMPLETE_STATE)}}.bind(this))},dispose:function(){this.getBrowser().getContext().deleteShader(this.shader),ji.prototype.dispose.call(this)}});const $h=Wh,Kh=Symbol(),Qh=Symbol(),Zh=(Symbol(),Symbol());function Jh(){this[Kh]=!1,this[Qh]=new Map,this[Zh]=new Map}Jh.prototype={initialize:function(){this.setShading(this.getBrowserOptions().getShading())},getShadingLanguageVersion:function(){const t=this.getContext();return t.getParameter(t.SHADING_LANGUAGE_VERSION)},getMaxVertexUniformVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)},getMaxFragmentUniformVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS)},getMaxVertexAttribs:function(){const t=this.getContext();return t.getParameter(t.MAX_VERTEX_ATTRIBS)},getMaxVaryingVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_VARYING_VECTORS)},getWireframe:function(){return this[Kh]},getPrimitiveMode:function(t){return this[Qh].get(t)},getShaders:function(){return this[Zh]},setShading:function(t){const e=this.getContext();switch(t){case di.POINT:this[Kh]=!1,this[Qh].set(e.POINTS,e.POINTS),this[Qh].set(e.LINES,e.POINTS),this[Qh].set(e.TRIANGLES,e.POINTS);break;case di.WIREFRAME:this[Kh]=!0,this[Qh].set(e.POINTS,e.POINTS),this[Qh].set(e.LINES,e.LINES),this[Qh].set(e.TRIANGLES,e.LINE_LOOP);break;default:this[Kh]=!1,this[Qh].set(e.POINTS,e.POINTS),this[Qh].set(e.LINES,e.LINES),this[Qh].set(e.TRIANGLES,e.TRIANGLES)}},createShader:function(t,e,n=e,i=[],o=[],r=[]){this.getDebug()&&console.info("Initializing "+t);const s=this.getContext().getVersion(),a=new $h(this.getPrivateScene());a._url.push(e.startsWith("data:")?e:"data:x-shader/x-vertex,"+wh.vertex[s][e]),a.setPrivate(!0),a.setName(t+"Vertex"),a.setOptions(i),a.setup();const u=new $h(this.getPrivateScene());u._type="FRAGMENT",u._url.push(n.startsWith("data:")?n:"data:x-shader/x-fragment,"+wh.fragment[s][n]),u.setPrivate(!0),u.setName(t+"Fragment"),u.setOptions(i),u.setup();const c=new Ih(this.getPrivateScene());return c._language="GLSL",c._parts.push(a),c._parts.push(u),c.setPrivate(!0),c.setName(t),c.setUniformNames(o),c.setTransformFeedbackVaryings(r),c.setup(),c}};const td=Jh;function ed(t){ji.call(this,t),this.addType(o.X3DAppearanceNode),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(o.outputOnly)}ed.prototype=Object.assign(Object.create(ji.prototype),{constructor:ed,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()}});const nd=ed;function id(t){nd.call(this,t),this.addType(o.Appearance),this.stylePropertiesNode=[],this.textureTransformMapping=new Map,this.textureBits=new Kr,this.shaderNodes=[]}id.prototype=Object.assign(Object.create(nd.prototype),{constructor:id,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"alphaMode",new Bn.SFString("AUTO")),new z(o.inputOutput,"alphaCutoff",new Bn.SFFloat(.5)),new z(o.inputOutput,"acousticProperties",new Bn.SFNode),new z(o.inputOutput,"pointProperties",new Bn.SFNode),new z(o.inputOutput,"lineProperties",new Bn.SFNode),new z(o.inputOutput,"fillProperties",new Bn.SFNode),new z(o.inputOutput,"material",new Bn.SFNode),new z(o.inputOutput,"backMaterial",new Bn.SFNode),new z(o.inputOutput,"texture",new Bn.SFNode),new z(o.inputOutput,"textureTransform",new Bn.SFNode),new z(o.inputOutput,"shaders",new Bn.MFNode),new z(o.inputOutput,"blendMode",new Bn.SFNode)]),getTypeName:function(){return"Appearance"},getComponentName:function(){return"Shape"},getContainerField:function(){return"appearance"},initialize:function(){nd.prototype.initialize.call(this),this._alphaMode.addInterest("set_alphaMode__",this),this._alphaCutoff.addInterest("set_alphaCutoff__",this),this._pointProperties.addInterest("set_pointProperties__",this),this._lineProperties.addInterest("set_lineProperties__",this),this._fillProperties.addInterest("set_fillProperties__",this),this._material.addInterest("set_material__",this),this._backMaterial.addInterest("set_backMaterial__",this),this._texture.addInterest("set_texture__",this),this._textureTransform.addInterest("set_textureTransform__",this),this._shaders.addInterest("set_shaders__",this),this._blendMode.addInterest("set_blendMode__",this),this._alphaMode.addInterest("set_transparent__",this),this._fillProperties.addInterest("set_transparent__",this),this._material.addInterest("set_transparent__",this),this._texture.addInterest("set_transparent__",this),this._blendMode.addInterest("set_transparent__",this),this.set_alphaMode__(),this.set_pointProperties__(),this.set_lineProperties__(),this.set_fillProperties__(),this.set_material__(),this.set_backMaterial__(),this.set_texture__(),this.set_textureTransform__(),this.set_shaders__(),this.set_blendMode__(),this.set_transparent__()},getAlphaMode:function(){return this.alphaMode},getAlphaCutoff:function(){return this.alphaCutoff},getStyleProperties:function(t){return this.stylePropertiesNode[t]},getPointProperties:function(){return this.stylePropertiesNode[0]},getLineProperties:function(){return this.stylePropertiesNode[1]},getFillProperties:function(){return this.stylePropertiesNode[2]},getMaterial:function(){return this.materialNode},getBackMaterial:function(){return this.backMaterialNode},getTexture:function(){return this.textureNode},getTextureBits:function(){return this.textureBits},updateTextureBits:function(){this.textureBits.clear(),this.textureNode.updateTextureBits(this.textureBits)},getTextureTransform:function(){return this.textureTransformNode},getTextureTransformMapping:function(){return this.textureTransformMapping},getShader:function(t,e){return this.materialNode.getShader(t,e)},getBackShader:function(t,e){return this.backMaterialNode.getShader(t,e)},getBlendMode:function(){return this.blendModeNode},set_alphaMode__:function(){this.alphaMode=this.getEnum(nc,this._alphaMode.getValue(),nc.AUTO),this.set_alphaCutoff__()},set_alphaCutoff__:function(){this.alphaCutoff=this.alphaMode===nc.MASK?this._alphaCutoff.getValue():0},set_pointProperties__:function(){this.stylePropertiesNode[0]=mr(o.PointProperties,this._pointProperties)},set_lineProperties__:function(){this.linePropertiesNode&&this.linePropertiesNode._applied.removeInterest("set_applied__",this),this.linePropertiesNode=mr(o.LineProperties,this._lineProperties),this.linePropertiesNode&&this.linePropertiesNode._applied.addInterest("set_applied__",this),this.set_applied__()},set_applied__:function(){this.linePropertiesNode&&this.linePropertiesNode._applied.getValue()?this.stylePropertiesNode[1]=this.linePropertiesNode:this.stylePropertiesNode[1]=null},set_fillProperties__:function(){this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.removeInterest("set_transparent__",this),this.stylePropertiesNode[2]=mr(o.FillProperties,this._fillProperties),this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.addInterest("set_transparent__",this),this.stylePropertiesNode[3]=this.stylePropertiesNode[2]},set_material__:function(){this.materialNode&&this.materialNode._transparent.removeInterest("set_transparent__",this),this.materialNode=mr(o.X3DMaterialNode,this._material),this.materialNode||(this.materialNode=this.getBrowser().getDefaultMaterial()),this.materialNode&&this.materialNode._transparent.addInterest("set_transparent__",this),"TwoSidedMaterial"===this.materialNode.getTypeName()&&this.set_backMaterial__()},set_backMaterial__:function(){this.backMaterialNode&&this.backMaterialNode._transparent.removeInterest("set_transparent__",this),this.backMaterialNode=mr(o.X3DOneSidedMaterialNode,this._backMaterial),this.backMaterialNode&&this.backMaterialNode._transparent.addInterest("set_transparent__",this),this.backMaterialNode||"TwoSidedMaterial"!==this.materialNode.getTypeName()||(this.backMaterialNode=this.materialNode)},set_texture__:function(){this.textureNode&&(this.textureNode.removeInterest("updateTextureBits",this),this.textureNode._transparent.removeInterest("set_transparent__",this)),this.textureNode=mr(o.X3DTextureNode,this._texture),this.textureNode?(this.textureNode.addInterest("updateTextureBits",this),this.textureNode._transparent.addInterest("set_transparent__",this),this.updateTextureBits()):this.textureBits.clear()},set_textureTransform__:function(){this.textureTransformNode&&this.textureTransformNode.removeInterest("updateTextureTransformMapping",this),this.textureTransformNode=mr(o.X3DTextureTransformNode,this._textureTransform),this.textureTransformNode||(this.textureTransformNode=this.getBrowser().getDefaultTextureTransform()),this.textureTransformNode.addInterest("updateTextureTransformMapping",this),this.updateTextureTransformMapping()},updateTextureTransformMapping:function(){this.textureTransformMapping.clear(),this.textureTransformNode.getTextureTransformMapping(this.textureTransformMapping)},set_shaders__:function(){const t=this.shaderNodes;for(const e of t)e._isValid.removeInterest("set_shader__",this);t.length=0;for(const e of this._shaders){const n=mr(o.X3DShaderNode,e);n&&t.push(n)}for(const e of t)e._isValid.addInterest("set_shader__",this);this.set_shader__()},set_shader__:function(){function t(){return this.shaderNode}return function(){const e=this.shaderNodes;this.shaderNode&&this.shaderNode.deselect(),this.shaderNode=null;for(const t of e)if(t._isValid.getValue()){this.shaderNode=t;break}this.shaderNode?(this.shaderNode.select(),this.getShader=t,this.getBackShader=t):(delete this.getShader,delete this.getBackShader)}}(),set_blendMode__:function(){this.blendModeNode=mr(o.BlendMode,this._blendMode)},set_transparent__:function(){switch(this.alphaMode){case nc.AUTO:this.setTransparent(Boolean(this.stylePropertiesNode[3]&&this.stylePropertiesNode[3].getTransparent()||this.materialNode&&this.materialNode.getTransparent()||this.backMaterialNode&&this.backMaterialNode.getTransparent()||this.textureNode&&this.textureNode.getTransparent()||this.blendModeNode));break;case nc.OPAQUE:case nc.MASK:this.setTransparent(!1);break;case nc.BLEND:this.setTransparent(!0)}},traverse:function(t,e){this.textureNode&&this.textureNode.traverse(t,e)}});const od=id;function rd(t){es.call(this,t),this.addType(o.X3DMaterialNode),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(o.outputOnly),this.textureBits=new Kr,this.shaderNodes=this.getBrowser().getShaders()}rd.prototype=Object.assign(Object.create(es.prototype),{constructor:rd,initialize:function(){es.prototype.initialize.call(this),this.getBrowser().getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__:function(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()},setTexture:function(t,e){const n=e?e.getTextureType()-1:0;this.textureBits.set(2*t+0,1&n),this.textureBits.set(2*t+1,2&n)},getTextureBits:function(){return this.textureBits},getShader:function(t,e){let n="";if(n+=this.textureBits.toString(4),n+=".",n+=t.geometryKey,e){const{renderObject:i,shadows:o,fogNode:r,shapeNode:s,appearanceNode:a,textureNode:u,objectsCount:c}=e;n+=this.logarithmicDepthBuffer||i.getViewpoint().getLogarithmicDepthBuffer()?"1":"0",n+=o?"1":"0",n+=r?r.getFogKey():"0",n+=s.getShapeKey(),n+=a.getStyleProperties(t.geometryType)?"1":"0",n+=".",n+=c[0],n+=".",n+=c[1],n+=".",n+=c[2],n+=".",n+=u?"1":a.getTextureBits().toString(4),n+=".",n+=a.getTextureTransformMapping().size||"1",n+=t.textureCoordinateMapping.size||"1",n+=this.getMaterialKey(o)}else{const{textureNode:e,objectsCount:i}=t;n+=this.logarithmicDepthBuffer?"1":"0",n+="0000.",n+=i[0],n+=".",n+=i[1],n+=".",n+=i[2],n+=".",n+=e?"1":"0",n+=".11",n+=this.getMaterialKey(!1)}return this.shaderNodes.get(n)||this.createShader(n,t,e)},getShaderOptions:function(){const t=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D"];return function(e,n){const i=this.getBrowser(),r=[];if(r.push(t[e.geometryType]),e.hasFogCoords&&r.push("X3D_FOG_COORDS"),e.colorMaterial&&r.push("X3D_COLOR_MATERIAL"),e.hasNormals&&r.push("X3D_NORMALS"),n){const{renderObject:t,appearanceNode:s,objectsCount:a}=n;if((this.logarithmicDepthBuffer||t.getViewpoint().getLogarithmicDepthBuffer())&&r.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),n.shadows&&r.push("X3D_SHADOWS","X3D_PCF_FILTERING"),n.fogNode)switch(r.push("X3D_FOG"),n.fogNode.getFogKey()){case"1":r.push("X3D_FOG_LINEAR");break;case"2":r.push("X3D_FOG_EXPONENTIAL")}if(a[0]&&(r.push("X3D_CLIP_PLANES"),r.push("X3D_NUM_CLIP_PLANES "+Math.min(a[0],i.getMaxClipPlanes()))),a[1]&&(r.push("X3D_LIGHTING"),r.push("X3D_NUM_LIGHTS "+Math.min(a[1],i.getMaxLights()))),a[2]&&(r.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),r.push("X3D_NUM_TEXTURE_PROJECTORS "+Math.min(a[2],i.getMaxTextures()))),s.getStyleProperties(e.geometryType)&&r.push("X3D_STYLE_PROPERTIES"),+this.textureBits)r.push("X3D_MATERIAL_TEXTURES"),r.push("X3D_NUM_TEXTURE_TRANSFORMS "+(s.getTextureTransformMapping().size||"1")),r.push("X3D_NUM_TEXTURE_COORDINATES "+(e.getTextureCoordinateMapping().size||"1"));else if(n.textureNode)r.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D");else if(+s.getTextureBits()){const t=s.getTexture();r.push("X3D_TEXTURE"),r.push("X3D_NUM_TEXTURES "+t.getCount()),r.push("X3D_NUM_TEXTURE_TRANSFORMS "+t.getCount()),r.push("X3D_NUM_TEXTURE_COORDINATES "+t.getCount()),t.getShaderOptions(r),t.getType().includes(o.MultiTexture)&&r.push("X3D_MULTI_TEXTURING")}switch(n.shapeNode.getShapeKey()){case"1":r.push("X3D_PARTICLE_SYSTEM");break;case"2":r.push("X3D_PARTICLE_SYSTEM","X3D_TEX_COORD_RAMP")}}else{const{textureNode:t,objectsCount:n}=e;this.logarithmicDepthBuffer&&r.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),n[0]&&(r.push("X3D_CLIP_PLANES"),r.push("X3D_NUM_CLIP_PLANES "+Math.min(n[0],i.getMaxClipPlanes()))),n[1]&&(r.push("X3D_LIGHTING"),r.push("X3D_NUM_LIGHTS "+Math.min(n[1],i.getMaxLights()))),n[2]&&(r.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),r.push("X3D_NUM_TEXTURE_PROJECTORS "+Math.min(n[2],i.getMaxTextures()))),t&&r.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D")}return r}}()});const sd=rd;function ad(t){sd.call(this,t),this.addType(o.X3DOneSidedMaterialNode),this.addChildObjects("textures",new Bn.SFTime),this.emissiveColor=new Float32Array(3)}ad.prototype=Object.assign(Object.create(sd.prototype),{constructor:ad,initialize:function(){sd.prototype.initialize.call(this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._emissiveTexture.addInterest("set_emissiveTexture__",this),this._normalTexture.addInterest("set_normalTexture__",this),this._transparency.addInterest("set_transparency__",this),this._transparency.addInterest("set_transparent__",this),this.set_emissiveColor__(),this.set_emissiveTexture__(),this.set_normalTexture__(),this.set_transparency__()},set_emissiveColor__:function(){const t=this.emissiveColor,e=this._emissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_emissiveTexture__:function(){this.emissiveTextureNode=mr(o.X3DSingleTextureNode,this._emissiveTexture),this.setTexture(this.getTextureIndices().EMISSIVE_TEXTURE,this.emissiveTextureNode)},set_normalTexture__:function(){this.normalTextureNode=mr(o.X3DSingleTextureNode,this._normalTexture),this.setTexture(this.getTextureIndices().NORMAL_TEXTURE,this.normalTextureNode)},set_transparency__:function(){this.transparency=et.clamp(this._transparency.getValue(),0,1)},set_transparent__:function(){this.setTransparent(Boolean(this.transparency))},getEmissiveTexture:function(){return this.emissiveTextureNode},getNormalTexture:function(){return this.normalTextureNode},getTransparency:function(){return this.transparency},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++};return function(){return e}}(),getShaderOptions:function(t,e){const n=sd.prototype.getShaderOptions.call(this,t,e);return+this.getTextureBits()&&(this.getEmissiveTexture()&&n.push("X3D_EMISSIVE_TEXTURE","X3D_EMISSIVE_TEXTURE","X3D_EMISSIVE_TEXTURE_"+this.getEmissiveTexture().getTextureTypeString()),this.getNormalTexture()&&n.push("X3D_NORMAL_TEXTURE","X3D_NORMAL_TEXTURE_"+this.getNormalTexture().getTextureTypeString())),n},setShaderUniforms:function(t,e,n,i,o){if(t.uniform3fv(e.x3d_EmissiveColor,this.emissiveColor),t.uniform1f(e.x3d_Transparency,this.transparency),+this.getTextureBits()){if(this.emissiveTextureNode){const r=e.x3d_EmissiveTexture;this.emissiveTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._emissiveTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._emissiveTextureMapping.getValue())||0)}if(this.normalTextureNode){const r=e.x3d_NormalTexture;this.normalTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._normalTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._normalTextureMapping.getValue())||0),t.uniform1f(e.x3d_NormalScale,this._normalScale.getValue())}}}});const ud=ad;function cd(t){ud.call(this,t),this.addType(o.UnlitMaterial)}cd.prototype=Object.assign(Object.create(ud.prototype),{constructor:cd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"emissiveColor",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"emissiveTexture",new Bn.SFNode),new z(o.inputOutput,"emissiveTextureMapping",new Bn.SFString),new z(o.inputOutput,"normalScale",new Bn.SFFloat(1)),new z(o.inputOutput,"normalTexture",new Bn.SFNode),new z(o.inputOutput,"normalTextureMapping",new Bn.SFString),new z(o.inputOutput,"transparency",new Bn.SFFloat)]),getTypeName:function(){return"UnlitMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){ud.prototype.initialize.call(this),this.set_transparent__()},set_emissiveTexture__:function(){this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.removeInterest("set_transparent__",this),ud.prototype.set_emissiveTexture__.call(this),this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.addInterest("set_transparent__",this)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.getEmissiveTexture()&&this.getEmissiveTexture().getTransparent()))},getMaterialKey:function(){return"0"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);o.push("X3D_UNLIT_MATERIAL");const r=i.createShader("UnlitShader","Default","Unlit",o);return i.getShaders().set(t,r),r}});const ld=cd,hd=Symbol(),dd=Symbol(),fd=Symbol(),pd=Symbol(),gd=Symbol(),md=Symbol(),_d=Symbol(),xd=Symbol();function yd(){this[fd]=[],this[hd]=1/(32*this.getPixelPerPoint())}yd.prototype={initialize:function(){},getDefaultAppearance:function(){return this[pd]=new od(this.getPrivateScene()),this[pd].setPrivate(!0),this[pd].setup(),this.getDefaultAppearance=function(){return this[pd]},Object.defineProperty(this,"getDefaultAppearance",{enumerable:!1}),this[pd]},getLineStippleScale:function(){return this[hd]},getDefaultMaterial:function(){return this[gd]=new ld(this.getPrivateScene()),this[gd].setPrivate(!0),this[gd].setup(),this.getDefaultMaterial=function(){return this[gd]},Object.defineProperty(this,"getDefaultMaterial",{enumerable:!1}),this[gd]},getLinetypeTexture:function(){return this[dd]=new ls(this.getPrivateScene()),this[dd]._url[0]=Vl.getLinetypeUrl(),this[dd]._textureProperties=this.getLineFillTextureProperties(),this[dd].setPrivate(!0),this[dd].setup(),this.getLinetypeTexture=function(){return this[dd]},Object.defineProperty(this,"getLinetypeTexture",{enumerable:!1}),this[dd]},getHatchStyleTexture:function(t){let e=this[fd][t];return e||(e=this[fd][t]=new ls(this.getPrivateScene()),e._url[0]=Vl.getHatchingUrl(t),e._textureProperties=this.getLineFillTextureProperties(),e.setPrivate(!0),e.setup(),e)},getLineFillTextureProperties:function(){return this[md]=new vu(this.getPrivateScene()),this[md]._minificationFilter="NEAREST_PIXEL",this[md]._magnificationFilter="NEAREST_PIXEL",this[md].setPrivate(!0),this[md].setup(),this.getLineFillTextureProperties=function(){return this[md]},Object.defineProperty(this,"getLineFillTextureProperties",{enumerable:!1}),this[md]},getLineTransformShader:function(){return this[_d]=this.createShader("LineTransformShader","LineTransform","LineTransform",[],["viewport","modelViewProjectionMatrix","invModelViewProjectionMatrix","scale"],["lineStipple0","fogDepth0","color0","vertex0","lineStipple1","fogDepth1","color1","vertex1","lineStipple2","fogDepth2","color2","vertex2"]),this.getLineTransformShader=function(){return this[_d]},Object.defineProperty(this,"getLineTransformShader",{enumerable:!1}),this[_d]},getLineTransformFeedback:function(){const t=this.getContext();return this[xd]=t.createTransformFeedback(),this.getLineTransformFeedback=function(){return this[xd]},Object.defineProperty(this,"getLineTransformFeedback",{enumerable:!1}),this[xd]}};const wd=yd;function Td(){this.addChildObjects("volume",new Bn.SFFloat(1),"mute",new Bn.SFBool)}Td.prototype={initialize:function(){}};const Sd=Td;let bd=0;const vd={BEGIN:++bd,FIRST:++bd,MIDDLE:++bd,END:++bd},Ed={SERIF:{PLAIN:Vl.getFontsUrl("DroidSerif-Regular.ttf"),ITALIC:Vl.getFontsUrl("DroidSerif-Italic.ttf"),BOLD:Vl.getFontsUrl("DroidSerif-Bold.ttf"),BOLDITALIC:Vl.getFontsUrl("DroidSerif-BoldItalic.ttf")},SANS:{PLAIN:Vl.getFontsUrl("Ubuntu-R.ttf"),ITALIC:Vl.getFontsUrl("Ubuntu-RI.ttf"),BOLD:Vl.getFontsUrl("Ubuntu-B.ttf"),BOLDITALIC:Vl.getFontsUrl("Ubuntu-BI.ttf")},TYPEWRITER:{PLAIN:Vl.getFontsUrl("UbuntuMono-R.ttf"),ITALIC:Vl.getFontsUrl("UbuntuMono-RI.ttf"),BOLD:Vl.getFontsUrl("UbuntuMono-B.ttf"),BOLDITALIC:Vl.getFontsUrl("UbuntuMono-BI.ttf")}};function Cd(t){ji.call(this,t),xo.call(this,t),this.addType(o.X3DFontStyleNode),this.addChildObjects("load",new Bn.SFBool(!0),"autoRefresh",new Bn.SFTime,"autoRefreshTimeLimit",new Bn.SFTime(3600)),this.addAlias("url",this._family),this.familyStack=[],this.alignments=[],this.loader=new Qs(this)}Cd.prototype=Object.assign(Object.create(ji.prototype),xo.prototype,{constructor:Cd,initialize:function(){ji.prototype.initialize.call(this),xo.prototype.initialize.call(this),this._style.addInterest("set_style__",this),this._justify.addInterest("set_justify__",this),this.font=null,this.familyIndex=0,this.set_justify__(),this.set_style__(),this.requestImmediateLoad()},set_style__:function(){this._load.getValue()&&(this.setLoadState(o.NOT_STARTED_STATE),this.requestImmediateLoad())},set_justify__:function(){const t=this._horizontal.getValue()?this._leftToRight.getValue():this._topToBottom.getValue();this.alignments[0]=this._justify.length>0?this.getAlignment(0,t):t?vd.BEGIN:vd.END;const e=this._horizontal.getValue()?this._topToBottom.getValue():this._leftToRight.getValue();this.alignments[1]=this._justify.length>1?this.getAlignment(1,e):e?vd.FIRST:vd.END},getMajorAlignment:function(){return this.alignments[0]},getMinorAlignment:function(){return this.alignments[1]},getAlignment:function(t,e){if(e)switch(this._justify[t]){case"FIRST":return vd.FIRST;case"BEGIN":return vd.BEGIN;case"MIDDLE":return vd.MIDDLE;case"END":return vd.END}else switch(this._justify[t]){case"FIRST":case"BEGIN":return vd.END;case"MIDDLE":return vd.MIDDLE;case"END":return vd.BEGIN}return t?vd.FIRST:vd.BEGIN},getDefaultFont:function(t){const e=Ed[t];if(e)return e[this._style.getValue()]||e.PLAIN},loadNow:function(){const t=this._url.copy();t.push("SERIF"),this.familyStack.length=0;for(const e of t)this.familyStack.push(this.getDefaultFont(e)||e);this.loadNext()},loadNext:function(){try{if(0===this.familyStack.length)return this.setLoadState(o.FAILED_STATE),void(this.font=null);this.family=this.familyStack.shift(),this.URL=new URL(this.family,this.loader.getReferer()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.getBrowser().getFont(this.URL).done(this.setFont.bind(this)).fail(this.setError.bind(this))}catch(t){this.setError(t.message)}},setError:function(t){"data:"!==this.URL.protocol&&console.warn("Error loading font '"+decodeURI(this.URL.href)+"':",t),this.loadNext()},setFont:function(t){this.font=t,this.setLoadState(o.COMPLETE_STATE),this.addNodeEvent()},getFont:function(){return this.font}});const Od=Cd;function Fd(t,e){switch(arguments.length){case 0:return void(this.matrix=new ee(0,0,0,0,0,0,0,0,0));case 2:return void(this.matrix=new ee(t.x/2,0,0,0,t.y/2,0,e.x,e.y,1));case 3:{const t=arguments[0],e=arguments[1],n=(e.x-t.x)/2,i=(e.y-t.y)/2,o=(e.x+t.x)/2,r=(e.y+t.y)/2;return void(this.matrix=new ee(n,0,0,0,i,0,o,r,1))}}}Fd.prototype={constructor:Fd,copy:function(){const t=Object.create(Fd.prototype);return t.matrix=this.matrix.copy(),t},assign:function(t){return this.matrix.assign(t.matrix),this},equals:function(t){return this.matrix.equals(t.matrix)},set:function(t,e){const n=this.matrix;switch(arguments.length){case 0:return n[0]=.5,n[1]=0,n[2]=0,n[3]=0,n[4]=.5,n[5]=0,n[6]=0,n[7]=0,n[8]=0,this;case 2:return n[0]=t.x/2,n[1]=0,n[2]=0,n[3]=0,n[4]=t.y/2,n[5]=0,n[6]=e.x,n[7]=e.y,n[8]=1,this;case 3:{const t=arguments[0],e=arguments[1],n=(e.x-t.x)/2,i=(e.y-t.y)/2,o=(e.x+t.x)/2,r=(e.y+t.y)/2;return this.matrix.set(n,0,0,0,i,0,o,r,1),this}}},setExtents:function(t,e){const n=this.matrix,i=(e.x-t.x)/2,o=(e.y-t.y)/2,r=(e.x+t.x)/2,s=(e.y+t.y)/2;return n[0]=i,n[1]=0,n[2]=0,n[3]=0,n[4]=o,n[5]=0,n[6]=r,n[7]=s,n[8]=1,this},isEmpty:function(){return 0===this.matrix[8]},add:function(){const t=new jt(0,0),e=new jt(0,0),n=new jt(0,0),i=new jt(0,0);return function(o){return this.isEmpty()?this.assign(o):o.isEmpty()?this:(this.getExtents(t,e),o.getExtents(n,i),this.set(t.min(n),e.max(i),!0))}}(),multLeft:function(t){return this.matrix.multLeft(t),this},multRight:function(t){return this.matrix.multRight(t),this},getExtents:function(t,e){this.getAbsoluteExtents(t,e),t.add(this.center),e.add(this.center)},getAbsoluteExtents:function(){const t=new jt(0,0);return function(e,n){const i=this.matrix,o=i.xAxis,r=i.yAxis;t.assign(o).add(r);const s=r.subtract(o);e.assign(t).min(s),n.assign(t).max(s),t.negate(),s.negate(),e.min(t,s),n.max(t,s)}}(),containsPoint:function(){const t=new jt(0,0),e=new jt(0,0);return function(n){return this.getExtents(t,e),t.x<=n.x&&e.x>=n.x&&t.y<=n.y&&e.y>=n.y}}(),toString:function(){return this.size+", "+this.center}},Object.defineProperty(Fd.prototype,"size",{get:function(){const t=new jt(0,0),e=new jt(0,0);return function(){return this.getAbsoluteExtents(t,e),e.subtract(t)}}(),enumerable:!0,configurable:!1}),Object.defineProperty(Fd.prototype,"center",{get:function(){return this.matrix.origin},enumerable:!0,configurable:!1});const Nd=Fd;var Md=new Nd,Vd=new Nd,Id=new jt(0,0),Dd=new jt(0,0),Rd=new jt(0,0),Pd=new jt(0,0),Ad=new qt(0,0,0),Ld=new qt(0,0,0),Bd=new jt(0,0),Xd=new jt(0,0),Ud=new jt(0,0),zd=new jt(0,0),jd=new jt(0,0),kd=new qt(0,0,0),Gd=new jt(0,0),Hd=new Nd,qd=new jt(0,0),Yd=new qt(0,0,0);function Wd(t,e){this.browser=t.getBrowser(),this.text=t,this.fontStyle=e,this.glyphs=[],this.minorAlignment=new jt(0,0),this.translations=[],this.charSpacings=[],this.bearing=new jt(0,0),this.yPad=[],this.bbox=new ur}Wd.prototype={constructor:Wd,getBrowser:function(){return this.browser},getText:function(){return this.text},getFontStyle:function(){return this.fontStyle},getGlyphs:function(){return this.glyphs},getMinorAlignment:function(){return this.minorAlignment},getTranslations:function(){return this.translations},getCharSpacings:function(){return this.charSpacings},getBearing:function(){return this.bearing},getBBox:function(){return this.bbox},update:function(){var t=this.text,e=this.fontStyle,n=t._string.length;if(t._lineBounds.length=n,this.glyphs.length=0,0===n||!e.getFont())return t._origin.setValue(Yd),t._textBounds.setValue(qd),void this.bbox.set();if(e._horizontal.getValue())this.resizeArray(this.translations,n),this.resizeArray(this.charSpacings,n),this.horizontal(t,e);else{for(var i=t._string,o=0,r=0,s=i.length;r<s;++r)o+=i[r].length;this.resizeArray(this.translations,o),this.resizeArray(this.charSpacings,o),this.vertical(t,e)}},resizeArray:function(t,e){for(var n=t.length;n<e;++n)t.push(new jt(0,0));t.length=e},horizontal:function(t,e){var n=e.getFont(),i=t._string,o=i.length,r=Math.max(0,t._maxExtent.getValue()),s=e._topToBottom.getValue(),a=e.getScale(),u=e._spacing.getValue();Md.set();for(var c=s?o:-1,l=s?1:-1,h=s?0:o-1,d=0;h!==c;h+=l,++d){var f=i[h],p=this.getHorizontalLineExtents(e,f,Id,Dd,d);Bd.assign(Dd).subtract(Id);var g=0,m=t.getLength(h);switch(jd.set(Bd.x*a,0==d?Dd.y-n.descender/n.unitsPerEm*a:u),r&&(m=m?Math.min(r,m):Math.min(r,Bd.x*a)),m&&(g=(m-jd.x)/(p.length-1),jd.x=m,Bd.x=m/a),this.charSpacings[d]=g,t._lineBounds[h]=jd,e.getMajorAlignment()){case vd.BEGIN:case vd.FIRST:this.translations[d].set(0,-d*u);break;case vd.MIDDLE:this.translations[d].set(-Id.x-Bd.x/2,-d*u);break;case vd.END:this.translations[d].set(-Id.x-Bd.x,-d*u)}this.translations[d].multiply(a),Xd.assign(Id).add(Ud.assign(Bd).divide(2)),Md.add(Hd.set(Bd.multiply(a),Xd.multiply(a).add(this.translations[d])))}switch(Md.getExtents(Id,Dd),Bd.assign(Dd).subtract(Id),t._textBounds=Bd,this.bearing.set(0,-Dd.y),e.getMinorAlignment()){case vd.BEGIN:this.minorAlignment.assign(this.bearing);break;case vd.FIRST:this.minorAlignment.set(0,0);break;case vd.MIDDLE:this.minorAlignment.set(0,Bd.y/2-Dd.y);break;case vd.END:this.minorAlignment.set(0,(o-1)*u*a)}Id.add(this.minorAlignment),Dd.add(this.minorAlignment),t._origin.setValue(kd.set(Id.x,Dd.y,0)),this.bbox.setExtents(Ad.set(Id.x,Id.y,0),Ld.set(Dd.x,Dd.y,0))},vertical:function(t,e){var n=e.getFont(),i=t._string,o=i.length,r=Math.max(0,t._maxExtent.getValue()),s=e._leftToRight.getValue(),a=e._topToBottom.getValue(),u=e.getScale(),c=e._spacing.getValue(),l=this.yPad,h=this.getBrowser().getBrowserOptions().getPrimitiveQuality();Md.set();for(var d=s?o:-1,f=s?1:-1,p=0,g=s?0:o-1;g!==d;g+=f){var m=this.stringToGlyphs(n,i[g],!0,g),_=p,x=m.length;Vd.set();for(var y=a?x:-1,w=a?1:-1,T=a?0:x-1;T!==y;T+=w,++p){var S=m[T];this.getGlyphExtents(n,S,h,Id,Dd),Bd.assign(Dd).subtract(Id);var b=a?T:x-T-1;this.translations[p].set((c-Bd.x-Id.x)/2,-b),Xd.assign(Id).add(Ud.assign(Bd).divide(2)).add(this.translations[p]),Vd.add(Hd.set(Bd,Xd))}Vd.getExtents(Id,Dd),Bd.assign(Dd).subtract(Id);var v=s?g:o-g-1,E=(c-Bd.x)/2,C=0,O=t.getLength(g);switch(jd.set(0===g?c-E:c,x?Bd.y:0).multiply(u),r&&(O=O?Math.min(r,O):Math.min(r,Bd.y*u)),O&&(C=(O-jd.y)/(m.length-1)/u,jd.y=O,Bd.y=O/u,Id.y=Dd.y-Bd.y),t._lineBounds[g]=jd,e.getMajorAlignment()){case vd.BEGIN:case vd.FIRST:zd.set(v*c,-1);break;case vd.MIDDLE:zd.set(v*c,Bd.y/2-Dd.y);break;case vd.END:x&&this.getGlyphExtents(n,m[a?x-1:0],h,Rd.assign(jt.Zero),Gd),zd.set(v*c,Bd.y-Dd.y+Rd.y)}for(var F=0,N=_;N<p;++N)this.translations[N].add(zd),this.translations[N].y-=F,this.translations[N].multiply(u),F+=C;switch(e.getMajorAlignment()){case vd.BEGIN:case vd.FIRST:l[g]=Dd.y+zd.y;break;case vd.MIDDLE:l[g]=0;break;case vd.END:l[g]=Id.y+zd.y}Xd.assign(Id).add(Ud.assign(Bd).divide(2)),Md.add(Hd.set(Bd.multiply(u),Xd.add(zd).multiply(u)))}switch(Md.getExtents(Id,Dd),Bd.assign(Dd).subtract(Id),e.getMajorAlignment()){case vd.BEGIN:case vd.FIRST:var M=0;for(O=(V=t._lineBounds).length;M<O;++M)V[M].y+=Dd.y-l[M]*u;break;case vd.MIDDLE:break;case vd.END:var V;for(M=0,O=(V=t._lineBounds).length;M<O;++M)V[M].y+=l[M]*u-Id.y}switch(t._textBounds=Bd,e.getMajorAlignment()){case vd.BEGIN:case vd.FIRST:this.bearing.set(-Id.x,Dd.y);break;case vd.MIDDLE:this.bearing.set(-Id.x,0);break;case vd.END:this.bearing.set(-Id.x,Id.y)}switch(e.getMinorAlignment()){case vd.BEGIN:case vd.FIRST:this.minorAlignment.set(-Id.x,0);break;case vd.MIDDLE:this.minorAlignment.set(-Id.x-Bd.x/2,0);break;case vd.END:this.minorAlignment.set(-Id.x-Bd.x,0)}Id.add(this.minorAlignment),Dd.add(this.minorAlignment),t._origin.setValue(kd.set(Id.x,Dd.y,0)),this.bbox.set(Ad.set(Id.x,Id.y,0),Ld.set(Dd.x,Dd.y,0),!0)},stringToGlyphs:function(t,e,n,i){var o=this.glyphs[i];o||(o=this.glyphs[i]=[]),o.length=e.length;for(var r=n?0:e.length-1,s=n?e.length:-1,a=n?1:-1,u=r,c=0;u!==s;u+=a,++c)o[c]=t.charToGlyph(e[u]);return o},getHorizontalLineExtents:function(t,e,n,i,o){for(var r=t.getFont(),s=t._horizontal.getValue()?t._leftToRight.getValue():t._topToBottom.getValue(),a=this.stringToGlyphs(r,e,s,o),u=this.getBrowser().getBrowserOptions().getPrimitiveQuality(),c=0,l=0,h=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=0,p=a.length;f<p;++f){var g=a[f],m=f+1<p?r.getKerningValue(g,a[f+1]):0;this.getGlyphExtents(r,g,u,Rd,Pd),l+=g.advanceWidth+m,h=Math.min(h,Rd.y),d=Math.max(d,Pd.y)}switch(a.length?(this.getGlyphExtents(r,a[0],u,Rd,Pd),c=Rd.x):(h=0,d=0),n.set(c,h),i.set(l/r.unitsPerEm,d),t.getMajorAlignment()){case vd.BEGIN:case vd.FIRST:n.x=0}return a},traverse:function(t,e){}};const $d=Wd,Kd=et.lerp;function Qd(t,e,n,i,o,r,s,a){this.x0=t,this.y0=e,this.x1=n,this.y1=i,this.x2=o,this.y2=r,this.x3=s,this.y3=a,this.order=arguments.length/2-1}function Zd(t,e,n,i,o,r,s){const a=Kd(t,n,s),u=Kd(e,i,s),c=Kd(n,o,s),l=Kd(i,r,s);return{x:Kd(a,c,s),y:Kd(u,l,s)}}function Jd(t,e,n,i,o,r,s,a,u){const c=Kd(t,n,u),l=Kd(e,i,u),h=Kd(n,o,u),d=Kd(i,r,u),f=Kd(o,s,u),p=Kd(r,a,u),g=Kd(c,h,u),m=Kd(l,d,u),_=Kd(h,f,u),x=Kd(d,p,u);return{x:Kd(g,_,u),y:Kd(m,x,u)}}Qd.prototype={getLUT:function(t){const e=this.x0,n=this.y0,i=this.x1,o=this.y1,r=this.x2,s=this.y2,a=this.x3,u=this.y3,c=[];switch(this.order){case 2:for(let a=0,u=t-1;a<t;++a)c.push(Zd(e,n,i,o,r,s,a/u));break;case 3:for(let l=0,h=t-1;l<t;++l)c.push(Jd(e,n,i,o,r,s,a,u,l/h))}return c}};const tf=Qd;function ef(t,e){$d.call(this,t,e),t._transparent=!1,this.texCoordArray=Gr.createArray()}ef.prototype=Object.assign(Object.create($d.prototype),{constructor:ef,getTransparent:function(){return!1},getMatrix:function(){return Ne.Identity},build:function(){var t=new qt(0,0,0),e=new qt(0,0,0);return function(){var n=this.getFontStyle(),i=n.getFont();if(i){var o=this.getText(),r=this.getGlyphs(),s=this.getMinorAlignment(),a=this.getTranslations(),u=this.getCharSpacings(),c=n.getScale(),l=n._spacing.getValue(),h=o._origin.getValue(),d=c/i.unitsPerEm,f=this.getBrowser().getBrowserOptions().getPrimitiveQuality(),p=this.texCoordArray,g=o.getNormals(),m=o.getVertices();if(o.getMultiTexCoords().push(p),this.getBBox().getExtents(t,e),o.getMin().assign(t),o.getMax().assign(e),n._horizontal.getValue())for(var _=0,x=r.length;_<x;++_)for(var y=r[_],w=u[_],T=a[_],S=0,b=0,v=y.length;b<v;++b){for(var E=y[b],C=this.getGlyphGeometry(i,E,f),O=s.x+T.x+S+b*w,F=s.y+T.y,N=0,M=C.length;N<M;++N){var V=C[N].x*c+O,I=C[N].y*c+F;p.push((V-h.x)/l,(I-h.y)/l,0,1),g.push(0,0,1),m.push(V,I,0,1)}var D=0;b+1<y.length&&(D=i.getKerningValue(E,y[b+1])),S+=(E.advanceWidth+D)*d}else for(var R=n._leftToRight.getValue(),P=n._topToBottom.getValue(),A=R?0:o._string.length-1,L=R?o._string.length:-1,B=R?1:-1,X=(_=A,0);_!==L;_+=B){var U=(y=r[_]).length,z=P?U:-1,j=P?1:-1;for(b=P?0:U-1;b!==z;b+=j,++X)for(T=a[X],N=0,M=(C=this.getGlyphGeometry(i,y[b],f)).length;N<M;++N){V=C[N].x*c+s.x+T.x,I=C[N].y*c+s.y+T.y;p.push((V-h.x)/l,(I-h.y)/l,0,1),g.push(0,0,1),m.push(V,I,0,1)}}}}}(),getGlyphExtents:function(t,e,n,i,o){var r=this.getBrowser().getGlyph(t,n,e.index);if(s=r.extents)return i.assign(s.min),void o.assign(s.max);var s,a=this.getGlyphGeometry(t,e,n);if(a.length){var u=a[0];i.assign(u),o.assign(u);for(var c=1,l=a.length;c<l;++c){u=a[c];i.min(u),o.max(u)}}else i.set(0,0,0),o.set(0,0,0);(s=r.extents={}).min=i.copy(),s.max=o.copy()},getGlyphGeometry:function(t,e,n){var i=this.getBrowser().getGlyph(t,n,e.index),o=i.geometry;return o||(o=i.geometry=[],this.createGlyphGeometry(e,o,n),o)},createGlyphGeometry:function(){var t=[],e=[],n=new qt(0,0,0);return function(i,o,r){var s=this.getBezierDimension(r),a=i.getPath(0,0,1).commands,u=0,c=0;t.length=0,e.length=0;for(var l=0,h=a.length;l<h;++l){var d=a[l];switch(d.type){case"M":case"Z":t.length>2&&(t[0].x===t.at(-1).x&&t[0].y===t.at(-1).y&&t.pop(),e.push(t)),t=[],"M"===d.type&&t.push(new qt(d.x,-d.y,0));break;case"L":t.push(new qt(d.x,-d.y,0));break;case"Q":for(var f=1,p=(g=new tf(u,-c,d.x1,-d.y1,d.x,-d.y).getLUT(s)).length;f<p;++f)t.push(new qt(g[f].x,g[f].y,0));break;case"C":var g;for(f=1,p=(g=new tf(u,-c,d.x1,-d.y1,d.x2,-d.y2,d.x,-d.y).getLUT(s)).length;f<p;++f)t.push(new qt(g[f].x,g[f].y,0));break;default:continue}u=d.x,c=d.y}e=e.map((function(t){return Ho.getPolygonNormal(t,n),n.dot(qt.zAxis)>0?t:t.reverse()})),e.push(o),Ho.triangulatePolygon.apply(Ho,e)}}(),getBezierDimension:function(t){switch(t){case li.LOW:return 3;case li.HIGH:return 7;default:return 5}},display:function(t,e){},transformLine:function(t){},transformMatrix:function(t){}});const nf=ef;function of(t){Od.call(this,t),this.addType(o.FontStyle),this._size.setUnit("length")}of.prototype=Object.assign(Object.create(Od.prototype),{constructor:of,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"language",new Bn.SFString),new z(o.inputOutput,"family",new Bn.MFString("SERIF")),new z(o.inputOutput,"style",new Bn.SFString("PLAIN")),new z(o.inputOutput,"size",new Bn.SFFloat(1)),new z(o.inputOutput,"spacing",new Bn.SFFloat(1)),new z(o.inputOutput,"horizontal",new Bn.SFBool(!0)),new z(o.inputOutput,"leftToRight",new Bn.SFBool(!0)),new z(o.inputOutput,"topToBottom",new Bn.SFBool(!0)),new z(o.inputOutput,"justify",new Bn.MFString("BEGIN"))]),getTypeName:function(){return"FontStyle"},getComponentName:function(){return"Text"},getContainerField:function(){return"fontStyle"},getTextGeometry:function(t){return new nf(t,this)},getScale:function(){return this._size.getValue()}});const rf=of,sf=Symbol(),af=Symbol(),uf=Symbol();function cf(){this[af]=new Map,this[uf]=new Map}cf.prototype={initialize:function(){},getDefaultFontStyle:function(){return this[sf]=new rf(this.getPrivateScene()),this[sf].setPrivate(!0),this[sf].setup(),this.getDefaultFontStyle=function(){return this[sf]},Object.defineProperty(this,"getDefaultFontStyle",{enumerable:!1}),this[sf]},getFont:function(t){t=t.toString();let e=this[af].get(t);return void 0===e&&(this[af].set(t,e=$.Deferred()),opentype.load(t,this.setFont.bind(this,e))),e},setFont:function(t,e,n){e?t.reject(e):t.resolve(n)},getGlyph:function(t,e,n){let i=this[uf].get(t);i||this[uf].set(t,i=[]);let o=i[e];o||(o=i[e]=[]);let r=o[n];return r||(r=o[n]={}),r}};const lf=cf;function hf(t){es.call(this,t),this.addType(o.X3DTextureTransformNode)}hf.prototype=Object.assign(Object.create(es.prototype),{constructor:hf});const df=hf;function ff(t){df.call(this,t),this.addType(o.X3DSingleTextureTransformNode),this.matrixArray=new Float32Array(Ne.Identity)}ff.prototype=Object.assign(Object.create(df.prototype),{constructor:ff,getCount:function(){return 1},setMatrix:function(t){this.matrixArray.set(t)},getTextureTransformMapping:function(t,e=0){this._mapping.getValue()&&t.set(this._mapping.getValue(),e)},setShaderUniforms:function(t,e){for(let n=0,i=e.x3d_MaxTextures;n<i;++n)this.setShaderUniformsToChannel(t,e,n)},setShaderUniformsToChannel:function(t,e,n=0){t.uniformMatrix4fv(e.x3d_TextureMatrix[n],!1,this.matrixArray)}});const pf=ff;function gf(t){pf.call(this,t),this.addType(o.TextureTransform),this._rotation.setUnit("angle"),this.matrix=new Ne}gf.prototype=Object.assign(Object.create(pf.prototype),{constructor:gf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"mapping",new Bn.SFString),new z(o.inputOutput,"translation",new Bn.SFVec2f),new z(o.inputOutput,"rotation",new Bn.SFFloat),new z(o.inputOutput,"scale",new Bn.SFVec2f(1,1)),new z(o.inputOutput,"center",new Bn.SFVec2f)]),getTypeName:function(){return"TextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},initialize:function(){pf.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},getMatrix:function(){return this.matrix},eventsProcessed:function(){const t=new jt(0,0),e=new ee;return function(){const n=this._translation.getValue(),i=this._rotation.getValue(),o=this._scale.getValue(),r=this._center.getValue(),s=this.matrix;e.identity(),r.equals(jt.Zero)||e.translate(t.assign(r).negate()),o.equals(jt.One)||e.scale(o),0!==i&&e.rotate(i),r.equals(jt.Zero)||e.translate(r),n.equals(jt.Zero)||e.translate(n),s[0]=e[0],s[1]=e[1],s[4]=e[3],s[5]=e[4],s[12]=e[6],s[13]=e[7],this.setMatrix(s)}}()});const mf=gf,_f=Symbol(),xf=Symbol(),yf=Symbol(),wf=Symbol(),Tf=Symbol(),Sf=Symbol(),bf=Symbol(),vf=Symbol(),Ef=Symbol(),Cf=Symbol(),Of=Symbol(),Ff=Symbol(),Nf=Symbol(),Mf=Symbol(),Vf=Symbol(),If=Symbol(),Df=Symbol();function Rf(){const t=this.getContext(),e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this[_f]=e>8?2:1}Rf.prototype={initialize:function(){const t=this.getContext();t.pixelStorei(t.UNPACK_ALIGNMENT,1),this[xf]=t.getParameter(t.MAX_TEXTURE_SIZE),this[yf]=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this[wf]=NaN,this[Tf]=[...Array(this[yf]).keys()],this[Sf]=[this[Tf].pop()],this[bf]=[this[Tf].pop()],this[vf]=[this[Tf].pop()];const e=new Uint8Array([255,255,255,255]);this[Ff]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[Sf][0]),t.bindTexture(t.TEXTURE_2D,this[Ff]),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.getVersion()>=2&&(this[Nf]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[bf][0]),t.bindTexture(t.TEXTURE_3D,this[Nf]),t.texImage3D(t.TEXTURE_3D,0,t.RGBA,1,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e)),this[Mf]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[vf][0]),t.bindTexture(t.TEXTURE_CUBE_MAP,this[Mf]),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),this.resetTextureUnits(),this.setTextureQuality(this.getBrowserOptions().getTextureQuality())},getMaxTextures:function(){return this[_f]},getMinTextureSize:function(){return 16},getMaxTextureSize:function(){return this[xf]},getMaxCombinedTextureUnits:function(){return this[yf]},popTexture2DUnit:function(){return this[Ef]>0?(--this[Ef],this[Sf].pop()):this[Tf].pop()},pushTexture2DUnit:function(t){void 0!==t&&(++this[Ef],this[Sf].push(t))},getTexture2DUnit:function(){if(this[Ef]>0)return this[Sf][--this[Ef]];const t=this[Tf].pop();return void 0!==t&&this[Sf].push(t),t},getTexture3DUnit:function(){if(this[Cf]>0)return this[bf][--this[Cf]];const t=this[Tf].pop();return void 0!==t&&this[bf].push(t),t},getTextureCubeUnit:function(){if(this[Of]>0)return this[vf][--this[Of]];const t=this[Tf].pop();return void 0!==t&&this[vf].push(t),t},getTextureUnit:function(t){switch(t){case 2:return this.getTexture2DUnit();case 3:return this.getTexture3DUnit();case 4:return this.getTextureCubeUnit()}},resetTextureUnits:function(){this[Ef]=this[Sf].length,this[Cf]=this[bf].length,this[Of]=this[vf].length},getDefaultTexture2DUnit:function(){return this[Sf][0]},getDefaultTexture3DUnit:function(){return this[bf][0]},getDefaultTextureCubeUnit:function(){return this[vf][0]},getTextureMemory:function(){return this[wf]},getDefaultTextureProperties:function(){return this[Vf]=new vu(this.getPrivateScene()),this[Vf]._magnificationFilter="NICEST",this[Vf]._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",this[Vf]._textureCompression="NICEST",this[Vf]._generateMipMaps=!0,this[Vf].setup(),this.getDefaultTextureProperties=function(){return this[Vf]},Object.defineProperty(this,"getDefaultTextureProperties",{enumerable:!1}),this[Vf]},getDefaultTextureTransform:function(){return this[If]=new mf(this.getPrivateScene()),this[If].setPrivate(!0),this[If].setup(),this.getDefaultTextureTransform=function(){return this[If]},Object.defineProperty(this,"getDefaultTextureTransform",{enumerable:!1}),this[If]},getDefaultTextureCoordinate:function(){return this[Df]=new ku(this.getPrivateScene()),this[Df].setPrivate(!0),this[Df].setup(),this.getDefaultTextureCoordinate=function(){return this[Df]},Object.defineProperty(this,"getDefaultTextureCoordinate",{enumerable:!1}),this[Df]},setTextureQuality:function(t){const e=this.getDefaultTextureProperties();switch(t){case pi.LOW:e._magnificationFilter="AVG_PIXEL",e._minificationFilter="AVG_PIXEL",e._textureCompression="FASTEST",e._generateMipMaps=!0;break;case pi.MEDIUM:e._magnificationFilter="NICEST",e._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",e._textureCompression="NICEST",e._generateMipMaps=!0;break;case pi.HIGH:e._magnificationFilter="NICEST",e._minificationFilter="NICEST",e._textureCompression="NICEST",e._generateMipMaps=!0}}};const Pf=Rf,Af=Symbol(),Lf=Symbol(),Bf=Symbol(),Xf=Symbol();function Uf(){this[Af]=0,this[Lf]=60,this[Bf]=new qt(0,0,0),this[Xf]=0}Uf.prototype={initialize:function(){this.advanceTime(performance.now())},getCurrentTime:function(){return this[Af]},getCurrentFrameRate:function(){return this[Lf]},getCurrentSpeed:function(){return this[Xf]},advanceTime:function(){const t=new qt(0,0,0);return function(e){const n=(performance.timeOrigin+e)/1e3,i=n-this[Af];if(this[Af]=n,this[Lf]=i?1/i:60,this.getWorld()&&this.getActiveLayer()){const e=this.getActiveLayer().getViewpoint().getCameraSpaceMatrix();t.assign(this[Bf]),this[Bf].set(e[12],e[13],e[14]),this[Xf]=t.subtract(this[Bf]).magnitude()*this[Lf]}else this[Xf]=0}}()};const zf=Uf,jf=Symbol(),kf=Symbol(),Gf=Symbol(),Hf=Symbol();function qf(){this[jf]=[],this[kf]=[],this[Gf]=[],this[Hf]=[]}qf.prototype={constructor:qf,initialize:function(){},addTaintedField:function(t,e){this[jf].push(t,e)},addTaintedNode:function(t){this[Gf].push(t)},[Symbol.for("X_ITE.X3DRoutingContext.processEvents")]:function(){do{do{const t=this[jf];this[jf]=this[kf],this[jf].length=0;for(let e=0,n=t.length;e<n;e+=2)t[e].processEvent(t[e+1]);this[kf]=t}while(this[jf].length);do{const t=this[Gf];this[Gf]=this[Hf],this[Gf].length=0;for(const e of t)e.processEvents();this[Hf]=t}while(!this[jf].length&&this[Gf].length)}while(this[jf].length)}};const Yf=qf,Wf=Symbol(),$f=Symbol(),Kf=Symbol(),Qf=Symbol(),Zf=Symbol(),Jf=Symbol(),tp=Symbol(),ep=Symbol(),np=Symbol(),ip=Symbol(),op=Symbol(),rp=Symbol(),sp=Symbol.for("X_ITE.X3DRoutingContext.processEvents"),ap=[];function up(t){Zn.call(this,this),Yf.call(this),Su.call(this,t),yh.call(this),Bl.call(this),Pf.call(this),td.call(this),mh.call(this),wd.call(this),bc.call(this),tc.call(this),lh.call(this),Fl.call(this),Nc.call(this),Ou.call(this),Dc.call(this),Hl.call(this),Sd.call(this),lf.call(this),zf.call(this);for(const t of ap)t.call(this);this.addChildObjects("initialized",new A,"shutdown",new A,"prepareEvents",new A,"timeEvents",new A,"sensorEvents",new A,"finished",new A),this[$f]=0,this[Jf]=0,this[Zf]=this[Qf].bind(this),this[tp]=0,this[ep]=0,this[np]=0,this[ip]=0,this[op]=0,this[rp]=0}up.prototype=Object.assign(Object.create(Zn.prototype),Su.prototype,Ou.prototype,tc.prototype,bc.prototype,Nc.prototype,Dc.prototype,Fl.prototype,Bl.prototype,Hl.prototype,lh.prototype,mh.prototype,Yf.prototype,yh.prototype,td.prototype,wd.prototype,Sd.prototype,lf.prototype,Pf.prototype,zf.prototype,{constructor:up,initialize:function(){Zn.prototype.initialize.call(this),Yf.prototype.initialize.call(this),Su.prototype.initialize.call(this),yh.prototype.initialize.call(this),Bl.prototype.initialize.call(this),Pf.prototype.initialize.call(this),td.prototype.initialize.call(this),mh.prototype.initialize.call(this),wd.prototype.initialize.call(this),bc.prototype.initialize.call(this),tc.prototype.initialize.call(this),lh.prototype.initialize.call(this),Fl.prototype.initialize.call(this),Nc.prototype.initialize.call(this),Ou.prototype.initialize.call(this),Dc.prototype.initialize.call(this),Hl.prototype.initialize.call(this),Sd.prototype.initialize.call(this),lf.prototype.initialize.call(this),zf.prototype.initialize.call(this);for(const t of ap)"function"==typeof t.prototype.initialize&&t.prototype.initialize.call(this);this[sp]()},initialized:function(){return this._initialized},shutdown:function(){return this._shutdown},prepareEvents:function(){return this._prepareEvents},timeEvents:function(){return this._timeEvents},sensorEvents:function(){return this._sensorEvents},finished:function(){return this._finished},getBrowser:function(){return this},getWorld:function(){return this[Wf]},setExecutionContext:function(t){this[Wf]=new ks(t),this[Wf].setup()},getExecutionContext:function(){return this[Wf].getExecutionContext()},addBrowserEvent:function(){this[$f]!==this.getCurrentTime()&&(this[$f]=this.getCurrentTime(),requestAnimationFrame(this[Zf]))},[Kf]:function(t){return t===this[Jf]?(requestAnimationFrame(this[Zf]),!0):(this[Jf]=t,!1)},[Qf]:function(t){if(this[Kf](t))return;const e=this.getContext(),n=performance.now();this[tp]=n-this[ep],this.advanceTime(t),this._prepareEvents.processInterests(),this[sp](),this._timeEvents.processInterests(),this[sp]();const i=performance.now();this[Wf].traverse(ir.CAMERA,null),this[ip]=performance.now()-i;const o=performance.now();this.getCollisionCount()&&this[Wf].traverse(ir.COLLISION,null),this[op]=performance.now()-o,this._sensorEvents.processInterests(),this[sp]();const r=performance.now();e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),this[Wf].traverse(ir.DISPLAY,null),this[rp]=performance.now()-r,this[np]=performance.now()-n,this[ep]=performance.now(),this._finished.processInterests()},getSystemTime:function(){return this[tp]},getBrowserTime:function(){return this[np]},getCameraTime:function(){return this[ip]},getCollisionTime:function(){return this[op]},getDisplayTime:function(){return this[rp]}});for(const t of Reflect.ownKeys(up.prototype))Object.defineProperty(up.prototype,t,{enumerable:!1});Object.assign(up,{addBrowserContext:function(t){ap.push(t);for(const e of Object.keys(t.prototype).concat(Object.getOwnPropertySymbols(t.prototype)))up.prototype.hasOwnProperty(e)||Object.defineProperty(up.prototype,e,{value:t.prototype[e],enumerable:!1,writable:!0});$("x3d-canvas, X3DCanvas").each((function(e,n){const i=window[Symbol.for("X_ITE.X3D-7.0.0")].getBrowser(n);t.call(i),"function"==typeof t.prototype.initialize&&t.prototype.initialize.call(i),i[sp]()}))}});const cp=up;function lp(t){this.addType(o.X3DMetadataObject)}lp.prototype={constructor:lp,initialize:function(){},dispose:function(){}};const hp=lp;function dp(t){ji.call(this,t),hp.call(this,t),this.addType(o.MetadataBoolean)}dp.prototype=Object.assign(Object.create(ji.prototype),hp.prototype,{constructor:dp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"name",new Bn.SFString),new z(o.inputOutput,"reference",new Bn.SFString),new z(o.inputOutput,"value",new Bn.MFBool)]),getTypeName:function(){return"MetadataBoolean"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});const fp=dp;function pp(t){ji.call(this,t),hp.call(this,t),this.addType(o.MetadataDouble)}pp.prototype=Object.assign(Object.create(ji.prototype),hp.prototype,{constructor:pp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"name",new Bn.SFString),new z(o.inputOutput,"reference",new Bn.SFString),new z(o.inputOutput,"value",new Bn.MFDouble)]),getTypeName:function(){return"MetadataDouble"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});const gp=pp;function mp(t){ji.call(this,t),hp.call(this,t),this.addType(o.MetadataFloat)}mp.prototype=Object.assign(Object.create(ji.prototype),hp.prototype,{constructor:mp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"name",new Bn.SFString),new z(o.inputOutput,"reference",new Bn.SFString),new z(o.inputOutput,"value",new Bn.MFFloat)]),getTypeName:function(){return"MetadataFloat"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});const _p=mp;function xp(t){ji.call(this,t),hp.call(this,t),this.addType(o.MetadataInteger)}xp.prototype=Object.assign(Object.create(ji.prototype),hp.prototype,{constructor:xp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"name",new Bn.SFString),new z(o.inputOutput,"reference",new Bn.SFString),new z(o.inputOutput,"value",new Bn.MFInt32)]),getTypeName:function(){return"MetadataInteger"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});const yp=xp;function wp(t){ji.call(this,t),hp.call(this,t),this.addType(o.MetadataSet)}wp.prototype=Object.assign(Object.create(ji.prototype),hp.prototype,{constructor:wp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"name",new Bn.SFString),new z(o.inputOutput,"reference",new Bn.SFString),new z(o.inputOutput,"value",new Bn.MFNode)]),getTypeName:function(){return"MetadataSet"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});const Tp=wp;function Sp(t){ji.call(this,t),hp.call(this,t),this.addType(o.MetadataString)}Sp.prototype=Object.assign(Object.create(ji.prototype),hp.prototype,{constructor:Sp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"name",new Bn.SFString),new z(o.inputOutput,"reference",new Bn.SFString),new z(o.inputOutput,"value",new Bn.MFString)]),getTypeName:function(){return"MetadataString"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});const bp=Sp;function vp(t){gr.call(this,t),this.addType(o.X3DInfoNode)}vp.prototype=Object.assign(Object.create(gr.prototype),{constructor:vp});const Ep=vp;function Cp(t){Ep.call(this,t),this.addType(o.WorldInfo)}Cp.prototype=Object.assign(Object.create(Ep.prototype),{constructor:Cp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"title",new Bn.SFString),new z(o.inputOutput,"info",new Bn.MFString)]),getTypeName:function(){return"WorldInfo"},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},initialize:function(){Ep.prototype.initialize.call(this),this.getExecutionContext().addWorldInfo(this)},dispose:function(){this.getExecutionContext().removeWorldInfo(this),Ep.prototype.dispose.call(this)}});const Op={MetadataBoolean:fp,MetadataDouble:gp,MetadataFloat:_p,MetadataInteger:yp,MetadataSet:Tp,MetadataString:bp,WorldInfo:Cp},Fp={X3DBindableNode:Nr,X3DChildNode:gr,X3DInfoNode:Ep,X3DMetadataObject:hp,X3DNode:ji,X3DPrototypeInstance:so,X3DSensorNode:_s};for(const t in Op)Bi.addType(t,Op[t]);for(const t in Fp)Bi.addAbstractType(t,Fp[t]);function Np(t){Du.call(this,t),this.addType(o.FogCoordinate),this._depth.setUnit("length")}Np.prototype=Object.assign(Object.create(Du.prototype),{constructor:Np,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"depth",new Bn.MFFloat)]),getTypeName:function(){return"FogCoordinate"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"fogCoord"},initialize:function(){Du.prototype.initialize.call(this),this._depth.addInterest("set_depth__",this),this.set_depth__()},set_depth__:function(){this.depth=this._depth.getValue(),this.length=this._depth.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},addDepth:function(t,e){t<this.length?e.push(this.depth[t]):this.length?e.push(this.depth[this.length-1]):e.push(0)},addDepths:function(t,e){const n=this.length;if(n){const i=this.depth;for(let e=0;e<n;++e)t.push(i[e]);const o=i[n-1];for(let i=n;i<e;++i)t.push(o)}else for(let n=0;n<e;++n)t.push(0)}});const Mp=Np;function Vp(t){gr.call(this,t),Lr.call(this,t),this.addType(o.LocalFog)}Vp.prototype=Object.assign(Object.create(gr.prototype),Lr.prototype,{constructor:Vp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"fogType",new Bn.SFString("LINEAR")),new z(o.inputOutput,"color",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"visibilityRange",new Bn.SFFloat)]),getTypeName:function(){return"LocalFog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){gr.prototype.initialize.call(this),Lr.prototype.initialize.call(this)},push:function(t){if(this._enabled.getValue()&&this.getFogType()){const e=this.getFogs().pop();e.set(this,t.getModelViewMatrix().get()),t.getLocalFogs().push(e)}},pop:function(t){this._enabled.getValue()&&this.getFogType()&&this.getBrowser().getLocalObjects().push(t.getLocalFogs().pop())}});const Ip=Vp;function Dp(t){Jr.call(this,t),this.addType(o.TextureBackground)}Dp.prototype=Object.assign(Object.create(Jr.prototype),{constructor:Dp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_bind",new Bn.SFBool),new z(o.inputOutput,"skyAngle",new Bn.MFFloat),new z(o.inputOutput,"skyColor",new Bn.MFColor(new Bn.SFColor)),new z(o.inputOutput,"groundAngle",new Bn.MFFloat),new z(o.inputOutput,"groundColor",new Bn.MFColor),new z(o.inputOutput,"transparency",new Bn.SFFloat),new z(o.outputOnly,"isBound",new Bn.SFBool),new z(o.outputOnly,"bindTime",new Bn.SFTime),new z(o.inputOutput,"frontTexture",new Bn.SFNode),new z(o.inputOutput,"backTexture",new Bn.SFNode),new z(o.inputOutput,"leftTexture",new Bn.SFNode),new z(o.inputOutput,"rightTexture",new Bn.SFNode),new z(o.inputOutput,"topTexture",new Bn.SFNode),new z(o.inputOutput,"bottomTexture",new Bn.SFNode)]),getTypeName:function(){return"TextureBackground"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){Jr.prototype.initialize.call(this),this._frontTexture.addInterest("set_frontTexture__",this),this._backTexture.addInterest("set_backTexture__",this),this._leftTexture.addInterest("set_leftTexture__",this),this._rightTexture.addInterest("set_rightTexture__",this),this._topTexture.addInterest("set_topTexture__",this),this._bottomTexture.addInterest("set_bottomTexture__",this),this.set_frontTexture__(this._frontTexture),this.set_backTexture__(this._backTexture),this.set_leftTexture__(this._leftTexture),this.set_rightTexture__(this._rightTexture),this.set_topTexture__(this._topTexture),this.set_bottomTexture__(this._bottomTexture)},set_frontTexture__:function(){Jr.prototype.set_frontTexture__.call(this,mr(o.X3DTextureNode,this._frontTexture))},set_backTexture__:function(){Jr.prototype.set_backTexture__.call(this,mr(o.X3DTextureNode,this._backTexture))},set_leftTexture__:function(){Jr.prototype.set_leftTexture__.call(this,mr(o.X3DTextureNode,this._leftTexture))},set_rightTexture__:function(){Jr.prototype.set_rightTexture__.call(this,mr(o.X3DTextureNode,this._rightTexture))},set_topTexture__:function(){Jr.prototype.set_topTexture__.call(this,mr(o.X3DTextureNode,this._topTexture))},set_bottomTexture__:function(){Jr.prototype.set_bottomTexture__.call(this,mr(o.X3DTextureNode,this._bottomTexture))}});const Rp={Background:ds,Fog:Xr,FogCoordinate:Mp,LocalFog:Ip,TextureBackground:Dp},Pp={X3DBackgroundNode:Jr,X3DFogObject:Lr};for(const t in Rp)Bi.addType(t,Rp[t]);for(const t in Pp)Bi.addAbstractType(t,Pp[t]);function Ap(t){_s.call(this,t),this.addType(o.X3DEnvironmentalSensorNode),this.addChildObjects("traversed",new Bn.SFBool(!0)),this._size.setUnit("length"),this._center.setUnit("length"),this.zeroTest=!1,this.currentTraversed=!0}Ap.prototype=Object.assign(Object.create(_s.prototype),{constructor:Ap,initialize:function(){_s.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._size.addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this.set_live__()},set_live__:function(){!(this._traversed.getValue()&&this.isLive().getValue()&&this._enabled.getValue())||this.zeroTest&&this._size.getValue().equals(qt.Zero)?(this.getBrowser().sensorEvents().removeInterest("update",this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime())):this.getBrowser().sensorEvents().addInterest("update",this)},setZeroTest:function(t){this.zeroTest=t},getZeroTest:function(){return this.zeroTest},setTraversed:function(t){t?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=t},getTraversed:function(){return this.currentTraversed},update:function(){}});const Lp=Ap;function Bp(t){Lp.call(this,t),this.addType(o.ProximitySensor),this.setCameraObject(!0),this._centerOfRotation_changed.setUnit("length"),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new qt(0,0,0),this.max=new qt(0,0,0),this.viewpointNode=null,this.modelMatrix=new Ne,this.inside=!1}Bp.prototype=Object.assign(Object.create(Lp.prototype),{constructor:Bp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"size",new Bn.SFVec3f),new z(o.inputOutput,"center",new Bn.SFVec3f),new z(o.outputOnly,"enterTime",new Bn.SFTime),new z(o.outputOnly,"exitTime",new Bn.SFTime),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"position_changed",new Bn.SFVec3f),new z(o.outputOnly,"orientation_changed",new Bn.SFRotation),new z(o.outputOnly,"centerOfRotation_changed",new Bn.SFVec3f)]),getTypeName:function(){return"ProximitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){Lp.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._traversed.addFieldInterest(this._isCameraObject),this.set_enabled__(),this.set_extents__()},set_enabled__:function(){this.setCameraObject(this._enabled.getValue()),this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},set_extents__:function(){const t=this._size.getValue(),e=this._center.getValue(),n=t.x/2,i=t.y/2,o=t.z/2,r=e.x,s=e.y,a=e.z;this.min.set(r-n,s-i,a-o),this.max.set(r+n,s+i,a+o)},update:function(){const t=new Ne,e=new Ne,n=new qt(0,0,0),i=new Ce(0,0,1,0),o=new qt(0,0,0);return function(){if(this.inside&&this.getTraversed()){if(this.viewpointNode){const r=this.modelMatrix;e.assign(this.viewpointNode.getModelMatrix()),e.translate(this.viewpointNode.getUserCenterOfRotation()),e.multRight(t.assign(r).inverse()),r.multRight(this.viewpointNode.getViewMatrix()),r.get(null,i),r.inverse(),n.set(r[12],r[13],r[14]),i.inverse(),o.set(e[12],e[13],e[14]),this._isActive.getValue()?(this._position_changed.getValue().equals(n)||(this._position_changed=n),this._orientation_changed.getValue().equals(i)||(this._orientation_changed=i),this._centerOfRotation_changed.getValue().equals(o)||(this._centerOfRotation_changed=o)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=n,this._orientation_changed=i,this._centerOfRotation_changed=o)}}else this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());this.inside=!1,this.viewpointNode=null,this.setTraversed(!1)}}(),traverse:function(){const t=new Ne,e=new qt(-1,-1,-1);return function(n,i){switch(n){case ir.CAMERA:return this.viewpointNode=i.getViewpoint(),void this.modelMatrix.assign(i.getModelViewMatrix().get());case ir.DISPLAY:if(this.setTraversed(!0),this.inside)return;return void(this._size.getValue().equals(e)?this.inside=!0:(t.assign(i.getModelViewMatrix().get()).inverse(),this.inside=this.containsPoint(t.origin)))}}}(),containsPoint:function(t){const e=this.min,n=this.max;return e.x<=t.x&&n.x>=t.x&&e.y<=t.y&&n.y>=t.y&&e.z<=t.z&&n.z>=t.z}});const Xp=Bp,Up=Dr(Ne),zp=Dr(Ne);function jp(t){Lp.call(this,t),this.addType(o.TransformSensor),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new qt,this.max=new qt,this.targetObjectNode=null,this.modelMatrices=[],this.targetMatrices=[]}jp.prototype=Object.assign(Object.create(Lp.prototype),{constructor:jp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"size",new Bn.SFVec3f),new z(o.inputOutput,"center",new Bn.SFVec3f),new z(o.outputOnly,"enterTime",new Bn.SFTime),new z(o.outputOnly,"exitTime",new Bn.SFTime),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"position_changed",new Bn.SFVec3f),new z(o.outputOnly,"orientation_changed",new Bn.SFRotation),new z(o.inputOutput,"targetObject",new Bn.SFNode)]),getTypeName:function(){return"TransformSensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){Lp.prototype.initialize.call(this),this.isLive().addInterest("set_enabled__",this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._targetObject.addInterest("set_targetObject__",this),this.set_extents__(),this.set_targetObject__()},set_live__:function(){},set_enabled__:function(){this.isLive().getValue()&&this.targetObjectNode&&this._enabled.getValue()&&!this._size.getValue().equals(qt.Zero)?(this.setPickableObject(!0),this.getBrowser().addTransformSensor(this),this.targetObjectNode.addTransformSensor(this)):(this.setPickableObject(!1),this.getBrowser().removeTransformSensor(this),this.targetObjectNode&&this.targetObjectNode.removeTransformSensor(this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()))},set_extents__:function(){const t=this._size.getValue(),e=this._center.getValue(),n=t.x/2,i=t.y/2,o=t.z/2,r=e.x,s=e.y,a=e.z;this.min.set(r-n,s-i,a-o),this.max.set(r+n,s+i,a+o)},set_targetObject__:function(){this.targetObjectNode=null;try{const t=this._targetObject.getValue().getInnerNode(),e=t.getType();for(let n=e.length-1;n>=0;--n){switch(e[n]){case o.X3DGroupingNode:case o.X3DShapeNode:this.targetObjectNode=t;break;default:continue}break}}catch(t){}this.set_enabled__()},traverse:function(t,e){t===ir.PICKING&&this.getPickableObject()&&this.modelMatrices.push(Up.pop().assign(e.getModelViewMatrix().get()))},collect:function(t){this.targetMatrices.push(zp.pop().assign(t))},process:function(){const t=new qt(0,0,0),e=new Ce(0,0,1,0);return function(){const n=this.modelMatrices,i=this.targetMatrices,o=this.intersects();o?(o.get(t,e),this._isActive.getValue()?(this._position_changed.getValue().equals(t)||(this._position_changed=t),this._orientation_changed.getValue().equals(e)||(this._orientation_changed=e)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=t,this._orientation_changed=e)):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());for(const t of n)Up.push(t);for(const t of i)zp.push(t);n.length=0,i.length=0}}(),intersects:function(){const t=new qt(-1,-1,-1);return function(){const e=this.modelMatrices,n=this.targetMatrices,i=this._size.getValue().equals(t);for(const t of e){const e=t.inverse();for(const t of n){const n=t.multRight(e);if(i||this.containsPoint(n.origin))return n}}return null}}(),containsPoint:function(t){const e=this.min,n=this.max;return e.x<=t.x&&n.x>=t.x&&e.y<=t.y&&n.y>=t.y&&e.z<=t.z&&n.z>=t.z}});const kp=jp;function Gp(t){Lp.call(this,t),this.addType(o.VisibilitySensor),this.setZeroTest(!1),this.visible=!1}Gp.prototype=Object.assign(Object.create(Lp.prototype),{constructor:Gp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"size",new Bn.SFVec3f),new z(o.inputOutput,"center",new Bn.SFVec3f),new z(o.outputOnly,"enterTime",new Bn.SFTime),new z(o.outputOnly,"exitTime",new Bn.SFTime),new z(o.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"VisibilitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){Lp.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__:function(){this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},update:function(){this.visible&&this.getTraversed()?(this._isActive.getValue()||(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime()),this.visible=!1):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()),this.setTraversed(!1)},traverse:function(){const t=new ur,e=new qt(-1,-1,-1);return function(n,i){n===ir.DISPLAY&&(this.setTraversed(!0),this.visible||(this._size.getValue().equals(e)?this.visible=!0:(t.set(this._size.getValue(),this._center.getValue()).multRight(i.getModelViewMatrix().get()),this.visible=i.getViewVolume().intersectsBox(t))))}}()});const Hp={ProximitySensor:Xp,TransformSensor:kp,VisibilitySensor:Gp},qp={X3DEnvironmentalSensorNode:Lp};for(const t in Hp)Bi.addType(t,Hp[t]);for(const t in qp)Bi.addAbstractType(t,qp[t]);var Yp=new qt(0,0,0),Wp=new qt(0,0,0),$p=new qt(0,0,0),Kp=new qt(0,0,0);function Qp(t){zc.call(this,t),this.addType(o.ColorChaser)}Qp.prototype=Object.assign(Object.create(zc.prototype),{constructor:Qp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFColor),new z(o.inputOnly,"set_destination",new Bn.SFColor),new z(o.initializeOnly,"initialValue",new Bn.SFColor(.8,.8,.8)),new z(o.initializeOnly,"initialDestination",new Bn.SFColor(.8,.8,.8)),new z(o.initializeOnly,"duration",new Bn.SFTime(1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFColor)]),getTypeName:function(){return"ColorChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new qt(0,0,0)},getValue:function(){return this._set_value.getValue().getHSV(Kp)},getDestination:function(){return this._set_destination.getValue().getHSV(Kp)},getInitialValue:function(){return this._initialValue.getValue().getHSV(Yp)},getInitialDestination:function(){return this._initialDestination.getValue().getHSV(Wp)},setValue:function(t){this._value_changed.setHSV(t.x,t.y,t.z)},interpolate:function(t,e,n){return lt.lerp(t,e,n,Kp)},step:function(t,e,n){$p.assign(this.output).add(t).subtract(e),lt.lerp(this.output,$p,n,this.output)}});const Zp=Qp;function Jp(t){Xc.call(this,t),this.addType(o.X3DDamperNode)}Jp.prototype=Object.assign(Object.create(Xc.prototype),{constructor:Jp,initialize:function(){Xc.prototype.initialize.call(this),this._order.addInterest("set_order__",this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this);var t=this.getBuffer(),e=this.getInitialValue(),n=this.getInitialDestination();t[0]=this.duplicate(n);for(var i=1,o=this.getOrder()+1;i<o;++i)t[i]=this.duplicate(e);this.equals(n,e,this.getTolerance())?this.setValue(n):this.set_active(!0)},getOrder:function(){return et.clamp(this._order.getValue(),0,5)},getTolerance:function(){return this._tolerance.getValue()<0?1e-4:this._tolerance.getValue()},prepareEvents:function(){var t=this.getBuffer(),e=t.length-1;if(this._tau.getValue()){for(var n=1/this.getBrowser().currentFrameRate,i=Math.exp(-n/this._tau.getValue()),o=0;o<e;++o)this.assign(t,o+1,this.interpolate(t[o],t[o+1],i));if(this.setValue(t[e]),!this.equals(t[e],t[0],this.getTolerance()))return}else this.setValue(t[0]),e=0;o=1;for(var r=t.length;o<r;++o)this.assign(t,o,t[e]);this.set_active(!1)},set_value__:function(){for(var t=this.getBuffer(),e=this.getValue(),n=1,i=t.length;n<i;++n)this.assign(t,n,e);this.setValue(e),this.set_active(!0)},set_destination__:function(){this.assign(this.getBuffer(),0,this.getDestination()),this.set_active(!0)},set_order__:function(){for(var t=this.getBuffer(),e=t[t.length-1],n=t.length,i=this.getOrder()+1;n<i;++n)t[n]=this.duplicate(e);t.length=i}});const tg=Jp;var eg=new qt(0,0,0),ng=new qt(0,0,0),ig=new qt(0,0,0),og=new qt(0,0,0);function rg(t){tg.call(this,t),this.addType(o.ColorDamper)}rg.prototype=Object.assign(Object.create(tg.prototype),{constructor:rg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFColor),new z(o.inputOnly,"set_destination",new Bn.SFColor),new z(o.initializeOnly,"initialValue",new Bn.SFColor(.8,.8,.8)),new z(o.initializeOnly,"initialDestination",new Bn.SFColor(.8,.8,.8)),new z(o.initializeOnly,"order",new Bn.SFInt32(3)),new z(o.inputOutput,"tau",new Bn.SFTime(.3)),new z(o.inputOutput,"tolerance",new Bn.SFFloat(-1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFColor)]),getTypeName:function(){return"ColorDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new qt(0,0,0)},getValue:function(){return this._set_value.getValue().getHSV(og)},getDestination:function(){return this._set_destination.getValue().getHSV(og)},getInitialValue:function(){return this._initialValue.getValue().getHSV(ng)},getInitialDestination:function(){return this._initialDestination.getValue().getHSV(ig)},setValue:function(t){this._value_changed.setHSV(t.x,t.y,t.z)},equals:function(t,e,n){return eg.assign(t).subtract(e).magnitude()<n},interpolate:function(t,e,n){return lt.lerp(t,e,n,og)}});const sg=rg;function ag(t){function e(){this.array=this.getArray(),this.zero=this.getVector()}return e.prototype={getArray:function(){const t=[];return t.assign=function(t){if(Array.isArray(t)){for(var e=0,n=Math.min(this.length,t.length);e<n;++e)this[e].assign(t[e]);for(e=n,n=t.length;e<n;++e)this[e]=t[e].copy();this.length=n}else{for(e=0,n=Math.min(this.length,t.length);e<n;++e)this[e].assign(t[e].getValue());for(e=n,n=t.length;e<n;++e)this[e]=t[e].getValue().copy();this.length=n}},t},getValue:function(){return this._set_value},getDestination:function(){return this._set_destination},getInitialValue:function(){return this._initialValue},getInitialDestination:function(){return this._initialDestination},setValue:function(t){if(Array.isArray(t)){const i=this._value_changed;for(var e=0,n=t.length;e<n;++e)i[e]=t[e];i.length=n}else this._value_changed=t},duplicate:function(t){const e=this.getArray();return e.assign(t),e},equals:function(t,e,n){if(t.length!==e.length)return!1;const i=this.a;let o=0;for(let n=0,r=t.length;n<r;++n)o=Math.max(i.assign(t[n]).subtract(e[n]).magnitude());return o<n},interpolate:function(t,e,n){const i=this.array;i.assign(t);for(let t=0,o=i.length;t<o;++t)i[t].lerp(e[t]||this.zero,n);return i},set_destination__:function(){const e=this.getBuffer(),n=this._set_destination.length;for(let t=0,i=e.length;t<i;++t){const i=e[t];for(let t=i.length;t<n;++t)i[t]=this.getVector();i.length=n}t.prototype.set_destination__.call(this)}},e}function ug(t){const e=ag(t);function n(){e.call(this),this.array=this.getArray()}return Object.assign(n.prototype,e.prototype,{step:function(t,e,n){const i=this.output,o=this.deltaOut;for(let r=0,s=i.length;r<s;++r)i[r].add(o.assign(t[r]||this.zero).subtract(e[r]||this.zero).multiply(n))}}),n}var cg=ug(zc);function lg(t){zc.call(this,t),cg.call(this,t),this.addType(o.CoordinateChaser)}lg.prototype=Object.assign(Object.create(zc.prototype),cg.prototype,{constructor:lg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.MFVec3f),new z(o.inputOnly,"set_destination",new Bn.MFVec3f),new z(o.initializeOnly,"initialValue",new Bn.MFVec3f(new qt(0,0,0))),new z(o.initializeOnly,"initialDestination",new Bn.MFVec3f(new qt(0,0,0))),new z(o.initializeOnly,"duration",new Bn.SFTime(1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.MFVec3f)]),getTypeName:function(){return"CoordinateChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new qt(0,0,0)}});const hg=lg;var dg=ag(tg);function fg(t){tg.call(this,t),dg.call(this,t),this.addType(o.CoordinateDamper)}fg.prototype=Object.assign(Object.create(tg.prototype),dg.prototype,{constructor:fg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.MFVec3f),new z(o.inputOnly,"set_destination",new Bn.MFVec3f),new z(o.initializeOnly,"initialValue",new Bn.MFVec3f(new qt(0,0,0))),new z(o.initializeOnly,"initialDestination",new Bn.MFVec3f(new qt(0,0,0))),new z(o.initializeOnly,"order",new Bn.SFInt32(3)),new z(o.inputOutput,"tau",new Bn.SFTime(.3)),new z(o.inputOutput,"tolerance",new Bn.SFFloat(-1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.MFVec3f)]),getTypeName:function(){return"CoordinateDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new qt(0,0,0)}});const pg=fg;var gg=new Ce(0,0,1,0),mg=new Ce(0,0,1,0);function _g(t){tg.call(this,t),this.addType(o.OrientationDamper),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}_g.prototype=Object.assign(Object.create(tg.prototype),{constructor:_g,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFRotation),new z(o.inputOnly,"set_destination",new Bn.SFRotation),new z(o.initializeOnly,"initialValue",new Bn.SFRotation),new z(o.initializeOnly,"initialDestination",new Bn.SFRotation),new z(o.initializeOnly,"order",new Bn.SFInt32(3)),new z(o.inputOutput,"tau",new Bn.SFTime(.3)),new z(o.inputOutput,"tolerance",new Bn.SFFloat(-1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFRotation)]),getTypeName:function(){return"OrientationDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new Ce(0,0,1,0)},equals:function(t,e,n){return gg.assign(t).inverse().multRight(e),Math.abs(gg.angle)<n},interpolate:function(t,e,n){return mg.assign(t).slerp(e,n)}});const xg=_g;function yg(t){zc.call(this,t),this.addType(o.PositionChaser2D)}yg.prototype=Object.assign(Object.create(zc.prototype),{constructor:yg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFVec2f),new z(o.inputOnly,"set_destination",new Bn.SFVec2f),new z(o.initializeOnly,"initialValue",new Bn.SFVec2f),new z(o.initializeOnly,"initialDestination",new Bn.SFVec2f),new z(o.initializeOnly,"duration",new Bn.SFTime(1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFVec2f)]),getTypeName:function(){return"PositionChaser2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new jt(0,0)}});const wg=yg;function Tg(t){tg.call(this,t),this.addType(o.PositionDamper)}Tg.prototype=Object.assign(Object.create(tg.prototype),{constructor:Tg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFVec3f),new z(o.inputOnly,"set_destination",new Bn.SFVec3f),new z(o.initializeOnly,"initialValue",new Bn.SFVec3f),new z(o.initializeOnly,"initialDestination",new Bn.SFVec3f),new z(o.initializeOnly,"order",new Bn.SFInt32(3)),new z(o.inputOutput,"tolerance",new Bn.SFFloat(-1)),new z(o.inputOutput,"tau",new Bn.SFTime(.3)),new z(o.outputOnly,"value_changed",new Bn.SFVec3f),new z(o.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"PositionDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new qt(0,0,0)}});const Sg=Tg;function bg(t){tg.call(this,t),this.addType(o.PositionDamper2D)}bg.prototype=Object.assign(Object.create(tg.prototype),{constructor:bg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFVec2f),new z(o.inputOnly,"set_destination",new Bn.SFVec2f),new z(o.initializeOnly,"initialValue",new Bn.SFVec2f),new z(o.initializeOnly,"initialDestination",new Bn.SFVec2f),new z(o.initializeOnly,"order",new Bn.SFInt32(3)),new z(o.inputOutput,"tau",new Bn.SFTime(.3)),new z(o.inputOutput,"tolerance",new Bn.SFFloat(-1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFVec2f)]),getTypeName:function(){return"PositionDamper2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new jt(0,0)}});const vg=bg;function Eg(t){zc.call(this,t),this.addType(o.ScalarChaser)}Eg.prototype=Object.assign(Object.create(zc.prototype),{constructor:Eg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFFloat),new z(o.inputOnly,"set_destination",new Bn.SFFloat),new z(o.initializeOnly,"initialValue",new Bn.SFFloat),new z(o.initializeOnly,"initialDestination",new Bn.SFFloat),new z(o.initializeOnly,"duration",new Bn.SFTime(1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFFloat)]),getTypeName:function(){return"ScalarChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return 0},setPreviousValue:function(t){this.previousValue=t},setDestination:function(t){this.destination=t},duplicate:function(t){return t},assign:function(t,e,n){t[e]=n},equals:function(t,e,n){return Math.abs(t-e)<n},interpolate:function(t,e,n){return et.lerp(t,e,n)},step:function(t,e,n){this.output+=(t-e)*n}});const Cg=Eg;function Og(t){tg.call(this,t),this.addType(o.ScalarDamper)}Og.prototype=Object.assign(Object.create(tg.prototype),{constructor:Og,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.SFFloat),new z(o.inputOnly,"set_destination",new Bn.SFFloat),new z(o.initializeOnly,"initialValue",new Bn.SFFloat),new z(o.initializeOnly,"initialDestination",new Bn.SFFloat),new z(o.initializeOnly,"order",new Bn.SFInt32(3)),new z(o.inputOutput,"tau",new Bn.SFTime(.3)),new z(o.inputOutput,"tolerance",new Bn.SFFloat(-1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFFloat)]),getTypeName:function(){return"ScalarDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return 0},duplicate:function(t){return t},assign:function(t,e,n){t[e]=n},equals:function(t,e,n){return Math.abs(t-e)<n},interpolate:function(t,e,n){return et.lerp(t,e,n)}});const Fg=Og;var Ng=ug(zc);function Mg(t){zc.call(this,t),Ng.call(this,t),this.addType(o.TexCoordChaser2D)}Mg.prototype=Object.assign(Object.create(zc.prototype),Ng.prototype,{constructor:Mg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.MFVec2f),new z(o.inputOnly,"set_destination",new Bn.MFVec2f),new z(o.initializeOnly,"initialValue",new Bn.MFVec2f),new z(o.initializeOnly,"initialDestination",new Bn.MFVec2f),new z(o.initializeOnly,"duration",new Bn.SFTime(1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.MFVec2f)]),getTypeName:function(){return"TexCoordChaser2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new jt(0,0)}});const Vg=Mg;var Ig=ag(tg);function Dg(t){tg.call(this,t),Ig.call(this,t),this.addType(o.TexCoordDamper2D)}Dg.prototype=Object.assign(Object.create(tg.prototype),Ig.prototype,{constructor:Dg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_value",new Bn.MFVec2f),new z(o.inputOnly,"set_destination",new Bn.MFVec2f),new z(o.initializeOnly,"initialValue",new Bn.MFVec2f),new z(o.initializeOnly,"initialDestination",new Bn.MFVec2f),new z(o.initializeOnly,"order",new Bn.SFInt32(3)),new z(o.inputOutput,"tau",new Bn.SFTime(.3)),new z(o.inputOutput,"tolerance",new Bn.SFFloat(-1)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.MFVec2f)]),getTypeName:function(){return"TexCoordDamper2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new jt(0,0,0)}});const Rg={ColorChaser:Zp,ColorDamper:sg,CoordinateChaser:hg,CoordinateDamper:pg,OrientationChaser:Yc,OrientationDamper:xg,PositionChaser:kc,PositionChaser2D:wg,PositionDamper:Sg,PositionDamper2D:vg,ScalarChaser:Cg,ScalarDamper:Fg,TexCoordChaser2D:Vg,TexCoordDamper2D:Dg},Pg={X3DChaserNode:zc,X3DDamperNode:tg,X3DFollowerNode:Xc};for(const t in Rg)Bi.addType(t,Rg[t]);for(const t in Pg)Bi.addAbstractType(t,Pg[t]);function Ag(t){Gr.call(this,t),this.addType(o.Box),this._size.setUnit("length")}Ag.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Ag,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"size",new Bn.SFVec3f(2,2,2)),new z(o.initializeOnly,"solid",new Bn.SFBool(!0))]),getTypeName:function(){return"Box"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},build:function(){const t=new qt(2,2,2);return function(){const e=this.getBrowser().getBoxOptions().getGeometry(),n=this._size.getValue();if(this.setMultiTexCoords(e.getMultiTexCoords()),this.setNormals(e.getNormals()),n.equals(t))this.setVertices(e.getVertices()),this.getMin().assign(e.getMin()),this.getMax().assign(e.getMax());else{const t=qt.divide(n,2),i=e.getVertices().getValue(),o=this.getVertices();let r=t.x,s=t.y,a=t.z;for(let t=0,e=i.length;t<e;t+=4)o.push(r*i[t],s*i[t+1],a*i[t+2],1);r=Math.abs(r),s=Math.abs(s),a=Math.abs(a),this.getMin().set(-r,-s,-a),this.getMax().set(r,s,a)}this.setSolid(this._solid.getValue())}}()});const Lg=Ag;function Bg(t){Gr.call(this,t),this.addType(o.Cone),this._height.setUnit("length"),this._bottomRadius.setUnit("length")}Bg.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Bg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"side",new Bn.SFBool(!0)),new z(o.initializeOnly,"bottom",new Bn.SFBool(!0)),new z(o.initializeOnly,"height",new Bn.SFFloat(2)),new z(o.initializeOnly,"bottomRadius",new Bn.SFFloat(1)),new z(o.initializeOnly,"solid",new Bn.SFBool(!0))]),getTypeName:function(){return"Cone"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Gr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getConeOptions().addInterest("requestRebuild",this):this.getBrowser().getConeOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getConeOptions()._xDimension.getValue(),e=this._height.getValue(),n=this._bottomRadius.getValue(),i=this.getTexCoords(),o=this.getNormals(),r=this.getVertices();this.getMultiTexCoords().push(i);const s=e/2,a=-s,u=Wr.Polar(1,-Math.PI/2+Math.atan(n/e));if(this._side.getValue())for(let e=0;e<t;++e){const c=(e+.5)/t,l=2*Math.PI*c,h=Wr.Polar(u.imag,l),d=e/t,f=2*Math.PI*d,p=Wr.Polar(-n,f),g=Wr.Polar(u.imag,f),m=(e+1)/t,_=2*Math.PI*m,x=Wr.Polar(-n,_),y=Wr.Polar(u.imag,_);i.push(c,1,0,1),o.push(h.imag,u.real,h.real),r.push(0,s,0,1),i.push(d,0,0,1),o.push(g.imag,u.real,g.real),r.push(p.imag,a,p.real,1),i.push(m,0,0,1),o.push(y.imag,u.real,y.real),r.push(x.imag,a,x.real,1)}if(this._bottom.getValue()){const e=[],s=[];for(let i=t-1;i>-1;--i){const o=i/t,r=2*Math.PI*o,u=Wr.Polar(-1,r),c=Wr.multiply(u,n);e.push(new jt((u.imag+1)/2,(u.real+1)/2)),s.push(new qt(c.imag,a,c.real))}const u=e[0],c=s[0];for(let t=1,n=s.length-1;t<n;++t){const n=e[t],a=e[t+1],l=s[t],h=s[t+1];i.push(u.x,u.y,0,1),o.push(0,-1,0),r.push(c.x,c.y,c.z,1),i.push(n.x,n.y,0,1),o.push(0,-1,0),r.push(l.x,l.y,l.z,1),i.push(a.x,a.y,0,1),o.push(0,-1,0),r.push(h.x,h.y,h.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents:function(){const t=this._bottomRadius.getValue(),e=this._height.getValue()/2,n=-e;this._side.getValue()||this._bottom.getValue()?this._side.getValue()?(this.getMin().set(-t,n,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,n,-t),this.getMax().set(t,n,t)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}});const Xg=Bg;function Ug(t){Gr.call(this,t),this.addType(o.Cylinder),this._height.setUnit("length"),this._radius.setUnit("length")}Ug.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Ug,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"top",new Bn.SFBool(!0)),new z(o.initializeOnly,"side",new Bn.SFBool(!0)),new z(o.initializeOnly,"bottom",new Bn.SFBool(!0)),new z(o.initializeOnly,"height",new Bn.SFFloat(2)),new z(o.initializeOnly,"radius",new Bn.SFFloat(1)),new z(o.initializeOnly,"solid",new Bn.SFBool(!0))]),getTypeName:function(){return"Cylinder"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Gr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getCylinderOptions().addInterest("requestRebuild",this):this.getBrowser().getCylinderOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getCylinderOptions()._xDimension.getValue(),e=this.getTexCoords(),n=this.getNormals(),i=this.getVertices();this.getMultiTexCoords().push(e);const o=this._radius.getValue(),r=this._height.getValue()/2,s=-r;if(this._side.getValue())for(let a=0;a<t;++a){const u=a/t,c=2*Math.PI*u,l=Wr.Polar(-1,c),h=Wr.multiply(l,o),d=(a+1)/t,f=2*Math.PI*d,p=Wr.Polar(-1,f),g=Wr.multiply(p,o);e.push(u,1,0,1),n.push(l.imag,0,l.real),i.push(h.imag,r,h.real,1),e.push(u,0,0,1),n.push(l.imag,0,l.real),i.push(h.imag,s,h.real,1),e.push(d,0,0,1),n.push(p.imag,0,p.real),i.push(g.imag,s,g.real,1),e.push(u,1,0,1),n.push(l.imag,0,l.real),i.push(h.imag,r,h.real,1),e.push(d,0,0,1),n.push(p.imag,0,p.real),i.push(g.imag,s,g.real,1),e.push(d,1,0,1),n.push(p.imag,0,p.real),i.push(g.imag,r,g.real,1)}if(this._top.getValue()){const s=[],a=[];for(let e=0;e<t;++e){const n=e/t,i=2*Math.PI*n,u=Wr.Polar(-1,i);s.push(new jt((u.imag+1)/2,-(u.real-1)/2)),a.push(new qt(u.imag*o,r,u.real*o))}const u=s[0],c=a[0];for(let t=1,o=a.length-1;t<o;++t){const o=s[t],r=s[t+1],l=a[t],h=a[t+1];e.push(u.x,u.y,0,1),n.push(0,1,0),i.push(c.x,c.y,c.z,1),e.push(o.x,o.y,0,1),n.push(0,1,0),i.push(l.x,l.y,l.z,1),e.push(r.x,r.y,0,1),n.push(0,1,0),i.push(h.x,h.y,h.z,1)}}if(this._bottom.getValue()){const r=[],a=[];for(let e=t-1;e>-1;--e){const n=e/t,i=2*Math.PI*n,u=Wr.Polar(-1,i);r.push(new jt((u.imag+1)/2,(u.real+1)/2)),a.push(new qt(u.imag*o,s,u.real*o))}const u=r[0],c=a[0];for(let t=1,o=a.length-1;t<o;++t){const o=r[t],s=r[t+1],l=a[t],h=a[t+1];e.push(u.x,u.y,0,1),n.push(0,-1,0),i.push(c.x,c.y,c.z,1),e.push(o.x,o.y,0,1),n.push(0,-1,0),i.push(l.x,l.y,l.z,1),e.push(s.x,s.y,0,1),n.push(0,-1,0),i.push(h.x,h.y,h.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents:function(){const t=this._radius.getValue(),e=this._height.getValue()/2,n=-e;this._top.getValue()||this._side.getValue()||this._bottom.getValue()?this._top.getValue()||this._side.getValue()?this._bottom.getValue()||this._side.getValue()?(this.getMin().set(-t,n,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,e,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,n,-t),this.getMax().set(t,n,t)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}});const zg=Ug;function jg(t){Gr.call(this,t),this.addType(o.ElevationGrid),this._xSpacing.setUnit("length"),this._zSpacing.setUnit("length"),this._creaseAngle.setUnit("angle"),this._height.setUnit("length"),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}jg.prototype=Object.assign(Object.create(Gr.prototype),{constructor:jg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_height",new Bn.MFFloat),new z(o.initializeOnly,"xDimension",new Bn.SFInt32),new z(o.initializeOnly,"zDimension",new Bn.SFInt32),new z(o.initializeOnly,"xSpacing",new Bn.SFFloat(1)),new z(o.initializeOnly,"zSpacing",new Bn.SFFloat(1)),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"creaseAngle",new Bn.SFFloat),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.initializeOnly,"height",new Bn.MFFloat)]),getTypeName:function(){return"ElevationGrid"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Gr.prototype.initialize.call(this),this._set_height.addFieldInterest(this._height),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=mr(o.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=mr(o.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=mr(o.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_texCoord__:function(){this.texCoordNode&&this.texCoordNode.removeInterest("requestRebuild",this),this.texCoordNode=mr(o.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode&&this.texCoordNode.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=mr(o.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getHeight:function(t){return t<this._height.length?this._height[t]:0},createTexCoords:function(){const t=[],e=this._xDimension.getValue(),n=this._zDimension.getValue(),i=e-1,o=n-1;for(let r=0;r<n;++r)for(let n=0;n<e;++n)t.push(new jt(n/i,r/o));return t},createNormals:function(t,e,n){const i=!this._ccw.getValue(),o=[],r=[];for(let e=0,n=t.length;e<n;++e)o[e]=[];for(let n=0,s=e.length;n<s;n+=3){const s=e[n],a=e[n+1],u=e[n+2];o[s].push(r.length),o[a].push(r.length+1),o[u].push(r.length+2);const c=Ho.normal(t[s],t[a],t[u],new qt(0,0,0));i&&c.negate(),r.push(c),r.push(c),r.push(c)}return this.refineNormals(o,r,this._creaseAngle.getValue())},createCoordIndex:function(){const t=[],e=this._xDimension.getValue(),n=e-1,i=this._zDimension.getValue()-1;for(let o=0;o<i;++o)for(let i=0;i<n;++i){const n=o*e+i,r=(o+1)*e+i,s=(o+1)*e+(i+1),a=o*e+(i+1);t.push(n),t.push(r),t.push(s),t.push(n),t.push(s),t.push(a)}return t},createPoints:function(){const t=[],e=this._xDimension.getValue(),n=this._zDimension.getValue(),i=this._xSpacing.getValue(),o=this._zSpacing.getValue();for(let r=0;r<n;++r)for(let n=0;n<e;++n)t.push(new qt(i*n,this.getHeight(n+r*e),o*r));return t},build:function(){if(this._xDimension.getValue()<2||this._zDimension.getValue()<2)return;const t=this._colorPerVertex.getValue(),e=this._normalPerVertex.getValue(),n=this.createCoordIndex(),i=this.getAttrib(),o=i.length,r=this.getAttribs(),s=this.fogCoordNode,a=this.getColor(),u=this.getTexCoord(),c=this.getNormal(),l=this.createPoints(),h=this.getFogDepths(),d=this.getColors(),f=this.getMultiTexCoords(),p=this.getNormals(),g=this.getVertices();let m=0;if(u)u.init(f);else{var _=this.createTexCoords(),x=this.getTexCoords();f.push(x)}for(let y=0,w=n.length;y<w;++m)for(let w=0;w<6;++w,++y){const w=n[y],T=l[w];for(let t=0;t<o;++t)i[t].addValue(w,r[t]);if(s&&s.addDepth(w,h),a&&(t?a.addColor(w,d):a.addColor(m,d)),u)u.addTexCoord(w,f);else{const t=_[w];x.push(t.x,t.y,0,1)}c&&(e?c.addVector(w,p):c.addVector(m,p)),g.push(T.x,T.y,T.z,1)}if(!c){const t=this.createNormals(l,n);for(const e of t)p.push(e.x,e.y,e.z)}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}});const kg=jg;function Gg(t){Gr.call(this,t),this.addType(o.Extrusion),this._creaseAngle.setUnit("angle"),this._crossSection.setUnit("length"),this._spine.setUnit("length")}Gg.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Gg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_crossSection",new Bn.MFVec2f),new z(o.inputOnly,"set_orientation",new Bn.MFRotation),new z(o.inputOnly,"set_scale",new Bn.MFVec2f),new z(o.inputOnly,"set_spine",new Bn.MFVec3f),new z(o.initializeOnly,"beginCap",new Bn.SFBool(!0)),new z(o.initializeOnly,"endCap",new Bn.SFBool(!0)),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"convex",new Bn.SFBool(!0)),new z(o.initializeOnly,"creaseAngle",new Bn.SFFloat),new z(o.initializeOnly,"crossSection",new Bn.MFVec2f(new jt(1,1),new jt(1,-1),new jt(-1,-1),new jt(-1,1),new jt(1,1))),new z(o.initializeOnly,"orientation",new Bn.MFRotation(new Ce)),new z(o.initializeOnly,"scale",new Bn.MFVec2f(new jt(1,1))),new z(o.initializeOnly,"spine",new Bn.MFVec3f(new qt(0,0,0),new qt(0,1,0)))]),getTypeName:function(){return"Extrusion"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Gr.prototype.initialize.call(this),this._set_crossSection.addFieldInterest(this._crossSection),this._set_orientation.addFieldInterest(this._orientation),this._set_scale.addFieldInterest(this._scale),this._set_spine.addFieldInterest(this._spine)},getClosedOrientation:function(){const t=this._orientation;if(t.length){const e=t[0].getValue(),n=t[t.length-1].getValue();return e.equals(n)}return!0},createPoints:function(){const t=new qt(1,1,1);return function(){const e=this._crossSection,n=this._orientation,i=this._scale,o=this._spine,r=[],s=this.createRotations();for(let a=0,u=o.length;a<u;++a){const o=s[a];if(n.length&&o.rotate(n[Math.min(a,n.length-1)].getValue()),i.length){const e=i[Math.min(a,i.length-1)].getValue();o.scale(t.set(e.x,1,e.y))}for(let t=0,n=e.length;t<n;++t){const n=e[t].getValue();r.push(o.multVecMatrix(new qt(n.x,0,n.y)))}}return r}}(),createRotations:function(){const t=[],e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0),o=new qt(0,0,0),r=new qt(0,0,0),s=new qt(0,0,0),a=new Ce(0,0,1,0);return function(){const u=this._spine,c=u.length,l=u[0].getValue(),h=u[u.length-1].getValue(),d=l.equals(h)&&this.getClosedOrientation();for(let e=t.length;e<c;++e)t[e]=new Ne;if(t.length=c,e.set(0,0,0),n.set(0,0,0),i.set(0,0,0),d){const t=l;for(let e=1,i=c-2;e<i&&(n.assign(u[e].getValue()).subtract(t).normalize().subtract(s.assign(u[i].getValue()).subtract(t).normalize()).normalize(),n.equals(qt.Zero));++e);for(let t=0,e=c-2;t<e&&(i.assign(u[t+1].getValue()).subtract(u[t].getValue()).cross(s.assign(u[e].getValue()).subtract(u[t].getValue())).normalize(),i.equals(qt.Zero));++t);}else{for(let t=0,e=c-1;t<e&&(n.assign(u[t+1].getValue()).subtract(u[t].getValue()).normalize(),n.equals(qt.Zero));++t);for(let t=1,e=c-1;t<e&&(i.assign(u[t+1].getValue()).subtract(u[t].getValue()).cross(s.assign(u[t-1].getValue()).subtract(u[t].getValue())).normalize(),i.equals(qt.Zero));++t);}n.equals(qt.Zero)&&n.set(0,1,0),i.equals(qt.Zero)&&a.setFromToVec(qt.yAxis,n).multVecRot(i.assign(qt.zAxis)),e.assign(n).cross(i);const f=l;t[0].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,f.x,f.y,f.z,1),o.assign(n),r.assign(i);for(let a=1,l=c-1;a<l;++a){const c=u[a].getValue();n.assign(u[a+1].getValue()).subtract(c).normalize().subtract(s.assign(u[a-1].getValue()).subtract(c).normalize()).normalize(),i.assign(u[a+1].getValue()).subtract(c).cross(s.assign(u[a-1].getValue()).subtract(c)).normalize(),r.dot(i)<0&&i.negate(),n.equals(qt.Zero)?n.assign(o):o.assign(n),i.equals(qt.Zero)?i.assign(r):r.assign(i),e.assign(n).cross(i),t[a].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,c.x,c.y,c.z,1)}if(d)t[c-1].assign(t[0]);else{const a=h;n.assign(a).subtract(u[c-2].getValue()).normalize(),c>2&&i.assign(a).subtract(u[c-2].getValue()).cross(s.assign(u[c-3].getValue()).subtract(u[c-2].getValue())).normalize(),r.dot(i)<0&&i.negate(),n.equals(qt.Zero)&&n.assign(o),i.equals(qt.Zero)&&i.assign(r),e.assign(n).cross(i),t[c-1].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,a.x,a.y,a.z,1)}return t}}(),build:function(){const t=new jt(0,0,0),e=new jt(0,0,0),n=new jt(0,0,0);return function(){const i=!this._ccw.getValue(),o=this._crossSection,r=this._spine,s=r.length,a=this.getTexCoords();if(s<2||o.length<2)return;this.getMultiTexCoords().push(a);const u=o.length;function c(t,e){return t*u+e}const l=r[0].getValue(),h=r[s-1].getValue(),d=l.equals(h)&&this.getClosedOrientation(),f=o[0].getValue(),p=o[o.length-1].getValue(),g=f.equals(p);t.assign(o[0].getValue()),e.assign(o[0].getValue());for(let n=1,i=o.length;n<i;++n)t.min(o[n].getValue()),e.max(o[n].getValue());const m=n.assign(e).subtract(t),_=Math.max(m.x,m.y),x=g?o.length-1:o.length,y=[],w=[],T=this.createPoints();for(let t=0,e=T.length;t<e;++t)y[t]=[];const S=this.getNormals(),b=this.getVertices(),v=o.length-1,E=s-1;let C=c(0,0),O=c(0,g?0:v);for(let t=0;t<E;++t)for(let e=0;e<v;++e){const n=d&&t===s-2?0:t+1,r=g&&e===o.length-2?0:e+1;let u=c(t,e),l=c(t,r),h=c(n,r),f=c(n,e),p=T[u],m=T[l],_=T[h],x=T[f],S=m.distance(_)>=1e-7,M=x.distance(p)>=1e-7;if(i)var F=Ho.normal(_,m,p,new qt(0,0,0)),N=Ho.normal(x,_,p,new qt(0,0,0));else F=Ho.normal(p,m,_,new qt(0,0,0)),N=Ho.normal(p,_,x,new qt(0,0,0));if(0==e&&(M?C=u:(u=C,p=T[u])),e==o.length-2&&(S?O=l:(h=O,_=T[h])),S){if(M)a.push(e/v,t/E,0,1);else{const n=(t/E+(t+1)/E)/2;a.push(e/v,n,0,1)}y[u].push(w.length),w.push(F),b.push(p.x,p.y,p.z,1),a.push((e+1)/v,t/E,0,1),y[l].push(w.length),w.push(F),b.push(m.x,m.y,m.z,1),a.push((e+1)/v,(t+1)/E,0,1),y[h].push(w.length),w.push(F),b.push(_.x,_.y,_.z,1)}if(M){if(a.push(e/v,t/E,0,1),y[u].push(w.length),w.push(N),b.push(p.x,p.y,p.z,1),S)a.push((e+1)/v,(t+1)/E,0,1);else{const n=((t+1)/E+t/E)/2;a.push((e+1)/v,n,0,1)}y[h].push(w.length),w.push(N),b.push(_.x,_.y,_.z,1),a.push(e/v,(t+1)/E,0,1),y[f].push(w.length),w.push(N),b.push(x.x,x.y,x.z,1)}}const M=this.refineNormals(y,w,this._creaseAngle.getValue());for(const t of M)S.push(t.x,t.y,t.z);if(_&&x>2){if(this._beginCap.getValue()){const e=0,n=[],r=[];for(let i=0;i<x;++i){const r=c(e,x-1-i),s=T[r].copy();s.index=r,s.texCoord=jt.subtract(o[x-1-i].getValue(),t).divide(_),n.push(s)}if(this._convex.getValue()?Ho.triangulateConvexPolygon(n,r):Ho.triangulatePolygon(n,r),r.length>=3){const t=Ho.normal(T[r[0].index],T[r[1].index],T[r[2].index],new qt(0,0,0));i&&t.negate(),this.addCap(a,t,T,r)}}if(this._endCap.getValue()){const e=s-1,n=[],r=[];for(let i=0;i<x;++i){const r=c(e,i),s=T[r].copy();s.index=r,s.texCoord=jt.subtract(o[i].getValue(),t).divide(_),n.push(s)}if(this._convex.getValue()?Ho.triangulateConvexPolygon(n,r):Ho.triangulatePolygon(n,r),r.length>=3){const t=Ho.normal(T[r[0].index],T[r[1].index],T[r[2].index],new qt(0,0,0));i&&t.negate(),this.addCap(a,t,T,r)}}}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}(),addCap:function(t,e,n,i){const o=this.getNormals(),r=this.getVertices();for(let s=0,a=i.length;s<a;s+=3){const a=n[i[s].index],u=n[i[s+1].index],c=n[i[s+2].index],l=i[s].texCoord,h=i[s+1].texCoord,d=i[s+2].texCoord;t.push(l.x,l.y,0,1),t.push(h.x,h.y,0,1),t.push(d.x,d.y,0,1),o.push(e.x,e.y,e.z,e.x,e.y,e.z,e.x,e.y,e.z),r.push(a.x,a.y,a.z,1,u.x,u.y,u.z,1,c.x,c.y,c.z,1)}}});const Hg=Gg;function qg(t){Gr.call(this,t),this.addType(o.Sphere),this._radius.setUnit("length")}qg.prototype=Object.assign(Object.create(Gr.prototype),{constructor:qg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"radius",new Bn.SFFloat(1)),new z(o.initializeOnly,"solid",new Bn.SFBool(!0))]),getTypeName:function(){return"Sphere"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Gr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getSphereOptions().addInterest("requestRebuild",this):this.getBrowser().getSphereOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getSphereOptions().getGeometry(),e=Math.abs(this._radius.getValue());if(this.setMultiTexCoords(t.getMultiTexCoords()),this.setNormals(t.getNormals()),1===e)this.setVertices(t.getVertices()),this.getMin().assign(t.getMin()),this.getMax().assign(t.getMax());else{const n=t.getVertices().getValue(),i=this.getVertices();for(let t=0,o=n.length;t<o;t+=4)i.push(e*n[t],e*n[t+1],e*n[t+2],1);this.getMin().set(-e,-e,-e),this.getMax().set(e,e,e)}this.setSolid(this._solid.getValue())}});const Yg={Box:Lg,Cone:Xg,Cylinder:zg,ElevationGrid:kg,Extrusion:Hg,IndexedFaceSet:Vu,Sphere:qg},Wg={};for(const t in Yg)Bi.addType(t,Yg[t]);for(const t in Wg)Bi.addAbstractType(t,Wg[t]);function $g(t){gr.call(this,t),xr.call(this,t),this.addType(o.StaticGroup),this.group=new Ls(this.getExecutionContext()),this.collisionShapes=null,this.shadowShapes=null,this.opaqueShapes=null,this.transparentShapes=null,this.bbox=new ur,this.shadowBBox=new ur}$g.prototype=Object.assign(Object.create(gr.prototype),xr.prototype,{constructor:$g,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.initializeOnly,"children",new Bn.MFNode)]),getTypeName:function(){return"StaticGroup"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},initialize:function(){gr.prototype.initialize.call(this),xr.prototype.initialize.call(this),this._bboxSize.addFieldInterest(this.group._bboxSize),this._bboxCenter.addFieldInterest(this.group._bboxCenter),this._children.addFieldInterest(this.group._children),this.group._bboxSize=this._bboxSize,this.group._bboxCenter=this._bboxCenter,this.group._children=this._children,this.group.setPrivate(!0),this.group.setup(),this.group._isCameraObject.addFieldInterest(this._isCameraObject),this.group._isPickableObject.addFieldInterest(this._isPickableObject),this.group._children.addInterest("set_children__",this),this.setCameraObject(this.group.getCameraObject()),this.setPickableObject(this.group.getPickableObject()),this.set_children__()},getBBox:function(t,e){return t.assign(e?this.shadowBBox:this.bbox)},set_children__:function(){this.group.getBBox(this.bbox),this.group.getBBox(this.shadowBBox,!0),this.collisionShapes=null,this.shadowShapes=null,this.opaqueShapes=null,this.transparentShapes=null},traverse:function(){const t=new Jo;return t.intersectsSphere=function(){return!0},function(e,n){switch(e){case ir.CAMERA:return;case ir.POINTER:case ir.COLLISION:{if(!this.collisionShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumCollisionShapes();i.push(t.set(r,o,o)),s.push(),s.identity(),this.group.traverse(e,n),s.pop(),i.pop();const u=n.getNumCollisionShapes();this.collisionShapes=n.getCollisionShapes().splice(a,u-a),n.setNumCollisionShapes(a)}const i=n.getModelViewMatrix();for(const t of this.collisionShapes)i.push(),i.multLeft(t.modelViewMatrix),t.shapeNode.traverse(e,n),i.pop();return}case ir.SHADOW:{if(!this.shadowShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumShadowShapes();i.push(t.set(r,o,o)),s.push(),s.identity(),this.group.traverse(e,n),s.pop(),i.pop();const u=n.getNumShadowShapes();this.shadowShapes=n.getShadowShapes().splice(a,u-a),n.setNumShadowShapes(a)}const i=n.getModelViewMatrix();for(const t of this.shadowShapes)i.push(),i.multLeft(t.modelViewMatrix),t.shapeNode.traverse(e,n),i.pop();return}case ir.DISPLAY:{if(!this.opaqueShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumOpaqueShapes(),u=n.getNumTransparentShapes();i.push(t.set(r,o,o)),s.push(),s.identity(),this.group.traverse(e,n),s.pop(),i.pop();const c=n.getNumOpaqueShapes(),l=n.getNumTransparentShapes();this.opaqueShapes=n.getOpaqueShapes().splice(a,c-a),this.transparentShapes=n.getTransparentShapes().splice(u,l-u),n.setNumOpaqueShapes(a),n.setNumTransparentShapes(u)}const i=n.getModelViewMatrix();for(const t of this.opaqueShapes)i.push(),i.multLeft(t.modelViewMatrix),t.shapeNode.traverse(e,n),i.pop();for(const t of this.transparentShapes)i.push(),i.multLeft(t.modelViewMatrix),t.shapeNode.traverse(e,n),i.pop();return}}}}()});const Kg=$g;function Qg(t){Tr.call(this,t),this.addType(o.Switch),"2.0"===t.getSpecificationVersion()&&this.addAlias("choice",this._children),this.childNode=null,this.visibleNode=null,this.boundedObject=null}Qg.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Qg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"whichChoice",new Bn.SFInt32(-1)),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Switch"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},initialize:function(){Tr.prototype.initialize.call(this),this._whichChoice.addInterest("set_child__",this),this._children.addInterest("set_child__",this),this.set_child__()},getSubBBox:function(t,e){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=mr(o.X3DBoundedObject,this.visibleNode);return n?n.getBBox(t,e):t.set()}return t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear:function(){},add:function(){},remove:function(){},set_child__:function(){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),mr(o.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this));const t=this._whichChoice.getValue();t>=0&&t<this._children.length?(this.childNode=mr(o.X3DChildNode,this._children[t]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),mr(o.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)),delete this.traverse)):(this.childNode=null,this.traverse=Function.prototype),this.set_transformSensors__(),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.childNode&&this.childNode.getCameraObject()?mr(o.X3DBoundedObject,this.childNode)?this.setCameraObject(this.childNode._visible.getValue()):this.setCameraObject(!0):this.setCameraObject(!1)},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.childNode&&this.childNode.getPickableObject()))},set_visible__:function(){mr(o.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__()},set_bboxDisplay__:function(){mr(o.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},traverse:function(t,e){switch(t){case ir.POINTER:case ir.CAMERA:case ir.SHADOW:{const n=this.visibleNode;return void(n&&n.traverse(t,e))}case ir.PICKING:{if(this.getTransformSensors().size){const t=e.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}const n=this.childNode;if(n){const i=this.getBrowser().getPickingHierarchy();i.push(this),n.traverse(t,e),i.pop()}return}case ir.COLLISION:{const n=this.childNode;return void(n&&n.traverse(t,e))}case ir.DISPLAY:{const n=this.visibleNode;n&&n.traverse(t,e);const i=this.boundedObject;return void(i&&i.displayBBox(t,e))}}}});const Zg=Qg;function Jg(t){Tr.call(this,t),this.addType(o.X3DTransformMatrix3DNode),this.matrix=new Ne,this.getBBox=this.getGetGroupBBox(),this.traverse=this.getGroupTraverse()}Jg.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Jg,setMatrix:function(t){t.equals(Ne.Identity)?(this.matrix.identity(),this.getBBox=this.getGetGroupBBox(),this.traverse=this.getGroupTraverse()):(this.matrix.assign(t),this.getBBox=this.getGetBBox(),this.traverse=this.getTraverse())},getMatrix:function(){return this.matrix},setTransform:function(t,e,n,i,o){t.equals(qt.Zero)&&e.equals(Ce.Identity)&&n.equals(qt.One)?(this.matrix.identity(),this.getBBox=this.getGetGroupBBox(),this.traverse=this.getGroupTraverse()):(this.matrix.set(t,e,n,i,o),this.getBBox=this.getGetBBox(),this.traverse=this.getTraverse())},getGetBBox:function(){function t(t,e){return this.getSubBBox(t,e).multRight(this.matrix)}return function(){return t}}(),getGetGroupBBox:function(){return Tr.prototype.getBBox},getTraverse:function(){function t(t,e){const n=e.getModelViewMatrix();n.push(),n.multLeft(this.matrix),Tr.prototype.traverse.call(this,t,e),n.pop()}return function(){return t}}(),getGroupTraverse:function(){return Tr.prototype.traverse}});const tm=Jg;function em(t){tm.call(this,t),this.addType(o.X3DTransformNode),this._translation.setUnit("length"),this._center.setUnit("length")}em.prototype=Object.assign(Object.create(tm.prototype),{constructor:em,initialize:function(){tm.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed:function(){this.setTransform(this._translation.getValue(),this._rotation.getValue(),this._scale.getValue(),this._scaleOrientation.getValue(),this._center.getValue())}});const nm=em;function im(t){nm.call(this,t),this.addType(o.Transform)}im.prototype=Object.assign(Object.create(nm.prototype),{constructor:im,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"translation",new Bn.SFVec3f),new z(o.inputOutput,"rotation",new Bn.SFRotation),new z(o.inputOutput,"scale",new Bn.SFVec3f(1,1,1)),new z(o.inputOutput,"scaleOrientation",new Bn.SFRotation),new z(o.inputOutput,"center",new Bn.SFVec3f),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Transform"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"}});const om={Group:Ls,StaticGroup:Kg,Switch:Zg,Transform:im},rm={X3DBoundedObject:xr,X3DGroupingNode:Tr,X3DTransformMatrix3DNode:tm,X3DTransformNode:nm};for(const t in om)Bi.addType(t,om[t]);for(const t in rm)Bi.addAbstractType(t,rm[t]);function sm(t){bs.call(this,t),this.addType(o.ColorInterpolator),this.hsv=[]}sm.prototype=Object.assign(Object.create(bs.prototype),{constructor:sm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFColor),new z(o.outputOnly,"value_changed",new Bn.SFColor)]),getTypeName:function(){return"ColorInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._keyValue;t.length<this._key.length&&this._keyValue.resize(this._key.length,t.length?t[this._keyValue.length-1]:new Bn.SFColor),this.hsv.length=0;for(const e of t)this.hsv.push(e.getHSV([]))},interpolate:function(){const t=[];return function(e,n,i){lt.lerp(this.hsv[e],this.hsv[n],i,t),this._value_changed.setHSV(t[0],t[1],t[2])}}()});const am=sm;function um(t){bs.call(this,t),this.addType(o.CoordinateInterpolator)}um.prototype=Object.assign(Object.create(bs.prototype),{constructor:um,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFVec3f),new z(o.outputOnly,"value_changed",new Bn.MFVec3f)]),getTypeName:function(){return"CoordinateInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},set_keyValue__:function(){},interpolate:function(t,e,n){const i=this._keyValue.getValue();let o=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const r=this._value_changed.getValue();e=(t*=o)+(this._key.length>1?o:0),t*=3,e*=3,o*=3;for(let s=0;s<o;s+=3){const o=s+1,a=s+2;r[s]=et.lerp(i[t+s],i[e+s],n),r[o]=et.lerp(i[t+o],i[e+o],n),r[a]=et.lerp(i[t+a],i[e+a],n)}this._value_changed.addEvent()}});const cm=um;function lm(t){bs.call(this,t),this.addType(o.CoordinateInterpolator2D)}lm.prototype=Object.assign(Object.create(bs.prototype),{constructor:lm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFVec2f),new z(o.outputOnly,"value_changed",new Bn.MFVec2f)]),getTypeName:function(){return"CoordinateInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},set_keyValue__:function(){},interpolate:function(t,e,n){const i=this._keyValue.getValue();let o=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const r=this._value_changed.getValue();e=(t*=o)+(this._key.length>1?o:0),t*=2,e*=2,o*=2;for(let s=0;s<o;s+=2){const o=s+1;r[s]=et.lerp(i[t+s],i[e+s],n),r[o]=et.lerp(i[t+o],i[e+o],n)}this._value_changed.addEvent()}});const hm=lm;function dm(t){bs.call(this,t),this.addType(o.NormalInterpolator)}dm.prototype=Object.assign(Object.create(bs.prototype),{constructor:dm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFVec3f),new z(o.outputOnly,"value_changed",new Bn.MFVec3f)]),getTypeName:function(){return"NormalInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){},interpolate:function(){const t=new qt(0,0,0),e=new qt(0,0,0);return function(n,i,o){const r=this._keyValue.getValue();let s=this._key.length>1?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=s;const a=this._value_changed.getValue();i=(n*=s)+s,n*=3,i*=3,s*=3;for(let u=0;u<s;u+=3)try{const s=u+1,c=u+2;t.set(r[n+u],r[n+s],r[n+c]),e.set(r[i+u],r[i+s],r[i+c]);const l=et.simpleSlerp(t,e,o);a[u]=l[0],a[s]=l[1],a[c]=l[2]}catch(t){}this._value_changed.addEvent()}}()});const fm=dm;function pm(t){bs.call(this,t),this.addType(o.PositionInterpolator2D)}pm.prototype=Object.assign(Object.create(bs.prototype),{constructor:pm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFVec2f),new z(o.outputOnly,"value_changed",new Bn.SFVec2f)]),getTypeName:function(){return"PositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Bn.SFVec2f)},interpolate:function(){const t=new jt(0,0);return function(e,n,i){this._value_changed=t.assign(this._keyValue[e].getValue()).lerp(this._keyValue[n].getValue(),i)}}()});const gm=pm,mm=[],_m=[],xm=[],ym=new ae(0,0,0,0),wm=new Ne(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0);function Tm(){this.T0=[],this.T1=[]}Tm.prototype={constructor:Tm,generate:function(t,e,n,i,o){const r=this.T0,s=this.T1;if(r.length=0,s.length=0,mm.length=0,_m.length=0,xm.length=0,e.length>1){if(0===i.length){t?mm.push(this.divide(this.subtract(n[1],n[n.length-2]),2)):mm.push(this.create());for(let t=1,e=n.length-1;t<e;++t)mm.push(this.divide(this.subtract(n[t+1],n[t-1]),2));mm.push(this.copy(mm[0]))}else{for(let t=0,e=i.length;t<e;++t)mm.push(this.copy(i[t]));if(o){let t=0;for(let e=0,i=n.length-1;e<i;++e)t+=this.abs(this.subtract(n[e],n[e+1]));for(let e=0,n=mm.length-1;e<n;++e){const n=this.abs(mm[e]);n&&(mm[e]=this.multiply(mm[e],t/n))}}}if(t){const t=e.length-1,n=e.length-2,i=e[1]-e[0]+e[t]-e[n];xm.push(2*(e[1]-e[0])/i),_m.push(2*(e[t]-e[n])/i)}else xm.push(1),_m.push(1);for(let t=1,n=e.length-1;t<n;++t){const n=e[t+1]-e[t-1];xm.push(2*(e[t+1]-e[t])/n),_m.push(2*(e[t]-e[t-1])/n)}xm.push(xm[0]),_m.push(_m[0]);for(let t=0,e=mm.length;t<e;++t)r.push(this.multiply(mm[t],_m[t])),s.push(this.multiply(mm[t],xm[t]))}else r.push(this.create()),s.push(this.create())},interpolate:function(t,e,n,i){return ym.set(Math.pow(n,3),Math.pow(n,2),n,1),this.dot(wm.multVecMatrix(ym),i[t],i[e],this.T0[t],this.T1[e])}};const Sm=Tm;function bm(t){const e=new t(0,0,0,0),n=new t(0,0,0,0),i=new t(0,0,0,0),o=new t(0,0,0,0);function r(){this.T0=[],this.T1=[]}return r.prototype=Object.assign(Object.create(Sm.prototype),{constructor:r,create:function(){return new t(0,0,0,0)},copy:function(t){return t.copy()},subtract:function(e,n){return t.subtract(e,n)},multiply:function(e,n){return t.multiply(e,n)},divide:function(e,n){return t.divide(e,n)},abs:function(t){return t.magnitude()},dot:function(t,r,s,a,u){return e.assign(r).multiply(t[0]),n.assign(s).multiply(t[1]),i.assign(a).multiply(t[2]),o.assign(u).multiply(t[3]),e.add(n).add(i).add(o)}}),r}const vm=bm(qt);function Em(t){bs.call(this,t),this.addType(o.SplinePositionInterpolator),this.spline=new vm}Em.prototype=Object.assign(Object.create(bs.prototype),{constructor:Em,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"closed",new Bn.SFBool),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFVec3f),new z(o.inputOutput,"keyVelocity",new Bn.MFVec3f),new z(o.inputOutput,"normalizeVelocity",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFVec3f)]),getTypeName:function(){return"SplinePositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Bn.SFVec3f),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Bn.SFVec3f),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const Cm=Em,Om=bm(jt);function Fm(t){bs.call(this,t),this.addType(o.SplinePositionInterpolator2D),this.spline=new Om}Fm.prototype=Object.assign(Object.create(bs.prototype),{constructor:Fm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"closed",new Bn.SFBool),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFVec2f),new z(o.inputOutput,"keyVelocity",new Bn.MFVec2f),new z(o.inputOutput,"normalizeVelocity",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFVec2f)]),getTypeName:function(){return"SplinePositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Bn.SFVec2f),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Bn.SFVec2f),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const Nm=Fm;function Mm(){this.T0=[],this.T1=[]}Mm.prototype=Object.assign(Object.create(Sm.prototype),{constructor:Mm,create:function(){return 0},copy:function(t){return t},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e},abs:function(t){return Math.abs(t)},dot:function(t,e,n,i,o){return e*t[0]+n*t[1]+i*t[2]+o*t[3]}});const Vm=Mm;function Im(t){bs.call(this,t),this.addType(o.SplineScalarInterpolator),this.spline=new Vm}Im.prototype=Object.assign(Object.create(bs.prototype),{constructor:Im,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"closed",new Bn.SFBool),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFFloat),new z(o.inputOutput,"keyVelocity",new Bn.MFFloat),new z(o.inputOutput,"normalizeVelocity",new Bn.SFBool),new z(o.outputOnly,"value_changed",new Bn.SFFloat)]),getTypeName:function(){return"SplineScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Bn.SFFloat),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Bn.SFFloat),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const Dm=Im,Rm=new Ce(0,0,1,0);function Pm(){this.s=[]}Pm.prototype={constructor:Pm,generate:function(t,e,n){const i=this.s;if(i.length=0,e.length>1){t?i.push(Ce.spline(n[e.length-2].getValue(),n[0].getValue(),n[1].getValue())):i.push(n[0].getValue());for(let t=1,o=e.length-1;t<o;++t)i.push(Ce.spline(n[t-1].getValue(),n[t].getValue(),n[t+1].getValue()));t?i.push(Ce.spline(n[e.length-2].getValue(),n[e.length-1].getValue(),n[1].getValue())):i.push(n[e.length-1].getValue())}else e.length>0&&i.push(n[0].getValue().copy())},interpolate:function(t,e,n,i){return Rm.assign(i[t].getValue()).squad(this.s[t],this.s[e],i[e].getValue(),n)}};const Am=Pm;function Lm(t){bs.call(this,t),this.addType(o.SquadOrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle"),this.squad=new Am}Lm.prototype=Object.assign(Object.create(bs.prototype),{constructor:Lm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_fraction",new Bn.SFFloat),new z(o.inputOutput,"closed",new Bn.SFBool),new z(o.inputOutput,"key",new Bn.MFFloat),new z(o.inputOutput,"keyValue",new Bn.MFRotation),new z(o.outputOnly,"value_changed",new Bn.SFRotation)]),getTypeName:function(){return"SquadOrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){bs.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Bn.SFRotation),this.squad.generate(this._closed.getValue(),this._key,this._keyValue)},interpolate:function(t,e,n){try{this._value_changed=this.squad.interpolate(t,e,n,this._keyValue)}catch(t){console.error(t)}}});const Bm={ColorInterpolator:am,CoordinateInterpolator:cm,CoordinateInterpolator2D:hm,EaseInEaseOut:Es,NormalInterpolator:fm,OrientationInterpolator:Ns,PositionInterpolator:Os,PositionInterpolator2D:gm,ScalarInterpolator:Ds,SplinePositionInterpolator:Cm,SplinePositionInterpolator2D:Nm,SplineScalarInterpolator:Dm,SquadOrientationInterpolator:Lm},Xm={X3DInterpolatorNode:bs};for(const t in Bm)Bi.addType(t,Bm[t]);for(const t in Xm)Bi.addAbstractType(t,Xm[t]);const Um={Layer:Xs,LayerSet:zs,Viewport:Cc},zm={X3DLayerNode:gs,X3DViewportNode:br};for(const t in Um)Bi.addType(t,Um[t]);for(const t in zm)Bi.addAbstractType(t,zm[t]);const jm=[(new Ne).setRotation(new Ce(new qt(1,0,0),qt.zAxis)),(new Ne).setRotation(new Ce(new qt(-1,0,0),qt.zAxis)),(new Ne).setRotation(new Ce(new qt(0,0,-1),qt.zAxis)),(new Ne).setRotation(new Ce(new qt(0,0,1),qt.zAxis)),(new Ne).setRotation(new Ce(new qt(0,1,0),qt.zAxis)),(new Ne).setRotation(new Ce(new qt(0,-1,0),qt.zAxis))],km=[new ae(0,.5,.25,.5),new ae(.5,.5,.25,.5),new ae(.75,.5,.25,.5),new ae(.25,.5,.25,.5),new ae(0,0,.5,.5),new ae(.5,0,.5,.5)],Gm=Dr(Hm);function Hm(){this.location=new qt(0,0,0),this.matrixArray=new Float32Array(9),this.shadowBuffer=null,this.viewVolume=new Jo,this.viewport=new ae(0,0,0,0),this.projectionMatrix=new Ne,this.modelViewMatrix=new cr(Ne),this.modelMatrix=new Ne,this.invLightSpaceMatrix=new Ne,this.invLightSpaceProjectionMatrix=new Ne,this.shadowMatrix=new Ne,this.shadowMatrixArray=new Float32Array(16),this.rotation=new Ce,this.rotationMatrix=new Ne,this.textureUnit=void 0}function qm(t){yl.call(this,t),this.addType(o.PointLight),this._location.setUnit("length"),this._radius.setUnit("length")}Hm.prototype={constructor:Hm,getModelViewMatrix:function(){return this.modelViewMatrix},set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(e.getGlobal()?i:Ne.Identity);o.translate(e.getLocation()),o.inverse();const r=e.getShadowMapSize();this.shadowBuffer.bind();for(let e=0;e<6;++e){const n=km[e],i=this.viewport.set(n[0]*r,n[1]*r,n[2]*r,n[3]*r),s=sr.perspective2(et.radians(90),.125,1e4,i[2],i[3],this.projectionMatrix);t.getViewVolumes().push(this.viewVolume.set(s,i,i)),t.getProjectionMatrix().pushMatrix(this.projectionMatrix),t.getModelViewMatrix().pushMatrix(jm[e]),t.getModelViewMatrix().multLeft(o),t.render(ir.SHADOW,Tr.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop()}this.shadowBuffer.unbind(),e.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o)},setGlobalVariables:function(t){this.modelViewMatrix.get().multVecMatrix(this.location.assign(this.lightNode._location.getValue())),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=i.getAttenuation(),s=this.location;if(t.uniform1i(e.x3d_LightType[n],2),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),t.uniform3f(e.x3d_LightLocation[n],s.x,s.y,s.z),t.uniform1f(e.x3d_LightRadius[n],i.getRadius()),t.uniformMatrix3fv(e.x3d_LightMatrix[n],!1,this.matrixArray),this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Gm.push(this)}},qm.prototype=Object.assign(Object.create(yl.prototype),{constructor:qm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"global",new Bn.SFBool(!0)),new z(o.inputOutput,"on",new Bn.SFBool(!0)),new z(o.inputOutput,"color",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"intensity",new Bn.SFFloat(1)),new z(o.inputOutput,"ambientIntensity",new Bn.SFFloat),new z(o.inputOutput,"attenuation",new Bn.SFVec3f(1,0,0)),new z(o.inputOutput,"location",new Bn.SFVec3f),new z(o.inputOutput,"radius",new Bn.SFFloat(100)),new z(o.inputOutput,"shadows",new Bn.SFBool),new z(o.inputOutput,"shadowColor",new Bn.SFColor),new z(o.inputOutput,"shadowIntensity",new Bn.SFFloat(1)),new z(o.inputOutput,"shadowBias",new Bn.SFFloat(.005)),new z(o.initializeOnly,"shadowMapSize",new Bn.SFInt32(1024))]),getTypeName:function(){return"PointLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getAttenuation:function(){return this._attenuation.getValue()},getLocation:function(){return this._location.getValue()},getRadius:function(){return Math.max(0,this._radius.getValue())},getLights:function(){return Gm}});const Ym=qm,Wm=Dr($m);function $m(){this.location=new qt(0,0,0),this.direction=new qt(0,0,0),this.matrixArray=new Float32Array(9),this.renderShadow=!0,this.shadowBuffer=null,this.bbox=new ur,this.viewVolume=new Jo,this.viewport=new ae(0,0,0,0),this.projectionMatrix=new Ne,this.modelViewMatrix=new cr(Ne),this.modelMatrix=new Ne,this.invLightSpaceMatrix=new Ne,this.invLightSpaceProjectionMatrix=new Ne,this.shadowMatrix=new Ne,this.shadowMatrixArray=new Float32Array(16),this.rotation=new Ce,this.lightBBoxMin=new qt(0,0,0),this.lightBBoxMax=new qt(0,0,0),this.textureUnit=void 0}function Km(t){switch(yl.call(this,t),this.addType(o.SpotLight),t.getSpecificationVersion()){case"2.0":case"3.0":case"3.1":case"3.2":this._beamWidth=1.5708,this._cutOffAngle=.785398}this._location.setUnit("length"),this._radius.setUnit("length"),this._beamWidth.setUnit("angle"),this._cutOffAngle.setUnit("angle")}$m.prototype={constructor:$m,getModelViewMatrix:function(){return this.modelViewMatrix},set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(e.getGlobal()?i:Ne.Identity);o.translate(e.getLocation()),o.rotate(this.rotation.setFromToVec(qt.zAxis,this.direction.assign(e.getDirection()).negate())),o.inverse();this.groupNode.getSubBBox(this.bbox,!0).multRight(o).getExtents(this.lightBBoxMin,this.lightBBoxMax);const r=e.getShadowMapSize(),s=Math.min(e.getRadius(),-this.lightBBoxMin.z),a=this.viewport.set(0,0,r,r),u=sr.perspective(2*e.getCutOffAngle(),.125,Math.max(1e4,s),r,r,this.projectionMatrix);this.renderShadow=s>0,this.shadowBuffer.bind(),t.getViewVolumes().push(this.viewVolume.set(u,a,a)),t.getProjectionMatrix().pushMatrix(u),t.getModelViewMatrix().pushMatrix(o),t.render(ir.SHADOW,Tr.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop(),this.shadowBuffer.unbind(),e.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o).multRight(u).multRight(e.getBiasMatrix())},setGlobalVariables:function(t){const e=this.lightNode,n=this.modelViewMatrix.get();n.multVecMatrix(this.location.assign(e._location.getValue())),n.multDirMatrix(this.direction.assign(e._direction.getValue())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=i.getAttenuation(),s=this.location,a=this.direction;if(t.uniform1i(e.x3d_LightType[n],3),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),t.uniform3f(e.x3d_LightLocation[n],s.x,s.y,s.z),t.uniform3f(e.x3d_LightDirection[n],a.x,a.y,a.z),t.uniform1f(e.x3d_LightRadius[n],i.getRadius()),t.uniform1f(e.x3d_LightBeamWidth[n],i.getBeamWidth()),t.uniform1f(e.x3d_LightCutOffAngle[n],i.getCutOffAngle()),t.uniformMatrix3fv(e.x3d_LightMatrix[n],!1,this.matrixArray),this.renderShadow&&this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Wm.push(this)}},Km.prototype=Object.assign(Object.create(yl.prototype),{constructor:Km,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"global",new Bn.SFBool(!0)),new z(o.inputOutput,"on",new Bn.SFBool(!0)),new z(o.inputOutput,"color",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"intensity",new Bn.SFFloat(1)),new z(o.inputOutput,"ambientIntensity",new Bn.SFFloat),new z(o.inputOutput,"attenuation",new Bn.SFVec3f(1,0,0)),new z(o.inputOutput,"location",new Bn.SFVec3f),new z(o.inputOutput,"direction",new Bn.SFVec3f(0,0,-1)),new z(o.inputOutput,"radius",new Bn.SFFloat(100)),new z(o.inputOutput,"beamWidth",new Bn.SFFloat(.785398)),new z(o.inputOutput,"cutOffAngle",new Bn.SFFloat(1.5708)),new z(o.inputOutput,"shadows",new Bn.SFBool),new z(o.inputOutput,"shadowColor",new Bn.SFColor),new z(o.inputOutput,"shadowIntensity",new Bn.SFFloat(1)),new z(o.inputOutput,"shadowBias",new Bn.SFFloat(.005)),new z(o.initializeOnly,"shadowMapSize",new Bn.SFInt32(1024))]),getTypeName:function(){return"SpotLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getAttenuation:function(){return this._attenuation.getValue()},getLocation:function(){return this._location.getValue()},getRadius:function(){return Math.max(0,this._radius.getValue())},getBeamWidth:function(){const t=this._beamWidth.getValue(),e=this.getCutOffAngle();return t>e?e:et.clamp(t,0,Math.PI/2)},getCutOffAngle:function(){return et.clamp(this._cutOffAngle.getValue(),0,Math.PI/2)},getLights:function(){return Wm}});const Qm={DirectionalLight:bl,PointLight:Ym,SpotLight:Km},Zm={X3DLightNode:yl};for(const t in Qm)Bi.addType(t,Qm[t]);for(const t in Zm)Bi.addAbstractType(t,Zm[t]);function Jm(t){Tr.call(this,t),this.addType(o.Billboard),this.matrix=new Ne}Jm.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Jm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"axisOfRotation",new Bn.SFVec3f(0,1,0)),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Billboard"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getBBox:function(t,e){return Tr.prototype.getBBox.call(this,t,e).multRight(this.matrix)},getMatrix:function(){return this.matrix},rotate:function(){const t=new Ne,e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0),o=new qt(0,0,0),r=new Ce(0,0,1,0);return function(s){t.assign(s).inverse();const a=t.origin.normalize();if(this._axisOfRotation.getValue().equals(qt.Zero)){t.multDirMatrix(e.assign(qt.yAxis)).normalize();const i=e.cross(a);n.assign(a).cross(i);const o=a;i.normalize(),n.normalize(),this.matrix.set(i.x,i.y,i.z,0,n.x,n.y,n.z,0,o.x,o.y,o.z,0,0,0,0,1)}else i.assign(this._axisOfRotation.getValue()).cross(a),o.assign(this._axisOfRotation.getValue()).cross(qt.zAxis),this.matrix.setRotation(r.setFromToVec(o,i));return this.matrix}}(),traverse:function(t,e){const n=e.getModelViewMatrix();switch(n.push(),t){case ir.CAMERA:case ir.PICKING:case ir.SHADOW:n.multLeft(this.matrix);break;default:n.multLeft(this.rotate(n.get()))}Tr.prototype.traverse.call(this,t,e),n.pop()}});const t_=Jm;function e_(t){Tr.call(this,t),_s.call(this,t),this.addType(o.Collision),"2.0"===t.getSpecificationVersion()&&this.addAlias("collide",this._enabled)}e_.prototype=Object.assign(Object.create(Tr.prototype),_s.prototype,{constructor:e_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"collideTime",new Bn.SFTime),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.initializeOnly,"proxy",new Bn.SFNode),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Collision"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Tr.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._proxy.addInterest("set_proxy__",this),this.set_live__(),this.set_proxy__()},set_live__:function(){this.isLive().getValue()&&this._enabled.getValue()?this.getBrowser().addCollision(this):this.getBrowser().removeCollision(this)},set_active:function(t){this._isActive.getValue()!==t&&(this._isActive=t,t&&(this._collideTime=this.getBrowser().getCurrentTime()))},set_proxy__:function(){this.proxyNode=mr(o.X3DChildNode,this._proxy)},traverse:function(t,e){if(t!==ir.COLLISION)Tr.prototype.traverse.call(this,t,e);else if(this._enabled.getValue()){const n=e.getCollisions();n.push(this),this.proxyNode?this.proxyNode.traverse(t,e):Tr.prototype.traverse.call(this,t,e),n.pop()}}});const n_=e_;function i_(t){Tr.call(this,t),this.addType(o.LOD),"2.0"===t.getSpecificationVersion()&&this.addAlias("level",this._children),this._center.setUnit("length"),this._range.setUnit("length"),this.frameRate=60,this.keepCurrentLevel=!1,this.childNode=null,this.visibleNode=null,this.boundedObject=null}i_.prototype=Object.assign(Object.create(Tr.prototype),{constructor:i_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"forceTransitions",new Bn.SFBool),new z(o.initializeOnly,"center",new Bn.SFVec3f),new z(o.initializeOnly,"range",new Bn.MFFloat),new z(o.outputOnly,"level_changed",new Bn.SFInt32(-1)),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"LOD"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Tr.prototype.initialize.call(this),this._children.addInterest("set_child__",this)},getSubBBox:function(t,e){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=mr(o.X3DBoundedObject,this.visibleNode);return n?n.getBBox(t,e):t.set()}return t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear:function(){},add:function(){},remove:function(){},set_child__:function(){this.set_level__(Math.min(this._level_changed.getValue(),this._children.length-1))},set_level__:function(t){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),mr(o.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this)),t>=0&&t<this._children.length?(this.childNode=mr(o.X3DChildNode,this._children[t]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),mr(o.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)))):this.childNode=null,this.set_transformSensors__(),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.childNode&&this.childNode.getCameraObject()?mr(o.X3DBoundedObject,this.childNode)?this.setCameraObject(this.childNode._visible.getValue()):this.setCameraObject(!0):this.setCameraObject(!1)},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.childNode&&this.childNode.getPickableObject()))},set_visible__:function(){mr(o.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__()},set_bboxDisplay__:function(){mr(o.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},getLevel:function(t,e){if(0===this._range.length){this.frameRate=(179*this.frameRate+t.currentFrameRate)/180;const e=this._children.length;switch(e){case 0:return-1;case 1:return 0;case 2:return+(this.frameRate>55);default:{const t=1-et.clamp((this.frameRate-20)/35,0,1);return Math.min(Math.floor(t*e),e-1)}}}const n=e.translate(this._center.getValue()).origin.magnitude();return et.upperBound(this._range,0,this._range.length,n)},traverse:function(){const t=new Ne;return function(e,n){switch(e){case ir.POINTER:case ir.CAMERA:case ir.SHADOW:{const t=this.visibleNode;return void(t&&t.traverse(e,n))}case ir.PICKING:{if(this.getTransformSensors().size){const t=n.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}const t=this.childNode;if(t){const i=this.getBrowser().getPickingHierarchy();i.push(this),t.traverse(e,n),i.pop()}return}case ir.COLLISION:{const t=this.childNode;return void(t&&t.traverse(e,n))}case ir.DISPLAY:{if(!this.keepCurrentLevel){let e=this.getLevel(this.getBrowser(),t.assign(n.getModelViewMatrix().get())),i=this._level_changed.getValue();this._forceTransitions.getValue()&&(e>i?e=i+1:e<i&&(e=i-1)),e!==i&&(this._level_changed=e,this.set_level__(Math.min(e,this._children.length-1)))}const i=this.visibleNode;i&&i.traverse(e,n);const o=this.boundedObject;return void(o&&o.displayBBox(e,n))}}}}()});const o_=i_;function r_(t){gr.call(this,t),this.addType(o.ViewpointGroup),this._size.setUnit("length"),this._center.setUnit("length"),this.proximitySensor=new Xp(t),this.cameraObjects=[],this.viewpointGroups=[]}function s_(t,e){switch(t){case ir.CAMERA:if(this.proximitySensor.traverse(t,e),this.proximitySensor._isActive.getValue())for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(t,e);return;case ir.DISPLAY:if(this.proximitySensor.traverse(t,e),this.proximitySensor._isActive.getValue())for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(t,e);return}}function a_(t,e){switch(t){case ir.CAMERA:for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(t,e);return;case ir.DISPLAY:for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(t,e);return}}r_.prototype=Object.assign(Object.create(gr.prototype),{constructor:r_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"displayed",new Bn.SFBool(!0)),new z(o.inputOutput,"retainUserOffsets",new Bn.SFBool),new z(o.inputOutput,"size",new Bn.SFVec3f),new z(o.inputOutput,"center",new Bn.SFVec3f),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"ViewpointGroup"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){gr.prototype.initialize.call(this),this.proximitySensor.setup(),this._size.addFieldInterest(this.proximitySensor._size),this._center.addFieldInterest(this.proximitySensor._center),this.proximitySensor._size=this._size,this.proximitySensor._center=this._center,this._displayed.addInterest("set_displayed__",this),this._size.addInterest("set_displayed__",this),this._children.addInterest("set_children__",this),this.set_displayed__(),this.set_children__()},isActive:function(){return this.proximitySensor._isActive.getValue()},set_displayed__:function(){var t=!this._size.getValue().equals(qt.Zero),e=this._displayed.getValue();this.proximitySensor._enabled=e&&t,e&&t?(this.proximitySensor._isCameraObject.addFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.addFieldInterest(this._isPickableObject),this.setCameraObject(this.proximitySensor.getCameraObject()),this.setPickableObject(this.proximitySensor.getPickableObject()),this.traverse=s_):(this.proximitySensor._isCameraObject.removeFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.removeFieldInterest(this._isPickableObject),this.setCameraObject(e),this.setPickableObject(!1),e?this.traverse=a_:delete this.traverse)},set_children__:function(){this.cameraObjects.length=0,this.viewpointGroups.length=0;for(var t=this._children,e=0,n=t.length;e<n;++e)try{for(var i=t[e].getValue().getInnerNode(),r=i.getType(),s=r.length-1;s>=0;--s)switch(r[s]){case o.X3DViewpointNode:this.cameraObjects.push(i);break;case o.ViewpointGroup:this.cameraObjects.push(i),this.viewpointGroups.push(i)}}catch(t){}},traverse:function(){}});const u_={Billboard:t_,Collision:n_,LOD:o_,NavigationInfo:Ir,OrthoViewpoint:Pc,Viewpoint:Ps,ViewpointGroup:r_},c_={X3DViewpointNode:Vs};for(const t in u_)Bi.addType(t,u_[t]);for(const t in c_)Bi.addAbstractType(t,c_[t]);function l_(t,e,n,i){this.node=null,this.modelViewMatrix=new Ne,this.projectionMatrix=new Ne,this.viewport=new ae(0,0,0,0),this.set(t,e,n,i)}l_.prototype={set:function(t,e,n,i){this.node=t,this.modelViewMatrix.assign(e),this.projectionMatrix.assign(n),this.viewport.assign(i)},set_over__:function(t,e){this.node.set_over__(t,e,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_active__:function(t,e){this.node.set_active__(t,e,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_motion__:function(t){this.node.set_motion__(t,this.modelViewMatrix,this.projectionMatrix,this.viewport)}};const h_=l_;function d_(t){_s.call(this,t),this.addType(o.X3DPointingDeviceSensorNode)}d_.prototype=Object.assign(Object.create(_s.prototype),{constructor:d_,initialize:function(){_s.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this)},getMatrices:function(){return this.matrices},set_enabled__:function(){this._enabled.getValue()||(this._isActive.getValue()&&(this._isActive=!1),this._isOver.getValue()&&(this._isOver=!1))},set_over__:function(t,e){t!==this._isOver.getValue()&&(this._isOver=t,t&&(this.getBrowser().getNotification()._string=this._description))},set_active__:function(t,e){t!==this._isActive.getValue()&&(this._isActive=t)},set_motion__:function(t){},push:function(t,e){this._enabled.getValue()&&e.set(this,new h_(this,t.getModelViewMatrix().get(),t.getProjectionMatrix().get(),t.getViewVolume().getViewport()))}});const f_=d_;function p_(t){f_.call(this,t),this.addType(o.X3DTouchSensorNode)}p_.prototype=Object.assign(Object.create(f_.prototype),{constructor:p_,set_active__:function(t,e){f_.prototype.set_active__.call(this,t,e),this._enabled.getValue()&&this._isOver.getValue()&&!t&&(this._touchTime=this.getBrowser().getCurrentTime())}});const g_=p_;var m_=new Ne;function __(t){g_.call(this,t),this.addType(o.TouchSensor),this._hitPoint_changed.setUnit("length")}__.prototype=Object.assign(Object.create(g_.prototype),{constructor:__,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.outputOnly,"hitTexCoord_changed",new Bn.SFVec2f),new z(o.outputOnly,"hitNormal_changed",new Bn.SFVec3f),new z(o.outputOnly,"hitPoint_changed",new Bn.SFVec3f),new z(o.outputOnly,"isOver",new Bn.SFBool),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"touchTime",new Bn.SFTime)]),getTypeName:function(){return"TouchSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},set_over__:function(t,e,n,i,o){if(g_.prototype.set_over__.call(this,t,e,n,i,o),this._isOver.getValue()){var r=e.intersection;m_.assign(n).inverse(),this._hitTexCoord_changed=r.texCoord,this._hitNormal_changed=n.multMatrixDir(r.normal.copy()).normalize(),this._hitPoint_changed=m_.multVecMatrix(r.point.copy())}}});const x_=__;function y_(t){Tr.call(this,t),xo.call(this,t),this.addType(o.Anchor),this.touchSensorNode=new x_(t),this.anchorSensors=new Map}y_.prototype=Object.assign(Object.create(Tr.prototype),xo.prototype,{constructor:y_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"load",new Bn.SFBool(!0)),new z(o.inputOutput,"url",new Bn.MFString),new z(o.inputOutput,"parameter",new Bn.MFString),new z(o.inputOutput,"autoRefresh",new Bn.SFTime),new z(o.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f),new z(o.inputOnly,"addChildren",new Bn.MFNode),new z(o.inputOnly,"removeChildren",new Bn.MFNode),new z(o.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Anchor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){Tr.prototype.initialize.call(this),xo.prototype.initialize.call(this),this._description.addFieldInterest(this.touchSensorNode._description),this._load.addFieldInterest(this.touchSensorNode._enabled),this.touchSensorNode._description=this._description,this.touchSensorNode._enabled=this._load,this.touchSensorNode.setup();const t=this,e=this.touchSensorNode.set_active__;this.touchSensorNode.set_active__=function(n,i){e.call(this,n,i),this._isOver.getValue()&&!n&&t.requestImmediateLoad()}},set_load__:function(){},set_url__:function(){},requestImmediateLoad:function(t=!0){this.setCache(t),this.setLoadState(o.IN_PROGRESS_STATE,!1),new Qs(this).createX3DFromURL(this._url,this._parameter,function(t){t?(this.getBrowser().replaceWorld(t),this.setLoadState(o.COMPLETE_STATE,!1)):this.setLoadState(o.FAILED_STATE,!1)}.bind(this),function(t){this.getBrowser().changeViewpoint(t),this.setLoadState(o.COMPLETE_STATE,!1)}.bind(this),function(t,e){e?window.open(t,e):location=t,this.setLoadState(o.COMPLETE_STATE,!1)}.bind(this))},requestUnload(){},traverse:function(t,e){if(t===ir.POINTER){const n=this.getBrowser().getSensors(),i=this.anchorSensors;i.clear(),this.touchSensorNode.push(e,i),i.size?(n.push(i),Tr.prototype.traverse.call(this,t,e),n.pop()):Tr.prototype.traverse.call(this,t,e)}else Tr.prototype.traverse.call(this,t,e)}});const w_=y_;function T_(t){gr.call(this,t),xo.call(this,t),xr.call(this,t),this.addType(o.Inline),this.scene=this.getBrowser().getDefaultScene(),this.group=new Ls(t),this.group.addParent(this)}T_.prototype=Object.assign(Object.create(gr.prototype),xo.prototype,xr.prototype,{constructor:T_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"load",new Bn.SFBool(!0)),new z(o.inputOutput,"url",new Bn.MFString),new z(o.inputOutput,"autoRefresh",new Bn.SFTime),new z(o.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new z(o.inputOutput,"visible",new Bn.SFBool(!0)),new z(o.inputOutput,"bboxDisplay",new Bn.SFBool),new z(o.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new z(o.initializeOnly,"bboxCenter",new Bn.SFVec3f)]),getTypeName:function(){return"Inline"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){gr.prototype.initialize.call(this),xo.prototype.initialize.call(this),xr.prototype.initialize.call(this),this.group.setPrivate(!0),this.group.setup(),this.group._isCameraObject.addFieldInterest(this._isCameraObject),this.group._isPickableObject.addFieldInterest(this._isPickableObject),this.requestImmediateLoad()},getBBox:function(t,e){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.group.getBBox(t,e):t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},set_live__:function(){xo.prototype.set_live__.call(this),this.isPrivate()||this.scene.setLive(this.isLive().getValue())},unLoadNow:function(){this.setInternalScene(this.getBrowser().getDefaultScene())},loadNow:function(){new Qs(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},setInternalSceneAsync:function(t){t?(this.setLoadState(o.COMPLETE_STATE),this.setInternalScene(t)):(this.setLoadState(o.FAILED_STATE),this.setInternalScene(this.getBrowser().getDefaultScene()))},setInternalScene:function(t){this.scene.setLive(!1),this.scene.rootNodes.removeFieldInterest(this.group._children),this.scene=t,this.scene.setExecutionContext(this.getExecutionContext()),this.scene.setPrivate(this.getExecutionContext().isPrivate()),this.scene.rootNodes.addFieldInterest(this.group._children),this.group._children=this.scene.rootNodes,this.set_live__(),this.getBrowser().addBrowserEvent()},getInternalScene:function(){return this.scene},traverse:function(t,e){if(t===ir.PICKING){const n=this.getBrowser().getPickingHierarchy();return n.push(this),this.group.traverse(t,e),void n.pop()}this.group.traverse(t,e)}});const S_={Anchor:w_,Inline:T_,LoadSensor:Mh},b_={X3DNetworkSensorNode:Fh,X3DUrlObject:xo};for(const t in S_)Bi.addType(t,S_[t]);for(const t in b_)Bi.addAbstractType(t,b_[t]);function v_(t){f_.call(this,t),this.addType(o.X3DDragSensorNode),this._trackPoint_changed.setUnit("length")}v_.prototype=Object.assign(Object.create(f_.prototype),{constructor:v_});const E_=v_;function C_(t,e){this.axis=t.copy(),this.radius=e}C_.prototype={constructor:C_,intersectsLine:function(t,e,n){const i=new Ce(this.axis.direction,new qt(0,1,0)),o=Ne.Rotation(i),r=1/this.radius,s=new Ne;s.scale(new qt(r,r,r)),s.multLeft(o);const a=qt.subtract(t.point,this.axis.point),u=new sc(a,t.direction).multLineMatrix(s),c=this.unitCylinderIntersectsLine(u,e,n);if(c){const t=s.inverse();t.multVecMatrix(e),e.add(this.axis.point),t.multVecMatrix(n),n.add(this.axis.point)}return c},unitCylinderIntersectsLine:function(t,e,n){let i,o;const r=t.point,s=t.direction,a=s[0]*s[0]+s[2]*s[2],u=2*(r[0]*s[0]+r[2]*s[2]),c=r[0]*r[0]+r[2]*r[2]-1,l=u*u-4*a*c;if(l<0)return!1;const h=Math.sqrt(l);return u>0?(i=-2*c/(h+u),o=-(h+u)/(2*a)):(i=2*c/(h-u),o=(h-u)/(2*a)),e.assign(s).multiply(i).add(r),n.assign(s).multiply(o).add(r),!0},toString:function(){return this.axis.toString()+" "+this.radius}};const O_=C_;function F_(t){E_.call(this,t),this.addType(o.CylinderSensor),this._diskAngle.setUnit("angle"),this._minAngle.setUnit("angle"),this._maxAngle.setUnit("angle"),this._offset.setUnit("angle")}F_.prototype=Object.assign(Object.create(E_.prototype),{constructor:F_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"axisRotation",new Bn.SFRotation),new z(o.inputOutput,"diskAngle",new Bn.SFFloat(.261792)),new z(o.inputOutput,"minAngle",new Bn.SFFloat),new z(o.inputOutput,"maxAngle",new Bn.SFFloat(-1)),new z(o.inputOutput,"offset",new Bn.SFFloat),new z(o.inputOutput,"autoOffset",new Bn.SFBool(!0)),new z(o.outputOnly,"trackPoint_changed",new Bn.SFVec3f),new z(o.outputOnly,"rotation_changed",new Bn.SFRotation),new z(o.outputOnly,"isOver",new Bn.SFBool),new z(o.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"CylinderSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){E_.prototype.initialize.call(this),this.modelViewMatrix=new Ne,this.invModelViewMatrix=new Ne,this.cylinder=new O_(new sc(new qt(0,0,0),new qt(0,0,0)),0),this.disk=!1,this.yPlane=null,this.zPlane=null,this.sxPlane=null,this.szNormal=null,this.behind=!1,this.fromVector=new qt(0,0,0),this.startOffset=new Ce(0,0,1,0)},isBehind:function(t,e){const n=new qt(0,0,0),i=new qt(0,0,0);return this.cylinder.intersectsLine(t,n,i),qt.subtract(e,n).magnitude()>qt.subtract(e,i).magnitude()},getTrackPoint:function(t,e){const n=new qt(0,0,0);this.zPlane.intersectsLine(t,n);const i=qt.add(n,this.cylinder.axis.getPerpendicularVectorToPoint(n,new qt(0,0,0))),o=this.sxPlane.getDistanceToPoint(n)/this.cylinder.radius,r=Math.floor((o+1)/2),s=et.interval(o,-1,1),a=(0===r?Math.asin(s):s*Math.PI/2)+r*Math.PI;new Ce(this.cylinder.axis.direction,a).multVecRot(e.assign(this.szNormal).multiply(this.cylinder.radius)),e.add(i)},getAngle:function(t){return qt.dot(t.getAxis(),this.cylinder.axis.direction)>0?t.angle:-t.angle},set_active__:function(t,e,n,i,o){if(E_.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=this.invModelViewMatrix.multVecMatrix(e.intersection.point.copy()),o=this._axisRotation.getValue().multVecRot(new qt(0,1,0)),r=this.invModelViewMatrix.multDirMatrix(new qt(0,0,1)).normalize(),s=new sc(new qt(0,0,0),o),a=s.getPerpendicularVectorToPoint(i,new qt(0,0,0)).magnitude();this.cylinder=new O_(s,a),this.disk=Math.abs(qt.dot(r,o))>Math.cos(this._diskAngle.getValue()),this.behind=this.isBehind(t,i),this.yPlane=new Go(i,o),this.zPlane=new Go(i,r);const u=this.invModelViewMatrix.origin,c=qt.cross(o,u).normalize();this.sxPlane=new Go(new qt(0,0,0),c),this.szNormal=qt.cross(c,o).normalize();const l=new qt(0,0,0);this.disk?this.yPlane.intersectsLine(t,l):this.getTrackPoint(t,l),this.fromVector=this.cylinder.axis.getPerpendicularVectorToPoint(l,new qt(0,0,0)).negate(),this.startOffset=new Ce(o,this._offset.getValue()),this._trackPoint_changed=l,this._rotation_changed=this.startOffset,this.angle=this._offset.getValue(),this.startVector=this._rotation_changed.getValue().multVecRot(this._axisRotation.getValue().multVecRot(new qt(0,0,1)))}else this._autoOffset.getValue()&&(this._offset=this.getAngle(this._rotation_changed.getValue()))},set_motion__:function(t){const e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new qt(0,0,0);this.disk?this.yPlane.intersectsLine(e,n):this.getTrackPoint(e,n),this._trackPoint_changed=n;const i=this.cylinder.axis.getPerpendicularVectorToPoint(n,new qt(0,0,0)).negate(),o=new Ce(this.fromVector,i);if(this.disk){this.modelViewMatrix.multVecMatrix(n.copy()).z>0&&o.multRight(new Ce(this.yPlane.normal,Math.PI))}else this.behind&&o.inverse();if(o.multLeft(this.startOffset),this._minAngle.getValue()>this._maxAngle.getValue())this._rotation_changed=o;else{const t=o.multVecRot(this._axisRotation.getValue().multVecRot(new qt(0,0,1))),e=new Ce(this.startVector,t),n=this._axisRotation.getValue().multVecRot(new qt(0,1,0)).dot(e.getAxis())>0?1:-1,i=this._minAngle.getValue(),r=this._maxAngle.getValue();this.angle+=n*e.angle,this.startVector.assign(t),this.angle<i?o.setAxisAngle(this.cylinder.axis.direction,i):this.angle>r?o.setAxisAngle(this.cylinder.axis.direction,r):o.setAxisAngle(this.cylinder.axis.direction,this.angle),this._rotation_changed.getValue().equals(o)||(this._rotation_changed=o)}}});const N_=F_,M_=new dc(jt.Zero,jt.Zero),V_=new jt(0,0,0),I_=new sc(qt.Zero,qt.Zero);function D_(t){E_.call(this,t),this.addType(o.PlaneSensor),this._offset.setUnit("length"),this._minPosition.setUnit("length"),this._maxPosition.setUnit("length"),this._translation_changed.setUnit("length")}D_.prototype=Object.assign(Object.create(E_.prototype),{constructor:D_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"axisRotation",new Bn.SFRotation),new z(o.inputOutput,"autoOffset",new Bn.SFBool(!0)),new z(o.inputOutput,"offset",new Bn.SFVec3f),new z(o.inputOutput,"minPosition",new Bn.SFVec2f),new z(o.inputOutput,"maxPosition",new Bn.SFVec2f(-1,-1)),new z(o.outputOnly,"trackPoint_changed",new Bn.SFVec3f),new z(o.outputOnly,"translation_changed",new Bn.SFVec3f),new z(o.outputOnly,"isOver",new Bn.SFBool),new z(o.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"PlaneSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){E_.prototype.initialize.call(this),this.modelViewMatrix=new Ne,this.invModelViewMatrix=new Ne,this.projectionMatrix=new Ne,this.viewport=new ae,this.planeSensor=!0,this.plane=null,this.line=null,this.startOffset=new qt(0,0,0),this.startPoint=new qt(0,0,0)},getLineTrackPoint:function(t,e,n){return Jo.projectLine(e,this.modelViewMatrix,this.projectionMatrix,this.viewport,M_),M_.getClosestPointToPoint(t.pointer,V_),Jo.unProjectRay(V_.x,V_.y,this.modelViewMatrix,this.projectionMatrix,this.viewport,I_),e.getClosestPointToLine(I_,n)},set_active__:function(t,e,n,i,o){if(E_.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.projectionMatrix.assign(i),this.viewport.assign(o),this.invModelViewMatrix.assign(n).inverse();var r=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),s=this.invModelViewMatrix.multVecMatrix(e.intersection.point.copy()),a=this._axisRotation.getValue();if(this._minPosition.x===this._maxPosition.x){this.planeSensor=!1;var u=a.multVecRot(new qt(0,Math.abs(this._maxPosition.y-this._minPosition.y),0));this.line=new sc(s,u.normalize())}else if(this._minPosition.y===this._maxPosition.y){this.planeSensor=!1;u=a.multVecRot(new qt(Math.abs(this._maxPosition.x-this._minPosition.x),0,0));this.line=new sc(s,u.normalize())}else this.planeSensor=!0,this.plane=new Go(s,a.multVecRot(new qt(0,0,1)));if(this.planeSensor)this.plane.intersectsLine(r,this.startPoint)&&this.trackStart(this.startPoint);else if(this.getLineTrackPoint(e,this.line,this.startPoint)){var c=new qt(0,0,0);try{this.getLineTrackPoint(e,new sc(this.line.direction,this.line.direction),c)}catch(t){c=this.startPoint}this.trackStart(c)}}else this._autoOffset.getValue()&&(this._offset=this._translation_changed)},trackStart:function(t){this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=t,this._translation_changed=this._offset.getValue()},set_motion__:function(t){try{if(this.planeSensor){var e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new qt(0,0,0);if(!this.plane.intersectsLine(e,n))throw new Error("Plane and line are parallel.");this.track(n,n.copy())}else{n=new qt(0,0,0);var i=new qt(0,0,0);if(!this.getLineTrackPoint(t,this.line,n))throw new Error("Lines are parallel.");try{this.getLineTrackPoint(t,new sc(qt.Zero,this.line.direction),i)}catch(t){i.assign(n)}this.track(n,i)}}catch(t){this._trackPoint_changed.addEvent(),this._translation_changed.addEvent()}},track:function(t,e){var n=this._axisRotation.getValue(),i=Ce.inverse(n).multVecRot(t.add(this.startOffset).subtract(this.startPoint));this._minPosition.x>this._maxPosition.x||(i.x=et.clamp(i.x,this._minPosition.x,this._maxPosition.x)),this._minPosition.y>this._maxPosition.y||(i.y=et.clamp(i.y,this._minPosition.y,this._maxPosition.y)),n.multVecRot(i),this._trackPoint_changed.getValue().equals(e)||(this._trackPoint_changed=e),this._translation_changed.getValue().equals(i)||(this._translation_changed=i)}});const R_=D_;function P_(t,e){this.radius=t,this.center=e.copy()}P_.prototype={constructor:P_,set:function(t,e){this.radius=t,this.center.assign(e)},intersectsLine:function(t,e,n){const i=t.point,o=t.direction,r=this.center,s=this.radius,a=2*(i.dot(o)-r.dot(o)),u=a*a-4*(i.x*i.x+i.y*i.y+i.z*i.z+(r.x*r.x+r.y*r.y+r.z*r.z)-2*i.dot(r)-s*s);if(u>=0){let t=(-a+Math.sqrt(u))/2,r=(-a-Math.sqrt(u))/2;if(t>r){const e=t;t=r,r=e}return e.assign(o).multiply(t).add(i),n.assign(o).multiply(r).add(i),!0}return!1},intersectsTriangle:function(){const t=new qt(0,0,0),e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0),o=new qt(0,0,0),r=new qt(0,0,0),s=new qt(0,0,0);return function(a,u,c){const l=this.center,h=this.radius;a.subtract(l),u.subtract(l),c.subtract(l),t.assign(u).subtract(a),e.assign(c).subtract(a);const d=h*h,f=t.cross(e),p=qt.dot(a,f);if(p*p>d*qt.dot(f,f))return!1;const g=qt.dot(a,a),m=qt.dot(a,u),_=qt.dot(a,c),x=qt.dot(u,u),y=qt.dot(u,c),w=qt.dot(c,c);if(g>d&&m>g&&_>g||x>d&&m>x&&y>x||w>d&&_>w&&y>w)return!1;t.assign(u).subtract(a),n.assign(c).subtract(u),i.assign(a).subtract(c);const T=m-g,S=y-x,b=_-w,v=qt.dot(t,t),E=qt.dot(n,n),C=qt.dot(i,i);o.assign(a).multiply(v).subtract(t.multiply(T)),r.assign(u).multiply(E).subtract(n.multiply(S)),s.assign(c).multiply(C).subtract(i.multiply(b));const O=c.multiply(v).subtract(o),F=a.multiply(E).subtract(r),N=u.multiply(C).subtract(s),M=qt.dot(o,o)>d*v*v&&qt.dot(o,O)>0,V=qt.dot(r,r)>d*E*E&&qt.dot(r,F)>0,I=qt.dot(s,s)>d*C*C&&qt.dot(s,N)>0;return!(M||V||I)}}(),toString:function(){return this.radius+" "+this.center.toString()}};const A_=P_;function L_(t){E_.call(this,t),this.addType(o.SphereSensor)}L_.prototype=Object.assign(Object.create(E_.prototype),{constructor:L_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"autoOffset",new Bn.SFBool(!0)),new z(o.inputOutput,"offset",new Bn.SFRotation),new z(o.outputOnly,"trackPoint_changed",new Bn.SFVec3f),new z(o.outputOnly,"rotation_changed",new Bn.SFRotation),new z(o.outputOnly,"isOver",new Bn.SFBool),new z(o.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"SphereSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){E_.prototype.initialize.call(this),this.modelViewMatrix=new Ne,this.invModelViewMatrix=new Ne,this.sphere=null,this.zPlane=null,this.behind=!1,this.fromVector=new qt(0,0,0),this.startPoint=new qt(0,0,0),this.startOffset=new Ce(0,0,1,0)},getTrackPoint:function(t,e,n){var i=new qt(0,0,0);return!!this.sphere.intersectsLine(t,e,i)&&((qt.subtract(t.point,i).magnitude()<qt.subtract(t.point,e).magnitude())-n&&e.assign(i),!0)},set_active__:function(t,e,n,i,o){if(E_.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();var r=this.invModelViewMatrix.multVecMatrix(e.intersection.point.copy()),s=new qt(0,0,0);this.zPlane=new Go(s,this.invModelViewMatrix.multDirMatrix(new qt(0,0,1)).normalize()),this.sphere=new A_(r.magnitude(),s),this.behind=this.zPlane.getDistanceToPoint(r)<0,this.fromVector.assign(r),this.startPoint.assign(r),this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=r,this._rotation_changed=this._offset.getValue()}else this._autoOffset.getValue()&&(this._offset=this._rotation_changed)},set_motion__:function(t){var e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new qt(0,0,0);if(this.getTrackPoint(e,n,this.behind)){var i=this.invModelViewMatrix.multDirMatrix(new qt(0,0,1)).normalize();this.zPlane=new Go(n,i)}else{var o=new qt(0,0,0);this.zPlane.intersectsLine(e,o),e=new sc(o,qt.subtract(this.sphere.center,o).normalize()),this.getTrackPoint(e,n,!1);var r=Ho.normal(this.sphere.center,n,this.startPoint,new qt(0,0,0)),s=qt.subtract(n,this.sphere.center).normalize(),a=qt.cross(r,s).normalize(),u=qt.subtract(n,a.multiply(qt.subtract(o,n).magnitude()));e=new sc(u,qt.subtract(this.sphere.center,u).normalize()),this.getTrackPoint(e,n,!1)}this._trackPoint_changed=n;var c=qt.subtract(n,this.sphere.center),l=new Ce(this.fromVector,c);this.behind&&l.inverse(),this._rotation_changed=Ce.multRight(this.startOffset,l)}});const B_={CylinderSensor:N_,PlaneSensor:R_,SphereSensor:L_,TouchSensor:x_},X_={X3DDragSensorNode:E_,X3DPointingDeviceSensorNode:f_,X3DTouchSensorNode:g_};for(const t in B_)Bi.addType(t,B_[t]);for(const t in X_)Bi.addAbstractType(t,X_[t]);const U_=Dr(z_);function z_(){this.plane=new Go(qt.Zero,qt.Zero)}function j_(t){gr.call(this,t),this.addType(o.ClipPlane),this.enabled=!1,this.plane=new ae(0,0,0,0)}z_.prototype={constructor:z_,isClipped:function(t){return this.plane.getDistanceToPoint(t)<0},set:function(t,e){const n=this.plane,i=t.plane;n.normal.assign(i),n.distanceFromOrigin=-i.w,n.multRight(e)},setShaderUniforms:function(t,e){const n=this.plane,i=n.normal;t.uniform4f(e.x3d_ClipPlane[e.numClipPlanes++],i.x,i.y,i.z,n.distanceFromOrigin)},dispose:function(){U_.push(this)}},j_.prototype=Object.assign(Object.create(gr.prototype),{constructor:j_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"plane",new Bn.SFVec4f(0,1,0,0))]),getTypeName:function(){return"ClipPlane"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"children"},initialize:function(){gr.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._plane.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__:function(){this.plane.assign(this._plane.getValue()),this.enabled=this._enabled.getValue()&&!this.plane.equals(ae.Zero)},push:function(t){if(this.enabled){const e=U_.pop();e.set(this,t.getModelViewMatrix().get()),t.getLocalObjects().push(e),++t.getLocalObjectsCount()[0]}},pop:function(t){this.enabled&&(this.getBrowser().getLocalObjects().push(t.getLocalObjects().pop()),--t.getLocalObjectsCount()[0])}});const k_=j_;function G_(t){xc.call(this,t),this.addType(o.ColorRGBA),this.setTransparent(!0)}G_.prototype=Object.assign(Object.create(xc.prototype),{constructor:G_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.MFColorRGBA)]),getTypeName:function(){return"ColorRGBA"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},initialize:function(){xc.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__:function(){this.color=this._color.getValue(),this.length=this._color.length},addColor:function(t,e){if(t>=0&&t<this.length){const n=this.color;t*=4,e.push(n[t],n[t+1],n[t+2],n[t+3])}else if(this.length){const n=this.color;t=4*(this.length-1),e.push(n[t],n[t+1],n[t+2],n[t+3])}else e.push(1,1,1,1)},addColors:function(t,e){if(this.length){const o=this.color;for(var n=0,i=4*Math.min(e,this.length);n<i;n+=4)t.push(o[n],o[n+1],o[n+2],o[n+3]);if(this.length<e){const r=o[n=4*(this.length-1)],s=o[n+1],a=o[n+2],u=o[n+2];for(n=i,i=4*e;n<i;n+=4)t.push(r,s,a,u)}}else for(let n=0;n<e;++n)t.push(1,1,1,1);return t}});const H_=G_;function q_(t){Nu.call(this,t),this.addType(o.IndexedTriangleFanSet),this.triangleIndex=[]}q_.prototype=Object.assign(Object.create(Nu.prototype),{constructor:q_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_index",new Bn.MFInt32),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"index",new Bn.MFInt32),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedTriangleFanSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Nu.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__:function(){const t=this._index,e=this.triangleIndex;e.length=0;for(let n=0,i=t.length;n<i;++n){const o=t[n];if(!(o<0)&&++n<i){let r=t[n];if(r<0)continue;for(++n;n<i;++n){const i=t[n];if(i<0)break;e.push(o,r,i),r=i}}}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){Nu.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const Y_=q_;function W_(t){Nu.call(this,t),this.addType(o.IndexedTriangleSet)}W_.prototype=Object.assign(Object.create(Nu.prototype),{constructor:W_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_index",new Bn.MFInt32),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"index",new Bn.MFInt32),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedTriangleSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getPolygonIndex:function(t){return this._index[t]},initialize:function(){Nu.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index)},build:function(){Nu.prototype.build.call(this,3,this._index.length,3,this._index.length)}});const $_=W_;function K_(t){Nu.call(this,t),this.addType(o.IndexedTriangleStripSet),this.triangleIndex=[]}K_.prototype=Object.assign(Object.create(Nu.prototype),{constructor:K_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"set_index",new Bn.MFInt32),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"index",new Bn.MFInt32),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedTriangleStripSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Nu.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__:function(){const t=this._index,e=this.triangleIndex;e.length=0;for(let n=0,i=t.length;n<i;++n){let o=t[n];if(!(o<0)&&++n<i){let r=t[n];if(r<0)continue;++n;for(let s=0;n<i;++n,++s){const i=t[n];if(i<0)break;e.push(o,r,i),1&s?r=i:o=i}}}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){Nu.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const Q_=K_;function Z_(t){pc.call(this,t),this.addType(o.LineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Z_.prototype=Object.assign(Object.create(pc.prototype),{constructor:Z_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"vertexCount",new Bn.MFInt32),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"LineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){pc.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=mr(o.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=mr(o.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=mr(o.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=mr(o.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=mr(o.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this._vertexCount,e=this.getAttrib(),n=e.length,i=this.getAttribs(),o=this.fogCoordNode,r=this.colorNode,s=this.coordNode,a=this.getFogDepths(),u=this.getColors(),c=this.getVertices(),l=s.getSize();let h=0;for(let d of t){if(h+d>l)break;if(d>1){d=2*d-2;for(let t=0;t<d;++t,h+=1&t){for(let t=0;t<n;++t)e[t].addValue(h,i[t]);o&&o.addDepth(h,a),r&&r.addColor(h,u),s.addPoint(h,c)}++h}else h+=d}}});const J_=Z_;function tx(t){Du.call(this,t),this.addType(o.X3DNormalNode)}tx.prototype=Object.assign(Object.create(Du.prototype),{constructor:tx});const ex=tx;function nx(t){ex.call(this,t),this.addType(o.Normal)}nx.prototype=Object.assign(Object.create(ex.prototype),{constructor:nx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"vector",new Bn.MFVec3f)]),getTypeName:function(){return"Normal"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"normal"},initialize:function(){ex.prototype.initialize.call(this),this._vector.addInterest("set_vector__",this),this.set_vector__()},set_vector__:function(){this.vector=this._vector.getValue(),this.length=this._vector.length},set1Vector:function(t,e){this._vector[t]=e},get1Vector:function(t,e){if(t>=0&&t<this.length){const n=this.vector;return t*=3,e.set(n[t],n[t+1],n[t+2])}if(t>=0&&this.length){const n=this.vector;return t%=this.length,t*=3,e.set(n[t],n[t+1],n[t+2])}return e.set(0,0,0)},addVector:function(t,e){if(t>=0&&t<this.length){const n=this.vector;t*=3,e.push(n[t],n[t+1],n[t+2])}else{if(!(t>=0&&this.length))return e.push(0,0,0);{const n=this.vector;t%=this.length,t*=3,e.push(n[t],n[t+1],n[t+2])}}}});const ix=nx;function ox(t){Gr.call(this,t);const e=this.getBrowser();this.setGeometryType(0),this.setPrimitiveMode(e.getContext().POINTS),this.setSolid(!1),this.setTransparent(!0)}ox.prototype=Object.assign(Object.create(Gr.prototype),{constructor:ox,intersectsLine:function(){const t=new ur,e=new qt(0,0,0),n=new qt(0,0,0),i=new qt(0,0,0),o=new qt(0,0,0),r=new qt(0,0,0),s=new qt(0,0,0),a=new Ne,u=new jt(0,0),c=new qt(0,0,0);return function(l,h,d,f,p){const g=h.getModelViewMatrix().get(),m=h.getViewVolume().getViewport(),_=(t.assign(this.getBBox()).multRight(g).getExtents(e,n),f.getPointProperties()),x=Math.max(1.5,_?_.getPointSize(e)/2:1),y=h.getViewpoint().getScreenScale(e,m,i),w=d.multDirMatrix(y.multiply(x)),T=Math.max(1.5,_?_.getPointSize(n)/2:1),S=h.getViewpoint().getScreenScale(n,m,o),b=d.multDirMatrix(S.multiply(T));if(this.intersectsBBox(l,w.abs().max(b.abs()))){const t=this.getBrowser().getPointer(),e=h.getProjectionMatrix().get(),n=h.getLocalObjects(),i=this.getVertices(),o=i.length;a.assign(g).multRight(e);for(let e=0;e<o;e+=4){r.set(i[e+0],i[e+1],i[e+2]),Jo.projectPointMatrix(r,a,m,u);const o=Math.max(1.5,_?_.getPointSize(g.multVecMatrix(s.assign(r)))/2:1);if(u.distance(t)<=o){if(n.length&&this.isClipped(g.multVecMatrix(c.assign(r)),n))continue;const e=t.copy().subtract(u).divide(o).add(jt.One).divide(2),i=g.submatrix.transpose().z.copy().normalize();p.push({texCoord:e,normal:i,point:r.copy()})}}}return p.length}}(),intersectsLineWithGeometry:function(){return!1},intersectsBox:function(t,e,n){return!1},buildTexCoords:function(){},display:function(t,e){const n=e.appearanceNode,i=n.getShader(this,e),o=n.getBlendMode(),r=this.getAttrib(),s=this.getAttribBuffers();if(o&&o.enable(t),i.enable(t),i.setUniforms(t,this,e),this.vertexArrayObject.enable(t,i)){for(let e=0,n=r.length;e<n;++e)r[e].enable(t,i,s[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0)}t.drawArrays(this.primitiveMode,0,this.vertexCount),o&&o.disable(t)},displayParticles:function(t,e,n){const i=e.appearanceNode,o=i.getShader(this,e),r=i.getBlendMode(),s=this.getAttrib(),a=this.getAttribBuffers();r&&r.enable(t),o.enable(t),o.setUniforms(t,this,e);const u=n.outputParticles;if(u.vertexArrayObject.update(this.updateParticles).enable(t,o)){const e=n.particleStride;o.enableParticleAttribute(t,u,e,n.particleOffset,1),o.enableParticleMatrixAttribute(t,u,e,n.matrixOffset,1);for(let e=0,n=s.length;e<n;++e)s[e].enable(t,o,a[e]);this.hasFogCoords&&o.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&o.enableColorAttribute(t,this.colorBuffer,0,0),o.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}t.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,n.numParticles),r&&r.disable(t)}});const rx=ox;function sx(t){rx.call(this,t),this.addType(o.PointSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}sx.prototype=Object.assign(Object.create(rx.prototype),{constructor:sx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"PointSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){rx.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},getCoord:function(){return this.coordNode},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=mr(o.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=mr(o.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&this.colorNode.removeInterest("requestRebuild",this),this.colorNode=mr(o.X3DColorNode,this._color),this.colorNode&&this.colorNode.addInterest("requestRebuild",this)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=mr(o.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=mr(o.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this.getAttrib(),e=t.length,n=this.getAttribs(),i=this.fogCoordNode,o=this.getFogDepths(),r=this.colorNode,s=this.getColors(),a=this.coordNode,u=this.getVertices(),c=a._point.length;for(let i=0;i<e;++i)for(let e=0;e<c;++e)t[i].addValue(e,n[i]);i&&i.addDepths(o,c),r&&r.addColors(s,c),a.addPoints(u,c)}});const ax=sx;function ux(t){Nu.call(this,t),this.addType(o.TriangleFanSet),this.triangleIndex=[]}ux.prototype=Object.assign(Object.create(Nu.prototype),{constructor:ux,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new z(o.inputOutput,"fanCount",new Bn.MFInt32),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"TriangleFanSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Nu.prototype.initialize.call(this),this._fanCount.addInterest("set_fanCount__",this),this.set_fanCount__()},set_fanCount__:function(){const t=this._fanCount,e=this.triangleIndex;e.length=0;let n=0;for(const i of t){for(let t=1,o=i-1;t<o;++t)e.push(n,n+t,n+t+1);n+=i}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){Nu.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const cx=ux;function lx(t){Nu.call(this,t),this.addType(o.TriangleSet)}lx.prototype=Object.assign(Object.create(Nu.prototype),{constructor:lx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"TriangleSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},build:function(){this.getCoord()&&Nu.prototype.build.call(this,3,this.getCoord().getSize(),3,this.getCoord().getSize())},createNormals:function(t,e){return this.createFaceNormals(t,e)}});const hx=lx;function dx(t){Nu.call(this,t),this.addType(o.TriangleStripSet),this.triangleIndex=[]}dx.prototype=Object.assign(Object.create(Nu.prototype),{constructor:dx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"solid",new Bn.SFBool(!0)),new z(o.initializeOnly,"ccw",new Bn.SFBool(!0)),new z(o.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new z(o.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new z(o.inputOutput,"stripCount",new Bn.MFInt32),new z(o.inputOutput,"attrib",new Bn.MFNode),new z(o.inputOutput,"fogCoord",new Bn.SFNode),new z(o.inputOutput,"color",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.SFNode),new z(o.inputOutput,"normal",new Bn.SFNode),new z(o.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"TriangleStripSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Nu.prototype.initialize.call(this),this._stripCount.addInterest("set_stripCount__",this),this.set_stripCount__()},set_stripCount__:function(){const t=this._stripCount,e=this.triangleIndex;e.length=0;let n=0;for(const i of t){for(let t=0,o=i-2;t<o;++t){const i=1&t;e.push(n+(i?t+1:t),n+(i?t:t+1),n+(t+2))}n+=i}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){Nu.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const fx={ClipPlane:k_,Color:wc,ColorRGBA:H_,Coordinate:Lu,IndexedLineSet:mc,IndexedTriangleFanSet:Y_,IndexedTriangleSet:$_,IndexedTriangleStripSet:Q_,LineSet:J_,Normal:ix,PointSet:ax,TriangleFanSet:cx,TriangleSet:hx,TriangleStripSet:dx},px={X3DColorNode:xc,X3DComposedGeometryNode:Nu,X3DCoordinateNode:Pu,X3DGeometricPropertyNode:Du,X3DGeometryNode:Gr,X3DLineGeometryNode:pc,X3DNormalNode:ex};for(const t in fx)Bi.addType(t,fx[t]);for(const t in px)Bi.addAbstractType(t,px[t]);function gx(t){Du.call(this,t),this.addType(o.X3DVertexAttributeNode),this.addChildObjects("attribute_changed",new Bn.SFTime)}gx.prototype=Object.assign(Object.create(Du.prototype),{constructor:gx,initialize:function(){Du.prototype.initialize.call(this),this._name.addInterest("set_attribute__",this)},set_attribute__:function(){this._attribute_changed=this.getBrowser().getCurrentTime()}});const mx=gx;function _x(t){mx.call(this,t),this.addType(o.FloatVertexAttribute)}_x.prototype=Object.assign(Object.create(mx.prototype),{constructor:_x,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"name",new Bn.SFString),new z(o.initializeOnly,"numComponents",new Bn.SFInt32(4)),new z(o.inputOutput,"value",new Bn.MFFloat)]),getTypeName:function(){return"FloatVertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){mx.prototype.initialize.call(this),this._numComponents.addInterest("set_numComponents__",this),this._numComponents.addInterest("set_attribute__",this),this._value.addInterest("set_value__",this),this.set_numComponents__(),this.set_value__()},set_numComponents__:function(){this.numComponents=et.clamp(this._numComponents.getValue(),1,4)},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){const n=this.value;let i=t*this.numComponents,o=i+this.numComponents;if(o<=this.length)for(;i<o;++i)e.push(n[i]);else if(this.numComponents<=this.length)for(o=n.length,i=o-this.numComponents;i<o;++i)e.push(n[i]);else for(;i<o;++i)e.push(0)},enable:function(t,e,n){e.enableFloatAttrib(t,this._name.getValue(),n,this.numComponents,0,0)}});const xx=_x;function yx(t){mx.call(this,t),this.addType(o.Matrix3VertexAttribute)}yx.prototype=Object.assign(Object.create(mx.prototype),{constructor:yx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"name",new Bn.SFString),new z(o.inputOutput,"value",new Bn.MFMatrix3f)]),getTypeName:function(){return"Matrix3VertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){mx.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){if(t<this.length){const n=this.value;for(let i=9*t,o=i+9;i<o;++i)e.push(n[i])}else if(this.length){const n=this.value;for(let i=9*(t=this.length-1),o=i+9;i<o;++i)e.push(n[i])}else{const t=ee.Identity;for(let n=0;n<9;++n)e.push(t[n])}},enable:function(t,e,n){e.enableMatrix3Attrib(t,this._name.getValue(),n,0,0)}});const wx=yx;function Tx(t){mx.call(this,t),this.addType(o.Matrix4VertexAttribute)}Tx.prototype=Object.assign(Object.create(mx.prototype),{constructor:Tx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"name",new Bn.SFString),new z(o.inputOutput,"value",new Bn.MFMatrix4f)]),getTypeName:function(){return"Matrix4VertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){mx.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){if(t<this.length){const n=this.value;for(let i=16*t,o=i+16;i<o;++i)e.push(n[i])}else if(this.length){const n=this.value;for(let i=16*(t=this.length-1),o=i+16;i<o;++i)e.push(n[i])}else{const t=Matrix4.Identity;for(let n=0;n<16;++n)e.push(t[n])}},enable:function(t,e,n){e.enableMatrix4Attrib(t,this._name.getValue(),n,0,0)}});const Sx=Tx;function bx(t){Sh.call(this,t),xo.call(this,t),Ch.call(this,t),this.addType(o.PackagedShader)}bx.prototype=Object.assign(Object.create(Sh.prototype),xo.prototype,Ch.prototype,{constructor:bx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"activate",new Bn.SFBool),new z(o.outputOnly,"isSelected",new Bn.SFBool),new z(o.outputOnly,"isValid",new Bn.SFBool),new z(o.initializeOnly,"language",new Bn.SFString),new z(o.inputOutput,"load",new Bn.SFBool(!0)),new z(o.inputOutput,"url",new Bn.MFString),new z(o.inputOutput,"autoRefresh",new Bn.SFTime),new z(o.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600))]),getTypeName:function(){return"PackagedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},getSourceText:function(){return this._url},requestImmediateLoad:function(t=!0){},requestUnload:function(){}});const vx=bx;function Ex(t){Sh.call(this,t),this.addType(o.ProgramShader)}Ex.prototype=Object.assign(Object.create(Sh.prototype),{constructor:Ex,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOnly,"activate",new Bn.SFBool),new z(o.outputOnly,"isSelected",new Bn.SFBool),new z(o.outputOnly,"isValid",new Bn.SFBool),new z(o.initializeOnly,"language",new Bn.SFString),new z(o.inputOutput,"programs",new Bn.MFNode)]),getTypeName:function(){return"ProgramShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"}});const Cx=Ex;function Ox(t){ji.call(this,t),xo.call(this,t),Ch.call(this,t),this.addType(o.ShaderProgram)}Ox.prototype=Object.assign(Object.create(ji.prototype),xo.prototype,Ch.prototype,{constructor:Ox,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"type",new Bn.SFString("VERTEX")),new z(o.inputOutput,"load",new Bn.SFBool(!0)),new z(o.inputOutput,"url",new Bn.MFString),new z(o.inputOutput,"autoRefresh",new Bn.SFTime),new z(o.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600))]),getTypeName:function(){return"ShaderProgram"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"programs"},getSourceText:function(){return this._url},requestImmediateLoad:function(t=!0){},requestUnload:function(){}});const Fx={ComposedShader:Ih,FloatVertexAttribute:xx,Matrix3VertexAttribute:wx,Matrix4VertexAttribute:Sx,PackagedShader:vx,ProgramShader:Cx,ShaderPart:$h,ShaderProgram:Ox},Nx={X3DProgrammableShaderObject:Ch,X3DShaderNode:Sh,X3DVertexAttributeNode:mx};for(const t in Fx)Bi.addType(t,Fx[t]);for(const t in Nx)Bi.addAbstractType(t,Nx[t]);function Mx(t){es.call(this,t),this.addType(o.AcousticProperties)}Mx.prototype=Object.assign(Object.create(es.prototype),{constructor:Mx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"absorption",new Bn.SFFloat),new z(o.inputOutput,"refraction",new Bn.SFFloat),new z(o.inputOutput,"diffuse",new Bn.SFFloat),new z(o.inputOutput,"specular",new Bn.SFFloat)]),getTypeName:function(){return"AcousticProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"AcousticProperties"}});const Vx=Mx;function Ix(t){es.call(this,t),this.addType(o.FillProperties),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(o.outputOnly),this.hatchColor=new Float32Array(3)}Ix.prototype=Object.assign(Object.create(es.prototype),{constructor:Ix,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"filled",new Bn.SFBool(!0)),new z(o.inputOutput,"hatched",new Bn.SFBool(!0)),new z(o.inputOutput,"hatchColor",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"hatchStyle",new Bn.SFInt32(1))]),getTypeName:function(){return"FillProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"fillProperties"},initialize:function(){es.prototype.initialize.call(this),this._filled.addInterest("set_filled__",this),this._hatched.addInterest("set_hatched__",this),this._hatchColor.addInterest("set_hatchColor__",this),this._hatchStyle.addInterest("set_hatchStyle__",this),this.set_filled__(),this.set_hatched__(),this.set_hatchColor__(),this.set_hatchStyle__()},set_filled__:function(){this.filled=this._filled.getValue(),this.setTransparent(!this.filled)},set_hatched__:function(){this.hatched=this._hatched.getValue()},set_hatchColor__:function(){this.hatchColor[0]=this._hatchColor[0],this.hatchColor[1]=this._hatchColor[1],this.hatchColor[2]=this._hatchColor[2]},set_hatchStyle__:function(){let t=this._hatchStyle.getValue();(t<1||t>19)&&(t=1),this.hatchStyle=t},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()},setShaderUniforms:function(t,e){const n=this.hatched;if(t.uniform1i(e.x3d_FillPropertiesFilled,this.filled),t.uniform1i(e.x3d_FillPropertiesHatched,n),n){const n=this.getBrowser(),i=n.getHatchStyleTexture(this.hatchStyle),o=n.getTexture2DUnit();t.uniform3fv(e.x3d_FillPropertiesHatchColor,this.hatchColor),t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,i.getTexture()),t.uniform1i(e.x3d_FillPropertiesTexture,o)}}});const Dx=Ix;function Rx(t){es.call(this,t),this.addType(o.LineProperties)}Rx.prototype=Object.assign(Object.create(es.prototype),{constructor:Rx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"applied",new Bn.SFBool(!0)),new z(o.inputOutput,"linetype",new Bn.SFInt32(1)),new z(o.inputOutput,"linewidthScaleFactor",new Bn.SFFloat)]),getTypeName:function(){return"LineProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"lineProperties"},initialize:function(){es.prototype.initialize.call(this),this._applied.addInterest("set_applied__",this),this._linetype.addInterest("set_linetype__",this),this._linewidthScaleFactor.addInterest("set_linewidthScaleFactor__",this),this.set_applied__(),this.set_linetype__(),this.set_linewidthScaleFactor__()},getApplied:function(){return this.applied},getLinetype:function(){return this.linetype},getLinewidthScaleFactor:function(){return this.linewidthScaleFactor},getTransformLines:function(){return this.transformLines},set_applied__:function(){this.applied=this._applied.getValue()},set_linetype__:function(){let t=this._linetype.getValue();(t<1||t>16)&&(t=1),this.linetype=t},set_linewidthScaleFactor__:function(){const t=this.getBrowser().getContext();this.linewidthScaleFactor=Math.max(1,this._linewidthScaleFactor.getValue()),this.transformLines=t.HAS_FEATURE_TRANSFORMED_LINES&&this.linewidthScaleFactor>1},setShaderUniforms:function(t,e){if(this.applied){const n=this.getBrowser(),i=n.getTexture2DUnit();t.lineWidth(this.linewidthScaleFactor),t.uniform1i(e.x3d_LinePropertiesApplied,!0),t.uniform1i(e.x3d_LinePropertiesLinetype,this.linetype),t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,n.getLinetypeTexture().getTexture()),t.uniform1i(e.x3d_LinePropertiesTexture,i)}else t.lineWidth(1),t.uniform1i(e.x3d_LinePropertiesApplied,!1)}});const Px=Rx;function Ax(t){ud.call(this,t),this.addType(o.Material),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3)}Ax.prototype=Object.assign(Object.create(ud.prototype),{constructor:Ax,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"ambientIntensity",new Bn.SFFloat(.2)),new z(o.inputOutput,"ambientTexture",new Bn.SFNode),new z(o.inputOutput,"ambientTextureMapping",new Bn.SFString),new z(o.inputOutput,"diffuseColor",new Bn.SFColor(.8,.8,.8)),new z(o.inputOutput,"diffuseTexture",new Bn.SFNode),new z(o.inputOutput,"diffuseTextureMapping",new Bn.SFString),new z(o.inputOutput,"specularColor",new Bn.SFColor),new z(o.inputOutput,"specularTexture",new Bn.SFNode),new z(o.inputOutput,"specularTextureMapping",new Bn.SFString),new z(o.inputOutput,"emissiveColor",new Bn.SFColor),new z(o.inputOutput,"emissiveTexture",new Bn.SFNode),new z(o.inputOutput,"emissiveTextureMapping",new Bn.SFString),new z(o.inputOutput,"shininess",new Bn.SFFloat(.2)),new z(o.inputOutput,"shininessTexture",new Bn.SFNode),new z(o.inputOutput,"shininessTextureMapping",new Bn.SFString),new z(o.inputOutput,"occlusionStrength",new Bn.SFFloat(1)),new z(o.inputOutput,"occlusionTexture",new Bn.SFNode),new z(o.inputOutput,"occlusionTextureMapping",new Bn.SFString),new z(o.inputOutput,"normalScale",new Bn.SFFloat(1)),new z(o.inputOutput,"normalTexture",new Bn.SFNode),new z(o.inputOutput,"normalTextureMapping",new Bn.SFString),new z(o.inputOutput,"transparency",new Bn.SFFloat)]),getTypeName:function(){return"Material"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){ud.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._ambientTexture.addInterest("set_ambientTexture__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._diffuseTexture.addInterest("set_diffuseTexture__",this),this._specularColor.addInterest("set_specularColor__",this),this._specularTexture.addInterest("set_specularTexture__",this),this._shininess.addInterest("set_shininess__",this),this._shininessTexture.addInterest("set_shininessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_ambientIntensity__(),this.set_ambientTexture__(),this.set_diffuseColor__(),this.set_diffuseTexture__(),this.set_specularColor__(),this.set_specularTexture__(),this.set_shininess__(),this.set_shininessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_ambientIntensity__:function(){this.ambientIntensity=et.clamp(this._ambientIntensity.getValue(),0,1)},set_ambientTexture__:function(){this.ambientTextureNode=mr(o.X3DSingleTextureNode,this._ambientTexture),this.setTexture(this.getTextureIndices().AMBIENT_TEXTURE,this.ambientTextureNode)},set_diffuseColor__:function(){const t=this.diffuseColor,e=this._diffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_diffuseTexture__:function(){this.diffuseTextureNode&&this.diffuseTextureNode._transparent.removeInterest("set_transparent__",this),this.diffuseTextureNode=mr(o.X3DSingleTextureNode,this._diffuseTexture),this.diffuseTextureNode&&this.diffuseTextureNode._transparent.addInterest("set_transparent__",this),this.setTexture(this.getTextureIndices().DIFFUSE_TEXTURE,this.diffuseTextureNode)},set_specularColor__:function(){const t=this.specularColor,e=this._specularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_specularTexture__:function(){this.specularTextureNode=mr(o.X3DSingleTextureNode,this._specularTexture),this.setTexture(this.getTextureIndices().SPECULAR_TEXTURE,this.specularTextureNode)},set_shininess__:function(){this.shininess=et.clamp(this._shininess.getValue(),0,1)},set_shininessTexture__:function(){this.shininessTextureNode=mr(o.X3DSingleTextureNode,this._shininessTexture),this.setTexture(this.getTextureIndices().SHININESS_TEXTURE,this.shininessTextureNode)},set_occlusionStrength__:function(){this.occlusionStrength=et.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__:function(){this.occlusionTextureNode=mr(o.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.diffuseTextureNode&&this.diffuseTextureNode.getTransparent()))},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++,AMBIENT_TEXTURE:t++,DIFFUSE_TEXTURE:t++,SPECULAR_TEXTURE:t++,SHININESS_TEXTURE:t++,OCCLUSION_TEXTURE:t++};return function(){return e}}(),getMaterialKey:function(t){return t||+this.getTextureBits()||this.getBrowser().getBrowserOptions().getShading()===di.PHONG?"2":"1"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);if(e.hasNormals)switch(o.push("X3D_MATERIAL"),+this.getTextureBits()&&(this.ambientTextureNode&&o.push("X3D_AMBIENT_TEXTURE","X3D_AMBIENT_TEXTURE_"+this.ambientTextureNode.getTextureTypeString()),this.diffuseTextureNode&&o.push("X3D_DIFFUSE_TEXTURE","X3D_DIFFUSE_TEXTURE_"+this.diffuseTextureNode.getTextureTypeString()),this.specularTextureNode&&o.push("X3D_SPECULAR_TEXTURE","X3D_SPECULAR_TEXTURE_"+this.specularTextureNode.getTextureTypeString()),this.shininessTextureNode&&o.push("X3D_SHININESS_TEXTURE","X3D_SHININESS_TEXTURE_"+this.shininessTextureNode.getTextureTypeString()),this.occlusionTextureNode&&o.push("X3D_OCCLUSION_TEXTURE","X3D_OCCLUSION_TEXTURE_"+this.occlusionTextureNode.getTextureTypeString())),this.getMaterialKey(n&&n.shadows)){case"1":var r=i.createShader("GouraudShader","Gouraud","Gouraud",o);break;case"2":r=i.createShader("PhongShader","Default","Phong",o)}else{o.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",o);i.getShaders().set(t.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(t,r),r},setShaderUniforms:function(t,e,n,i,o){if(ud.prototype.setShaderUniforms.call(this,t,e,n,i,o),t.uniform1f(e.x3d_AmbientIntensity,this.ambientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.diffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.specularColor),t.uniform1f(e.x3d_Shininess,this.shininess),+this.getTextureBits()){if(this.ambientTextureNode){const r=e.x3d_AmbientTexture;this.ambientTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._ambientTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._ambientTextureMapping.getValue())||0)}if(this.diffuseTextureNode){const r=e.x3d_DiffuseTexture;this.diffuseTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._diffuseTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._diffuseTextureMapping.getValue())||0)}if(this.specularTextureNode){const r=e.x3d_SpecularTexture;this.specularTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._specularTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._specularTextureMapping.getValue())||0)}if(this.shininessTextureNode){const r=e.x3d_ShininessTexture;this.shininessTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._shininessTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._shininessTextureMapping.getValue())||0)}if(this.occlusionTextureNode){const r=e.x3d_OcclusionTexture;t.uniform1f(e.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._occlusionTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._occlusionTextureMapping.getValue())||0)}}}});const Lx=Ax;function Bx(t){ud.call(this,t),this.addType(o.PhysicalMaterial),this.baseColor=new Float32Array(3)}Bx.prototype=Object.assign(Object.create(ud.prototype),{constructor:Bx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"baseColor",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"baseTexture",new Bn.SFNode),new z(o.inputOutput,"baseTextureMapping",new Bn.SFString),new z(o.inputOutput,"emissiveColor",new Bn.SFColor(0,0,0)),new z(o.inputOutput,"emissiveTexture",new Bn.SFNode),new z(o.inputOutput,"emissiveTextureMapping",new Bn.SFString),new z(o.inputOutput,"metallic",new Bn.SFFloat(1)),new z(o.inputOutput,"roughness",new Bn.SFFloat(1)),new z(o.inputOutput,"metallicRoughnessTexture",new Bn.SFNode),new z(o.inputOutput,"metallicRoughnessTextureMapping",new Bn.SFString),new z(o.inputOutput,"occlusionStrength",new Bn.SFFloat(1)),new z(o.inputOutput,"occlusionTexture",new Bn.SFNode),new z(o.inputOutput,"occlusionTextureMapping",new Bn.SFString),new z(o.inputOutput,"normalScale",new Bn.SFFloat(1)),new z(o.inputOutput,"normalTexture",new Bn.SFNode),new z(o.inputOutput,"normalTextureMapping",new Bn.SFString),new z(o.inputOutput,"transparency",new Bn.SFFloat)]),getTypeName:function(){return"PhysicalMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){ud.prototype.initialize.call(this),this._baseColor.addInterest("set_baseColor__",this),this._baseTexture.addInterest("set_baseTexture__",this),this._metallic.addInterest("set_metallic__",this),this._roughness.addInterest("set_roughness__",this),this._metallicRoughnessTexture.addInterest("set_metallicRoughnessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_baseColor__(),this.set_baseTexture__(),this.set_metallic__(),this.set_roughness__(),this.set_metallicRoughnessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_baseColor__:function(){const t=this.baseColor,e=this._baseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_baseTexture__:function(){this.baseTextureNode&&this.baseTextureNode._transparent.removeInterest("set_transparent__",this),this.baseTextureNode=mr(o.X3DSingleTextureNode,this._baseTexture),this.setTexture(this.getTextureIndices().BASE_TEXTURE,this.baseTextureNode),this.baseTextureNode&&this.baseTextureNode._transparent.addInterest("set_transparent__",this)},set_metallic__:function(){this.metallic=et.clamp(this._metallic.getValue(),0,1)},set_roughness__:function(){this.roughness=et.clamp(this._roughness.getValue(),0,1)},set_metallicRoughnessTexture__:function(){this.metallicRoughnessTextureNode=mr(o.X3DSingleTextureNode,this._metallicRoughnessTexture),this.setTexture(this.getTextureIndices().METALLIC_ROUGHNESS_TEXTURE,this.metallicRoughnessTextureNode)},set_occlusionStrength__:function(){this.occlusionStrength=et.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__:function(){this.occlusionTextureNode=mr(o.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.baseTextureNode&&this.baseTextureNode.getTransparent()))},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++,BASE_TEXTURE:t++,METALLIC_ROUGHNESS_TEXTURE:t++,OCCLUSION_TEXTURE:t++};return function(){return e}}(),getMaterialKey:function(){return"3"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);if(e.hasNormals){o.push("X3D_PHYSICAL_MATERIAL"),+this.getTextureBits()&&(this.baseTextureNode&&o.push("X3D_BASE_TEXTURE","X3D_BASE_TEXTURE_"+this.baseTextureNode.getTextureTypeString()),this.metallicRoughnessTextureNode&&o.push("X3D_METALLIC_ROUGHNESS_TEXTURE","X3D_METALLIC_ROUGHNESS_TEXTURE_"+this.metallicRoughnessTextureNode.getTextureTypeString()),this.occlusionTextureNode&&o.push("X3D_OCCLUSION_TEXTURE","X3D_OCCLUSION_TEXTURE_"+this.occlusionTextureNode.getTextureTypeString()));var r=i.createShader("PhysicalMaterialShader","Default","PBR",o)}else{o.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",o);i.getShaders().set(t.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(t,r),r},setShaderUniforms:function(t,e,n,i,o){if(ud.prototype.setShaderUniforms.call(this,t,e,n,i,o),t.uniform3fv(e.x3d_BaseColor,this.baseColor),t.uniform1f(e.x3d_Metallic,this.metallic),t.uniform1f(e.x3d_Roughness,this.roughness),+this.getTextureBits()){if(this.baseTextureNode){const r=e.x3d_BaseTexture;this.baseTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._baseTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._baseTextureMapping.getValue())||0)}if(this.metallicRoughnessTextureNode){const r=e.x3d_MetallicRoughnessTexture;this.metallicRoughnessTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._metallicRoughnessTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._metallicRoughnessTextureMapping.getValue())||0)}if(this.occlusionTextureNode){const r=e.x3d_OcclusionTexture;t.uniform1f(e.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._occlusionTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._occlusionTextureMapping.getValue())||0)}}}});const Xx=Bx;function Ux(t){es.call(this,t),this.addType(o.PointProperties),this.pointSizeAttenuation=new Float32Array(3)}Ux.prototype=Object.assign(Object.create(es.prototype),{constructor:Ux,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"pointSizeScaleFactor",new Bn.SFFloat(1)),new z(o.inputOutput,"pointSizeMinValue",new Bn.SFFloat(1)),new z(o.inputOutput,"pointSizeMaxValue",new Bn.SFFloat(1)),new z(o.inputOutput,"pointSizeAttenuation",new Bn.MFFloat(1,0,0)),new z(o.inputOutput,"markerType",new Bn.SFInt32(1))]),getTypeName:function(){return"PointProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"pointProperties"},initialize:function(){es.prototype.initialize.call(this);const t=this.getBrowser().getContext();this.pointSizeRange=t.getParameter(t.ALIASED_POINT_SIZE_RANGE),this._pointSizeScaleFactor.addInterest("set_pointSizeScaleFactor__",this),this._pointSizeMinValue.addInterest("set_pointSizeMinValue__",this),this._pointSizeMaxValue.addInterest("set_pointSizeMaxValue__",this),this._pointSizeAttenuation.addInterest("set_pointSizeAttenuation__",this),this._markerType.addInterest("set_markerType__",this),this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__(),this.set_pointSizeAttenuation__(),this.set_markerType__()},getPointSize:function(t){const e=this.pointSizeAttenuation,n=t.magnitude();let i=this.pointSizeScaleFactor;return i/=e[0]+e[1]*n+e[2]*(n*n),i=et.clamp(i,this.pointSizeMinValue,this.pointSizeMaxValue),i},set_pointSizeScaleFactor__:function(){this.pointSizeScaleFactor=Math.max(this._pointSizeScaleFactor.getValue(),0)},set_pointSizeMinValue__:function(){this.pointSizeMinValue=et.clamp(this._pointSizeMinValue.getValue(),0,this.pointSizeRange[1])},set_pointSizeMaxValue__:function(){this.pointSizeMaxValue=et.clamp(this._pointSizeMaxValue.getValue(),0,this.pointSizeRange[1])},set_pointSizeAttenuation__:function(){const t=this._pointSizeAttenuation.length;this.pointSizeAttenuation[0]=t>0?Math.max(0,this._pointSizeAttenuation[0]):1,this.pointSizeAttenuation[1]=t>1?Math.max(0,this._pointSizeAttenuation[1]):0,this.pointSizeAttenuation[2]=t>2?Math.max(0,this._pointSizeAttenuation[2]):0},set_markerType__:function(){},setShaderUniforms:function(t,e){t.uniform1f(e.x3d_PointPropertiesPointSizeScaleFactor,this.pointSizeScaleFactor),t.uniform1f(e.x3d_PointPropertiesPointSizeMinValue,this.pointSizeMinValue),t.uniform1f(e.x3d_PointPropertiesPointSizeMaxValue,this.pointSizeMaxValue),t.uniform3fv(e.x3d_PointPropertiesPointSizeAttenuation,this.pointSizeAttenuation)}});const zx=Ux;function jx(t){console.warn("TwoSidedMaterial is depreciated, please use Appearance backMaterial field."),sd.call(this,t),this.addType(o.TwoSidedMaterial),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3),this.emissiveColor=new Float32Array(3),this.backDiffuseColor=new Float32Array(3),this.backSpecularColor=new Float32Array(3),this.backEmissiveColor=new Float32Array(3)}jx.prototype=Object.assign(Object.create(sd.prototype),{constructor:jx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"separateBackColor",new Bn.SFBool),new z(o.inputOutput,"ambientIntensity",new Bn.SFFloat(.2)),new z(o.inputOutput,"diffuseColor",new Bn.SFColor(.8,.8,.8)),new z(o.inputOutput,"specularColor",new Bn.SFColor),new z(o.inputOutput,"emissiveColor",new Bn.SFColor),new z(o.inputOutput,"shininess",new Bn.SFFloat(.2)),new z(o.inputOutput,"transparency",new Bn.SFFloat),new z(o.inputOutput,"backAmbientIntensity",new Bn.SFFloat(.2)),new z(o.inputOutput,"backDiffuseColor",new Bn.SFColor(.8,.8,.8)),new z(o.inputOutput,"backSpecularColor",new Bn.SFColor),new z(o.inputOutput,"backEmissiveColor",new Bn.SFColor),new z(o.inputOutput,"backShininess",new Bn.SFFloat(.2)),new z(o.inputOutput,"backTransparency",new Bn.SFFloat)]),getTypeName:function(){return"TwoSidedMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){sd.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._specularColor.addInterest("set_specularColor__",this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._shininess.addInterest("set_shininess__",this),this._transparency.addInterest("set_transparency__",this),this._backAmbientIntensity.addInterest("set_backAmbientIntensity__",this),this._backDiffuseColor.addInterest("set_backDiffuseColor__",this),this._backSpecularColor.addInterest("set_backSpecularColor__",this),this._backEmissiveColor.addInterest("set_backEmissiveColor__",this),this._backShininess.addInterest("set_backShininess__",this),this._backTransparency.addInterest("set_backTransparency__",this),this._separateBackColor.addInterest("set_transparent__",this),this._transparency.addInterest("set_transparent__",this),this._backTransparency.addInterest("set_transparent__",this),this.set_ambientIntensity__(),this.set_diffuseColor__(),this.set_specularColor__(),this.set_emissiveColor__(),this.set_shininess__(),this.set_transparency__(),this.set_backAmbientIntensity__(),this.set_backDiffuseColor__(),this.set_backSpecularColor__(),this.set_backEmissiveColor__(),this.set_backShininess__(),this.set_backTransparency__(),this.set_transparent__()},set_ambientIntensity__:function(){this.ambientIntensity=Math.max(this._ambientIntensity.getValue(),0)},set_diffuseColor__:function(){const t=this.diffuseColor,e=this._diffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_specularColor__:function(){const t=this.specularColor,e=this._specularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_emissiveColor__:function(){const t=this.emissiveColor,e=this._emissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_shininess__:function(){this.shininess=et.clamp(this._shininess.getValue(),0,1)},set_transparency__:function(){this.transparency=et.clamp(this._transparency.getValue(),0,1)},set_backAmbientIntensity__:function(){this.backAmbientIntensity=Math.max(this._backAmbientIntensity.getValue(),0)},set_backDiffuseColor__:function(){const t=this.backDiffuseColor,e=this._backDiffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backSpecularColor__:function(){const t=this.backSpecularColor,e=this._backSpecularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backEmissiveColor__:function(){const t=this.backEmissiveColor,e=this._backEmissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backShininess__:function(){this.backShininess=et.clamp(this._backShininess.getValue(),0,1)},set_backTransparency__:function(){this.backTransparency=et.clamp(this._backTransparency.getValue(),0,1)},set_transparent__:function(){this.setTransparent(Boolean(this._transparency.getValue()||this._separateBackColor.getValue()&&this._backTransparency.getValue()))},getMaterialKey:Lx.prototype.getMaterialKey,createShader:Lx.prototype.createShader,setShaderUniforms:function(t,e,n,i,o,r){!r&&this._separateBackColor.getValue()?(t.uniform1f(e.x3d_AmbientIntensity,this.backAmbientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.backDiffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.backSpecularColor),t.uniform3fv(e.x3d_EmissiveColor,this.backEmissiveColor),t.uniform1f(e.x3d_Shininess,this.backShininess),t.uniform1f(e.x3d_Transparency,this.backTransparency)):(t.uniform1f(e.x3d_AmbientIntensity,this.ambientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.diffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.specularColor),t.uniform3fv(e.x3d_EmissiveColor,this.emissiveColor),t.uniform1f(e.x3d_Shininess,this.shininess),t.uniform1f(e.x3d_Transparency,this.transparency))}});const kx={AcousticProperties:Vx,Appearance:od,FillProperties:Dx,LineProperties:Px,Material:Lx,PhysicalMaterial:Xx,PointProperties:zx,Shape:lc,TwoSidedMaterial:jx,UnlitMaterial:ld},Gx={X3DAppearanceChildNode:es,X3DAppearanceNode:nd,X3DMaterialNode:sd,X3DOneSidedMaterialNode:ud,X3DShapeNode:oc};for(const t in kx)Bi.addType(t,kx[t]);for(const t in Gx)Bi.addAbstractType(t,Gx[t]);function Hx(t){gr.call(this,t),ys.call(this,t),this.addType(o.X3DSoundSourceNode),this.volume=0,this.media=null}Hx.prototype=Object.assign(Object.create(gr.prototype),ys.prototype,{constructor:Hx,initialize:function(){gr.prototype.initialize.call(this),ys.prototype.initialize.call(this)},set_live__:function(){ys.prototype.set_live__.call(this),this.getDisabled()?(this.getBrowser()._volume.removeInterest("set_volume__",this),this.getBrowser()._mute.removeInterest("set_volume__",this)):(this.getBrowser()._volume.addInterest("set_volume__",this),this.getBrowser()._mute.addInterest("set_volume__",this),this.set_volume__())},setMedia:function(t){if(this.media){const t=this.media[0];t.muted=!0,t.pause()}if(this.media=t,t){const e=t[0];e.muted=!1,e.volume=0,e.loop=this._loop.getValue(),this.setVolume(0),this._duration_changed=e.duration,this.resetElapsedTime(),this._isActive.getValue()?this._isPaused.getValue()?this.set_pause():this.getLiveState()?this.set_start():this.set_pause():this.set_stop()}},getMedia:function(){return this.media},setVolume:function(t){this.volume=et.clamp(t,0,1),this.set_volume__()},set_loop:function(){this.media&&(this.media[0].loop=this._loop.getValue())},set_volume__:function(){if(!this.media)return;const t=!this.getBrowser()._mute.getValue()*et.clamp(this.getBrowser()._volume.getValue(),0,1)*this.volume;this.media[0].volume=t},set_speed:function(){},set_pitch:function(){},set_start:function(){this.media&&this._speed.getValue()&&(this.media[0].currentTime=0,this.media[0].play().catch(Function.prototype))},set_pause:function(){this.media&&this.media[0].pause()},set_resume:function(){this.media&&this._speed.getValue()&&this.media[0].play().catch(Function.prototype)},set_stop:function(){this.media&&this.media[0].pause()},set_ended:function(){if(this.media){const t=this.media[0];if(t.currentTime<t.duration)return;this._loop.getValue()||this.stop()}},set_time:function(){this.media&&(this._elapsedTime=this.getElapsedTime()),this.set_ended()}});const qx=Hx;function Yx(t){qx.call(this,t),xo.call(this,t),this.addType(o.AudioClip),this.addChildObjects("speed",new Bn.SFFloat(1)),this.audio=$("<audio></audio>"),this.urlStack=new Bn.MFString}Yx.prototype=Object.assign(Object.create(qx.prototype),xo.prototype,{constructor:Yx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"load",new Bn.SFBool(!0)),new z(o.inputOutput,"url",new Bn.MFString),new z(o.inputOutput,"autoRefresh",new Bn.SFTime),new z(o.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new z(o.inputOutput,"gain",new Bn.SFFloat(1)),new z(o.inputOutput,"pitch",new Bn.SFFloat(1)),new z(o.inputOutput,"loop",new Bn.SFBool),new z(o.inputOutput,"startTime",new Bn.SFTime),new z(o.inputOutput,"resumeTime",new Bn.SFTime),new z(o.inputOutput,"pauseTime",new Bn.SFTime),new z(o.inputOutput,"stopTime",new Bn.SFTime),new z(o.outputOnly,"isPaused",new Bn.SFBool),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"elapsedTime",new Bn.SFTime),new z(o.outputOnly,"duration_changed",new Bn.SFTime(-1))]),getTypeName:function(){return"AudioClip"},getComponentName:function(){return"Sound"},getContainerField:function(){return"source"},initialize:function(){qx.prototype.initialize.call(this),xo.prototype.initialize.call(this),this.audio.on("abort error",this.setError.bind(this)),this.audio.on("suspend stalled",this.setTimeout.bind(this)),this.audio[0].crossOrigin="Anonymous",this.audio[0].preload="auto",this.audio[0].muted=!0,this.requestImmediateLoad()},getElement:function(){return this.audio[0]},set_live__:function(){qx.prototype.set_live__.call(this),xo.prototype.set_live__.call(this)},unLoadNow:function(){this.setMedia(null)},loadNow:function(){this.setMedia(null),this.urlStack.setValue(this._url),this.audio.on("canplaythrough",this.setAudio.bind(this)),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.audio.off("canplaythrough"),this._duration_changed=-1,void this.setLoadState(o.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.audio.attr("src",this.URL.href),this.audio.get(0).load()},setTimeout:function(t){setTimeout(function(){this.checkLoadState()===o.IN_PROGRESS_STATE&&this.setError(t)}.bind(this),3e3)},setError:function(t){"data:"!==this.URL.protocol&&console.warn("Error loading audio:",decodeURI(this.URL.href),t.type),this.loadNext()},setAudio:function(){this.audio.unbind("canplaythrough"),this.setMedia(this.audio),this.setLoadState(o.COMPLETE_STATE)}});const Wx=Yx;function $x(t){gr.call(this,t),this.addType(o.X3DSoundNode)}$x.prototype=Object.assign(Object.create(gr.prototype),{constructor:$x});const Kx=$x;function Qx(t){Kx.call(this,t),this.addType(o.Sound),this.addChildObjects("traversed",new Bn.SFBool(!0)),this._location.setUnit("length"),this._minBack.setUnit("length"),this._minFront.setUnit("length"),this._maxBack.setUnit("length"),this._maxFront.setUnit("length"),this.currentTraversed=!0}Qx.prototype=Object.assign(Object.create(Kx.prototype),{constructor:Qx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"intensity",new Bn.SFFloat(1)),new z(o.initializeOnly,"spatialize",new Bn.SFBool(!0)),new z(o.inputOutput,"location",new Bn.SFVec3f),new z(o.inputOutput,"direction",new Bn.SFVec3f(0,0,1)),new z(o.inputOutput,"minBack",new Bn.SFFloat(1)),new z(o.inputOutput,"minFront",new Bn.SFFloat(1)),new z(o.inputOutput,"maxBack",new Bn.SFFloat(10)),new z(o.inputOutput,"maxFront",new Bn.SFFloat(10)),new z(o.inputOutput,"priority",new Bn.SFFloat),new z(o.inputOutput,"source",new Bn.SFNode)]),getTypeName:function(){return"Sound"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},initialize:function(){Kx.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this._source.addInterest("set_source__",this),this.set_live__(),this.set_source__()},setTraversed:function(t){t?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=t},getTraversed:function(){return this.currentTraversed},set_live__:function(){this.isLive().getValue()&&this._traversed.getValue()?this.getBrowser().sensorEvents().addInterest("update",this):this.getBrowser().sensorEvents().removeInterest("update",this)},set_source__:function(){this.sourceNode&&this.sourceNode.setVolume(0),this.sourceNode=mr(o.X3DSoundSourceNode,this._source)},update:function(){this.getTraversed()||this.sourceNode&&this.sourceNode.setVolume(0),this.setTraversed(!1)},traverse:function(){const t={distance:0,intersection:new qt(0,0,0)},e={distance:0,intersection:new qt(0,0,0)};return function(n,i){if(n!==ir.DISPLAY)return;if(!this.sourceNode)return;if(!this.sourceNode._isActive.getValue()||this.sourceNode._isPaused.getValue())return;this.setTraversed(!0);const o=i.getModelViewMatrix().get();if(this.getEllipsoidParameter(o,Math.max(this._maxBack.getValue(),0),Math.max(this._maxFront.getValue(),0),e),e.distance<1)if(this.getEllipsoidParameter(o,Math.max(this._minBack.getValue(),0),Math.max(this._minFront.getValue(),0),t),t.distance<1)this.sourceNode.setVolume(this._intensity.getValue());else{const n=e.intersection.magnitude(),i=e.intersection.distance(t.intersection),o=Math.min(n/i,1),r=et.clamp(this._intensity.getValue(),0,1)*o;this.sourceNode.setVolume(r)}else this.sourceNode.setVolume(0)}}(),getEllipsoidParameter:function(){const t=new qt(0,0,0),e=new Ne,n=new Ne,i=new Ce,o=new qt(1,1,1),r=new A_(1,qt.Zero),s=new qt(0,0,0),a=new sc(qt.Zero,qt.zAxis),u=new qt(0,0,0),c=new qt(0,0,0);return function(l,h,d,f){if(0==h||0==d)return e.multVecMatrix(f.intersection.assign(this._location.getValue())),void(f.distance=1);const p=(h+d)/2,g=p-h,m=Math.sqrt(p*p-g*g);t.set(0,0,g),o.set(m,m,p),i.setFromToVec(qt.zAxis,this._direction.getValue()),e.assign(l).translate(this._location.getValue()).rotate(i).translate(t).scale(o),n.assign(e).inverse();const _=n.origin;t.negate().divVec(o),s.assign(t).subtract(_).normalize(),a.set(_,s),r.intersectsLine(a,u,c),f.intersection.assign(e.multVecMatrix(u)),f.distance=_.magnitude()}}()});const Zx={AudioClip:Wx,Sound:Qx},Jx={X3DSoundNode:Kx,X3DSoundSourceNode:qx};for(const t in Zx)Bi.addType(t,Zx[t]);for(const t in Jx)Bi.addAbstractType(t,Jx[t]);function ty(t){Gr.call(this,t),this.addType(o.Text),this._length.setUnit("length"),this._maxExtent.setUnit("length"),this._origin.setUnit("length"),this._textBounds.setUnit("length"),this._lineBounds.setUnit("length")}ty.prototype=Object.assign(Object.create(Gr.prototype),{constructor:ty,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"string",new Bn.MFString),new z(o.inputOutput,"length",new Bn.MFFloat),new z(o.inputOutput,"maxExtent",new Bn.SFFloat),new z(o.initializeOnly,"solid",new Bn.SFBool),new z(o.outputOnly,"origin",new Bn.SFVec3f),new z(o.outputOnly,"textBounds",new Bn.SFVec2f),new z(o.outputOnly,"lineBounds",new Bn.MFVec2f),new z(o.inputOutput,"fontStyle",new Bn.SFNode)]),getTypeName:function(){return"Text"},getComponentName:function(){return"Text"},getContainerField:function(){return"geometry"},initialize:function(){Gr.prototype.initialize.call(this),this._fontStyle.addInterest("set_fontStyle__",this),this.set_fontStyle__()},getMatrix:function(){return this.textGeometry.getMatrix()},getLength:function(t){return t<this._length.length?Math.max(0,this._length[t]):0},set_live__:function(){Gr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getBrowserOptions()._PrimitiveQuality.addInterest("requestRebuild",this):this.getBrowser().getBrowserOptions()._PrimitiveQuality.removeInterest("requestRebuild",this)},set_fontStyle__:function(){this.fontStyleNode&&this.fontStyleNode.removeInterest("requestRebuild",this),this.fontStyleNode=mr(o.X3DFontStyleNode,this._fontStyle),this.fontStyleNode||(this.fontStyleNode=this.getBrowser().getDefaultFontStyle()),this.fontStyleNode.addInterest("requestRebuild",this),this.textGeometry=this.fontStyleNode.getTextGeometry(this),this.setTransparent(this.textGeometry.getTransparent())},build:function(){this.textGeometry.update(),this.textGeometry.build(),this.setSolid(this._solid.getValue())},traverse:function(t,e){this.textGeometry.traverse(t,e),Gr.prototype.traverse.call(this,t,e)},display:function(t,e){this.textGeometry.display(t,e),Gr.prototype.display.call(this,t,e),e.textureNode=null},transformLine:function(t){return this.textGeometry.transformLine(t)},transformMatrix:function(t){return this.textGeometry.transformMatrix(t)}});const ey={FontStyle:rf,Text:ty},ny={X3DFontStyleNode:Od};for(const t in ey)Bi.addType(t,ey[t]);for(const t in ny)Bi.addAbstractType(t,ny[t]);function iy(t){us.call(this,t),qx.call(this,t),xo.call(this,t),this.addType(o.MovieTexture),this.canvas=$("<canvas></canvas>"),this.video=$("<video></video>"),this.urlStack=new Bn.MFString}iy.prototype=Object.assign(Object.create(us.prototype),qx.prototype,xo.prototype,{constructor:iy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"enabled",new Bn.SFBool(!0)),new z(o.inputOutput,"load",new Bn.SFBool(!0)),new z(o.inputOutput,"url",new Bn.MFString),new z(o.inputOutput,"autoRefresh",new Bn.SFTime),new z(o.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new z(o.inputOutput,"gain",new Bn.SFFloat(1)),new z(o.inputOutput,"speed",new Bn.SFFloat(1)),new z(o.inputOutput,"pitch",new Bn.SFFloat(1)),new z(o.inputOutput,"loop",new Bn.SFBool),new z(o.inputOutput,"startTime",new Bn.SFTime),new z(o.inputOutput,"resumeTime",new Bn.SFTime),new z(o.inputOutput,"pauseTime",new Bn.SFTime),new z(o.inputOutput,"stopTime",new Bn.SFTime),new z(o.outputOnly,"isPaused",new Bn.SFBool),new z(o.outputOnly,"isActive",new Bn.SFBool),new z(o.outputOnly,"elapsedTime",new Bn.SFTime),new z(o.outputOnly,"duration_changed",new Bn.SFTime(-1)),new z(o.initializeOnly,"repeatS",new Bn.SFBool(!0)),new z(o.initializeOnly,"repeatT",new Bn.SFBool(!0)),new z(o.initializeOnly,"textureProperties",new Bn.SFNode)]),getTypeName:function(){return"MovieTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){us.prototype.initialize.call(this),qx.prototype.initialize.call(this),xo.prototype.initialize.call(this),this.video.on("abort error",this.setError.bind(this)),this.video.on("suspend stalled",this.setTimeout.bind(this)),this.video[0].crossOrigin="Anonymous",this.video[0].preload="auto",this.video[0].muted=!0,this.requestImmediateLoad()},getElement:function(){return this.video[0]},set_live__:function(){qx.prototype.set_live__.call(this),xo.prototype.set_live__.call(this)},unLoadNow:function(){this.clearTexture()},loadNow:function(){this.setMedia(null),this.urlStack.setValue(this._url),this.video.on("canplaythrough",this.setVideo.bind(this)),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.video.off("canplaythrough"),this._duration_changed=-1,this.clearTexture(),void this.setLoadState(o.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.video.attr("src",this.URL.href),this.video.get(0).load()},setTimeout:function(t){setTimeout(function(){this.checkLoadState()===o.IN_PROGRESS_STATE&&this.setError(t)}.bind(this),3e3)},setError:function(t){"data:"!==this.URL.protocol&&console.warn("Error loading movie:",decodeURI(this.URL.href),t.type),this.loadNext()},setVideo:function(){try{this.video.unbind("canplaythrough");const t=this.video[0],e=t.videoWidth,n=t.videoHeight,i=this.canvas[0],r=i.getContext("2d",{willReadFrequently:!0});if(!et.isPowerOfTwo(e)||!et.isPowerOfTwo(n))throw new Error("The movie texture is a non power-of-two texture.");i.width=e,i.height=n,r.drawImage(t,0,0);const s=r.getImageData(0,0,e,n).data;this.setMedia(this.video),this.setTexture(e,n,!1,new Uint8Array(s.buffer),!0),this.setLoadState(o.COMPLETE_STATE)}catch(t){console.log(t.message),this.setError()}},set_time:function(){qx.prototype.set_time.call(this),this.checkLoadState()===o.COMPLETE_STATE&&this.updateTexture(this.getMedia()[0],!0)},traverse:us.prototype.traverse});const oy=iy;function ry(t){is.call(this,t),this.addType(o.MultiTexture),this.addChildObjects("loadState",new Bn.SFInt32(o.NOT_STARTED_STATE)),this.color=new Float32Array(4),this.modes=[],this.alphaModes=[],this.sources=[],this.functions=[],this.textureNodes=[]}ry.prototype=Object.assign(Object.create(is.prototype),{constructor:ry,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"color",new Bn.SFColor(1,1,1)),new z(o.inputOutput,"alpha",new Bn.SFFloat(1)),new z(o.inputOutput,"mode",new Bn.MFString),new z(o.inputOutput,"source",new Bn.MFString),new z(o.inputOutput,"function",new Bn.MFString),new z(o.inputOutput,"texture",new Bn.MFNode)]),getTypeName:function(){return"MultiTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){is.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this._alpha.addInterest("set_alpha__",this),this._mode.addInterest("set_mode__",this),this._source.addInterest("set_source__",this),this._function.addInterest("set_function__",this),this._texture.addInterest("set_texture__",this),this.set_color__(),this.set_alpha__(),this.set_mode__(),this.set_source__(),this.set_function__(),this.set_texture__(),this._loadState=o.COMPLETE_STATE},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureNodes.length)},getMode:function(t){return t<this.modes.length?this.modes[t]:Ph.MODULATE},getAlphaMode:function(t){return t<this.alphaModes.length?this.alphaModes[t]:Ph.MODULATE},getSource:function(t){return t<this.sources.length?this.sources[t]:Lh.DEFAULT},getFunction:function(t){return t<this.functions.length?this.functions[t]:Xh.DEFAULT},set_color__:function(){this.color[0]=this._color.r,this.color[1]=this._color.g,this.color[2]=this._color.b},set_alpha__:function(){this.color[3]=this._alpha},set_mode__:function(){const t=new Map([["REPLACE",Ph.REPLACE],["MODULATE",Ph.MODULATE],["MODULATE2X",Ph.MODULATE2X],["MODULATE4X",Ph.MODULATE4X],["ADD",Ph.ADD],["ADDSIGNED",Ph.ADDSIGNED],["ADDSIGNED2X",Ph.ADDSIGNED2X],["ADDSMOOTH",Ph.ADDSMOOTH],["SUBTRACT",Ph.SUBTRACT],["BLENDDIFFUSEALPHA",Ph.BLENDDIFFUSEALPHA],["BLENDTEXTUREALPHA",Ph.BLENDTEXTUREALPHA],["BLENDFACTORALPHA",Ph.BLENDFACTORALPHA],["BLENDCURRENTALPHA",Ph.BLENDCURRENTALPHA],["MODULATEALPHA_ADDCOLOR",Ph.MODULATEALPHA_ADDCOLOR],["MODULATEINVALPHA_ADDCOLOR",Ph.MODULATEINVALPHA_ADDCOLOR],["MODULATEINVCOLOR_ADDALPHA",Ph.MODULATEINVCOLOR_ADDALPHA],["DOTPRODUCT3",Ph.DOTPRODUCT3],["SELECTARG1",Ph.SELECTARG1],["SELECTARG2",Ph.SELECTARG2],["OFF",Ph.OFF]]);return function(){this.modes.length=0,this.alphaModes.length=0;for(const e of this._mode){const n=e.split(",");for(let t=0,e=n.length;t<e;++t)n[t]=n[t].trim();0===n.length&&n.push("MODULATE"),n.length<2&&n.push(n[0]);const i=t.get(n[0]);void 0!==i?this.modes.push(i):this.modes.push(Ph.MODULATE);const o=t.get(n[1]);void 0!==o?this.alphaModes.push(o):this.alphaModes.push(Ph.MODULATE)}}}(),set_source__:function(){const t=new Map([["DIFFUSE",Lh.DIFFUSE],["SPECULAR",Lh.SPECULAR],["FACTOR",Lh.FACTOR]]);return function(){this.sources.length=0;for(const e of this._source){const n=t.get(e);void 0!==n?this.sources.push(n):this.sources.push(Lh.DEFAULT)}}}(),set_function__:function(){const t=new Map([["COMPLEMENT",Xh.COMPLEMENT],["ALPHAREPLICATE",Xh.ALPHAREPLICATE]]);return function(){this.functions.length=0;for(const e of this._function){const n=t.get(e);void 0!==n?this.functions.push(n):this.functions.push(Xh.DEFAULT)}}}(),set_texture__:function(){this.textureNodes.length=0;for(const t of this._texture){const e=mr(o.X3DSingleTextureNode,t);e&&this.textureNodes.push(e)}},updateTextureBits:function(t){const e=this.getBrowser().getMaxTextures(),n=this.textureNodes,i=Math.min(e,n.length);for(let e=0;e<i;++e)n[e].updateTextureBits(t,e);t.set(2*e,1)},getShaderOptions:function(t){const e=this.textureNodes,n=Math.min(this.getBrowser().getMaxTextures(),e.length);for(let i=0;i<n;++i)e[i].getShaderOptions(t,i)},traverse:function(t,e){for(const n of this.textureNodes)n.traverse(t,e)},setShaderUniforms:function(t,e,n){const i=this.textureNodes,o=Math.min(this.getBrowser().getMaxTextures(),i.length);t.uniform4fv(e.x3d_MultiTextureColor,this.color);for(let r=0;r<o;++r)i[r].setShaderUniforms(t,e,n,e.x3d_Texture[r]),t.uniform1i(e.x3d_MultiTextureMode[r],this.getMode(r)),t.uniform1i(e.x3d_MultiTextureAlphaMode[r],this.getAlphaMode(r)),t.uniform1i(e.x3d_MultiTextureSource[r],this.getSource(r)),t.uniform1i(e.x3d_MultiTextureFunction[r],this.getFunction(r))}});const sy=ry;function ay(t){Xu.call(this,t),this.addType(o.MultiTextureCoordinate),this.textureCoordinateNodes=[]}ay.prototype=Object.assign(Object.create(Xu.prototype),{constructor:ay,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"texCoord",new Bn.MFNode)]),getTypeName:function(){return"MultiTextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){Xu.prototype.initialize.call(this),this._texCoord.addInterest("set_texCoord__",this),this.set_texCoord__()},set_texCoord__:function(){const t=this.textureCoordinateNodes;for(const e of t)e.removeInterest("addNodeEvent",this);t.length=0;for(const e of this._texCoord){const n=mr(o.X3DSingleTextureCoordinateNode,e);n&&t.push(n)}for(const e of t)e.addInterest("addNodeEvent",this)},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureCoordinateNodes.length)},isEmpty:function(){return!0},getSize:function(){return 0},get1Point:function(t,e){for(const n of this.textureCoordinateNodes)return n.get1Point(t,e);return e.set(0,0,0,1)},init:function(t){for(const e of this.textureCoordinateNodes)e.init(t)},addTexCoord:function(t,e){const n=this.textureCoordinateNodes;for(let i=0,o=n.length;i<o;++i)n[i].addTexCoordToChannel(t,e[i])},addTexCoordToChannel:function(t,e){},getTexCoord:function(t){for(const e of this.textureCoordinateNodes)return e.getTexCoord(t);return t},getTextureCoordinateMapping:function(t){const e=this.textureCoordinateNodes,n=Math.min(this.getBrowser().getMaxTextures(),e.length);for(let i=0;i<n;++i)e[i].getTextureCoordinateMapping(t,i)},setShaderUniforms:function(t,e){const n=this.textureCoordinateNodes,i=Math.min(e.x3d_MaxTextures,n.length);for(let o=0;o<i;++o)n[o].setShaderUniformsToChannel(t,e,o);if(i){const o=n.at(-1);for(let n=i,r=e.x3d_MaxTextures;n<r;++n)o.setShaderUniformsToChannel(t,e,n)}else for(let n=i,o=e.x3d_MaxTextures;n<o;++n)t.uniform1i(e.x3d_TextureCoordinateGeneratorMode[n],0)}});const uy=ay;function cy(t){df.call(this,t),this.addType(o.MultiTextureTransform),this.textureTransformNodes=[]}cy.prototype=Object.assign(Object.create(df.prototype),{constructor:cy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"textureTransform",new Bn.MFNode)]),getTypeName:function(){return"MultiTextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},initialize:function(){df.prototype.initialize.call(this),this._textureTransform.addInterest("set_textureTransform__",this),this.set_textureTransform__()},set_textureTransform__:function(){const t=this.textureTransformNodes;t.length=0;for(const e of this._textureTransform){const n=mr(o.X3DSingleTextureTransformNode,e);n&&t.push(n)}},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureTransformNodes.length)},getTextureTransformMapping:function(t){const e=this.textureTransformNodes,n=Math.min(this.getBrowser().getMaxTextures(),e.length);for(let i=0;i<n;++i)e[i].getTextureTransformMapping(t,i)},setShaderUniforms:function(){const t=new Float32Array(Ne.Identity);return function(e,n){const i=this.textureTransformNodes,o=Math.min(n.x3d_MaxTextures,i.length);for(let t=0;t<o;++t)i[t].setShaderUniformsToChannel(e,n,t);if(o){const t=i.at(-1);for(let i=o,r=n.x3d_MaxTextures;i<r;++i)t.setShaderUniformsToChannel(e,n,i)}else for(let i=o,r=n.x3d_MaxTextures;i<r;++i)e.uniformMatrix4fv(n.x3d_TextureMatrix[i],!1,t)}}()});const ly=cy;function hy(t){us.call(this,t),this.addType(o.PixelTexture),this.addChildObjects("loadState",new Bn.SFInt32(o.NOT_STARTED_STATE))}hy.prototype=Object.assign(Object.create(us.prototype),{constructor:hy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"description",new Bn.SFString),new z(o.inputOutput,"image",new Bn.SFImage(0,0,0,new Bn.MFInt32)),new z(o.initializeOnly,"repeatS",new Bn.SFBool(!0)),new z(o.initializeOnly,"repeatT",new Bn.SFBool(!0)),new z(o.initializeOnly,"textureProperties",new Bn.SFNode)]),getTypeName:function(){return"PixelTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){us.prototype.initialize.call(this),this._image.addInterest("set_image__",this),this.canvas1=$("<canvas></canvas>"),this.canvas2=$("<canvas></canvas>"),this.set_image__()},checkLoadState:function(){return this._loadState.getValue()},convert:function(t,e,n,i){switch(e){case 1:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=t[o+1]=t[o+2]=255&i,t[o+3]=255}break;case 2:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=t[o+1]=t[o+2]=i>>>8&255,t[o+3]=255&i}break;case 3:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=i>>>16&255,t[o+1]=i>>>8&255,t[o+2]=255&i,t[o+3]=255}break;case 4:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=i>>>24,t[o+1]=i>>>16&255,t[o+2]=i>>>8&255,t[o+3]=255&i}}},resize:function(t,e,n,i,o){const r=new Uint8Array(i*o*4),s=i/e,a=o/n;for(let n=0;n<o;++n){const o=Math.floor(n/a)*e,u=n*i;for(let e=0;e<i;++e){const n=4*(o+Math.floor(e/s)),i=4*(u+e);r[i]=t[n],r[i+1]=t[n+1],r[i+2]=t[n+2],r[i+3]=t[n+3]}}return r},set_image__:function(){const t=this.getBrowser().getContext(),e=this._image.comp,n=this._image.array,i=!(e%2);let r=this._image.width,s=this._image.height,a=null;if(r>0&&s>0&&e>0&&e<5){if(t.getVersion()>=2||et.isPowerOfTwo(r)&&et.isPowerOfTwo(s))a=new Uint8Array(r*s*4),this.convert(a,e,n.getValue(),n.length);else if(Math.max(r,s)<this.getBrowser().getMinTextureSize()&&!this._textureProperties.getValue()){a=new Uint8Array(r*s*4),this.convert(a,e,n.getValue(),n.length);const t=r,i=s;r=4*et.nextPowerOfTwo(t),s=4*et.nextPowerOfTwo(i),a=this.resize(a,t,i,r,s)}else{const t=this.canvas1[0],i=this.canvas2[0],o=t.getContext("2d",{willReadFrequently:!0}),u=i.getContext("2d",{willReadFrequently:!0}),c=o.createImageData(r,s);t.width=r,t.height=s,this.convert(c.data,e,n,n.length),o.putImageData(c,0,0),r=et.nextPowerOfTwo(r),s=et.nextPowerOfTwo(s),i.width=r,i.height=s,u.clearRect(0,0,r,s),u.drawImage(t,0,0,t.width,t.height,0,0,r,s),a=u.getImageData(0,0,r,s).data}this.setTexture(r,s,i,new Uint8Array(a.buffer),!1),this._loadState=o.COMPLETE_STATE}else this.clearTexture(),this._loadState=o.FAILED_STATE}});const dy=hy;function fy(t){zu.call(this,t),this.addType(o.TextureCoordinateGenerator),this.mode=zh.SPHERE,this.parameter=new Float32Array(6)}fy.prototype=Object.assign(Object.create(zu.prototype),{constructor:fy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"mapping",new Bn.SFString),new z(o.inputOutput,"mode",new Bn.SFString("SPHERE")),new z(o.inputOutput,"parameter",new Bn.MFFloat)]),getTypeName:function(){return"TextureCoordinateGenerator"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){zu.prototype.initialize.call(this),this._mode.addInterest("set_mode__",this),this._parameter.addInterest("set_parameter__",this),this.set_mode__(),this.set_parameter__()},set_mode__:function(){const t=new Map([["SPHERE",zh.SPHERE],["CAMERASPACENORMAL",zh.CAMERASPACENORMAL],["CAMERASPACEPOSITION",zh.CAMERASPACEPOSITION],["CAMERASPACEREFLECTIONVECTOR",zh.CAMERASPACEREFLECTIONVECTOR],["SPHERE-LOCAL",zh.SPHERE_LOCAL],["COORD",zh.COORD],["COORD-EYE",zh.COORD_EYE],["NOISE",zh.NOISE],["NOISE-EYE",zh.NOISE_EYE],["SPHERE-REFLECT",zh.SPHERE_REFLECT],["SPHERE-REFLECT-LOCAL",zh.SPHERE_REFLECT_LOCAL]]);return function(){this.mode=t.get(this._mode.getValue()),void 0===this.mode&&(this.mode=zh.SPHERE)}}(),set_parameter__:function(){const t=Math.min(this.parameter.length,this._parameter.length);for(let e=0;e<t;++e)this.parameter[e]=this._parameter[e];this.parameter.fill(0,t)},get1Point:function(t,e){return e},addTexCoordToChannel:function(t,e){e.push(0,0,0,1)},getTexCoord:function(t){return t},setShaderUniformsToChannel:function(t,e,n=0){t.uniform1i(e.x3d_TextureCoordinateGeneratorMode[n],this.mode),t.uniform1fv(e.x3d_TextureCoordinateGeneratorParameter[n],this.parameter)}});const py={ImageTexture:ls,MovieTexture:oy,MultiTexture:sy,MultiTextureCoordinate:uy,MultiTextureTransform:ly,PixelTexture:dy,TextureCoordinate:ku,TextureCoordinateGenerator:fy,TextureProperties:vu,TextureTransform:mf},gy={X3DSingleTextureCoordinateNode:zu,X3DSingleTextureNode:rs,X3DSingleTextureTransformNode:pf,X3DTexture2DNode:us,X3DTextureCoordinateNode:Xu,X3DTextureNode:is,X3DTextureTransformNode:df};for(const t in py)Bi.addType(t,py[t]);for(const t in gy)Bi.addAbstractType(t,gy[t]);const my={TimeSensor:Ts},_y={X3DTimeDependentNode:ys};for(const t in my)Bi.addType(t,my[t]);for(const t in _y)Bi.addAbstractType(t,_y[t]);function xy(){}xy.prototype={addComponent:function(t){if(t.types)for(const e in t.types)Bi.addType(e,t.types[e]);if(t.abstractTypes)for(const e in t.abstractTypes)Bi.addAbstractType(e,t.abstractTypes[e]);t.browserContext&&cp.addBrowserContext(t.browserContext),t.name}};const yy=new xy;function wy(t){Zn.call(this,t),this.addChildObjects("dimension",new Bn.SFInt32(40))}wy.prototype=Object.assign(Object.create(Zn.prototype),{constructor:wy,getTypeName:function(){return"ArcClose2DOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"arcClose2DOptions"}});const Ty=wy;function Sy(t){Zn.call(this,t),this.addChildObjects("dimension",new Bn.SFInt32(40))}Sy.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Sy,getTypeName:function(){return"Arc2DOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"arc2DOptions"}});const by=Sy;function vy(t){Zn.call(this,t),this.addChildObjects("dimension",new Bn.SFInt32(40)),this.vertices=Gr.createArray()}vy.prototype=Object.assign(Object.create(Zn.prototype),{constructor:vy,getTypeName:function(){return"Circle2DOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"circle2DOptions"},initialize:function(){this.addInterest("build",this),this.build()},getVertices:function(){return this.vertices},build:function(){const t=this._dimension.getValue(),e=2*Math.PI/t,n=this.vertices;n.length=0;for(let i=0;i<t;++i){const t=Wr.Polar(1,e*i),o=Wr.Polar(1,e*(i+1));n.push(t.real,t.imag,0,1),n.push(o.real,o.imag,0,1)}n.shrinkToFit()}});const Ey=vy;function Cy(t){Zn.call(this,t),this.addChildObjects("dimension",new Bn.SFInt32(40)),this.circleVertices=Gr.createArray(),this.diskTexCoords=Gr.createArray(),this.diskNormals=Gr.createArray(),this.diskVertices=Gr.createArray()}Cy.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Cy,getTypeName:function(){return"Disk2DOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"circle2DOptions"},initialize:function(){this.addInterest("build",this),this.build()},getCircleVertices:function(){return this.circleVertices},getDiskTexCoords:function(){return this.diskTexCoords},getDiskNormals:function(){return this.diskNormals},getDiskVertices:function(){return this.diskVertices},build:function(){const t=new Wr(.5,.5),e=new Wr(0,0),n=new Wr(0,0),i=new Wr(0,0),o=new Wr(0,0);return function(){const r=this._dimension.getValue(),s=2*Math.PI/r,a=this.circleVertices,u=this.diskTexCoords,c=this.diskNormals,l=this.diskVertices;a.length=0,u.length=0,c.length=0,l.length=0;for(let h=0;h<r;++h){const r=s*h,d=s*(h+1);e.setPolar(.5,r).add(t),n.setPolar(.5,d).add(t),i.setPolar(1,r),o.setPolar(1,d),a.push(i.real,i.imag,0,1),a.push(o.real,o.imag,0,1),u.push(.5,.5,0,1,e.real,e.imag,0,1,n.real,n.imag,0,1),c.push(0,0,1,0,0,1,0,0,1),l.push(0,0,0,1,i.real,i.imag,0,1,o.real,o.imag,0,1)}a.shrinkToFit(),u.shrinkToFit(),c.shrinkToFit(),l.shrinkToFit()}}()});const Oy=Cy;function Fy(t){Zn.call(this,t)}Fy.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Fy,getTypeName:function(){return"Rectangle2DOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"rectangle2DOptions"},initialize:function(){Zn.prototype.initialize.call(this)},getGeometry:function(){if(this.geometry)return this.geometry;this.geometry=new Vu(this.getExecutionContext()),this.geometry._texCoord=new ku(this.getExecutionContext()),this.geometry._coord=new Lu(this.getExecutionContext());const t=this.geometry,e=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();return t._texCoordIndex=new Bn.MFInt32(0,1,2,3,-1),t._coordIndex=new Bn.MFInt32(0,1,2,3,-1),e._point=new Bn.MFVec2f(new Bn.SFVec2f(1,1),new Bn.SFVec2f(0,1),new Bn.SFVec2f(0,0),new Bn.SFVec2f(1,0)),n._point=new Bn.MFVec3f(new Bn.SFVec3f(1,1,0),new Bn.SFVec3f(-1,1,0),new Bn.SFVec3f(-1,-1,0),new Bn.SFVec3f(1,-1,0)),e.setup(),n.setup(),t.setup(),this.geometry}});const Ny=Fy;function My(){}function Vy(t,e){const n=new e(this.getPrivateScene());return n.setup(),this[t]=function(){return n},Object.defineProperty(this,t,{enumerable:!1}),n}My.prototype={initialize:function(){this.setPrimitiveQuality2D(this.getBrowserOptions().getPrimitiveQuality())},getArc2DOptions:function(){return Vy.call(this,"getArc2DOptions",Ty)},getArcClose2DOptions:function(){return Vy.call(this,"getArcClose2DOptions",by)},getCircle2DOptions:function(){return Vy.call(this,"getCircle2DOptions",Ey)},getDisk2DOptions:function(){return Vy.call(this,"getDisk2DOptions",Oy)},getRectangle2DOptions:function(){return Vy.call(this,"getRectangle2DOptions",Ny)},setPrimitiveQuality2D:function(t){const e=this.getArc2DOptions(),n=this.getArcClose2DOptions(),i=this.getCircle2DOptions(),o=this.getDisk2DOptions();switch(t){case li.LOW:e._dimension=20,n._dimension=20,i._dimension=20,o._dimension=20;break;case li.MEDIUM:e._dimension=40,n._dimension=40,i._dimension=40,o._dimension=40;break;case li.HIGH:e._dimension=80,n._dimension=80,i._dimension=80,o._dimension=80}}};const Iy=My;function Dy(t){pc.call(this,t),this.addType(o.Arc2D),this._startAngle.setUnit("angle"),this._endAngle.setUnit("angle"),this._radius.setUnit("length")}Dy.prototype=Object.assign(Object.create(pc.prototype),{constructor:Dy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"startAngle",new Bn.SFFloat),new z(o.initializeOnly,"endAngle",new Bn.SFFloat(1.5708)),new z(o.initializeOnly,"radius",new Bn.SFFloat(1))]),getTypeName:function(){return"Arc2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},set_live__:function(){pc.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getArc2DOptions().addInterest("requestRebuild",this):this.getBrowser().getArc2DOptions().removeInterest("requestRebuild",this)},getSweepAngle:function(){const t=et.interval(this._startAngle.getValue(),0,2*Math.PI),e=et.interval(this._endAngle.getValue(),0,2*Math.PI);if(t===e)return 2*Math.PI;const n=Math.abs(e-t);return t>e?2*Math.PI-n:isNaN(n)?0:n},build:function(){const t=this.getBrowser().getArc2DOptions()._dimension.getValue(),e=this._startAngle.getValue(),n=Math.abs(this._radius.getValue()),i=this.getSweepAngle(),o=Math.max(3,Math.floor(i*t/(2*Math.PI))),r=this.getVertices();for(let t=0;t<o;++t){const s=e+i*(t/o),a=Wr.Polar(n,s),u=e+i*((t+1)/o),c=Wr.Polar(n,u);r.push(a.real,a.imag,0,1),r.push(c.real,c.imag,0,1)}this.getMin().set(-n,-n,0),this.getMax().set(n,n,0)}});const Ry=Dy;function Py(t){Gr.call(this,t),this.addType(o.ArcClose2D),this.setGeometryType(2),this._startAngle.setUnit("angle"),this._endAngle.setUnit("angle"),this._radius.setUnit("length")}Py.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Py,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"closureType",new Bn.SFString("PIE")),new z(o.initializeOnly,"startAngle",new Bn.SFFloat),new z(o.initializeOnly,"endAngle",new Bn.SFFloat(1.5708)),new z(o.initializeOnly,"radius",new Bn.SFFloat(1)),new z(o.initializeOnly,"solid",new Bn.SFBool)]),getTypeName:function(){return"ArcClose2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},set_live__:function(){Gr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getArcClose2DOptions().addInterest("requestRebuild",this):this.getBrowser().getArcClose2DOptions().removeInterest("requestRebuild",this)},getSweepAngle:function(){const t=et.interval(this._startAngle.getValue(),0,2*Math.PI),e=et.interval(this._endAngle.getValue(),0,2*Math.PI);if(t===e)return 2*Math.PI;const n=Math.abs(e-t);return t>e?2*Math.PI-n:isNaN(n)?0:n},build:function(){const t=new Wr(.5,.5);return function(){const e=this.getBrowser().getArcClose2DOptions(),n="CHORD"===this._closureType.getValue(),i=e._dimension.getValue(),o=this._startAngle.getValue(),r=Math.abs(this._radius.getValue()),s=this.getSweepAngle(),a=Math.max(4,Math.floor(s*i/(2*Math.PI))),u=this.getTexCoords(),c=this.getNormals(),l=this.getVertices(),h=[],d=[];this.getMultiTexCoords().push(u);const f=a-1;for(let e=0;e<a;++e){const n=o+s*(e/f);h.push(Wr.Polar(.5,n).add(t)),d.push(Wr.Polar(r,n))}if(n){const t=h[0],e=d[0];for(let n=1;n<f;++n){const i=h[n],o=h[n+1],r=d[n],s=d[n+1];u.push(t.real,t.imag,0,1,i.real,i.imag,0,1,o.real,o.imag,0,1),c.push(0,0,1,0,0,1,0,0,1),l.push(e.real,e.imag,0,1,r.real,r.imag,0,1,s.real,s.imag,0,1)}}else for(let t=0;t<f;++t){const e=h[t],n=h[t+1],i=d[t],o=d[t+1];u.push(.5,.5,0,1,e.real,e.imag,0,1,n.real,n.imag,0,1),c.push(0,0,1,0,0,1,0,0,1),l.push(0,0,0,1,i.real,i.imag,0,1,o.real,o.imag,0,1)}this.getMin().set(-r,-r,0),this.getMax().set(r,r,0),this.setSolid(this._solid.getValue())}}()});const Ay=Py;function Ly(t){pc.call(this,t),this.addType(o.Circle2D),this._radius.setUnit("length")}Ly.prototype=Object.assign(Object.create(pc.prototype),{constructor:Ly,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"radius",new Bn.SFFloat(1))]),getTypeName:function(){return"Circle2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},set_live__:function(){pc.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getCircle2DOptions().addInterest("requestRebuild",this):this.getBrowser().getCircle2DOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getCircle2DOptions(),e=this.getVertices(),n=this._radius.getValue();if(1===n)this.setVertices(t.getVertices());else{const i=t.getVertices().getValue();for(let t=0,o=i.length;t<o;t+=4)e.push(i[t]*n,i[t+1]*n,0,1)}this.getMin().set(-n,-n,0),this.getMax().set(n,n,0)}});const By=Ly;function Xy(t){pc.call(this,t),this.addType(o.Disk2D),this._innerRadius.setUnit("length"),this._outerRadius.setUnit("length")}Xy.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Xy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"innerRadius",new Bn.SFFloat),new z(o.initializeOnly,"outerRadius",new Bn.SFFloat(1)),new z(o.initializeOnly,"solid",new Bn.SFBool)]),getTypeName:function(){return"Disk2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},initialize:function(){Gr.prototype.initialize.call(this)},set_live__:function(){Gr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getDisk2DOptions().addInterest("requestRebuild",this):this.getBrowser().getDisk2DOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser(),e=t.getContext(),n=t.getDisk2DOptions(),i=Math.min(Math.abs(this._innerRadius.getValue()),Math.abs(this._outerRadius.getValue())),o=Math.max(Math.abs(this._innerRadius.getValue()),Math.abs(this._outerRadius.getValue()));if(i===o){const t=this.getVertices();if(0===o)return t.push(0,0,0,1),this.getMin().set(0,0,0),this.getMax().set(0,0,0),this.setGeometryType(0),this.setPrimitiveMode(e.POINTS),this.setTransparent(!0),void this.setBase(rx);if(1===o)this.setVertices(n.getCircleVertices());else{const e=n.getCircleVertices().getValue();for(let n=0,i=e.length;n<i;n+=4)t.push(e[n]*o,e[n+1]*o,0,1)}return this.getMin().set(-o,-o,0),this.getMax().set(o,o,0),this.setGeometryType(1),this.setPrimitiveMode(e.LINES),this.setTransparent(!1),void this.setBase(pc)}if(0===i){if(this.getMultiTexCoords().push(n.getDiskTexCoords()),this.setNormals(n.getDiskNormals()),1===o)this.setVertices(n.getDiskVertices());else{const t=n.getDiskVertices().getValue(),e=this.getVertices();for(let n=0,i=t.length;n<i;n+=4)e.push(t[n]*o,t[n+1]*o,0,1)}return this.getMin().set(-o,-o,0),this.getMax().set(o,o,0),this.setGeometryType(2),this.setPrimitiveMode(e.TRIANGLES),this.setTransparent(!1),this.setSolid(this._solid.getValue()),void this.setBase(Gr)}const r=i/o,s=(1-r)/2,a=n.getDiskTexCoords().getValue(),u=n.getDiskVertices().getValue(),c=this.getTexCoords(),l=this.getNormals(),h=this.getVertices();this.getMultiTexCoords().push(c);for(let t=0,e=u.length;t<e;t+=12)c.push(a[t+4]*r+s,a[t+5]*r+s,0,1,a[t+4],a[t+5],0,1,a[t+8],a[t+9],0,1,a[t+4]*r+s,a[t+5]*r+s,0,1,a[t+8],a[t+9],0,1,a[t+8]*r+s,a[t+9]*r+s,0,1),l.push(0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1),h.push(u[t+4]*i,u[t+5]*i,0,1,u[t+4]*o,u[t+5]*o,0,1,u[t+8]*o,u[t+9]*o,0,1,u[t+4]*i,u[t+5]*i,0,1,u[t+8]*o,u[t+9]*o,0,1,u[t+8]*i,u[t+9]*i,0,1);this.getMin().set(-o,-o,0),this.getMax().set(o,o,0),this.setGeometryType(2),this.setPrimitiveMode(e.TRIANGLES),this.setTransparent(!1),this.setSolid(this._solid.getValue()),this.setBase(Gr)},setBase:function(t){this.intersectsLine=t.prototype.intersectsLine,this.intersectsBox=t.prototype.intersectsBox,this.display=t.prototype.display,this.displayParticles=t.prototype.displayParticles},updateRenderFunctions:function(){}});const Uy=Xy;function zy(t){pc.call(this,t),this.addType(o.Polyline2D),this._lineSegments.setUnit("length")}zy.prototype=Object.assign(Object.create(pc.prototype),{constructor:zy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"lineSegments",new Bn.MFVec2f)]),getTypeName:function(){return"Polyline2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},build:function(){const t=this._lineSegments.getValue(),e=this.getVertices();for(let n=0,i=2*(this._lineSegments.length-1);n<i;n+=2)e.push(t[n+0],t[n+1],0,1),e.push(t[n+2],t[n+3],0,1)}});const jy=zy;function ky(t){rx.call(this,t),this.addType(o.Polypoint2D),this._point.setUnit("length")}ky.prototype=Object.assign(Object.create(rx.prototype),{constructor:ky,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"point",new Bn.MFVec2f)]),getTypeName:function(){return"Polypoint2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},build:function(){const t=this._point.getValue(),e=this.getVertices();for(let n=0,i=2*this._point.length;n<i;n+=2)e.push(t[n],t[n+1],0,1)}});const Gy=ky;function Hy(t){Gr.call(this,t),this.addType(o.Rectangle2D),this.setGeometryType(2),this._size.setUnit("length")}Hy.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Hy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.initializeOnly,"size",new Bn.SFVec2f(2,2)),new z(o.initializeOnly,"solid",new Bn.SFBool)]),getTypeName:function(){return"Rectangle2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},build:function(){const t=new jt(2,2);return function(){const e=this.getBrowser().getRectangle2DOptions().getGeometry(),n=this._size.getValue();if(this.setMultiTexCoords(e.getMultiTexCoords()),this.setNormals(e.getNormals()),n.equals(t))this.setVertices(e.getVertices()),this.getMin().assign(e.getMin()),this.getMax().assign(e.getMax());else{const t=qt.divide(n,2),i=t.x,o=t.y,r=e.getVertices().getValue(),s=this.getVertices();for(let t=0;t<r.length;t+=4)s.push(i*r[t],o*r[t+1],0,1);this.getMin().set(-i,-o,0),this.getMax().set(i,o,0)}this.setSolid(this._solid.getValue())}}()});const qy=Hy;function Yy(t){Gr.call(this,t),this.addType(o.TriangleSet2D),this.setGeometryType(2),this._vertices.setUnit("length")}Yy.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Yy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new W([new z(o.inputOutput,"metadata",new Bn.SFNode),new z(o.inputOutput,"vertices",new Bn.MFVec2f),new z(o.initializeOnly,"solid",new Bn.SFBool)]),getTypeName:function(){return"TriangleSet2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},build:function(){const t=this._vertices.getValue(),e=this.getNormals(),n=this.getVertices();for(let i=0,o=2*this._vertices.length;i<o;i+=2)e.push(0,0,1),n.push(t[i],t[i+1],0,1);this.setSolid(this._solid.getValue())},buildTexCoords:function(){const t=this.getTexCoords();if(0===t.length){const e=this.getTexCoordParams(),n=e.min,i=e.Ssize,o=this.getVertices().getValue();for(let e=0,r=o.length;e<r;e+=4)t.push((o[e]-n[0])/i,(o[e+1]-n[1])/i,0,1);t.shrinkToFit()}this.getMultiTexCoords().push(t)}});const Wy=Yy;yy.addComponent({name:"Geometry2D",types:{Arc2D:Ry,ArcClose2D:Ay,Circle2D:By,Disk2D:Uy,Polyline2D:jy,Polypoint2D:Gy,Rectangle2D:qy,TriangleSet2D:Wy},abstractTypes:{},browserContext:Iy})})();