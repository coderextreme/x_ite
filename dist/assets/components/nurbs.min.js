!function(){const t=window[Symbol.for("X_ITE.X3D-5.0.2")].define,e=window[Symbol.for("X_ITE.X3D-5.0.2")].require;t("x_ite/Components/NURBS/Contour2D",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Core/X3DNode","x_ite/Base/X3DConstants","x_ite/Base/X3DCast"],(function(t,e,i,n,o,r){"use strict";function s(t){n.call(this,t),this.addType(o.Contour2D),this.childNodes=[]}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(o.inputOutput,"metadata",new t.SFNode),new e(o.inputOnly,"addChildren",new t.MFNode),new e(o.inputOnly,"removeChildren",new t.MFNode),new e(o.inputOutput,"children",new t.MFNode)]),getTypeName:function(){return"Contour2D"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"trimmingContour"},initialize:function(){n.prototype.initialize.call(this),this._children.addInterest("set_children__",this),this.set_children__()},set_children__:function(){var t=this.childNodes;t.length=0;for(var e=0,i=this._children.length;e<i;++e){var n;if(n=r(o.NurbsCurve2D,this._children[e]))t.push(n);else(n=r(o.ContourPolyline2D,this._children[e]))&&t.push(n)}},addTrimmingContour:function(t){for(var e=this.childNodes,i=0,n=e.length;i<n;++i)t.push(e[i].tessellate(2))}}),s})),t("x_ite/Components/NURBS/X3DNurbsControlCurveNode",["x_ite/Components/Core/X3DNode","x_ite/Base/X3DConstants"],(function(t,e){"use strict";function i(i){t.call(this,i),this.addType(e.X3DNurbsControlCurveNode)}return i.prototype=Object.assign(Object.create(t.prototype),{constructor:i}),i})),t("x_ite/Components/NURBS/ContourPolyline2D",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/NURBS/X3DNurbsControlCurveNode","x_ite/Base/X3DConstants","standard/Math/Numbers/Vector3"],(function(t,e,i,n,o,r){"use strict";function s(t){n.call(this,t),this.addType(o.ContourPolyline2D),this.controlPoints=[]}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(o.inputOutput,"metadata",new t.SFNode),new e(o.inputOutput,"controlPoint",new t.MFVec2d)]),getTypeName:function(){return"ContourPolyline2D"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},tessellate:function(t){switch(t){case 0:for(var e=this._controlPoint.getValue(),i=this.controlPoints,n=0,o=this._controlPoint.length;n<o;++n){i[(s=2*n)+0]=e[s+0],i[s+1]=e[s+1]}return i.length=2*o,i;case 1:for(e=this._controlPoint.getValue(),i=this.controlPoints,n=0,o=this._controlPoint.length;n<o;++n){var s=2*n,u=3*n;i[u+0]=e[s+0],i[u+1]=0,i[u+2]=e[s+1]}return i.length=3*o,i;case 3:for(e=this._controlPoint.getValue(),i=this.controlPoints,n=0,o=this._controlPoint.length;n<o;++n){s=2*n;i[n]=new r(e[s+0],e[s+1],0)}return i.length=o,i}}}),s})),t("x_ite/Components/NURBS/CoordinateDouble",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Rendering/X3DCoordinateNode","x_ite/Base/X3DConstants"],(function(t,e,i,n,o){"use strict";function r(t){n.call(this,t),this.addType(o.CoordinateDouble)}return r.prototype=Object.assign(Object.create(n.prototype),{constructor:r,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(o.inputOutput,"metadata",new t.SFNode),new e(o.inputOutput,"point",new t.MFVec3d)]),getTypeName:function(){return"CoordinateDouble"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"coord"}}),r})),t("x_ite/Browser/NURBS/NURBS",["standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Vector4"],(function(t,e,i){"use strict";var n,o;return{getTessellation:function(t,e){return t>0?t+1:t<0?-t*e+1:2*e+1},getClosed2D:function(t,e,i,n){var o=n.length;return(!(i.length===o)||i[0]===i[o-1])&&(!!n[0].equals(n[o-1])&&!!this.isPeriodic(t,o,e))},getClosed:(n=new e(0,0,0),o=new e(0,0,0),function(t,e,i,r){var s=r.getSize();return!(i.length===s&&i[0]!==i[s-1]||!r.get1Point(0,n).equals(r.get1Point(s-1,o))||!this.isPeriodic(t,s,e))}),getUClosed:function(){var t=new e(0,0,0),i=new e(0,0,0);return function(e,n,o,r,s,u){for(var a=s.length===u.getSize(),l=0,h=o;l<h;++l){var d=l*n,c=l*n+n-1;if(a&&s[d]!==s[c])return!1;if(!u.get1Point(d,t).equals(u.get1Point(c,i)))return!1}return!!this.isPeriodic(e,n,r)}}(),getVClosed:function(){var t=new e(0,0,0),i=new e(0,0,0);return function(e,n,o,r,s,u){for(var a=s.length===u.getSize(),l=0,h=n;l<h;++l){var d=l,c=(o-1)*n+l;if(a&&s[d]!==s[c])return!1;if(!u.get1Point(d,t).equals(u.get1Point(c,i)))return!1}return!!this.isPeriodic(e,o,r)}}(),isPeriodic:function(t,e,i){if(i.length===e+t){for(var n=1,o=1,r=t;o<r;++o)n+=i[o]===i[0];if(n===t)return!1;for(n=1,o=i.length-t,r=i.length-1;o<r;++o)n+=i[o]===i[r];if(n===t)return!1}return!0},getKnots:function(t,e,i,n,o){for(var r=t||[],s=0,u=o.length;s<u;++s)r[s]=o[s];r.length=o.length;var a=!0;if(r.length===n+i){a=!1;var l=0;for(s=1,u=r.length;s<u;++s)r[s]==r[s-1]?++l:l=0,l>i-1&&(a=!0),r[s-1]>r[s]&&(a=!0)}if(a)for(s=0,u=n+i;s<u;++s)r[s]=s/(u-1);if(e)for(s=1,u=i-1;s<u;++s)r.push(r.at(-1)+(r[s]-r[s-1]));return r},getWeights:function(t,e,i){if(i.length===e){for(var n=t||[],o=0;o<e;++o)n[o]=i[o];return n.length=e,n}},getUVWeights:function(t,e,i,n){var o=e*i;if(n.length===o){for(var r=t||[],s=0,u=0;s<e;++s)for(var a=0;a<i;++a,++u)r[u]=n[u];return r.length=o,r}},getControlPoints2D:function(i,n,o,r,s){var u=i||[],a=s.getValue(),l=s.length,h=Boolean(r),d=h?e:t;u.haveWeights!==h&&(u.haveWeights=h,u.length=0);for(var c=0;c<l;++c){var g=2*c,f=u[c]||new d(0,0,0);u[c]=f.set(a[g+0],a[g+1],h?r[c]:0)}if(u.length=l,n){c=1;for(var p=o-1;c<p;++c)u.push(u[c])}return u},getControlPoints:function(t,n,o,r,s){var u=t||[],a=s.getSize(),l=Boolean(r),h=l?i:e;u.haveWeights!==l&&(u.haveWeights=l,u.length=0);for(var d=0;d<a;++d){var c=u[d]=s.get1Point(d,u[d]||new h(0,0,0,0));l&&(c.w=r[d])}if(u.length=a,n){d=1;for(var g=o-1;d<g;++d)u.push(u[d])}return u},getUVControlPoints:function(t,n,o,r,s,u,a,l,h){var d=t||[],c=Boolean(l),g=c?i:e;d.haveWeights!==c&&(d.haveWeights=c,d.length=0);for(var f=0;f<u;++f){var p=d[f];p||(p=d[f]=[]);for(var _=0;_<a;++_){var m=_*u+f;p[_]=h.get1Point(m,p[_]||new g(0,0,0,0)),c&&(p[_].w=l[m])}if(p.length=a,o)for(var v=1,y=s-1;v<y;++v)p.push(p[v])}if(d.length=u,n)for(v=1,y=r-1;v<y;++v)d.push(d[v]);return d},getTexControlPoints:function(t,e,n,o,r,s,u,a){for(var l=t||[],h=0;h<s;++h){var d=l[h];d||(d=l[h]=[]);for(var c=0;c<u;++c){var g=c*s+h;d[c]=a.get1Point(g,d[c]||new i(0,0,0,0))}if(d.length=u,n)for(var f=1,p=r-1;f<p;++f)d.push(d[f])}if(l.length=s,e)for(f=1,p=o-1;f<p;++f)l.push(l[f]);return l}}})),t("x_ite/Components/NURBS/X3DParametricGeometryNode",["x_ite/Components/Rendering/X3DGeometryNode","x_ite/Base/X3DConstants","x_ite/Browser/NURBS/NURBS"],(function(t,e,i){"use strict";function n(i){t.call(this,i),this.addType(e.X3DParametricGeometryNode)}return n.prototype=Object.assign(Object.create(t.prototype),{constructor:n,getKnots:function(t,e,n,o,r){return i.getKnots(t,e,n,o,r)}}),n})),t("nurbs/src/utils/is-ndarray",[],(function(){"use strict";return function(t){return!!t&&(!!t.dtype&&new RegExp("function View[0-9]+d(:?"+t.dtype+")+").test(String(t.constructor)))}})),t("nurbs/src/utils/is-ndarray-like",[],(function(){"use strict";return function(t){return!!t&&(void 0!==t.data&&Array.isArray(t.shape)&&void 0!==t.offset&&void 0!==t.stride)}})),t("nurbs/src/utils/is-array-like",[],(function(){"use strict";return function(t){return Array.isArray(t)||ArrayBuffer.isView(t)||void 0!==t.length}})),t("nurbs/src/utils/infer-type",["nurbs/src/utils/is-ndarray","nurbs/src/utils/is-ndarray-like","nurbs/src/utils/is-array-like"],(function(t,e,i){"use strict";function n(o){if(o){if(t(o)||e(o))return"generic"===o.dtype?n.GENERIC_NDARRAY:n.NDARRAY;if(i(o)){for(var r=o;i(r[0]);r=r[0]);return"x"in r?n.ARRAY_OF_OBJECTS:n.ARRAY_OF_ARRAYS}throw new Error("Unhandled data type. Got type: "+typeof o)}}return n.ARRAY_OF_OBJECTS="Obj",n.ARRAY_OF_ARRAYS="Arr",n.NDARRAY="Nd",n.GENERIC_NDARRAY="GenNd",n.PACKED="PackArr",n})),t("nurbs/src/utils/cache-key",["nurbs/src/utils/is-array-like"],(function(t){"use strict";return function(e,i,n,o,r,s){var u,a,l=[],h=!1;for(u=0;u<e.splineDimension;u++){var d=t(e.knots)&&t(e.knots[u]);d&&(h=!0),l.push("Deg"+e.degree[u]+(d?"":"Uniform")+((a=e.boundary[u])[0].toUpperCase()+a.slice(1)))}var c=[[h?"NU":"",e.weights?"RBS":"BS"].join("")+e.dimension+"D",l.join("_")];return o&&c.push(o+"Pts"),r&&c.push(r+"Wts"),s&&c.push(s+"Kts"),i&&c.push("debug"),n&&c.push("chk"),c.join("_")}})),t("nurbs/src/utils/variable",[],(function(){"use strict";var t=function t(e,i){return function(i,n){void 0===i||Array.isArray(i)||(i=[i]);for(var o=[],r=0;r<i.length;r++)o.push(t.sum(i[r]));if(n)for(i=0;i<o.length;i++)void 0!==n[i]&&(o[i]="("+o[i]+" + "+n[i]+") % "+n[i]);return e+o.join("_")}};return t.sum=function(t){return 0===(t=(t=Array.isArray(t)?t:[t]).filter((function(t){return void 0!==t&&0!==t}))).length&&t.push(0),t.join(" + ")},t})),t("nurbs/src/utils/create-accessors",["nurbs/src/utils/infer-type","nurbs/src/utils/variable"],(function(t,e){"use strict";var i=[".x",".y",".z",".w"];function n(t){return function(i,n){void 0===i||Array.isArray(i)||(i=[i]);for(var o=[],r=0;r<i.length;r++)o.push(e.sum(i[r]));if(n)for(i=0;i<o.length;i++)void 0!==n[i]&&(o[i]="("+o[i]+" + "+n[i]+") % "+n[i]);return t(o)}}function o(e,o){if(o)switch(t(o)){case t.ARRAY_OF_OBJECTS:return n((function(t){var n=t.pop();return e+"["+t.join("][")+"]"+i[n]}));case t.ARRAY_OF_ARRAYS:return n((function(t){return e+"["+t.join("][")+"]"}));case t.GENERIC_NDARRAY:return n((function(t){return e+".get("+t.join(",")+")"}));case t.NDARRAY:return n((function(t){for(var i=[e+"Offset"],n=0;n<t.length;n++)i.push(e+"Stride"+n+" * ("+t[n]+")");return e+"["+i.join(" + ")+"]"}));case t.PACKED:default:return}}return function(t){var e,i={};return(e=o("x",t.points))&&(i.point=e),(e=o("w",t.weights))&&(i.weight=e),(e=o("k",t.knots))&&(i.knot=e),i}})),t("nurbs/src/numerical-derivative",[],(function(){"use strict";var t=[],e=[];return function(i,n,o){if(1!==n)throw new Error("Numerical derivative not implemented for order n = "+n+".");var r,s=void 0===arguments[this.splineDimension+3]?1e-4:arguments[this.splineDimension+3];for(t.length=this.splineDimension,r=0;r<this.splineDimension;r++)t[r+1]=arguments[r+3];var u,a,l,h=this.domain,d=h[o][0],c=h[o][1],g=t[o+1],f=(c-d)*s;for("closed"===this.boundary[o]?(u=d+(g-d-f+(l=c-d))%l,a=d+(g-d+f+l)%l,f*=2):(u=Math.min(c,Math.max(d,g-f)),f=(a=Math.min(c,Math.max(d,g+f)))-u),t[o+1]=u,t[0]=e,this.evaluate.apply(null,t),t[o+1]=a,t[0]=i,this.evaluate.apply(null,t),r=0;r<this.dimension;r++)i[r]=(i[r]-e[r])/f;return i}})),t("nurbs/src/utils/ndloop",[],(function(){"use strict";return function(t,e){for(var i=1,n=0,o=[];n<t.length;n++)i*=Array.isArray(t[n])?t[n][1]-t[n][0]:t[n],o[n]=Array.isArray(t[n])?t[n][0]:0;for(var r=0;r<i;r++)for(e(o.slice()),n=t.length-1;n>=0;n--){if(o[n]!==(Array.isArray(t[n])?t[n][1]:t[n])-1){o[n]++;break}o[n]=Array.isArray(t[n])?t[n][0]:0}}})),t("nurbs/src/utils/accessor-preamble",["nurbs/src/utils/infer-type"],(function(t){"use strict";return function(e,i,n,o){var r=[];switch(t(o)){case t.NDARRAY:r.push("  var "+i+" = "+n+".data;"),r.push("  var "+i+"Offset = "+n+".offset;");for(var s=0;s<o.dimension;s++)r.push("  var "+i+"Stride"+s+" = "+n+".stride["+s+"];");break;case t.ARRAY_OF_OBJECTS:case t.ARRAY_OF_ARRAYS:r.push("  var "+i+" = "+n+";")}return r.join("\n")}})),t("nurbs/src/utils/size-getter",["nurbs/src/utils/is-ndarray-like"],(function(t){"use strict";return function(e,i,n){if(e){if(t(e))return i+".shape["+n+"]";for(var o=i,r=0;r<n;r++)o+="[0]";return o+".length"}return"this.size["+n+"]"}})),t("nurbs/src/evaluate",["nurbs/src/utils/ndloop","nurbs/src/utils/variable","nurbs/src/utils/accessor-preamble","nurbs/src/utils/infer-type","nurbs/src/utils/is-array-like","nurbs/src/utils/size-getter"],(function(t,e,i,n,o,r){"use strict";var s={},u={};return function(a,l,h,d,c,g,f){var p,_,m,v,y,N,w=l.splineDimension,b=l.points,C=l.degree,S=l.weights,D=void 0!==S,x=l.knots,O=l.dimension,F=l.boundary;if(null!=f){Array.isArray(f)||(f=[f]);var B=0;for(p=0;p<w;p++)void 0===f[p]&&(f[p]=0),B+=f[p];if(D&&B>1)throw new Error("Analytical derivative not implemented for rational b-splines with order n = "+B+".")}g&&(a="Basis"+a),f&&(a="Der"+f.join("_")+"_"+a);var P=s[a];if(d)var R="function"==typeof d?d:console.log;if(P)return d&&R(u[a]),P.bind(l);var V=[],T="evaluate"+a,I=h.point;g&&(I=function(t,e){for(var i=[],n=0;n<t.length;n++){for(var o=t[n],r=[],s=0;s<o.length;s++)0!==o[s]&&r.push(o[s]);o=r.join(" + "),e[n]&&(o="("+o+" + "+e[n]+") % "+e[n]),i.push(o+" === "+U(n))}return"(("+i.join(" && ")+") ? 1 : 0)"});var z=h.weight,A=h.knot,k=e("k"),X=e("x"),j=e("w"),U=e("i"),M=e("t"),E=d?"domain":"d",K=e(d?"size":"s"),G=e(d?"knotIndex":"j"),W=!0;for(y=0;y<w;y++)o(x)&&o(x[y])&&(W=!1);function q(t){V.push("  "+(t||""))}function Y(t){d&&q(t)}if(g)var J=[];var L=[];for(p=0;p<w;p++)g&&J.push(U([p])),L.push(M([p]));for(V.push("function "+T+" ("+(g?"":"out, ")+L.join(", ")+(g?", "+J.join(", "):"")+") {"),q("var h, m, a, b;"),c&&(q("var "+E+" = this.domain;"),q("for (var i = 0; i < this.splineDimension; i++) {"),q("  a = arguments[i + 1];"),q("  if (a < "+E+"[i][0] || a > "+E+"[i][1] || a === undefined || isNaN(a)) {"),q("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+E+"[i][0]+', '+"+E+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),q("  }"),q("}")),y=0;y<w;y++)q("var "+K(y)+" = "+r(b,"this.points",y)+";");function Z(t,e,i){return"("+t+") ? ("+e+") : ("+i+")"}V.push(i(l,"x","this.points",b)),D&&V.push(i(l,"w","this.weights",S)),W||V.push(i(l,"k","this.knots",x));var H=[];for(y=0;y<w;y++)switch(n(x)){case n.NDARRAY:H[y]=!0;break;case n.ARRAY_OF_ARRAYS:H[y]=o(x[y])}for(y=0;y<w;y++)if(H[y])for(Y("\n  // Bisect to locate the knot interval in dimension "+y+"\n"),q("var "+G(y)+" = 0;"),q("h = "+K(y)+";"),q("while(h > "+G(y)+" + 1) {"),q("  m = 0.5 * (h + "+G(y)+") | 0;"),q("  if ("+A([y,"m"])+" > "+M(y)+") h = m;"),q("  else "+G(y)+" = m;"),q("}"),Y("\n  // Fetch knots for dimension "+y+"\n"),p=1-C[y];p<=C[y];p++)"closed"===F[y]?q(p<0?"var "+k([y,p+C[y]-1])+" = "+Z(G(y)+" < "+-p,A([y,0])+" + "+A([y,[K(y),G(y),p]])+" - "+A([y,[K(y)]]),A([y,[G(y),p]]))+";":p>0?"var "+k([y,p+C[y]-1])+" = "+Z(G(y)+" + "+p+" > "+K(y),A([y,K(y)])+" + "+A([y,p+" + "+G(y)+" - "+K(y)])+" - "+A([y,0]),A([y,[G(y),p]]))+";":"var "+k([y,p+C[y]-1])+" = "+A([y,[G(y),p]])+";"):q("var "+k([y,p+C[y]-1])+" = "+A([y,[G(y),p]])+";");else{for(Y("\n  // Directly compute knot interval for dimension "+y+"\n"),"closed"===F[y]?q(G(y)+" = ("+M(y)+" | 0) % "+K(y)+";"):(q(G(y)+" = ("+M(y)+" | 0);"),q("if ("+G(y)+" < "+C[y]+") "+G(y)+" = "+C[y]+";"),q("if ("+G(y)+" > "+K(y)+" - 1) "+G(y)+" = "+K(y)+" - 1;")),Y("\n  // Compute and clamp knots for dimension "+y+"\n"),p=1-C[y];p<=C[y];p++)q("var "+(N=k([y,p+C[y]-1]))+" = "+G(y)+" + "+p+";");if("clamped"===F[y])for(p=1-C[y];p<=C[y];p++)N=k([y,p+C[y]-1]),p<0&&q("if ("+N+" < "+C[y]+") "+N+" = "+C[y]+";"),p>0&&q("if ("+N+" > "+K(y)+") "+N+" = "+K(y)+";");"closed"===F[y]&&(Y("\n  // Wrap the B-Spline parameter for closed boundary"),q(M(y)+" %= "+K(y)+";"))}for(y=0,m=[];y<w;y++)m[y]=C[y]+1;for(D&&(Y("\n  // Fetch weights\n"),t(m,(function(t){for(var e=[],i=[],n=0;n<w;n++)e[n]=[G(n),t[n]-C[n]],"closed"===F[n]&&t[n]-C[n]<0&&(i[n]=K(n));q("var "+j(t)+" = "+z(e,i)+";")}))),d&&q(D?"\n  // Fetch points and project into homogeneous (weighted) coordinates\n":"\n  // Fetch points\n"),t(m,(function(t){for(var e=[],i=[],n=0;n<w;n++)e[n]=[G(n),t[n]-C[n]],"closed"===F[n]&&t[n]-C[n]<0&&(i[n]=K(n));if(g)q(D?"var "+X(t)+" = "+I(e,i)+" * "+j(t)+";":"var "+X(t)+" = "+I(e,i)+";");else for(n=0;n<O;n++){var o=t.concat(n);e[w]=n,q(D?"var "+X(o)+" = "+I(e,i)+" * "+j(t)+";":"var "+X(o)+" = "+I(e,i)+";")}})),Y("\n"),Y("// Perform De Boor's algorithm"),y=m.length-1;y>=0;y--)for(m[y]=[C[y],C[y]+1],p=0;p<C[y];p++)for(Y("\n  // Degree "+C[y]+" evaluation in dimension "+y+", step "+(p+1)+"\n"),_=C[y];_>p;_--){var Q=f&&C[y]-p-f[y]<=0;Q?(q("m = 1 / ("+k([y,_-p+C[y]-1])+" - "+k([y,_-1])+");"),D&&(q("a = ("+M(y)+" - "+k([y,_-1])+") * m;"),q("b = 1 - a;"))):(q("a = ("+M(y)+" - "+k([y,_-1])+") / ("+k([y,_-p+C[y]-1])+" - "+k([y,_-1])+");"),q("b = 1 - a;")),D&&t(m,(function(t){var e=t.slice(),i=t.slice();e[y]=_,i[y]=_-1,Q&&D&&q("h = "+j(e)+";"),q(j(e)+" = b * "+j(i)+" + a * "+j(e)+";")})),t(m,(function(t){var e,i,n,o=t.slice(),r=t.slice();if(o[y]=_,r[y]=_-1,Q){var s=p+1;if(g)e=D?"h * "+j(r)+" / "+j(o)+" * ":"",i=X(o)+(D?" / h":""),n=X(r)+(D?" / "+j(r):""),q(X(o)+" = "+s+" * "+e+"("+i+" - "+n+") * m;");else{var u=o.slice(),a=r.slice();for(v=0;v<O;v++)u[w]=a[w]=v,e=D?"h * "+j(r)+" / "+j(o)+" * ":"",i=X(u)+(D?" / h":""),n=X(a)+(D?" / "+j(r):""),q(X(u)+" = "+s+" * "+e+"("+i+" - "+n+") * m;")}}else if(g)q(X(o)+" = b * "+X(r)+" + a * "+X(o)+";");else for(v=0;v<O;v++)o[w]=r[w]=v,q(X(o)+" = b * "+X(r)+" + a * "+X(o)+";")})),Y("\n")}if(d&&q(D?"\n  // Project back from homogeneous coordinates and return final output\n":"\n  // Return final output\n"),g)q(D?"return "+X(C)+" / "+j(C)+";":"return "+X(C)+";");else for(y=0;y<O;y++)q(D?"out["+y+"] = "+X(C.concat([y]))+" / "+j(C)+";":"out["+y+"] = "+X(C.concat([y]))+";");if(g||q("return out;"),V.push("}"),d){var $=V.join("\n");R($),u[a]=$}var tt=new Function([V.join("\n"),"; return ",T].join(""))();return s[a]=tt,tt.bind(l)}})),t("nurbs/src/transform",["nurbs/src/utils/accessor-preamble","nurbs/src/utils/size-getter","nurbs/src/utils/variable"],(function(t,e,i){"use strict";var n={};return function(o,r,s,u){var a,l,h,d,c,g,f,p,_=n[o];if(_)return _.bind(r);var m=[],v="transform"+o;m.push("function "+v+"(m) {"),m.push("var i, w;"),m.push(t(r,"x","this.points",r.points));var y=i(u?"size":"s");for(a=0;a<r.splineDimension;a++)m.push("var "+y(a)+" = "+e(r.points,"this.points",a)+";");for(d=[],a=0;a<r.splineDimension;a++)h="i"+a,d.push(h),m.push("for ("+h+" = "+y(a)+"- 1; "+h+" >= 0; "+h+"--) {");for(a=0;a<r.dimension;a++)m.push("x"+a+" = "+s.point(d.concat([a])));for(c=[],a=0;a<r.dimension;a++)c.push("m["+((r.dimension+1)*(a+1)-1)+"] * x"+a);for(c.push("m["+((r.dimension+1)*(r.dimension+1)-1)+"]"),m.push("var w = ("+c.join(" + ")+") || 1.0;"),a=0;a<r.dimension;a++){for(c=[],g=r.dimension,l=0;l<g;l++)c.push("m["+(l*(g+1)+a)+"] * x"+l);c.push("m["+(l*(g+1)+a)+"]"),p=s.point(d.concat([a])),f="("+c.join(" + ")+") / w",m.push(p+" = "+f+";")}for(a=r.splineDimension-1;a>=0;a--)m.push("}");m.push("return this;"),m.push("}");var N=new Function([m.join("\n"),"; return ",v].join(""))();return u&&console.log(m.join("\n")),n[o]=N,N.bind(r)}})),t("nurbs/src/support",["nurbs/src/utils/ndloop","nurbs/src/utils/variable","nurbs/src/utils/accessor-preamble","nurbs/src/utils/infer-type","nurbs/src/utils/is-array-like","nurbs/src/utils/size-getter"],(function(t,e,i,n,o,r){"use strict";var s={};return function(u,a,l,h,d){var c=s[u];if(c)return c.bind(a);var g,f,p,_=a.degree,m=a.knots,v=a.splineDimension,y=a.boundary,N=[],w="support"+u,b=l.knot,C=e("t"),S=h?"domain":"d",D=e(h?"size":"s"),x=e(h?"knotIndex":"i"),O=!0;for(p=0;p<v;p++)o(m)&&o(m[p])&&(O=!1);function F(t){N.push("  "+(t||""))}var B=[];for(g=0;g<v;g++)B.push(C([g]));N.push("function "+w+" (out, "+B.join(", ")+") {");var P=0;function R(t,e){F(void 0===e?"out["+P+++"] = "+t.join(" + ")+";":"out["+P+++"] = ("+t.join(" + ")+" + "+e+") % "+e+";")}for(F("var h, m;"),F("var c = 0;"),d&&(F("var "+S+" = this.domain;"),F("for (var i = 0; i < this.splineDimension; i++) {"),F("  a = arguments[i + 1];"),F("  if (a < "+S+"[i][0] || a > "+S+"[i][1] || a === undefined || isNaN(a)) {"),F("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+S+"[i][0]+', '+"+S+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),F("  }"),F("}")),p=0;p<v;p++)F("var "+D(p)+" = "+r(a.points,"this.points",p)+";");O||N.push(i(a,"k","this.knots",m));var V=[];for(p=0;p<v;p++)switch(n(m)){case n.NDARRAY:V[p]=!0;break;case n.ARRAY_OF_ARRAYS:V[p]=o(m[p])}for(p=0;p<v;p++)V[p]?(F("var "+x(p)+" = 0;"),F("h = "+D(p)+";"),F("while(h > "+x(p)+" + 1) {"),F("  m = 0.5 * (h + "+x(p)+") | 0;"),F("  if ("+b([p,"m"])+" > "+C(p)+") h = m;"),F("  else "+x(p)+" = m;"),F("}")):"closed"===y[p]?F(x(p)+" = ("+C(p)+" | 0) % "+D(p)+";"):(F(x(p)+" = ("+C(p)+" | 0);"),F("if ("+x(p)+" < "+_[p]+") "+x(p)+" = "+_[p]+";"),F("if ("+x(p)+" > "+D(p)+" - 1) "+x(p)+" = "+D(p)+" - 1;"));for(p=0,f=[];p<v;p++)f[p]=_[p]+1;t(f,(function(t){for(var e=[],i=[],n=0;n<v;n++)e[n]=[x(n),t[n]-_[n]],"closed"===y[n]&&t[n]-_[n]<0&&(i[n]=D(n));for(n=0;n<v;n++)R(e[n],i[n])})),F("out.length = "+P+";"),F("return out;"),N.push("}"),h&&console.log(N.join("\n"));var T=new Function([N.join("\n"),"; return ",w].join(""))();return s[u]=T,T.bind(a)}})),t("nurbs/extras/sample",["standard/Math/Numbers/Vector3","standard/Math/Geometry/Triangle3"],(function(t,e){"use strict";var i=[];return function(t,e,n){n=n||{};var o=(t=t||{}).points=t.points||[],r=t.faces=t.faces||[],s=n.haveWeights,u=e.dimension-s;if(Array.isArray(n.resolution))var a=n.resolution;else{var l=void 0===n.resolution?31:n.resolution;a=new Array(e.splineDimension).fill(l)}switch(e.splineDimension){case 1:for(var h=(m=(y=a[0])+!(w="closed"===e.boundary[0]))*u,d=(C=(v=n.domain||e.domain)[0])[1]-C[0],c=0;c<m;++c){var g=C[0]+d*c/y,f=c*u;if(e.evaluate(i,g),s)for(var p=i[u],_=0;_<u;++_)o[f+_]=i[_]/p;else for(_=0;_<u;++_)o[f+_]=i[_]}o.length=h;break;case 2:var m,v,y=a[0],N=a[1],w="closed"===e.boundary[0],b=N+!(F="closed"===e.boundary[1]),C=(h=(m=y+!w)*b*u,(v=n.domain||e.domain)[0]),S=v[1],D=(d=C[1]-C[0],S[1]-S[0]);for(c=0;c<m;++c){g=C[0]+d*c/y;for(var x=0;x<b;++x){var O=S[0]+D*x/N;f=(c+m*x)*u;if(e.evaluate(i,g,O),s)for(p=i[u],_=0;_<u;++_)o[f+_]=i[_]/p;else for(_=0;_<u;++_)o[f+_]=i[_]}}o.length=h;w=n.closed[0];var F=n.closed[1],B=0;for(c=0;c<y;++c){var P=c,R=c+1;w&&(R%=y);for(x=0;x<N;++x){var V=x,T=x+1;F&&(T%=N),r[B++]=P+m*V,r[B++]=R+m*V,r[B++]=R+m*T,r[B++]=P+m*V,r[B++]=R+m*T,r[B++]=P+m*T}}r.length=B;break;default:throw new Error("Can only sample curves and surfaces")}return t}})),t("nurbs/nurbs",["nurbs/src/utils/infer-type","nurbs/src/utils/cache-key","nurbs/src/utils/is-ndarray","nurbs/src/utils/is-ndarray-like","nurbs/src/utils/create-accessors","nurbs/src/numerical-derivative","nurbs/src/utils/is-array-like","nurbs/src/evaluate","nurbs/src/transform","nurbs/src/support","nurbs/extras/sample"],(function(t,e,i,n,o,r,s,u,a,l,h){"use strict";var d={open:"open",closed:"closed",clamped:"clamped"};function c(t){return null==t}function g(n,h,g,f,p,_){var m,v;!n||s(n)||i(n)?(_=_||{},this.weights=f,this.knots=g,this.degree=h,this.points=n,this.boundary=p,this.debug=_.debug,this.checkBounds=!!_.checkBounds,Object.defineProperty(this,"size",{value:_.size,writable:!0,configurable:!0})):(_=n,this.debug=n.debug,this.checkBounds=!!n.checkBounds,this.weights=n.weights,this.knots=n.knots,this.degree=n.degree,this.boundary=n.boundary,this.points=n.points,Object.defineProperty(this,"size",{value:_.size,writable:!0,configurable:!0}));var y=t(this.points),N=t(this.weights),w=t(this.knots);if(this.points)switch(y){case t.GENERIC_NDARRAY:case t.NDARRAY:Object.defineProperties(this,{splineDimension:{value:this.points.shape.length-1,writable:!1,configurable:!0},dimension:{value:this.points.shape[this.points.shape.length-1],writable:!1,configurable:!0},size:{get:function(){return this.points.shape.slice(0,this.points.shape.length-1)},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case t.ARRAY_OF_OBJECTS:case t.ARRAY_OF_ARRAYS:var b=0,C=this.size||[];C.length=0;for(var S=this.points;s(S[0]);S=S[0])b++,C.push(S.length);if(0===b)throw new Error("Expected an array of points");Object.defineProperties(this,{splineDimension:{value:b,writable:!1,configurable:!0},dimension:{value:S.length,writable:!1,configurable:!0},size:{get:function(){var t=[];t.length=0;for(var e=0,i=this.points;e<this.splineDimension;e++,i=i[0])t[e]=i.length;return t},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case t.PACKED:default:throw new Error("Expected either a packed array, array of arrays, or ndarray of points")}else{if(void 0===this.size||null===this.size)throw new Error("Either points or a control hull size must be provided.");if(s(this.size)||Object.defineProperty(this,"size",{value:[this.size],writable:!0,configurable:!0}),0===this.size.length)throw new Error("`size` must be a number or an array of length at least one.");Object.defineProperties(this,{splineDimension:{value:this.size.length,writable:!1,configurable:!0},dimension:{value:0,writable:!1,configurable:!0}})}if(s(this.degree)){for(m=0;m<this.splineDimension;m++)if(c(this.degree[m]))throw new Error("Missing degree in dimension "+(m+1))}else{var D=!c(this.degree),x=c(this.degree)?2:this.degree;for(this.degree=[],m=0;m<this.splineDimension;m++)if(this.size[m]<=x){if(D)throw new Error("Expected at least "+(x+1)+" points for degree "+x+" spline in dimension "+(m+1)+" but got only "+this.size[m]);this.degree[m]=this.size[m]-1}else this.degree[m]=x}if(v="string"!=typeof this.boundary?"open":this.boundary,!d[v])throw new Error("Boundary type must be one of "+Object.keys(d)+". Got "+v);for(this.boundary=s(this.boundary)?this.boundary:[],this.boundary.length=this.splineDimension,m=0;m<this.splineDimension;m++)if(this.boundary[m]=c(this.boundary[m])?v:this.boundary[m],!d[v])throw new Error("Boundary type must be one of "+Object.keys(d)+". Got "+v+" for dimension "+(m+1));switch(w){case t.ARRAY_OF_ARRAYS:for(s(this.knots)&&this.knots.length>0&&!s(this.knots[0])&&(this.knots=[this.knots]),m=0;m<this.splineDimension;m++){if(this.size[m]<=this.degree[m])throw new Error("Expected at least "+(this.degree[m]+1)+" points in dimension "+(m+1)+" but got "+this.size[m]+".");if(s(this.knots[m])){if("closed"!==this.boundary[m]&&this.knots[m].length!==this.degree[m]+this.size[m]+1)throw new Error("Expected "+(this.degree[m]+this.size[m]+1)+" knots in dimension "+(m+1)+" but got "+this.knots[m].length+".");if("closed"===this.boundary[m]&&this.knots[m].length!==this.size[m]+1&&!(this.knots[m].length===this.size[m]+this.degree[m]+1))throw new Error("Expected "+(this.size[m]+1)+" knots for closed spline in dimension "+(m+1)+" but got "+this.knots[m].length+".")}}case t.NDARRAY:}var O=e(this,this.debug,this.checkBounds,y,N,w);if(O!==this.__cacheKey){this.__cacheKey=O;var F=o(this);this.evaluate=u(this.__cacheKey,this,F,this.debug,this.checkBounds,!1),this.transform=a(this.__cacheKey,this,F,this.debug),this.support=l(this.__cacheKey,this,F,this.debug,this.checkBounds),this.evaluator=function(t,e){return u(this.__cacheKey,this,F,this.debug,this.checkBounds,e,t)}}return this.numericalDerivative=r.bind(this),this}function f(){var t,e=[],i=this.points;i?n(i)&&(t=i.shape):t=this.size;for(var o=0;o<this.splineDimension;o++){var r=t?t[o]:i.length,s=this.degree[o],u="closed"===this.boundary[o];if(this.knots&&this.knots[o]){var a=this.knots[o];e[o]=[a[u?0:s],a[r]]}else e[o]=[u?0:s,r];i&&(i=i[0])}return e}function p(t,e,i,n,o,r){var s=function(t,e,i,n,o,r){return u(t,e,i,n,o,r),s},u=g.bind(s);return Object.defineProperty(s,"domain",{get:f}),u(t,e,i,n,o,r),s}return p.sample=h,p})),t("nurbs",["nurbs/nurbs"],(function(t){return t})),t("x_ite/Components/NURBS/NurbsCurve",["x_ite/Base/X3DCast","x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/NURBS/X3DParametricGeometryNode","x_ite/Components/Rendering/X3DLineGeometryNode","x_ite/Base/X3DConstants","x_ite/Browser/NURBS/NURBS","nurbs"],(function(t,e,i,n,o,r,s,u,a){"use strict";function l(t){o.call(this,t),r.call(this,t),this.addType(s.NurbsCurve),this.knots=[],this.weights=[],this.controlPoints=[],this.mesh={},this.sampleOptions={resolution:[]}}return l.prototype=Object.assign(Object.create(o.prototype),r.prototype,{constructor:l,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new n([new i(s.inputOutput,"metadata",new e.SFNode),new i(s.inputOutput,"tessellation",new e.SFInt32),new i(s.initializeOnly,"closed",new e.SFBool),new i(s.initializeOnly,"order",new e.SFInt32(3)),new i(s.initializeOnly,"knot",new e.MFDouble),new i(s.inputOutput,"weight",new e.MFDouble),new i(s.inputOutput,"controlPoint",new e.SFNode)]),getTypeName:function(){return"NurbsCurve"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"},initialize:function(){o.prototype.initialize.call(this),this._controlPoint.addInterest("set_controlPoint__",this),this.set_controlPoint__()},set_controlPoint__:function(){this.controlPointNode&&this.controlPointNode.removeInterest("requestRebuild",this),this.controlPointNode=t(s.X3DCoordinateNode,this._controlPoint),this.controlPointNode&&this.controlPointNode.addInterest("requestRebuild",this)},getTessellation:function(t){return u.getTessellation(this._tessellation.getValue(),t-this._order.getValue())},getClosed:function(t,e,i,n){return!!this._closed.getValue()&&u.getClosed(t,e,i,n)},getWeights:function(t,e,i){return u.getWeights(t,e,i)},getControlPoints:function(t,e,i,n,o){return u.getControlPoints(t,e,i,n,o)},tessellate:function(){if(this._order.getValue()<2)return[];if(!this.controlPointNode)return[];if(this.controlPointNode.getSize()<this._order.getValue())return[];const t=this.getVertices(),e=[];if(t.length){const i=t.length;for(let n=0;n<i;n+=8)e.push(t[n],t[n+1],t[n+2]);e.push(t[i-4],t[i-3],t[i-2])}return e},build:function(){if(this._order.getValue()<2)return;if(!this.controlPointNode)return;if(this.controlPointNode.getSize()<this._order.getValue())return;const t=this.getClosed(this._order.getValue(),this._knot,this._weight,this.controlPointNode),e=this.getWeights(this.weights,this.controlPointNode.getSize(),this._weight),i=this.getControlPoints(this.controlPoints,t,this._order.getValue(),e,this.controlPointNode),n=this.getKnots(this.knots,t,this._order.getValue(),this.controlPointNode.getSize(),this._knot),o=(n.at(-1),n[0],this._order.getValue()-1),r=this.surface=(this.surface||a)({boundary:["open"],degree:[o],knots:[n],points:i,debug:!1});this.sampleOptions.resolution[0]=this.getTessellation(n.length),this.sampleOptions.haveWeights=Boolean(e);const s=a.sample(this.mesh,r,this.sampleOptions).points,u=this.getVertices();for(let t=3,e=s.length;t<e;t+=3){const e=t-3;u.push(s[e],s[e+1],s[e+2],1),u.push(s[t],s[t+1],s[t+2],1)}}}),l})),t("x_ite/Components/NURBS/NurbsCurve2D",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/NURBS/X3DNurbsControlCurveNode","x_ite/Base/X3DConstants","x_ite/Browser/NURBS/NURBS","standard/Math/Numbers/Vector3","nurbs"],(function(t,e,i,n,o,r,s,u){"use strict";function a(t){n.call(this,t),this.addType(o.NurbsCurve2D),this.knots=[],this.weights=[],this.controlPoints=[],this.mesh={},this.sampleOptions={resolution:[]},this.array=[]}return a.prototype=Object.assign(Object.create(n.prototype),{constructor:a,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(o.inputOutput,"metadata",new t.SFNode),new e(o.inputOutput,"tessellation",new t.SFInt32),new e(o.initializeOnly,"closed",new t.SFBool),new e(o.initializeOnly,"order",new t.SFInt32(3)),new e(o.initializeOnly,"knot",new t.MFDouble),new e(o.inputOutput,"weight",new t.MFDouble),new e(o.inputOutput,"controlPoint",new t.MFVec2d)]),getTypeName:function(){return"NurbsCurve2D"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},getTessellation:function(t){return r.getTessellation(this._tessellation.getValue(),t-this._order.getValue())},getClosed:function(t,e,i,n){return!!this._closed.getValue()&&r.getClosed2D(t,e,i,n)},getKnots:function(t,e,i,n,o){return r.getKnots(t,e,i,n,o)},getWeights:function(t,e,i){return r.getWeights(t,e,i)},getControlPoints:function(t,e,i,n,o){return r.getControlPoints2D(t,e,i,n,o)},tessellate:function(t){var e=this.array;if(e.length=0,this._order.getValue()<2)return e;if(this._controlPoint.length<this._order.getValue())return e;var i=this.getClosed(this._order.getValue(),this._knot,this._weight,this._controlPoint),n=this.getWeights(this.weights,this._controlPoint.length,this._weight),o=this.getControlPoints(this.controlPoints,i,this._order.getValue(),n,this._controlPoint),r=this.getKnots(this.knots,i,this._order.getValue(),this._controlPoint.length,this._knot),a=(r.at(-1),r[0],this._order.getValue()-1),l=this.surface=(this.surface||u)({boundary:["open"],degree:[a],knots:[r],points:o,debug:!1});this.sampleOptions.resolution[0]=this.getTessellation(r.length),this.sampleOptions.haveWeights=Boolean(n);var h=u.sample(this.mesh,l,this.sampleOptions).points;switch(t){case 0:for(var d=0,c=h.length;d<c;d+=2)e.push(h[d],h[d+1]);break;case 1:for(d=0,c=h.length;d<c;d+=2)e.push(h[d],0,h[d+1]);break;case 2:for(d=0,c=h.length;d<c;d+=2)e.push(new s(h[d],h[d+1],0))}return e}}),a})),t("x_ite/Components/NURBS/NurbsOrientationInterpolator",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Core/X3DChildNode","x_ite/Components/Interpolation/OrientationInterpolator","x_ite/Base/X3DConstants","x_ite/Base/X3DCast","x_ite/Browser/NURBS/NURBS","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","nurbs"],(function(t,e,i,n,o,r,s,u,a,l,h){"use strict";function d(e){n.call(this,e),this.addType(r.NurbsOrientationInterpolator),this.addChildObjects("rebuild",new t.SFTime),this.interpolator=new o(e),this.knots=[],this.weights=[],this.controlPoints=[],this.mesh={},this.sampleOptions={resolution:[128]}}return d.prototype=Object.assign(Object.create(n.prototype),{constructor:d,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOnly,"set_fraction",new t.SFFloat),new e(r.inputOutput,"order",new t.SFInt32(3)),new e(r.inputOutput,"knot",new t.MFDouble),new e(r.inputOutput,"weight",new t.MFDouble),new e(r.inputOutput,"controlPoint",new t.SFNode),new e(r.outputOnly,"value_changed",new t.SFRotation)]),getTypeName:function(){return"NurbsOrientationInterpolator"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this._order.addInterest("requestRebuild",this),this._knot.addInterest("requestRebuild",this),this._weight.addInterest("requestRebuild",this),this._controlPoint.addInterest("set_controlPoint__",this),this._rebuild.addInterest("build",this),this._set_fraction.addFieldInterest(this.interpolator._set_fraction),this.interpolator._value_changed.addFieldInterest(this._value_changed),this.interpolator.setup(),this.set_controlPoint__()},set_controlPoint__:function(){this.controlPointNode&&this.controlPointNode.removeInterest("requestRebuild",this),this.controlPointNode=s(r.X3DCoordinateNode,this._controlPoint),this.controlPointNode&&this.controlPointNode.addInterest("requestRebuild",this),this.requestRebuild()},getClosed:function(t,e,i,n){return!1},getKnots:function(t,e,i,n,o){return u.getKnots(t,e,i,n,o)},getWeights:function(t,e,i){return u.getWeights(t,e,i)},getControlPoints:function(t,e,i,n,o){return u.getControlPoints(t,e,i,n,o)},requestRebuild:function(){this._rebuild.addEvent()},build:function(){if(!(this._order.getValue()<2)&&this.controlPointNode&&!(this.controlPointNode.getSize()<this._order.getValue())){var t=this.getClosed(this._order.getValue(),this._knot,this._weight,this.controlPointNode),e=this.getWeights(this.weights,this.controlPointNode.getSize(),this._weight),i=this.getControlPoints(this.controlPoints,t,this._order.getValue(),e,this.controlPointNode),n=this.getKnots(this.knots,t,this._order.getValue(),this.controlPointNode.getSize(),this._knot),o=n.at(-1)-n[0],r=this._order.getValue()-1,s=this.surface=(this.surface||h)({boundary:["open"],degree:[r],knots:[n],points:i,debug:!1});this.sampleOptions.haveWeights=Boolean(e);var u=h.sample(this.mesh,s,this.sampleOptions).points,d=this.interpolator;d._key.length=0,d._keyValue.length=0;for(var c=0,g=u.length-3;c<g;c+=3){var f=new a(u[c+3]-u[c+0],u[c+4]-u[c+1],u[c+5]-u[c+2]);d._key.push(n[0]+c/(g-3+3*t)*o),d._keyValue.push(new l(a.zAxis,f))}t&&(d._key.push(n[0]+o),d._keyValue.push(d._keyValue[0]))}}}),d})),t("x_ite/Components/NURBS/X3DNurbsSurfaceGeometryNode",["x_ite/Components/NURBS/X3DParametricGeometryNode","x_ite/Base/X3DConstants","x_ite/Base/X3DCast","x_ite/Browser/NURBS/NURBS","standard/Math/Algorithm","standard/Math/Numbers/Vector3","standard/Math/Geometry/Triangle3","nurbs"],(function(t,e,i,n,o,r,s,u){"use strict";function a(i){t.call(this,i),this.addType(e.X3DNurbsSurfaceGeometryNode),this.tessellationScale=1,this.uKnots=[],this.vKnots=[],this.weights=[],this.controlPoints=[],this.mesh={},this.sampleOptions={resolution:[],closed:[]},this.textUKnots=[],this.textVKnots=[],this.textWeights=[],this.texControlPoints=[],this.texMesh={}}var l,h,d;return a.prototype=Object.assign(Object.create(t.prototype),{constructor:a,initialize:function(){t.prototype.initialize.call(this),this._texCoord.addInterest("set_texCoord__",this),this._controlPoint.addInterest("set_controlPoint__",this),this.set_texCoord__(),this.set_controlPoint__()},set_texCoord__:function(){this.texCoordNode&&this.texCoordNode.removeInterest("requestRebuild",this),this.nurbsTexCoordNode&&this.nurbsTexCoordNode.removeInterest("requestRebuild",this),this.texCoordNode=i(e.X3DTextureCoordinateNode,this._texCoord),this.nurbsTexCoordNode=i(e.NurbsTextureCoordinate,this._texCoord),this.texCoordNode&&this.texCoordNode.addInterest("requestRebuild",this),this.nurbsTexCoordNode&&this.nurbsTexCoordNode.addInterest("requestRebuild",this)},set_controlPoint__:function(){this.controlPointNode&&this.controlPointNode.removeInterest("requestRebuild",this),this.controlPointNode=i(e.X3DCoordinateNode,this._controlPoint),this.controlPointNode&&this.controlPointNode.addInterest("requestRebuild",this)},setTessellationScale:function(t){this.tessellationScale=t,this.requestRebuild()},getUTessellation:function(t){return Math.floor(n.getTessellation(this._uTessellation.getValue(),t-this._uOrder.getValue())*this.tessellationScale)},getVTessellation:function(t){return Math.floor(n.getTessellation(this._vTessellation.getValue(),t-this._vOrder.getValue())*this.tessellationScale)},getUClosed:function(t,e,i,o,r,s){return!!this._uClosed.getValue()&&n.getUClosed(t,e,i,o,r,s)},getVClosed:function(t,e,i,o,r,s){return!!this._vClosed.getValue()&&n.getVClosed(t,e,i,o,r,s)},getUVWeights:function(t,e,i,o){return n.getUVWeights(t,e,i,o)},getTexControlPoints:function(t,e,i,o,r,s,u,a){return n.getTexControlPoints(t,e,i,o,r,s,u,a)},getUVControlPoints:function(t,e,i,o,r,s,u,a,l){return n.getUVControlPoints(t,e,i,o,r,s,u,a,l)},getTrimmingContours:function(){},build:function(){if(!(this._uOrder.getValue()<2)&&!(this._vOrder.getValue()<2)&&!(this._uDimension.getValue()<this._uOrder.getValue())&&!(this._vDimension.getValue()<this._vOrder.getValue())&&this.controlPointNode&&this.controlPointNode.getSize()===this._uDimension.getValue()*this._vDimension.getValue()){var t=this.getUClosed(this._uOrder.getValue(),this._uDimension.getValue(),this._vDimension.getValue(),this._uKnot,this._weight,this.controlPointNode),e=this.getVClosed(this._vOrder.getValue(),this._uDimension.getValue(),this._vDimension.getValue(),this._vKnot,this._weight,this.controlPointNode),i=this.getUVWeights(this.weights,this._uDimension.getValue(),this._vDimension.getValue(),this._weight),n=this.getUVControlPoints(this.controlPoints,t,e,this._uOrder.getValue(),this._vOrder.getValue(),this._uDimension.getValue(),this._vDimension.getValue(),i,this.controlPointNode),o=this.getKnots(this.uKnots,t,this._uOrder.getValue(),this._uDimension.getValue(),this._uKnot),r=this.getKnots(this.vKnots,e,this._vOrder.getValue(),this._vDimension.getValue(),this._vKnot),s=(o.at(-1),o[0],r.at(-1),r[0],this._uOrder.getValue()-1),a=this._vOrder.getValue()-1,l=this.surface=(this.surface||u)({boundary:["open","open"],degree:[s,a],knots:[o,r],points:n,debug:!1}),h=this.sampleOptions;h.resolution[0]=this.getUTessellation(o.length),h.resolution[1]=this.getVTessellation(r.length),h.closed[0]=t,h.closed[1]=e,h.domain=void 0,h.haveWeights=Boolean(i),h.trimmingContours=this.getTrimmingContours();for(var d=u.sample(this.mesh,l,h),c=d.faces,g=d.points,f=this.getVertices(),p=0,_=c.length;p<_;++p){var m=3*c[p];f.push(g[m],g[m+1],g[m+2],1)}this.buildNurbsTexCoords(t,e,this._uOrder.getValue(),this._vOrder.getValue(),o,r,this._uDimension.getValue(),this._vDimension.getValue(),l.domain),this.buildNormals(c,g),this.setSolid(this._solid.getValue()),this.setCCW(!0)}},buildNurbsTexCoords:function(){var t=[],e=[],i=[[[0,0,0,1],[0,1,0,1]],[[1,0,0,1],[1,1,0,1]]];function n(t,e){return t[0]=t[1]=e[0],t[2]=t[3]=e.at(-1),t}return function(o,r,s,a,l,h,d,c,g){var f=this.sampleOptions;if(this.texCoordNode&&this.texCoordNode.getSize()===d*c)var p=s-1,_=a-1,m=l,v=h,y=this.getTexControlPoints(this.texControlPoints,o,r,s,a,d,c,this.texCoordNode);else if(this.nurbsTexCoordNode&&this.nurbsTexCoordNode.isValid()){var N=this.nurbsTexCoordNode,w=(p=N._uOrder.getValue()-1,_=N._vOrder.getValue()-1,m=this.getKnots(this.texUKnots,!1,N._uOrder.getValue(),N._uDimension.getValue(),N._uKnot),v=this.getKnots(this.texVKnots,!1,N._vOrder.getValue(),N._vDimension.getValue(),N._vKnot),this.getUVWeights(this.texWeights,N._uDimension.getValue(),N._vDimension.getValue(),N._weight));y=N.getControlPoints(w)}else{p=1,_=1,m=n(t,l),v=n(e,h),y=i;f.domain=g}var b=this.texSurface=(this.texSurface||u)({boundary:["open","open"],degree:[p,_],knots:[m,v],points:y});f.closed[0]=!1,f.closed[1]=!1,f.haveWeights=!1;for(var C=u.sample(this.texMesh,b,f),S=C.faces,D=C.points,x=this.getTexCoords(),O=0,F=S.length;O<F;++O){var B=4*S[O];x.push(D[B],D[B+1],D[B+2],D[B+3])}this.getMultiTexCoords().push(this.getTexCoords())}}(),buildNormals:function(t,e){for(var i=this.createNormals(t,e),n=this.getNormals(),o=0,r=i.length;o<r;++o){var s=i[o];n.push(s.x,s.y,s.z)}},createNormals:function(t,e){for(var i=this.createFaceNormals(t,e),n=[],r=0,s=t.length;r<s;++r){var u=t[r],a=n[u];a||(a=n[u]=[]),a.push(r)}return this.refineNormals(n,i,o.radians(85))},createFaceNormals:(l=new r(0,0,0),h=new r(0,0,0),d=new r(0,0,0),function(t,e){for(var i=this.faceNormals||[],n=0,o=t.length;n<o;n+=3){var u=3*t[n],a=3*t[n+1],c=3*t[n+2];l.set(e[u],e[u+1],e[u+2]),h.set(e[a],e[a+1],e[a+2]),d.set(e[c],e[c+1],e[c+2]);var g=s.normal(l,h,d,i[n]||new r(0,0,0));i[n]=g,i[n+1]=g,i[n+2]=g}return i.length=o,i})}),a})),t("x_ite/Components/NURBS/NurbsPatchSurface",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/NURBS/X3DNurbsSurfaceGeometryNode","x_ite/Base/X3DConstants"],(function(t,e,i,n,o){"use strict";function r(t){n.call(this,t),this.addType(o.NurbsPatchSurface)}return r.prototype=Object.assign(Object.create(n.prototype),{constructor:r,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(o.inputOutput,"metadata",new t.SFNode),new e(o.initializeOnly,"solid",new t.SFBool(!0)),new e(o.inputOutput,"uTessellation",new t.SFInt32),new e(o.inputOutput,"vTessellation",new t.SFInt32),new e(o.initializeOnly,"uClosed",new t.SFBool),new e(o.initializeOnly,"vClosed",new t.SFBool),new e(o.initializeOnly,"uOrder",new t.SFInt32(3)),new e(o.initializeOnly,"vOrder",new t.SFInt32(3)),new e(o.initializeOnly,"uDimension",new t.SFInt32),new e(o.initializeOnly,"vDimension",new t.SFInt32),new e(o.initializeOnly,"uKnot",new t.MFDouble),new e(o.initializeOnly,"vKnot",new t.MFDouble),new e(o.inputOutput,"weight",new t.MFDouble),new e(o.inputOutput,"texCoord",new t.SFNode),new e(o.inputOutput,"controlPoint",new t.SFNode)]),getTypeName:function(){return"NurbsPatchSurface"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"}}),r})),t("x_ite/Components/NURBS/NurbsPositionInterpolator",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Core/X3DChildNode","x_ite/Components/Interpolation/PositionInterpolator","x_ite/Base/X3DConstants","x_ite/Base/X3DCast","x_ite/Browser/NURBS/NURBS","nurbs"],(function(t,e,i,n,o,r,s,u,a){"use strict";function l(e){n.call(this,e),this.addType(r.NurbsPositionInterpolator),this.addChildObjects("rebuild",new t.SFTime),this.interpolator=new o(e),this.knots=[],this.weights=[],this.controlPoints=[],this.mesh={},this.sampleOptions={resolution:[128]}}return l.prototype=Object.assign(Object.create(n.prototype),{constructor:l,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOnly,"set_fraction",new t.SFFloat),new e(r.inputOutput,"order",new t.SFInt32(3)),new e(r.inputOutput,"knot",new t.MFDouble),new e(r.inputOutput,"weight",new t.MFDouble),new e(r.inputOutput,"controlPoint",new t.SFNode),new e(r.outputOnly,"value_changed",new t.SFVec3f)]),getTypeName:function(){return"NurbsPositionInterpolator"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this._order.addInterest("requestRebuild",this),this._knot.addInterest("requestRebuild",this),this._weight.addInterest("requestRebuild",this),this._controlPoint.addInterest("set_controlPoint__",this),this._rebuild.addInterest("build",this),this._set_fraction.addFieldInterest(this.interpolator._set_fraction),this.interpolator._value_changed.addFieldInterest(this._value_changed),this.interpolator.setup(),this.set_controlPoint__()},set_controlPoint__:function(){this.controlPointNode&&this.controlPointNode.removeInterest("requestRebuild",this),this.controlPointNode=s(r.X3DCoordinateNode,this._controlPoint),this.controlPointNode&&this.controlPointNode.addInterest("requestRebuild",this),this.requestRebuild()},getClosed:function(t,e,i,n){return!1},getKnots:function(t,e,i,n,o){return u.getKnots(t,e,i,n,o)},getWeights:function(t,e,i){return u.getWeights(t,e,i)},getControlPoints:function(t,e,i,n,o){return u.getControlPoints(t,e,i,n,o)},requestRebuild:function(){this._rebuild.addEvent()},build:function(){if(!(this._order.getValue()<2)&&this.controlPointNode&&!(this.controlPointNode.getSize()<this._order.getValue())){var e=this.getClosed(this._order.getValue(),this._knot,this._weight,this.controlPointNode),i=this.getWeights(this.weights,this.controlPointNode.getSize(),this._weight),n=this.getControlPoints(this.controlPoints,e,this._order.getValue(),i,this.controlPointNode),o=this.getKnots(this.knots,e,this._order.getValue(),this.controlPointNode.getSize(),this._knot),r=o.at(-1)-o[0],s=this._order.getValue()-1,u=this.surface=(this.surface||a)({boundary:["open"],degree:[s],knots:[o],points:n,debug:!1});this.sampleOptions.haveWeights=Boolean(i);var l=a.sample(this.mesh,u,this.sampleOptions).points,h=this.interpolator;h._key.length=0,h._keyValue.length=0;for(var d=0,c=l.length;d<c;d+=3)h._key.push(o[0]+d/(c-3)*r),h._keyValue.push(new t.SFVec3f(l[d],l[d+1],l[d+2]))}}}),l})),t("x_ite/Components/NURBS/NurbsSet",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Core/X3DChildNode","x_ite/Components/Grouping/X3DBoundedObject","x_ite/Base/X3DConstants","x_ite/Base/X3DCast"],(function(t,e,i,n,o,r,s){"use strict";function u(t,e,i,n,o,r){for(var s={},u=o;u<r;++u)s[getId(n[u])]=!0;return t.remove(e,i,(function(t){return s[getId(t)]}))}function a(t){n.call(this,t),o.call(this,t),this.addType(r.NurbsSet),this.geometryNodes=[]}return a.prototype=Object.assign(Object.create(n.prototype),o.prototype,{constructor:a,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"tessellationScale",new t.SFFloat(1)),new e(r.inputOutput,"visible",new t.SFBool(!0)),new e(r.inputOutput,"bboxDisplay",new t.SFBool),new e(r.initializeOnly,"bboxSize",new t.SFVec3f(-1,-1,-1)),new e(r.initializeOnly,"bboxCenter",new t.SFVec3f),new e(r.inputOnly,"addGeometry",new t.MFNode),new e(r.inputOnly,"removeGeometry",new t.MFNode),new e(r.inputOutput,"geometry",new t.MFNode)]),getTypeName:function(){return"NurbsSet"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),o.prototype.initialize.call(this),this._tessellationScale.addInterest("set_tessellationScale__",this),this._addGeometry.addInterest("set_addGeometry__",this),this._removeGeometry.addInterest("set_removeGeometry__",this),this._geometry.addInterest("set_geometry__",this),this.set_geometry__()},getBBox:function(t,e){for(var i=0,n=this.geometryNodes.length;i<n;++i)t.add(this.geometryNodes[i].getBBox());return t},set_tessellationScale__:function(){for(var t=Math.max(0,this._tessellationScale.getValue()),e=0,i=this.geometryNodes.length;e<i;++e)this.geometryNodes[e].setTessellationScale(t)},set_addGeometry__:function(){this._addGeometry.setTainted(!0),this._addGeometry.erase(u(this._addGeometry,0,this._addGeometry.length,this._geometry,0,this._geometry.length),this._addGeometry.length);for(var t=0,e=this._addGeometry.length;t<e;++t)this._geometry.push(this._addGeometry[t]);this._addGeometry.setTainted(!1)},set_removeGeometry__:function(){this._geometry.erase(u(this._geometry,0,this._geometry.length,this._removeGeometry,0,this._removeGeometry.length),this.geometry__.length)},set_geometry__:function(){for(var t=0,e=this.geometryNodes.length;t<e;++t)this.geometryNodes[t].setTessellationScale(1);this.geometryNodes.length=0;for(t=0,e=this._geometry.length;t<e;++t){var i=s(r.X3DNurbsSurfaceGeometryNode,this._geometry[t]);i&&this.geometryNodes.push(i)}this.set_tessellationScale__()}}),a})),t("standard/Math/Geometry/Triangle2",[],(function(){"use strict";return{isPointInTriangle:function(t,e,i,n){const o=(e.y-i.y)*(t.x-i.x)+(i.x-e.x)*(t.y-i.y);if(0==o)return!1;const r=((e.y-i.y)*(n.x-i.x)+(i.x-e.x)*(n.y-i.y))/o;if(r<0||r>1)return!1;const s=((i.y-t.y)*(n.x-i.x)+(t.x-i.x)*(n.y-i.y))/o;if(s<0||s>1)return!1;const u=1-r-s;return!(u<0||u>1)}}})),t("x_ite/Components/NURBS/NurbsSurfaceInterpolator",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Core/X3DChildNode","x_ite/Components/NURBS/NurbsPatchSurface","x_ite/Base/X3DConstants","standard/Math/Geometry/Line3","standard/Math/Geometry/Triangle2","standard/Math/Numbers/Vector3"],(function(t,e,i,n,o,r,s,u,a){"use strict";function l(t){n.call(this,t),this.addType(r.NurbsSurfaceInterpolator),this.geometry=new o(t)}var h,d,c,g,f,p;return l.prototype=Object.assign(Object.create(n.prototype),{constructor:l,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOnly,"set_fraction",new t.SFVec2f),new e(r.initializeOnly,"uOrder",new t.SFInt32(3)),new e(r.initializeOnly,"vOrder",new t.SFInt32(3)),new e(r.initializeOnly,"uDimension",new t.SFInt32),new e(r.initializeOnly,"vDimension",new t.SFInt32),new e(r.initializeOnly,"uKnot",new t.MFDouble),new e(r.initializeOnly,"vKnot",new t.MFDouble),new e(r.inputOutput,"weight",new t.MFDouble),new e(r.inputOutput,"controlPoint",new t.SFNode),new e(r.outputOnly,"normal_changed",new t.SFVec3f),new e(r.outputOnly,"position_changed",new t.SFVec3f)]),getTypeName:function(){return"NurbsSurfaceInterpolator"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},initialize:function(){this._set_fraction.addInterest("set_fraction__",this),this._uOrder.addFieldInterest(this.geometry._uOrder),this._vOrder.addFieldInterest(this.geometry._vOrder),this._uDimension.addFieldInterest(this.geometry._uDimension),this._vDimension.addFieldInterest(this.geometry._vDimension),this._uKnot.addFieldInterest(this.geometry._uKnot),this._vKnot.addFieldInterest(this.geometry._vKnot),this._weight.addFieldInterest(this.geometry._weight),this._controlPoint.addFieldInterest(this.geometry._controlPoint),this.geometry._uTessellation=128,this.geometry._vTessellation=128,this.geometry._uOrder=this._uOrder,this.geometry._vOrder=this._vOrder,this.geometry._uDimension=this._uDimension,this.geometry._vDimension=this._vDimension,this.geometry._uKnot=this._uKnot,this.geometry._vKnot=this._vKnot,this.geometry._weight=this._weight,this.geometry._controlPoint=this._controlPoint,this.geometry.setup()},set_fraction__:(h=new a(0,0,0),d=new a(0,0,0),c=new a(0,0,0),g=new a(0,0,0),f=new s(a.Zero,a.zAxis),p={},function(){for(var t=this._set_fraction.getValue(),e=this.geometry.getTexCoords(),i=this.geometry.getNormals(),n=this.geometry.getVertices(),o=0,r=0,s=e.length;o<s;o+=12,r+=9)if(h.set(e[o+0],e[o+1],0),d.set(e[o+4],e[o+5],0),c.set(e[o+7],e[o+9],0),u.isPointInTriangle(h,d,c,t)&&(f.set(g.set(t.x,t.y,0),a.zAxis),f.intersectsTriangle(h,d,c,p))){var l=p.u,_=p.v,m=p.t,v=new a(m*i[r+0]+l*i[r+3]+_*i[r+6],m*i[r+1]+l*i[r+4]+_*i[r+7],m*i[r+2]+l*i[r+5]+_*i[r+8]),y=new a(m*n[o+0]+l*n[o+4]+_*n[o+8],m*n[o+1]+l*n[o+5]+_*n[o+9],m*n[o+2]+l*n[o+6]+_*n[o+10]);this._normal_changed=v,this._position_changed=y}})}),l})),t("x_ite/Components/NURBS/NurbsSweptSurface",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Geometry3D/Extrusion","x_ite/Components/NURBS/X3DParametricGeometryNode","x_ite/Base/X3DConstants","x_ite/Base/X3DCast"],(function(t,e,i,n,o,r,s){"use strict";function u(t){o.call(this,t),this.addType(r.NurbsSweptSurface),this.extrusion=new n(t)}return u.prototype=Object.assign(Object.create(o.prototype),{constructor:u,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.initializeOnly,"solid",new t.SFBool(!0)),new e(r.initializeOnly,"ccw",new t.SFBool(!0)),new e(r.inputOutput,"crossSectionCurve",new t.SFNode),new e(r.inputOutput,"trajectoryCurve",new t.SFNode)]),getTypeName:function(){return"NurbsSweptSurface"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"},initialize:function(){o.prototype.initialize.call(this),this._crossSectionCurve.addInterest("set_crossSectionCurve__",this),this._trajectoryCurve.addInterest("set_trajectoryCurve__",this);var t=this.extrusion;t._beginCap=!1,t._endCap=!1,t._solid=!0,t._ccw=!0,t._convex=!0,t._creaseAngle=Math.PI,t.setup(),t._crossSection.setTainted(!0),t._spine.setTainted(!0),this.set_crossSectionCurve__(),this.set_trajectoryCurve__()},set_crossSectionCurve__:function(){this.crossSectionCurveNode&&this.crossSectionCurveNode.removeInterest("requestRebuild",this),this.crossSectionCurveNode=s(r.X3DNurbsControlCurveNode,this._crossSectionCurve),this.crossSectionCurveNode&&this.crossSectionCurveNode.addInterest("requestRebuild",this)},set_trajectoryCurve__:function(){this.trajectoryCurveNode&&this.trajectoryCurveNode._rebuild.removeInterest("requestRebuild",this),this.trajectoryCurveNode=s(r.NurbsCurve,this._trajectoryCurve),this.trajectoryCurveNode&&this.trajectoryCurveNode._rebuild.addInterest("requestRebuild",this)},build:function(){if(this.crossSectionCurveNode&&this.trajectoryCurveNode){var t=this.extrusion;if(t._crossSection=this.crossSectionCurveNode.tessellate(0),t._spine=this.trajectoryCurveNode.tessellate(0),t.rebuild(),this.getColors().assign(t.getColors()),this.getTexCoords().assign(t.getTexCoords()),this.getNormals().assign(t.getNormals()),this.getVertices().assign(t.getVertices()),this.getMultiTexCoords().push(this.getTexCoords()),!this._ccw.getValue())for(var e=this.getNormals(),i=0,n=e.length;i<n;++i)e[i]=-e[i];this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}}),u})),t("x_ite/Components/NURBS/NurbsSwungSurface",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Geometry3D/Extrusion","x_ite/Components/NURBS/X3DParametricGeometryNode","x_ite/Base/X3DConstants","x_ite/Base/X3DCast"],(function(t,e,i,n,o,r,s){"use strict";function u(t){o.call(this,t),this.addType(r.NurbsSwungSurface),this.extrusion=new n(t)}return u.prototype=Object.assign(Object.create(o.prototype),{constructor:u,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.initializeOnly,"solid",new t.SFBool(!0)),new e(r.initializeOnly,"ccw",new t.SFBool(!0)),new e(r.inputOutput,"profileCurve",new t.SFNode),new e(r.inputOutput,"trajectoryCurve",new t.SFNode)]),getTypeName:function(){return"NurbsSwungSurface"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"},initialize:function(){o.prototype.initialize.call(this),this._profileCurve.addInterest("set_profileCurve__",this),this._trajectoryCurve.addInterest("set_trajectoryCurve__",this);var t=this.extrusion;t._beginCap=!1,t._endCap=!1,t._solid=!0,t._ccw=!0,t._convex=!0,t._creaseAngle=Math.PI,t.setup(),t._crossSection.setTainted(!0),t._spine.setTainted(!0),this.set_profileCurve__(),this.set_trajectoryCurve__()},set_profileCurve__:function(){this.profileCurveNode&&this.profileCurveNode.removeInterest("requestRebuild",this),this.profileCurveNode=s(r.X3DNurbsControlCurveNode,this._profileCurve),this.profileCurveNode&&this.profileCurveNode.addInterest("requestRebuild",this)},set_trajectoryCurve__:function(){this.trajectoryCurveNode&&this.trajectoryCurveNode.removeInterest("requestRebuild",this),this.trajectoryCurveNode=s(r.X3DNurbsControlCurveNode,this._trajectoryCurve),this.trajectoryCurveNode&&this.trajectoryCurveNode.addInterest("requestRebuild",this)},build:function(){if(this.profileCurveNode&&this.trajectoryCurveNode){var t=this.extrusion;if(t._crossSection=this.profileCurveNode.tessellate(0),t._spine=this.trajectoryCurveNode.tessellate(1),t.rebuild(),this.getColors().assign(t.getColors()),this.getTexCoords().assign(t.getTexCoords()),this.getNormals().assign(t.getNormals()),this.getVertices().assign(t.getVertices()),this.getMultiTexCoords().push(this.getTexCoords()),!this._ccw.getValue())for(var e=this.getNormals(),i=0,n=e.length;i<n;++i)e[i]=-e[i];this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}}),u})),t("x_ite/Components/NURBS/NurbsTextureCoordinate",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Core/X3DNode","x_ite/Base/X3DConstants","standard/Math/Numbers/Vector4"],(function(t,e,i,n,o,r){"use strict";function s(t){n.call(this,t),this.addType(o.NurbsTextureCoordinate),this.controlPoints=[]}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(o.inputOutput,"metadata",new t.SFNode),new e(o.initializeOnly,"uOrder",new t.SFInt32(3)),new e(o.initializeOnly,"vOrder",new t.SFInt32(3)),new e(o.initializeOnly,"uDimension",new t.SFInt32),new e(o.initializeOnly,"vDimension",new t.SFInt32),new e(o.initializeOnly,"uKnot",new t.MFDouble),new e(o.initializeOnly,"vKnot",new t.MFDouble),new e(o.inputOutput,"weight",new t.MFDouble),new e(o.inputOutput,"controlPoint",new t.MFVec2f)]),getTypeName:function(){return"NurbsTextureCoordinate"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"texCoord"},initialize:function(){n.prototype.initialize.call(this)},getControlPoints:function(t){for(var e=this._controlPoint.getValue(),i=this.controlPoints,n=0,o=this._uDimension.getValue();n<o;++n){var s=i[n];s||(s=i[n]=[]);for(var u=0,a=this._vDimension.getValue();u<a;++u){var l=u*o+n,h=s[u]||new r,d=2*l;s[u]=h.set(e[d],e[d+1],0,t?t[l]:1)}}return i},isValid:function(){return!(this._uOrder.getValue()<2)&&(!(this._vOrder.getValue()<2)&&(!(this._uDimension.getValue()<this._uOrder.getValue())&&(!(this._vDimension.getValue()<this._vOrder.getValue())&&this._controlPoint.length===this._uDimension.getValue()*this._vDimension.getValue())))}}),s})),t("x_ite/Components/NURBS/NurbsTrimmedSurface",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/NURBS/X3DNurbsSurfaceGeometryNode","x_ite/Base/X3DConstants","x_ite/Base/X3DCast"],(function(t,e,i,n,o,r){"use strict";function s(t){n.call(this,t),this.addType(o.NurbsTrimmedSurface),this.trimmingContourNodes=[]}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new e(o.inputOutput,"metadata",new t.SFNode),new e(o.initializeOnly,"solid",new t.SFBool(!0)),new e(o.inputOutput,"uTessellation",new t.SFInt32),new e(o.inputOutput,"vTessellation",new t.SFInt32),new e(o.initializeOnly,"uClosed",new t.SFBool),new e(o.initializeOnly,"vClosed",new t.SFBool),new e(o.initializeOnly,"uOrder",new t.SFInt32(3)),new e(o.initializeOnly,"vOrder",new t.SFInt32(3)),new e(o.initializeOnly,"uDimension",new t.SFInt32),new e(o.initializeOnly,"vDimension",new t.SFInt32),new e(o.initializeOnly,"uKnot",new t.MFDouble),new e(o.initializeOnly,"vKnot",new t.MFDouble),new e(o.inputOutput,"weight",new t.MFDouble),new e(o.inputOutput,"texCoord",new t.SFNode),new e(o.inputOutput,"controlPoint",new t.SFNode),new e(o.inputOnly,"addTrimmingContour",new t.MFNode),new e(o.inputOnly,"removeTrimmingContour",new t.MFNode),new e(o.inputOutput,"trimmingContour",new t.MFNode)]),getTypeName:function(){return"NurbsTrimmedSurface"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"},initialize:function(){n.prototype.initialize.call(this),this._trimmingContour.addInterest("set_trimmingContour__",this),this.set_trimmingContour__()},set_trimmingContour__:function(){var t=this.trimmingContourNodes;t.length=0;for(var e=0,i=this._trimmingContour.length;e<i;++e){var n=r(o.Contour2D,this._trimmingContour[e]);n&&t.push(n)}},getTrimmingContours:function(){for(var t=this.trimmingContourNodes,e=[],i=0,n=t.length;i<n;++i)t[i].addTrimmingContour(e);return e}}),s})),t(e.getComponentUrl("nurbs"),["x_ite/Components","x_ite/Components/NURBS/Contour2D","x_ite/Components/NURBS/ContourPolyline2D","x_ite/Components/NURBS/CoordinateDouble","x_ite/Components/NURBS/NurbsCurve","x_ite/Components/NURBS/NurbsCurve2D","x_ite/Components/NURBS/NurbsOrientationInterpolator","x_ite/Components/NURBS/NurbsPatchSurface","x_ite/Components/NURBS/NurbsPositionInterpolator","x_ite/Components/NURBS/NurbsSet","x_ite/Components/NURBS/NurbsSurfaceInterpolator","x_ite/Components/NURBS/NurbsSweptSurface","x_ite/Components/NURBS/NurbsSwungSurface","x_ite/Components/NURBS/NurbsTextureCoordinate","x_ite/Components/NURBS/NurbsTrimmedSurface","x_ite/Components/NURBS/X3DNurbsControlCurveNode","x_ite/Components/NURBS/X3DNurbsSurfaceGeometryNode","x_ite/Components/NURBS/X3DParametricGeometryNode"],(function(t,e,i,n,o,r,s,u,a,l,h,d,c,g,f,p,_,m){"use strict";t.addComponent({name:"NURBS",types:{Contour2D:e,ContourPolyline2D:i,CoordinateDouble:n,NurbsCurve:o,NurbsCurve2D:r,NurbsOrientationInterpolator:s,NurbsPatchSurface:u,NurbsPositionInterpolator:a,NurbsSet:l,NurbsSurfaceInterpolator:h,NurbsSweptSurface:d,NurbsSwungSurface:c,NurbsTextureCoordinate:g,NurbsTrimmedSurface:f},abstractTypes:{X3DNurbsControlCurveNode:p,X3DNurbsSurfaceGeometryNode:_,X3DParametricGeometryNode:m}})}))}();
