!function(){var define=X3D.define,require=X3D.require,module={};define("x_ite/Browser/Scripting/evaluate",[],function(){return function(){with(arguments[0])return eval(arguments[1])}}),define("x_ite/Components/Scripting/X3DScriptNode",["x_ite/Components/Core/X3DChildNode","x_ite/Components/Networking/X3DUrlObject","x_ite/Bits/X3DConstants"],function(t,e,i){"use strict";function n(n){t.call(this,n),e.call(this,n),this.addType(i.X3DScriptNode)}return n.prototype=Object.assign(Object.create(t.prototype),e.prototype,{constructor:n}),n}),define("x_ite/Components/Scripting/Script",["jquery","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Basic/X3DField","x_ite/Basic/X3DArrayField","x_ite/Fields","x_ite/Browser/X3DBrowser","x_ite/Configuration/ComponentInfo","x_ite/Configuration/ComponentInfoArray","x_ite/Configuration/ProfileInfo","x_ite/Configuration/ProfileInfoArray","x_ite/Configuration/UnitInfo","x_ite/Configuration/UnitInfoArray","x_ite/Execution/X3DExecutionContext","x_ite/Execution/X3DScene","x_ite/Prototype/ExternProtoDeclarationArray","x_ite/Prototype/ProtoDeclarationArray","x_ite/Prototype/X3DExternProtoDeclaration","x_ite/Prototype/X3DProtoDeclaration","x_ite/Routing/RouteArray","x_ite/Routing/X3DRoute","x_ite/Browser/Scripting/evaluate","x_ite/Components/Scripting/X3DScriptNode","x_ite/InputOutput/FileLoader","x_ite/Bits/X3DConstants","x_ite/Fields/SFNodeCache"],function(t,e,i,n,r,o,s,a,c,u,l,d,p,f,h,_,F,v,S,g,x,M,y,E,D,m){function C(t){y.call(this,t),this.addChildObjects("buffer",new o.MFString),this.addType(D.Script)}return C.prototype=Object.assign(Object.create(y.prototype),{constructor:C,fieldDefinitions:new i([new e(D.inputOutput,"metadata",new o.SFNode),new e(D.inputOutput,"url",new o.MFString),new e(D.initializeOnly,"directOutput",new o.SFBool),new e(D.initializeOnly,"mustEvaluate",new o.SFBool)]),getTypeName:function(){return"Script"},getComponentName:function(){return"Scripting"},getContainerField:function(){return"children"},initialize:function(){y.prototype.initialize.call(this),this.url_.addInterest("set_url__",this),this.buffer_.addInterest("set_buffer__",this),this.getUserDefinedFields().forEach(function(t){t.setModificationTime(0)}),this.set_url__()},set_url__:function(){this.setLoadState(D.NOT_STARTED_STATE),this.requestImmediateLoad()},getExtendedEventHandling:function(){return!1},hasUserDefinedFields:function(){return!0},getSourceText:function(){return this.url_},requestImmediateLoad:function(){this.checkLoadState()!==D.COMPLETE_STATE&&this.checkLoadState()!==D.IN_PROGRESS_STATE&&0!==this.url_.length&&(this.setLoadState(D.IN_PROGRESS_STATE),this.buffer_=this.url_)},set_buffer__:function(){new E(this).loadScript(this.buffer_,function(t){null===t?this.setLoadState(D.FAILED_STATE):(this.setLoadState(D.COMPLETE_STATE),this.initialize__(t))}.bind(this))},getContext:function(t){try{const i=["initialize","prepareEvents","eventsProcessed","shutdown"];this.getUserDefinedFields().forEach(function(t){switch(t.getAccessType()){case D.inputOnly:i.push(t.getName());break;case D.inputOutput:i.push("set_"+t.getName())}}),t+="\n;var "+i.join(",")+";",t+="\n["+i.join(",")+"];";const n=this.getGlobal(),r=M(n,t),o={};for(var e=0;e<i.length;++e)"function"==typeof r[e]?o[i[e]]=r[e]:o[i[e]]=null;return o}catch(t){return this.setError("while evaluating script source",t),{}}},getGlobal:function(){function t(t){const e=M.createX3DFromString(String(t)),i=e.getRootNodes();if(E.addFieldInterest(e.isLive()),e.setLive(E.getValue()),e.setPrivate(y.getPrivate()),e.setExecutionContext(y),i.length&&i[0])return m.add(i[0].getValue(),this);throw new Error("SFNode.new: invalid argument, must be 'string' is 'undefined'.")}const M=this.getBrowser(),y=this.getExecutionContext(),E=this.isLive();t.prototype=o.SFNode.prototype;const C={NULL:{value:null},FALSE:{value:!1},TRUE:{value:!0},print:{value:function(){M.println.apply(M,arguments)}},trace:{value:function(){M.println.apply(M,arguments)}},Browser:{value:M},X3DConstants:{value:D},X3DBrowser:{value:s},X3DExecutionContext:{value:f},X3DScene:{value:h},ComponentInfo:{value:a},ComponentInfoArray:{value:c},ProfileInfo:{value:u},ProfileInfoArray:{value:l},UnitInfo:{value:d},UnitInfoArray:{value:p},ExternProtoDeclarationArray:{value:_},ProtoDeclarationArray:{value:F},X3DExternProtoDeclaration:{value:v},X3DProtoDeclaration:{value:S},RouteArray:{value:g},X3DRoute:{value:x},X3DFieldDefinition:{value:e},FieldDefinitionArray:{value:i},X3DField:{value:n},X3DArrayField:{value:r},SFColor:{value:o.SFColor},SFColorRGBA:{value:o.SFColorRGBA},SFImage:{value:o.SFImage},SFMatrix3d:{value:o.SFMatrix3d},SFMatrix3f:{value:o.SFMatrix3f},SFMatrix4d:{value:o.SFMatrix4d},SFMatrix4f:{value:o.SFMatrix4f},SFNode:{value:t},SFRotation:{value:o.SFRotation},SFVec2d:{value:o.SFVec2d},SFVec2f:{value:o.SFVec2f},SFVec3d:{value:o.SFVec3d},SFVec3f:{value:o.SFVec3f},SFVec4d:{value:o.SFVec4d},SFVec4f:{value:o.SFVec4f},VrmlMatrix:{value:o.VrmlMatrix},MFBool:{value:o.MFBool},MFColor:{value:o.MFColor},MFColorRGBA:{value:o.MFColorRGBA},MFDouble:{value:o.MFDouble},MFFloat:{value:o.MFFloat},MFImage:{value:o.MFImage},MFInt32:{value:o.MFInt32},MFMatrix3d:{value:o.MFMatrix3d},MFMatrix3f:{value:o.MFMatrix3f},MFMatrix4d:{value:o.MFMatrix4d},MFMatrix4f:{value:o.MFMatrix4f},MFNode:{value:o.MFNode},MFRotation:{value:o.MFRotation},MFString:{value:o.MFString},MFTime:{value:o.MFTime},MFVec2d:{value:o.MFVec2d},MFVec2f:{value:o.MFVec2f},MFVec3d:{value:o.MFVec3d},MFVec3f:{value:o.MFVec3f},MFVec4d:{value:o.MFVec4d},MFVec4f:{value:o.MFVec4f}};return this.getUserDefinedFields().forEach(function(t){const e=t.getName();t.getAccessType()!==D.inputOnly&&(e in C||(C[e]={get:t.valueOf.bind(t),set:t.setValue.bind(t)}),t.getAccessType()===D.inputOutput&&(C[e+"_changed"]={get:t.valueOf.bind(t),set:t.setValue.bind(t)}))}),Object.create(Object.prototype,C)},set_live__:function(){this.isLive().getValue()?(t.isFunction(this.context.prepareEvents)&&this.getBrowser().prepareEvents().addInterest("prepareEvents__",this),t.isFunction(this.context.eventsProcessed)&&this.addInterest("eventsProcessed__",this),this.getUserDefinedFields().forEach(function(e){switch(e.getAccessType()){case D.inputOnly:{const i=this.context[e.getName()];t.isFunction(i)&&e.addInterest("set_field__",this,i);break}case D.inputOutput:{const i=this.context["set_"+e.getName()];t.isFunction(i)&&e.addInterest("set_field__",this,i);break}}},this)):(this.context.prepareEvents&&this.getBrowser().prepareEvents().removeInterest("prepareEvents__",this),this.context.eventsProcessed&&this.removeInterest("eventsProcessed__",this),this.getUserDefinedFields().forEach(function(t){switch(t.getAccessType()){case D.inputOnly:case D.inputOutput:t.removeInterest("set_field__",this)}},this))},initialize__:function(e){if(this.context=this.getContext(e),this.isLive().addInterest("set_live__",this),this.set_live__(),t.isFunction(this.context.initialize)){const t=this.getBrowser();t.getScriptStack().push(this);try{this.context.initialize()}catch(t){this.setError("in function 'initialize'",t)}t.getScriptStack().pop()}t.isFunction(this.context.shutdown)&&t(window).on("unload",this.shutdown__.bind(this)),this.getUserDefinedFields().forEach(function(e){if(e.getModificationTime())switch(e.getAccessType()){case D.inputOnly:{const i=this.context[e.getName()];t.isFunction(i)&&this.set_field__(e,i);break}case D.inputOutput:{const i=this.context["set_"+e.getName()];t.isFunction(i)&&this.set_field__(e,i);break}}},this)},prepareEvents__:function(){const t=this.getBrowser();t.getScriptStack().push(this);try{this.context.prepareEvents(t.getCurrentTime()),t.addBrowserEvent()}catch(t){this.setError("in function 'prepareEvents'",t)}t.getScriptStack().pop()},set_field__:function(t,e){const i=this.getBrowser();t.setTainted(!0),i.getScriptStack().push(this);try{e(t.valueOf(),i.getCurrentTime())}catch(e){this.setError("in function '"+t.getName()+"'",e)}i.getScriptStack().pop(),t.setTainted(!1)},eventsProcessed__:function(){const t=this.getBrowser();t.getScriptStack().push(this);try{this.context.eventsProcessed()}catch(t){this.setError("in function 'eventsProcessed'",t)}t.getScriptStack().pop()},shutdown__:function(){const t=this.getBrowser();t.getScriptStack().push(this);try{this.context.shutdown()}catch(t){this.setError("in function 'shutdown'",t)}t.getScriptStack().pop()},setError:function(t,e){console.error("JavaScript Error in Script '"+this.getName()+"', "+t+"\nworld url is '"+this.getExecutionContext().getURL()+"':"),console.error(e)}}),C}),define(["x_ite/Components","x_ite/Components/Scripting/Script","x_ite/Components/Scripting/X3DScriptNode"],function(t,e,i){"use strict";t.addComponent({name:"Scripting",types:{Script:e},abstractTypes:{X3DScriptNode:i}})})}();
