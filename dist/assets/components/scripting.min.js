!function(nodeModule,nodeRequire,__filename){var define=X3D.define,require=X3D.require,module={},exports,process;void 0===__filename&&(nodeModule=void 0,nodeRequire=void 0),define("x_ite/Browser/Scripting/evaluate",[],function(){return function(){with(arguments[0])return eval(arguments[1])}}),define("x_ite/Components/Scripting/X3DScriptNode",["x_ite/Components/Core/X3DChildNode","x_ite/Components/Networking/X3DUrlObject","x_ite/Bits/X3DConstants"],function(e,t,i){"use strict";function n(n){e.call(this,n),t.call(this,n),this.addType(i.X3DScriptNode)}return n.prototype=Object.assign(Object.create(e.prototype),t.prototype,{constructor:n}),n}),define("x_ite/Components/Scripting/Script",["jquery","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Basic/X3DField","x_ite/Basic/X3DArrayField","x_ite/Fields","x_ite/Browser/X3DBrowser","x_ite/Configuration/ComponentInfo","x_ite/Configuration/ComponentInfoArray","x_ite/Configuration/ProfileInfo","x_ite/Configuration/ProfileInfoArray","x_ite/Configuration/UnitInfo","x_ite/Configuration/UnitInfoArray","x_ite/Execution/X3DExecutionContext","x_ite/Execution/X3DScene","x_ite/Prototype/ExternProtoDeclarationArray","x_ite/Prototype/ProtoDeclarationArray","x_ite/Prototype/X3DExternProtoDeclaration","x_ite/Prototype/X3DProtoDeclaration","x_ite/Routing/RouteArray","x_ite/Routing/X3DRoute","x_ite/Browser/Scripting/evaluate","x_ite/Components/Scripting/X3DScriptNode","x_ite/InputOutput/FileLoader","x_ite/Bits/X3DConstants","x_ite/Fields/SFNodeCache"],function(e,t,i,n,o,r,s,a,u,c,l,d,p,f,h,_,v,F,S,g,x,m,M,y,E,D){function w(e){M.call(this,e),this.addChildObjects("buffer",new r.MFString),this.addType(E.Script),this.pauseTime=0}return w.prototype=Object.assign(Object.create(M.prototype),{constructor:w,fieldDefinitions:new i([new t(E.inputOutput,"metadata",new r.SFNode),new t(E.inputOutput,"url",new r.MFString),new t(E.inputOutput,"autoRefresh",new r.SFTime),new t(E.inputOutput,"autoRefreshTimeLimit",new r.SFTime(3600)),new t(E.initializeOnly,"directOutput",new r.SFBool),new t(E.initializeOnly,"mustEvaluate",new r.SFBool)]),getTypeName:function(){return"Script"},getComponentName:function(){return"Scripting"},getContainerField:function(){return"children"},initialize:function(){M.prototype.initialize.call(this),this.url_.addInterest("set_url__",this),this.buffer_.addInterest("set_buffer__",this),this.getUserDefinedFields().forEach(function(e){e.setModificationTime(0)}),this.set_url__()},set_url__:function(){this.setLoadState(E.NOT_STARTED_STATE),this.requestImmediateLoad()},getExtendedEventHandling:function(){return!1},hasUserDefinedFields:function(){return!0},getSourceText:function(){return this.url_},requestImmediateLoad:function(e=!0){this.checkLoadState()!==E.COMPLETE_STATE&&this.checkLoadState()!==E.IN_PROGRESS_STATE&&0!==this.url_.length&&(this.setCache(e),this.setLoadState(E.IN_PROGRESS_STATE),this.buffer_=this.url_)},set_buffer__:function(){new y(this).loadScript(this.buffer_,function(e){null===e?this.setLoadState(E.FAILED_STATE):(this.setLoadState(E.COMPLETE_STATE),this.initialize__(e))}.bind(this))},getContext:function(e){try{const t=["initialize","prepareEvents","eventsProcessed","shutdown"];this.getUserDefinedFields().forEach(function(e){switch(e.getAccessType()){case E.inputOnly:t.push(e.getName());break;case E.inputOutput:t.push("set_"+e.getName())}}),e+="\n;var "+t.join(",")+";",e+="\n["+t.join(",")+"];";const i=this.getGlobal(),n=m(i,e),o={};for(let e=0;e<t.length;++e)o[t[e]]=n[e];return o}catch(e){return this.setError("while evaluating script source",e),{}}},getGlobal:function(){function e(e){const t=m.createX3DFromString(String(e)),i=t.getRootNodes();if(y.addFieldInterest(t.isLive()),t.setLive(y.getValue()),t.setPrivate(M.getPrivate()),t.setExecutionContext(M),i.length&&i[0])return D.add(i[0].getValue(),this);throw new Error("SFNode.new: invalid argument, must be 'string' is 'undefined'.")}const m=this.getBrowser(),M=this.getExecutionContext(),y=this.isLive();e.prototype=r.SFNode.prototype;const w={NULL:{value:null},FALSE:{value:!1},TRUE:{value:!0},print:{value:function(){m.println.apply(m,arguments)}},trace:{value:function(){m.println.apply(m,arguments)}},Browser:{value:m},X3DConstants:{value:E},X3DBrowser:{value:s},X3DExecutionContext:{value:f},X3DScene:{value:h},ComponentInfo:{value:a},ComponentInfoArray:{value:u},ProfileInfo:{value:c},ProfileInfoArray:{value:l},UnitInfo:{value:d},UnitInfoArray:{value:p},ExternProtoDeclarationArray:{value:_},ProtoDeclarationArray:{value:v},X3DExternProtoDeclaration:{value:F},X3DProtoDeclaration:{value:S},RouteArray:{value:g},X3DRoute:{value:x},X3DFieldDefinition:{value:t},FieldDefinitionArray:{value:i},X3DField:{value:n},X3DArrayField:{value:o},SFColor:{value:r.SFColor},SFColorRGBA:{value:r.SFColorRGBA},SFImage:{value:r.SFImage},SFMatrix3d:{value:r.SFMatrix3d},SFMatrix3f:{value:r.SFMatrix3f},SFMatrix4d:{value:r.SFMatrix4d},SFMatrix4f:{value:r.SFMatrix4f},SFNode:{value:e},SFRotation:{value:r.SFRotation},SFVec2d:{value:r.SFVec2d},SFVec2f:{value:r.SFVec2f},SFVec3d:{value:r.SFVec3d},SFVec3f:{value:r.SFVec3f},SFVec4d:{value:r.SFVec4d},SFVec4f:{value:r.SFVec4f},VrmlMatrix:{value:r.VrmlMatrix},MFBool:{value:r.MFBool},MFColor:{value:r.MFColor},MFColorRGBA:{value:r.MFColorRGBA},MFDouble:{value:r.MFDouble},MFFloat:{value:r.MFFloat},MFImage:{value:r.MFImage},MFInt32:{value:r.MFInt32},MFMatrix3d:{value:r.MFMatrix3d},MFMatrix3f:{value:r.MFMatrix3f},MFMatrix4d:{value:r.MFMatrix4d},MFMatrix4f:{value:r.MFMatrix4f},MFNode:{value:r.MFNode},MFRotation:{value:r.MFRotation},MFString:{value:r.MFString},MFTime:{value:r.MFTime},MFVec2d:{value:r.MFVec2d},MFVec2f:{value:r.MFVec2f},MFVec3d:{value:r.MFVec3d},MFVec3f:{value:r.MFVec3f},MFVec4d:{value:r.MFVec4d},MFVec4f:{value:r.MFVec4f}};return this.getUserDefinedFields().forEach(function(e){const t=e.getName();e.getAccessType()!==E.inputOnly&&(t in w||(w[t]={get:e.valueOf.bind(e),set:e.setValue.bind(e)}),e.getAccessType()===E.inputOutput&&(w[t+"_changed"]={get:e.valueOf.bind(e),set:e.setValue.bind(e)}))}),Object.create(Object.prototype,w)},processOutstandingEvents:function(){this.getUserDefinedFields().forEach(function(t){if(!(t.getModificationTime()<=this.pauseTime))switch(t.getAccessType()){case E.inputOnly:{const i=this.context[t.getName()];e.isFunction(i)&&this.set_field__(t,i);break}case E.inputOutput:{const i=this.context["set_"+t.getName()];e.isFunction(i)&&this.set_field__(t,i);break}}},this)},initialize__:function(e){this.context=this.getContext(e),this.isLive().addInterest("set_live__",this),this.set_live__()},set_live__:function(){if(this.context)if(this.isLive().getValue()){if(!this.initialized){if(this.initialized=!0,e.isFunction(this.context.initialize)){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.initialize()}catch(e){this.setError("in function 'initialize'",e)}e.getScriptStack().pop()}e.isFunction(this.context.shutdown)&&e(window).on("unload",this.shutdown__.bind(this))}e.isFunction(this.context.prepareEvents)&&this.getBrowser().prepareEvents().addInterest("prepareEvents__",this),e.isFunction(this.context.eventsProcessed)&&this.addInterest("eventsProcessed__",this),this.getUserDefinedFields().forEach(function(t){switch(t.getAccessType()){case E.inputOnly:{const i=this.context[t.getName()];e.isFunction(i)&&t.addInterest("set_field__",this,i);break}case E.inputOutput:{const i=this.context["set_"+t.getName()];e.isFunction(i)&&t.addInterest("set_field__",this,i);break}}},this),this.processOutstandingEvents()}else this.context.prepareEvents&&this.getBrowser().prepareEvents().removeInterest("prepareEvents__",this),this.context.eventsProcessed&&this.removeInterest("eventsProcessed__",this),this.getUserDefinedFields().forEach(function(e){switch(e.getAccessType()){case E.inputOnly:case E.inputOutput:e.removeInterest("set_field__",this)}},this),this.initialized&&(this.pauseTime=performance.now())},prepareEvents__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.prepareEvents(e.getCurrentTime()),e.addBrowserEvent()}catch(e){this.setError("in function 'prepareEvents'",e)}e.getScriptStack().pop()},set_field__:function(e,t){const i=this.getBrowser();e.setTainted(!0),i.getScriptStack().push(this);try{t(e.valueOf(),i.getCurrentTime())}catch(t){this.setError("in function '"+e.getName()+"'",t)}i.getScriptStack().pop(),e.setTainted(!1)},eventsProcessed__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.eventsProcessed()}catch(e){this.setError("in function 'eventsProcessed'",e)}e.getScriptStack().pop()},shutdown__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.shutdown()}catch(e){this.setError("in function 'shutdown'",e)}e.getScriptStack().pop()},setError:function(e,t){console.error("JavaScript Error in Script '"+this.getName()+"', "+e+"\nworld url is '"+this.getExecutionContext().getWorldURL()+"':"),console.error(t)}}),w}),define(X3D.getComponentUrl("scripting"),["x_ite/Components","x_ite/Components/Scripting/Script","x_ite/Components/Scripting/X3DScriptNode"],function(e,t,i){"use strict";e.addComponent({name:"Scripting",types:{Script:t},abstractTypes:{X3DScriptNode:i}})})}("undefined"!=typeof module?module:void 0,"undefined"!=typeof require?require:void 0,"undefined"!=typeof __filename?__filename:void 0);
