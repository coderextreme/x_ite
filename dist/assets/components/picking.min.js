!function(){const e=window[Symbol.for("X_ITE.X3D-6.1.0")],t=e.define,i=e.require;t("x_ite/Browser/Picking/MatchCriterion",[],(function(){"use strict";let e=0;return{MATCH_ANY:e++,MATCH_EVERY:e++,MATCH_ONLY_ONE:e++}})),t("x_ite/Browser/Picking/IntersectionType",[],(function(){"use strict";let e=0;return{BOUNDS:e++,GEOMETRY:e++}})),t("x_ite/Browser/Picking/SortOrder",[],(function(){"use strict";let e=0;return{ANY:e++,CLOSEST:e++,ALL:e++,ALL_SORTED:e++}})),t("x_ite/Components/Picking/X3DPickSensorNode",["x_ite/Fields","x_ite/Components/Core/X3DSensorNode","x_ite/Rendering/TraverseType","x_ite/Base/X3DConstants","x_ite/Browser/Picking/MatchCriterion","x_ite/Browser/Picking/IntersectionType","x_ite/Browser/Picking/SortOrder","standard/Math/Numbers/Matrix4","standard/Math/Algorithms/QuickSort","standard/Utility/ObjectCache"],(function(e,t,i,n,o,s,r,c,a,h){"use strict";var p,d,g,l,u=h(c);function m(e,t){return e.distance<t.distance}function _(i){t.call(this,i),this.addType(n.X3DPickSensorNode),this.objectType=new Set,this.intersectionType=s.BOUNDS,this.sortOrder=r.CLOSEST,this.pickTargetNodes=new Set,this.modelMatrices=[],this.targets=[],this.targets.size=0,this.pickedTargets=[],this.pickedTargetsSorter=new a(this.pickedTargets,m),this.pickedGeometries=new e.MFNode}return _.prototype=Object.assign(Object.create(t.prototype),{constructor:_,initialize:function(){this.isLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._objectType.addInterest("set_objectType__",this),this._matchCriterion.addInterest("set_matchCriterion__",this),this._intersectionType.addInterest("set_intersectionType__",this),this._sortOrder.addInterest("set_sortOrder__",this),this._pickTarget.addInterest("set_pickTarget__",this),this.set_objectType__(),this.set_matchCriterion__(),this.set_intersectionType__(),this.set_sortOrder__(),this.set_pickTarget__()},getObjectType:function(){return this.objectType},getMatchCriterion:function(){return this.matchCriterion},getIntersectionType:function(){return this.intersectionType},getSortOrder:function(){return this.sortOrder},getModelMatrices:function(){return this.modelMatrices},getTargets:function(){return this.targets},getPickShape:(l=new WeakMap,function(e){var t=l.get(e);if(void 0!==t)return t;var i=this.getExecutionContext().createNode("Shape",!1),n=this.getExecutionContext().createNode("CollidableShape",!1);return i.setPrivate(!0),n.setPrivate(!0),n.setConvex(!0),i._geometry=e,n._shape=i,i.setup(),n.setup(),l.set(e,n),n}),getPickedGeometries:function(){var e=this.targets,t=e.size,i=this.pickedTargets,n=this.pickedGeometries;i.length=0;for(var o=0;o<t;++o){var s=e[o];s.intersected&&i.push(s)}if(0===i.length)return n.length=0,n;switch(this.sortOrder){case r.ANY:i.length=1,n[0]=this.getPickedGeometry(i[0]),n.length=1;break;case r.CLOSEST:this.pickedTargetsSorter.sort(0,i.length),i.length=1,n[0]=this.getPickedGeometry(i[0]),n.length=1;break;case r.ALL:o=0;for(var c=i.length;o<c;++o)n[o]=this.getPickedGeometry(i[o]);n.length=c;break;case r.ALL_SORTED:for(this.pickedTargetsSorter.sort(0,i.length),o=0,c=i.length;o<c;++o)n[o]=this.getPickedGeometry(i[o]);n.length=c}return n},getPickedGeometry:function(e){var t=this.getExecutionContext(),i=e.geometryNode;if(i.getExecutionContext()===t)return i;if(-1!==(r=i.getExecutionContext()).getType().indexOf(n.X3DPrototypeInstance)&&r.getExecutionContext()===t)return r;for(var o=e.pickingHierarchy,s=o.length-1;s>=0;--s){var r,c=o[s];if(c.getExecutionContext()===t)return c;if(-1!==(r=c.getExecutionContext()).getType().indexOf(n.X3DPrototypeInstance)&&r.getExecutionContext()===t)return r}return null},getPickedTargets:function(){return this.pickedTargets},set_live__:function(){this.isLive().getValue()&&this._enabled.getValue()&&!this.objectType.has("NONE")?(this.getBrowser().addPickSensor(this),this.setPickableObject(!0)):(this.getBrowser().removePickSensor(this),this.setPickableObject(!1))},set_objectType__:function(){this.objectType.clear();for(var e=0,t=this._objectType.length;e<t;++e)this.objectType.add(this._objectType[e]);this.set_live__()},set_matchCriterion__:(g=new Map([["MATCH_ANY",o.MATCH_ANY],["MATCH_EVERY",o.MATCH_EVERY],["MATCH_ONLY_ONE",o.MATCH_ONLY_ONE]]),function(){this.matchCriterion=g.get(this._matchCriterion.getValue()),void 0===this.matchCriterion&&(this.matchCriterion=MatchCriterionType.MATCH_ANY)}),set_intersectionType__:(d=new Map([["BOUNDS",s.BOUNDS],["GEOMETRY",s.GEOMETRY]]),function(){this.intersectionType=d.get(this._intersectionType.getValue()),void 0===this.intersectionType&&(this.intersectionType=s.BOUNDS)}),set_sortOrder__:(p=new Map([["ANY",r.ANY],["CLOSEST",r.CLOSEST],["ALL",r.ALL],["ALL_SORTED",r.ALL_SORTED]]),function(){this.sortOrder=p.get(this._sortOrder.getValue()),void 0===this.sortOrder&&(this.sortOrder=r.CLOSEST)}),set_pickTarget__:function(){this.pickTargetNodes.clear();for(var e=0,t=this._pickTarget.length;e<t;++e)try{for(var i=this._pickTarget[e].getValue().getInnerNode(),o=i.getType(),s=o.length-1;s>=0;--s)switch(o[s]){case n.Inline:case n.Shape:case n.X3DGroupingNode:this.pickTargetNodes.add(i);break;default:continue}}catch(e){}},traverse:function(e,t){e===i.PICKING&&this.getPickableObject()&&this.modelMatrices.push(u.pop().assign(t.getModelViewMatrix().get()))},collect:function(e,t,i){var n=this.pickTargetNodes;if(i.some((function(e){return n.has(e)}))){var o=this.targets;if(o.size<o.length)var s=o[o.size];else{s={modelMatrix:new c,pickingHierarchy:[],pickedPoint:[],intersections:[]};o.push(s)}++o.size,s.intersected=!1,s.geometryNode=e,s.pickedPoint.length=0,s.intersections.length=0,s.modelMatrix.assign(t);for(var r=s.pickingHierarchy,a=0,h=i.length;a<h;++a)r[a]=i[a];r.length=h}},process:function(){for(var e=this.modelMatrices,t=0,i=e.length;t<i;++t)u.push(e[t]);this.modelMatrices.length=0,this.targets.size=0}}),_})),t("x_ite/Components/Picking/LinePickSensor",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Picking/X3DPickSensorNode","x_ite/Base/X3DConstants","x_ite/Browser/Picking/IntersectionType","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Box3","standard/Math/Geometry/Line3"],(function(e,t,i,n,o,s,r,c,a,h){"use strict";function p(e){n.call(this,e),this.addType(o.LinePickSensor),this.pickingGeometryNode=null}var d,g,l,u,m,_,y,k,f,w,S,C,T,N,b,O;return p.prototype=Object.assign(Object.create(n.prototype),{constructor:p,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new t(o.inputOutput,"metadata",new e.SFNode),new t(o.inputOutput,"enabled",new e.SFBool(!0)),new t(o.inputOutput,"objectType",new e.MFString("ALL")),new t(o.inputOutput,"matchCriterion",new e.SFString("MATCH_ANY")),new t(o.initializeOnly,"intersectionType",new e.SFString("BOUNDS")),new t(o.initializeOnly,"sortOrder",new e.SFString("CLOSEST")),new t(o.outputOnly,"isActive",new e.SFBool),new t(o.outputOnly,"pickedTextureCoordinate",new e.MFVec3f),new t(o.outputOnly,"pickedNormal",new e.MFVec3f),new t(o.outputOnly,"pickedPoint",new e.MFVec3f),new t(o.inputOutput,"pickingGeometry",new e.SFNode),new t(o.inputOutput,"pickTarget",new e.MFNode),new t(o.outputOnly,"pickedGeometry",new e.MFNode)]),getTypeName:function(){return"LinePickSensor"},getComponentName:function(){return"Picking"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this._pickingGeometry.addInterest("set_pickingGeometry__",this),this.set_pickingGeometry__()},set_pickingGeometry__:function(){this.pickingGeometryNode=null;try{for(var e=this._pickingGeometry.getValue().getInnerNode(),t=e.getType(),i=t.length-1;i>=0;--i)switch(t[i]){case o.IndexedLineSet:case o.LineSet:this.pickingGeometryNode=e;break;default:continue}}catch(e){}},process:(d=new a,g=new a,l=new r(0,0,0),u=new r(0,0,0),m=new c,_=new r(0,0,0),y=new r(0,0,0),k=new h(r.Zero,r.zAxis),f=new r(0,0,0),w=new r(0,0,0),S=[],C=[],T=new r(0,0,0),N=new e.MFVec3f,b=new e.MFVec3f,O=new e.MFVec3f,function(){if(this.pickingGeometryNode){var e=this.getModelMatrices(),t=this.getTargets();switch(this.getIntersectionType()){case s.BOUNDS:for(var i=0,o=e.length;i<o;++i){var r=e[i];d.assign(this.pickingGeometryNode.getBBox()).multRight(r);for(var c=0,a=t.size;c<a;++c){var h=t[c];g.assign(h.geometryNode.getBBox()).multRight(h.modelMatrix),d.intersectsBox(g)&&(l.assign(d.center),u.assign(g.center),h.intersected=!0,h.distance=l.distance(u))}}var p=this.getPickedGeometries(),x=Boolean(p.length);p.remove(0,p.length,null),x!==this._isActive.getValue()&&(this._isActive=x),this._pickedGeometry.equals(p)||(this._pickedGeometry=p);break;case s.GEOMETRY:for(i=0,o=e.length;i<o;++i)for(r=e[i],d.assign(this.pickingGeometryNode.getBBox()).multRight(r),c=0,a=t.size;c<a;++c){var P=(h=t[c]).geometryNode,v=this.pickingGeometryNode.getVertices();g.assign(P.getBBox()).multRight(h.modelMatrix),m.assign(h.modelMatrix).inverse().multLeft(r);for(var B=0,M=v.length;B<M;B+=8)if(m.multVecMatrix(_.set(v[B+0],v[B+1],v[B+2])),m.multVecMatrix(y.set(v[B+4],v[B+5],v[B+6])),k.setPoints(_,y),C.length=0,P.intersectsLineWithGeometry(k,h.modelMatrix,S,C))for(var G=0,D=C.length;G<D;++G){var F=C[G];f.assign(F.point).subtract(_),w.assign(F.point).subtract(y),f.add(w).magnitude()<=_.distance(y)&&h.intersections.push(F)}h.intersections.length&&(l.assign(d.center),u.assign(g.center),h.intersected=!0,h.distance=l.distance(u))}p=this.getPickedGeometries(),x=Boolean(p.length),p.remove(0,p.length,null),x!==this._isActive.getValue()&&(this._isActive=x),this._pickedGeometry.equals(p)||(this._pickedGeometry=p);var A=this.getPickedTargets();for(N.length=0,b.length=0,O.length=0,c=0,a=A.length;c<a;++c){var V=A[c].intersections;for(G=0,D=V.length;G<D;++G)c=(F=V[G]).texCoord,T.set(c.x,c.y,c.z),N.push(T),b.push(F.normal),O.push(F.point)}this._pickedTextureCoordinate.equals(N)||(this._pickedTextureCoordinate=N),this._pickedNormal.equals(b)||(this._pickedNormal=b),this._pickedPoint.equals(O)||(this._pickedPoint=O)}}n.prototype.process.call(this)})}),p})),t("x_ite/Components/Picking/X3DPickableObject",["x_ite/Base/X3DConstants"],(function(e){"use strict";function t(t){this.addType(e.X3DPickableObject),this.objectType=new Set}return t.prototype={constructor:t,initialize:function(){this._objectType.addInterest("set_objectType__",this),this.set_objectType__()},getObjectType:function(){return this.objectType},set_objectType__:function(){this.objectType.clear();for(var e=0,t=this._objectType.length;e<t;++e)this.objectType.add(this._objectType[e])}},t})),t("x_ite/Components/Picking/PickableGroup",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Grouping/X3DGroupingNode","x_ite/Components/Picking/X3DPickableObject","x_ite/Browser/Picking/MatchCriterion","x_ite/Base/X3DConstants","x_ite/Rendering/TraverseType"],(function(e,t,i,n,o,s,r,c){"use strict";function a(e){n.call(this,e),o.call(this,e),this.addType(r.PickableGroup)}return a.prototype=Object.assign(Object.create(n.prototype),o.prototype,{constructor:a,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new t(r.inputOutput,"metadata",new e.SFNode),new t(r.inputOutput,"pickable",new e.SFBool(!0)),new t(r.inputOutput,"objectType",new e.MFString("ALL")),new t(r.inputOutput,"visible",new e.SFBool(!0)),new t(r.inputOutput,"bboxDisplay",new e.SFBool),new t(r.initializeOnly,"bboxSize",new e.SFVec3f(-1,-1,-1)),new t(r.initializeOnly,"bboxCenter",new e.SFVec3f),new t(r.inputOnly,"addChildren",new e.MFNode),new t(r.inputOnly,"removeChildren",new e.MFNode),new t(r.inputOutput,"children",new e.MFNode)]),getTypeName:function(){return"PickableGroup"},getComponentName:function(){return"Picking"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),o.prototype.initialize.call(this),this._pickable.addInterest("set_pickable__",this),this.set_pickable__()},set_pickableObjects__:function(){this.set_pickable__()},set_pickable__:function(){this.setPickableObject(Boolean(this._pickable.getValue()||this.getTransformSensors().size))},traverse:function(){const e=new Set;return function(t,i){if(t===c.PICKING){if(this._pickable.getValue()){if(this.getObjectType().has("NONE"))return;const o=i.getBrowser(),r=o.getPickable();if(this.getObjectType().has("ALL"))r.push(!0),n.prototype.traverse.call(this,t,i),r.pop();else{const c=o.getPickSensors();for(const t of c.at(-1)){if(!t.getObjectType().has("ALL")){let e=0;for(const i of this.getObjectType())if(t.getObjectType().has(i)){++e;break}switch(t.getMatchCriterion()){case s.MATCH_ANY:if(0===e)continue;break;case s.MATCH_EVERY:if(e!==pickSensor.getObjectType().size)continue;break;case s.MATCH_ONLY_ONE:if(1!==e)continue}}e.add(t)}r.push(!0),c.push(e),n.prototype.traverse.call(this,t,i),c.pop(),r.pop(),e.clear()}}}else n.prototype.traverse.call(this,t,i)}}()}),a})),t("x_ite/Browser/Picking/VolumePicker",["standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4",i.getComponentUrl("rigid-body-physics")],(function(e,t,i,n){"use strict";const o=n.Ammo;function s(){this.broadphase=new o.btDbvtBroadphase,this.collisionConfiguration=new o.btDefaultCollisionConfiguration,this.dispatcher=new o.btCollisionDispatcher(this.collisionConfiguration),this.collisionWorld=new o.btCollisionWorld(this.dispatcher,this.broadphase,this.collisionConfiguration),this.compoundShape1=new o.btCompoundShape,this.motionState1=new o.btDefaultMotionState,this.constructionInfo1=new o.btRigidBodyConstructionInfo(0,this.motionState1,this.compoundShape1),this.rigidBody1=new o.btRigidBody(this.constructionInfo1),this.compoundShape2=new o.btCompoundShape,this.motionState2=new o.btDefaultMotionState,this.constructionInfo2=new o.btRigidBodyConstructionInfo(0,this.motionState2,this.compoundShape2),this.rigidBody2=new o.btRigidBody(this.constructionInfo2),this.collisionWorld.addCollisionObject(this.rigidBody1),this.collisionWorld.addCollisionObject(this.rigidBody2)}return s.prototype={constuctor:s,setChildShape1:function(e,t){this.setChildShape(this.compoundShape1,e,t)},setChildShape2:function(e,t){this.setChildShape(this.compoundShape2,e,t)},setChildShape1Components:function(e,t,i){this.setChildShapeComponents(this.compoundShape1,e,t,i)},setChildShape2Components:function(e,t,i){this.setChildShapeComponents(this.compoundShape2,e,t,i)},setChildShape:function(){const i=new e(0,0,0),n=new t(0,0,1,0),s=new e(1,1,1),r=new o.btVector3(0,0,0);return function(e,t,o){try{e.getNumChildShapes()&&e.removeChildShapeByIndex(0),o.getNumChildShapes()&&(t.get(i,n,s),r.setValue(s.x,s.y,s.z),o.setLocalScaling(r),e.addChildShape(this.getTransform(i,n),o))}catch(e){}}}(),setChildShapeComponents:function(e,t,i,n){e.getNumChildShapes()&&e.removeChildShapeByIndex(0),n.getNumChildShapes()&&(n.setLocalScaling(i),e.addChildShape(t,n))},contactTest:function(){this.collisionWorld.performDiscreteCollisionDetection();const e=this.dispatcher.getNumManifolds();for(let t=0;t<e;++t){const e=this.dispatcher.getManifoldByIndexInternal(t),i=e.getNumContacts();for(let t=0;t<i;++t){if(e.getContactPoint(t).getDistance()<=0)return!0}}return!1},getTransform:function(){const e=new o.btTransform,t=new o.btVector3(0,0,0),n=new i;return function(i,o,s){const r=s||e;return n.set(i,o),t.setValue(n[12],n[13],n[14]),r.getBasis().setValue(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),r.setOrigin(t),r}}()},s})),t("x_ite/Components/Picking/PointPickSensor",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Picking/X3DPickSensorNode","x_ite/Base/X3DCast","x_ite/Base/X3DConstants","x_ite/Browser/Picking/IntersectionType","x_ite/Browser/Picking/VolumePicker","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Geometry/Box3",i.getComponentUrl("rigid-body-physics")],(function(e,t,i,n,o,s,r,c,a,h,p,d){"use strict";var g,l,u,m,_,y,k,f,w,S,C,T,N,b=d.Ammo;function O(e){n.call(this,e),this.addType(s.PointPickSensor),this.pickingGeometryNode=null,this.picker=new c,this.compoundShapes=[]}return O.prototype=Object.assign(Object.create(n.prototype),{constructor:O,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new t(s.inputOutput,"metadata",new e.SFNode),new t(s.inputOutput,"enabled",new e.SFBool(!0)),new t(s.inputOutput,"objectType",new e.MFString("ALL")),new t(s.inputOutput,"matchCriterion",new e.SFString("MATCH_ANY")),new t(s.initializeOnly,"intersectionType",new e.SFString("BOUNDS")),new t(s.initializeOnly,"sortOrder",new e.SFString("CLOSEST")),new t(s.outputOnly,"isActive",new e.SFBool),new t(s.outputOnly,"pickedPoint",new e.MFVec3f),new t(s.inputOutput,"pickingGeometry",new e.SFNode),new t(s.inputOutput,"pickTarget",new e.MFNode),new t(s.outputOnly,"pickedGeometry",new e.MFNode)]),getTypeName:function(){return"PointPickSensor"},getComponentName:function(){return"Picking"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this._pickingGeometry.addInterest("set_pickingGeometry__",this),this.set_pickingGeometry__()},set_pickingGeometry__:function(){this.pickingGeometryNode&&this.pickingGeometryNode._rebuild.removeInterest("set_geometry__",this),this.pickingGeometryNode=o(s.PointSet,this._pickingGeometry),this.pickingGeometryNode&&this.pickingGeometryNode._rebuild.addInterest("set_geometry__",this),this.set_geometry__()},set_geometry__:(C=new b.btVector3(1,1,1),T=new b.btVector3,N=new b.btTransform,function(){var e=this.compoundShapes;if(this.pickingGeometryNode){var t=this.pickingGeometryNode.getCoord();if(t){for(var i=0,n=t.getSize();i<n;++i)if(i<e.length){var o=e[i],s=t.get1Point(i,o.point);T.setValue(s.x,s.y,s.z),N.setOrigin(T),o.setLocalScaling(C),o.updateChildTransform(0,N)}else{o=new b.btCompoundShape;var r=new b.btSphereShape(0);s=t.get1Point(i,new a(0,0,0)),o.point=s,T.setValue(s.x,s.y,s.z),N.setOrigin(T),o.addChildShape(N,r),e.push(o)}e.length=n}else e.length=0}else e.length=0}),process:(g=new p,l=new p,u=new a(0,0,0),m=new a(0,0,0),_=new b.btTransform,y=new b.btVector3,k=new a(0,0,0),f=new h(0,0,1,0),w=new a(1,1,1),S=new e.MFVec3f,function(){if(this.pickingGeometryNode){var e=this.getModelMatrices(),t=this.getTargets();switch(this.getIntersectionType()){case r.BOUNDS:for(var i=0,o=e.length;i<o;++i){var s=e[i];g.assign(this.pickingGeometryNode.getBBox()).multRight(s);for(var c=0,a=t.size;c<a;++c){var h=t[c];l.assign(h.geometryNode.getBBox()).multRight(h.modelMatrix),g.intersectsBox(l)&&(u.assign(g.center),m.assign(l.center),h.intersected=!0,h.distance=u.distance(m))}}var p=this.getPickedGeometries(),d=Boolean(p.length);p.remove(0,p.length,null),d!==this._isActive.getValue()&&(this._isActive=d),this._pickedGeometry.equals(p)||(this._pickedGeometry=p);break;case r.GEOMETRY:var C=this.picker,T=this.compoundShapes;for(i=0,o=e.length;i<o;++i){s=e[i],g.assign(this.pickingGeometryNode.getBBox()).multRight(s),s.get(k,f,w),C.getTransform(k,f,_),y.setValue(w.x,w.y,w.z);for(var N=0,b=T.length;N<b;++N){var O=T[N];for(C.setChildShape1Components(_,y,O),c=0,a=t.size;c<a;++c){h=t[c];var x=this.getPickShape(h.geometryNode);l.assign(h.geometryNode.getBBox()).multRight(h.modelMatrix),C.setChildShape2(h.modelMatrix,x.getCompoundShape()),C.contactTest()&&(u.assign(g.center),m.assign(l.center),h.intersected=!0,h.distance=u.distance(m),h.pickedPoint.push(O.point))}}}p=this.getPickedGeometries(),d=Boolean(p.length),p.remove(0,p.length,null),d!==this._isActive.getValue()&&(this._isActive=d),this._pickedGeometry.equals(p)||(this._pickedGeometry=p);var P=this.getPickedTargets();for(S.length=0,c=0,a=P.length;c<a;++c)for(var v=P[c].pickedPoint,B=0,M=v.length;B<M;++B)S.push(v[B]);this._pickedPoint.equals(S)||(this._pickedPoint=S)}}n.prototype.process.call(this)})}),O})),t("x_ite/Components/Picking/PrimitivePickSensor",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Picking/X3DPickSensorNode","x_ite/Base/X3DConstants","x_ite/Browser/Picking/IntersectionType","x_ite/Browser/Picking/VolumePicker","standard/Math/Numbers/Vector3","standard/Math/Geometry/Box3"],(function(e,t,i,n,o,s,r,c,a){"use strict";function h(e){n.call(this,e),this.addType(o.PrimitivePickSensor),this.pickingGeometryNode=null,this.picker=new r}var p,d,g,l;return h.prototype=Object.assign(Object.create(n.prototype),{constructor:h,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new t(o.inputOutput,"metadata",new e.SFNode),new t(o.inputOutput,"enabled",new e.SFBool(!0)),new t(o.inputOutput,"objectType",new e.MFString("ALL")),new t(o.inputOutput,"matchCriterion",new e.SFString("MATCH_ANY")),new t(o.initializeOnly,"intersectionType",new e.SFString("BOUNDS")),new t(o.initializeOnly,"sortOrder",new e.SFString("CLOSEST")),new t(o.outputOnly,"isActive",new e.SFBool),new t(o.inputOutput,"pickingGeometry",new e.SFNode),new t(o.inputOutput,"pickTarget",new e.MFNode),new t(o.outputOnly,"pickedGeometry",new e.MFNode)]),getTypeName:function(){return"PrimitivePickSensor"},getComponentName:function(){return"Picking"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this._pickingGeometry.addInterest("set_pickingGeometry__",this),this.set_pickingGeometry__()},set_pickingGeometry__:function(){this.pickingGeometryNode=null;try{for(var e=this._pickingGeometry.getValue().getInnerNode(),t=e.getType(),i=t.length-1;i>=0;--i)switch(t[i]){case o.Box:case o.Cone:case o.Cylinder:case o.Sphere:this.pickingGeometryNode=e;break;default:continue}}catch(e){}},process:(p=new a,d=new a,g=new c(0,0,0),l=new c(0,0,0),function(){if(this.pickingGeometryNode){var e=this.getModelMatrices(),t=this.getTargets();switch(this.getIntersectionType()){case s.BOUNDS:for(var i=0,o=e.length;i<o;++i){var r=e[i];p.assign(this.pickingGeometryNode.getBBox()).multRight(r);for(var c=0,a=t.size;c<a;++c){var h=t[c];d.assign(h.geometryNode.getBBox()).multRight(h.modelMatrix),p.intersectsBox(d)&&(g.assign(p.center),l.assign(d.center),h.intersected=!0,h.distance=g.distance(l))}}var u=this.getPickedGeometries(),m=Boolean(u.length);u.remove(0,u.length,null),m!==this._isActive.getValue()&&(this._isActive=m),this._pickedGeometry.equals(u)||(this._pickedGeometry=u);break;case s.GEOMETRY:var _=this.picker;for(i=0,o=e.length;i<o;++i){r=e[i];var y=this.getPickShape(this.pickingGeometryNode);for(p.assign(this.pickingGeometryNode.getBBox()).multRight(r),_.setChildShape1(r,y.getCompoundShape()),c=0,a=t.size;c<a;++c){h=t[c];var k=this.getPickShape(h.geometryNode);d.assign(h.geometryNode.getBBox()).multRight(h.modelMatrix),_.setChildShape2(h.modelMatrix,k.getCompoundShape()),_.contactTest()&&(g.assign(p.center),l.assign(d.center),h.intersected=!0,h.distance=g.distance(l))}}u=this.getPickedGeometries(),m=Boolean(u.length),u.remove(0,u.length,null),m!==this._isActive.getValue()&&(this._isActive=m),this._pickedGeometry.equals(u)||(this._pickedGeometry=u)}}n.prototype.process.call(this)})}),h})),t("x_ite/Components/Picking/VolumePickSensor",["x_ite/Fields","x_ite/Base/X3DFieldDefinition","x_ite/Base/FieldDefinitionArray","x_ite/Components/Picking/X3DPickSensorNode","x_ite/Base/X3DCast","x_ite/Base/X3DConstants","x_ite/Browser/Picking/IntersectionType","x_ite/Browser/Picking/VolumePicker","standard/Math/Numbers/Vector3","standard/Math/Geometry/Box3"],(function(e,t,i,n,o,s,r,c,a,h){"use strict";function p(e){n.call(this,e),this.addType(s.VolumePickSensor),this.pickingGeometryNode=null,this.picker=new c}var d,g,l,u;return p.prototype=Object.assign(Object.create(n.prototype),{constructor:p,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new i([new t(s.inputOutput,"metadata",new e.SFNode),new t(s.inputOutput,"enabled",new e.SFBool(!0)),new t(s.inputOutput,"objectType",new e.MFString("ALL")),new t(s.inputOutput,"matchCriterion",new e.SFString("MATCH_ANY")),new t(s.initializeOnly,"intersectionType",new e.SFString("BOUNDS")),new t(s.initializeOnly,"sortOrder",new e.SFString("CLOSEST")),new t(s.outputOnly,"isActive",new e.SFBool),new t(s.inputOutput,"pickingGeometry",new e.SFNode),new t(s.inputOutput,"pickTarget",new e.MFNode),new t(s.outputOnly,"pickedGeometry",new e.MFNode)]),getTypeName:function(){return"VolumePickSensor"},getComponentName:function(){return"Picking"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this._pickingGeometry.addInterest("set_pickingGeometry__",this),this.set_pickingGeometry__()},set_pickingGeometry__:function(){this.pickingGeometryNode=o(s.X3DGeometryNode,this._pickingGeometry)},process:(d=new h,g=new h,l=new a(0,0,0),u=new a(0,0,0),function(){if(this.pickingGeometryNode){var e=this.getModelMatrices(),t=this.getTargets();switch(this.getIntersectionType()){case r.BOUNDS:for(var i=0,o=e.length;i<o;++i){var s=e[i];d.assign(this.pickingGeometryNode.getBBox()).multRight(s);for(var c=0,a=t.size;c<a;++c){var h=t[c];g.assign(h.geometryNode.getBBox()).multRight(h.modelMatrix),d.intersectsBox(g)&&(l.assign(d.center),u.assign(g.center),h.intersected=!0,h.distance=l.distance(u))}}var p=this.getPickedGeometries(),m=Boolean(p.length);p.remove(0,p.length,null),m!==this._isActive.getValue()&&(this._isActive=m),this._pickedGeometry.equals(p)||(this._pickedGeometry=p);break;case r.GEOMETRY:var _=this.picker;for(i=0,o=e.length;i<o;++i){s=e[i];var y=this.getPickShape(this.pickingGeometryNode);for(d.assign(this.pickingGeometryNode.getBBox()).multRight(s),_.setChildShape1(s,y.getCompoundShape()),c=0,a=t.size;c<a;++c){h=t[c];var k=this.getPickShape(h.geometryNode);g.assign(h.geometryNode.getBBox()).multRight(h.modelMatrix),_.setChildShape2(h.modelMatrix,k.getCompoundShape()),_.contactTest()&&(l.assign(d.center),u.assign(g.center),h.intersected=!0,h.distance=l.distance(u))}}p=this.getPickedGeometries(),m=Boolean(p.length),p.remove(0,p.length,null),m!==this._isActive.getValue()&&(this._isActive=m),this._pickedGeometry.equals(p)||(this._pickedGeometry=p)}}n.prototype.process.call(this)})}),p})),t(i.getComponentUrl("picking"),["x_ite/Components","x_ite/Components/Picking/LinePickSensor","x_ite/Components/Picking/PickableGroup","x_ite/Components/Picking/PointPickSensor","x_ite/Components/Picking/PrimitivePickSensor","x_ite/Components/Picking/VolumePickSensor","x_ite/Components/Picking/X3DPickSensorNode","x_ite/Components/Picking/X3DPickableObject",i.getComponentUrl("rigid-body-physics")],(function(e,t,i,n,o,s,r,c){"use strict";e.addComponent({name:"Picking",types:{LinePickSensor:t,PickableGroup:i,PointPickSensor:n,PrimitivePickSensor:o,VolumePickSensor:s},abstractTypes:{X3DPickSensorNode:r,X3DPickableObject:c}})}))}();
