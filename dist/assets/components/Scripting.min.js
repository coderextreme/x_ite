(()=>{"use strict";var e={355:e=>{e.exports=window[Symbol.for("X_ITE.X3D-7.0.0")].require("lib/jquery")}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components");var t=i.n(e);const n=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DFieldDefinition");var o=i.n(n);const r=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/FieldDefinitionArray");var s=i.n(r);const a=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DField");var u=i.n(a);const c=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DArrayField");var l=i.n(c);const d=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Fields");var f=i.n(d);const p=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Browser/X3DBrowser");var v=i.n(p);const h=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/ComponentInfo");var _=i.n(h);const S=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/ComponentInfoArray");var F=i.n(S);const w=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/ProfileInfo");var g=i.n(w);const y=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/ProfileInfoArray");var m=i.n(y);const x=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/UnitInfo");var D=i.n(x);const X=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/UnitInfoArray");var E=i.n(X);const T=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Execution/X3DExecutionContext");var M=i.n(T);const I=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Execution/X3DScene");var b=i.n(I);const C=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Prototype/ExternProtoDeclarationArray");var O=i.n(C);const A=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Prototype/ProtoDeclarationArray");var q=i.n(A);const V=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Prototype/X3DExternProtoDeclaration");var P=i.n(V);const B=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Prototype/X3DProtoDeclaration");var N=i.n(B);const R=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Routing/RouteArray");var L=i.n(R);const U=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Routing/X3DRoute");var z=i.n(U);const k=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Core/X3DChildNode");var j=i.n(k);const G=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Networking/X3DUrlObject");var $=i.n(G);const H=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DConstants");var J=i.n(H);function W(e){j().call(this,e),$().call(this,e),this.addType(J().X3DScriptNode)}W.prototype=Object.assign(Object.create(j().prototype),$().prototype,{constructor:W});const K=W,Q=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/InputOutput/FileLoader");var Y=i.n(Q),Z=i(355);function ee(e){K.call(this,e),this.addType(J().Script),this.pauseTime=0}ee.prototype=Object.assign(Object.create(K.prototype),{constructor:ee,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(s())([new(o())(J().inputOutput,"metadata",new(f().SFNode)),new(o())(J().inputOutput,"load",new(f().SFBool)(!0)),new(o())(J().inputOutput,"url",new(f().MFString)),new(o())(J().inputOutput,"autoRefresh",new(f().SFTime)),new(o())(J().inputOutput,"autoRefreshTimeLimit",new(f().SFTime)(3600)),new(o())(J().initializeOnly,"directOutput",new(f().SFBool)),new(o())(J().initializeOnly,"mustEvaluate",new(f().SFBool))]),getTypeName:function(){return"Script"},getComponentName:function(){return"Scripting"},getContainerField:function(){return"children"},initialize:function(){K.prototype.initialize.call(this);for(const e of this.getUserDefinedFields())e.setModificationTime(0);this.requestImmediateLoad()},getExtendedEventHandling:function(){return!1},canUserDefinedFields:function(){return!0},addUserDefinedField:function(e,t,i){K.prototype.addUserDefinedField.call(this,e,t,i),this.isInitialized()&&(this.setLoadState(J().NOT_STARTED_STATE),this.requestImmediateLoad())},removeUserDefinedField:function(e){K.prototype.removeUserDefinedField.call(this,e),this.isInitialized()&&(this.setLoadState(J().NOT_STARTED_STATE),this.requestImmediateLoad())},getSourceText:function(){return this._url},unLoadNow:function(){this.initialize__("")},loadNow:function(){this.initialized=!1,new(Y())(this).loadScript(this._url,function(e){null===e?this.setLoadState(J().FAILED_STATE):(this.setLoadState(J().COMPLETE_STATE),this.initialize__(e))}.bind(this))},getContext:function(e){try{const t=["initialize","prepareEvents","eventsProcessed","shutdown"];for(const e of this.getUserDefinedFields())switch(e.getAccessType()){case J().inputOnly:t.push(e.getName());break;case J().inputOutput:t.push("set_"+e.getName())}e+="\nreturn ["+t.map((function(e){return`typeof ${e} !== "undefined" ? ${e} : undefined`})).join(",")+"];",this.global=this.getGlobal();const i=this.evaluate(e),n={};for(let e=0;e<t.length;++e)n[t[e]]=i[e];return n}catch(e){return this.setError("while evaluating script source",e),{}}},evaluate:function(e){return t=this.global,Function(`with (arguments [0])\n   {\n      delete arguments [0];\n      arguments .length = 0;\n      ${e}\n   }`)(t);var t},getGlobal:function(){const e=this.getBrowser(),t=this.getExecutionContext(),i=this.isLive();function n(n){const o=e.createX3DFromString(String(n)),r=o.getRootNodes();if(i.addFieldInterest(o.isLive()),o.setLive(i.getValue()),o.setPrivate(t.isPrivate()),o.setExecutionContext(t),r.length&&r[0])return r[0];throw new Error("SFNode.new: invalid argument, must be 'string' is 'undefined'.")}n.prototype=f().SFNode.prototype;const r={NULL:{value:null},FALSE:{value:!1},TRUE:{value:!0},print:{value:e.println.bind(e)},trace:{value:e.println.bind(e)},Browser:{value:e},X3DConstants:{value:J()},X3DBrowser:{value:v()},X3DExecutionContext:{value:M()},X3DScene:{value:b()},ComponentInfo:{value:_()},ComponentInfoArray:{value:F()},ProfileInfo:{value:g()},ProfileInfoArray:{value:m()},UnitInfo:{value:D()},UnitInfoArray:{value:E()},ExternProtoDeclarationArray:{value:O()},ProtoDeclarationArray:{value:q()},X3DExternProtoDeclaration:{value:P()},X3DProtoDeclaration:{value:N()},RouteArray:{value:L()},X3DRoute:{value:z()},X3DFieldDefinition:{value:o()},FieldDefinitionArray:{value:s()},X3DField:{value:u()},X3DArrayField:{value:l()},SFColor:{value:f().SFColor},SFColorRGBA:{value:f().SFColorRGBA},SFImage:{value:f().SFImage},SFMatrix3d:{value:f().SFMatrix3d},SFMatrix3f:{value:f().SFMatrix3f},SFMatrix4d:{value:f().SFMatrix4d},SFMatrix4f:{value:f().SFMatrix4f},SFNode:{value:n},SFRotation:{value:f().SFRotation},SFVec2d:{value:f().SFVec2d},SFVec2f:{value:f().SFVec2f},SFVec3d:{value:f().SFVec3d},SFVec3f:{value:f().SFVec3f},SFVec4d:{value:f().SFVec4d},SFVec4f:{value:f().SFVec4f},VrmlMatrix:{value:f().VrmlMatrix},MFBool:{value:f().MFBool},MFColor:{value:f().MFColor},MFColorRGBA:{value:f().MFColorRGBA},MFDouble:{value:f().MFDouble},MFFloat:{value:f().MFFloat},MFImage:{value:f().MFImage},MFInt32:{value:f().MFInt32},MFMatrix3d:{value:f().MFMatrix3d},MFMatrix3f:{value:f().MFMatrix3f},MFMatrix4d:{value:f().MFMatrix4d},MFMatrix4f:{value:f().MFMatrix4f},MFNode:{value:f().MFNode},MFRotation:{value:f().MFRotation},MFString:{value:f().MFString},MFTime:{value:f().MFTime},MFVec2d:{value:f().MFVec2d},MFVec2f:{value:f().MFVec2f},MFVec3d:{value:f().MFVec3d},MFVec3f:{value:f().MFVec3f},MFVec4d:{value:f().MFVec4d},MFVec4f:{value:f().MFVec4f}};for(const e of this.getUserDefinedFields()){const t=e.getName();e.getAccessType()!==J().inputOnly&&(t in r||(r[t]={get:e.valueOf.bind(e),set:e.setValue.bind(e)}),e.getAccessType()===J().inputOutput&&(r[t+"_changed"]={get:e.valueOf.bind(e),set:e.setValue.bind(e)}))}return Object.create(Object.prototype,r)},processOutstandingEvents:function(){for(const e of this.getUserDefinedFields())if(!(e.getModificationTime()<=this.pauseTime))switch(e.getAccessType()){case J().inputOnly:{const t=this.context[e.getName()];"function"==typeof t&&this.set_field__(t,e);break}case J().inputOutput:{const t=this.context["set_"+e.getName()];"function"==typeof t&&this.set_field__(t,e);break}}},initialize__:function(e){this.context=this.getContext(e),this.set_live__()},set_live__:function(){if(K.prototype.set_live__.call(this),this.context)if(this.isLive().getValue()){if(!this.initialized){if(this.initialized=!0,"function"==typeof this.context.initialize){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.initialize()}catch(e){this.setError("in function 'initialize'",e)}e.getScriptStack().pop()}"function"==typeof this.context.shutdown&&Z(window).on("unload",this.shutdown__.bind(this))}"function"==typeof this.context.prepareEvents&&this.getBrowser().prepareEvents().addInterest("prepareEvents__",this),"function"==typeof this.context.eventsProcessed&&this.addInterest("eventsProcessed__",this);for(const e of this.getUserDefinedFields())switch(e.getAccessType()){case J().inputOnly:{const t=this.context[e.getName()];"function"==typeof t&&e.addInterest("set_field__",this,t);break}case J().inputOutput:{const t=this.context["set_"+e.getName()];"function"==typeof t&&e.addInterest("set_field__",this,t);break}}this.processOutstandingEvents()}else{this.context.prepareEvents&&this.getBrowser().prepareEvents().removeInterest("prepareEvents__",this),this.context.eventsProcessed&&this.removeInterest("eventsProcessed__",this);for(const e of this.getUserDefinedFields())switch(e.getAccessType()){case J().inputOnly:case J().inputOutput:e.removeInterest("set_field__",this)}this.initialized&&(this.pauseTime=performance.now())}},prepareEvents__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.prepareEvents(e.getCurrentTime()),e.addBrowserEvent()}catch(e){this.setError("in function 'prepareEvents'",e)}e.getScriptStack().pop()},set_field__:function(e,t){const i=this.getBrowser();t.setTainted(!0),i.getScriptStack().push(this);try{e(t.valueOf(),i.getCurrentTime())}catch(e){this.setError("in function '"+t.getName()+"'",e)}i.getScriptStack().pop(),t.setTainted(!1)},eventsProcessed__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.eventsProcessed()}catch(e){this.setError("in function 'eventsProcessed'",e)}e.getScriptStack().pop()},shutdown__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.shutdown()}catch(e){this.setError("in function 'shutdown'",e)}e.getScriptStack().pop()},setError:function(e,t){console.error("JavaScript Error in Script '"+this.getName()+"', "+e+"\nworld url is '"+this.getExecutionContext().getWorldURL()+"':"),console.error(t)}});const te=ee;t().addComponent({name:"Scripting",types:{Script:te},abstractTypes:{X3DScriptNode:K}})})()})();