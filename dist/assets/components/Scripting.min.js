(()=>{"use strict";var e={355:e=>{e.exports=window[Symbol.for("X_ITE.X3D-7.0.0")].require("lib/jquery")}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components");var t=i.n(e);const n=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Browser/Scripting/X3DScriptingContext");var o=i.n(n);const r=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DFieldDefinition");var s=i.n(r);const a=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/FieldDefinitionArray");var u=i.n(a);const c=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DField");var l=i.n(c);const d=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DArrayField");var f=i.n(d);const p=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Fields");var v=i.n(p);const h=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Browser/X3DBrowser");var _=i.n(h);const S=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/ComponentInfo");var F=i.n(S);const w=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/ComponentInfoArray");var g=i.n(w);const y=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/ProfileInfo");var m=i.n(y);const x=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/ProfileInfoArray");var D=i.n(x);const X=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/UnitInfo");var E=i.n(X);const T=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Configuration/UnitInfoArray");var M=i.n(T);const b=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Execution/X3DExecutionContext");var I=i.n(b);const C=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Execution/X3DScene");var O=i.n(C);const A=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Prototype/ExternProtoDeclarationArray");var q=i.n(A);const V=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Prototype/ProtoDeclarationArray");var B=i.n(V);const P=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Prototype/X3DExternProtoDeclaration");var N=i.n(P);const R=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Prototype/X3DProtoDeclaration");var L=i.n(R);const U=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Routing/RouteArray");var z=i.n(U);const k=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Routing/X3DRoute");var j=i.n(k);const G=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Core/X3DChildNode");var $=i.n(G);const H=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Networking/X3DUrlObject");var J=i.n(H);const W=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DConstants");var K=i.n(W);function Q(e){$().call(this,e),J().call(this,e),this.addType(K().X3DScriptNode)}Q.prototype=Object.assign(Object.create($().prototype),J().prototype,{constructor:Q});const Y=Q,Z=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/InputOutput/FileLoader");var ee=i.n(Z),te=i(355);function ie(e){Y.call(this,e),this.addType(K().Script),this.pauseTime=0}ie.prototype=Object.assign(Object.create(Y.prototype),{constructor:ie,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(u())([new(s())(K().inputOutput,"metadata",new(v().SFNode)),new(s())(K().inputOutput,"load",new(v().SFBool)(!0)),new(s())(K().inputOutput,"url",new(v().MFString)),new(s())(K().inputOutput,"autoRefresh",new(v().SFTime)),new(s())(K().inputOutput,"autoRefreshTimeLimit",new(v().SFTime)(3600)),new(s())(K().initializeOnly,"directOutput",new(v().SFBool)),new(s())(K().initializeOnly,"mustEvaluate",new(v().SFBool))]),getTypeName:function(){return"Script"},getComponentName:function(){return"Scripting"},getContainerField:function(){return"children"},initialize:function(){Y.prototype.initialize.call(this);for(const e of this.getUserDefinedFields())e.setModificationTime(0);this.requestImmediateLoad()},getExtendedEventHandling:function(){return!1},canUserDefinedFields:function(){return!0},addUserDefinedField:function(e,t,i){Y.prototype.addUserDefinedField.call(this,e,t,i),this.isInitialized()&&(this.setLoadState(K().NOT_STARTED_STATE),this.requestImmediateLoad())},removeUserDefinedField:function(e){Y.prototype.removeUserDefinedField.call(this,e),this.isInitialized()&&(this.setLoadState(K().NOT_STARTED_STATE),this.requestImmediateLoad())},getSourceText:function(){return this._url},unLoadNow:function(){this.initialize__("")},loadNow:function(){this.initialized=!1,new(ee())(this).loadScript(this._url,function(e){null===e?this.setLoadState(K().FAILED_STATE):(this.setLoadState(K().COMPLETE_STATE),this.initialize__(e))}.bind(this))},getContext:function(e){try{const t=["initialize","prepareEvents","eventsProcessed","shutdown"];for(const e of this.getUserDefinedFields())switch(e.getAccessType()){case K().inputOnly:t.push(e.getName());break;case K().inputOutput:t.push("set_"+e.getName())}e+="\nreturn ["+t.map((function(e){return`typeof ${e} !== "undefined" ? ${e} : undefined`})).join(",")+"];",this.global=this.getGlobal();const i=this.evaluate(e),n={};for(let e=0;e<t.length;++e)n[t[e]]=i[e];return n}catch(e){return this.setError("while evaluating script source",e),{}}},evaluate:function(e){return t=this.global,Function(`with (arguments [0])\n   {\n      delete arguments [0];\n      arguments .length = 0;\n      ${e}\n   }`)(t);var t},getGlobal:function(){const e=this.getBrowser(),t=this.getExecutionContext(),i=this.isLive();function n(n){const o=e.createX3DFromString(String(n)),r=o.getRootNodes();if(i.addFieldInterest(o.isLive()),o.setLive(i.getValue()),o.setPrivate(t.isPrivate()),o.setExecutionContext(t),r.length&&r[0])return r[0];throw new Error("SFNode.new: invalid argument, must be 'string' is 'undefined'.")}n.prototype=v().SFNode.prototype;const o={NULL:{value:null},FALSE:{value:!1},TRUE:{value:!0},print:{value:e.println.bind(e)},trace:{value:e.println.bind(e)},Browser:{value:e},X3DConstants:{value:K()},X3DBrowser:{value:_()},X3DExecutionContext:{value:I()},X3DScene:{value:O()},ComponentInfo:{value:F()},ComponentInfoArray:{value:g()},ProfileInfo:{value:m()},ProfileInfoArray:{value:D()},UnitInfo:{value:E()},UnitInfoArray:{value:M()},ExternProtoDeclarationArray:{value:q()},ProtoDeclarationArray:{value:B()},X3DExternProtoDeclaration:{value:N()},X3DProtoDeclaration:{value:L()},RouteArray:{value:z()},X3DRoute:{value:j()},X3DFieldDefinition:{value:s()},FieldDefinitionArray:{value:u()},X3DField:{value:l()},X3DArrayField:{value:f()},SFColor:{value:v().SFColor},SFColorRGBA:{value:v().SFColorRGBA},SFImage:{value:v().SFImage},SFMatrix3d:{value:v().SFMatrix3d},SFMatrix3f:{value:v().SFMatrix3f},SFMatrix4d:{value:v().SFMatrix4d},SFMatrix4f:{value:v().SFMatrix4f},SFNode:{value:n},SFRotation:{value:v().SFRotation},SFVec2d:{value:v().SFVec2d},SFVec2f:{value:v().SFVec2f},SFVec3d:{value:v().SFVec3d},SFVec3f:{value:v().SFVec3f},SFVec4d:{value:v().SFVec4d},SFVec4f:{value:v().SFVec4f},VrmlMatrix:{value:v().VrmlMatrix},MFBool:{value:v().MFBool},MFColor:{value:v().MFColor},MFColorRGBA:{value:v().MFColorRGBA},MFDouble:{value:v().MFDouble},MFFloat:{value:v().MFFloat},MFImage:{value:v().MFImage},MFInt32:{value:v().MFInt32},MFMatrix3d:{value:v().MFMatrix3d},MFMatrix3f:{value:v().MFMatrix3f},MFMatrix4d:{value:v().MFMatrix4d},MFMatrix4f:{value:v().MFMatrix4f},MFNode:{value:v().MFNode},MFRotation:{value:v().MFRotation},MFString:{value:v().MFString},MFTime:{value:v().MFTime},MFVec2d:{value:v().MFVec2d},MFVec2f:{value:v().MFVec2f},MFVec3d:{value:v().MFVec3d},MFVec3f:{value:v().MFVec3f},MFVec4d:{value:v().MFVec4d},MFVec4f:{value:v().MFVec4f}};for(const e of this.getUserDefinedFields()){const t=e.getName();e.getAccessType()!==K().inputOnly&&(t in o||(o[t]={get:e.valueOf.bind(e),set:e.setValue.bind(e)}),e.getAccessType()===K().inputOutput&&(o[t+"_changed"]={get:e.valueOf.bind(e),set:e.setValue.bind(e)}))}return Object.create(Object.prototype,o)},processOutstandingEvents:function(){for(const e of this.getUserDefinedFields())if(!(e.getModificationTime()<=this.pauseTime))switch(e.getAccessType()){case K().inputOnly:{const t=this.context[e.getName()];"function"==typeof t&&this.set_field__(t,e);break}case K().inputOutput:{const t=this.context["set_"+e.getName()];"function"==typeof t&&this.set_field__(t,e);break}}},initialize__:function(e){this.context=this.getContext(e),this.set_live__()},set_live__:function(){if(Y.prototype.set_live__.call(this),this.context)if(this.isLive().getValue()){if(!this.initialized){if(this.initialized=!0,"function"==typeof this.context.initialize){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.initialize()}catch(e){this.setError("in function 'initialize'",e)}e.getScriptStack().pop()}"function"==typeof this.context.shutdown&&te(window).on("unload",this.shutdown__.bind(this))}"function"==typeof this.context.prepareEvents&&this.getBrowser().prepareEvents().addInterest("prepareEvents__",this),"function"==typeof this.context.eventsProcessed&&this.addInterest("eventsProcessed__",this);for(const e of this.getUserDefinedFields())switch(e.getAccessType()){case K().inputOnly:{const t=this.context[e.getName()];"function"==typeof t&&e.addInterest("set_field__",this,t);break}case K().inputOutput:{const t=this.context["set_"+e.getName()];"function"==typeof t&&e.addInterest("set_field__",this,t);break}}this.processOutstandingEvents()}else{this.context.prepareEvents&&this.getBrowser().prepareEvents().removeInterest("prepareEvents__",this),this.context.eventsProcessed&&this.removeInterest("eventsProcessed__",this);for(const e of this.getUserDefinedFields())switch(e.getAccessType()){case K().inputOnly:case K().inputOutput:e.removeInterest("set_field__",this)}this.initialized&&(this.pauseTime=performance.now())}},prepareEvents__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.prepareEvents(e.getCurrentTime()),e.addBrowserEvent()}catch(e){this.setError("in function 'prepareEvents'",e)}e.getScriptStack().pop()},set_field__:function(e,t){const i=this.getBrowser();t.setTainted(!0),i.getScriptStack().push(this);try{e(t.valueOf(),i.getCurrentTime())}catch(e){this.setError("in function '"+t.getName()+"'",e)}i.getScriptStack().pop(),t.setTainted(!1)},eventsProcessed__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.eventsProcessed()}catch(e){this.setError("in function 'eventsProcessed'",e)}e.getScriptStack().pop()},shutdown__:function(){const e=this.getBrowser();e.getScriptStack().push(this);try{this.context.shutdown()}catch(e){this.setError("in function 'shutdown'",e)}e.getScriptStack().pop()},setError:function(e,t){console.error("JavaScript Error in Script '"+this.getName()+"', "+e+"\nworld url is '"+this.getExecutionContext().getWorldURL()+"':"),console.error(t)}});const ne=ie;t().addComponent({name:"Scripting",types:{Script:ne},abstractTypes:{X3DScriptNode:Y},browserContext:o()})})()})();