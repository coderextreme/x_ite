(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components");var n=e.n(t);const i=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Texturing/PixelTexture");var o=e.n(i);const r=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Texturing/TextureProperties");var s=e.n(r);const a=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Fields");var l=e.n(a);const u=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DFieldDefinition");var d=e.n(u);const c=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/FieldDefinitionArray");var h=e.n(c);const f=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Core/X3DNode");var p=e.n(f);const g=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DConstants");var m=e.n(g);function _(e){p().call(this,e),this.addType(m().X3DVolumeRenderStyleNode),this.volumeDataNodes=new Set}_.prototype=Object.assign(Object.create(p().prototype),{constructor:_,addShaderFields:function(e){},getUniformsText:function(){return""},getFunctionsText:function(){return""},getVolumeData:function(){return this.volumeDataNodes},addVolumeData:function(e){this.volumeDataNodes.add(e)},removeVolumeData:function(e){this.volumeDataNodes.delete(e)},getNormalText:function(e){let t="";return e?(t+="uniform sampler3D surfaceNormals_"+this.getId()+";\n",t+="\n",t+="vec4\n",t+="getNormal_"+this.getId()+" (in vec3 texCoord)\n",t+="{\n",t+="   vec3 n = texture (surfaceNormals_"+this.getId()+", texCoord) .xyz * 2.0 - 1.0;\n",t+="\n",t+="   return vec4 (normalize (x3d_TextureNormalMatrix * n), length (n));\n",t+="}\n"):(t+="\n",t+="vec4\n",t+="getNormal_"+this.getId()+" (in vec3 texCoord)\n",t+="{\n",t+="   vec4  offset = vec4 (1.0 / vec3 (textureSize (x3d_Texture3D [0], 0)), 0.0);\n",t+="   float i0     = texture (x3d_Texture3D [0], texCoord + offset .xww) .r;\n",t+="   float i1     = texture (x3d_Texture3D [0], texCoord - offset .xww) .r;\n",t+="   float i2     = texture (x3d_Texture3D [0], texCoord + offset .wyw) .r;\n",t+="   float i3     = texture (x3d_Texture3D [0], texCoord - offset .wyw) .r;\n",t+="   float i4     = texture (x3d_Texture3D [0], texCoord + offset .wwz) .r;\n",t+="   float i5     = texture (x3d_Texture3D [0], texCoord - offset .wwz) .r;\n",t+="   vec3  n      = vec3 (i1 - i0, i3 - i2, i5 - i4);\n",t+="\n",t+="   return vec4 (normalize (x3d_TextureNormalMatrix * n), length (n));\n",t+="}\n"),t}});const y=_;function w(e){y.call(this,e),this.addType(m().X3DComposableVolumeRenderStyleNode)}w.prototype=Object.assign(Object.create(y.prototype),{constructor:w});const x=w,S=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Base/X3DCast");var b=e.n(S);function N(e){x.call(this,e),this.addType(m().OpacityMapVolumeStyle)}N.prototype=Object.assign(Object.create(x.prototype),{constructor:N,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"transferFunction",new(l().SFNode))]),getTypeName:function(){return"OpacityMapVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){x.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._transferFunction.addInterest("set_transferFunction__",this),this.set_transferFunction__())},set_transferFunction__:function(){this.transferFunctionNode=b()(m().X3DTexture2DNode,this._transferFunction),this.transferFunctionNode||(this.transferFunctionNode=b()(m().X3DTexture3DNode,this._transferFunction)),this.transferFunctionNode||(this.transferFunctionNode=this.getBrowser().getDefaultTransferFunction())},addShaderFields:function(e){this._enabled.getValue()&&e.addUserDefinedField(m().inputOutput,"transferFunction_"+this.getId(),new(l().SFNode)(this.transferFunctionNode))},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="// OpacityMapVolumeStyle\n",e+="\n",this.transferFunctionNode.getType().includes(m().X3DTexture2DNode)?(e+="uniform sampler2D transferFunction_"+this.getId()+";\n",e+="\n",e+="vec4\n",e+="getOpacityMapStyle_"+this.getId()+" (in vec4 originalColor)\n",e+="{\n",e+="   return texture (transferFunction_"+this.getId()+", originalColor .rg);\n",e+="}\n"):(e+="uniform sampler3D transferFunction_"+this.getId()+";\n",e+="\n",e+="vec4\n",e+="getOpacityMapStyle_"+this.getId()+" (in vec4 originalColor)\n",e+="{\n",e+="   return texture (transferFunction_"+this.getId()+", originalColor .rgb);\n",e+="}\n"),e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // OpacityMapVolumeStyle\n",e+="\n",e+="   textureColor = getOpacityMapStyle_"+this.getId()+" (textureColor);\n",e}});const v=N,C=Symbol(),T=Symbol(),D=Symbol(),F=Symbol();function I(){}I.prototype={getDefaultVoxels:function(e){return this[C]=e.createNode("PixelTexture3D",!1),this[C]._image=[1,1,1,1,255],this[C].repeatS=!0,this[C].repeatT=!0,this[C].repeatR=!0,this[C].setPrivate(!0),this[C].setup(),this.getDefaultVoxels=function(){return this[C]},Object.defineProperty(this,"getDefaultVoxels",{enumerable:!1}),this[C]},getDefaultVolumeStyle:function(){return this[T]=new v(this.getPrivateScene()),this[T].setPrivate(!0),this[T].setup(),this.getDefaultVolumeStyle=function(){return this[T]},Object.defineProperty(this,"getDefaultVolumeStyle",{enumerable:!1}),this[T]},getDefaultBlendedVolumeStyle:function(){return this[D]=new v(this.getPrivateScene()),this[D].setPrivate(!0),this[D].setup(),this.getDefaultBlendedVolumeStyle=function(){return this[D]},Object.defineProperty(this,"getDefaultBlendedVolumeStyle",{enumerable:!1}),this[D]},getDefaultTransferFunction:function(){const e=new(s())(this.getPrivateScene());return e._generateMipMaps=!0,e._boundaryModeS="CLAMP_TO_EDGE",e._boundaryModeT="REPEAT",e.setPrivate(!0),e.setup(),this[F]=new(o())(this.getPrivateScene()),this[F]._textureProperties=e,this[F]._image.width=256,this[F]._image.height=1,this[F]._image.comp=2,this[F]._image.array=Array.from({length:256},((e,t)=>t<<8|t)),this[F].setPrivate(!0),this[F].setup(),this.getDefaultTransferFunction=function(){return this[F]},Object.defineProperty(this,"getDefaultTransferFunction",{enumerable:!1}),this[F]}};const O=I;window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/DEBUG");function V(e){x.call(this,e),this.addType(m().BlendedVolumeStyle)}V.prototype=Object.assign(Object.create(x.prototype),{constructor:V,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"weightConstant1",new(l().SFFloat)(.5)),new(d())(m().inputOutput,"weightConstant2",new(l().SFFloat)(.5)),new(d())(m().inputOutput,"weightFunction1",new(l().SFString)("CONSTANT")),new(d())(m().inputOutput,"weightFunction2",new(l().SFString)("CONSTANT")),new(d())(m().inputOutput,"weightTransferFunction1",new(l().SFNode)),new(d())(m().inputOutput,"weightTransferFunction2",new(l().SFNode)),new(d())(m().inputOutput,"renderStyle",new(l().SFNode)),new(d())(m().inputOutput,"voxels",new(l().SFNode))]),getTypeName:function(){return"BlendedVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){x.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._weightTransferFunction1.addInterest("set_weightTransferFunction1__",this),this._weightTransferFunction2.addInterest("set_weightTransferFunction2__",this),this._renderStyle.addInterest("set_renderStyle__",this),this._voxels.addInterest("set_voxels__",this),this.set_weightTransferFunction1__(),this.set_weightTransferFunction2__(),this.set_renderStyle__(),this.set_voxels__())},addVolumeData:function(e){x.prototype.addVolumeData.call(this,e),this.renderStyleNode&&this.renderStyleNode.addVolumeData(e)},removeVolumeData:function(e){x.prototype.removeVolumeData.call(this,e),this.renderStyleNode&&this.renderStyleNode.removeVolumeData(e)},set_weightTransferFunction1__:function(){this.weightTransferFunction1Node=b()(m().X3DTexture2DNode,this._weightTransferFunction1)},set_weightTransferFunction2__:function(){this.weightTransferFunction2Node=b()(m().X3DTexture2DNode,this._weightTransferFunction2)},set_renderStyle__:function(){if(this.renderStyleNode){this.renderStyleNode.removeInterest("addNodeEvent",this);for(const e of this.getVolumeData())this.renderStyleNode.removeVolumeData(e)}if(this.renderStyleNode=b()(m().X3DComposableVolumeRenderStyleNode,this._renderStyle),this.renderStyleNode){this.renderStyleNode.addInterest("addNodeEvent",this);for(const e of this.getVolumeData())this.renderStyleNode.addVolumeData(e)}},set_voxels__:function(){this.voxelsNode=b()(m().X3DTexture3DNode,this._voxels)},addShaderFields:function(e){this._enabled.getValue()&&(e.addUserDefinedField(m().inputOutput,"weightConstant1_"+this.getId(),this._weightConstant1.copy()),e.addUserDefinedField(m().inputOutput,"weightConstant2_"+this.getId(),this._weightConstant2.copy()),this.weightTransferFunction1Node&&e.addUserDefinedField(m().inputOutput,"weightTransferFunction1_"+this.getId(),new(l().SFNode)(this.weightTransferFunction1Node)),this.weightTransferFunction2Node&&e.addUserDefinedField(m().inputOutput,"weightTransferFunction2_"+this.getId(),new(l().SFNode)(this.weightTransferFunction2Node)),this.voxelsNode&&e.addUserDefinedField(m().inputOutput,"voxels_"+this.getId(),new(l().SFNode)(this.voxelsNode)),this.getBrowser().getDefaultBlendedVolumeStyle().addShaderFields(e),this.renderStyleNode&&this.renderStyleNode.addShaderFields(e))},getUniformsText:function(){if(!this._enabled.getValue())return"";if(!this.voxelsNode)return"";let e="";e+="\n",e+="// BlendedVolumeStyle\n",e+="\n",e+="uniform float     weightConstant1_"+this.getId()+";\n",e+="uniform float     weightConstant2_"+this.getId()+";\n",this.weightTransferFunction1Node&&(e+="uniform sampler2D weightTransferFunction1_"+this.getId()+";\n"),this.weightTransferFunction2Node&&(e+="uniform sampler2D weightTransferFunction2_"+this.getId()+";\n"),e+="uniform sampler3D voxels_"+this.getId()+";\n";let t=this.getBrowser().getDefaultBlendedVolumeStyle().getUniformsText();this.renderStyleNode&&(t+=this.renderStyleNode.getUniformsText()),t=t.replace(/x3d_Texture3D\s*\[0\]/g,"voxels_"+this.getId()),e+="\n",e+=t,e+="\n",e+="vec4\n",e+="getBlendedStyle_"+this.getId()+" (in vec4 originalColor, in vec3 texCoord)\n",e+="{\n",e+="   vec4 blendColor_"+this.getId()+" = texture (voxels_"+this.getId()+", texCoord);";let n=this.getBrowser().getDefaultBlendedVolumeStyle().getFunctionsText();switch(this.renderStyleNode&&(n+=this.renderStyleNode.getFunctionsText()),n=n.replace(/textureColor/g,"blendColor_"+this.getId()),e+="\n",e+=n,this._weightFunction1.getValue()){default:e+="   float w1_"+this.getId()+" = weightConstant1_"+this.getId()+";\n";break;case"ALPHA0":e+="   float w1_"+this.getId()+" = originalColor .a;\n";break;case"ALPHA1":e+="   float w1_"+this.getId()+" = blendColor_ "+this.getId()+" .a;\n";break;case"ONE_MINUS_ALPHA0":e+="   float w1_"+this.getId()+" = 1.0 - originalColor .a;\n";break;case"ONE_MINUS_ALPHA1":e+="   float w1_"+this.getId()+" = 1.0 - blendColor_ "+this.getId()+" .a;\n";break;case"TABLE":this.weightTransferFunction1Node?e+="   float w1_"+this.getId()+" = texture (weightTransferFunction1_"+this.getId()+", vec2 (originalColor .a, blendColor_"+this.getId()+" .a)) .r;\n":e+="   float w1_"+this.getId()+" = weightConstant1_"+this.getId()+";\n"}switch(this._weightFunction2.getValue()){default:e+="   float w2_"+this.getId()+" = weightConstant2_"+this.getId()+";\n";break;case"ALPHA0":e+="   float w2_"+this.getId()+" = originalColor .a;\n";break;case"ALPHA1":e+="   float w2_"+this.getId()+" = blendColor_ "+this.getId()+" .a;\n";break;case"ONE_MINUS_ALPHA0":e+="   float w2_"+this.getId()+" = 1.0 - originalColor .a;\n";break;case"ONE_MINUS_ALPHA1":e+="   float w2_"+this.getId()+" = 1.0 - blendColor_ "+this.getId()+" .a;\n";break;case"TABLE":this.weightTransferFunction2Node?e+="   float w2_"+this.getId()+" = texture (weightTransferFunction2_"+this.getId()+", vec2 (originalColor .a, blendColor_"+this.getId()+" .a)) .r;\n":e+="   float w2_"+this.getId()+" = weightConstant2_"+this.getId()+";\n"}return e+="\n",e+="   return clamp (originalColor * w1_"+this.getId()+" + blendColor_"+this.getId()+" * w2_"+this.getId()+", 0.0, 1.0);\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";if(!this.voxelsNode)return"";let e="";return e+="\n",e+="   // BlendedVolumeStyle\n",e+="\n",e+="   textureColor = getBlendedStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const E=V;function A(e){x.call(this,e),this.addType(m().BoundaryEnhancementVolumeStyle)}A.prototype=Object.assign(Object.create(x.prototype),{constructor:A,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"retainedOpacity",new(l().SFFloat)(.2)),new(d())(m().inputOutput,"boundaryOpacity",new(l().SFFloat)(.9)),new(d())(m().inputOutput,"opacityFactor",new(l().SFFloat)(2))]),getTypeName:function(){return"BoundaryEnhancementVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},addShaderFields:function(e){this._enabled.getValue()&&(e.addUserDefinedField(m().inputOutput,"retainedOpacity_"+this.getId(),this._retainedOpacity.copy()),e.addUserDefinedField(m().inputOutput,"boundaryOpacity_"+this.getId(),this._boundaryOpacity.copy()),e.addUserDefinedField(m().inputOutput,"opacityFactor_"+this.getId(),this._opacityFactor.copy()))},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="// BoundaryEnhancementVolumeStyle\n",e+="\n",e+="uniform float retainedOpacity_"+this.getId()+";\n",e+="uniform float boundaryOpacity_"+this.getId()+";\n",e+="uniform float opacityFactor_"+this.getId()+";\n",e+="\n",e+="vec4\n",e+="getBoundaryEnhancementStyle_"+this.getId()+" (in vec4 originalColor, in vec3 texCoord)\n",e+="{\n",e+="   float f0 = texture (x3d_Texture3D [0], texCoord) .r;\n",e+="   float f1 = texture (x3d_Texture3D [0], texCoord + vec3 (0.0, 0.0, 1.0 / float (textureSize (x3d_Texture3D [0], 0) .z))) .r;\n",e+="   float f  = abs (f0 - f1);\n",e+="\n",e+="   float retainedOpacity = retainedOpacity_"+this.getId()+";\n",e+="   float boundaryOpacity = boundaryOpacity_"+this.getId()+";\n",e+="   float opacityFactor   = opacityFactor_"+this.getId()+";\n",e+="\n",e+="   return vec4 (originalColor .rgb, originalColor .a * (retainedOpacity + boundaryOpacity * pow (f, opacityFactor)));\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // BoundaryEnhancementVolumeStyle\n",e+="\n",e+="   textureColor = getBoundaryEnhancementStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const P=A;function B(e){x.call(this,e),this.addType(m().CartoonVolumeStyle)}B.prototype=Object.assign(Object.create(x.prototype),{constructor:B,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"colorSteps",new(l().SFInt32)(4)),new(d())(m().inputOutput,"orthogonalColor",new(l().SFColorRGBA)(1,1,1,1)),new(d())(m().inputOutput,"parallelColor",new(l().SFColorRGBA)(0,0,0,1)),new(d())(m().inputOutput,"surfaceNormals",new(l().SFNode))]),getTypeName:function(){return"CartoonVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){x.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._surfaceNormals.addInterest("set_surfaceNormals__",this),this.set_surfaceNormals__())},set_surfaceNormals__:function(){this.surfaceNormalsNode=b()(m().X3DTexture3DNode,this._surfaceNormals)},addShaderFields:function(e){this._enabled.getValue()&&(e.addUserDefinedField(m().inputOutput,"colorSteps_"+this.getId(),this._colorSteps.copy()),e.addUserDefinedField(m().inputOutput,"orthogonalColor_"+this.getId(),this._orthogonalColor.copy()),e.addUserDefinedField(m().inputOutput,"parallelColor_"+this.getId(),this._parallelColor.copy()),this.surfaceNormalsNode&&e.addUserDefinedField(m().inputOutput,"surfaceNormals_"+this.getId(),new(l().SFNode)(this.surfaceNormalsNode)))},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="// CartoonVolumeStyle\n",e+="\n",e+="uniform int  colorSteps_"+this.getId()+";\n",e+="uniform vec4 orthogonalColor_"+this.getId()+";\n",e+="uniform vec4 parallelColor_"+this.getId()+";\n",e+=this.getNormalText(this.surfaceNormalsNode),e+="\n",e+="vec3\n",e+="rgb2hsv_"+this.getId()+" (in vec3 color)\n",e+="{\n",e+="   float h = 0.0;\n",e+="   float s = 0.0;\n",e+="   float v = 0.0;\n",e+="\n",e+="   float min = min (min (color .r, color .g), color .b);\n",e+="   float max = max (max (color .r, color .g), color .b);\n",e+="   v = max; // value\n",e+="\n",e+="   float delta = max - min;\n",e+="\n",e+="   if (max != 0.0 && delta != 0.0)\n",e+="   {\n",e+="      s = delta / max; // s\n",e+="\n",e+="      if (color .r == max)\n",e+="         h =     (color .g - color .b) / delta;  // between yellow & magenta\n",e+="      else if (color .g == max)\n",e+="         h = 2.0 + (color .b - color .r) / delta;  // between cyan & yellow\n",e+="      else\n",e+="         h = 4.0 + (color .r - color .g) / delta;  // between magenta & cyan\n",e+="\n",e+="      h *= M_PI / 3.0;  // radiants\n",e+="      if (h < 0.0)\n",e+="         h += M_PI * 2.0;\n",e+="   }\n",e+="   else\n",e+="      s = h = 0.0;         // s = 0, h is undefined\n",e+="\n",e+="   return vec3 (h, s, v);\n",e+="}\n",e+="\n",e+="vec3\n",e+="hsv2rgb_"+this.getId()+" (in vec3 hsv)\n",e+="{\n",e+="   float h = hsv [0];\n",e+="   float s = clamp (hsv [1], 0.0, 1.0);\n",e+="   float v = clamp (hsv [2], 0.0, 1.0);\n",e+="\n",e+="   // H is given on [0, 2 * Pi]. S and V are given on [0, 1].\n",e+="   // RGB are each returned on [0, 1].\n",e+="\n",e+="   if (s == 0.0)\n",e+="   {\n",e+="      // achromatic (grey)\n",e+="      return vec3 (v, v, v);\n",e+="   }\n",e+="   else\n",e+="   {\n",e+="      float w = (h * (180.0 / M_PI)) / 60.0;     // sector 0 to 5\n",e+="\n",e+="      float i = floor (w);\n",e+="      float f = w - i;                      // factorial part of h\n",e+="      float p = v * ( 1.0 - s );\n",e+="      float q = v * ( 1.0 - s * f );\n",e+="      float t = v * ( 1.0 - s * ( 1.0 - f ) );\n",e+="\n",e+="      switch (int (i) % 6)\n",e+="      {\n",e+="         case 0:  return vec3 (v, t, p);\n",e+="         case 1:  return vec3 (q, v, p);\n",e+="         case 2:  return vec3 (p, v, t);\n",e+="         case 3:  return vec3 (p, q, v);\n",e+="         case 4:  return vec3 (t, p, v);\n",e+="         default: return vec3 (v, p, q);\n",e+="      }\n",e+="   }\n",e+="\n",e+="   return vec3 (0.0);\n",e+="}\n",e+="\n",e+="vec3\n",e+="mix_hsv_"+this.getId()+" (in vec3 a, in vec3 b, in float t)\n",e+="{\n",e+="   // Linearely interpolate in HSV space between source color @a a and destination color @a b by an amount of @a t.\n",e+="   // Source and destination color must be in HSV space.\n",e+="\n",e+="   float ha = a [0];\n",e+="   float sa = a [1];\n",e+="   float va = a [2];\n",e+="\n",e+="   float hb = b [0];\n",e+="   float sb = b [1];\n",e+="   float vb = b [2];\n",e+="\n",e+="   if (sa == 0.0)\n",e+="      ha = hb;\n",e+="\n",e+="   if (sb == 0.0)\n",e+="      hb = ha;\n",e+="\n",e+="   float range = abs (hb - ha);\n",e+="\n",e+="   if (range <= M_PI)\n",e+="   {\n",e+="      float h = ha + t * (hb - ha);\n",e+="      float s = sa + t * (sb - sa);\n",e+="      float v = va + t * (vb - va);\n",e+="      return vec3 (h, s, v);\n",e+="   }\n",e+="\n",e+="   float PI2  = M_PI * 2.0;\n",e+="   float step = (PI2 - range) * t;\n",e+="   float h    = ha < hb ? ha - step : ha + step;\n",e+="\n",e+="   if (h < 0.0)\n",e+="      h += PI2;\n",e+="\n",e+="   else if (h > PI2)\n",e+="      h -= PI2;\n",e+="\n",e+="   float s = sa + t * (sb - sa);\n",e+="   float v = va + t * (vb - va);\n",e+="   return vec3 (h, s, v);\n",e+="}\n",e+="\n",e+="vec4\n",e+="getCartoonStyle_"+this.getId()+" (in vec4 originalColor, vec3 texCoord)\n",e+="{\n",e+="   vec4 surfaceNormal = getNormal_"+this.getId()+" (texCoord);\n",e+="\n",e+="   if (surfaceNormal .w == 0.0)\n",e+="      return vec4 (0.0);\n",e+="\n",e+="   vec4 orthogonalColor = orthogonalColor_"+this.getId()+";\n",e+="   vec4 parallelColor   = parallelColor_"+this.getId()+";\n",e+="   int  colorSteps      = colorSteps_"+this.getId()+";\n",e+="\n",e+="   float steps    = clamp (float (colorSteps), 1.0, 64.0);\n",e+="   float step     = M_PI / 2.0 / steps;\n",e+="   float cosTheta = min (dot (surfaceNormal .xyz, normalize (vertex)), 1.0);\n",e+="\n",e+="   if (cosTheta < 0.0)\n",e+="      return vec4 (0.0);\n",e+="\n",e+="   float t             = cos (min (floor (acos (cosTheta) / step) * (steps > 1.0 ? steps / (steps - 1.0) : 1.0), steps) * step);\n",e+="   vec3  orthogonalHSV = rgb2hsv_"+this.getId()+" (orthogonalColor .rgb);\n",e+="   vec3  parallelHSV   = rgb2hsv_"+this.getId()+" (parallelColor .rgb);\n",e+="\n",e+="   return vec4 (hsv2rgb_"+this.getId()+" (mix_hsv_"+this.getId()+" (orthogonalHSV, parallelHSV, t)), originalColor .a);\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // CartoonVolumeStyle\n",e+="\n",e+="   textureColor = getCartoonStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const L=B;function X(e){x.call(this,e),this.addType(m().ComposedVolumeStyle),this.renderStyleNodes=[]}X.prototype=Object.assign(Object.create(x.prototype),{constructor:X,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"renderStyle",new(l().MFNode))]),getTypeName:function(){return"ComposedVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){x.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._renderStyle.addInterest("set_renderStyle__",this),this.set_renderStyle__())},addVolumeData:function(e){x.prototype.addVolumeData.call(this,e);for(const t of this.renderStyleNodes)t.addVolumeData(e)},removeVolumeData:function(e){x.prototype.removeVolumeData.call(this,e);for(const t of this.renderStyleNodes)t.removeVolumeData(e)},set_renderStyle__:function(){const e=this.renderStyleNodes;for(const t of e){t.removeInterest("addNodeEvent",this);for(const e of this.getVolumeData())t.removeVolumeData(e)}e.length=0;for(const t of this._renderStyle){const n=b()(m().X3DComposableVolumeRenderStyleNode,t);n&&e.push(n)}for(const t of e){t.addInterest("addNodeEvent",this);for(const e of this.getVolumeData())t.addVolumeData(e)}},addShaderFields:function(e){if(this._enabled.getValue())for(const t of this.renderStyleNodes)t.addShaderFields(e)},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";for(const t of this.renderStyleNodes)e+=t.getUniformsText();e+="\n",e+="vec4\n",e+="getComposedStyle_"+this.getId()+" (in vec4 textureColor, in vec3 texCoord)\n",e+="{\n";for(const t of this.renderStyleNodes)e+=t.getFunctionsText();return e+="\n",e+="   return textureColor;\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // ComposedVolumeStyle\n",e+="\n",e+="   textureColor = getComposedStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const U=X;function M(e){x.call(this,e),this.addType(m().EdgeEnhancementVolumeStyle)}M.prototype=Object.assign(Object.create(x.prototype),{constructor:M,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"edgeColor",new(l().SFColorRGBA)(0,0,0,1)),new(d())(m().inputOutput,"gradientThreshold",new(l().SFFloat)(.4)),new(d())(m().inputOutput,"surfaceNormals",new(l().SFNode))]),getTypeName:function(){return"EdgeEnhancementVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){x.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._surfaceNormals.addInterest("set_surfaceNormals__",this),this.set_surfaceNormals__())},set_surfaceNormals__:function(){this.surfaceNormalsNode=b()(m().X3DTexture3DNode,this._surfaceNormals)},addShaderFields:function(e){this._enabled.getValue()&&(e.addUserDefinedField(m().inputOutput,"edgeColor_"+this.getId(),this._edgeColor.copy()),e.addUserDefinedField(m().inputOutput,"gradientThreshold_"+this.getId(),this._gradientThreshold.copy()),this.surfaceNormalsNode&&e.addUserDefinedField(m().inputOutput,"surfaceNormals_"+this.getId(),new(l().SFNode)(this.surfaceNormalsNode)))},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="// EdgeEnhancementVolumeStyle\n",e+="\n",e+="uniform vec4  edgeColor_"+this.getId()+";\n",e+="uniform float gradientThreshold_"+this.getId()+";\n",e+=this.getNormalText(this.surfaceNormalsNode),e+="\n",e+="vec4\n",e+="getEdgeEnhacementStyle_"+this.getId()+" (in vec4 originalColor, in vec3 texCoord)\n",e+="{\n",e+="   vec4 surfaceNormal = getNormal_"+this.getId()+" (texCoord);\n",e+="\n",e+="   if (surfaceNormal .w == 0.0)\n",e+="      return vec4 (0.0);\n",e+="\n",e+="   vec4  edgeColor         = edgeColor_"+this.getId()+";\n",e+="   float gradientThreshold = gradientThreshold_"+this.getId()+";\n",e+="\n",e+="   float angle = abs (dot (surfaceNormal .xyz, normalize (vertex)));\n",e+="\n",e+="   if (angle >= cos (gradientThreshold))\n",e+="      return originalColor;\n",e+="   else\n",e+="      return vec4 (mix (edgeColor .rgb, originalColor.rgb, angle), originalColor .a);\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // EdgeEnhancementVolumeStyle\n",e+="\n",e+="   textureColor = getEdgeEnhacementStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const R=M,z=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Core/X3DChildNode");var k=e.n(z);const j=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Grouping/X3DBoundedObject");var G=e.n(j);const q=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Browser/Core/TextureQuality");var H=e.n(q);const Y=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Shape/UnlitMaterial");var J=e.n(Y);function W(e,t){J().call(this,e),this.volumeDataNode=t,this.volumeShaderNodes=new Map}W.prototype=Object.assign(Object.create(J().prototype),{constructor:W,getTypeName:function(){return"VolumeMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},getVolumeShaders:function(){return this.volumeShaderNodes},getShader:function(e,t){const{fogNode:n,objectsCount:i}=t;let o="";return o+=n?n.getFogKey():"0",o+=".",o+=i[0],o+=".",o+=i[1],this.volumeShaderNodes.get(o)||this.createShader(o,e,t)},createShader:function(e,t,n){const i=this.getBrowser(),o=[],{fogNode:r,objectsCount:s}=n;r&&o.push("X3D_FOG"),s[0]&&(o.push("X3D_CLIP_PLANES"),o.push("X3D_NUM_CLIP_PLANES "+Math.min(s[0],i.getMaxClipPlanes()))),s[1]&&(o.push("X3D_LIGHTING"),o.push("X3D_NUM_LIGHTS "+Math.min(s[1],i.getMaxLights())));const a=this.volumeDataNode.createShader(o,"#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\nuniform mat4 x3d_TextureMatrix [1];\n\nin vec4  x3d_TexCoord0;\nin vec4  x3d_Vertex;\n\nout vec3 vertex;\nout vec4 texCoord;\n\nvoid\nmain ()\n{\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex   = position .xyz;\n   texCoord = x3d_TextureMatrix [0] * x3d_TexCoord0;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n",'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler3D;\n\nin vec3 vertex;\nin vec4 texCoord;\n\nuniform sampler3D x3d_Texture3D [1];\nuniform mat3 x3d_TextureNormalMatrix;\n\nuniform x3d_LightSourceParameters x3d_LightSource [x3d_MaxLights];\n\nconst float M_PI = 3.14159265359;\n\n#pragma X3D include "includes/ClipPlanes.glsl"\n#pragma X3D include "includes/Fog.glsl"\n\n// VOLUME_STYLES_UNIFORMS\n\nout vec4 x3d_FragColor;\n\nvec4\ngetTextureColor (in vec3 texCoord)\n{\n   if (texCoord .s < 0.0 || texCoord .s > 1.0)\n      discard;\n\n   if (texCoord .t < 0.0 || texCoord .t > 1.0)\n      discard;\n\n   if (texCoord .p < 0.0 || texCoord .p > 1.0)\n      discard;\n\n   vec4 textureColor = texture (x3d_Texture3D [0], texCoord);\n\n   // Apply volume styles.\n\n// VOLUME_STYLES_FUNCTIONS\n\n   return textureColor;\n}\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   vec4 finalColor = getTextureColor (texCoord .stp / texCoord .q);\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   x3d_FragColor = finalColor;\n}\n');return this.volumeShaderNodes.set(e,a),a},setShaderUniforms:function(e,t,n,i,o){this.volumeDataNode.setShaderUniforms(e,t)}});const Q=W,K=window[Symbol.for("X_ITE.X3D-7.0.0")].require("standard/Math/Numbers/Vector3");var Z=e.n(K);function $(e){k().call(this,e),G().call(this,e),this.addType(m().X3DVolumeDataNode),this.proximitySensorNode=e.createNode("ProximitySensor",!1),this.transformNode=e.createNode("Transform",!1),this.shapeNode=e.createNode("Shape",!1),this.appearanceNode=e.createNode("Appearance",!1),this.textureTransformNode=e.createNode("TextureTransform3D",!1),this.geometryNode=e.createNode("QuadSet",!1),this.textureCoordinateNode=e.createNode("TextureCoordinate3D",!1),this.coordinateNode=e.createNode("Coordinate",!1),this.volumeMaterialNode=new Q(e,this),this.textureNormalMatrixArray=new Float32Array(9),this.setCameraObject(!0)}$.prototype=Object.assign(Object.create(k().prototype),G().prototype,{constructor:$,initialize:function(){k().prototype.initialize.call(this),G().prototype.initialize.call(this);const e=this.getBrowser(),t=e.getContext();e.getBrowserOptions()._TextureQuality.addInterest("set_dimensions__",this),t.getVersion()>=2&&(this._dimensions.addInterest("set_dimensions__",this),this.set_dimensions__()),this._visible.addFieldInterest(this.transformNode._visible),this._bboxDisplay.addFieldInterest(this.transformNode._bboxDisplay),this.proximitySensorNode._size=new(l().SFVec3f)(-1,-1,-1),this.transformNode._children=new(l().MFNode)(this.shapeNode),this.shapeNode._appearance=this.appearanceNode,this.shapeNode._geometry=this.geometryNode,this.appearanceNode._alphaMode="BLEND",this.appearanceNode._material=this.volumeMaterialNode,this.appearanceNode._textureTransform=this.textureTransformNode,this.textureTransformNode._translation=new(l().SFVec3f)(.5,.5,.5),this.textureTransformNode._center=new(l().SFVec3f)(-.5,-.5,-.5),this.geometryNode._texCoord=this.textureCoordinateNode,this.geometryNode._coord=this.coordinateNode,this.coordinateNode.setPrivate(!0),this.textureCoordinateNode.setPrivate(!0),this.geometryNode.setPrivate(!0),this.textureTransformNode.setPrivate(!0),this.volumeMaterialNode.setPrivate(!0),this.appearanceNode.setPrivate(!0),this.shapeNode.setPrivate(!0),this.transformNode.setPrivate(!0),this.proximitySensorNode.setPrivate(!0),this.coordinateNode.setup(),this.textureCoordinateNode.setup(),this.geometryNode.setup(),this.textureTransformNode.setup(),this.volumeMaterialNode.setup(),this.appearanceNode.setup(),this.shapeNode.setup(),this.transformNode.setup(),this.proximitySensorNode.setup(),this.proximitySensorNode._orientation_changed.addFieldInterest(this.transformNode._rotation),this.proximitySensorNode._orientation_changed.addFieldInterest(this.textureTransformNode._rotation),this.textureTransformNode.addInterest("set_textureTransform__",this),this.set_textureTransform__()},getBBox:function(e,t){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?e.set(this._dimensions.getValue(),Z().Zero):e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},getAppearance:function(){return this.appearanceNode},updateShader:function(){this.volumeMaterialNode.getVolumeShaders().clear()},addShaderUniformNames:function(e){e.push("x3d_TextureNormalMatrix")},getNumPlanes:function(){switch(this.getBrowser().getBrowserOptions().getTextureQuality()){case H().LOW:return 200;case H().MEDIUM:return 400;case H().HIGH:return 600}return 200},set_dimensions__:function(){const e=this.getNumPlanes(),t=this._dimensions.getValue().magnitude(),n=t/2,i=[];this.coordinateNode._point.length=0;for(let o=0;o<e;++o){const r=o/(e-1)-.5;i.push(n,n,t*r,-n,n,t*r,-n,-n,t*r,n,-n,t*r)}this.coordinateNode._point=i,this.textureCoordinateNode._point=i,this.textureTransformNode._scale=new(l().SFVec3f)(1/this._dimensions.x,1/this._dimensions.y,1/this._dimensions.z)},set_textureTransform__:function(){this.textureNormalMatrixArray.set(this.textureTransformNode.getMatrix().submatrix.inverse())},traverse:function(e,t){this.proximitySensorNode.traverse(e,t),this.transformNode.traverse(e,t)},setShaderUniforms(e,t){e.uniformMatrix3fv(t.x3d_TextureNormalMatrix,!0,this.textureNormalMatrixArray)}});const ee=$,te=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Shaders/ComposedShader");var ne=e.n(te);const ie=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Shaders/ShaderPart");var oe=e.n(ie);function re(e){ee.call(this,e),this.addType(m().IsoSurfaceVolumeData),this.renderStyleNodes=[]}re.prototype=Object.assign(Object.create(ee.prototype),{constructor:re,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"dimensions",new(l().SFVec3f)(1,1,1)),new(d())(m().inputOutput,"contourStepSize",new(l().SFFloat)(0)),new(d())(m().inputOutput,"surfaceValues",new(l().MFFloat)),new(d())(m().inputOutput,"surfaceTolerance",new(l().SFFloat)(0)),new(d())(m().inputOutput,"visible",new(l().SFBool)(!0)),new(d())(m().inputOutput,"bboxDisplay",new(l().SFBool)),new(d())(m().initializeOnly,"bboxCenter",new(l().SFVec3f)(0,0,0)),new(d())(m().initializeOnly,"bboxSize",new(l().SFVec3f)(-1,-1,-1)),new(d())(m().inputOutput,"renderStyle",new(l().MFNode)),new(d())(m().inputOutput,"gradients",new(l().SFNode)),new(d())(m().inputOutput,"voxels",new(l().SFNode))]),getTypeName:function(){return"IsoSurfaceVolumeData"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"children"},initialize:function(){ee.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._gradients.addInterest("set_gradients__",this),this._renderStyle.addInterest("set_renderStyle__",this),this._contourStepSize.addInterest("updateShader",this),this._surfaceValues.addInterest("updateShader",this),this._surfaceTolerance.addInterest("updateShader",this),this._renderStyle.addInterest("updateShader",this),this.getAppearance()._texture=this._voxels,this.set_gradients__(),this.set_renderStyle__(),this.set_voxels__(),this.updateShader())},set_gradients__:function(){this.gradientsNode=b()(m().X3DTexture3DNode,this._gradients)},set_renderStyle__:function(){const e=this.renderStyleNodes;for(const t of e)t.removeInterest("updateShader",this),t.removeVolumeData(this);e.length=0;for(const t of this._renderStyle){const n=b()(m().X3DComposableVolumeRenderStyleNode,t);n&&e.push(n)}for(const t of e)t.addInterest("updateShader",this),t.addVolumeData(this)},set_voxels__:function(){this.voxelsNode=b()(m().X3DTexture3DNode,this._voxels),this.voxelsNode?this.getAppearance()._texture=this._voxels:this.getAppearance()._texture=this.getBrowser().getDefaultVoxels(this.getExecutionContext())},createShader:function(e,t,n){const i=this.getBrowser().getDefaultVolumeStyle();let o=i.getUniformsText(),r=i.getFunctionsText();o+="\n",o+="uniform float surfaceValues ["+this._surfaceValues.length+"];\n",o+="uniform float surfaceTolerance;\n";for(const e of this.renderStyleNodes)o+=e.getUniformsText();if(r+="\n",r+="   // IsoSurfaceVolumeData\n",r+="\n",this.gradientsNode?(o+="\n",o+="uniform sampler3D gradients;\n",r+="   if (length (texture (gradients, texCoord) .xyz * 2.0 - 1.0) < surfaceTolerance)\n",r+="      discard;\n"):(o+="\n",o+="vec4\n",o+="getNormal (in vec3 texCoord)\n",o+="{\n",o+="   vec4  offset = vec4 (1.0 / vec3 (textureSize (x3d_Texture3D [0], 0)), 0.0);\n",o+="   float i0     = texture (x3d_Texture3D [0], texCoord + offset .xww) .r;\n",o+="   float i1     = texture (x3d_Texture3D [0], texCoord - offset .xww) .r;\n",o+="   float i2     = texture (x3d_Texture3D [0], texCoord + offset .wyw) .r;\n",o+="   float i3     = texture (x3d_Texture3D [0], texCoord - offset .wyw) .r;\n",o+="   float i4     = texture (x3d_Texture3D [0], texCoord + offset .wwz) .r;\n",o+="   float i5     = texture (x3d_Texture3D [0], texCoord - offset .wwz) .r;\n",o+="   vec3  n      = vec3 (i1 - i0, i3 - i2, i5 - i4);\n",o+="\n",o+="   return vec4 (normalize (x3d_TextureNormalMatrix * n), length (n));\n",o+="}\n",r+="   if (getNormal (texCoord) .w < surfaceTolerance)\n",r+="      discard;\n"),r+="\n",r+="   float intensity = textureColor .r;\n",r+="\n",1===this._surfaceValues.length){const e=Math.abs(this._contourStepSize.getValue());if(0===e)r+="   if (intensity > surfaceValues [0])\n",r+="   {\n",r+="      textureColor = vec4 (vec3 (surfaceValues [0]), 1.0);\n",this.renderStyleNodes.length&&(r+=this.renderStyleNodes[0].getFunctionsText()),r+="   }\n",r+="   else\n",r+="   {\n",r+="      discard;\n",r+="   }\n",r+="\n";else{const t=[];for(let n=this._surfaceValues[0]-e;n>0;n-=e)t.unshift(n);t.push(this._surfaceValues[0]);for(let n=this._surfaceValues[0]+e;n<1;n+=e)t.push(n);r+="   if (false)\n",r+="   { }\n";for(let e=this._surfaceValues.length-1;e>=0;--e)r+="   else if (intensity > "+t[e]+")\n",r+="   {\n",r+="      textureColor = vec4 (vec3 ("+t[e]+"), 1.0);\n",this.renderStyleNodes.length&&(r+=this.renderStyleNodes[0].getFunctionsText()),r+="   }\n";r+="   else\n",r+="   {\n",r+="      discard;\n",r+="   }\n",r+="\n"}}else{r+="   if (false)\n",r+="   { }\n";for(let e=this._surfaceValues.length-1;e>=0;--e){if(r+="   else if (intensity > surfaceValues ["+e+"])\n",r+="   {\n",r+="      textureColor = vec4 (vec3 (surfaceValues ["+e+"]), 1.0);\n",this.renderStyleNodes.length){const t=Math.min(e,this.renderStyleNodes.length-1);r+=this.renderStyleNodes[t].getFunctionsText()}r+="   }\n"}r+="   else\n",r+="   {\n",r+="      discard;\n",r+="   }\n",r+="\n"}n=(n=n.replace(/\/\/ VOLUME_STYLES_UNIFORMS\n/,o)).replace(/\/\/ VOLUME_STYLES_FUNCTIONS\n/,r);const s=new(oe())(this.getExecutionContext());s._url.push("data:x-shader/x-vertex,"+t),s.setPrivate(!0),s.setName("VolumeDataVertexShader"),s.setOptions(e),s.setup();const a=new(oe())(this.getExecutionContext());a._type="FRAGMENT",a._url.push("data:x-shader/x-fragment,"+n),a.setPrivate(!0),a.setName("VolumeDataFragmentShader"),a.setOptions(e),a.setup();const u=new(ne())(this.getExecutionContext());u._language="GLSL",u._parts.push(s),u._parts.push(a),u.setPrivate(!0),u.setName("VolumeDataShader"),u.addUserDefinedField(m().inputOutput,"surfaceValues",this._surfaceValues.copy()),u.addUserDefinedField(m().inputOutput,"surfaceTolerance",this._surfaceTolerance.copy()),this.gradientsNode&&u.addUserDefinedField(m().inputOutput,"gradients",new(l().SFNode)(this.gradientsNode)),i.addShaderFields(u);for(const e of this.renderStyleNodes)e.addShaderFields(u);const d=[];return this.addShaderUniformNames(d),u.setUniformNames(d),u.setup(),u}});const se=re;function ae(e){y.call(this,e),this.addType(m().ProjectionVolumeStyle)}ae.prototype=Object.assign(Object.create(y.prototype),{constructor:ae,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"type",new(l().SFString)("MAX")),new(d())(m().inputOutput,"intensityThreshold",new(l().SFFloat)(0))]),getTypeName:function(){return"ProjectionVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},addShaderFields:function(e){this._enabled.getValue()&&e.addUserDefinedField(m().inputOutput,"intensityThreshold_"+this.getId(),this._intensityThreshold.copy())},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";switch(e+="\n",e+="// ProjectionVolumeStyle\n",e+="\n",e+="uniform float intensityThreshold_"+this.getId()+";\n",e+="\n",e+="vec4\n",e+="getProjectionStyle_"+this.getId()+"(in vec4 originalColor, in vec3 texCoord)\n",e+="{\n",this._type.getValue()){default:case"MAX":case"AVERAGE":e+="   float projectionColor = 0.0;\n";break;case"MIN":e+="   float projectionColor = 1.0;\n"}switch(e+="   const int samples     = 32;\n",e+="   vec3  step            = normalize (x3d_TextureNormalMatrix * vec3 (0.0, 0.0, 1.0)) / float (samples);\n",e+="   vec3  ray             = texCoord - step * float (samples) * 0.5;\n",e+="   bool  first           = false;\n",e+="\n",e+="   for (int i = 0; i < samples; ++ i, ray += step)\n",e+="   {\n",e+="      if (ray .s < 0.0 || ray .s > 1.0)\n",e+="         continue;\n",e+="\n",e+="      if (ray .t < 0.0 || ray .t > 1.0)\n",e+="         continue;\n",e+="\n",e+="      if (ray .p < 0.0 || ray .p > 1.0)\n",e+="         continue;\n",e+="\n",e+="      float intensity = texture (x3d_Texture3D [0], ray) .r;\n",e+="\n",this._type.getValue()){default:case"MAX":e+="      if (intensity < intensityThreshold_"+this.getId()+")\n",e+="         continue;\n",e+="\n",e+="      if (intensityThreshold_"+this.getId()+" > 0.0 && first)\n",e+="         break;\n",e+="\n",e+="      if (intensity <= projectionColor)\n",e+="      {\n",e+="         first = true;\n",e+="         continue;\n",e+="      }\n",e+="\n",e+="      projectionColor = intensity;\n";break;case"MIN":e+="      if (intensity < intensityThreshold_"+this.getId()+")\n",e+="         continue;\n",e+="\n",e+="      if (intensityThreshold_"+this.getId()+" > 0.0 && first)\n",e+="         break;\n",e+="\n",e+="      if (intensity >= projectionColor)\n",e+="      {\n",e+="         first = true;\n",e+="         continue;\n",e+="      }\n",e+="\n",e+="      projectionColor = intensity;\n";break;case"AVERAGE":e+="      projectionColor += intensity;\n"}return e+="   }\n",e+="\n","AVERAGE"===this._type.getValue()&&(e+="   projectionColor /= float (samples);\n"),e+="   return vec4 (vec3 (projectionColor), originalColor .a);\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // ProjectionVolumeStyle\n",e+="\n",e+="   textureColor = getProjectionStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const le=ae;function ue(e){ee.call(this,e),this.addType(m().SegmentedVolumeData),this.segmentIdentifiersNode=null,this.renderStyleNodes=[]}ue.prototype=Object.assign(Object.create(ee.prototype),{constructor:ue,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"dimensions",new(l().SFVec3f)(1,1,1)),new(d())(m().inputOutput,"segmentEnabled",new(l().MFBool)),new(d())(m().inputOutput,"visible",new(l().SFBool)(!0)),new(d())(m().inputOutput,"bboxDisplay",new(l().SFBool)),new(d())(m().initializeOnly,"bboxCenter",new(l().SFVec3f)(0,0,0)),new(d())(m().initializeOnly,"bboxSize",new(l().SFVec3f)(-1,-1,-1)),new(d())(m().inputOutput,"segmentIdentifiers",new(l().SFNode)),new(d())(m().inputOutput,"renderStyle",new(l().MFNode)),new(d())(m().inputOutput,"voxels",new(l().SFNode))]),getTypeName:function(){return"SegmentedVolumeData"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"children"},initialize:function(){ee.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._segmentIdentifiers.addInterest("set_segmentIdentifiers__",this),this._renderStyle.addInterest("set_renderStyle__",this),this._segmentEnabled.addInterest("updateShader",this),this._segmentIdentifiers.addInterest("updateShader",this),this._renderStyle.addInterest("updateShader",this),this.getAppearance()._texture=this._voxels,this.set_segmentIdentifiers__(),this.set_renderStyle__(),this.set_voxels__(),this.updateShader())},getSegmentEnabled:function(e){return!(e<this._segmentEnabled.length)||this._segmentEnabled[e]},set_segmentIdentifiers__:function(){this.segmentIdentifiersNode=b()(m().X3DTexture3DNode,this._segmentIdentifiers)},set_renderStyle__:function(){const e=this.renderStyleNodes;for(const t of e)t.removeInterest("updateShader",this),t.removeVolumeData(this);e.length=0;for(const t of this._renderStyle){const n=b()(m().X3DComposableVolumeRenderStyleNode,t);n&&e.push(n)}for(const t of e)t.addInterest("updateShader",this),t.addVolumeData(this)},set_voxels__:function(){this.voxelsNode=b()(m().X3DTexture3DNode,this._voxels),this.voxelsNode?this.getAppearance()._texture=this._voxels:this.getAppearance()._texture=this.getBrowser().getDefaultVoxels(this.getExecutionContext())},createShader:function(e,t,n){const i=this.getBrowser().getDefaultVolumeStyle();let o=i.getUniformsText(),r=i.getFunctionsText();if(this.segmentIdentifiersNode?(o+="\n",o+="uniform sampler3D segmentIdentifiers;\n",o+="\n",r+="\n",r+="   int segment = int (texture (segmentIdentifiers, texCoord) .r * 255.0);\n"):r+="   int segment = 0;\n",this.renderStyleNodes.length){r+="\n",r+="   switch (segment)\n",r+="   {\n";for(const[e,t]of this.renderStyleNodes.entries())r+="      case "+e+":\n",r+="      {\n",this.getSegmentEnabled(e)?(o+=t.getUniformsText(),r+=t.getFunctionsText(),r+="         break;\n"):r+="         discard;\n",r+="      }\n";r+="   }\n"}n=(n=n.replace(/\/\/ VOLUME_STYLES_UNIFORMS\n/,o)).replace(/\/\/ VOLUME_STYLES_FUNCTIONS\n/,r);const s=new(oe())(this.getExecutionContext());s._url.push("data:x-shader/x-vertex,"+t),s.setPrivate(!0),s.setName("SegmentedVolumeDataVertexShader"),s.setOptions(e),s.setup();const a=new(oe())(this.getExecutionContext());a._type="FRAGMENT",a._url.push("data:x-shader/x-fragment,"+n),a.setPrivate(!0),a.setName("SegmentedVolumeDataFragmentShader"),a.setOptions(e),a.setup();const u=new(ne())(this.getExecutionContext());u._language="GLSL",u._parts.push(s),u._parts.push(a),u.setPrivate(!0),u.setName("SegmentedVolumeDataShader"),this.segmentIdentifiersNode&&u.addUserDefinedField(m().inputOutput,"segmentIdentifiers",new(l().SFNode)(this.segmentIdentifiersNode)),i.addShaderFields(u);for(const[e,t]of this.renderStyleNodes.entries())this.getSegmentEnabled(e)&&t.addShaderFields(u);const d=[];return this.addShaderUniformNames(d),u.setUniformNames(d),u.setup(),u}});const de=ue;function ce(e){x.call(this,e),this.addType(m().ShadedVolumeStyle)}ce.prototype=Object.assign(Object.create(x.prototype),{constructor:ce,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"lighting",new(l().SFBool)),new(d())(m().inputOutput,"shadows",new(l().SFBool)),new(d())(m().initializeOnly,"phaseFunction",new(l().SFString)("Henyey-Greenstein")),new(d())(m().inputOutput,"material",new(l().SFNode)),new(d())(m().inputOutput,"surfaceNormals",new(l().SFNode))]),getTypeName:function(){return"ShadedVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){x.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._material.addInterest("set_material__",this),this._surfaceNormals.addInterest("set_surfaceNormals__",this),this.set_material__(),this.set_surfaceNormals__())},set_material__:function(){this.materialNode&&this.materialNode.removeInterest("addNodeEvent",this),this.materialNode=b()(m().X3DMaterialNode,this._material),this.materialNode&&this.materialNode.addInterest("addNodeEvent",this)},set_surfaceNormals__:function(){this.surfaceNormalsNode=b()(m().X3DTexture3DNode,this._surfaceNormals)},addShaderFields:function(e){this._enabled.getValue()&&(this.materialNode&&(e.addUserDefinedField(m().inputOutput,"ambientIntensity_"+this.getId(),this.materialNode._ambientIntensity.copy()),e.addUserDefinedField(m().inputOutput,"diffuseColor_"+this.getId(),this.materialNode._diffuseColor.copy()),e.addUserDefinedField(m().inputOutput,"specularColor_"+this.getId(),this.materialNode._specularColor.copy()),e.addUserDefinedField(m().inputOutput,"emissiveColor_"+this.getId(),this.materialNode._emissiveColor.copy()),e.addUserDefinedField(m().inputOutput,"shininess_"+this.getId(),this.materialNode._shininess.copy()),e.addUserDefinedField(m().inputOutput,"transparency_"+this.getId(),this.materialNode._transparency.copy())),this.surfaceNormalsNode&&e.addUserDefinedField(m().inputOutput,"surfaceNormals_"+this.getId(),new(l().SFNode)(this.surfaceNormalsNode)))},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="// ShadedVolumeStyle\n",e+="\n",e+="uniform float ambientIntensity_"+this.getId()+";\n",e+="uniform vec3  diffuseColor_"+this.getId()+";\n",e+="uniform vec3  specularColor_"+this.getId()+";\n",e+="uniform vec3  emissiveColor_"+this.getId()+";\n",e+="uniform float shininess_"+this.getId()+";\n",e+="uniform float transparency_"+this.getId()+";\n",e+=this.getNormalText(this.surfaceNormalsNode),e+="\n",e+="float\n",e+="getSpotFactor_"+this.getId()+" (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n",e+="{\n",e+="   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n",e+="\n",e+="   if (spotAngle >= cutOffAngle)\n",e+="      return 0.0;\n",e+="   else if (spotAngle <= beamWidth)\n",e+="      return 1.0;\n",e+="\n",e+="   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n",e+="}\n",e+="\n",e+="vec4\n",e+="getShadedStyle_"+this.getId()+" (in vec4 originalColor, in vec3 texCoord)\n",e+="{\n",e+="   vec4 surfaceNormal = getNormal_"+this.getId()+" (texCoord);\n",e+="\n",e+="   if (surfaceNormal .w == 0.0)\n",e+="      return vec4 (0.0);\n",e+="\n",e+="   vec4 shadedColor   = vec4 (0.0);\n",this._lighting.getValue()?(this.materialNode?(e+="   vec3 diffuseFactor = diffuseColor_"+this.getId()+";\n",e+="   vec3 ambientTerm   = diffuseFactor * ambientIntensity_"+this.getId()+";\n",e+="\n",e+="   shadedColor .a = originalColor .a * (1.0 - transparency_"+this.getId()+");\n"):(e+="   vec3 diffuseFactor = originalColor .rgb;\n",e+="   vec3 ambientTerm   = vec3 (0.0);\n",e+="\n",e+="   shadedColor .a = originalColor .a;\n"),e+="\n",e+="   vec3 N = surfaceNormal .xyz;\n",e+="   vec3 V = normalize (-vertex); // normalized vector from point on geometry to viewer's position\n",e+="\n",e+="   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n",e+="   {\n",e+="      x3d_LightSourceParameters light = x3d_LightSource [i];\n",e+="\n",e+="      vec3  vL = light .location - vertex; // Light to fragment\n",e+="      float dL = length (light .matrix * vL);\n",e+="      bool  di = light .type == x3d_DirectionalLight;\n",e+="\n",e+="      if (di || dL <= light .radius)\n",e+="      {\n",e+="         vec3 d = light .direction;\n",e+="         vec3 c = light .attenuation;\n",e+="         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n",e+="         vec3 H = normalize (L + V);             // Specular term\n",e+="\n",e+="         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n",e+="         vec3  diffuseTerm    = diffuseFactor * lightAngle;\n",e+="         float specularFactor = shininess_"+this.getId()+" > 0.0 ? pow (max (dot (N, H), 0.0), shininess_"+this.getId()+" * 128.0) : 1.0;\n",e+="         vec3  specularTerm   = light .intensity * specularColor_"+this.getId()+" * specularFactor;\n",e+="\n",e+="         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n",e+="         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor_"+this.getId()+" (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n",e+="         float attenuationSpotFactor = attenuationFactor * spotFactor;\n",e+="         vec3  ambientColor          = light .ambientIntensity * ambientTerm;\n",e+="         vec3  diffuseSpecularColor  = light .intensity * (diffuseTerm + specularTerm);\n",e+="\n",e+="         shadedColor .rgb += attenuationSpotFactor * light .color * (ambientColor + diffuseSpecularColor);\n",e+="      }\n",e+="\n",e+="      shadedColor .rgb += emissiveColor_"+this.getId()+";\n",e+="   }\n"):this.materialNode?(e+="   shadedColor .rgb = diffuseColor_"+this.getId()+";\n",e+="   shadedColor .a   = originalColor .a * (1.0 - transparency_"+this.getId()+");\n"):e+="   shadedColor = originalColor;\n",e+="\n",e+="   return shadedColor;\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // ShadedVolumeStyle\n",e+="\n",e+="   textureColor = getShadedStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const he=ce;function fe(e){x.call(this,e),this.addType(m().SilhouetteEnhancementVolumeStyle)}fe.prototype=Object.assign(Object.create(x.prototype),{constructor:fe,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"silhouetteRetainedOpacity",new(l().SFFloat)(1)),new(d())(m().inputOutput,"silhouetteBoundaryOpacity",new(l().SFFloat)(0)),new(d())(m().inputOutput,"silhouetteSharpness",new(l().SFFloat)(.5)),new(d())(m().inputOutput,"surfaceNormals",new(l().SFNode))]),getTypeName:function(){return"SilhouetteEnhancementVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){x.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._surfaceNormals.addInterest("set_surfaceNormals__",this),this.set_surfaceNormals__())},set_surfaceNormals__:function(){this.surfaceNormalsNode=b()(m().X3DTexture3DNode,this._surfaceNormals)},addShaderFields:function(e){this._enabled.getValue()&&(e.addUserDefinedField(m().inputOutput,"silhouetteRetainedOpacity_"+this.getId(),this._silhouetteRetainedOpacity.copy()),e.addUserDefinedField(m().inputOutput,"silhouetteBoundaryOpacity_"+this.getId(),this._silhouetteBoundaryOpacity.copy()),e.addUserDefinedField(m().inputOutput,"silhouetteSharpness_"+this.getId(),this._silhouetteSharpness.copy()),this.surfaceNormalsNode&&e.addUserDefinedField(m().inputOutput,"surfaceNormals_"+this.getId(),new(l().SFNode)(this.surfaceNormalsNode)))},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="// SilhouetteEnhancementVolumeStyle\n",e+="\n",e+="uniform float silhouetteRetainedOpacity_"+this.getId()+";\n",e+="uniform float silhouetteBoundaryOpacity_"+this.getId()+";\n",e+="uniform float silhouetteSharpness_"+this.getId()+";\n",e+=this.getNormalText(this.surfaceNormalsNode),e+="\n",e+="vec4\n",e+="getSilhouetteEnhancementStyle_"+this.getId()+" (in vec4 originalColor, in vec3 texCoord)\n",e+="{\n",e+="   vec4 surfaceNormal = getNormal_"+this.getId()+" (texCoord);\n",e+="\n",e+="   if (surfaceNormal .w == 0.0)\n",e+="      return vec4 (0.0);\n",e+="   \n",e+="   float silhouetteRetainedOpacity = silhouetteRetainedOpacity_"+this.getId()+";\n",e+="   float silhouetteBoundaryOpacity = silhouetteBoundaryOpacity_"+this.getId()+";\n",e+="   float silhouetteSharpness       = silhouetteSharpness_"+this.getId()+";\n",e+="\n",e+="   return vec4 (originalColor .rgb, originalColor .a * (silhouetteRetainedOpacity + silhouetteBoundaryOpacity * pow (1.0 - abs (dot (surfaceNormal .xyz, normalize (vertex))), silhouetteSharpness)));\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // SilhouetteEnhancementVolumeStyle\n",e+="\n",e+="   textureColor = getSilhouetteEnhancementStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const pe=fe;function ge(e){x.call(this,e),this.addType(m().ToneMappedVolumeStyle)}ge.prototype=Object.assign(Object.create(x.prototype),{constructor:ge,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"enabled",new(l().SFBool)(!0)),new(d())(m().inputOutput,"coolColor",new(l().SFColorRGBA)(0,0,1,0)),new(d())(m().inputOutput,"warmColor",new(l().SFColorRGBA)(1,1,0,0)),new(d())(m().inputOutput,"surfaceNormals",new(l().SFNode))]),getTypeName:function(){return"ToneMappedVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){x.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._surfaceNormals.addInterest("set_surfaceNormals__",this),this.set_surfaceNormals__())},set_surfaceNormals__:function(){this.surfaceNormalsNode=b()(m().X3DTexture3DNode,this._surfaceNormals)},addShaderFields:function(e){this._enabled.getValue()&&(e.addUserDefinedField(m().inputOutput,"coolColor_"+this.getId(),this._coolColor.copy()),e.addUserDefinedField(m().inputOutput,"warmColor_"+this.getId(),this._warmColor.copy()),this.surfaceNormalsNode&&e.addUserDefinedField(m().inputOutput,"surfaceNormals_"+this.getId(),new(l().SFNode)(this.surfaceNormalsNode)))},getUniformsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="// ToneMappedVolumeStyle\n",e+="\n",e+="uniform vec4 coolColor_"+this.getId()+";\n",e+="uniform vec4 warmColor_"+this.getId()+";\n",e+=this.getNormalText(this.surfaceNormalsNode),e+="\n",e+="vec4\n",e+="getToneMappedStyle_"+this.getId()+" (in vec4 originalColor, in vec3 texCoord)\n",e+="{\n",e+="   vec4 surfaceNormal = getNormal_"+this.getId()+" (texCoord);\n",e+="\n",e+="   if (surfaceNormal .w == 0.0)\n",e+="      return vec4 (0.0);\n",e+="\n",e+="   vec3 toneColor = vec3 (0.0);\n",e+="   vec3 coolColor = coolColor_"+this.getId()+" .rgb;\n",e+="   vec3 warmColor = warmColor_"+this.getId()+" .rgb;\n",e+="\n",e+="   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n",e+="   {\n",e+="      x3d_LightSourceParameters light = x3d_LightSource [i];\n",e+="\n",e+="      vec3  L           = light .type == x3d_DirectionalLight ? -light .direction : normalize (light .location - vertex);\n",e+="      float colorFactor = dot (L, surfaceNormal .xyz) * 0.5 + 0.5;\n",e+="\n",e+="      toneColor += mix (warmColor .rgb, coolColor .rgb, colorFactor);\n",e+="   }\n",e+="\n",e+="   return vec4 (toneColor, originalColor .a);\n",e+="}\n",e},getFunctionsText:function(){if(!this._enabled.getValue())return"";let e="";return e+="\n",e+="   // ToneMappedVolumeStyle\n",e+="\n",e+="   textureColor = getToneMappedStyle_"+this.getId()+" (textureColor, texCoord);\n",e}});const me=ge;function _e(e){ee.call(this,e),this.addType(m().VolumeData),this.renderStyleNode=null}_e.prototype=Object.assign(Object.create(ee.prototype),{constructor:_e,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"dimensions",new(l().SFVec3f)(1,1,1)),new(d())(m().inputOutput,"visible",new(l().SFBool)(!0)),new(d())(m().inputOutput,"bboxDisplay",new(l().SFBool)),new(d())(m().initializeOnly,"bboxCenter",new(l().SFVec3f)(0,0,0)),new(d())(m().initializeOnly,"bboxSize",new(l().SFVec3f)(-1,-1,-1)),new(d())(m().inputOutput,"renderStyle",new(l().SFNode)),new(d())(m().inputOutput,"voxels",new(l().SFNode))]),getTypeName:function(){return"VolumeData"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"children"},initialize:function(){ee.prototype.initialize.call(this);this.getBrowser().getContext().getVersion()<2||(this._renderStyle.addInterest("set_renderStyle__",this),this._voxels.addInterest("set_voxels__",this),this._renderStyle.addInterest("updateShader",this),this.getAppearance()._texture=this._voxels,this.set_renderStyle__(),this.set_voxels__(),this.updateShader())},set_renderStyle__:function(){this.renderStyleNode&&(this.renderStyleNode.removeInterest("updateShader",this),this.renderStyleNode.removeVolumeData(this)),this.renderStyleNode=b()(m().X3DVolumeRenderStyleNode,this._renderStyle),this.renderStyleNode&&(this.renderStyleNode.addInterest("updateShader",this),this.renderStyleNode.addVolumeData(this))},set_voxels__:function(){this.voxelsNode=b()(m().X3DTexture3DNode,this._voxels),this.voxelsNode?this.getAppearance()._texture=this._voxels:this.getAppearance()._texture=this.getBrowser().getDefaultVoxels(this.getExecutionContext())},createShader:function(e,t,n){const i=this.getBrowser().getDefaultVolumeStyle();let o=i.getUniformsText(),r=i.getFunctionsText();this.renderStyleNode&&(o+=this.renderStyleNode.getUniformsText(),r+=this.renderStyleNode.getFunctionsText()),n=(n=n.replace(/\/\/ VOLUME_STYLES_UNIFORMS\n/,o)).replace(/\/\/ VOLUME_STYLES_FUNCTIONS\n/,r);const s=new(oe())(this.getExecutionContext());s._url.push("data:x-shader/x-vertex,"+t),s.setPrivate(!0),s.setName("VolumeDataVertexShader"),s.setOptions(e),s.setup();const a=new(oe())(this.getExecutionContext());a._type="FRAGMENT",a._url.push("data:x-shader/x-fragment,"+n),a.setPrivate(!0),a.setName("VolumeDataFragmentShader"),a.setOptions(e),a.setup();const l=new(ne())(this.getExecutionContext());l._language="GLSL",l._parts.push(s),l._parts.push(a),l.setPrivate(!0),l.setName("VolumeDataShader"),i.addShaderFields(l),this.renderStyleNode&&this.renderStyleNode.addShaderFields(l);const u=[];return this.addShaderUniformNames(u),l.setUniformNames(u),l.setup(),l}});const ye=_e,we=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Grouping/X3DGroupingNode");var xe=e.n(we);function Se(e){k().call(this,e),this.addType(m().X3DProductStructureChildNode)}Se.prototype=Object.assign(Object.create(k().prototype),{constructor:Se});const be=Se;function Ne(e){xe().call(this,e),be.call(this,e),this.addType(m().CADAssembly)}Ne.prototype=Object.assign(Object.create(xe().prototype),{constructor:Ne,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"name",new(l().SFString)),new(d())(m().inputOutput,"visible",new(l().SFBool)(!0)),new(d())(m().inputOutput,"bboxDisplay",new(l().SFBool)),new(d())(m().initializeOnly,"bboxSize",new(l().SFVec3f)(-1,-1,-1)),new(d())(m().initializeOnly,"bboxCenter",new(l().SFVec3f)),new(d())(m().inputOnly,"addChildren",new(l().MFNode)),new(d())(m().inputOnly,"removeChildren",new(l().MFNode)),new(d())(m().inputOutput,"children",new(l().MFNode))]),getTypeName:function(){return"CADAssembly"},getComponentName:function(){return"CADGeometry"},getContainerField:function(){return"children"}});const ve=Ne,Ce=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Rendering/TraverseType");var Te=e.n(Ce);function De(e){be.call(this,e),G().call(this,e),this.addType(m().CADFace),this.childNode=null,this.visibleNode=null,this.boundedObject=null}De.prototype=Object.assign(Object.create(be.prototype),G().prototype,{constructor:De,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"name",new(l().SFString)),new(d())(m().inputOutput,"visible",new(l().SFBool)(!0)),new(d())(m().inputOutput,"bboxDisplay",new(l().SFBool)),new(d())(m().initializeOnly,"bboxSize",new(l().SFVec3f)(-1,-1,-1)),new(d())(m().initializeOnly,"bboxCenter",new(l().SFVec3f)),new(d())(m().inputOutput,"shape",new(l().SFNode))]),getTypeName:function(){return"CADFace"},getComponentName:function(){return"CADGeometry"},getContainerField:function(){return"children"},initialize:function(){be.prototype.initialize.call(this),G().prototype.initialize.call(this),this._shape.addInterest("set_shape__",this),this.set_shape__()},getBBox:function(e,t){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=this.visibleNode;return n?n.getBBox(e,t):e.set()}return e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},set_shape__:function(){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this),this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this)),this.childNode=null;try{const e=this._shape.getValue().getInnerNode(),t=e.getType();for(let n=t.length-1;n>=0;--n){switch(t[n]){case m().LOD:case m().Transform:case m().X3DShapeNode:e._isCameraObject.addInterest("set_cameraObject__",this),e._isPickableObject.addInterest("set_transformSensors__",this),e._visible.addInterest("set_visible__",this),e._bboxDisplay.addInterest("set_bboxDisplay__",this),this.childNode=e;break;default:continue}break}}catch(e){}this.childNode?delete this.traverse:this.traverse=Function.prototype,this.set_transformSensors__(),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.childNode&&this.childNode.getCameraObject()?this.setCameraObject(this.childNode._visible.getValue()):this.setCameraObject(!1)},set_transformSensors__:function(){this.setPickableObject(Boolean(this.childNode&&this.childNode.getPickableObject()))},set_visible__:function(){this.childNode?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=null,this.set_cameraObject__()},set_bboxDisplay__:function(){this.childNode?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},traverse:function(e,t){switch(e){case Te().POINTER:case Te().CAMERA:case Te().SHADOW:{const n=this.visibleNode;return void(n&&n.traverse(e,t))}case Te().PICKING:{const n=this.getBrowser().getPickingHierarchy();return n.push(this),this.childNode.traverse(e,t),void n.pop()}case Te().COLLISION:return void this.childNode.traverse(e,t);case Te().DISPLAY:{const n=this.visibleNode;n&&n.traverse(e,t);const i=this.boundedObject;return void(i&&i.displayBBox(e,t))}}}});const Fe=De;function Ie(e){xe().call(this,e),this.addType(m().CADLayer)}Ie.prototype=Object.assign(Object.create(xe().prototype),{constructor:Ie,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"name",new(l().SFString)),new(d())(m().inputOutput,"visible",new(l().SFBool)(!0)),new(d())(m().inputOutput,"bboxDisplay",new(l().SFBool)),new(d())(m().initializeOnly,"bboxSize",new(l().SFVec3f)(-1,-1,-1)),new(d())(m().initializeOnly,"bboxCenter",new(l().SFVec3f)),new(d())(m().inputOnly,"addChildren",new(l().MFNode)),new(d())(m().inputOnly,"removeChildren",new(l().MFNode)),new(d())(m().inputOutput,"children",new(l().MFNode))]),getTypeName:function(){return"CADLayer"},getComponentName:function(){return"CADGeometry"},getContainerField:function(){return"children"}});const Oe=Ie,Ve=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Grouping/X3DTransformNode");var Ee=e.n(Ve);function Ae(e){Ee().call(this,e),be.call(this,e),this.addType(m().CADPart)}Ae.prototype=Object.assign(Object.create(Ee().prototype),{constructor:Ae,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"name",new(l().SFString)),new(d())(m().inputOutput,"translation",new(l().SFVec3f)),new(d())(m().inputOutput,"rotation",new(l().SFRotation)),new(d())(m().inputOutput,"scale",new(l().SFVec3f)(1,1,1)),new(d())(m().inputOutput,"scaleOrientation",new(l().SFRotation)),new(d())(m().inputOutput,"center",new(l().SFVec3f)),new(d())(m().inputOutput,"visible",new(l().SFBool)(!0)),new(d())(m().inputOutput,"bboxDisplay",new(l().SFBool)),new(d())(m().initializeOnly,"bboxSize",new(l().SFVec3f)(-1,-1,-1)),new(d())(m().initializeOnly,"bboxCenter",new(l().SFVec3f)),new(d())(m().inputOnly,"addChildren",new(l().MFNode)),new(d())(m().inputOnly,"removeChildren",new(l().MFNode)),new(d())(m().inputOutput,"children",new(l().MFNode))]),getTypeName:function(){return"CADPart"},getComponentName:function(){return"CADGeometry"},getContainerField:function(){return"children"}});const Pe=Ae,Be=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Rendering/X3DComposedGeometryNode");var Le=e.n(Be);function Xe(e){Le().call(this,e),this.addType(m().IndexedQuadSet)}Xe.prototype=Object.assign(Object.create(Le().prototype),{constructor:Xe,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOnly,"set_index",new(l().MFInt32)),new(d())(m().initializeOnly,"solid",new(l().SFBool)(!0)),new(d())(m().initializeOnly,"ccw",new(l().SFBool)(!0)),new(d())(m().initializeOnly,"colorPerVertex",new(l().SFBool)(!0)),new(d())(m().initializeOnly,"normalPerVertex",new(l().SFBool)(!0)),new(d())(m().initializeOnly,"index",new(l().MFInt32)),new(d())(m().inputOutput,"attrib",new(l().MFNode)),new(d())(m().inputOutput,"fogCoord",new(l().SFNode)),new(d())(m().inputOutput,"color",new(l().SFNode)),new(d())(m().inputOutput,"texCoord",new(l().SFNode)),new(d())(m().inputOutput,"normal",new(l().SFNode)),new(d())(m().inputOutput,"coord",new(l().SFNode))]),getTypeName:function(){return"IndexedQuadSet"},getComponentName:function(){return"CADGeometry"},getContainerField:function(){return"geometry"},initialize:function(){Le().prototype.initialize.call(this),this._set_index.addFieldInterest(this._index)},getTriangleIndex:function(){const e=[0,1,2,0,2,3];return function(t){const n=t%6;return(t-n)/6*4+e[n]}}(),getPolygonIndex:function(e){return this._index[e]},build:function(){let e=this._index.length;e-=e%4,Le().prototype.build.call(this,4,e,6,e/4*6)}});const Ue=Xe;function Me(e){Le().call(this,e),this.addType(m().QuadSet)}Me.prototype=Object.assign(Object.create(Le().prototype),{constructor:Me,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().initializeOnly,"solid",new(l().SFBool)(!0)),new(d())(m().initializeOnly,"ccw",new(l().SFBool)(!0)),new(d())(m().initializeOnly,"colorPerVertex",new(l().SFBool)(!0)),new(d())(m().initializeOnly,"normalPerVertex",new(l().SFBool)(!0)),new(d())(m().inputOutput,"attrib",new(l().MFNode)),new(d())(m().inputOutput,"fogCoord",new(l().SFNode)),new(d())(m().inputOutput,"color",new(l().SFNode)),new(d())(m().inputOutput,"texCoord",new(l().SFNode)),new(d())(m().inputOutput,"normal",new(l().SFNode)),new(d())(m().inputOutput,"coord",new(l().SFNode))]),getTypeName:function(){return"QuadSet"},getComponentName:function(){return"CADGeometry"},getContainerField:function(){return"geometry"},getTriangleIndex:function(){const e=[0,1,2,0,2,3];return function(t){const n=t%6;return(t-n)/6*4+e[n]}}(),build:function(){if(!this.getCoord())return;let e=this.getCoord().getSize();e-=e%4,Le().prototype.build.call(this,4,e,6,e/4*6)},createNormals:function(e,t){return this.createFaceNormals(e,t)}});const Re=Me;n().addComponent({name:"CADGeometry",types:{CADAssembly:ve,CADFace:Fe,CADLayer:Oe,CADPart:Pe,IndexedQuadSet:Ue,QuadSet:Re},abstractTypes:{X3DProductStructureChildNode:be}});const ze=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Texturing/X3DSingleTextureNode");var ke=e.n(ze);const je=new Uint8Array([255,255,255,255]);function Ge(e){ke().call(this,e),this.addType(m().X3DTexture3DNode);const t=this.getBrowser().getContext();this.target=t.TEXTURE_3D,this.width=0,this.height=0,this.depth=0,this.data=null}Ge.prototype=Object.assign(Object.create(ke().prototype),{constructor:Ge,initialize:function(){ke().prototype.initialize.call(this),this._repeatS.addInterest("updateTextureParameters",this),this._repeatT.addInterest("updateTextureParameters",this),this._repeatR.addInterest("updateTextureParameters",this);const e=this.getBrowser().getContext();e.getVersion()<2||(e.bindTexture(e.TEXTURE_3D,this.getTexture()),e.texImage3D(e.TEXTURE_3D,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,je))},getTarget:function(){return this.target},getTextureType:function(){return 3},getTextureTypeString:function(){return"3D"},getWidth:function(){return this.width},getHeight:function(){return this.height},getDepth:function(){return this.depth},getFlipY:function(){return!1},getData:function(){return this.data},clearTexture:function(){const e=this.getBrowser().getContext();this.setTexture(1,1,1,!1,e.RGBA,je),this.data=null},setTexture:function(e,t,n,i,o,r){this.width=e,this.height=t,this.depth=n,this.data=r;const s=this.getBrowser().getContext();s.getVersion()<2||(s.bindTexture(s.TEXTURE_3D,this.getTexture()),s.texImage3D(s.TEXTURE_3D,0,o,e,t,n,0,o,s.UNSIGNED_BYTE,r),this.setTransparent(i),this.updateTextureParameters(),this.addNodeEvent())},updateTextureParameters:function(){ke().prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,this.width,this.height,this._repeatS.getValue(),this._repeatT.getValue(),this._repeatR.getValue())},setShaderUniforms:function(e,t,n,i=t.x3d_Texture[0]){const o=this.getBrowser().getTexture3DUnit();e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_3D,this.getTexture()),e.uniform1i(i.texture3D,o)}});const qe=Ge;function He(e){qe.call(this,e),this.addType(m().ComposedTexture3D),this.addChildObjects("loadState",new(l().SFInt32)(m().NOT_STARTED_STATE)),this.textureNodes=[]}He.prototype=Object.assign(Object.create(qe.prototype),{constructor:He,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"description",new(l().SFString)),new(d())(m().initializeOnly,"repeatS",new(l().SFBool)),new(d())(m().initializeOnly,"repeatT",new(l().SFBool)),new(d())(m().initializeOnly,"repeatR",new(l().SFBool)),new(d())(m().initializeOnly,"textureProperties",new(l().SFNode)),new(d())(m().inputOutput,"texture",new(l().MFNode))]),getTypeName:function(){return"ComposedTexture3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texture"},initialize:function(){qe.prototype.initialize.call(this),this._texture.addInterest("set_texture__",this),this.set_texture__()},checkLoadState:function(){return this._loadState.getValue()},set_texture__:function(){const e=this.textureNodes;for(const t of e)t.removeInterest("update",this);e.length=0;for(const t of this._texture){const n=b()(m().X3DTexture2DNode,t);n&&e.push(n)}for(const t of e)t.addInterest("update",this);this.update()},update:function(){const e=this.textureNodes,t=e.every((function(e){return e.checkLoadState()===m().COMPLETE_STATE}));if(0!==e.length&&t){const t=this.getBrowser().getContext(),n=e[0],i=n.getWidth(),o=n.getHeight(),r=e.length,s=i*o*4,a=new Uint8Array(s*r);let l=0;for(let e=0,t=0;e<r;++e,t+=s){const n=this.textureNodes[e],r=n.getData();n.getWidth()===i&&n.getHeight()===o?(l+=n.getTransparent(),a.set(r,t)):console.log("ComposedTexture3D: all textures must have same size.")}this.setTexture(i,o,r,!!l,t.RGBA,a),this._loadState=m().COMPLETE_STATE}else this.clearTexture(),this._loadState=m().FAILED_STATE}});const Ye=He,Je=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Networking/X3DUrlObject");var We,Qe,Ke,Ze,$e=e.n(Je),et={NRRD:new RegExp("^NRRD(\\d+)\\n","gy"),field:new RegExp("([\\w\\s]+):\\s*(.+?)\\n","gy"),comment:new RegExp("#[^\\n]*\\n","gy"),newLine:new RegExp("\n","gy"),data:new RegExp("([^]*)$","gy")};function tt(e){return this.lastIndex=e.lastIndex,e.result=this.exec(e.input),!!e.result&&(e.lastIndex=this.lastIndex,!0)}for(var nt in et)et[nt].parse=tt;function it(){this.fieldFunction=new Map([["type",this.getType],["encoding",this.getEncoding],["dimension",this.getDimension],["sizes",this.getSizes],["endian",this.getEndian]])}it.prototype={parse:function(e){return this.setInput(e),this.getNRRD()&&(this.getFields(),this.getData()),this.nrrd},setInput:function(e){this.input=e,this.lastIndex=0,this.nrrd={},this.endian="little"},getNRRD:function(){return et.NRRD.parse(this)?(this.nrrd.nrrd=!0,this.nrrd.version=parseInt(this.result[1]),this.endian=this.getEndianess(),!0):(this.nrrd.nrrd=!1,!1)},getFields:function(){for(;et.comment.parse(this););for(;et.field.parse(this);){var e=this.result[1].toLowerCase(),t=this.result[2].trim().toLowerCase(),n=this.fieldFunction.get(e);for(n&&n.call(this,t);et.comment.parse(this););}},getType:(Ze=new Map([["signed char",["signed char",1]],["int8",["signed char",1]],["int8_t",["signed char",1]],["uchar",["unsigned char",1]],["unsigned char",["unsigned char",1]],["uint8",["unsigned char",1]],["uint8_t",["unsigned char",1]],["short",["signed short",2]],["short int",["signed short",2]],["signed short",["signed short",2]],["signed short int",["signed short",2]],["int16",["signed short",2]],["int16_t",["signed short",2]],["ushort",["unsigned short",2]],["unsigned short",["unsigned short",2]],["unsigned short int",["unsigned short",2]],["uint16",["unsigned short",2]],["uint16_t",["unsigned short",2]],["int",["signed int",4]],["signed int",["signed int",4]],["int32",["signed int",4]],["int32_t",["signed int",4]],["uint",["unsigned int",4]],["unsigned int",["unsigned int",4]],["uint32",["unsigned int",4]],["uint32_t",["unsigned int",4]],["float",["float",4]],["double",["double",8]]]),function(e){var t=Ze.get(e);if(void 0===t)throw new Error("Unsupported NRRD type '"+e+"'.");this.byteType=t[0],this.bytes=t[1]}),getEncoding:(Ke=new Map([["ascii","ascii"],["txt","ascii"],["text","ascii"],["raw","raw"],["hex","hex"],["gz","gzip"],["gzip","gzip"]]),function(e){var t=Ke.get(e);if(void 0===t)throw new Error("Unsupported NRRD encoding '"+e+"'.");this.encoding=t}),getDimension:function(e){var t=e.match(/(\d+)/),n=0;if(t)switch(n=parseInt(t[1])){case 1:case 2:case 3:case 4:return void(this.dimension=n)}throw new Error("Unsupported NRRD dimension '"+n+"', must be 1, 2, 3, or 4.")},getSizes:function(e){for(var t=new RegExp("\\s*(\\d+)","gy"),n=null,i=[];n=t.exec(e);)i.push(parseInt(n[1]));switch(i.length){case 1:return this.nrrd.components=1,this.nrrd.width=i[0],this.nrrd.height=1,void(this.nrrd.depth=1);case 2:return this.nrrd.components=1,this.nrrd.width=i[0],this.nrrd.height=i[1],void(this.nrrd.depth=1);case 3:return this.nrrd.components=1,this.nrrd.width=i[0],this.nrrd.height=i[1],void(this.nrrd.depth=i[2]);case 4:return this.nrrd.components=i[0],this.nrrd.width=i[1],this.nrrd.height=i[2],void(this.nrrd.depth=i[3]);default:throw new Error("Unsupported NRRD sizes.")}},getEndian:function(e){if("little"!==e&&"big"!==e)throw new Error("Unsupported NRRD endian, must be 'little' or 'big'.");this.endian=e},getData:function(){switch(this.encoding){case"ascii":this.ascii();break;case"raw":this.rawString(this.input);break;case"hex":this.hex();break;case"gzip":this.gzip()}},ascii:function(){var e=this.nrrd.components*this.nrrd.width*this.nrrd.height*this.nrrd.depth,t=new Uint8Array(e);if(this.nrrd.data=t,et.data.parse(this)){var n=this.result[1].trim().split(/\s+/);switch(this.byteType){case"signed char":case"unsigned char":return void n.forEach((function(e,n){t[n]=parseInt(e)}));case"signed short":case"unsigned short":return void n.forEach((function(e,n){t[n]=parseInt(e)/256}));case"signed int":case"unsigned int":return void n.forEach((function(e,n){t[n]=parseInt(e)/16777216}));case"float":return void n.forEach((function(e,n){t[n]=parseFloat(e)/256}));case"double":return void n.forEach((function(e,n){t[n]=parseFloat(e)/16777216}))}}},rawString:function(e){var t=this.nrrd.components*this.nrrd.width*this.nrrd.height*this.nrrd.depth,n=t*this.bytes,i=new Uint8Array(t);switch(this.nrrd.data=i,this.byteType){case"signed char":case"unsigned char":for(var o=e.length-n,r=0;o<e.length;++o,++r)i[r]=e.charCodeAt(o);return;case"signed short":case"unsigned short":if(this.getEndianess()===this.endian)var s=0,a=1;else s=1,a=0;for(o=e.length-n,r=0;o<e.length;o+=2,++r)i[r]=this.short2byte(e.charCodeAt(o+s),e.charCodeAt(o+a));return;case"signed int":case"unsigned int":if(this.getEndianess()===this.endian){s=0,a=1;var l=2,u=3}else s=3,a=2,l=1,u=0;for(o=e.length-n,r=0;o<e.length;o+=4,++r)i[r]=this.int2byte(e.charCodeAt(o+s),e.charCodeAt(o+a),e.charCodeAt(o+l),e.charCodeAt(o+u));return;case"float":if(this.getEndianess()===this.endian)s=0,a=1,l=2,u=3;else s=3,a=2,l=1,u=0;for(o=e.length-n,r=0;o<e.length;o+=4,++r)i[r]=this.float2byte(e.charCodeAt(o+s),e.charCodeAt(o+a),e.charCodeAt(o+l),e.charCodeAt(o+u));return;case"double":if(this.getEndianess()===this.endian){s=0,a=1,l=2,u=3;var d=4,c=5,h=6,f=7}else s=7,a=6,l=5,u=4,d=3,c=2,h=1,f=0;for(o=e.length-n,r=0;o<e.length;o+=8,++r)i[r]=this.double2byte(e.charCodeAt(o+s),e.charCodeAt(o+a),e.charCodeAt(o+l),e.charCodeAt(o+u),e.charCodeAt(o+d),e.charCodeAt(o+c),e.charCodeAt(o+h),e.charCodeAt(o+f));return}},rawArray:function(e){var t=this.nrrd.components*this.nrrd.width*this.nrrd.height*this.nrrd.depth,n=t*this.bytes,i=new Uint8Array(t);switch(this.nrrd.data=i,this.byteType){case"signed char":case"unsigned char":for(var o=e.length-n,r=0;o<e.length;++o,++r)i[r]=e[o];return;case"signed short":case"unsigned short":if(this.getEndianess()===this.endian)var s=0,a=1;else s=1,a=0;for(o=e.length-n,r=0;o<e.length;o+=2,++r)i[r]=this.short2byte(e[o+s],e[o+a]);return;case"signed int":case"unsigned int":if(this.getEndianess()===this.endian){s=0,a=1;var l=2,u=3}else s=3,a=2,l=1,u=0;for(o=e.length-n,r=0;o<e.length;o+=4,++r)i[r]=this.int2byte(e[o+s],e[o+a],e[o+l],e[o+u]);return;case"float":if(this.getEndianess()===this.endian)s=0,a=1,l=2,u=3;else s=3,a=2,l=1,u=0;for(o=e.length-n,r=0;o<e.length;o+=4,++r)i[r]=this.float2byte(e[o+s],e[o+a],e[o+l],e[o+u]);return;case"double":if(this.getEndianess()===this.endian){s=0,a=1,l=2,u=3;var d=4,c=5,h=6,f=7}else s=7,a=6,l=5,u=4,d=3,c=2,h=1,f=0;for(o=e.length-n,r=0;o<e.length;o+=8,++r)i[r]=this.double2byte(e[o+s],e[o+a],e[o+l],e[o+u],e[o+d],e[o+c],e[o+h],e[o+f]);return}},hex:function(){if(et.data.parse(this)){var e=this.result[1].match(/([0-9a-fA-F]{2})/g);if(e){var t=e.map((function(e){return parseInt(e,16)}));return void this.rawArray(t)}}throw new Error("Invalid NRRD data.")},gzip:function(){try{if(!et.newLine.parse(this))throw new Error("Invalid NRRD data.");et.data.parse(this);const e=this.binaryStringToBuffer(this.result[1]),t=pako.ungzip(e,{to:"raw"});this.rawArray(t)}catch(e){throw new Error("Invalid NRRD data.")}},binaryStringToBuffer:function(e){const t=new Uint8Array(e.length);for(let n=0,i=e.length;n<i;++n)t[n]=e.charCodeAt(n);return t},getEndianess:function(){var e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);if(t[0]=16909060,1==n[0]&&2==n[1]&&3==n[2]&&4==n[3])return"big";if(4==n[0]&&3==n[1]&&2==n[2]&&1==n[3])return"little";throw new Error("NRRD: unkown system endianess,")},short2byte:(We=new Uint8Array(2),Qe=new Uint16Array(We.buffer),function(e,t){return We[0]=e,We[1]=t,Qe[0]/256}),int2byte:function(){var e=new Uint8Array(4),t=new Uint32Array(e.buffer);return function(n,i,o,r){return e[0]=n,e[1]=i,e[2]=o,e[3]=r,t[0]/16777216}}(),float2byte:function(){var e=new Uint8Array(4),t=new Float32Array(e.buffer);return function(n,i,o,r){return e[0]=n,e[1]=i,e[2]=o,e[3]=r,t[0]/256}}(),double2byte:function(){var e=new Uint8Array(8),t=new Float64Array(e.buffer);return function(n,i,o,r,s,a,l,u){return e[0]=n,e[1]=i,e[2]=o,e[3]=r,e[4]=s,e[5]=a,e[6]=l,e[7]=u,t[0]/16777216}}()};const ot=it;var rt={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4};const st=function(){var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,n=799,i=3406,o=2276,r=1567,s=3784,a=5793,l=2896;function u(){}function d(e,t){for(var n,i,o=0,r=[],s=16;s>0&&!e[s-1];)s--;r.push({children:[],index:0});var a,l=r[0];for(n=0;n<s;n++){for(i=0;i<e[n];i++){for((l=r.pop()).children[l.index]=t[o];l.index>0;)l=r.pop();for(l.index++,r.push(l);r.length<=n;)r.push(a={children:[],index:0}),l.children[l.index]=a.children,l=a;o++}n+1<s&&(r.push(a={children:[],index:0}),l.children[l.index]=a.children,l=a)}return r[0].children}function c(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function h(t,n,i,o,r,s,a,l,u){i.precision,i.samplesPerLine,i.scanLines;var d=i.mcusPerLine,h=i.progressive,f=(i.maxH,i.maxV,n),p=0,g=0;function m(){if(g>0)return g--,p>>g&1;if(255==(p=t[n++])){var e=t[n++];if(e)throw"unexpected marker: "+(p<<8|e).toString(16)}return g=7,p>>>7}function _(e){for(var t,n=e;null!==(t=m());){if("number"==typeof(n=n[t]))return n;if("object"!=typeof n)throw"invalid huffman sequence"}return null}function y(e){for(var t=0;e>0;){var n=m();if(null===n)return;t=t<<1|n,e--}return t}function w(e){var t=y(e);return t>=1<<e-1?t:t+(-1<<e)+1}var x=0;var S,b=0;function N(e,t,n,i,o){var r=n%d;t(e,c(e,(n/d|0)*e.v+i,r*e.h+o))}function v(e,t,n){t(e,c(e,n/e.blocksPerLine|0,n%e.blocksPerLine))}var C,T,D,F,I,O,V=o.length;O=h?0===s?0===l?function(e,t){var n=_(e.huffmanTableDC),i=0===n?0:w(n)<<u;e.blockData[t]=e.pred+=i}:function(e,t){e.blockData[t]|=m()<<u}:0===l?function(t,n){if(x>0)x--;else for(var i=s,o=a;i<=o;){var r=_(t.huffmanTableAC),l=15&r,d=r>>4;if(0!==l){var c=e[i+=d];t.blockData[n+c]=w(l)*(1<<u),i++}else{if(d<15){x=y(d)+(1<<d)-1;break}i+=16}}}:function(t,n){for(var i=s,o=a,r=0;i<=o;){var l=e[i];switch(b){case 0:var d=_(t.huffmanTableAC),c=15&d;if(r=d>>4,0===c)r<15?(x=y(r)+(1<<r),b=4):(r=16,b=1);else{if(1!==c)throw"invalid ACn encoding";S=w(c),b=r?2:3}continue;case 1:case 2:t.blockData[n+l]?t.blockData[n+l]+=m()<<u:0==--r&&(b=2==b?3:0);break;case 3:t.blockData[n+l]?t.blockData[n+l]+=m()<<u:(t.blockData[n+l]=S<<u,b=0);break;case 4:t.blockData[n+l]&&(t.blockData[n+l]+=m()<<u)}i++}4===b&&0==--x&&(b=0)}:function(t,n){var i=_(t.huffmanTableDC),o=0===i?0:w(i);t.blockData[n]=t.pred+=o;for(var r=1;r<64;){var s=_(t.huffmanTableAC),a=15&s,l=s>>4;if(0!==a){var u=e[r+=l];t.blockData[n+u]=w(a),r++}else{if(l<15)break;r+=16}}};var E,A,P,B,L=0;for(A=1==V?o[0].blocksPerLine*o[0].blocksPerColumn:d*i.mcusPerColumn,r||(r=A);L<A;){for(T=0;T<V;T++)o[T].pred=0;if(x=0,1==V)for(C=o[0],I=0;I<r;I++)v(C,O,L),L++;else for(I=0;I<r;I++){for(T=0;T<V;T++)for(P=(C=o[T]).h,B=C.v,D=0;D<B;D++)for(F=0;F<P;F++)N(C,O,L,D,F);L++}if(g=0,(E=t[n]<<8|t[n+1])<=65280)throw"marker was not found";if(!(E>=65488&&E<=65495))break;n+=2}return n-f}function f(e,u,d){var c,h,f,p,g,m,_,y,w,x,S=e.quantizationTable;for(x=0;x<64;x++)d[x]=e.blockData[u+x]*S[x];for(x=0;x<8;++x){var b=8*x;0!==d[1+b]||0!==d[2+b]||0!==d[3+b]||0!==d[4+b]||0!==d[5+b]||0!==d[6+b]||0!==d[7+b]?(c=a*d[0+b]+128>>8,h=a*d[4+b]+128>>8,f=d[2+b],p=d[6+b],g=l*(d[1+b]-d[7+b])+128>>8,y=l*(d[1+b]+d[7+b])+128>>8,m=d[3+b]<<4,_=d[5+b]<<4,w=c-h+1>>1,c=c+h+1>>1,h=w,w=f*s+p*r+128>>8,f=f*r-p*s+128>>8,p=w,w=g-_+1>>1,g=g+_+1>>1,_=w,w=y+m+1>>1,m=y-m+1>>1,y=w,w=c-p+1>>1,c=c+p+1>>1,p=w,w=h-f+1>>1,h=h+f+1>>1,f=w,w=g*o+y*i+2048>>12,g=g*i-y*o+2048>>12,y=w,w=m*n+_*t+2048>>12,m=m*t-_*n+2048>>12,_=w,d[0+b]=c+y,d[7+b]=c-y,d[1+b]=h+_,d[6+b]=h-_,d[2+b]=f+m,d[5+b]=f-m,d[3+b]=p+g,d[4+b]=p-g):(w=a*d[0+b]+512>>10,d[0+b]=w,d[1+b]=w,d[2+b]=w,d[3+b]=w,d[4+b]=w,d[5+b]=w,d[6+b]=w,d[7+b]=w)}for(x=0;x<8;++x){var N=x;0!==d[8+N]||0!==d[16+N]||0!==d[24+N]||0!==d[32+N]||0!==d[40+N]||0!==d[48+N]||0!==d[56+N]?(c=a*d[0+N]+2048>>12,h=a*d[32+N]+2048>>12,f=d[16+N],p=d[48+N],g=l*(d[8+N]-d[56+N])+2048>>12,y=l*(d[8+N]+d[56+N])+2048>>12,m=d[24+N],_=d[40+N],w=c-h+1>>1,c=c+h+1>>1,h=w,w=f*s+p*r+2048>>12,f=f*r-p*s+2048>>12,p=w,w=g-_+1>>1,g=g+_+1>>1,_=w,w=y+m+1>>1,m=y-m+1>>1,y=w,w=c-p+1>>1,c=c+p+1>>1,p=w,w=h-f+1>>1,h=h+f+1>>1,f=w,w=g*o+y*i+2048>>12,g=g*i-y*o+2048>>12,y=w,w=m*n+_*t+2048>>12,m=m*t-_*n+2048>>12,_=w,d[0+N]=c+y,d[56+N]=c-y,d[8+N]=h+_,d[48+N]=h-_,d[16+N]=f+m,d[40+N]=f-m,d[24+N]=p+g,d[32+N]=p-g):(w=a*d[x+0]+8192>>14,d[0+N]=w,d[8+N]=w,d[16+N]=w,d[24+N]=w,d[32+N]=w,d[40+N]=w,d[48+N]=w,d[56+N]=w)}for(x=0;x<64;++x){var v=u+x,C=d[x];C=C<=-2056/e.bitConversion?0:C>=2024/e.bitConversion?255/e.bitConversion:C+2056/e.bitConversion>>4,e.blockData[v]=C}}function p(e,t){for(var n=t.blocksPerLine,i=t.blocksPerColumn,o=new Int32Array(64),r=0;r<i;r++)for(var s=0;s<n;s++){f(t,c(t,r,s),o)}return t.blockData}function g(e){return e<=0?0:e>=255?255:0|e}return u.prototype={load:function(e){var t=function(e){this.parse(e),this.onload&&this.onload()}.bind(this);if(e.indexOf("data:")>-1){for(var n=e.indexOf("base64,")+7,i=atob(e.substring(n)),o=new Uint8Array(i.length),r=i.length-1;r>=0;r--)o[r]=i.charCodeAt(r);t(i)}else{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){var e=new Uint8Array(s.response);t(e)}.bind(this),s.send(null)}},parse:function(t){function n(){var e=t[a]<<8|t[a+1];return a+=2,e}function i(){var e=n(),i=t.subarray(a,a+e-2);return a+=i.length,i}function o(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),i=0;i<e.components.length;i++){G=e.components[i];var o=Math.ceil(Math.ceil(e.samplesPerLine/8)*G.h/e.maxH),r=Math.ceil(Math.ceil(e.scanLines/8)*G.v/e.maxV),s=t*G.h,a=64*(n*G.v)*(s+1);G.blockData=new Int16Array(a),G.blocksPerLine=o,G.blocksPerColumn=r}e.mcusPerLine=t,e.mcusPerColumn=n}var r,s,a=0,l=(t.length,null),u=null,c=[],f=[],g=[],m=n();if(65496!=m)throw"SOI not found";for(m=n();65497!=m;){var _,y;switch(m){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=i();65504===m&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(l={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===m&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(u={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var x=n()+a-2;a<x;){var S=t[a++],b=new Int32Array(64);if(S>>4==0)for(_=0;_<64;_++){b[e[_]]=t[a++]}else{if(S>>4!=1)throw"DQT: invalid table spec";for(_=0;_<64;_++){b[e[_]]=n()}}c[15&S]=b}break;case 65472:case 65473:case 65474:if(r)throw"Only single frame JPEGs supported";n(),(r={}).extended=65473===m,r.progressive=65474===m,r.precision=t[a++],r.scanLines=n(),r.samplesPerLine=n(),r.components=[],r.componentIds={};var N,v=t[a++],C=0,T=0;for(j=0;j<v;j++){N=t[a];var D=t[a+1]>>4,F=15&t[a+1];C<D&&(C=D),T<F&&(T=F);var I=t[a+2];y=r.components.push({h:D,v:F,quantizationTable:c[I],quantizationTableId:I,bitConversion:255/((1<<r.precision)-1)}),r.componentIds[N]=y-1,a+=3}r.maxH=C,r.maxV=T,o(r);break;case 65476:var O=n();for(j=2;j<O;){var V=t[a++],E=new Uint8Array(16),A=0;for(_=0;_<16;_++,a++)A+=E[_]=t[a];var P=new Uint8Array(A);for(_=0;_<A;_++,a++)P[_]=t[a];j+=17+A,(V>>4==0?g:f)[15&V]=d(E,P)}break;case 65501:n(),s=n();break;case 65498:n();var B=t[a++],L=[];for(j=0;j<B;j++){var X=r.componentIds[t[a++]];G=r.components[X];var U=t[a++];G.huffmanTableDC=g[U>>4],G.huffmanTableAC=f[15&U],L.push(G)}var M=t[a++],R=t[a++],z=t[a++],k=h(t,a,r,L,s,M,R,z>>4,15&z);a+=k;break;case 65535:255!==t[a]&&a--;break;default:if(255==t[a-3]&&t[a-2]>=192&&t[a-2]<=254){a-=3;break}throw"unknown JPEG marker "+m.toString(16)}m=n()}switch(this.width=r.samplesPerLine,this.height=r.scanLines,this.jfif=l,this.adobe=u,this.components=[],r.components.length){case 1:this.colorspace=rt.Grayscale;break;case 3:this.adobe?this.colorspace=rt.AdobeRGB:this.colorspace=rt.RGB;break;case 4:this.colorspace=rt.CYMK;break;default:this.colorspace=rt.Unknown}for(var j=0;j<r.components.length;j++){var G;(G=r.components[j]).quantizationTable||null===G.quantizationTableId||(G.quantizationTable=c[G.quantizationTableId]),this.components.push({output:p(0,G),scaleX:G.h/r.maxH,scaleY:G.v/r.maxV,blocksPerLine:G.blocksPerLine,blocksPerColumn:G.blocksPerColumn,bitConversion:G.bitConversion})}},getData16:function(e,t){if(1!==this.components.length)throw"Unsupported color mode";var n,i,o,r,s,a,l=this.width/e,u=this.height/t,d=0,h=this.components.length,f=new Uint16Array(e*t*h),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(a=0;a<h;a++){for(var g,m,_,y=(n=this.components[a]).blocksPerLine,w=n.blocksPerColumn,x=y<<3,S=0,b=0;b<w;b++)for(var N=b<<3,v=0;v<y;v++){var C=c(n,b,v),T=(d=0,v<<3);for(g=0;g<8;g++){S=(N+g)*x;for(m=0;m<8;m++)p[S+T+m]=n.output[C+d++]}}for(i=n.scaleX*l,o=n.scaleY*u,d=a,s=0;s<t;s++)for(r=0;r<e;r++)_=(0|s*o)*x+(0|r*i),f[d]=p[_],d+=h}return f},getData:function(e,t){var n,i,o,r,s,a,l,u,d,h,f,p,m,_,y,w=this.width/e,x=this.height/t,S=0,b=this.components.length,N=e*t*b,v=new Uint8Array(N),C=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(a=0;a<b;a++){for(var T,D,F,I=(n=this.components[a]).blocksPerLine,O=n.blocksPerColumn,V=I<<3,E=0,A=0;A<O;A++)for(var P=A<<3,B=0;B<I;B++){var L=c(n,A,B),X=(S=0,B<<3);for(T=0;T<8;T++){E=(P+T)*V;for(D=0;D<8;D++)C[E+X+D]=n.output[L+S++]*n.bitConversion}}for(i=n.scaleX*w,o=n.scaleY*x,S=a,s=0;s<t;s++)for(r=0;r<e;r++)F=(0|s*o)*V+(0|r*i),v[S]=C[F],S+=b}switch(b){case 1:case 2:break;case 3:if(y=!0,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(a=0;a<N;a+=b)l=v[a],u=v[a+1],p=g(l-179.456+1.402*(d=v[a+2])),m=g(l+135.459-.344*u-.714*d),_=g(l-226.816+1.772*u),v[a]=p,v[a+1]=m,v[a+2]=_;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(y=!1,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(a=0;a<N;a+=b)l=v[a],u=v[a+1],h=g(434.456-l-1.402*(d=v[a+2])),f=g(119.541-l+.344*u+.714*d),l=g(481.816-l-1.772*u),v[a]=h,v[a+1]=f,v[a+2]=l;break;default:throw"Unsupported color mode"}return v}},u}();var at=void 0,lt=void 0;function ut(){this.dicom={dicom:!1}}ut.prototype={parse:function(e){try{for(var t=new Uint8Array(e.length),n=0,i=e.length;n<i;++n)t[n]=e.charCodeAt(n);this.dataSet=dicomParser.parseDicom(t),this.dicom.dicom=!0}catch(e){return console.error(e),this.dicom.dicom=!1,this.dicom}return this.getPhotometricInterpretation(),this.getComponents(),this.getWidth(),this.getHeight(),this.getDepth(),this.getBitsAllocated(),this.getBitsStored(),this.getPixelRepresentation(),this.getPlanarConfiguration(),this.getTansferSyntax(),this.getPixelData(),this.dicom},getPhotometricInterpretation:function(){this.photometricInterpretation=this.dataSet.string("x00280004")},getComponents:function(){this.dicom.components=this.dataSet.uint16("x00280002")},getWidth:function(){this.dicom.width=this.dataSet.uint16("x00280011")},getHeight:function(){this.dicom.height=this.dataSet.uint16("x00280010")},getDepth:function(){this.dataSet.elements.x00280008?this.dicom.depth=this.dataSet.intString("x00280008"):this.dicom.depth=1},getBitsAllocated:function(){this.bitsAllocated=this.dataSet.uint16("x00280100")},getBitsStored:function(){this.bitsStored=this.dataSet.uint16("x00280101")},getPixelRepresentation:function(){this.pixelRepresentation=this.dataSet.uint16("x00280103")||0},getPlanarConfiguration:function(){this.planarConfiguration=this.dataSet.uint16("x00280006")||0},getTansferSyntax:function(){this.transferSyntax=this.dataSet.string("x00020010")},getPixelData:function(){var e=this.dicom,t=this.dataSet.elements.x7fe00010||this.dataSet.elements.x7fe00008,n="PALETTE COLOR"===this.photometricInterpretation?3:this.dicom.components,i=e.width*e.height*n,o=i*e.depth,r=new Uint8Array(o);if(this.getFrames(t).forEach((function(e,t){switch(this.transferSyntax){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":case"1.2.840.10008.1.2.1.99":e=this.decodeLittleEndian(e);break;case"1.2.840.10008.1.2.2":e=this.decodeBigEndian(e);break;case"1.2.840.10008.1.2.5":e=this.decodeRLE(e);break;case"1.2.840.10008.1.2.4.50":case"1.2.840.10008.1.2.4.51":e=this.decodeJPEGBaseline(e);break;case"1.2.840.10008.1.2.4.57":case"1.2.840.10008.1.2.4.70":e=this.decodeJPEGLossless(e);break;case"1.2.840.10008.1.2.4.80":case"1.2.840.10008.1.2.4.81":e=this.decodeJPEGLS(e);break;case"1.2.840.10008.1.2.4.90":case"1.2.840.10008.1.2.4.91":e=this.decodeJPEG2000(e);break;case"1.2.840.10008.1.2.4.52":case"1.2.840.10008.1.2.4.53":case"1.2.840.10008.1.2.4.54":case"1.2.840.10008.1.2.4.55":case"1.2.840.10008.1.2.4.56":case"1.2.840.10008.1.2.4.58":case"1.2.840.10008.1.2.4.59":case"1.2.840.10008.1.2.4.60":case"1.2.840.10008.1.2.4.61":case"1.2.840.10008.1.2.4.62":case"1.2.840.10008.1.2.4.63":case"1.2.840.10008.1.2.4.64":case"1.2.840.10008.1.2.4.65":case"1.2.840.10008.1.2.4.66":case"1.2.840.10008.1.2.4.92":case"1.2.840.10008.1.2.4.93":throw new Error("DICOM: this JPEG encoding ("+this.transferSyntax+") is not supported.");default:throw new Error("DICOM: unsupported transfer syntax '"+this.transferSyntax+"'.")}if(e=this.getTypedArray(e),1===this.pixelRepresentation&&void 0!==this.bitsStored)for(var o=32-this.bitsStored,s=0,a=e.length;s<a;++s)e[s]=e[s]<<o>>o;switch(this.photometricInterpretation){case"MONOCHROME1":case"MONOCHROME2":break;case"RGB":case"YBR_RCT":case"YBR_ICT":case"YBR_FULL_422":1===this.planarConfiguration&&(e=this.convertRGBColorByPlane(e));break;case"YBR_FULL":e=0===this.planarConfiguration?this.convertYBRFullByPixel(e):this.convertYBRFullByPlane(e);break;case"PALETTE COLOR":e=this.convertPaletteColor(e);break;default:throw new Error("DICOM: unsupported image type '"+this.photometricInterpretation+"'.")}e=this.flipImage(e,n);var l=this.getNormalizeOffsetAndFactor(e),u=t*i;for(s=0,a=e.length;s<a;++s,++u)r[u]=(e[s]-l.offset)*l.factor}),this),"MONOCHROME1"===this.photometricInterpretation)for(var s=0,a=r.length;s<a;++s)r[s]=255-r[s];e.components=n,e.data=r},getFrames:function(e){var t=[];if(e.encapsulatedPixelData)if(e.basicOffsetTable.length)for(var n=0,i=this.dicom.depth;n<i;++n)t.push(dicomParser.readEncapsulatedImageFrame(this.dataSet,e,n));else if(this.dicom.depth!==e.fragments.length){var o=dicomParser.createJPEGBasicOffsetTable(this.dataSet,e);for(n=0,i=this.dicom.depth;n<i;++n)t.push(dicomParser.readEncapsulatedImageFrame(this.dataSet,e,n,o))}else for(n=0,i=this.dicom.depth;n<i;++n)t.push(dicomParser.readEncapsulatedPixelDataFromFragments(this.dataSet,e,n));else{var r=this.dicom.width*this.dicom.height*this.dicom.components;switch(this.bitsAllocated){case 1:for(n=0,i=this.dicom.depth;n<i;++n){var s=e.dataOffset+n*r/8;t.push(this.unpackBinaryFrame(this.dataSet.byteArray,s,r))}this.bitsAllocated=8;break;case 8:case 16:case 32:var a=this.bitsAllocated/8;for(n=0,i=this.dicom.depth;n<i;++n){s=e.dataOffset+n*r*a;t.push(new Uint8Array(this.dataSet.byteArray.buffer,s,r*a))}break;default:throw new Error("DICOM: unsupported pixel format.")}}return t},getTypedArray:function(e){switch(this.bitsAllocated){case 8:return new(this.pixelRepresentation?Int8Array:Uint8Array)(e.buffer,e.byteOffset,e.length);case 16:return new(this.pixelRepresentation?Int16Array:Uint16Array)(e.buffer,e.byteOffset,e.length/2);case 32:return new Float32Array(e.buffer,e.byteOffset,e.length/4);default:throw new Error("DICOM: unsupported pixel format.")}},flipImage:function(e,t){for(var n=this.dicom.width,i=this.dicom.height,o=new e.constructor(e.length),r=0;r<i;++r)for(var s=t*n*(i-1-r),a=t*n*r,l=0,u=t*n;l<u;++l)o[a+l]=e[s+l];return o},getNormalizeOffsetAndFactor:function(e){for(var t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=0,o=e.length;i<o;++i)t=Math.min(t,e[i]),n=Math.max(n,e[i]);var r=n-t;return{offset:t,factor:r?1/r*255:0}},unpackBinaryFrame:function(e,t,n){function i(e,t){return e&1<<t}for(var o=new Uint8Array(n),r=0;r<n;++r){var s=e[Math.floor(r/8)+t],a=r%8;o[r]=i(s,a)?1:0}return o},decodeLittleEndian:function(e){var t=e.buffer,n=e.byteOffset,i=e.length;return 16===this.bitsAllocated?(n%2&&(t=t.slice(n),n=0),new Uint8Array(t,n,i)):32===this.bitsAllocated?(n%4&&(t=t.slice(n),n=0),new Uint8Array(t,n,i)):e},decodeBigEndian:function(e){if(16===this.bitsAllocated){var t=e.buffer,n=e.byteOffset,i=e.length;n%2&&(t=t.slice(n),n=0);for(var o=0,r=(e=new Uint16Array(t,n,i/2)).length;o<r;++o)e[o]=(255&(s=e[o]))<<8|s>>8&255;return new Uint8Array(t,n,i)}var s;return e},decodeRLE:function(e){if(8===this.bitsAllocated)return this.planarConfiguration?this.decodeRLE8Planar(e):this.decodeRLE8(e);if(16===this.bitsAllocated)return this.decodeRLE16(e);throw new Error("DICOM: unsupported pixel format for RLE.")},decodeRLE8:function(e){const t=e,n=this.dicom.width*this.dicom.height,i=this.dicom.components,o=new ArrayBuffer(n*this.dicom.components),r=new DataView(t.buffer,t.byteOffset),s=new Int8Array(t.buffer,t.byteOffset),a=new Int8Array(o);let l=0;const u=r.getInt32(0,!0);for(let e=0;e<u;++e){l=e;let o=r.getInt32(4*(e+1),!0),d=r.getInt32(4*(e+2),!0);0===d&&(d=t.length);const c=n*u;for(;o<d;){const e=s[o++];if(e>=0&&e<=127)for(let t=0;t<e+1&&l<c;++t)a[l]=s[o++],l+=i;else if(e<=-1&&e>=-127){const t=s[o++];for(let n=0;n<1-e&&l<c;++n)a[l]=t,l+=i}}}return a},decodeRLE8Planar:function(e){const t=e,n=this.dicom.width*this.dicom.height,i=new ArrayBuffer(n*this.dicom.components),o=new DataView(t.buffer,t.byteOffset),r=new Int8Array(t.buffer,t.byteOffset),s=new Int8Array(i);let a=0;const l=o.getInt32(0,!0);for(let e=0;e<l;++e){a=e*n;let i=o.getInt32(4*(e+1),!0),u=o.getInt32(4*(e+2),!0);0===u&&(u=t.length);const d=n*l;for(;i<u;){const e=r[i++];if(e>=0&&e<=127)for(let t=0;t<e+1&&a<d;++t)s[a]=r[i++],++a;else if(e<=-1&&e>=-127){const t=r[i++];for(let n=0;n<1-e&&a<d;++n)s[a]=t,++a}}}return s},decodeRLE16:function(e){const t=e,n=this.dicom.width*this.dicom.height,i=new ArrayBuffer(n*this.dicom.components*2),o=new DataView(t.buffer,t.byteOffset),r=new Int8Array(t.buffer,t.byteOffset),s=new Int8Array(i),a=o.getInt32(0,!0);for(let e=0;e<a;++e){let i=0;const a=0===e?1:0;let l=o.getInt32(4*(e+1),!0),u=o.getInt32(4*(e+2),!0);for(0===u&&(u=t.length);l<u;){const e=r[l++];if(e>=0&&e<=127)for(let t=0;t<e+1&&i<n;++t)s[2*i+a]=r[l++],++i;else if(e<=-1&&e>=-127){const t=r[l++];for(let o=0;o<1-e&&i<n;++o)s[2*i+a]=t,++i}}}return s},decodeJPEGBaseline:function(e){var t=new st;t.parse(e),t.colorTransform=!0;var n=t.getData(this.dicom.width,this.dicom.height);return this.bitsAllocated=8,n},decodeJPEGLossless:function(e){var t=(new jpegLossless.lossless.Decoder).decompress(e);return new Uint8Array(t)},decodeJPEGLS:function(e){var t=this.jpegLSDecode(e,1===this.pixelRepresentation);if(0!==t.result&&6!==t.result)throw new Error(`DICOM: JPEG-LS decoder failed to decode frame (error code ${t.result}).`);return new Uint8Array(t.pixelData.buffer)},jpegLSDecode:function(e,t){const n=(at=at||CharLS())._malloc(e.length);at.writeArrayToMemory(e,n);const i=at._malloc(4),o=at._malloc(4),r=at._malloc(4),s=at._malloc(4),a=at._malloc(4),l=at._malloc(4),u=at._malloc(4),d=at._malloc(4),c=at._malloc(4),h={result:at.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[n,e.length,i,o,r,s,a,l,d,u,c]),width:at.getValue(r,"i32"),height:at.getValue(s,"i32"),bitsPerSample:at.getValue(a,"i32"),stride:at.getValue(l,"i32"),components:at.getValue(d,"i32"),allowedLossyError:at.getValue(u,"i32"),interleaveMode:at.getValue(c,"i32"),pixelData:void 0},f=at.getValue(i,"*");return h.bitsPerSample<=8?(h.pixelData=new Uint8Array(h.width*h.height*h.components),h.pixelData.set(new Uint8Array(at.HEAP8.buffer,f,h.pixelData.length))):t?(h.pixelData=new Int16Array(h.width*h.height*h.components),h.pixelData.set(new Int16Array(at.HEAP16.buffer,f,h.pixelData.length))):(h.pixelData=new Uint16Array(h.width*h.height*h.components),h.pixelData.set(new Uint16Array(at.HEAP16.buffer,f,h.pixelData.length))),at._free(n),at._free(f),at._free(i),at._free(o),at._free(r),at._free(s),at._free(a),at._free(l),at._free(d),at._free(c),h},decodeJPEG2000:function(e){var t=this.bitsAllocated<=8?1:2,n=1===this.pixelRepresentation,i=this.decodeOpenJPEG(e,t,n);return i.nbChannels>1&&(this.photometricInterpretation="RGB"),new Uint8Array(i.pixelData.buffer)},decodeOpenJPEG:function(e,t,n){const i=(lt=lt||OpenJPEG())._malloc(e.length);lt.writeArrayToMemory(e,i);const o=lt._malloc(4),r=lt._malloc(4),s=lt._malloc(4),a=lt._malloc(4),l=lt._malloc(4),u=(new Date).getTime();if(0!==lt.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[i,e.length,o,r,s,a,l]))return console.log("[opj_decode] decoding failed!"),lt._free(i),lt._free(lt.getValue(o,"*")),lt._free(s),lt._free(a),lt._free(r),void lt._free(l);const d=lt.getValue(o,"*"),c={length:lt.getValue(r,"i32"),sx:lt.getValue(s,"i32"),sy:lt.getValue(a,"i32"),nbChannels:lt.getValue(l,"i32"),perf_timetodecode:void 0,pixelData:void 0},h=c.sx*c.sy*c.nbChannels,f=new Int32Array(lt.HEAP32.buffer,d,h);if(1===t)if(Uint8Array.from)c.pixelData=Uint8Array.from(f);else{c.pixelData=new Uint8Array(h);for(let e=0;e<h;e++)c.pixelData[e]=f[e]}else if(n)if(Int16Array.from)c.pixelData=Int16Array.from(f);else{c.pixelData=new Int16Array(h);for(let e=0;e<h;e++)c.pixelData[e]=f[e]}else if(Uint16Array.from)c.pixelData=Uint16Array.from(f);else{c.pixelData=new Uint16Array(h);for(let e=0;e<h;e++)c.pixelData[e]=f[e]}const p=(new Date).getTime();return c.perf_timetodecode=p-u,lt._free(i),lt._free(o),lt._free(d),lt._free(r),lt._free(s),lt._free(a),lt._free(l),c},convertRGBColorByPlane:function(e){if(e.length%3!=0)throw new Error("DICOM: convertRGBColorByPlane: RGB buffer length must be divisble by 3.");for(var t=e.length/3,n=0,i=0,o=t,r=2*t,s=new e.constructor(e.length),a=0;a<t;++a)s[n++]=e[i++],s[n++]=e[o++],s[n++]=e[r++];return s},convertYBRFullByPixel:function(e){if(e.length%3!=0)throw new Error("DICOM: convertYBRFullByPixel: YBR buffer length must be divisble by 3.");console.log(e);for(var t=e.length/3,n=0,i=0,o=new e.constructor(e.length),r=0;r<t;++r){var s=e[n++],a=e[n++],l=e[n++];o[i++]=s+1.402*(l-128),o[i++]=s-.34414*(a-128)-.71414*(l-128),o[i++]=s+1.772*(a-128)}return o},convertYBRFullByPlane:function(e){if(e.length%3!=0)throw new Error("DICOM: convertYBRFullByPlane: YBR buffer length must be divisble by 3.");for(var t=e.length/3,n=0,i=0,o=t,r=2*t,s=new e.constructor(e.length),a=0;a<t;++a){var l=e[i++],u=e[o++],d=e[r++];s[n++]=l+1.402*(d-128),s[n++]=l-.34414*(u-128)-.71414*(d-128),s[n++]=l+1.772*(u-128)}return s},convertPaletteColor:function(e){function t(e,t){if(e.cleaned)return e.cleaned;const n=e.length,i=new Uint8ClampedArray(n);for(let o=0;o<n;++o)i[o]=e[o]>>t;return e.cleaned=i,i}const n=this.getLUT(),i=this.dicom.width*this.dicom.height,o=n.redPaletteColorLookupTableData,r=n.greenPaletteColorLookupTableData,s=n.bluePaletteColorLookupTableData,a=n.redPaletteColorLookupTableData.length;let l=0,u=0;const d=n.redPaletteColorLookupTableDescriptor[1],c=8===n.redPaletteColorLookupTableDescriptor[2]?0:8,h=t(o,c),f=t(r,c),p=t(s,c);let g=new Uint8Array(3*e.length);for(let t=0;t<i;++t){let t=e[l++];t<d?t=0:t>d+a-1?t=a-1:t-=d,g[u++]=h[t],g[u++]=f[t],g[u++]=p[t]}return g},getLUT:function(){return this.LUT||(this.LUT={},this.populatePaletteColorLut(this.dataSet,this.LUT)),this.LUT},populatePaletteColorLut:function(e,t){t.redPaletteColorLookupTableDescriptor=this.getLutDescriptor(e,"x00281101"),t.greenPaletteColorLookupTableDescriptor=this.getLutDescriptor(e,"x00281102"),t.bluePaletteColorLookupTableDescriptor=this.getLutDescriptor(e,"x00281103"),0===t.redPaletteColorLookupTableDescriptor[0]&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);const n=t.redPaletteColorLookupTableDescriptor[0],i=e.elements.x00281201.length===n?8:16;t.redPaletteColorLookupTableDescriptor[2]!==i&&(t.redPaletteColorLookupTableDescriptor[2]=i,t.greenPaletteColorLookupTableDescriptor[2]=i,t.bluePaletteColorLookupTableDescriptor[2]=i),t.redPaletteColorLookupTableData=this.getLutData(e,"x00281201",t.redPaletteColorLookupTableDescriptor),t.greenPaletteColorLookupTableData=this.getLutData(e,"x00281202",t.greenPaletteColorLookupTableDescriptor),t.bluePaletteColorLookupTableData=this.getLutData(e,"x00281203",t.bluePaletteColorLookupTableDescriptor)},getLutDescriptor:function(e,t){if(e.elements[t]&&6===e.elements[t].length)return[e.uint16(t,0),e.uint16(t,1),e.uint16(t,2)]},getLutData:function(e,t,n){const i=[],o=e.elements[t];for(let r=0;r<n[0];++r)16===n[2]?i[r]=e.uint16(t,r):i[r]=e.byteArray[r+o.dataOffset];return i}};const dt=ut,ct=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/InputOutput/FileLoader");var ht=e.n(ct);function ft(e){qe.call(this,e),$e().call(this,e),this.addType(m().ImageTexture3D)}ft.prototype=Object.assign(Object.create(qe.prototype),$e().prototype,{constructor:ft,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"description",new(l().SFString)),new(d())(m().inputOutput,"load",new(l().SFBool)(!0)),new(d())(m().inputOutput,"url",new(l().MFString)),new(d())(m().inputOutput,"autoRefresh",new(l().SFTime)),new(d())(m().inputOutput,"autoRefreshTimeLimit",new(l().SFTime)(3600)),new(d())(m().initializeOnly,"repeatS",new(l().SFBool)),new(d())(m().initializeOnly,"repeatT",new(l().SFBool)),new(d())(m().initializeOnly,"repeatR",new(l().SFBool)),new(d())(m().initializeOnly,"textureProperties",new(l().SFNode))]),getTypeName:function(){return"ImageTexture3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texture"},initialize:function(){qe.prototype.initialize.call(this),$e().prototype.initialize.call(this),this.requestImmediateLoad()},getInternalType:function(e){const t=this.getBrowser().getContext();switch(e){case 1:return t.LUMINANCE;case 2:return t.LUMINANCE_ALPHA;case 3:return t.RGB;case 4:return t.RGBA}},unLoadNow:function(){this.clearTexture()},loadNow:function(){new(ht())(this).loadBinaryDocument(this._url,function(e){if(null!==e){const t=(new ot).parse(e);if(t.nrrd){const e=this.getInternalType(t.components);return this.setTexture(t.width,t.height,t.depth,!1,e,t.data),void this.setLoadState(m().COMPLETE_STATE)}const n=(new dt).parse(e);if(n.dicom){const e=this.getInternalType(n.components);return this.setTexture(n.width,n.height,n.depth,!1,e,n.data),void this.setLoadState(m().COMPLETE_STATE)}throw new Error("ImageTexture3D: no appropriate file type handler found.")}this.setLoadState(m().FAILED_STATE),this.clearTexture()}.bind(this))}});const pt=ft;function gt(e){qe.call(this,e),this.addType(m().PixelTexture3D),this.addChildObjects("loadState",new(l().SFInt32)(m().NOT_STARTED_STATE))}gt.prototype=Object.assign(Object.create(qe.prototype),{constructor:gt,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"description",new(l().SFString)),new(d())(m().inputOutput,"image",new(l().MFInt32)(0,0,0,0)),new(d())(m().initializeOnly,"repeatS",new(l().SFBool)),new(d())(m().initializeOnly,"repeatT",new(l().SFBool)),new(d())(m().initializeOnly,"repeatR",new(l().SFBool)),new(d())(m().initializeOnly,"textureProperties",new(l().SFNode))]),getTypeName:function(){return"PixelTexture3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texture"},initialize:function(){qe.prototype.initialize.call(this),this._image.addInterest("set_image__",this),this.set_image__()},checkLoadState:function(){return this._loadState.getValue()},set_image__:function(){const e=this._image;if(e.length<4)return this.clearTexture(),void(this._loadState=m().FAILED_STATE);const t=this.getBrowser().getContext(),n=e[0],i=e[1],o=e[2],r=e[3],s=!(1&n),a=i*o*r;let l,u;switch(n){case 1:l=new Uint8Array(a),u=t.LUMINANCE;for(let t=4,n=4+a,i=0;t<n;++t)l[i++]=e[t];break;case 2:l=new Uint8Array(2*a),u=t.LUMINANCE_ALPHA;for(let t=4,n=4+a,i=0;t<n;++t){const n=e[t];l[i++]=n>>>8&255,l[i++]=255&n}break;case 3:l=new Uint8Array(3*a),u=t.RGB;for(let t=4,n=4+a,i=0;t<n;++t){const n=e[t];l[i++]=n>>>16&255,l[i++]=n>>>8&255,l[i++]=255&n}break;case 4:l=new Uint8Array(4*a),u=t.RGBA;for(let t=4,n=4+a,i=0;t<n;++t){const n=e[t];l[i++]=n>>>24&255,l[i++]=n>>>16&255,l[i++]=n>>>8&255,l[i++]=255&n}break;default:return this.clearTexture(),void(this._loadState=m().FAILED_STATE)}this.setTexture(i,o,r,s,u,l),this._loadState=m().COMPLETE_STATE}});const mt=gt,_t=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Texturing/X3DSingleTextureCoordinateNode");var yt=e.n(_t);window[Symbol.for("X_ITE.X3D-7.0.0")].require("standard/Math/Numbers/Vector4");function wt(e){yt().call(this,e),this.addType(m().TextureCoordinate3D)}wt.prototype=Object.assign(Object.create(yt().prototype),{constructor:wt,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"mapping",new(l().SFString)),new(d())(m().inputOutput,"point",new(l().MFVec3f))]),getTypeName:function(){return"TextureCoordinate3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texCoord"},initialize:function(){yt().prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(e,t){if(e>=0&&e<this.length){const n=this.point;return e*=3,t.set(n[e],n[e+1],n[e+2],1)}if(e>=0&&this.length){const n=this.point;return e%=this.length,e*=3,t.set(n[e],n[e+1],n[e+2],1)}return t.set(0,0,0,1)},addTexCoordToChannel:function(e,t){if(e>=0&&e<this.length){const n=this.point;e*=3,t.push(n[e],n[e+1],n[e+2],1)}else if(e>=0&&this.length){const n=this.point;e%=this.length,e*=3,t.push(n[e],n[e+1],n[e+2],1)}else t.push(0,0,0,1)},getTexCoord:function(e){const t=this.point,n=this.length;for(let i=0,o=0;i<n;++i,o+=3)e.push(t[o],t[o+1],t[o+2],1);return e}});const xt=wt;function St(e){yt().call(this,e),this.addType(m().TextureCoordinate4D)}St.prototype=Object.assign(Object.create(yt().prototype),{constructor:St,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"mapping",new(l().SFString)),new(d())(m().inputOutput,"point",new(l().MFVec4f))]),getTypeName:function(){return"TextureCoordinate4D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texCoord"},initialize:function(){yt().prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(e,t){if(e>=0&&e<this.length){const n=this.point;return e*=4,t.set(n[e],n[e+1],n[e+2],n[e+3])}if(e>=0&&this.length){const n=this.point;return e%=this.length,e*=4,t.set(n[e],n[e+1],n[e+2],n[e+3])}return t.set(0,0,0,1)},addTexCoordToChannel:function(e,t){if(e>=0&&e<this.length){const n=this.point;e*=4,t.push(n[e],n[e+1],n[e+2],n[e+3])}else if(e>=0&&this.length){const n=this.point;e%=this.length,e*=4,t.push(n[e],n[e+1],n[e+2],n[e+3])}else t.push(0,0,0,1)},getTexCoord:function(e){const t=this.point,n=this.length;for(let i=0,o=0;i<n;++i,o+=4)e.push(t[o],t[o+1],t[o+2],t[o+3]);return e}});const bt=St,Nt=window[Symbol.for("X_ITE.X3D-7.0.0")].require("x_ite/Components/Texturing/X3DSingleTextureTransformNode");var vt=e.n(Nt);const Ct=window[Symbol.for("X_ITE.X3D-7.0.0")].require("standard/Math/Numbers/Rotation4");var Tt=e.n(Ct);const Dt=window[Symbol.for("X_ITE.X3D-7.0.0")].require("standard/Math/Numbers/Matrix4");var Ft=e.n(Dt);function It(e){vt().call(this,e),this.addType(m().TextureTransform3D),this.matrix=new(Ft())}It.prototype=Object.assign(Object.create(vt().prototype),{constructor:It,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"mapping",new(l().SFString)),new(d())(m().inputOutput,"translation",new(l().SFVec3f)),new(d())(m().inputOutput,"rotation",new(l().SFRotation)),new(d())(m().inputOutput,"scale",new(l().SFVec3f)(1,1,1)),new(d())(m().inputOutput,"center",new(l().SFVec3f))]),getTypeName:function(){return"TextureTransform3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"textureTransform"},initialize:function(){vt().prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},getMatrix:function(){return this.matrix},eventsProcessed:function(){const e=new(Z())(0,0,0);return function(){const t=this._translation.getValue(),n=this._rotation.getValue(),i=this._scale.getValue(),o=this._center.getValue(),r=this.matrix;r.identity(),o.equals(Z().Zero)||r.translate(e.assign(o).negate()),i.equals(Z().One)||r.scale(i),n.equals(Tt().Identity)||r.rotate(n),o.equals(Z().Zero)||r.translate(o),t.equals(Z().Zero)||r.translate(t),this.setMatrix(r)}}()});const Ot=It;function Vt(e){vt().call(this,e),this.addType(m().TextureTransformMatrix3D)}Vt.prototype=Object.assign(Object.create(vt().prototype),{constructor:Vt,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new(h())([new(d())(m().inputOutput,"metadata",new(l().SFNode)),new(d())(m().inputOutput,"mapping",new(l().SFString)),new(d())(m().inputOutput,"matrix",new(l().SFMatrix4f))]),getTypeName:function(){return"TextureTransformMatrix3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"textureTransform"},initialize:function(){vt().prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},getMatrix:function(){return this._matrix.getValue()},eventsProcessed:function(){this.setMatrix(this._matrix.getValue())}});const Et=Vt;n().addComponent({name:"Texturing3D",types:{ComposedTexture3D:Ye,ImageTexture3D:pt,PixelTexture3D:mt,TextureCoordinate3D:xt,TextureCoordinate4D:bt,TextureTransform3D:Ot,TextureTransformMatrix3D:Et},abstractTypes:{X3DTexture3DNode:qe}});n().addComponent({name:"VolumeRendering",types:{BlendedVolumeStyle:E,BoundaryEnhancementVolumeStyle:P,CartoonVolumeStyle:L,ComposedVolumeStyle:U,EdgeEnhancementVolumeStyle:R,IsoSurfaceVolumeData:se,OpacityMapVolumeStyle:v,ProjectionVolumeStyle:le,SegmentedVolumeData:de,ShadedVolumeStyle:he,SilhouetteEnhancementVolumeStyle:pe,ToneMappedVolumeStyle:me,VolumeData:ye},abstractTypes:{X3DComposableVolumeRenderStyleNode:x,X3DVolumeDataNode:ee,X3DVolumeRenderStyleNode:y},browserContext:O})})();