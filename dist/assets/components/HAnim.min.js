/* X_ITE v8.10.1 */(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components");var n=e.n(t);const i=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Fields");var s=e.n(i);const o=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Base/X3DFieldDefinition");var r=e.n(o);const a=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Base/FieldDefinitionArray");var d=e.n(a);const u=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Rendering/X3DGeometricPropertyNode");var l=e.n(u);const p=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Base/X3DConstants");var h=e.n(p);const _=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Namespace");var c=e.n(_);function m(e){l().call(this,e),this.addType(h().HAnimDisplacer),this._displacements.setUnit("length")}Object.setPrototypeOf(m.prototype,l().prototype),Object.defineProperties(m,{typeName:{value:"HAnimDisplacer",enumerable:!0},componentName:{value:"HAnim",enumerable:!0},containerField:{value:"displacers",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new(d())([new(r())(h().inputOutput,"metadata",new(s().SFNode)),new(r())(h().inputOutput,"description",new(s().SFString)),new(r())(h().inputOutput,"name",new(s().SFString)),new(r())(h().inputOutput,"coordIndex",new(s().MFInt32)),new(r())(h().inputOutput,"weight",new(s().SFFloat)),new(r())(h().inputOutput,"displacements",new(s().MFVec3f))]),enumerable:!0}});const w=m;c().set("x_ite/Components/HAnim/HAnimDisplacer",w);const f=w,g=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Core/X3DChildNode");var F=e.n(g);const T=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Grouping/Group");var b=e.n(T);const x=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Grouping/Transform");var I=e.n(x);const O=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Grouping/X3DBoundedObject");var S=e.n(O);const v=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Rendering/TraverseType");var N=e.n(v);const y=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Base/X3DCast");var E=e.n(y);const M=window[Symbol.for("X_ITE.X3D-8.10.1")].require("standard/Math/Numbers/Matrix4");var D=e.n(M);function j(e){F().call(this,e),S().call(this,e),this.addType(h().HAnimHumanoid),this.addChildObjects(h().inputOutput,"jointTextures",new(s().SFTime),h().inputOutput,"displacementsTexture",new(s().SFTime),h().inputOutput,"displacementWeightsTexture",new(s().SFTime)),this._translation.setUnit("length"),this._center.setUnit("length"),this._bboxSize.setUnit("length"),this._bboxCenter.setUnit("length"),this.skeletonNode=new(b())(e),this.viewpointsNode=new(b())(e),this.skinNode=new(b())(e),this.transformNode=new(I())(e),this.motionNodes=[],this.jointNodes=[],this.jointBindingMatrices=[],this.displacementWeights=[],this.skinCoordNode=null,this.change=new C,this.skinning=Function.prototype}Object.assign(Object.setPrototypeOf(j.prototype,F().prototype),S().prototype,{initialize(){F().prototype.initialize.call(this),S().prototype.initialize.call(this),this.skeletonNode.setAllowedTypes(h().HAnimJoint,h().HAnimSite),this.viewpointsNode.setAllowedTypes(h().HAnimSite),this._skeleton.addFieldInterest(this.skeletonNode._children),this._viewpoints.addFieldInterest(this.viewpointsNode._children),this._skin.addFieldInterest(this.skinNode._children),this.skeletonNode._children=this._skeleton,this.viewpointsNode._children=this._viewpoints,this.skinNode._children=this._skin,this.skeletonNode.setPrivate(!0),this.viewpointsNode.setPrivate(!0),this.skinNode.setPrivate(!0),this._translation.addFieldInterest(this.transformNode._translation),this._rotation.addFieldInterest(this.transformNode._rotation),this._scale.addFieldInterest(this.transformNode._scale),this._scaleOrientation.addFieldInterest(this.transformNode._scaleOrientation),this._center.addFieldInterest(this.transformNode._center),this._visible.addFieldInterest(this.transformNode._visible),this._bboxDisplay.addFieldInterest(this.transformNode._bboxDisplay),this._bboxSize.addFieldInterest(this.transformNode._bboxSize),this._bboxCenter.addFieldInterest(this.transformNode._bboxCenter),this.transformNode._translation=this._translation,this.transformNode._rotation=this._rotation,this.transformNode._scale=this._scale,this.transformNode._scaleOrientation=this._scaleOrientation,this.transformNode._center=this._center,this.transformNode._visible=this._visible,this.transformNode._bboxDisplay=this._bboxDisplay,this.transformNode._bboxSize=this._bboxSize,this.transformNode._bboxCenter=this._bboxCenter,this.transformNode._children=[this.skeletonNode,this.viewpointsNode,this.skinNode],this.transformNode._isCameraObject.addFieldInterest(this._isCameraObject),this.transformNode._isPickableObject.addFieldInterest(this._isPickableObject),this.skeletonNode.setup(),this.viewpointsNode.setup(),this.skinNode.setup(),this.transformNode.setup(),this.setCameraObject(this.transformNode.isCameraObject()),this.setPickableObject(this.transformNode.isPickableObject());const e=this.getBrowser().getContext();if(1!==e.getVersion()){this.skinNode.traverse=function(e,t,n){n.getHumanoids().push(e),b().prototype.traverse.call(this,t,n),n.getHumanoids().pop()}.bind(this.skinNode,this),this.jointsTexture=e.createTexture(),this.displacementsTexture=e.createTexture(),this.jointMatricesTexture=e.createTexture();for(const t of[this.jointsTexture,this.displacementsTexture,this.jointMatricesTexture])e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);this._motionsEnabled.addInterest("set_motions__",this),this._motions.addInterest("set_motions__",this),this._jointBindingPositions.addInterest("set_joints__",this),this._jointBindingRotations.addInterest("set_joints__",this),this._jointBindingScales.addInterest("set_joints__",this),this._joints.addInterest("set_joints__",this),this._jointTextures.addInterest("set_jointTextures__",this),this._displacementsTexture.addInterest("set_displacementsTexture__",this),this._displacementWeightsTexture.addInterest("set_displacementWeightsTexture__",this),this._skinCoord.addInterest("set_skinCoord__",this),this.set_motions__(),this.set_joints__(),this.set_skinCoord__()}},getBBox(e,t){return this.transformNode.getBBox(e,t)},getMatrix(){return this.transformNode.getMatrix()},set_motions__(){const e=this._motionsEnabled,t=this.motionNodes;for(const e of t)e.setJoints([]);t.length=0;for(const[n,i]of this._motions.entries()){if(n<e.length&&!e[n])continue;const s=E()(h().HAnimMotion,i);s&&t.push(s)}for(const e of t)e.setJoints(this.jointNodes)},set_joints__(){const e=this.jointNodes,t=this.jointBindingMatrices,n=this._jointBindingPositions,i=this._jointBindingRotations,s=this._jointBindingScales;for(const t of e)t.removeInterest("enable",this.change),t._skinCoordIndex.removeInterest("addEvent",this._jointTextures),t._skinCoordWeight.removeInterest("addEvent",this._jointTextures),t._displacements.removeInterest("addEvent",this._displacementsTexture),t._displacementWeights.removeInterest("addEvent",this._displacementWeightsTexture);e.length=0,t.length=0;for(const[o,r]of this._joints.entries()){const a=E()(h().HAnimJoint,r);if(!a)continue;const d=new(D());n.length&&d.translate(n[Math.min(o,n.length-1)].getValue()),i.length&&d.rotate(i[Math.min(o,i.length-1)].getValue()),s.length&&d.scale(s[Math.min(o,s.length-1)].getValue()),e.push(a),t.push(d)}for(const t of e)t.addInterest("enable",this.change),t._skinCoordIndex.addInterest("addEvent",this._jointTextures),t._skinCoordWeight.addInterest("addEvent",this._jointTextures),t._displacements.addInterest("addEvent",this._displacementsTexture),t._displacementWeights.addInterest("addEvent",this._displacementWeightsTexture);const o=Math.ceil(Math.sqrt(8*e.length));this.jointMatricesArray=new Float32Array(o*o*4),this._jointTextures.addEvent(),this._displacementsTexture.addEvent(),this._displacementWeightsTexture.addEvent();for(const t of this.motionNodes)t.setJoints(e)},set_jointTextures__(){const e=this.skinCoordNode?._point.length||1,t=Array.from({length:e},(()=>[])),n=Array.from({length:e},(()=>[]));for(const[e,i]of this.jointNodes.entries()){const s=i._skinCoordWeight.getValue();for(const[o,r]of i._skinCoordIndex.entries())t[r]?.push(e),n[r]?.push(s[o])}const i=Math.ceil(Math.sqrt(2*e))||1,s=new Float32Array(i*i*4);for(let i=0;i<e;++i){const e=t[i],o=n[i];e.length=o.length=Math.min(e.length,4),s.set(e,8*i+0),s.set(o,8*i+4)}const o=this.getBrowser().getContext();o.bindTexture(o.TEXTURE_2D,this.jointsTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA32F,i,i,0,o.RGBA,o.FLOAT,s),this.change.enable()},set_displacementsTexture__(){const e=this.skinCoordNode?._point.length||1,t=Array.from({length:e},(()=>[]));for(const[e,n]of this.jointNodes.entries())for(const e of n.getDisplacers()){const n=e._displacements;for(const[i,s]of e._coordIndex.entries())t[s]?.push(...n[i])}const n=A(Math.ceil(Math.sqrt(2*e))||1),i=new Float32Array(n*n*8);for(let n=0;n<e;++n){const e=t[n];e.length=Math.min(e.length,8),i.set(e,8*n)}const s=this.getBrowser().getContext();s.bindTexture(s.TEXTURE_2D,this.displacementsTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA32F,n,n,0,s.RGBA,s.FLOAT,i);const o=this.displacementWeights;for(let t=o.length;t<e;++t)o[t]=[];o.length=e,this.displacementWeightsArray=new Float32Array(n*n*4),this.change.enable()},set_displacementWeightsTexture__(){const e=this.skinCoordNode?._point.length||1,t=this.displacementWeights;for(const e of t)e.length=0;for(const e of this.jointNodes)for(const n of e.getDisplacers()){const e=n._weight;for(const i of n._coordIndex)t[i]?.push(e)}const n=A(Math.ceil(Math.sqrt(2*e))||1),i=this.displacementWeightsArray;for(let n=0;n<e;++n){const e=t[n];e.length=Math.min(e.length,8),i.set(e,8*n)}const s=this.getBrowser().getContext();s.bindTexture(s.TEXTURE_2D,this.displacementsTexture),s.texSubImage2D(s.TEXTURE_2D,0,0,n/2,n,n/2,s.RGBA,s.FLOAT,i),this.change.enable()},set_skinCoord__(){this.skinCoordNode&&(this.skinCoordNode.removeInterest("addEvent",this._jointTextures),this.skinCoordNode.removeInterest("addEvent",this._displacementsTexture),this.skinCoordNode.removeInterest("addEvent",this._displacementWeightsTexture)),this.skinCoordNode=E()(h().X3DCoordinateNode,this._skinCoord),this.skinCoordNode?(delete this.skinning,this.skinCoordNode.addInterest("addEvent",this._jointTextures),this.skinCoordNode.addInterest("addEvent",this._displacementsTexture),this.skinCoordNode.addInterest("addEvent",this._displacementWeightsTexture)):this.skinning=Function.prototype,this._jointTextures.addEvent(),this._displacementsTexture.addEvent(),this._displacementWeightsTexture.addEvent()},traverse(e,t){this.transformNode.traverse(e,t),this.skinning(e,t)},skinning:(()=>{const e=new(D());return function(t,n){if(t!==N().DISPLAY||this.change.lock())return;e.assign(this.transformNode.getMatrix()).multRight(n.getModelViewMatrix().get()).inverse();const i=this.jointNodes,s=i.length,o=this.jointBindingMatrices,r=this.jointMatricesArray,a=Math.ceil(Math.sqrt(8*s));for(let t=0;t<s;++t){const n=i[t],s=o[t],a=n.getModelViewMatrix().multRight(e).multLeft(s),d=a.submatrix.transpose().inverse();r.set(a,32*t+0),r.set(d,32*t+16)}const d=this.getBrowser().getContext();d.bindTexture(d.TEXTURE_2D,this.jointMatricesTexture),d.texImage2D(d.TEXTURE_2D,0,d.RGBA32F,a,a,0,d.RGBA,d.FLOAT,r)}})(),setShaderUniforms(e,t){const n=this.getBrowser().getTexture2DUnit(),i=this.getBrowser().getTexture2DUnit(),s=this.getBrowser().getTexture2DUnit();e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,this.jointsTexture),e.uniform1i(t.x3d_JointsTexture,n),e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,this.displacementsTexture),e.uniform1i(t.x3d_DisplacementsTexture,i),e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,this.jointMatricesTexture),e.uniform1i(t.x3d_JointMatricesTexture,s)},dispose(){S().prototype.dispose.call(this),F().prototype.dispose.call(this)}}),Object.defineProperties(j,{typeName:{value:"HAnimHumanoid",enumerable:!0},componentName:{value:"HAnim",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new(d())([new(r())(h().inputOutput,"metadata",new(s().SFNode)),new(r())(h().inputOutput,"version",new(s().SFString)),new(r())(h().inputOutput,"description",new(s().SFString)),new(r())(h().inputOutput,"name",new(s().SFString)),new(r())(h().inputOutput,"info",new(s().MFString)),new(r())(h().inputOutput,"skeletalConfiguration",new(s().SFString)("BASIC")),new(r())(h().inputOutput,"loa",new(s().SFInt32)(-1)),new(r())(h().inputOutput,"translation",new(s().SFVec3f)),new(r())(h().inputOutput,"rotation",new(s().SFRotation)),new(r())(h().inputOutput,"scale",new(s().SFVec3f)(1,1,1)),new(r())(h().inputOutput,"scaleOrientation",new(s().SFRotation)),new(r())(h().inputOutput,"center",new(s().SFVec3f)),new(r())(h().inputOutput,"visible",new(s().SFBool)(!0)),new(r())(h().inputOutput,"bboxDisplay",new(s().SFBool)),new(r())(h().initializeOnly,"bboxSize",new(s().SFVec3f)(-1,-1,-1)),new(r())(h().initializeOnly,"bboxCenter",new(s().SFVec3f)),new(r())(h().inputOutput,"skeleton",new(s().MFNode)),new(r())(h().inputOutput,"viewpoints",new(s().MFNode)),new(r())(h().inputOutput,"sites",new(s().MFNode)),new(r())(h().inputOutput,"segments",new(s().MFNode)),new(r())(h().inputOutput,"motionsEnabled",new(s().MFBool)),new(r())(h().inputOutput,"motions",new(s().MFNode)),new(r())(h().inputOutput,"jointBindingPositions",new(s().MFVec3f)),new(r())(h().inputOutput,"jointBindingRotations",new(s().MFRotation)),new(r())(h().inputOutput,"jointBindingScales",new(s().MFVec3f)),new(r())(h().inputOutput,"joints",new(s().MFNode)),new(r())(h().inputOutput,"skinBindingNormal",new(s().SFNode)),new(r())(h().inputOutput,"skinBindingCoord",new(s().SFNode)),new(r())(h().inputOutput,"skinNormal",new(s().SFNode)),new(r())(h().inputOutput,"skinCoord",new(s().SFNode)),new(r())(h().inputOutput,"skin",new(s().MFNode))]),enumerable:!0}});class C{#e=!0;enable(){this.#e=!1}lock(){const e=this.#e;return this.#e=!0,e}}function A(e){return e+e%2}const X=j;c().set("x_ite/Components/HAnim/HAnimHumanoid",X);const k=X,R=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Grouping/X3DTransformNode");var V=e.n(R);const B=window[Symbol.for("X_ITE.X3D-8.10.1")].require("standard/Math/Numbers/Vector3");var H=e.n(B);function P(e){V().call(this,e),this.addType(h().HAnimJoint),this.addChildObjects(h().outputOnly,"displacements",new(s().SFTime),h().outputOnly,"displacementWeights",new(s().SFTime)),this.setAllowedTypes(h().HAnimJoint,h().HAnimSegment,h().HAnimSite),this.displacerNodes=[],this.modelViewMatrix=new(D())}Object.assign(Object.setPrototypeOf(P.prototype,V().prototype),{initialize(){V().prototype.initialize.call(this),this._displacers.addInterest("set_displacers__",this),this.set_displacers__()},getModelViewMatrix(){return this.modelViewMatrix},getDisplacers(){return this.displacerNodes},set_displacers__(){const e=this.displacerNodes;for(const t of e)t._coordIndex.removeInterest("addEvent",this._displacements),t._displacements.removeInterest("addEvent",this._displacements),t._coordIndex.removeInterest("addEvent",this._displacementWeights),t._weight.removeInterest("addEvent",this._displacementWeights);e.length=0;for(const t of this._displacers){const n=E()(h().HAnimDisplacer,t);n&&e.push(n)}for(const t of e)t._coordIndex.addInterest("addEvent",this._displacements),t._displacements.addInterest("addEvent",this._displacements),t._coordIndex.addInterest("addEvent",this._displacementWeights),t._weight.addInterest("addEvent",this._displacementWeights)},traverse(e,t){const n=t.getModelViewMatrix();n.push(),n.multLeft(this.getMatrix()),e===N().DISPLAY&&this.modelViewMatrix.assign(n.get()),V().prototype.groupTraverse.call(this,e,t),n.pop()},groupTraverse(e,t){e===N().DISPLAY&&this.modelViewMatrix.assign(t.getModelViewMatrix().get()),V().prototype.groupTraverse.call(this,e,t)}}),Object.defineProperties(P,{typeName:{value:"HAnimJoint",enumerable:!0},componentName:{value:"HAnim",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new(d())([new(r())(h().inputOutput,"metadata",new(s().SFNode)),new(r())(h().inputOutput,"description",new(s().SFString)),new(r())(h().inputOutput,"name",new(s().SFString)),new(r())(h().inputOutput,"translation",new(s().SFVec3f)),new(r())(h().inputOutput,"rotation",new(s().SFRotation)),new(r())(h().inputOutput,"scale",new(s().SFVec3f)(1,1,1)),new(r())(h().inputOutput,"scaleOrientation",new(s().SFRotation)),new(r())(h().inputOutput,"center",new(s().SFVec3f)),new(r())(h().inputOutput,"llimit",new(s().MFFloat)),new(r())(h().inputOutput,"ulimit",new(s().MFFloat)),new(r())(h().inputOutput,"limitOrientation",new(s().SFRotation)),new(r())(h().inputOutput,"stiffness",new(s().MFFloat)(0,0,0)),new(r())(h().inputOutput,"skinCoordIndex",new(s().MFInt32)),new(r())(h().inputOutput,"skinCoordWeight",new(s().MFFloat)),new(r())(h().inputOutput,"displacers",new(s().MFNode)),new(r())(h().inputOutput,"visible",new(s().SFBool)(!0)),new(r())(h().inputOutput,"bboxDisplay",new(s().SFBool)),new(r())(h().initializeOnly,"bboxSize",new(s().SFVec3f)(-1,-1,-1)),new(r())(h().initializeOnly,"bboxCenter",new(s().SFVec3f)),new(r())(h().inputOnly,"addChildren",new(s().MFNode)),new(r())(h().inputOnly,"removeChildren",new(s().MFNode)),new(r())(h().inputOutput,"children",new(s().MFNode))]),enumerable:!0}});const U=P;c().set("x_ite/Components/HAnim/HAnimJoint",U);const z=U,W=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Time/TimeSensor");var q=e.n(W);const G=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Interpolation/PositionInterpolator");var L=e.n(G);const J=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Interpolation/OrientationInterpolator");var Y=e.n(J);const Z=window[Symbol.for("X_ITE.X3D-8.10.1")].require("standard/Math/Numbers/Rotation4");var $=e.n(Z);const K=window[Symbol.for("X_ITE.X3D-8.10.1")].require("standard/Math/Algorithm");var Q=e.n(K);function ee(e){F().call(this,e),this.addType(h().X3DTimeDependentNode),this.addType(h().HAnimMotion),this.timeSensor=new(q())(this.getExecutionContext()),this.interpolators=[],this.jointsIndex=new Map}Object.assign(Object.setPrototypeOf(ee.prototype,F().prototype),{initialize(){F().prototype.initialize.call(this),this._enabled.addFieldInterest(this.timeSensor._enabled),this._loop.addFieldInterest(this.timeSensor._loop),this._startTime.addFieldInterest(this.timeSensor._startTime),this._resumeTime.addFieldInterest(this.timeSensor._resumeTime),this._pauseTime.addFieldInterest(this.timeSensor._pauseTime),this._stopTime.addFieldInterest(this.timeSensor._stopTime),this.timeSensor._isPaused.addFieldInterest(this._isPaused),this.timeSensor._isActive.addFieldInterest(this._isActive),this.timeSensor._cycleTime.addFieldInterest(this._cycleTime),this.timeSensor._elapsedTime.addFieldInterest(this._elapsedTime),this.timeSensor._enabled=this._enabled,this.timeSensor._loop=this._loop,this.timeSensor._startTime=this._startTime,this.timeSensor._resumeTime=this._resumeTime,this.timeSensor._pauseTime=this._pauseTime,this.timeSensor._stopTime=this._stopTime,this.timeSensor.setup(),this._channelsEnabled.addInterest("set_connectInterpolators__",this),this._channels.addInterest("set_interpolators__",this),this._joints.addInterest("set_connectInterpolators__",this),this._values.addInterest("set_interpolators__",this),this._startFrame.addInterest("set_start_or_endFrame__",this),this._endFrame.addInterest("set_start_or_endFrame__",this),this._frameIndex.addInterest("set_frameIndex__",this),this._frameDuration.addInterest("set_frameDuration__",this),this._next.addInterest("set_next_or_previous__",this,1),this._previous.addInterest("set_next_or_previous__",this,-1),this.set_interpolators__()},setJoints(e){const t=this.jointsIndex;t.clear();for(const n of e)t.set(n._name.getValue().trim(),n);t.delete("IGNORED"),this.set_connectInterpolators__()},set_interpolators__(){const e=this.timeSensor;for(const t of e._fraction_changed.getFieldInterests())e._fraction_changed.removeFieldInterest(t);const t=this._channels.getValue().replace(/^[\s,\d]+|[\s,\d]+$/gs,"").split(/[\s,]+\d+[\s,]+/s).map((e=>e.split(/[\s,]+/s))),n=this._values,i=t.reduce(((e,t)=>e+t.length),0),s=Math.floor(i?n.length/i:0),o=new Map,r=Array.from({length:t.length},(()=>({})));this.interpolators=r;for(let e=0,i=0;e<s;++e)for(const[a,d]of t.entries()){o.clear();for(const e of d)o.set(e,n[i++]);if(o.has("Xposition")||o.has("Yposition")||o.has("Zposition")){const t=r[a].positionInterpolator??this.createPositionInterpolator(r,a),n=e/(s-1),i=new(H())(o.get("Xposition")??0,o.get("Yposition")??0,o.get("Zposition")??0);t._key.push(n),t._keyValue.push(i)}if(o.has("Xrotation")||o.has("Yrotation")||o.has("Zrotation")){const t=r[a].orientationInterpolator??this.createOrientationInterpolator(r,a),n=e/(s-1),i=$().fromEuler(o.get("Xrotation")??0,o.get("Yrotation")??0,o.get("Zrotation")??0);t._key.push(n),t._keyValue.push(i)}}for(const{positionInterpolator:e,orientationInterpolator:t}of r)e?.setup(),t?.setup();this._frameIndex=0,this._startFrame=0,this._endFrame=s-1,this._frameCount=s,this.set_connectInterpolators__(),this.set_frameDuration__()},set_connectInterpolators__(){const e=this.timeSensor,t=this._channelsEnabled,n=this._joints.getValue().replace(/^[\s,]+|[\s,]+$/gs,"").split(/[\s,]+/s),i=this.jointsIndex;for(const{positionInterpolator:e,orientationInterpolator:t}of this.interpolators){if(e)for(const t of e._value_changed.getFieldInterests())e._value_changed.removeFieldInterest(t);if(t)for(const e of t._value_changed.getFieldInterests())t._value_changed.removeFieldInterest(e)}if(i.size)for(const[s,{positionInterpolator:o,orientationInterpolator:r}]of this.interpolators.entries()){if(s<t.length&&!t[s])continue;if(s>=n.length)continue;const a=i.get(n[s]);a&&(o&&(e._fraction_changed.addFieldInterest(o._set_fraction),o._value_changed.addFieldInterest(a._translation)),r&&(e._fraction_changed.addFieldInterest(r._set_fraction),r._value_changed.addFieldInterest(a._rotation)))}},set_start_or_endFrame__(){const e=this._frameCount.getValue(),t=Q().clamp(this._startFrame.getValue(),0,e),n=Q().clamp(this._endFrame.getValue(),0,e);this.startFrame=Math.min(t,n),this.endFrame=Math.max(t,n),this.timeSensor._range[1]=e>1?this.startFrame/(e-1):0,this.timeSensor._range[2]=e>1?this.endFrame/(e-1):0},set_frameIndex__(){const e=this._frameCount.getValue(),t=Q().clamp(this._frameIndex.getValue(),0,e),n=e>1?t/(e-1):0;if(this.timeSensor._range[0]=n,this._enabled.getValue()&&!this.timeSensor._isActive.getValue())for(const e of this.timeSensor._fraction_changed.getFieldInterests())e.setValue(n)},set_frameDuration__(){const e=this._frameCount.getValue(),t=Math.max(this._frameDuration.getValue(),0);this.timeSensor._cycleInterval=e*t},set_next_or_previous__(e,t){if(!t.getValue())return;if(!this._enabled.getValue())return;const n=this._frameIncrement.getValue(),i=this._frameIndex.getValue()+n*e;if(i>this.endFrame){if(!this._loop.getValue())return;this._frameIndex=this.startFrame}else if(i<this.startFrame){if(!this._loop.getValue())return;this._frameIndex=this.endFrame}else this._frameIndex=i},createPositionInterpolator(e,t){return e[t].positionInterpolator=new(L())(this.getExecutionContext())},createOrientationInterpolator(e,t){return e[t].orientationInterpolator=new(Y())(this.getExecutionContext())}}),Object.defineProperties(ee,{typeName:{value:"HAnimMotion",enumerable:!0},componentName:{value:"HAnim",enumerable:!0},containerField:{value:"motions",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new(d())([new(r())(h().inputOutput,"metadata",new(s().SFNode)),new(r())(h().inputOutput,"description",new(s().SFString)),new(r())(h().inputOutput,"enabled",new(s().SFBool)(!0)),new(r())(h().inputOutput,"loa",new(s().SFInt32)(-1)),new(r())(h().inputOutput,"joints",new(s().SFString)),new(r())(h().inputOutput,"channelsEnabled",new(s().MFBool)),new(r())(h().inputOutput,"channels",new(s().SFString)),new(r())(h().inputOutput,"values",new(s().MFFloat)),new(r())(h().inputOutput,"frameIndex",new(s().SFInt32)(0)),new(r())(h().inputOutput,"frameDuration",new(s().SFTime)(.1)),new(r())(h().inputOutput,"frameIncrement",new(s().SFInt32)(1)),new(r())(h().inputOutput,"startFrame",new(s().SFInt32)),new(r())(h().inputOutput,"endFrame",new(s().SFInt32)),new(r())(h().inputOnly,"next",new(s().SFBool)),new(r())(h().inputOnly,"previous",new(s().SFBool)),new(r())(h().inputOutput,"loop",new(s().SFBool)),new(r())(h().inputOutput,"startTime",new(s().SFTime)),new(r())(h().inputOutput,"resumeTime",new(s().SFTime)),new(r())(h().inputOutput,"pauseTime",new(s().SFTime)),new(r())(h().inputOutput,"stopTime",new(s().SFTime)),new(r())(h().outputOnly,"isPaused",new(s().SFBool)),new(r())(h().outputOnly,"isActive",new(s().SFBool)),new(r())(h().outputOnly,"cycleTime",new(s().SFTime)),new(r())(h().outputOnly,"elapsedTime",new(s().SFTime)),new(r())(h().outputOnly,"frameCount",new(s().SFInt32))]),enumerable:!0}});const te=ee;c().set("x_ite/Components/HAnim/HAnimMotion",te);const ne=te,ie=window[Symbol.for("X_ITE.X3D-8.10.1")].require("x_ite/Components/Grouping/X3DGroupingNode");var se=e.n(ie);function oe(e){se().call(this,e),this.addType(h().HAnimSegment),this._mass.setUnit("mass")}Object.setPrototypeOf(oe.prototype,se().prototype),Object.defineProperties(oe,{typeName:{value:"HAnimSegment",enumerable:!0},componentName:{value:"HAnim",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new(d())([new(r())(h().inputOutput,"metadata",new(s().SFNode)),new(r())(h().inputOutput,"description",new(s().SFString)),new(r())(h().inputOutput,"name",new(s().SFString)),new(r())(h().inputOutput,"mass",new(s().SFFloat)),new(r())(h().inputOutput,"centerOfMass",new(s().SFVec3f)),new(r())(h().inputOutput,"momentsOfInertia",new(s().MFFloat)(0,0,0,0,0,0,0,0,0)),new(r())(h().inputOutput,"displacers",new(s().MFNode)),new(r())(h().inputOutput,"coord",new(s().SFNode)),new(r())(h().inputOutput,"visible",new(s().SFBool)(!0)),new(r())(h().inputOutput,"bboxDisplay",new(s().SFBool)),new(r())(h().initializeOnly,"bboxSize",new(s().SFVec3f)(-1,-1,-1)),new(r())(h().initializeOnly,"bboxCenter",new(s().SFVec3f)),new(r())(h().inputOnly,"addChildren",new(s().MFNode)),new(r())(h().inputOnly,"removeChildren",new(s().MFNode)),new(r())(h().inputOutput,"children",new(s().MFNode))]),enumerable:!0}});const re=oe;c().set("x_ite/Components/HAnim/HAnimSegment",re);const ae=re;function de(e){V().call(this,e),this.addType(h().HAnimSite)}Object.setPrototypeOf(de.prototype,V().prototype),Object.defineProperties(de,{typeName:{value:"HAnimSite",enumerable:!0},componentName:{value:"HAnim",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new(d())([new(r())(h().inputOutput,"metadata",new(s().SFNode)),new(r())(h().inputOutput,"description",new(s().SFString)),new(r())(h().inputOutput,"name",new(s().SFString)),new(r())(h().inputOutput,"translation",new(s().SFVec3f)),new(r())(h().inputOutput,"rotation",new(s().SFRotation)),new(r())(h().inputOutput,"scale",new(s().SFVec3f)(1,1,1)),new(r())(h().inputOutput,"scaleOrientation",new(s().SFRotation)),new(r())(h().inputOutput,"center",new(s().SFVec3f)),new(r())(h().inputOutput,"visible",new(s().SFBool)(!0)),new(r())(h().inputOutput,"bboxDisplay",new(s().SFBool)),new(r())(h().initializeOnly,"bboxSize",new(s().SFVec3f)(-1,-1,-1)),new(r())(h().initializeOnly,"bboxCenter",new(s().SFVec3f)),new(r())(h().inputOnly,"addChildren",new(s().MFNode)),new(r())(h().inputOnly,"removeChildren",new(s().MFNode)),new(r())(h().inputOutput,"children",new(s().MFNode))]),enumerable:!0}});const ue=de;c().set("x_ite/Components/HAnim/HAnimSite",ue);const le=ue;n().add({name:"HAnim",concreteNodes:[f,k,z,ne,ae,le],abstractNodes:[]});const pe=void 0;c().set("assets/components/HAnim",pe)})();