<<<<<<< HEAD
/* X_ITE v8.7.9 */!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.X3D=e():t.X3D=e()}(self,(()=>(()=>{var t={131:function(t,e,n){"use strict";var i,o,r=n(532);"undefined"!=typeof window&&window,void 0===(o="function"==typeof(i=function(){if("undefined"==typeof window)return null;var t="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||function(e){return t.setTimeout(e,20)},n=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||function(e){t.clearTimeout(e)};function i(t,e){var n=Object.prototype.toString.call(t),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||void 0!==r&&t instanceof r||"undefined"!=typeof Elements&&t instanceof Elements,o=0,s=t.length;if(i)for(;o<s;o++)e(t[o]);else e(t)}function o(t){if(!t.getBoundingClientRect)return{width:t.offsetWidth,height:t.offsetHeight};var e=t.getBoundingClientRect();return{width:Math.round(e.width),height:Math.round(e.height)}}function s(t,e){Object.keys(e).forEach((function(n){t.style[n]=e[n]}))}var a=function(t,r){var u=0;function c(){var t,e,n=[];this.add=function(t){n.push(t)},this.call=function(i){for(t=0,e=n.length;t<e;t++)n[t].call(this,i)},this.remove=function(i){var o=[];for(t=0,e=n.length;t<e;t++)n[t]!==i&&o.push(n[t]);n=o},this.length=function(){return n.length}}function l(t,n){if(t)if(t.resizedAttached)t.resizedAttached.add(n);else{t.resizedAttached=new c,t.resizedAttached.add(n),t.resizeSensor=document.createElement("div"),t.resizeSensor.dir="ltr",t.resizeSensor.className="resize-sensor";var i={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},r={position:"absolute",left:"0px",top:"0px",transition:"0s"};s(t.resizeSensor,i);var a=document.createElement("div");a.className="resize-sensor-expand",s(a,i);var l=document.createElement("div");s(l,r),a.appendChild(l);var h=document.createElement("div");h.className="resize-sensor-shrink",s(h,i);var d=document.createElement("div");s(d,r),s(d,{width:"200%",height:"200%"}),h.appendChild(d),t.resizeSensor.appendChild(a),t.resizeSensor.appendChild(h),t.appendChild(t.resizeSensor);var p=window.getComputedStyle(t),f=p?p.getPropertyValue("position"):null;"absolute"!==f&&"relative"!==f&&"fixed"!==f&&"sticky"!==f&&(t.style.position="relative");var g=!1,m=0,_=o(t),x=0,y=0,w=!0;u=0;var S=function(){var e=t.offsetWidth,n=t.offsetHeight;l.style.width=e+10+"px",l.style.height=n+10+"px",a.scrollLeft=e+10,a.scrollTop=n+10,h.scrollLeft=e+10,h.scrollTop=n+10},T=function(){if(w){if(0===t.offsetWidth&&0===t.offsetHeight)return void(u||(u=e((function(){u=0,T()}))));w=!1}S()};t.resizeSensor.resetSensor=T;var b=function(){m=0,g&&(x=_.width,y=_.height,t.resizedAttached&&t.resizedAttached.call(_))},v=function(){_=o(t),(g=_.width!==x||_.height!==y)&&!m&&(m=e(b)),T()},E=function(t,e,n){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener(e,n)};E(a,"scroll",v),E(h,"scroll",v),u=e((function(){u=0,T()}))}}i(t,(function(t){l(t,r)})),this.detach=function(e){u||(n(u),u=0),a.detach(t,e)},this.reset=function(){t.resizeSensor.resetSensor()}};if(a.reset=function(t){i(t,(function(t){t.resizeSensor.resetSensor()}))},a.detach=function(t,e){i(t,(function(t){t&&(t.resizedAttached&&"function"==typeof e&&(t.resizedAttached.remove(e),t.resizedAttached.length())||t.resizeSensor&&(t.contains(t.resizeSensor)&&t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached))}))},"undefined"!=typeof MutationObserver){var u=new MutationObserver((function(t){for(var e in t)if(t.hasOwnProperty(e))for(var n=t[e].addedNodes,i=0;i<n.length;i++)n[i].resizeSensor&&a.reset(n[i])}));document.addEventListener("DOMContentLoaded",(function(t){u.observe(document.body,{childList:!0,subtree:!0})}))}return a})?i.call(e,n,e,t):i)||(t.exports=o)},642:(t,e,n)=>{!function(t){function e(t){var e,i,o;return this.length?((e=this[0]).ownerDocument?o=e.ownerDocument:e=(o=e).documentElement,null==t?o.exitFullscreen||o.webkitExitFullscreen||o.webkitCancelFullScreen||o.msExitFullscreen||o.mozCancelFullScreen?(t=n(o))&&(o.fullscreenElement||o.webkitFullscreenElement||o.webkitCurrentFullScreenElement||o.msFullscreenElement||o.mozFullScreenElement)||t:null:t?((i=e.requestFullscreen||e.webkitRequestFullscreen||e.webkitRequestFullScreen||e.msRequestFullscreen||e.mozRequestFullScreen)&&i.call(e),this):((i=o.exitFullscreen||o.webkitExitFullscreen||o.webkitCancelFullScreen||o.msExitFullscreen||o.mozCancelFullScreen)&&n(o)&&i.call(o),this)):this}function n(t){return!!(t.fullscreenElement||t.msFullscreenElement||t.webkitIsFullScreen||t.mozFullScreen)}function i(e){t(document).trigger(new t.Event("fullscreenchange"))}function o(e){t(document).trigger(new t.Event("fullscreenerror"))}t.fn.fullScreen=e,t.fn.toggleFullScreen=function(){return e.call(this,!e.call(this))},function(){var e,n,r;(e=document).webkitCancelFullScreen?(n="webkitfullscreenchange",r="webkitfullscreenerror"):e.msExitFullscreen?(n="MSFullscreenChange",r="MSFullscreenError"):e.mozCancelFullScreen?(n="mozfullscreenchange",r="mozfullscreenerror"):(n="fullscreenchange",r="fullscreenerror"),t(document).bind(n,i),t(document).bind(r,o)}()}(n(532))},292:(t,e,n)=>{var i,o,r;o=[n(532)],void 0===(r="function"==typeof(i=function(t){var e,n,i=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],r=Array.prototype.slice;if(t.event.fixHooks)for(var s=i.length;s;)t.event.fixHooks[i[--s]]=t.event.mouseHooks;var a=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=o.length;e;)this.addEventListener(o[--e],u,!1);else this.onmousewheel=u;t.data(this,"mousewheel-line-height",a.getLineHeight(this)),t.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=o.length;e;)this.removeEventListener(o[--e],u,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var n=t(e),i=n["offsetParent"in t.fn?"offsetParent":"parent"]();return i.length||(i=t("body")),parseInt(i.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function u(i){var o=i||window.event,s=r.call(arguments,1),u=0,h=0,d=0,p=0,f=0,g=0;if((i=t.event.fix(o)).type="mousewheel","detail"in o&&(d=-1*o.detail),"wheelDelta"in o&&(d=o.wheelDelta),"wheelDeltaY"in o&&(d=o.wheelDeltaY),"wheelDeltaX"in o&&(h=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(h=-1*d,d=0),u=0===d?h:d,"deltaY"in o&&(u=d=-1*o.deltaY),"deltaX"in o&&(h=o.deltaX,0===d&&(u=-1*h)),0!==d||0!==h){if(1===o.deltaMode){var m=t.data(this,"mousewheel-line-height");u*=m,d*=m,h*=m}else if(2===o.deltaMode){var _=t.data(this,"mousewheel-page-height");u*=_,d*=_,h*=_}if(p=Math.max(Math.abs(d),Math.abs(h)),(!n||p<n)&&(n=p,l(o,p)&&(n/=40)),l(o,p)&&(u/=40,h/=40,d/=40),u=Math[u>=1?"floor":"ceil"](u/n),h=Math[h>=1?"floor":"ceil"](h/n),d=Math[d>=1?"floor":"ceil"](d/n),a.settings.normalizeOffset&&this.getBoundingClientRect){var x=this.getBoundingClientRect();f=i.clientX-x.left,g=i.clientY-x.top}return i.deltaX=h,i.deltaY=d,i.deltaFactor=n,i.offsetX=f,i.offsetY=g,i.deltaMode=0,s.unshift(i,u,h,d),e&&clearTimeout(e),e=setTimeout(c,200),(t.event.dispatch||t.event.handle).apply(this,s)}}function c(){n=null}function l(t,e){return a.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})})?i.apply(e,o):i)||(t.exports=r)},532:function(t,e){var n;!function(e,n){"use strict";"object"==typeof t.exports?t.exports=e.document?n(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return n(t)}:n(e)}("undefined"!=typeof window?window:this,(function(i,o){"use strict";var r=[],s=Object.getPrototypeOf,a=r.slice,u=r.flat?function(t){return r.flat.call(t)}:function(t){return r.concat.apply([],t)},c=r.push,l=r.indexOf,h={},d=h.toString,p=h.hasOwnProperty,f=p.toString,g=f.call(Object),m={},_=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},x=function(t){return null!=t&&t===t.window},y=i.document,w={type:!0,src:!0,nonce:!0,noModule:!0};function S(t,e,n){var i,o,r=(n=n||y).createElement("script");if(r.text=t,e)for(i in w)(o=e[i]||e.getAttribute&&e.getAttribute(i))&&r.setAttribute(i,o);n.head.appendChild(r).parentNode.removeChild(r)}function T(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?h[d.call(t)]||"object":typeof t}var b="3.7.0",v=/HTML$/i,E=function(t,e){return new E.fn.init(t,e)};function C(t){var e=!!t&&"length"in t&&t.length,n=T(t);return!_(t)&&!x(t)&&("array"===n||0===e||"number"==typeof e&&e>0&&e-1 in t)}function O(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}E.fn=E.prototype={jquery:b,constructor:E,length:0,toArray:function(){return a.call(this)},get:function(t){return null==t?a.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=E.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return E.each(this,t)},map:function(t){return this.pushStack(E.map(this,(function(e,n){return t.call(e,n,e)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(E.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(E.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,n=+t+(t<0?e:0);return this.pushStack(n>=0&&n<e?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:r.sort,splice:r.splice},E.extend=E.fn.extend=function(){var t,e,n,i,o,r,s=arguments[0]||{},a=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||_(s)||(s={}),a===u&&(s=this,a--);a<u;a++)if(null!=(t=arguments[a]))for(e in t)i=t[e],"__proto__"!==e&&s!==i&&(c&&i&&(E.isPlainObject(i)||(o=Array.isArray(i)))?(n=s[e],r=o&&!Array.isArray(n)?[]:o||E.isPlainObject(n)?n:{},o=!1,s[e]=E.extend(c,r,i)):void 0!==i&&(s[e]=i));return s},E.extend({expando:"jQuery"+(b+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,n;return!(!t||"[object Object]"!==d.call(t))&&(!(e=s(t))||"function"==typeof(n=p.call(e,"constructor")&&e.constructor)&&f.call(n)===g)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,n){S(t,{nonce:e&&e.nonce},n)},each:function(t,e){var n,i=0;if(C(t))for(n=t.length;i<n&&!1!==e.call(t[i],i,t[i]);i++);else for(i in t)if(!1===e.call(t[i],i,t[i]))break;return t},text:function(t){var e,n="",i=0,o=t.nodeType;if(o){if(1===o||9===o||11===o)return t.textContent;if(3===o||4===o)return t.nodeValue}else for(;e=t[i++];)n+=E.text(e);return n},makeArray:function(t,e){var n=e||[];return null!=t&&(C(Object(t))?E.merge(n,"string"==typeof t?[t]:t):c.call(n,t)),n},inArray:function(t,e,n){return null==e?-1:l.call(e,t,n)},isXMLDoc:function(t){var e=t&&t.namespaceURI,n=t&&(t.ownerDocument||t).documentElement;return!v.test(e||n&&n.nodeName||"HTML")},merge:function(t,e){for(var n=+e.length,i=0,o=t.length;i<n;i++)t[o++]=e[i];return t.length=o,t},grep:function(t,e,n){for(var i=[],o=0,r=t.length,s=!n;o<r;o++)!e(t[o],o)!==s&&i.push(t[o]);return i},map:function(t,e,n){var i,o,r=0,s=[];if(C(t))for(i=t.length;r<i;r++)null!=(o=e(t[r],r,n))&&s.push(o);else for(r in t)null!=(o=e(t[r],r,n))&&s.push(o);return u(s)},guid:1,support:m}),"function"==typeof Symbol&&(E.fn[Symbol.iterator]=r[Symbol.iterator]),E.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){h["[object "+e+"]"]=e.toLowerCase()}));var N=r.pop,F=r.sort,I=r.splice,M="[\\x20\\t\\r\\n\\f]",D=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g");E.contains=function(t,e){var n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(t.contains?t.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))};var R=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function V(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}E.escapeSelector=function(t){return(t+"").replace(R,V)};var A=y,P=c;!function(){var t,e,n,o,s,u,c,h,d,f,g=P,_=E.expando,x=0,y=0,w=tt(),S=tt(),T=tt(),b=tt(),v=function(t,e){return t===e&&(s=!0),0},C="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",R="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",V="\\["+M+"*("+R+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+R+"))|)"+M+"*\\]",L=":("+R+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+V+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),X=new RegExp("^"+M+"*,"+M+"*"),U=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),k=new RegExp(M+"|>"),z=new RegExp(L),j=new RegExp("^"+R+"$"),G={ID:new RegExp("^#("+R+")"),CLASS:new RegExp("^\\.("+R+")"),TAG:new RegExp("^("+R+"|[*])"),ATTR:new RegExp("^"+V),PSEUDO:new RegExp("^"+L),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+C+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},H=/^(?:input|select|textarea|button)$/i,q=/^h\d$/i,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,W=/[+~]/,K=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),J=function(t,e){var n="0x"+t.slice(1)-65536;return e||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},Z=function(){ut()},Q=dt((function(t){return!0===t.disabled&&O(t,"fieldset")}),{dir:"parentNode",next:"legend"});try{g.apply(r=a.call(A.childNodes),A.childNodes),r[A.childNodes.length].nodeType}catch(t){g={apply:function(t,e){P.apply(t,a.call(e))},call:function(t){P.apply(t,a.call(arguments,1))}}}function $(t,e,n,i){var o,r,s,a,c,l,p,f=e&&e.ownerDocument,x=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==x&&9!==x&&11!==x)return n;if(!i&&(ut(e),e=e||u,h)){if(11!==x&&(c=Y.exec(t)))if(o=c[1]){if(9===x){if(!(s=e.getElementById(o)))return n;if(s.id===o)return g.call(n,s),n}else if(f&&(s=f.getElementById(o))&&$.contains(e,s)&&s.id===o)return g.call(n,s),n}else{if(c[2])return g.apply(n,e.getElementsByTagName(t)),n;if((o=c[3])&&e.getElementsByClassName)return g.apply(n,e.getElementsByClassName(o)),n}if(!(b[t+" "]||d&&d.test(t))){if(p=t,f=e,1===x&&(k.test(t)||U.test(t))){for((f=W.test(t)&&at(e.parentNode)||e)==e&&m.scope||((a=e.getAttribute("id"))?a=E.escapeSelector(a):e.setAttribute("id",a=_)),r=(l=lt(t)).length;r--;)l[r]=(a?"#"+a:":scope")+" "+ht(l[r]);p=l.join(",")}try{return g.apply(n,f.querySelectorAll(p)),n}catch(e){b(t,!0)}finally{a===_&&e.removeAttribute("id")}}}return xt(t.replace(D,"$1"),e,n,i)}function tt(){var t=[];return function n(i,o){return t.push(i+" ")>e.cacheLength&&delete n[t.shift()],n[i+" "]=o}}function et(t){return t[_]=!0,t}function nt(t){var e=u.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function it(t){return function(e){return O(e,"input")&&e.type===t}}function ot(t){return function(e){return(O(e,"input")||O(e,"button"))&&e.type===t}}function rt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Q(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function st(t){return et((function(e){return e=+e,et((function(n,i){for(var o,r=t([],n.length,e),s=r.length;s--;)n[o=r[s]]&&(n[o]=!(i[o]=n[o]))}))}))}function at(t){return t&&void 0!==t.getElementsByTagName&&t}function ut(t){var n,i=t?t.ownerDocument||t:A;return i!=u&&9===i.nodeType&&i.documentElement?(c=(u=i).documentElement,h=!E.isXMLDoc(u),f=c.matches||c.webkitMatchesSelector||c.msMatchesSelector,A!=u&&(n=u.defaultView)&&n.top!==n&&n.addEventListener("unload",Z),m.getById=nt((function(t){return c.appendChild(t).id=E.expando,!u.getElementsByName||!u.getElementsByName(E.expando).length})),m.disconnectedMatch=nt((function(t){return f.call(t,"*")})),m.scope=nt((function(){return u.querySelectorAll(":scope")})),m.cssHas=nt((function(){try{return u.querySelector(":has(*,:jqfake)"),!1}catch(t){return!0}})),m.getById?(e.filter.ID=function(t){var e=t.replace(K,J);return function(t){return t.getAttribute("id")===e}},e.find.ID=function(t,e){if(void 0!==e.getElementById&&h){var n=e.getElementById(t);return n?[n]:[]}}):(e.filter.ID=function(t){var e=t.replace(K,J);return function(t){var n=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return n&&n.value===e}},e.find.ID=function(t,e){if(void 0!==e.getElementById&&h){var n,i,o,r=e.getElementById(t);if(r){if((n=r.getAttributeNode("id"))&&n.value===t)return[r];for(o=e.getElementsByName(t),i=0;r=o[i++];)if((n=r.getAttributeNode("id"))&&n.value===t)return[r]}return[]}}),e.find.TAG=function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):e.querySelectorAll(t)},e.find.CLASS=function(t,e){if(void 0!==e.getElementsByClassName&&h)return e.getElementsByClassName(t)},d=[],nt((function(t){var e;c.appendChild(t).innerHTML="<a id='"+_+"' href='' disabled='disabled'></a><select id='"+_+"-\r\\' disabled='disabled'><option selected=''></option></select>",t.querySelectorAll("[selected]").length||d.push("\\["+M+"*(?:value|"+C+")"),t.querySelectorAll("[id~="+_+"-]").length||d.push("~="),t.querySelectorAll("a#"+_+"+*").length||d.push(".#.+[+~]"),t.querySelectorAll(":checked").length||d.push(":checked"),(e=u.createElement("input")).setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),c.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(e=u.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||d.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")")})),m.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),v=function(t,e){if(t===e)return s=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n||(1&(n=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!m.sortDetached&&e.compareDocumentPosition(t)===n?t===u||t.ownerDocument==A&&$.contains(A,t)?-1:e===u||e.ownerDocument==A&&$.contains(A,e)?1:o?l.call(o,t)-l.call(o,e):0:4&n?-1:1)},u):u}for(t in $.matches=function(t,e){return $(t,null,null,e)},$.matchesSelector=function(t,e){if(ut(t),h&&!b[e+" "]&&(!d||!d.test(e)))try{var n=f.call(t,e);if(n||m.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){b(e,!0)}return $(e,u,null,[t]).length>0},$.contains=function(t,e){return(t.ownerDocument||t)!=u&&ut(t),E.contains(t,e)},$.attr=function(t,n){(t.ownerDocument||t)!=u&&ut(t);var i=e.attrHandle[n.toLowerCase()],o=i&&p.call(e.attrHandle,n.toLowerCase())?i(t,n,!h):void 0;return void 0!==o?o:t.getAttribute(n)},$.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},E.uniqueSort=function(t){var e,n=[],i=0,r=0;if(s=!m.sortStable,o=!m.sortStable&&a.call(t,0),F.call(t,v),s){for(;e=t[r++];)e===t[r]&&(i=n.push(r));for(;i--;)I.call(t,n[i],1)}return o=null,t},E.fn.uniqueSort=function(){return this.pushStack(E.uniqueSort(a.apply(this)))},e=E.expr={cacheLength:50,createPseudo:et,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(K,J),t[3]=(t[3]||t[4]||t[5]||"").replace(K,J),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||$.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&$.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return G.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&z.test(n)&&(e=lt(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(K,J).toLowerCase();return"*"===t?function(){return!0}:function(t){return O(t,e)}},CLASS:function(t){var e=w[t+" "];return e||(e=new RegExp("(^|"+M+")"+t+"("+M+"|$)"))&&w(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,n){return function(i){var o=$.attr(i,t);return null==o?"!="===e:!e||(o+="","="===e?o===n:"!="===e?o!==n:"^="===e?n&&0===o.indexOf(n):"*="===e?n&&o.indexOf(n)>-1:"$="===e?n&&o.slice(-n.length)===n:"~="===e?(" "+o.replace(B," ")+" ").indexOf(n)>-1:"|="===e&&(o===n||o.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,n,i,o){var r="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===i&&0===o?function(t){return!!t.parentNode}:function(e,n,u){var c,l,h,d,p,f=r!==s?"nextSibling":"previousSibling",g=e.parentNode,m=a&&e.nodeName.toLowerCase(),y=!u&&!a,w=!1;if(g){if(r){for(;f;){for(h=e;h=h[f];)if(a?O(h,m):1===h.nodeType)return!1;p=f="only"===t&&!p&&"nextSibling"}return!0}if(p=[s?g.firstChild:g.lastChild],s&&y){for(w=(d=(c=(l=g[_]||(g[_]={}))[t]||[])[0]===x&&c[1])&&c[2],h=d&&g.childNodes[d];h=++d&&h&&h[f]||(w=d=0)||p.pop();)if(1===h.nodeType&&++w&&h===e){l[t]=[x,d,w];break}}else if(y&&(w=d=(c=(l=e[_]||(e[_]={}))[t]||[])[0]===x&&c[1]),!1===w)for(;(h=++d&&h&&h[f]||(w=d=0)||p.pop())&&(!(a?O(h,m):1===h.nodeType)||!++w||(y&&((l=h[_]||(h[_]={}))[t]=[x,w]),h!==e)););return(w-=o)===i||w%i==0&&w/i>=0}}},PSEUDO:function(t,n){var i,o=e.pseudos[t]||e.setFilters[t.toLowerCase()]||$.error("unsupported pseudo: "+t);return o[_]?o(n):o.length>1?(i=[t,t,"",n],e.setFilters.hasOwnProperty(t.toLowerCase())?et((function(t,e){for(var i,r=o(t,n),s=r.length;s--;)t[i=l.call(t,r[s])]=!(e[i]=r[s])})):function(t){return o(t,0,i)}):o}},pseudos:{not:et((function(t){var e=[],n=[],i=_t(t.replace(D,"$1"));return i[_]?et((function(t,e,n,o){for(var r,s=i(t,null,o,[]),a=t.length;a--;)(r=s[a])&&(t[a]=!(e[a]=r))})):function(t,o,r){return e[0]=t,i(e,null,r,n),e[0]=null,!n.pop()}})),has:et((function(t){return function(e){return $(t,e).length>0}})),contains:et((function(t){return t=t.replace(K,J),function(e){return(e.textContent||E.text(e)).indexOf(t)>-1}})),lang:et((function(t){return j.test(t||"")||$.error("unsupported lang: "+t),t=t.replace(K,J).toLowerCase(),function(e){var n;do{if(n=h?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(n=n.toLowerCase())===t||0===n.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(t){var e=i.location&&i.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===c},focus:function(t){return t===function(){try{return u.activeElement}catch(t){}}()&&u.hasFocus()&&!!(t.type||t.href||~t.tabIndex)},enabled:rt(!1),disabled:rt(!0),checked:function(t){return O(t,"input")&&!!t.checked||O(t,"option")&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!e.pseudos.empty(t)},header:function(t){return q.test(t.nodeName)},input:function(t){return H.test(t.nodeName)},button:function(t){return O(t,"input")&&"button"===t.type||O(t,"button")},text:function(t){var e;return O(t,"input")&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:st((function(){return[0]})),last:st((function(t,e){return[e-1]})),eq:st((function(t,e,n){return[n<0?n+e:n]})),even:st((function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t})),odd:st((function(t,e){for(var n=1;n<e;n+=2)t.push(n);return t})),lt:st((function(t,e,n){var i;for(i=n<0?n+e:n>e?e:n;--i>=0;)t.push(i);return t})),gt:st((function(t,e,n){for(var i=n<0?n+e:n;++i<e;)t.push(i);return t}))}},e.pseudos.nth=e.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})e.pseudos[t]=it(t);for(t in{submit:!0,reset:!0})e.pseudos[t]=ot(t);function ct(){}function lt(t,n){var i,o,r,s,a,u,c,l=S[t+" "];if(l)return n?0:l.slice(0);for(a=t,u=[],c=e.preFilter;a;){for(s in i&&!(o=X.exec(a))||(o&&(a=a.slice(o[0].length)||a),u.push(r=[])),i=!1,(o=U.exec(a))&&(i=o.shift(),r.push({value:i,type:o[0].replace(D," ")}),a=a.slice(i.length)),e.filter)!(o=G[s].exec(a))||c[s]&&!(o=c[s](o))||(i=o.shift(),r.push({value:i,type:s,matches:o}),a=a.slice(i.length));if(!i)break}return n?a.length:a?$.error(t):S(t,u).slice(0)}function ht(t){for(var e=0,n=t.length,i="";e<n;e++)i+=t[e].value;return i}function dt(t,e,n){var i=e.dir,o=e.next,r=o||i,s=n&&"parentNode"===r,a=y++;return e.first?function(e,n,o){for(;e=e[i];)if(1===e.nodeType||s)return t(e,n,o);return!1}:function(e,n,u){var c,l,h=[x,a];if(u){for(;e=e[i];)if((1===e.nodeType||s)&&t(e,n,u))return!0}else for(;e=e[i];)if(1===e.nodeType||s)if(l=e[_]||(e[_]={}),o&&O(e,o))e=e[i]||e;else{if((c=l[r])&&c[0]===x&&c[1]===a)return h[2]=c[2];if(l[r]=h,h[2]=t(e,n,u))return!0}return!1}}function pt(t){return t.length>1?function(e,n,i){for(var o=t.length;o--;)if(!t[o](e,n,i))return!1;return!0}:t[0]}function ft(t,e,n,i,o){for(var r,s=[],a=0,u=t.length,c=null!=e;a<u;a++)(r=t[a])&&(n&&!n(r,i,o)||(s.push(r),c&&e.push(a)));return s}function gt(t,e,n,i,o,r){return i&&!i[_]&&(i=gt(i)),o&&!o[_]&&(o=gt(o,r)),et((function(r,s,a,u){var c,h,d,p,f=[],m=[],_=s.length,x=r||function(t,e,n){for(var i=0,o=e.length;i<o;i++)$(t,e[i],n);return n}(e||"*",a.nodeType?[a]:a,[]),y=!t||!r&&e?x:ft(x,f,t,a,u);if(n?n(y,p=o||(r?t:_||i)?[]:s,a,u):p=y,i)for(c=ft(p,m),i(c,[],a,u),h=c.length;h--;)(d=c[h])&&(p[m[h]]=!(y[m[h]]=d));if(r){if(o||t){if(o){for(c=[],h=p.length;h--;)(d=p[h])&&c.push(y[h]=d);o(null,p=[],c,u)}for(h=p.length;h--;)(d=p[h])&&(c=o?l.call(r,d):f[h])>-1&&(r[c]=!(s[c]=d))}}else p=ft(p===s?p.splice(_,p.length):p),o?o(null,s,p,u):g.apply(s,p)}))}function mt(t){for(var i,o,r,s=t.length,a=e.relative[t[0].type],u=a||e.relative[" "],c=a?1:0,h=dt((function(t){return t===i}),u,!0),d=dt((function(t){return l.call(i,t)>-1}),u,!0),p=[function(t,e,o){var r=!a&&(o||e!=n)||((i=e).nodeType?h(t,e,o):d(t,e,o));return i=null,r}];c<s;c++)if(o=e.relative[t[c].type])p=[dt(pt(p),o)];else{if((o=e.filter[t[c].type].apply(null,t[c].matches))[_]){for(r=++c;r<s&&!e.relative[t[r].type];r++);return gt(c>1&&pt(p),c>1&&ht(t.slice(0,c-1).concat({value:" "===t[c-2].type?"*":""})).replace(D,"$1"),o,c<r&&mt(t.slice(c,r)),r<s&&mt(t=t.slice(r)),r<s&&ht(t))}p.push(o)}return pt(p)}function _t(t,i){var o,r=[],s=[],a=T[t+" "];if(!a){for(i||(i=lt(t)),o=i.length;o--;)(a=mt(i[o]))[_]?r.push(a):s.push(a);a=T(t,function(t,i){var o=i.length>0,r=t.length>0,s=function(s,a,c,l,d){var p,f,m,_=0,y="0",w=s&&[],S=[],T=n,b=s||r&&e.find.TAG("*",d),v=x+=null==T?1:Math.random()||.1,C=b.length;for(d&&(n=a==u||a||d);y!==C&&null!=(p=b[y]);y++){if(r&&p){for(f=0,a||p.ownerDocument==u||(ut(p),c=!h);m=t[f++];)if(m(p,a||u,c)){g.call(l,p);break}d&&(x=v)}o&&((p=!m&&p)&&_--,s&&w.push(p))}if(_+=y,o&&y!==_){for(f=0;m=i[f++];)m(w,S,a,c);if(s){if(_>0)for(;y--;)w[y]||S[y]||(S[y]=N.call(l));S=ft(S)}g.apply(l,S),d&&!s&&S.length>0&&_+i.length>1&&E.uniqueSort(l)}return d&&(x=v,n=T),w};return o?et(s):s}(s,r)),a.selector=t}return a}function xt(t,n,i,o){var r,s,a,u,c,l="function"==typeof t&&t,d=!o&&lt(t=l.selector||t);if(i=i||[],1===d.length){if((s=d[0]=d[0].slice(0)).length>2&&"ID"===(a=s[0]).type&&9===n.nodeType&&h&&e.relative[s[1].type]){if(!(n=(e.find.ID(a.matches[0].replace(K,J),n)||[])[0]))return i;l&&(n=n.parentNode),t=t.slice(s.shift().value.length)}for(r=G.needsContext.test(t)?0:s.length;r--&&(a=s[r],!e.relative[u=a.type]);)if((c=e.find[u])&&(o=c(a.matches[0].replace(K,J),W.test(s[0].type)&&at(n.parentNode)||n))){if(s.splice(r,1),!(t=o.length&&ht(s)))return g.apply(i,o),i;break}}return(l||_t(t,d))(o,n,!h,i,!n||W.test(t)&&at(n.parentNode)||n),i}ct.prototype=e.filters=e.pseudos,e.setFilters=new ct,m.sortStable=_.split("").sort(v).join("")===_,ut(),m.sortDetached=nt((function(t){return 1&t.compareDocumentPosition(u.createElement("fieldset"))})),E.find=$,E.expr[":"]=E.expr.pseudos,E.unique=E.uniqueSort,$.compile=_t,$.select=xt,$.setDocument=ut,$.escape=E.escapeSelector,$.getText=E.text,$.isXML=E.isXMLDoc,$.selectors=E.expr,$.support=E.support,$.uniqueSort=E.uniqueSort}();var L=function(t,e,n){for(var i=[],o=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&E(t).is(n))break;i.push(t)}return i},B=function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n},X=E.expr.match.needsContext,U=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function k(t,e,n){return _(e)?E.grep(t,(function(t,i){return!!e.call(t,i,t)!==n})):e.nodeType?E.grep(t,(function(t){return t===e!==n})):"string"!=typeof e?E.grep(t,(function(t){return l.call(e,t)>-1!==n})):E.filter(e,t,n)}E.filter=function(t,e,n){var i=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?E.find.matchesSelector(i,t)?[i]:[]:E.find.matches(t,E.grep(e,(function(t){return 1===t.nodeType})))},E.fn.extend({find:function(t){var e,n,i=this.length,o=this;if("string"!=typeof t)return this.pushStack(E(t).filter((function(){for(e=0;e<i;e++)if(E.contains(o[e],this))return!0})));for(n=this.pushStack([]),e=0;e<i;e++)E.find(t,o[e],n);return i>1?E.uniqueSort(n):n},filter:function(t){return this.pushStack(k(this,t||[],!1))},not:function(t){return this.pushStack(k(this,t||[],!0))},is:function(t){return!!k(this,"string"==typeof t&&X.test(t)?E(t):t||[],!1).length}});var z,j=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(E.fn.init=function(t,e,n){var i,o;if(!t)return this;if(n=n||z,"string"==typeof t){if(!(i="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:j.exec(t))||!i[1]&&e)return!e||e.jquery?(e||n).find(t):this.constructor(e).find(t);if(i[1]){if(e=e instanceof E?e[0]:e,E.merge(this,E.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:y,!0)),U.test(i[1])&&E.isPlainObject(e))for(i in e)_(this[i])?this[i](e[i]):this.attr(i,e[i]);return this}return(o=y.getElementById(i[2]))&&(this[0]=o,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):_(t)?void 0!==n.ready?n.ready(t):t(E):E.makeArray(t,this)}).prototype=E.fn,z=E(y);var G=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function q(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}E.fn.extend({has:function(t){var e=E(t,this),n=e.length;return this.filter((function(){for(var t=0;t<n;t++)if(E.contains(this,e[t]))return!0}))},closest:function(t,e){var n,i=0,o=this.length,r=[],s="string"!=typeof t&&E(t);if(!X.test(t))for(;i<o;i++)for(n=this[i];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&E.find.matchesSelector(n,t))){r.push(n);break}return this.pushStack(r.length>1?E.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?l.call(E(t),this[0]):l.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(E.uniqueSort(E.merge(this.get(),E(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),E.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return L(t,"parentNode")},parentsUntil:function(t,e,n){return L(t,"parentNode",n)},next:function(t){return q(t,"nextSibling")},prev:function(t){return q(t,"previousSibling")},nextAll:function(t){return L(t,"nextSibling")},prevAll:function(t){return L(t,"previousSibling")},nextUntil:function(t,e,n){return L(t,"nextSibling",n)},prevUntil:function(t,e,n){return L(t,"previousSibling",n)},siblings:function(t){return B((t.parentNode||{}).firstChild,t)},children:function(t){return B(t.firstChild)},contents:function(t){return null!=t.contentDocument&&s(t.contentDocument)?t.contentDocument:(O(t,"template")&&(t=t.content||t),E.merge([],t.childNodes))}},(function(t,e){E.fn[t]=function(n,i){var o=E.map(this,e,n);return"Until"!==t.slice(-5)&&(i=n),i&&"string"==typeof i&&(o=E.filter(i,o)),this.length>1&&(H[t]||E.uniqueSort(o),G.test(t)&&o.reverse()),this.pushStack(o)}}));var Y=/[^\x20\t\r\n\f]+/g;function W(t){return t}function K(t){throw t}function J(t,e,n,i){var o;try{t&&_(o=t.promise)?o.call(t).done(e).fail(n):t&&_(o=t.then)?o.call(t,e,n):e.apply(void 0,[t].slice(i))}catch(t){n.apply(void 0,[t])}}E.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return E.each(t.match(Y)||[],(function(t,n){e[n]=!0})),e}(t):E.extend({},t);var e,n,i,o,r=[],s=[],a=-1,u=function(){for(o=o||t.once,i=e=!0;s.length;a=-1)for(n=s.shift();++a<r.length;)!1===r[a].apply(n[0],n[1])&&t.stopOnFalse&&(a=r.length,n=!1);t.memory||(n=!1),e=!1,o&&(r=n?[]:"")},c={add:function(){return r&&(n&&!e&&(a=r.length-1,s.push(n)),function e(n){E.each(n,(function(n,i){_(i)?t.unique&&c.has(i)||r.push(i):i&&i.length&&"string"!==T(i)&&e(i)}))}(arguments),n&&!e&&u()),this},remove:function(){return E.each(arguments,(function(t,e){for(var n;(n=E.inArray(e,r,n))>-1;)r.splice(n,1),n<=a&&a--})),this},has:function(t){return t?E.inArray(t,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return o=s=[],r=n="",this},disabled:function(){return!r},lock:function(){return o=s=[],n||e||(r=n=""),this},locked:function(){return!!o},fireWith:function(t,n){return o||(n=[t,(n=n||[]).slice?n.slice():n],s.push(n),e||u()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},E.extend({Deferred:function(t){var e=[["notify","progress",E.Callbacks("memory"),E.Callbacks("memory"),2],["resolve","done",E.Callbacks("once memory"),E.Callbacks("once memory"),0,"resolved"],["reject","fail",E.Callbacks("once memory"),E.Callbacks("once memory"),1,"rejected"]],n="pending",o={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},catch:function(t){return o.then(null,t)},pipe:function(){var t=arguments;return E.Deferred((function(n){E.each(e,(function(e,i){var o=_(t[i[4]])&&t[i[4]];r[i[1]]((function(){var t=o&&o.apply(this,arguments);t&&_(t.promise)?t.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this,o?[t]:arguments)}))})),t=null})).promise()},then:function(t,n,o){var r=0;function s(t,e,n,o){return function(){var a=this,u=arguments,c=function(){var i,c;if(!(t<r)){if((i=n.apply(a,u))===e.promise())throw new TypeError("Thenable self-resolution");c=i&&("object"==typeof i||"function"==typeof i)&&i.then,_(c)?o?c.call(i,s(r,e,W,o),s(r,e,K,o)):(r++,c.call(i,s(r,e,W,o),s(r,e,K,o),s(r,e,W,e.notifyWith))):(n!==W&&(a=void 0,u=[i]),(o||e.resolveWith)(a,u))}},l=o?c:function(){try{c()}catch(i){E.Deferred.exceptionHook&&E.Deferred.exceptionHook(i,l.error),t+1>=r&&(n!==K&&(a=void 0,u=[i]),e.rejectWith(a,u))}};t?l():(E.Deferred.getErrorHook?l.error=E.Deferred.getErrorHook():E.Deferred.getStackHook&&(l.error=E.Deferred.getStackHook()),i.setTimeout(l))}}return E.Deferred((function(i){e[0][3].add(s(0,i,_(o)?o:W,i.notifyWith)),e[1][3].add(s(0,i,_(t)?t:W)),e[2][3].add(s(0,i,_(n)?n:K))})).promise()},promise:function(t){return null!=t?E.extend(t,o):o}},r={};return E.each(e,(function(t,i){var s=i[2],a=i[5];o[i[1]]=s.add,a&&s.add((function(){n=a}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),s.add(i[3].fire),r[i[0]]=function(){return r[i[0]+"With"](this===r?void 0:this,arguments),this},r[i[0]+"With"]=s.fireWith})),o.promise(r),t&&t.call(r,r),r},when:function(t){var e=arguments.length,n=e,i=Array(n),o=a.call(arguments),r=E.Deferred(),s=function(t){return function(n){i[t]=this,o[t]=arguments.length>1?a.call(arguments):n,--e||r.resolveWith(i,o)}};if(e<=1&&(J(t,r.done(s(n)).resolve,r.reject,!e),"pending"===r.state()||_(o[n]&&o[n].then)))return r.then();for(;n--;)J(o[n],s(n),r.reject);return r.promise()}});var Z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;E.Deferred.exceptionHook=function(t,e){i.console&&i.console.warn&&t&&Z.test(t.name)&&i.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},E.readyException=function(t){i.setTimeout((function(){throw t}))};var Q=E.Deferred();function $(){y.removeEventListener("DOMContentLoaded",$),i.removeEventListener("load",$),E.ready()}E.fn.ready=function(t){return Q.then(t).catch((function(t){E.readyException(t)})),this},E.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--E.readyWait:E.isReady)||(E.isReady=!0,!0!==t&&--E.readyWait>0||Q.resolveWith(y,[E]))}}),E.ready.then=Q.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?i.setTimeout(E.ready):(y.addEventListener("DOMContentLoaded",$),i.addEventListener("load",$));var tt=function(t,e,n,i,o,r,s){var a=0,u=t.length,c=null==n;if("object"===T(n))for(a in o=!0,n)tt(t,e,a,n[a],!0,r,s);else if(void 0!==i&&(o=!0,_(i)||(s=!0),c&&(s?(e.call(t,i),e=null):(c=e,e=function(t,e,n){return c.call(E(t),n)})),e))for(;a<u;a++)e(t[a],n,s?i:i.call(t[a],a,e(t[a],n)));return o?t:c?e.call(t):u?e(t[0],n):r},et=/^-ms-/,nt=/-([a-z])/g;function it(t,e){return e.toUpperCase()}function ot(t){return t.replace(et,"ms-").replace(nt,it)}var rt=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function st(){this.expando=E.expando+st.uid++}st.uid=1,st.prototype={cache:function(t){var e=t[this.expando];return e||(e={},rt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,n){var i,o=this.cache(t);if("string"==typeof e)o[ot(e)]=n;else for(i in e)o[ot(i)]=e[i];return o},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][ot(e)]},access:function(t,e,n){return void 0===e||e&&"string"==typeof e&&void 0===n?this.get(t,e):(this.set(t,e,n),void 0!==n?n:e)},remove:function(t,e){var n,i=t[this.expando];if(void 0!==i){if(void 0!==e){n=(e=Array.isArray(e)?e.map(ot):(e=ot(e))in i?[e]:e.match(Y)||[]).length;for(;n--;)delete i[e[n]]}(void 0===e||E.isEmptyObject(i))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!E.isEmptyObject(e)}};var at=new st,ut=new st,ct=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,lt=/[A-Z]/g;function ht(t,e,n){var i;if(void 0===n&&1===t.nodeType)if(i="data-"+e.replace(lt,"-$&").toLowerCase(),"string"==typeof(n=t.getAttribute(i))){try{n=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:ct.test(t)?JSON.parse(t):t)}(n)}catch(t){}ut.set(t,e,n)}else n=void 0;return n}E.extend({hasData:function(t){return ut.hasData(t)||at.hasData(t)},data:function(t,e,n){return ut.access(t,e,n)},removeData:function(t,e){ut.remove(t,e)},_data:function(t,e,n){return at.access(t,e,n)},_removeData:function(t,e){at.remove(t,e)}}),E.fn.extend({data:function(t,e){var n,i,o,r=this[0],s=r&&r.attributes;if(void 0===t){if(this.length&&(o=ut.get(r),1===r.nodeType&&!at.get(r,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&0===(i=s[n].name).indexOf("data-")&&(i=ot(i.slice(5)),ht(r,i,o[i]));at.set(r,"hasDataAttrs",!0)}return o}return"object"==typeof t?this.each((function(){ut.set(this,t)})):tt(this,(function(e){var n;if(r&&void 0===e)return void 0!==(n=ut.get(r,t))||void 0!==(n=ht(r,t))?n:void 0;this.each((function(){ut.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){ut.remove(this,t)}))}}),E.extend({queue:function(t,e,n){var i;if(t)return e=(e||"fx")+"queue",i=at.get(t,e),n&&(!i||Array.isArray(n)?i=at.access(t,e,E.makeArray(n)):i.push(n)),i||[]},dequeue:function(t,e){e=e||"fx";var n=E.queue(t,e),i=n.length,o=n.shift(),r=E._queueHooks(t,e);"inprogress"===o&&(o=n.shift(),i--),o&&("fx"===e&&n.unshift("inprogress"),delete r.stop,o.call(t,(function(){E.dequeue(t,e)}),r)),!i&&r&&r.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return at.get(t,n)||at.access(t,n,{empty:E.Callbacks("once memory").add((function(){at.remove(t,[e+"queue",n])}))})}}),E.fn.extend({queue:function(t,e){var n=2;return"string"!=typeof t&&(e=t,t="fx",n--),arguments.length<n?E.queue(this[0],t):void 0===e?this:this.each((function(){var n=E.queue(this,t,e);E._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&E.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){E.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var n,i=1,o=E.Deferred(),r=this,s=this.length,a=function(){--i||o.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)(n=at.get(r[s],t+"queueHooks"))&&n.empty&&(i++,n.empty.add(a));return a(),o.promise(e)}});var dt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pt=new RegExp("^(?:([+-])=|)("+dt+")([a-z%]*)$","i"),ft=["Top","Right","Bottom","Left"],gt=y.documentElement,mt=function(t){return E.contains(t.ownerDocument,t)},_t={composed:!0};gt.getRootNode&&(mt=function(t){return E.contains(t.ownerDocument,t)||t.getRootNode(_t)===t.ownerDocument});var xt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&mt(t)&&"none"===E.css(t,"display")};function yt(t,e,n,i){var o,r,s=20,a=i?function(){return i.cur()}:function(){return E.css(t,e,"")},u=a(),c=n&&n[3]||(E.cssNumber[e]?"":"px"),l=t.nodeType&&(E.cssNumber[e]||"px"!==c&&+u)&&pt.exec(E.css(t,e));if(l&&l[3]!==c){for(u/=2,c=c||l[3],l=+u||1;s--;)E.style(t,e,l+c),(1-r)*(1-(r=a()/u||.5))<=0&&(s=0),l/=r;l*=2,E.style(t,e,l+c),n=n||[]}return n&&(l=+l||+u||0,o=n[1]?l+(n[1]+1)*n[2]:+n[2],i&&(i.unit=c,i.start=l,i.end=o)),o}var wt={};function St(t){var e,n=t.ownerDocument,i=t.nodeName,o=wt[i];return o||(e=n.body.appendChild(n.createElement(i)),o=E.css(e,"display"),e.parentNode.removeChild(e),"none"===o&&(o="block"),wt[i]=o,o)}function Tt(t,e){for(var n,i,o=[],r=0,s=t.length;r<s;r++)(i=t[r]).style&&(n=i.style.display,e?("none"===n&&(o[r]=at.get(i,"display")||null,o[r]||(i.style.display="")),""===i.style.display&&xt(i)&&(o[r]=St(i))):"none"!==n&&(o[r]="none",at.set(i,"display",n)));for(r=0;r<s;r++)null!=o[r]&&(t[r].style.display=o[r]);return t}E.fn.extend({show:function(){return Tt(this,!0)},hide:function(){return Tt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){xt(this)?E(this).show():E(this).hide()}))}});var bt,vt,Et=/^(?:checkbox|radio)$/i,Ct=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ot=/^$|^module$|\/(?:java|ecma)script/i;bt=y.createDocumentFragment().appendChild(y.createElement("div")),(vt=y.createElement("input")).setAttribute("type","radio"),vt.setAttribute("checked","checked"),vt.setAttribute("name","t"),bt.appendChild(vt),m.checkClone=bt.cloneNode(!0).cloneNode(!0).lastChild.checked,bt.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!bt.cloneNode(!0).lastChild.defaultValue,bt.innerHTML="<option></option>",m.option=!!bt.lastChild;var Nt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Ft(t,e){var n;return n=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&O(t,e)?E.merge([t],n):n}function It(t,e){for(var n=0,i=t.length;n<i;n++)at.set(t[n],"globalEval",!e||at.get(e[n],"globalEval"))}Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,m.option||(Nt.optgroup=Nt.option=[1,"<select multiple='multiple'>","</select>"]);var Mt=/<|&#?\w+;/;function Dt(t,e,n,i,o){for(var r,s,a,u,c,l,h=e.createDocumentFragment(),d=[],p=0,f=t.length;p<f;p++)if((r=t[p])||0===r)if("object"===T(r))E.merge(d,r.nodeType?[r]:r);else if(Mt.test(r)){for(s=s||h.appendChild(e.createElement("div")),a=(Ct.exec(r)||["",""])[1].toLowerCase(),u=Nt[a]||Nt._default,s.innerHTML=u[1]+E.htmlPrefilter(r)+u[2],l=u[0];l--;)s=s.lastChild;E.merge(d,s.childNodes),(s=h.firstChild).textContent=""}else d.push(e.createTextNode(r));for(h.textContent="",p=0;r=d[p++];)if(i&&E.inArray(r,i)>-1)o&&o.push(r);else if(c=mt(r),s=Ft(h.appendChild(r),"script"),c&&It(s),n)for(l=0;r=s[l++];)Ot.test(r.type||"")&&n.push(r);return h}var Rt=/^([^.]*)(?:\.(.+)|)/;function Vt(){return!0}function At(){return!1}function Pt(t,e,n,i,o,r){var s,a;if("object"==typeof e){for(a in"string"!=typeof n&&(i=i||n,n=void 0),e)Pt(t,a,n,i,e[a],r);return t}if(null==i&&null==o?(o=n,i=n=void 0):null==o&&("string"==typeof n?(o=i,i=void 0):(o=i,i=n,n=void 0)),!1===o)o=At;else if(!o)return t;return 1===r&&(s=o,o=function(t){return E().off(t),s.apply(this,arguments)},o.guid=s.guid||(s.guid=E.guid++)),t.each((function(){E.event.add(this,e,o,i,n)}))}function Lt(t,e,n){n?(at.set(t,e,!1),E.event.add(t,e,{namespace:!1,handler:function(t){var n,i=at.get(this,e);if(1&t.isTrigger&&this[e]){if(i)(E.event.special[e]||{}).delegateType&&t.stopPropagation();else if(i=a.call(arguments),at.set(this,e,i),this[e](),n=at.get(this,e),at.set(this,e,!1),i!==n)return t.stopImmediatePropagation(),t.preventDefault(),n}else i&&(at.set(this,e,E.event.trigger(i[0],i.slice(1),this)),t.stopPropagation(),t.isImmediatePropagationStopped=Vt)}})):void 0===at.get(t,e)&&E.event.add(t,e,Vt)}E.event={global:{},add:function(t,e,n,i,o){var r,s,a,u,c,l,h,d,p,f,g,m=at.get(t);if(rt(t))for(n.handler&&(n=(r=n).handler,o=r.selector),o&&E.find.matchesSelector(gt,o),n.guid||(n.guid=E.guid++),(u=m.events)||(u=m.events=Object.create(null)),(s=m.handle)||(s=m.handle=function(e){return void 0!==E&&E.event.triggered!==e.type?E.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(Y)||[""]).length;c--;)p=g=(a=Rt.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p&&(h=E.event.special[p]||{},p=(o?h.delegateType:h.bindType)||p,h=E.event.special[p]||{},l=E.extend({type:p,origType:g,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&E.expr.match.needsContext.test(o),namespace:f.join(".")},r),(d=u[p])||((d=u[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(t,i,f,s)||t.addEventListener&&t.addEventListener(p,s)),h.add&&(h.add.call(t,l),l.handler.guid||(l.handler.guid=n.guid)),o?d.splice(d.delegateCount++,0,l):d.push(l),E.event.global[p]=!0)},remove:function(t,e,n,i,o){var r,s,a,u,c,l,h,d,p,f,g,m=at.hasData(t)&&at.get(t);if(m&&(u=m.events)){for(c=(e=(e||"").match(Y)||[""]).length;c--;)if(p=g=(a=Rt.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p){for(h=E.event.special[p]||{},d=u[p=(i?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=r=d.length;r--;)l=d[r],!o&&g!==l.origType||n&&n.guid!==l.guid||a&&!a.test(l.namespace)||i&&i!==l.selector&&("**"!==i||!l.selector)||(d.splice(r,1),l.selector&&d.delegateCount--,h.remove&&h.remove.call(t,l));s&&!d.length&&(h.teardown&&!1!==h.teardown.call(t,f,m.handle)||E.removeEvent(t,p,m.handle),delete u[p])}else for(p in u)E.event.remove(t,p+e[c],n,i,!0);E.isEmptyObject(u)&&at.remove(t,"handle events")}},dispatch:function(t){var e,n,i,o,r,s,a=new Array(arguments.length),u=E.event.fix(t),c=(at.get(this,"events")||Object.create(null))[u.type]||[],l=E.event.special[u.type]||{};for(a[0]=u,e=1;e<arguments.length;e++)a[e]=arguments[e];if(u.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,u)){for(s=E.event.handlers.call(this,u,c),e=0;(o=s[e++])&&!u.isPropagationStopped();)for(u.currentTarget=o.elem,n=0;(r=o.handlers[n++])&&!u.isImmediatePropagationStopped();)u.rnamespace&&!1!==r.namespace&&!u.rnamespace.test(r.namespace)||(u.handleObj=r,u.data=r.data,void 0!==(i=((E.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,a))&&!1===(u.result=i)&&(u.preventDefault(),u.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,u),u.result}},handlers:function(t,e){var n,i,o,r,s,a=[],u=e.delegateCount,c=t.target;if(u&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(r=[],s={},n=0;n<u;n++)void 0===s[o=(i=e[n]).selector+" "]&&(s[o]=i.needsContext?E(o,this).index(c)>-1:E.find(o,this,null,[c]).length),s[o]&&r.push(i);r.length&&a.push({elem:c,handlers:r})}return c=this,u<e.length&&a.push({elem:c,handlers:e.slice(u)}),a},addProp:function(t,e){Object.defineProperty(E.Event.prototype,t,{enumerable:!0,configurable:!0,get:_(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[E.expando]?t:new E.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return Et.test(e.type)&&e.click&&O(e,"input")&&Lt(e,"click",!0),!1},trigger:function(t){var e=this||t;return Et.test(e.type)&&e.click&&O(e,"input")&&Lt(e,"click"),!0},_default:function(t){var e=t.target;return Et.test(e.type)&&e.click&&O(e,"input")&&at.get(e,"click")||O(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},E.removeEvent=function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n)},E.Event=function(t,e){if(!(this instanceof E.Event))return new E.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Vt:At,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&E.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[E.expando]=!0},E.Event.prototype={constructor:E.Event,isDefaultPrevented:At,isPropagationStopped:At,isImmediatePropagationStopped:At,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Vt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Vt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Vt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},E.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},E.event.addProp),E.each({focus:"focusin",blur:"focusout"},(function(t,e){function n(t){if(y.documentMode){var n=at.get(this,"handle"),i=E.event.fix(t);i.type="focusin"===t.type?"focus":"blur",i.isSimulated=!0,n(t),i.target===i.currentTarget&&n(i)}else E.event.simulate(e,t.target,E.event.fix(t))}E.event.special[t]={setup:function(){var i;if(Lt(this,t,!0),!y.documentMode)return!1;(i=at.get(this,e))||this.addEventListener(e,n),at.set(this,e,(i||0)+1)},trigger:function(){return Lt(this,t),!0},teardown:function(){var t;if(!y.documentMode)return!1;(t=at.get(this,e)-1)?at.set(this,e,t):(this.removeEventListener(e,n),at.remove(this,e))},_default:function(e){return at.get(e.target,t)},delegateType:e},E.event.special[e]={setup:function(){var i=this.ownerDocument||this.document||this,o=y.documentMode?this:i,r=at.get(o,e);r||(y.documentMode?this.addEventListener(e,n):i.addEventListener(t,n,!0)),at.set(o,e,(r||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,o=y.documentMode?this:i,r=at.get(o,e)-1;r?at.set(o,e,r):(y.documentMode?this.removeEventListener(e,n):i.removeEventListener(t,n,!0),at.remove(o,e))}}})),E.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){E.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,i=t.relatedTarget,o=t.handleObj;return i&&(i===this||E.contains(this,i))||(t.type=o.origType,n=o.handler.apply(this,arguments),t.type=e),n}}})),E.fn.extend({on:function(t,e,n,i){return Pt(this,t,e,n,i)},one:function(t,e,n,i){return Pt(this,t,e,n,i,1)},off:function(t,e,n){var i,o;if(t&&t.preventDefault&&t.handleObj)return i=t.handleObj,E(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof t){for(o in t)this.off(o,e,t[o]);return this}return!1!==e&&"function"!=typeof e||(n=e,e=void 0),!1===n&&(n=At),this.each((function(){E.event.remove(this,t,n,e)}))}});var Bt=/<script|<style|<link/i,Xt=/checked\s*(?:[^=]|=\s*.checked.)/i,Ut=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function kt(t,e){return O(t,"table")&&O(11!==e.nodeType?e:e.firstChild,"tr")&&E(t).children("tbody")[0]||t}function zt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function jt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Gt(t,e){var n,i,o,r,s,a;if(1===e.nodeType){if(at.hasData(t)&&(a=at.get(t).events))for(o in at.remove(e,"handle events"),a)for(n=0,i=a[o].length;n<i;n++)E.event.add(e,o,a[o][n]);ut.hasData(t)&&(r=ut.access(t),s=E.extend({},r),ut.set(e,s))}}function Ht(t,e){var n=e.nodeName.toLowerCase();"input"===n&&Et.test(t.type)?e.checked=t.checked:"input"!==n&&"textarea"!==n||(e.defaultValue=t.defaultValue)}function qt(t,e,n,i){e=u(e);var o,r,s,a,c,l,h=0,d=t.length,p=d-1,f=e[0],g=_(f);if(g||d>1&&"string"==typeof f&&!m.checkClone&&Xt.test(f))return t.each((function(o){var r=t.eq(o);g&&(e[0]=f.call(this,o,r.html())),qt(r,e,n,i)}));if(d&&(r=(o=Dt(e,t[0].ownerDocument,!1,t,i)).firstChild,1===o.childNodes.length&&(o=r),r||i)){for(a=(s=E.map(Ft(o,"script"),zt)).length;h<d;h++)c=o,h!==p&&(c=E.clone(c,!0,!0),a&&E.merge(s,Ft(c,"script"))),n.call(t[h],c,h);if(a)for(l=s[s.length-1].ownerDocument,E.map(s,jt),h=0;h<a;h++)c=s[h],Ot.test(c.type||"")&&!at.access(c,"globalEval")&&E.contains(l,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?E._evalUrl&&!c.noModule&&E._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},l):S(c.textContent.replace(Ut,""),c,l))}return t}function Yt(t,e,n){for(var i,o=e?E.filter(e,t):t,r=0;null!=(i=o[r]);r++)n||1!==i.nodeType||E.cleanData(Ft(i)),i.parentNode&&(n&&mt(i)&&It(Ft(i,"script")),i.parentNode.removeChild(i));return t}E.extend({htmlPrefilter:function(t){return t},clone:function(t,e,n){var i,o,r,s,a=t.cloneNode(!0),u=mt(t);if(!(m.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||E.isXMLDoc(t)))for(s=Ft(a),i=0,o=(r=Ft(t)).length;i<o;i++)Ht(r[i],s[i]);if(e)if(n)for(r=r||Ft(t),s=s||Ft(a),i=0,o=r.length;i<o;i++)Gt(r[i],s[i]);else Gt(t,a);return(s=Ft(a,"script")).length>0&&It(s,!u&&Ft(t,"script")),a},cleanData:function(t){for(var e,n,i,o=E.event.special,r=0;void 0!==(n=t[r]);r++)if(rt(n)){if(e=n[at.expando]){if(e.events)for(i in e.events)o[i]?E.event.remove(n,i):E.removeEvent(n,i,e.handle);n[at.expando]=void 0}n[ut.expando]&&(n[ut.expando]=void 0)}}}),E.fn.extend({detach:function(t){return Yt(this,t,!0)},remove:function(t){return Yt(this,t)},text:function(t){return tt(this,(function(t){return void 0===t?E.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return qt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||kt(this,t).appendChild(t)}))},prepend:function(){return qt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=kt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return qt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return qt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(E.cleanData(Ft(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return E.clone(this,t,e)}))},html:function(t){return tt(this,(function(t){var e=this[0]||{},n=0,i=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Bt.test(t)&&!Nt[(Ct.exec(t)||["",""])[1].toLowerCase()]){t=E.htmlPrefilter(t);try{for(;n<i;n++)1===(e=this[n]||{}).nodeType&&(E.cleanData(Ft(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return qt(this,arguments,(function(e){var n=this.parentNode;E.inArray(this,t)<0&&(E.cleanData(Ft(this)),n&&n.replaceChild(e,this))}),t)}}),E.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){E.fn[t]=function(t){for(var n,i=[],o=E(t),r=o.length-1,s=0;s<=r;s++)n=s===r?this:this.clone(!0),E(o[s])[e](n),c.apply(i,n.get());return this.pushStack(i)}}));var Wt=new RegExp("^("+dt+")(?!px)[a-z%]+$","i"),Kt=/^--/,Jt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=i),e.getComputedStyle(t)},Zt=function(t,e,n){var i,o,r={};for(o in e)r[o]=t.style[o],t.style[o]=e[o];for(o in i=n.call(t),e)t.style[o]=r[o];return i},Qt=new RegExp(ft.join("|"),"i");function $t(t,e,n){var i,o,r,s,a=Kt.test(e),u=t.style;return(n=n||Jt(t))&&(s=n.getPropertyValue(e)||n[e],a&&s&&(s=s.replace(D,"$1")||void 0),""!==s||mt(t)||(s=E.style(t,e)),!m.pixelBoxStyles()&&Wt.test(s)&&Qt.test(e)&&(i=u.width,o=u.minWidth,r=u.maxWidth,u.minWidth=u.maxWidth=u.width=s,s=n.width,u.width=i,u.minWidth=o,u.maxWidth=r)),void 0!==s?s+"":s}function te(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(l){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",gt.appendChild(c).appendChild(l);var t=i.getComputedStyle(l);n="1%"!==t.top,u=12===e(t.marginLeft),l.style.right="60%",s=36===e(t.right),o=36===e(t.width),l.style.position="absolute",r=12===e(l.offsetWidth/3),gt.removeChild(c),l=null}}function e(t){return Math.round(parseFloat(t))}var n,o,r,s,a,u,c=y.createElement("div"),l=y.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===l.style.backgroundClip,E.extend(m,{boxSizingReliable:function(){return t(),o},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),n},reliableMarginLeft:function(){return t(),u},scrollboxSize:function(){return t(),r},reliableTrDimensions:function(){var t,e,n,o;return null==a&&(t=y.createElement("table"),e=y.createElement("tr"),n=y.createElement("div"),t.style.cssText="position:absolute;left:-11111px;border-collapse:separate",e.style.cssText="border:1px solid",e.style.height="1px",n.style.height="9px",n.style.display="block",gt.appendChild(t).appendChild(e).appendChild(n),o=i.getComputedStyle(e),a=parseInt(o.height,10)+parseInt(o.borderTopWidth,10)+parseInt(o.borderBottomWidth,10)===e.offsetHeight,gt.removeChild(t)),a}}))}();var ee=["Webkit","Moz","ms"],ne=y.createElement("div").style,ie={};function oe(t){var e=E.cssProps[t]||ie[t];return e||(t in ne?t:ie[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),n=ee.length;n--;)if((t=ee[n]+e)in ne)return t}(t)||t)}var re=/^(none|table(?!-c[ea]).+)/,se={position:"absolute",visibility:"hidden",display:"block"},ae={letterSpacing:"0",fontWeight:"400"};function ue(t,e,n){var i=pt.exec(e);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):e}function ce(t,e,n,i,o,r){var s="width"===e?1:0,a=0,u=0,c=0;if(n===(i?"border":"content"))return 0;for(;s<4;s+=2)"margin"===n&&(c+=E.css(t,n+ft[s],!0,o)),i?("content"===n&&(u-=E.css(t,"padding"+ft[s],!0,o)),"margin"!==n&&(u-=E.css(t,"border"+ft[s]+"Width",!0,o))):(u+=E.css(t,"padding"+ft[s],!0,o),"padding"!==n?u+=E.css(t,"border"+ft[s]+"Width",!0,o):a+=E.css(t,"border"+ft[s]+"Width",!0,o));return!i&&r>=0&&(u+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-r-u-a-.5))||0),u+c}function le(t,e,n){var i=Jt(t),o=(!m.boxSizingReliable()||n)&&"border-box"===E.css(t,"boxSizing",!1,i),r=o,s=$t(t,e,i),a="offset"+e[0].toUpperCase()+e.slice(1);if(Wt.test(s)){if(!n)return s;s="auto"}return(!m.boxSizingReliable()&&o||!m.reliableTrDimensions()&&O(t,"tr")||"auto"===s||!parseFloat(s)&&"inline"===E.css(t,"display",!1,i))&&t.getClientRects().length&&(o="border-box"===E.css(t,"boxSizing",!1,i),(r=a in t)&&(s=t[a])),(s=parseFloat(s)||0)+ce(t,e,n||(o?"border":"content"),r,i,s)+"px"}function he(t,e,n,i,o){return new he.prototype.init(t,e,n,i,o)}E.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=$t(t,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,e,n,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,r,s,a=ot(e),u=Kt.test(e),c=t.style;if(u||(e=oe(a)),s=E.cssHooks[e]||E.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(o=s.get(t,!1,i))?o:c[e];"string"===(r=typeof n)&&(o=pt.exec(n))&&o[1]&&(n=yt(t,e,o),r="number"),null!=n&&n==n&&("number"!==r||u||(n+=o&&o[3]||(E.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==n||0!==e.indexOf("background")||(c[e]="inherit"),s&&"set"in s&&void 0===(n=s.set(t,n,i))||(u?c.setProperty(e,n):c[e]=n))}},css:function(t,e,n,i){var o,r,s,a=ot(e);return Kt.test(e)||(e=oe(a)),(s=E.cssHooks[e]||E.cssHooks[a])&&"get"in s&&(o=s.get(t,!0,n)),void 0===o&&(o=$t(t,e,i)),"normal"===o&&e in ae&&(o=ae[e]),""===n||n?(r=parseFloat(o),!0===n||isFinite(r)?r||0:o):o}}),E.each(["height","width"],(function(t,e){E.cssHooks[e]={get:function(t,n,i){if(n)return!re.test(E.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?le(t,e,i):Zt(t,se,(function(){return le(t,e,i)}))},set:function(t,n,i){var o,r=Jt(t),s=!m.scrollboxSize()&&"absolute"===r.position,a=(s||i)&&"border-box"===E.css(t,"boxSizing",!1,r),u=i?ce(t,e,i,a,r):0;return a&&s&&(u-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(r[e])-ce(t,e,"border",!1,r)-.5)),u&&(o=pt.exec(n))&&"px"!==(o[3]||"px")&&(t.style[e]=n,n=E.css(t,e)),ue(0,n,u)}}})),E.cssHooks.marginLeft=te(m.reliableMarginLeft,(function(t,e){if(e)return(parseFloat($t(t,"marginLeft"))||t.getBoundingClientRect().left-Zt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),E.each({margin:"",padding:"",border:"Width"},(function(t,e){E.cssHooks[t+e]={expand:function(n){for(var i=0,o={},r="string"==typeof n?n.split(" "):[n];i<4;i++)o[t+ft[i]+e]=r[i]||r[i-2]||r[0];return o}},"margin"!==t&&(E.cssHooks[t+e].set=ue)})),E.fn.extend({css:function(t,e){return tt(this,(function(t,e,n){var i,o,r={},s=0;if(Array.isArray(e)){for(i=Jt(t),o=e.length;s<o;s++)r[e[s]]=E.css(t,e[s],!1,i);return r}return void 0!==n?E.style(t,e,n):E.css(t,e)}),t,e,arguments.length>1)}}),E.Tween=he,he.prototype={constructor:he,init:function(t,e,n,i,o,r){this.elem=t,this.prop=n,this.easing=o||E.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=r||(E.cssNumber[n]?"":"px")},cur:function(){var t=he.propHooks[this.prop];return t&&t.get?t.get(this):he.propHooks._default.get(this)},run:function(t){var e,n=he.propHooks[this.prop];return this.options.duration?this.pos=e=E.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):he.propHooks._default.set(this),this}},he.prototype.init.prototype=he.prototype,he.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=E.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){E.fx.step[t.prop]?E.fx.step[t.prop](t):1!==t.elem.nodeType||!E.cssHooks[t.prop]&&null==t.elem.style[oe(t.prop)]?t.elem[t.prop]=t.now:E.style(t.elem,t.prop,t.now+t.unit)}}},he.propHooks.scrollTop=he.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},E.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},E.fx=he.prototype.init,E.fx.step={};var de,pe,fe=/^(?:toggle|show|hide)$/,ge=/queueHooks$/;function me(){pe&&(!1===y.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(me):i.setTimeout(me,E.fx.interval),E.fx.tick())}function _e(){return i.setTimeout((function(){de=void 0})),de=Date.now()}function xe(t,e){var n,i=0,o={height:t};for(e=e?1:0;i<4;i+=2-e)o["margin"+(n=ft[i])]=o["padding"+n]=t;return e&&(o.opacity=o.width=t),o}function ye(t,e,n){for(var i,o=(we.tweeners[e]||[]).concat(we.tweeners["*"]),r=0,s=o.length;r<s;r++)if(i=o[r].call(n,e,t))return i}function we(t,e,n){var i,o,r=0,s=we.prefilters.length,a=E.Deferred().always((function(){delete u.elem})),u=function(){if(o)return!1;for(var e=de||_e(),n=Math.max(0,c.startTime+c.duration-e),i=1-(n/c.duration||0),r=0,s=c.tweens.length;r<s;r++)c.tweens[r].run(i);return a.notifyWith(t,[c,i,n]),i<1&&s?n:(s||a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c]),!1)},c=a.promise({elem:t,props:E.extend({},e),opts:E.extend(!0,{specialEasing:{},easing:E.easing._default},n),originalProperties:e,originalOptions:n,startTime:de||_e(),duration:n.duration,tweens:[],createTween:function(e,n){var i=E.Tween(t,c.opts,e,n,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(i),i},stop:function(e){var n=0,i=e?c.tweens.length:0;if(o)return this;for(o=!0;n<i;n++)c.tweens[n].run(1);return e?(a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c,e])):a.rejectWith(t,[c,e]),this}}),l=c.props;for(!function(t,e){var n,i,o,r,s;for(n in t)if(o=e[i=ot(n)],r=t[n],Array.isArray(r)&&(o=r[1],r=t[n]=r[0]),n!==i&&(t[i]=r,delete t[n]),(s=E.cssHooks[i])&&"expand"in s)for(n in r=s.expand(r),delete t[i],r)n in t||(t[n]=r[n],e[n]=o);else e[i]=o}(l,c.opts.specialEasing);r<s;r++)if(i=we.prefilters[r].call(c,t,l,c.opts))return _(i.stop)&&(E._queueHooks(c.elem,c.opts.queue).stop=i.stop.bind(i)),i;return E.map(l,ye,c),_(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),E.fx.timer(E.extend(u,{elem:t,anim:c,queue:c.opts.queue})),c}E.Animation=E.extend(we,{tweeners:{"*":[function(t,e){var n=this.createTween(t,e);return yt(n.elem,t,pt.exec(e),n),n}]},tweener:function(t,e){_(t)?(e=t,t=["*"]):t=t.match(Y);for(var n,i=0,o=t.length;i<o;i++)n=t[i],we.tweeners[n]=we.tweeners[n]||[],we.tweeners[n].unshift(e)},prefilters:[function(t,e,n){var i,o,r,s,a,u,c,l,h="width"in e||"height"in e,d=this,p={},f=t.style,g=t.nodeType&&xt(t),m=at.get(t,"fxshow");for(i in n.queue||(null==(s=E._queueHooks(t,"fx")).unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,d.always((function(){d.always((function(){s.unqueued--,E.queue(t,"fx").length||s.empty.fire()}))}))),e)if(o=e[i],fe.test(o)){if(delete e[i],r=r||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!m||void 0===m[i])continue;g=!0}p[i]=m&&m[i]||E.style(t,i)}if((u=!E.isEmptyObject(e))||!E.isEmptyObject(p))for(i in h&&1===t.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=m&&m.display)&&(c=at.get(t,"display")),"none"===(l=E.css(t,"display"))&&(c?l=c:(Tt([t],!0),c=t.style.display||c,l=E.css(t,"display"),Tt([t]))),("inline"===l||"inline-block"===l&&null!=c)&&"none"===E.css(t,"float")&&(u||(d.done((function(){f.display=c})),null==c&&(l=f.display,c="none"===l?"":l)),f.display="inline-block")),n.overflow&&(f.overflow="hidden",d.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),u=!1,p)u||(m?"hidden"in m&&(g=m.hidden):m=at.access(t,"fxshow",{display:c}),r&&(m.hidden=!g),g&&Tt([t],!0),d.done((function(){for(i in g||Tt([t]),at.remove(t,"fxshow"),p)E.style(t,i,p[i])}))),u=ye(g?m[i]:0,i,d),i in m||(m[i]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(t,e){e?we.prefilters.unshift(t):we.prefilters.push(t)}}),E.speed=function(t,e,n){var i=t&&"object"==typeof t?E.extend({},t):{complete:n||!n&&e||_(t)&&t,duration:t,easing:n&&e||e&&!_(e)&&e};return E.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in E.fx.speeds?i.duration=E.fx.speeds[i.duration]:i.duration=E.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){_(i.old)&&i.old.call(this),i.queue&&E.dequeue(this,i.queue)},i},E.fn.extend({fadeTo:function(t,e,n,i){return this.filter(xt).css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(t,e,n,i){var o=E.isEmptyObject(t),r=E.speed(e,n,i),s=function(){var e=we(this,E.extend({},t),r);(o||at.get(this,"finish"))&&e.stop(!0)};return s.finish=s,o||!1===r.queue?this.each(s):this.queue(r.queue,s)},stop:function(t,e,n){var i=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,o=null!=t&&t+"queueHooks",r=E.timers,s=at.get(this);if(o)s[o]&&s[o].stop&&i(s[o]);else for(o in s)s[o]&&s[o].stop&&ge.test(o)&&i(s[o]);for(o=r.length;o--;)r[o].elem!==this||null!=t&&r[o].queue!==t||(r[o].anim.stop(n),e=!1,r.splice(o,1));!e&&n||E.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,n=at.get(this),i=n[t+"queue"],o=n[t+"queueHooks"],r=E.timers,s=i?i.length:0;for(n.finish=!0,E.queue(this,t,[]),o&&o.stop&&o.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;e<s;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete n.finish}))}}),E.each(["toggle","show","hide"],(function(t,e){var n=E.fn[e];E.fn[e]=function(t,i,o){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(xe(e,!0),t,i,o)}})),E.each({slideDown:xe("show"),slideUp:xe("hide"),slideToggle:xe("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){E.fn[t]=function(t,n,i){return this.animate(e,t,n,i)}})),E.timers=[],E.fx.tick=function(){var t,e=0,n=E.timers;for(de=Date.now();e<n.length;e++)(t=n[e])()||n[e]!==t||n.splice(e--,1);n.length||E.fx.stop(),de=void 0},E.fx.timer=function(t){E.timers.push(t),E.fx.start()},E.fx.interval=13,E.fx.start=function(){pe||(pe=!0,me())},E.fx.stop=function(){pe=null},E.fx.speeds={slow:600,fast:200,_default:400},E.fn.delay=function(t,e){return t=E.fx&&E.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,n){var o=i.setTimeout(e,t);n.stop=function(){i.clearTimeout(o)}}))},function(){var t=y.createElement("input"),e=y.createElement("select").appendChild(y.createElement("option"));t.type="checkbox",m.checkOn=""!==t.value,m.optSelected=e.selected,(t=y.createElement("input")).value="t",t.type="radio",m.radioValue="t"===t.value}();var Se,Te=E.expr.attrHandle;E.fn.extend({attr:function(t,e){return tt(this,E.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){E.removeAttr(this,t)}))}}),E.extend({attr:function(t,e,n){var i,o,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===t.getAttribute?E.prop(t,e,n):(1===r&&E.isXMLDoc(t)||(o=E.attrHooks[e.toLowerCase()]||(E.expr.match.bool.test(e)?Se:void 0)),void 0!==n?null===n?void E.removeAttr(t,e):o&&"set"in o&&void 0!==(i=o.set(t,n,e))?i:(t.setAttribute(e,n+""),n):o&&"get"in o&&null!==(i=o.get(t,e))?i:null==(i=E.find.attr(t,e))?void 0:i)},attrHooks:{type:{set:function(t,e){if(!m.radioValue&&"radio"===e&&O(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}},removeAttr:function(t,e){var n,i=0,o=e&&e.match(Y);if(o&&1===t.nodeType)for(;n=o[i++];)t.removeAttribute(n)}}),Se={set:function(t,e,n){return!1===e?E.removeAttr(t,n):t.setAttribute(n,n),n}},E.each(E.expr.match.bool.source.match(/\w+/g),(function(t,e){var n=Te[e]||E.find.attr;Te[e]=function(t,e,i){var o,r,s=e.toLowerCase();return i||(r=Te[s],Te[s]=o,o=null!=n(t,e,i)?s:null,Te[s]=r),o}}));var be=/^(?:input|select|textarea|button)$/i,ve=/^(?:a|area)$/i;function Ee(t){return(t.match(Y)||[]).join(" ")}function Ce(t){return t.getAttribute&&t.getAttribute("class")||""}function Oe(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(Y)||[]}E.fn.extend({prop:function(t,e){return tt(this,E.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[E.propFix[t]||t]}))}}),E.extend({prop:function(t,e,n){var i,o,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&E.isXMLDoc(t)||(e=E.propFix[e]||e,o=E.propHooks[e]),void 0!==n?o&&"set"in o&&void 0!==(i=o.set(t,n,e))?i:t[e]=n:o&&"get"in o&&null!==(i=o.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=E.find.attr(t,"tabindex");return e?parseInt(e,10):be.test(t.nodeName)||ve.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(E.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),E.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){E.propFix[this.toLowerCase()]=this})),E.fn.extend({addClass:function(t){var e,n,i,o,r,s;return _(t)?this.each((function(e){E(this).addClass(t.call(this,e,Ce(this)))})):(e=Oe(t)).length?this.each((function(){if(i=Ce(this),n=1===this.nodeType&&" "+Ee(i)+" "){for(r=0;r<e.length;r++)o=e[r],n.indexOf(" "+o+" ")<0&&(n+=o+" ");s=Ee(n),i!==s&&this.setAttribute("class",s)}})):this},removeClass:function(t){var e,n,i,o,r,s;return _(t)?this.each((function(e){E(this).removeClass(t.call(this,e,Ce(this)))})):arguments.length?(e=Oe(t)).length?this.each((function(){if(i=Ce(this),n=1===this.nodeType&&" "+Ee(i)+" "){for(r=0;r<e.length;r++)for(o=e[r];n.indexOf(" "+o+" ")>-1;)n=n.replace(" "+o+" "," ");s=Ee(n),i!==s&&this.setAttribute("class",s)}})):this:this.attr("class","")},toggleClass:function(t,e){var n,i,o,r,s=typeof t,a="string"===s||Array.isArray(t);return _(t)?this.each((function(n){E(this).toggleClass(t.call(this,n,Ce(this),e),e)})):"boolean"==typeof e&&a?e?this.addClass(t):this.removeClass(t):(n=Oe(t),this.each((function(){if(a)for(r=E(this),o=0;o<n.length;o++)i=n[o],r.hasClass(i)?r.removeClass(i):r.addClass(i);else void 0!==t&&"boolean"!==s||((i=Ce(this))&&at.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",i||!1===t?"":at.get(this,"__className__")||""))})))},hasClass:function(t){var e,n,i=0;for(e=" "+t+" ";n=this[i++];)if(1===n.nodeType&&(" "+Ee(Ce(n))+" ").indexOf(e)>-1)return!0;return!1}});var Ne=/\r/g;E.fn.extend({val:function(t){var e,n,i,o=this[0];return arguments.length?(i=_(t),this.each((function(n){var o;1===this.nodeType&&(null==(o=i?t.call(this,n,E(this).val()):t)?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=E.map(o,(function(t){return null==t?"":t+""}))),(e=E.valHooks[this.type]||E.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,o,"value")||(this.value=o))}))):o?(e=E.valHooks[o.type]||E.valHooks[o.nodeName.toLowerCase()])&&"get"in e&&void 0!==(n=e.get(o,"value"))?n:"string"==typeof(n=o.value)?n.replace(Ne,""):null==n?"":n:void 0}}),E.extend({valHooks:{option:{get:function(t){var e=E.find.attr(t,"value");return null!=e?e:Ee(E.text(t))}},select:{get:function(t){var e,n,i,o=t.options,r=t.selectedIndex,s="select-one"===t.type,a=s?null:[],u=s?r+1:o.length;for(i=r<0?u:s?r:0;i<u;i++)if(((n=o[i]).selected||i===r)&&!n.disabled&&(!n.parentNode.disabled||!O(n.parentNode,"optgroup"))){if(e=E(n).val(),s)return e;a.push(e)}return a},set:function(t,e){for(var n,i,o=t.options,r=E.makeArray(e),s=o.length;s--;)((i=o[s]).selected=E.inArray(E.valHooks.option.get(i),r)>-1)&&(n=!0);return n||(t.selectedIndex=-1),r}}}}),E.each(["radio","checkbox"],(function(){E.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=E.inArray(E(t).val(),e)>-1}},m.checkOn||(E.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var Fe=i.location,Ie={guid:Date.now()},Me=/\?/;E.parseXML=function(t){var e,n;if(!t||"string"!=typeof t)return null;try{e=(new i.DOMParser).parseFromString(t,"text/xml")}catch(t){}return n=e&&e.getElementsByTagName("parsererror")[0],e&&!n||E.error("Invalid XML: "+(n?E.map(n.childNodes,(function(t){return t.textContent})).join("\n"):t)),e};var De=/^(?:focusinfocus|focusoutblur)$/,Re=function(t){t.stopPropagation()};E.extend(E.event,{trigger:function(t,e,n,o){var r,s,a,u,c,l,h,d,f=[n||y],g=p.call(t,"type")?t.type:t,m=p.call(t,"namespace")?t.namespace.split("."):[];if(s=d=a=n=n||y,3!==n.nodeType&&8!==n.nodeType&&!De.test(g+E.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),c=g.indexOf(":")<0&&"on"+g,(t=t[E.expando]?t:new E.Event(g,"object"==typeof t&&t)).isTrigger=o?2:3,t.namespace=m.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),e=null==e?[t]:E.makeArray(e,[t]),h=E.event.special[g]||{},o||!h.trigger||!1!==h.trigger.apply(n,e))){if(!o&&!h.noBubble&&!x(n)){for(u=h.delegateType||g,De.test(u+g)||(s=s.parentNode);s;s=s.parentNode)f.push(s),a=s;a===(n.ownerDocument||y)&&f.push(a.defaultView||a.parentWindow||i)}for(r=0;(s=f[r++])&&!t.isPropagationStopped();)d=s,t.type=r>1?u:h.bindType||g,(l=(at.get(s,"events")||Object.create(null))[t.type]&&at.get(s,"handle"))&&l.apply(s,e),(l=c&&s[c])&&l.apply&&rt(s)&&(t.result=l.apply(s,e),!1===t.result&&t.preventDefault());return t.type=g,o||t.isDefaultPrevented()||h._default&&!1!==h._default.apply(f.pop(),e)||!rt(n)||c&&_(n[g])&&!x(n)&&((a=n[c])&&(n[c]=null),E.event.triggered=g,t.isPropagationStopped()&&d.addEventListener(g,Re),n[g](),t.isPropagationStopped()&&d.removeEventListener(g,Re),E.event.triggered=void 0,a&&(n[c]=a)),t.result}},simulate:function(t,e,n){var i=E.extend(new E.Event,n,{type:t,isSimulated:!0});E.event.trigger(i,null,e)}}),E.fn.extend({trigger:function(t,e){return this.each((function(){E.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var n=this[0];if(n)return E.event.trigger(t,e,n,!0)}});var Ve=/\[\]$/,Ae=/\r?\n/g,Pe=/^(?:submit|button|image|reset|file)$/i,Le=/^(?:input|select|textarea|keygen)/i;function Be(t,e,n,i){var o;if(Array.isArray(e))E.each(e,(function(e,o){n||Ve.test(t)?i(t,o):Be(t+"["+("object"==typeof o&&null!=o?e:"")+"]",o,n,i)}));else if(n||"object"!==T(e))i(t,e);else for(o in e)Be(t+"["+o+"]",e[o],n,i)}E.param=function(t,e){var n,i=[],o=function(t,e){var n=_(e)?e():e;i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==n?"":n)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!E.isPlainObject(t))E.each(t,(function(){o(this.name,this.value)}));else for(n in t)Be(n,t[n],e,o);return i.join("&")},E.fn.extend({serialize:function(){return E.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=E.prop(this,"elements");return t?E.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!E(this).is(":disabled")&&Le.test(this.nodeName)&&!Pe.test(t)&&(this.checked||!Et.test(t))})).map((function(t,e){var n=E(this).val();return null==n?null:Array.isArray(n)?E.map(n,(function(t){return{name:e.name,value:t.replace(Ae,"\r\n")}})):{name:e.name,value:n.replace(Ae,"\r\n")}})).get()}});var Xe=/%20/g,Ue=/#.*$/,ke=/([?&])_=[^&]*/,ze=/^(.*?):[ \t]*([^\r\n]*)$/gm,je=/^(?:GET|HEAD)$/,Ge=/^\/\//,He={},qe={},Ye="*/".concat("*"),We=y.createElement("a");function Ke(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var i,o=0,r=e.toLowerCase().match(Y)||[];if(_(n))for(;i=r[o++];)"+"===i[0]?(i=i.slice(1)||"*",(t[i]=t[i]||[]).unshift(n)):(t[i]=t[i]||[]).push(n)}}function Je(t,e,n,i){var o={},r=t===qe;function s(a){var u;return o[a]=!0,E.each(t[a]||[],(function(t,a){var c=a(e,n,i);return"string"!=typeof c||r||o[c]?r?!(u=c):void 0:(e.dataTypes.unshift(c),s(c),!1)})),u}return s(e.dataTypes[0])||!o["*"]&&s("*")}function Ze(t,e){var n,i,o=E.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((o[n]?t:i||(i={}))[n]=e[n]);return i&&E.extend(!0,t,i),t}We.href=Fe.href,E.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Fe.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Fe.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ye,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":E.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?Ze(Ze(t,E.ajaxSettings),e):Ze(E.ajaxSettings,t)},ajaxPrefilter:Ke(He),ajaxTransport:Ke(qe),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,o,r,s,a,u,c,l,h,d,p=E.ajaxSetup({},e),f=p.context||p,g=p.context&&(f.nodeType||f.jquery)?E(f):E.event,m=E.Deferred(),_=E.Callbacks("once memory"),x=p.statusCode||{},w={},S={},T="canceled",b={readyState:0,getResponseHeader:function(t){var e;if(c){if(!s)for(s={};e=ze.exec(r);)s[e[1].toLowerCase()+" "]=(s[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=s[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return c?r:null},setRequestHeader:function(t,e){return null==c&&(t=S[t.toLowerCase()]=S[t.toLowerCase()]||t,w[t]=e),this},overrideMimeType:function(t){return null==c&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)b.always(t[b.status]);else for(e in t)x[e]=[x[e],t[e]];return this},abort:function(t){var e=t||T;return n&&n.abort(e),v(0,e),this}};if(m.promise(b),p.url=((t||p.url||Fe.href)+"").replace(Ge,Fe.protocol+"//"),p.type=e.method||e.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(Y)||[""],null==p.crossDomain){u=y.createElement("a");try{u.href=p.url,u.href=u.href,p.crossDomain=We.protocol+"//"+We.host!=u.protocol+"//"+u.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=E.param(p.data,p.traditional)),Je(He,p,e,b),c)return b;for(h in(l=E.event&&p.global)&&0==E.active++&&E.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!je.test(p.type),o=p.url.replace(Ue,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Xe,"+")):(d=p.url.slice(o.length),p.data&&(p.processData||"string"==typeof p.data)&&(o+=(Me.test(o)?"&":"?")+p.data,delete p.data),!1===p.cache&&(o=o.replace(ke,"$1"),d=(Me.test(o)?"&":"?")+"_="+Ie.guid+++d),p.url=o+d),p.ifModified&&(E.lastModified[o]&&b.setRequestHeader("If-Modified-Since",E.lastModified[o]),E.etag[o]&&b.setRequestHeader("If-None-Match",E.etag[o])),(p.data&&p.hasContent&&!1!==p.contentType||e.contentType)&&b.setRequestHeader("Content-Type",p.contentType),b.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ye+"; q=0.01":""):p.accepts["*"]),p.headers)b.setRequestHeader(h,p.headers[h]);if(p.beforeSend&&(!1===p.beforeSend.call(f,b,p)||c))return b.abort();if(T="abort",_.add(p.complete),b.done(p.success),b.fail(p.error),n=Je(qe,p,e,b)){if(b.readyState=1,l&&g.trigger("ajaxSend",[b,p]),c)return b;p.async&&p.timeout>0&&(a=i.setTimeout((function(){b.abort("timeout")}),p.timeout));try{c=!1,n.send(w,v)}catch(t){if(c)throw t;v(-1,t)}}else v(-1,"No Transport");function v(t,e,s,u){var h,d,y,w,S,T=e;c||(c=!0,a&&i.clearTimeout(a),n=void 0,r=u||"",b.readyState=t>0?4:0,h=t>=200&&t<300||304===t,s&&(w=function(t,e,n){for(var i,o,r,s,a=t.contents,u=t.dataTypes;"*"===u[0];)u.shift(),void 0===i&&(i=t.mimeType||e.getResponseHeader("Content-Type"));if(i)for(o in a)if(a[o]&&a[o].test(i)){u.unshift(o);break}if(u[0]in n)r=u[0];else{for(o in n){if(!u[0]||t.converters[o+" "+u[0]]){r=o;break}s||(s=o)}r=r||s}if(r)return r!==u[0]&&u.unshift(r),n[r]}(p,b,s)),!h&&E.inArray("script",p.dataTypes)>-1&&E.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),w=function(t,e,n,i){var o,r,s,a,u,c={},l=t.dataTypes.slice();if(l[1])for(s in t.converters)c[s.toLowerCase()]=t.converters[s];for(r=l.shift();r;)if(t.responseFields[r]&&(n[t.responseFields[r]]=e),!u&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),u=r,r=l.shift())if("*"===r)r=u;else if("*"!==u&&u!==r){if(!(s=c[u+" "+r]||c["* "+r]))for(o in c)if((a=o.split(" "))[1]===r&&(s=c[u+" "+a[0]]||c["* "+a[0]])){!0===s?s=c[o]:!0!==c[o]&&(r=a[0],l.unshift(a[1]));break}if(!0!==s)if(s&&t.throws)e=s(e);else try{e=s(e)}catch(t){return{state:"parsererror",error:s?t:"No conversion from "+u+" to "+r}}}return{state:"success",data:e}}(p,w,b,h),h?(p.ifModified&&((S=b.getResponseHeader("Last-Modified"))&&(E.lastModified[o]=S),(S=b.getResponseHeader("etag"))&&(E.etag[o]=S)),204===t||"HEAD"===p.type?T="nocontent":304===t?T="notmodified":(T=w.state,d=w.data,h=!(y=w.error))):(y=T,!t&&T||(T="error",t<0&&(t=0))),b.status=t,b.statusText=(e||T)+"",h?m.resolveWith(f,[d,T,b]):m.rejectWith(f,[b,T,y]),b.statusCode(x),x=void 0,l&&g.trigger(h?"ajaxSuccess":"ajaxError",[b,p,h?d:y]),_.fireWith(f,[b,T]),l&&(g.trigger("ajaxComplete",[b,p]),--E.active||E.event.trigger("ajaxStop")))}return b},getJSON:function(t,e,n){return E.get(t,e,n,"json")},getScript:function(t,e){return E.get(t,void 0,e,"script")}}),E.each(["get","post"],(function(t,e){E[e]=function(t,n,i,o){return _(n)&&(o=o||i,i=n,n=void 0),E.ajax(E.extend({url:t,type:e,dataType:o,data:n,success:i},E.isPlainObject(t)&&t))}})),E.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),E._evalUrl=function(t,e,n){return E.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){E.globalEval(t,e,n)}})},E.fn.extend({wrapAll:function(t){var e;return this[0]&&(_(t)&&(t=t.call(this[0])),e=E(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return _(t)?this.each((function(e){E(this).wrapInner(t.call(this,e))})):this.each((function(){var e=E(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)}))},wrap:function(t){var e=_(t);return this.each((function(n){E(this).wrapAll(e?t.call(this,n):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){E(this).replaceWith(this.childNodes)})),this}}),E.expr.pseudos.hidden=function(t){return!E.expr.pseudos.visible(t)},E.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},E.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(t){}};var Qe={0:200,1223:204},$e=E.ajaxSettings.xhr();m.cors=!!$e&&"withCredentials"in $e,m.ajax=$e=!!$e,E.ajaxTransport((function(t){var e,n;if(m.cors||$e&&!t.crossDomain)return{send:function(o,r){var s,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)a[s]=t.xhrFields[s];for(s in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest"),o)a.setRequestHeader(s,o[s]);e=function(t){return function(){e&&(e=n=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?r(0,"error"):r(a.status,a.statusText):r(Qe[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=e(),n=a.onerror=a.ontimeout=e("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){e&&n()}))},e=e("abort");try{a.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}})),E.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),E.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return E.globalEval(t),t}}}),E.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),E.ajaxTransport("script",(function(t){var e,n;if(t.crossDomain||t.scriptAttrs)return{send:function(i,o){e=E("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",n=function(t){e.remove(),n=null,t&&o("error"===t.type?404:200,t.type)}),y.head.appendChild(e[0])},abort:function(){n&&n()}}}));var tn,en=[],nn=/(=)\?(?=&|$)|\?\?/;E.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=en.pop()||E.expando+"_"+Ie.guid++;return this[t]=!0,t}}),E.ajaxPrefilter("json jsonp",(function(t,e,n){var o,r,s,a=!1!==t.jsonp&&(nn.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&nn.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return o=t.jsonpCallback=_(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(nn,"$1"+o):!1!==t.jsonp&&(t.url+=(Me.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return s||E.error(o+" was not called"),s[0]},t.dataTypes[0]="json",r=i[o],i[o]=function(){s=arguments},n.always((function(){void 0===r?E(i).removeProp(o):i[o]=r,t[o]&&(t.jsonpCallback=e.jsonpCallback,en.push(o)),s&&_(r)&&r(s[0]),s=r=void 0})),"script"})),m.createHTMLDocument=((tn=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===tn.childNodes.length),E.parseHTML=function(t,e,n){return"string"!=typeof t?[]:("boolean"==typeof e&&(n=e,e=!1),e||(m.createHTMLDocument?((i=(e=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,e.head.appendChild(i)):e=y),r=!n&&[],(o=U.exec(t))?[e.createElement(o[1])]:(o=Dt([t],e,r),r&&r.length&&E(r).remove(),E.merge([],o.childNodes)));var i,o,r},E.fn.load=function(t,e,n){var i,o,r,s=this,a=t.indexOf(" ");return a>-1&&(i=Ee(t.slice(a)),t=t.slice(0,a)),_(e)?(n=e,e=void 0):e&&"object"==typeof e&&(o="POST"),s.length>0&&E.ajax({url:t,type:o||"GET",dataType:"html",data:e}).done((function(t){r=arguments,s.html(i?E("<div>").append(E.parseHTML(t)).find(i):t)})).always(n&&function(t,e){s.each((function(){n.apply(this,r||[t.responseText,e,t])}))}),this},E.expr.pseudos.animated=function(t){return E.grep(E.timers,(function(e){return t===e.elem})).length},E.offset={setOffset:function(t,e,n){var i,o,r,s,a,u,c=E.css(t,"position"),l=E(t),h={};"static"===c&&(t.style.position="relative"),a=l.offset(),r=E.css(t,"top"),u=E.css(t,"left"),("absolute"===c||"fixed"===c)&&(r+u).indexOf("auto")>-1?(s=(i=l.position()).top,o=i.left):(s=parseFloat(r)||0,o=parseFloat(u)||0),_(e)&&(e=e.call(t,n,E.extend({},a))),null!=e.top&&(h.top=e.top-a.top+s),null!=e.left&&(h.left=e.left-a.left+o),"using"in e?e.using.call(t,h):l.css(h)}},E.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){E.offset.setOffset(this,t,e)}));var e,n,i=this[0];return i?i.getClientRects().length?(e=i.getBoundingClientRect(),n=i.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,n,i=this[0],o={top:0,left:0};if("fixed"===E.css(i,"position"))e=i.getBoundingClientRect();else{for(e=this.offset(),n=i.ownerDocument,t=i.offsetParent||n.documentElement;t&&(t===n.body||t===n.documentElement)&&"static"===E.css(t,"position");)t=t.parentNode;t&&t!==i&&1===t.nodeType&&((o=E(t).offset()).top+=E.css(t,"borderTopWidth",!0),o.left+=E.css(t,"borderLeftWidth",!0))}return{top:e.top-o.top-E.css(i,"marginTop",!0),left:e.left-o.left-E.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===E.css(t,"position");)t=t.offsetParent;return t||gt}))}}),E.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var n="pageYOffset"===e;E.fn[t]=function(i){return tt(this,(function(t,i,o){var r;if(x(t)?r=t:9===t.nodeType&&(r=t.defaultView),void 0===o)return r?r[e]:t[i];r?r.scrollTo(n?r.pageXOffset:o,n?o:r.pageYOffset):t[i]=o}),t,i,arguments.length)}})),E.each(["top","left"],(function(t,e){E.cssHooks[e]=te(m.pixelPosition,(function(t,n){if(n)return n=$t(t,e),Wt.test(n)?E(t).position()[e]+"px":n}))})),E.each({Height:"height",Width:"width"},(function(t,e){E.each({padding:"inner"+t,content:e,"":"outer"+t},(function(n,i){E.fn[i]=function(o,r){var s=arguments.length&&(n||"boolean"!=typeof o),a=n||(!0===o||!0===r?"margin":"border");return tt(this,(function(e,n,o){var r;return x(e)?0===i.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):void 0===o?E.css(e,n,a):E.style(e,n,o,a)}),e,s?o:void 0,s)}}))})),E.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){E.fn[e]=function(t){return this.on(e,t)}})),E.fn.extend({bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),E.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){E.fn[e]=function(t,n){return arguments.length>0?this.on(e,null,t,n):this.trigger(e)}}));var on=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;E.proxy=function(t,e){var n,i,o;if("string"==typeof e&&(n=t[e],e=t,t=n),_(t))return i=a.call(arguments,2),o=function(){return t.apply(e||this,i.concat(a.call(arguments)))},o.guid=t.guid=t.guid||E.guid++,o},E.holdReady=function(t){t?E.readyWait++:E.ready(!0)},E.isArray=Array.isArray,E.parseJSON=JSON.parse,E.nodeName=O,E.isFunction=_,E.isWindow=x,E.camelCase=ot,E.type=T,E.now=Date.now,E.isNumeric=function(t){var e=E.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},E.trim=function(t){return null==t?"":(t+"").replace(on,"$1")},void 0===(n=function(){return E}.apply(e,[]))||(t.exports=n);var rn=i.jQuery,sn=i.$;return E.noConflict=function(t){return i.$===E&&(i.$=sn),t&&i.jQuery===E&&(i.jQuery=rn),E},void 0===o&&(i.jQuery=i.$=E),E}))},513:t=>{var e={DEBUG:!1,assert:function(t,n){if(e.DEBUG&&!t)throw new Error("Assertion failed"+(n?": "+n:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901}};e.PQHandle,e.geom={},e.geom.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},e.geom.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},e.geom.edgeEval=function(t,e,n){var i=e.s-t.s,o=n.s-e.s;return i+o>0?i<o?e.t-t.t+(t.t-n.t)*(i/(i+o)):e.t-n.t+(n.t-t.t)*(o/(i+o)):0},e.geom.edgeSign=function(t,e,n){var i=e.s-t.s,o=n.s-e.s;return i+o>0?(e.t-n.t)*i+(e.t-t.t)*o:0},e.geom.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},e.geom.transEval=function(t,e,n){var i=e.t-t.t,o=n.t-e.t;return i+o>0?i<o?e.s-t.s+(t.s-n.s)*(i/(i+o)):e.s-n.s+(n.s-t.s)*(o/(i+o)):0},e.geom.transSign=function(t,e,n){var i=e.t-t.t,o=n.t-e.t;return i+o>0?(e.s-n.s)*i+(e.s-t.s)*o:0},e.geom.edgeGoesLeft=function(t){return e.geom.vertLeq(t.dst(),t.org)},e.geom.edgeGoesRight=function(t){return e.geom.vertLeq(t.org,t.dst())},e.geom.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},e.geom.vertCCW=function(t,e,n){return t.s*(e.t-n.t)+e.s*(n.t-t.t)+n.s*(t.t-e.t)>=0},e.geom.interpolate_=function(t,e,n,i){return(t=t<0?0:t)<=(n=n<0?0:n)?0===n?(e+i)/2:e+t/(t+n)*(i-e):i+n/(t+n)*(e-i)},e.geom.edgeIntersect=function(t,n,i,o,r){var s,a,u;e.geom.vertLeq(t,n)||(u=t,t=n,n=u),e.geom.vertLeq(i,o)||(u=i,i=o,o=u),e.geom.vertLeq(t,i)||(u=t,t=i,i=u,u=n,n=o,o=u),e.geom.vertLeq(i,n)?e.geom.vertLeq(n,o)?((s=e.geom.edgeEval(t,i,n))+(a=e.geom.edgeEval(i,n,o))<0&&(s=-s,a=-a),r.s=e.geom.interpolate_(s,i.s,a,n.s)):((s=e.geom.edgeSign(t,i,n))+(a=-e.geom.edgeSign(t,o,n))<0&&(s=-s,a=-a),r.s=e.geom.interpolate_(s,i.s,a,o.s)):r.s=(i.s+n.s)/2,e.geom.transLeq(t,n)||(u=t,t=n,n=u),e.geom.transLeq(i,o)||(u=i,i=o,o=u),e.geom.transLeq(t,i)||(u=t,t=i,i=u,u=n,n=o,o=u),e.geom.transLeq(i,n)?e.geom.transLeq(n,o)?((s=e.geom.transEval(t,i,n))+(a=e.geom.transEval(i,n,o))<0&&(s=-s,a=-a),r.t=e.geom.interpolate_(s,i.t,a,n.t)):((s=e.geom.transSign(t,i,n))+(a=-e.geom.transSign(t,o,n))<0&&(s=-s,a=-a),r.t=e.geom.interpolate_(s,i.t,a,o.t)):r.t=(i.t+n.t)/2},e.mesh={},e.mesh.makeEdge=function(t){var n=e.mesh.makeEdgePair_(t.eHead);return e.mesh.makeVertex_(n,t.vHead),e.mesh.makeVertex_(n.sym,t.vHead),e.mesh.makeFace_(n,t.fHead),n},e.mesh.meshSplice=function(t,n){var i=!1,o=!1;t!==n&&(n.org!==t.org&&(o=!0,e.mesh.killVertex_(n.org,t.org)),n.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(n.lFace,t.lFace)),e.mesh.splice_(n,t),o||(e.mesh.makeVertex_(n,t.org),t.org.anEdge=t),i||(e.mesh.makeFace_(n,t.lFace),t.lFace.anEdge=t))},e.mesh.deleteEdge=function(t){var n=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,e.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?e.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,e.mesh.splice_(t,t.oPrev()),i||e.mesh.makeFace_(t,t.lFace)),n.oNext===n?(e.mesh.killVertex_(n.org,null),e.mesh.killFace_(n.lFace,null)):(t.lFace.anEdge=n.oPrev(),n.org.anEdge=n.oNext,e.mesh.splice_(n,n.oPrev())),e.mesh.killEdge_(t)},e.mesh.addEdgeVertex=function(t){var n=e.mesh.makeEdgePair_(t),i=n.sym;return e.mesh.splice_(n,t.lNext),n.org=t.dst(),e.mesh.makeVertex_(i,n.org),n.lFace=i.lFace=t.lFace,n},e.mesh.splitEdge=function(t){var n=e.mesh.addEdgeVertex(t).sym;return e.mesh.splice_(t.sym,t.sym.oPrev()),e.mesh.splice_(t.sym,n),t.sym.org=n.org,n.dst().anEdge=n.sym,n.sym.lFace=t.rFace(),n.winding=t.winding,n.sym.winding=t.sym.winding,n},e.mesh.connect=function(t,n){var i=!1,o=e.mesh.makeEdgePair_(t),r=o.sym;return n.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(n.lFace,t.lFace)),e.mesh.splice_(o,t.lNext),e.mesh.splice_(r,n),o.org=t.dst(),r.org=n.org,o.lFace=r.lFace=t.lFace,t.lFace.anEdge=r,i||e.mesh.makeFace_(o,t.lFace),o},e.mesh.zapFace=function(t){var n,i=t.anEdge,o=i.lNext;do{if(o=(n=o).lNext,n.lFace=null,null===n.rFace()){n.oNext===n?e.mesh.killVertex_(n.org,null):(n.org.anEdge=n.oNext,e.mesh.splice_(n,n.oPrev()));var r=n.sym;r.oNext===r?e.mesh.killVertex_(r.org,null):(r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev())),e.mesh.killEdge_(n)}}while(n!==i);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.mesh.meshUnion=function(t,e){var n=t.fHead,i=t.vHead,o=t.eHead,r=e.fHead,s=e.vHead,a=e.eHead;return r.next!==r&&(n.prev.next=r.next,r.next.prev=n.prev,r.prev.next=n,n.prev=r.prev),s.next!==s&&(i.prev.next=s.next,s.next.prev=i.prev,s.prev.next=i,i.prev=s.prev),a.next!==a&&(o.sym.next.sym.next=a.next,a.next.sym.next=o.sym.next,a.sym.next.sym.next=o,o.sym.next=a.sym.next),t},e.mesh.deleteMesh=function(t){},e.mesh.makeEdgePair_=function(t){var n=new e.GluHalfEdge,i=new e.GluHalfEdge,o=t.sym.next;return i.next=o,o.sym.next=n,n.next=t,t.sym.next=i,n.sym=i,n.oNext=n,n.lNext=i,i.sym=n,i.oNext=i,i.lNext=n,n},e.mesh.splice_=function(t,e){var n=t.oNext,i=e.oNext;n.sym.lNext=e,i.sym.lNext=t,t.oNext=i,e.oNext=n},e.mesh.makeVertex_=function(t,n){var i=n.prev,o=new e.GluVertex(n,i);i.next=o,n.prev=o,o.anEdge=t;var r=t;do{r.org=o,r=r.oNext}while(r!==t)},e.mesh.makeFace_=function(t,n){var i=n.prev,o=new e.GluFace(n,i);i.next=o,n.prev=o,o.anEdge=t,o.inside=n.inside;var r=t;do{r.lFace=o,r=r.lNext}while(r!==t)},e.mesh.killEdge_=function(t){var e=t.next,n=t.sym.next;e.sym.next=n,n.sym.next=e},e.mesh.killVertex_=function(t,e){var n=t.anEdge,i=n;do{i.org=e,i=i.oNext}while(i!==n);var o=t.prev,r=t.next;r.prev=o,o.next=r},e.mesh.killFace_=function(t,e){var n=t.anEdge,i=n;do{i.lFace=e,i=i.lNext}while(i!==n);var o=t.prev,r=t.next;r.prev=o,o.next=r},e.normal={},e.normal.S_UNIT_X_=1,e.normal.S_UNIT_Y_=0,e.normal.projectPolygon=function(t,n,i,o){var r=!1,s=[n,i,o];0===n&&0===i&&0===o&&(e.normal.computeNormal_(t,s),r=!0);var a,u=e.normal.longAxis_(s),c=t.mesh.vHead;if(e.TRUE_PROJECT){e.normal.normalize_(s);var l=[0,0,0],h=[0,0,0];l[u]=0,l[(u+1)%3]=e.normal.S_UNIT_X_,l[(u+2)%3]=e.normal.S_UNIT_Y_;var d=e.normal.dot_(l,s);for(l[0]-=d*s[0],l[1]-=d*s[1],l[2]-=d*s[2],e.normal.normalize_(l),h[0]=s[1]*l[2]-s[2]*l[1],h[1]=s[2]*l[0]-s[0]*l[2],h[2]=s[0]*l[1]-s[1]*l[0],e.normal.normalize_(h),a=c.next;a!==c;a=a.next)a.s=e.normal.dot_(a.coords,l),a.t=e.normal.dot_(a.coords,h)}else{var p=(u+1)%3,f=(u+2)%3,g=s[u]>0?1:-1;for(a=c.next;a!==c;a=a.next)a.s=a.coords[p],a.t=g*a.coords[f]}r&&e.normal.checkOrientation_(t)},e.normal.dot_=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},e.normal.normalize_=function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},e.normal.longAxis_=function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},e.normal.computeNormal_=function(t,n){var i,o=[-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD],r=[2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD],s=[],a=[],u=t.mesh.vHead;for(i=u.next;i!==u;i=i.next)for(var c=0;c<3;++c){var l=i.coords[c];l<r[c]&&(r[c]=l,a[c]=i),l>o[c]&&(o[c]=l,s[c]=i)}var h=0;if(o[1]-r[1]>o[0]-r[0]&&(h=1),o[2]-r[2]>o[h]-r[h]&&(h=2),r[h]>=o[h])return n[0]=0,n[1]=0,void(n[2]=1);var d=0,p=a[h],f=s[h],g=[0,0,0],m=[p.coords[0]-f.coords[0],p.coords[1]-f.coords[1],p.coords[2]-f.coords[2]],_=[0,0,0];for(i=u.next;i!==u;i=i.next){_[0]=i.coords[0]-f.coords[0],_[1]=i.coords[1]-f.coords[1],_[2]=i.coords[2]-f.coords[2],g[0]=m[1]*_[2]-m[2]*_[1],g[1]=m[2]*_[0]-m[0]*_[2],g[2]=m[0]*_[1]-m[1]*_[0];var x=g[0]*g[0]+g[1]*g[1]+g[2]*g[2];x>d&&(d=x,n[0]=g[0],n[1]=g[1],n[2]=g[2])}d<=0&&(n[0]=n[1]=n[2]=0,n[e.normal.longAxis_(m)]=1)},e.normal.checkOrientation_=function(t){for(var e=0,n=t.mesh.fHead,i=n.next;i!==n;i=i.next){var o=i.anEdge;if(!(o.winding<=0))do{e+=(o.org.s-o.dst().s)*(o.org.t+o.dst().t),o=o.lNext}while(o!==i.anEdge)}if(e<0)for(var r=t.mesh.vHead,s=r.next;s!==r;s=s.next)s.t=-s.t},e.render={},e.render.renderMesh=function(t,n,i){for(var o=!1,r=-1,s=n.fHead.prev;s!==n.fHead;s=s.prev)if(s.inside){o||(t.callBeginCallback(e.primitiveType.GL_TRIANGLES),o=!0);var a=s.anEdge;do{if(i){var u=a.rFace().inside?0:1;r!==u&&(r=u,t.callEdgeFlagCallback(!!r))}t.callVertexCallback(a.org.data),a=a.lNext}while(a!==s.anEdge)}o&&t.callEndCallback()},e.render.renderBoundary=function(t,n){for(var i=n.fHead.next;i!==n.fHead;i=i.next)if(i.inside){t.callBeginCallback(e.primitiveType.GL_LINE_LOOP);var o=i.anEdge;do{t.callVertexCallback(o.org.data),o=o.lNext}while(o!==i.anEdge);t.callEndCallback()}},e.sweep={},e.sweep.SENTINEL_COORD_=4*e.GLU_TESS_MAX_COORD,e.sweep.TOLERANCE_NONZERO_=!1,e.sweep.computeInterior=function(t){var n;for(t.fatalError=!1,e.sweep.removeDegenerateEdges_(t),e.sweep.initPriorityQ_(t),e.sweep.initEdgeDict_(t);null!==(n=t.pq.extractMin());){for(;;){var i=t.pq.minimum();if(null===i||!e.geom.vertEq(i,n))break;i=t.pq.extractMin(),e.sweep.spliceMergeVertices_(t,n.anEdge,i.anEdge)}e.sweep.sweepEvent_(t,n)}var o=t.dict.getMin().getKey();t.event=o.eUp.org,e.sweep.doneEdgeDict_(t),e.sweep.donePriorityQ_(t),e.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},e.sweep.addWinding_=function(t,e){t.winding+=e.winding,t.sym.winding+=e.sym.winding},e.sweep.edgeLeq_=function(t,n,i){var o=t.event,r=n.eUp,s=i.eUp;return r.dst()===o?s.dst()===o?e.geom.vertLeq(r.org,s.org)?e.geom.edgeSign(s.dst(),r.org,s.org)<=0:e.geom.edgeSign(r.dst(),s.org,r.org)>=0:e.geom.edgeSign(s.dst(),o,s.org)<=0:s.dst()===o?e.geom.edgeSign(r.dst(),o,r.org)>=0:e.geom.edgeEval(r.dst(),o,r.org)>=e.geom.edgeEval(s.dst(),o,s.org)},e.sweep.deleteRegion_=function(t,e){e.fixUpperEdge,e.eUp.activeRegion=null,t.dict.deleteNode(e.nodeUp),e.nodeUp=null},e.sweep.fixUpperEdge_=function(t,n){e.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=n,n.activeRegion=t},e.sweep.topLeftRegion_=function(t){var n=t.eUp.org;do{t=t.regionAbove()}while(t.eUp.org===n);if(t.fixUpperEdge){var i=e.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);e.sweep.fixUpperEdge_(t,i),t=t.regionAbove()}return t},e.sweep.topRightRegion_=function(t){var e=t.eUp.dst();do{t=t.regionAbove()}while(t.eUp.dst()===e);return t},e.sweep.addRegionBelow_=function(t,n,i){var o=new e.ActiveRegion;return o.eUp=i,o.nodeUp=t.dict.insertBefore(n.nodeUp,o),i.activeRegion=o,o},e.sweep.isWindingInside_=function(t,n){switch(t.windingRule){case e.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&n);case e.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==n;case e.windingRule.GLU_TESS_WINDING_POSITIVE:return n>0;case e.windingRule.GLU_TESS_WINDING_NEGATIVE:return n<0;case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return n>=2||n<=-2}return!1},e.sweep.computeWinding_=function(t,n){n.windingNumber=n.regionAbove().windingNumber+n.eUp.winding,n.inside=e.sweep.isWindingInside_(t,n.windingNumber)},e.sweep.finishRegion_=function(t,n){var i=n.eUp,o=i.lFace;o.inside=n.inside,o.anEdge=i,e.sweep.deleteRegion_(t,n)},e.sweep.finishLeftRegions_=function(t,n,i){for(var o=n,r=n.eUp;o!==i;){o.fixUpperEdge=!1;var s=o.regionBelow(),a=s.eUp;if(a.org!==r.org){if(!s.fixUpperEdge){e.sweep.finishRegion_(t,o);break}a=e.mesh.connect(r.lPrev(),a.sym),e.sweep.fixUpperEdge_(s,a)}r.oNext!==a&&(e.mesh.meshSplice(a.oPrev(),a),e.mesh.meshSplice(r,a)),e.sweep.finishRegion_(t,o),r=s.eUp,o=s}return r},e.sweep.addRightEdges_=function(t,n,i,o,r,s){var a=!0,u=i;do{e.sweep.addRegionBelow_(t,n,u.sym),u=u.oNext}while(u!==o);null===r&&(r=n.regionBelow().eUp.rPrev());for(var c,l=n,h=r;(u=(c=l.regionBelow()).eUp.sym).org===h.org;)u.oNext!==h&&(e.mesh.meshSplice(u.oPrev(),u),e.mesh.meshSplice(h.oPrev(),u)),c.windingNumber=l.windingNumber-u.winding,c.inside=e.sweep.isWindingInside_(t,c.windingNumber),l.dirty=!0,!a&&e.sweep.checkForRightSplice_(t,l)&&(e.sweep.addWinding_(u,h),e.sweep.deleteRegion_(t,l),e.mesh.deleteEdge(h)),a=!1,l=c,h=u;l.dirty=!0,s&&e.sweep.walkDirtyRegions_(t,l)},e.sweep.callCombine_=function(t,n,i,o,r){var s=[n.coords[0],n.coords[1],n.coords[2]];n.data=null,n.data=t.callCombineCallback(s,i,o),null===n.data&&(r?t.fatalError||(t.callErrorCallback(e.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):n.data=i[0])},e.sweep.spliceMergeVertices_=function(t,n,i){var o=[null,null,null,null];o[0]=n.org.data,o[1]=i.org.data,e.sweep.callCombine_(t,n.org,o,[.5,.5,0,0],!1),e.mesh.meshSplice(n,i)},e.sweep.vertexWeights_=function(t,n,i,o,r){var s=e.geom.vertL1dist(n,t),a=e.geom.vertL1dist(i,t),u=r,c=r+1;o[u]=.5*a/(s+a),o[c]=.5*s/(s+a),t.coords[0]+=o[u]*n.coords[0]+o[c]*i.coords[0],t.coords[1]+=o[u]*n.coords[1]+o[c]*i.coords[1],t.coords[2]+=o[u]*n.coords[2]+o[c]*i.coords[2]},e.sweep.getIntersectData_=function(t,n,i,o,r,s){var a=[0,0,0,0],u=[i.data,o.data,r.data,s.data];n.coords[0]=n.coords[1]=n.coords[2]=0,e.sweep.vertexWeights_(n,i,o,a,0),e.sweep.vertexWeights_(n,r,s,a,2),e.sweep.callCombine_(t,n,u,a,!0)},e.sweep.checkForRightSplice_=function(t,n){var i=n.regionBelow(),o=n.eUp,r=i.eUp;if(e.geom.vertLeq(o.org,r.org)){if(e.geom.edgeSign(r.dst(),o.org,r.org)>0)return!1;e.geom.vertEq(o.org,r.org)?o.org!==r.org&&(t.pq.remove(o.org.pqHandle),e.sweep.spliceMergeVertices_(t,r.oPrev(),o)):(e.mesh.splitEdge(r.sym),e.mesh.meshSplice(o,r.oPrev()),n.dirty=i.dirty=!0)}else{if(e.geom.edgeSign(o.dst(),r.org,o.org)<0)return!1;n.regionAbove().dirty=n.dirty=!0,e.mesh.splitEdge(o.sym),e.mesh.meshSplice(r.oPrev(),o)}return!0},e.sweep.checkForLeftSplice_=function(t,n){var i,o=n.regionBelow(),r=n.eUp,s=o.eUp;if(e.geom.vertLeq(r.dst(),s.dst())){if(e.geom.edgeSign(r.dst(),s.dst(),r.org)<0)return!1;n.regionAbove().dirty=n.dirty=!0,i=e.mesh.splitEdge(r),e.mesh.meshSplice(s.sym,i),i.lFace.inside=n.inside}else{if(e.geom.edgeSign(s.dst(),r.dst(),s.org)>0)return!1;n.dirty=o.dirty=!0,i=e.mesh.splitEdge(s),e.mesh.meshSplice(r.lNext,s.sym),i.rFace().inside=n.inside}return!0},e.sweep.checkForIntersect_=function(t,n){var i=n.regionBelow(),o=n.eUp,r=i.eUp,s=o.org,a=r.org,u=o.dst(),c=r.dst(),l=new e.GluVertex;if(s===a)return!1;if(Math.min(s.t,u.t)>Math.max(a.t,c.t))return!1;if(e.geom.vertLeq(s,a)){if(e.geom.edgeSign(c,s,a)>0)return!1}else if(e.geom.edgeSign(u,a,s)<0)return!1;e.geom.edgeIntersect(u,s,c,a,l),e.geom.vertLeq(l,t.event)&&(l.s=t.event.s,l.t=t.event.t);var h=e.geom.vertLeq(s,a)?s:a;if(e.geom.vertLeq(h,l)&&(l.s=h.s,l.t=h.t),e.geom.vertEq(l,s)||e.geom.vertEq(l,a))return e.sweep.checkForRightSplice_(t,n),!1;if(!e.geom.vertEq(u,t.event)&&e.geom.edgeSign(u,t.event,l)>=0||!e.geom.vertEq(c,t.event)&&e.geom.edgeSign(c,t.event,l)<=0){if(c===t.event)return e.mesh.splitEdge(o.sym),e.mesh.meshSplice(r.sym,o),o=(n=e.sweep.topLeftRegion_(n)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,n.regionBelow(),i),e.sweep.addRightEdges_(t,n,o.oPrev(),o,o,!0),!0;if(u===t.event){e.mesh.splitEdge(r.sym),e.mesh.meshSplice(o.lNext,r.oPrev()),i=n;var d=(n=e.sweep.topRightRegion_(n)).regionBelow().eUp.rPrev();return i.eUp=r.oPrev(),r=e.sweep.finishLeftRegions_(t,i,null),e.sweep.addRightEdges_(t,n,r.oNext,o.rPrev(),d,!0),!0}return e.geom.edgeSign(u,t.event,l)>=0&&(n.regionAbove().dirty=n.dirty=!0,e.mesh.splitEdge(o.sym),o.org.s=t.event.s,o.org.t=t.event.t),e.geom.edgeSign(c,t.event,l)<=0&&(n.dirty=i.dirty=!0,e.mesh.splitEdge(r.sym),r.org.s=t.event.s,r.org.t=t.event.t),!1}return e.mesh.splitEdge(o.sym),e.mesh.splitEdge(r.sym),e.mesh.meshSplice(r.oPrev(),o),o.org.s=l.s,o.org.t=l.t,o.org.pqHandle=t.pq.insert(o.org),e.sweep.getIntersectData_(t,o.org,s,u,a,c),n.regionAbove().dirty=n.dirty=i.dirty=!0,!1},e.sweep.walkDirtyRegions_=function(t,n){for(var i=n.regionBelow();;){for(;i.dirty;)n=i,i=i.regionBelow();if(!n.dirty&&(i=n,null===(n=n.regionAbove())||!n.dirty))return;n.dirty=!1;var o=n.eUp,r=i.eUp;if(o.dst()!==r.dst()&&e.sweep.checkForLeftSplice_(t,n)&&(i.fixUpperEdge?(e.sweep.deleteRegion_(t,i),e.mesh.deleteEdge(r),r=(i=n.regionBelow()).eUp):n.fixUpperEdge&&(e.sweep.deleteRegion_(t,n),e.mesh.deleteEdge(o),o=(n=i.regionAbove()).eUp)),o.org!==r.org)if(o.dst()===r.dst()||n.fixUpperEdge||i.fixUpperEdge||o.dst()!==t.event&&r.dst()!==t.event)e.sweep.checkForRightSplice_(t,n);else if(e.sweep.checkForIntersect_(t,n))return;o.org===r.org&&o.dst()===r.dst()&&(e.sweep.addWinding_(r,o),e.sweep.deleteRegion_(t,n),e.mesh.deleteEdge(o),n=i.regionAbove())}},e.sweep.connectRightVertex_=function(t,n,i){var o,r=i.oNext,s=n.regionBelow(),a=n.eUp,u=s.eUp,c=!1;(a.dst()!==u.dst()&&e.sweep.checkForIntersect_(t,n),e.geom.vertEq(a.org,t.event)&&(e.mesh.meshSplice(r.oPrev(),a),r=(n=e.sweep.topLeftRegion_(n)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,n.regionBelow(),s),c=!0),e.geom.vertEq(u.org,t.event)&&(e.mesh.meshSplice(i,u.oPrev()),i=e.sweep.finishLeftRegions_(t,s,null),c=!0),c)?e.sweep.addRightEdges_(t,n,i.oNext,r,r,!0):(o=e.geom.vertLeq(u.org,a.org)?u.oPrev():a,o=e.mesh.connect(i.lPrev(),o),e.sweep.addRightEdges_(t,n,o,o.oNext,o.oNext,!1),o.sym.activeRegion.fixUpperEdge=!0,e.sweep.walkDirtyRegions_(t,n))},e.sweep.connectLeftDegenerate_=function(t,n,i){var o=n.eUp;if(e.geom.vertEq(o.org,i))e.sweep.TOLERANCE_NONZERO_&&e.sweep.spliceMergeVertices_(t,o,i.anEdge);else{if(!e.geom.vertEq(o.dst(),i))return e.mesh.splitEdge(o.sym),n.fixUpperEdge&&(e.mesh.deleteEdge(o.oNext),n.fixUpperEdge=!1),e.mesh.meshSplice(i.anEdge,o),void e.sweep.sweepEvent_(t,i);if(e.sweep.TOLERANCE_NONZERO_){var r=(n=e.sweep.topRightRegion_(n)).regionBelow(),s=r.eUp.sym,a=s.oNext,u=a;r.fixUpperEdge&&(e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(s),s=a.oPrev()),e.mesh.meshSplice(i.anEdge,s),e.geom.edgeGoesLeft(a)||(a=null),e.sweep.addRightEdges_(t,n,s.oNext,u,a,!0)}}},e.sweep.connectLeftVertex_=function(t,n){var i=new e.ActiveRegion;i.eUp=n.anEdge.sym;var o=t.dict.search(i).getKey(),r=o.regionBelow(),s=o.eUp,a=r.eUp;if(0!==e.geom.edgeSign(s.dst(),n,s.org)){var u,c=e.geom.vertLeq(a.dst(),s.dst())?o:r;if(o.inside||c.fixUpperEdge){if(c===o)u=e.mesh.connect(n.anEdge.sym,s.lNext);else u=e.mesh.connect(a.dNext(),n.anEdge).sym;c.fixUpperEdge?e.sweep.fixUpperEdge_(c,u):e.sweep.computeWinding_(t,e.sweep.addRegionBelow_(t,o,u)),e.sweep.sweepEvent_(t,n)}else e.sweep.addRightEdges_(t,o,n.anEdge,n.anEdge,null,!0)}else e.sweep.connectLeftDegenerate_(t,o,n)},e.sweep.sweepEvent_=function(t,n){t.event=n;for(var i=n.anEdge;null===i.activeRegion;)if((i=i.oNext)===n.anEdge)return void e.sweep.connectLeftVertex_(t,n);var o=e.sweep.topLeftRegion_(i.activeRegion),r=o.regionBelow(),s=r.eUp,a=e.sweep.finishLeftRegions_(t,r,null);a.oNext===s?e.sweep.connectRightVertex_(t,o,a):e.sweep.addRightEdges_(t,o,a.oNext,s,s,!0)},e.sweep.addSentinel_=function(t,n){var i=new e.ActiveRegion,o=e.mesh.makeEdge(t.mesh);o.org.s=e.sweep.SENTINEL_COORD_,o.org.t=n,o.dst().s=-e.sweep.SENTINEL_COORD_,o.dst().t=n,t.event=o.dst(),i.eUp=o,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},e.sweep.initEdgeDict_=function(t){t.dict=new e.Dict(t,e.sweep.edgeLeq_),e.sweep.addSentinel_(t,-e.sweep.SENTINEL_COORD_),e.sweep.addSentinel_(t,e.sweep.SENTINEL_COORD_)},e.sweep.doneEdgeDict_=function(t){for(var n;null!==(n=t.dict.getMin().getKey());)n.sentinel,e.sweep.deleteRegion_(t,n);t.dict=null},e.sweep.removeDegenerateEdges_=function(t){for(var n,i=t.mesh.eHead,o=i.next;o!==i;o=n){n=o.next;var r=o.lNext;e.geom.vertEq(o.org,o.dst())&&o.lNext.lNext!==o&&(e.sweep.spliceMergeVertices_(t,r,o),e.mesh.deleteEdge(o),r=(o=r).lNext),r.lNext===o&&(r!==o&&(r!==n&&r!==n.sym||(n=n.next),e.mesh.deleteEdge(r)),o!==n&&o!==n.sym||(n=n.next),e.mesh.deleteEdge(o))}},e.sweep.initPriorityQ_=function(t){var n=new e.PriorityQ;t.pq=n;var i,o=t.mesh.vHead;for(i=o.next;i!==o;i=i.next)i.pqHandle=n.insert(i);n.init()},e.sweep.donePriorityQ_=function(t){t.pq.deleteQ(),t.pq=null},e.sweep.removeDegenerateFaces_=function(t){for(var n,i=t.fHead.next;i!==t.fHead;i=n){n=i.next;var o=i.anEdge;o.lNext.lNext===o&&(e.sweep.addWinding_(o.oNext,o),e.mesh.deleteEdge(o))}},e.tessmono={},e.tessmono.tessellateMonoRegion_=function(t){for(var n=t.anEdge;e.geom.vertLeq(n.dst(),n.org);n=n.lPrev());for(;e.geom.vertLeq(n.org,n.dst());n=n.lNext);for(var i,o=n.lPrev();n.lNext!==o;)if(e.geom.vertLeq(n.dst(),o.org)){for(;o.lNext!==n&&(e.geom.edgeGoesLeft(o.lNext)||e.geom.edgeSign(o.org,o.dst(),o.lNext.dst())<=0);)o=(i=e.mesh.connect(o.lNext,o)).sym;o=o.lPrev()}else{for(;o.lNext!==n&&(e.geom.edgeGoesRight(n.lPrev())||e.geom.edgeSign(n.dst(),n.org,n.lPrev().org)>=0);)i=e.mesh.connect(n,n.lPrev()),n=i.sym;n=n.lNext}for(;o.lNext.lNext!==n;)o=(i=e.mesh.connect(o.lNext,o)).sym},e.tessmono.tessellateInterior=function(t){for(var n,i=t.fHead.next;i!==t.fHead;i=n)n=i.next,i.inside&&e.tessmono.tessellateMonoRegion_(i)},e.tessmono.discardExterior=function(t){for(var n,i=t.fHead.next;i!==t.fHead;i=n)n=i.next,i.inside||e.mesh.zapFace(i)},e.tessmono.setWindingNumber=function(t,n,i){for(var o,r=t.eHead.next;r!==t.eHead;r=o)o=r.next,r.rFace().inside!==r.lFace.inside?r.winding=r.lFace.inside?n:-n:i?e.mesh.deleteEdge(r):r.winding=0},e.Dict=function(t,n){this.head_=new e.DictNode,this.frame_=t,this.leq_=n},e.Dict.prototype.deleteDict_=function(){},e.Dict.prototype.insertBefore=function(t,n){do{t=t.prev}while(null!==t.key&&!this.leq_(this.frame_,t.key,n));var i=new e.DictNode(n,t.next,t);return t.next.prev=i,t.next=i,i},e.Dict.prototype.insert=function(t){return this.insertBefore(this.head_,t)},e.Dict.prototype.deleteNode=function(t){t.next.prev=t.prev,t.prev.next=t.next},e.Dict.prototype.search=function(t){var e=this.head_;do{e=e.next}while(null!==e.key&&!this.leq_(this.frame_,t,e.key));return e},e.Dict.prototype.getMin=function(){return this.head_.next},e.Dict.prototype.getMax=function(){return this.head_.prev},e.DictNode=function(t,e,n){this.key=t||null,this.next=e||this,this.prev=n||this},e.DictNode.prototype.getKey=function(){return this.key},e.DictNode.prototype.getSuccessor=function(){return this.next},e.DictNode.prototype.getPredecessor=function(){return this.prev},e.GluTesselator=function(){this.state_=e.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=e.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},e.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},e.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(e.GluTesselator.tessState_.T_DORMANT)},e.GluTesselator.prototype.gluTessProperty=function(t,n){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return;case e.gluEnum.GLU_TESS_WINDING_RULE:var i=n;switch(i){case e.windingRule.GLU_TESS_WINDING_ODD:case e.windingRule.GLU_TESS_WINDING_NONZERO:case e.windingRule.GLU_TESS_WINDING_POSITIVE:case e.windingRule.GLU_TESS_WINDING_NEGATIVE:case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!n);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(e.gluEnum.GLU_INVALID_VALUE)},e.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return 0;case e.gluEnum.GLU_TESS_WINDING_RULE:return this.windingRule;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly_;default:this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}return!1},e.GluTesselator.prototype.gluTessNormal=function(t,e,n){this.normal_[0]=t,this.normal_[1]=e,this.normal_[2]=n},e.GluTesselator.prototype.gluTessCallback=function(t,n){var i=n||null;switch(t){case e.gluEnum.GLU_TESS_BEGIN:case e.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=i);case e.gluEnum.GLU_TESS_EDGE_FLAG:case e.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=i);case e.gluEnum.GLU_TESS_VERTEX:case e.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=i);case e.gluEnum.GLU_TESS_END:case e.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=i);case e.gluEnum.GLU_TESS_ERROR:case e.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=i);case e.gluEnum.GLU_TESS_COMBINE:case e.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=i);case e.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=i);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}},e.GluTesselator.prototype.gluTessVertex=function(t,n){var i=!1,o=[0,0,0];this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR);for(var r=0;r<3;++r){var s=t[r];s<-e.GLU_TESS_MAX_COORD&&(s=-e.GLU_TESS_MAX_COORD,i=!0),s>e.GLU_TESS_MAX_COORD&&(s=e.GLU_TESS_MAX_COORD,i=!0),o[r]=s}i&&this.callErrorCallback(e.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(o,n)},e.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(e.GluTesselator.tessState_.T_DORMANT),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new e.GluMesh,this.polygonData_=t},e.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},e.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON},e.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_DORMANT,e.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),e.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly_?e.tessmono.setWindingNumber(t,1,!0):e.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)e.render.renderBoundary(this,this.mesh);else{var n=!!this.edgeFlagCallback_;e.render.renderMesh(this,this.mesh,n)}if(this.meshCallback_)return e.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}e.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},e.GluTesselator.prototype.requireState_=function(t){this.state_!==t&&this.gotoState_(t)},e.GluTesselator.prototype.gotoState_=function(t){for(;this.state_!==t;)if(this.state_<t)switch(this.state_){case e.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case e.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},e.GluTesselator.prototype.addVertex_=function(t,n){var i=this.lastEdge_;null===i?(i=e.mesh.makeEdge(this.mesh),e.mesh.meshSplice(i,i.sym)):(e.mesh.splitEdge(i),i=i.lNext),i.org.data=n,i.org.coords[0]=t[0],i.org.coords[1]=t[1],i.org.coords[2]=t[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},e.GluTesselator.prototype.callBeginCallback=function(t){this.beginCallback_&&this.beginCallback_(t,this.polygonData_)},e.GluTesselator.prototype.callVertexCallback=function(t){this.vertexCallback_&&this.vertexCallback_(t,this.polygonData_)},e.GluTesselator.prototype.callEdgeFlagCallback=function(t){this.edgeFlagCallback_&&this.edgeFlagCallback_(t,this.polygonData_)},e.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},e.GluTesselator.prototype.callCombineCallback=function(t,e,n){return this.combineCallback_&&this.combineCallback_(t,e,n,this.polygonData_)||null},e.GluTesselator.prototype.callErrorCallback=function(t){this.errorCallback_&&this.errorCallback_(t,this.polygonData_)},e.GluFace=function(t,e){this.next=t||this,this.prev=e||this,this.anEdge=null,this.data=null,this.inside=!1},e.GluHalfEdge=function(t){this.next=t||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},e.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},e.GluHalfEdge.prototype.dst=function(){return this.sym.org},e.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},e.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},e.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},e.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},e.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},e.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},e.GluMesh=function(){this.vHead=new e.GluVertex,this.fHead=new e.GluFace,this.eHead=new e.GluHalfEdge,this.eHeadSym=new e.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},e.GluMesh.prototype.checkMesh=function(){if(e.DEBUG){var t,n,i,o=this.fHead,r=this.vHead,s=this.eHead,a=o;for(a=o;(n=a.next)!==o;a=n){t=n.anEdge;do{t=t.lNext}while(t!==n.anEdge)}var u=r;for(u=r;(i=u.next)!==r;u=i){t=i.anEdge;do{t=t.oNext}while(t!==i.anEdge)}var c=s;for(c=s;(t=c.next)!==s;c=t);}},e.GluVertex=function(t,e){this.next=t||this,this.prev=e||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},e.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new e.PriorityQHeap},e.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},e.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var n,i=(n=this.verts_,function(t,i){return e.geom.vertLeq(n[t],n[i])?1:-1});if(this.order_.sort(i),this.initialized_=!0,this.heap_.init(),e.DEBUG){var o=0+this.size_-1;for(t=0;t<o;++t);}},e.PriorityQ.prototype.insert=function(t){if(this.initialized_)return this.heap_.insert(t);var e=this.size_++;return this.verts_[e]=t,-(e+1)},e.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var n=this.heap_.minimum();if(e.geom.vertLeq(n,t))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return t},e.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var n=this.heap_.minimum();if(e.geom.vertLeq(n,t))return n}return t},e.PriorityQ.prototype.remove=function(t){if(t>=0)this.heap_.remove(t);else for(t=-(t+1),this.verts_[t]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},e.PriorityQHeap=function(){this.heap_=e.PriorityQHeap.reallocNumeric_([0],e.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=e.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},e.PriorityQHeap.INIT_SIZE_=32,e.PriorityQHeap.reallocNumeric_=function(t,e){for(var n=new Array(e),i=0;i<t.length;i++)n[i]=t[i];for(;i<e;i++)n[i]=0;return n},e.PriorityQHeap.prototype.init=function(){for(var t=this.size_;t>=1;--t)this.floatDown_(t);this.initialized_=!0},e.PriorityQHeap.prototype.insert=function(t){var n,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.handles_=e.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?n=i:(n=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[n]=t,this.handles_[n]=i,this.heap_[i]=n,this.initialized_&&this.floatUp_(i),n},e.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},e.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},e.PriorityQHeap.prototype.extractMin=function(){var t=this.heap_,e=this.verts_,n=this.handles_,i=t[1],o=e[i];return this.size_>0&&(t[1]=t[this.size_],n[t[1]]=1,e[i]=null,n[i]=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),o},e.PriorityQHeap.prototype.remove=function(t){var n=this.heap_,i=this.verts_,o=this.handles_,r=o[t];if(n[r]=n[this.size_],o[n[r]]=r,r<=--this.size_)if(r<=1)this.floatDown_(r);else{var s=i[n[r]],a=i[n[r>>1]];e.geom.vertLeq(a,s)?this.floatDown_(r):this.floatUp_(r)}i[t]=null,o[t]=this.freeList_,this.freeList_=t},e.PriorityQHeap.prototype.floatDown_=function(t){for(var n=this.heap_,i=this.verts_,o=this.handles_,r=t,s=n[r];;){var a=r<<1;a<this.size_&&e.geom.vertLeq(i[n[a+1]],i[n[a]])&&(a+=1);var u=n[a];if(a>this.size_||e.geom.vertLeq(i[s],i[u]))return n[r]=s,void(o[s]=r);n[r]=u,o[u]=r,r=a}},e.PriorityQHeap.prototype.floatUp_=function(t){for(var n=this.heap_,i=this.verts_,o=this.handles_,r=t,s=n[r];;){var a=r>>1,u=n[a];if(0===a||e.geom.vertLeq(i[u],i[s]))return n[r]=s,void(o[s]=r);n[r]=u,o[u]=r,r=a}},e.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},e.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},e.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},t.exports=e},310:function(t,e){!function(t){"use strict";var e=(t,e,n,i)=>{let o=65535&t|0,r=t>>>16&65535|0,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{o=o+e[i++]|0,r=r+o|0}while(--s);o%=65521,r%=65521}return o|r<<16|0};const n=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var i=(t,e,i,o)=>{const r=n,s=o+i;t^=-1;for(let n=o;n<s;n++)t=t>>>8^r[255&(t^e[n])];return-1^t};const o=16209,r=16191;var s=function(t,e){let n,i,s,a,u,c,l,h,d,p,f,g,m,_,x,y,w,S,T,b,v,E,C,O;const N=t.state;n=t.next_in,C=t.input,i=n+(t.avail_in-5),s=t.next_out,O=t.output,a=s-(e-t.avail_out),u=s+(t.avail_out-257),c=N.dmax,l=N.wsize,h=N.whave,d=N.wnext,p=N.window,f=N.hold,g=N.bits,m=N.lencode,_=N.distcode,x=(1<<N.lenbits)-1,y=(1<<N.distbits)-1;t:do{g<15&&(f+=C[n++]<<g,g+=8,f+=C[n++]<<g,g+=8),w=m[f&x];e:for(;;){if(S=w>>>24,f>>>=S,g-=S,S=w>>>16&255,0===S)O[s++]=65535&w;else{if(!(16&S)){if(0==(64&S)){w=m[(65535&w)+(f&(1<<S)-1)];continue e}if(32&S){N.mode=r;break t}t.msg="invalid literal/length code",N.mode=o;break t}T=65535&w,S&=15,S&&(g<S&&(f+=C[n++]<<g,g+=8),T+=f&(1<<S)-1,f>>>=S,g-=S),g<15&&(f+=C[n++]<<g,g+=8,f+=C[n++]<<g,g+=8),w=_[f&y];n:for(;;){if(S=w>>>24,f>>>=S,g-=S,S=w>>>16&255,!(16&S)){if(0==(64&S)){w=_[(65535&w)+(f&(1<<S)-1)];continue n}t.msg="invalid distance code",N.mode=o;break t}if(b=65535&w,S&=15,g<S&&(f+=C[n++]<<g,g+=8,g<S&&(f+=C[n++]<<g,g+=8)),b+=f&(1<<S)-1,b>c){t.msg="invalid distance too far back",N.mode=o;break t}if(f>>>=S,g-=S,S=s-a,b>S){if(S=b-S,S>h&&N.sane){t.msg="invalid distance too far back",N.mode=o;break t}if(v=0,E=p,0===d){if(v+=l-S,S<T){T-=S;do{O[s++]=p[v++]}while(--S);v=s-b,E=O}}else if(d<S){if(v+=l+d-S,S-=d,S<T){T-=S;do{O[s++]=p[v++]}while(--S);if(v=0,d<T){S=d,T-=S;do{O[s++]=p[v++]}while(--S);v=s-b,E=O}}}else if(v+=d-S,S<T){T-=S;do{O[s++]=p[v++]}while(--S);v=s-b,E=O}for(;T>2;)O[s++]=E[v++],O[s++]=E[v++],O[s++]=E[v++],T-=3;T&&(O[s++]=E[v++],T>1&&(O[s++]=E[v++]))}else{v=s-b;do{O[s++]=O[v++],O[s++]=O[v++],O[s++]=O[v++],T-=3}while(T>2);T&&(O[s++]=O[v++],T>1&&(O[s++]=O[v++]))}break}}break}}while(n<i&&s<u);T=g>>3,n-=T,g-=T<<3,f&=(1<<g)-1,t.next_in=n,t.next_out=s,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=s<u?u-s+257:257-(s-u),N.hold=f,N.bits=g};const a=15,u=852,c=592,l=0,h=1,d=2,p=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),f=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),g=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),m=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _=(t,e,n,i,o,r,s,_)=>{const x=_.bits;let y,w,S,T,b,v,E=0,C=0,O=0,N=0,F=0,I=0,M=0,D=0,R=0,V=0,A=null;const P=new Uint16Array(a+1),L=new Uint16Array(a+1);let B,X,U,k=null;for(E=0;E<=a;E++)P[E]=0;for(C=0;C<i;C++)P[e[n+C]]++;for(F=x,N=a;N>=1&&0===P[N];N--);if(F>N&&(F=N),0===N)return o[r++]=20971520,o[r++]=20971520,_.bits=1,0;for(O=1;O<N&&0===P[O];O++);for(F<O&&(F=O),D=1,E=1;E<=a;E++)if(D<<=1,D-=P[E],D<0)return-1;if(D>0&&(t===l||1!==N))return-1;for(L[1]=0,E=1;E<a;E++)L[E+1]=L[E]+P[E];for(C=0;C<i;C++)0!==e[n+C]&&(s[L[e[n+C]]++]=C);if(t===l?(A=k=s,v=20):t===h?(A=p,k=f,v=257):(A=g,k=m,v=0),V=0,C=0,E=O,b=r,I=F,M=0,S=-1,R=1<<F,T=R-1,t===h&&R>u||t===d&&R>c)return 1;for(;;){B=E-M,s[C]+1<v?(X=0,U=s[C]):s[C]>=v?(X=k[s[C]-v],U=A[s[C]-v]):(X=96,U=0),y=1<<E-M,w=1<<I,O=w;do{w-=y,o[b+(V>>M)+w]=B<<24|X<<16|U|0}while(0!==w);for(y=1<<E-1;V&y;)y>>=1;if(0!==y?(V&=y-1,V+=y):V=0,C++,0==--P[E]){if(E===N)break;E=e[n+s[C]]}if(E>F&&(V&T)!==S){for(0===M&&(M=F),b+=O,I=E-M,D=1<<I;I+M<N&&(D-=P[I+M],!(D<=0));)I++,D<<=1;if(R+=1<<I,t===h&&R>u||t===d&&R>c)return 1;S=V&T,o[S]=F<<24|I<<16|b-r|0}}return 0!==V&&(o[b+V]=E-M<<24|64<<16|0),_.bits=F,0},x={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const y=0,w=1,S=2,{Z_FINISH:T,Z_BLOCK:b,Z_TREES:v,Z_OK:E,Z_STREAM_END:C,Z_NEED_DICT:O,Z_STREAM_ERROR:N,Z_DATA_ERROR:F,Z_MEM_ERROR:I,Z_BUF_ERROR:M,Z_DEFLATED:D}=x,R=16180,V=16181,A=16182,P=16183,L=16184,B=16185,X=16186,U=16187,k=16188,z=16189,j=16190,G=16191,H=16192,q=16193,Y=16194,W=16195,K=16196,J=16197,Z=16198,Q=16199,$=16200,tt=16201,et=16202,nt=16203,it=16204,ot=16205,rt=16206,st=16207,at=16208,ut=16209,ct=16210,lt=16211,ht=852,dt=592,pt=15,ft=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function gt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const mt=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<R||e.mode>lt?1:0},_t=t=>{if(mt(t))return N;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=R,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(ht),e.distcode=e.distdyn=new Int32Array(dt),e.sane=1,e.back=-1,E},xt=t=>{if(mt(t))return N;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,_t(t)},yt=(t,e)=>{let n;if(mt(t))return N;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?N:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,xt(t))},wt=(t,e)=>{if(!t)return N;const n=new gt;t.state=n,n.strm=t,n.window=null,n.mode=R;const i=yt(t,e);return i!==E&&(t.state=null),i};let St,Tt,bt=!0;const vt=t=>{if(bt){St=new Int32Array(512),Tt=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(_(w,t.lens,0,288,St,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;_(S,t.lens,0,32,Tt,0,t.work,{bits:5}),bt=!1}t.lencode=St,t.lenbits=9,t.distcode=Tt,t.distbits=5},Et=(t,e,n,i)=>{let o;const r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(e.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(o=r.wsize-r.wnext,o>i&&(o=i),r.window.set(e.subarray(n-i,n-i+o),r.wnext),(i-=o)?(r.window.set(e.subarray(n-i,n),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0};var Ct={inflateReset:xt,inflateReset2:yt,inflateResetKeep:_t,inflateInit:t=>wt(t,pt),inflateInit2:wt,inflate:(t,n)=>{let o,r,a,u,c,l,h,d,p,f,g,m,x,lt,ht,dt,pt,gt,_t,xt,yt,wt,St=0;const Tt=new Uint8Array(4);let bt,Ct;const Ot=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(mt(t)||!t.output||!t.input&&0!==t.avail_in)return N;o=t.state,o.mode===G&&(o.mode=H),c=t.next_out,a=t.output,h=t.avail_out,u=t.next_in,r=t.input,l=t.avail_in,d=o.hold,p=o.bits,f=l,g=h,wt=E;t:for(;;)switch(o.mode){case R:if(0===o.wrap){o.mode=H;break}for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(2&o.wrap&&35615===d){0===o.wbits&&(o.wbits=15),o.check=0,Tt[0]=255&d,Tt[1]=d>>>8&255,o.check=i(o.check,Tt,2,0),d=0,p=0,o.mode=V;break}if(o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&d)<<8)+(d>>8))%31){t.msg="incorrect header check",o.mode=ut;break}if((15&d)!==D){t.msg="unknown compression method",o.mode=ut;break}if(d>>>=4,p-=4,yt=8+(15&d),0===o.wbits&&(o.wbits=yt),yt>15||yt>o.wbits){t.msg="invalid window size",o.mode=ut;break}o.dmax=1<<o.wbits,o.flags=0,t.adler=o.check=1,o.mode=512&d?z:G,d=0,p=0;break;case V:for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(o.flags=d,(255&o.flags)!==D){t.msg="unknown compression method",o.mode=ut;break}if(57344&o.flags){t.msg="unknown header flags set",o.mode=ut;break}o.head&&(o.head.text=d>>8&1),512&o.flags&&4&o.wrap&&(Tt[0]=255&d,Tt[1]=d>>>8&255,o.check=i(o.check,Tt,2,0)),d=0,p=0,o.mode=A;case A:for(;p<32;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.head&&(o.head.time=d),512&o.flags&&4&o.wrap&&(Tt[0]=255&d,Tt[1]=d>>>8&255,Tt[2]=d>>>16&255,Tt[3]=d>>>24&255,o.check=i(o.check,Tt,4,0)),d=0,p=0,o.mode=P;case P:for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.head&&(o.head.xflags=255&d,o.head.os=d>>8),512&o.flags&&4&o.wrap&&(Tt[0]=255&d,Tt[1]=d>>>8&255,o.check=i(o.check,Tt,2,0)),d=0,p=0,o.mode=L;case L:if(1024&o.flags){for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.length=d,o.head&&(o.head.extra_len=d),512&o.flags&&4&o.wrap&&(Tt[0]=255&d,Tt[1]=d>>>8&255,o.check=i(o.check,Tt,2,0)),d=0,p=0}else o.head&&(o.head.extra=null);o.mode=B;case B:if(1024&o.flags&&(m=o.length,m>l&&(m=l),m&&(o.head&&(yt=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(r.subarray(u,u+m),yt)),512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),l-=m,u+=m,o.length-=m),o.length))break t;o.length=0,o.mode=X;case X:if(2048&o.flags){if(0===l)break t;m=0;do{yt=r[u+m++],o.head&&yt&&o.length<65536&&(o.head.name+=String.fromCharCode(yt))}while(yt&&m<l);if(512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),l-=m,u+=m,yt)break t}else o.head&&(o.head.name=null);o.length=0,o.mode=U;case U:if(4096&o.flags){if(0===l)break t;m=0;do{yt=r[u+m++],o.head&&yt&&o.length<65536&&(o.head.comment+=String.fromCharCode(yt))}while(yt&&m<l);if(512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),l-=m,u+=m,yt)break t}else o.head&&(o.head.comment=null);o.mode=k;case k:if(512&o.flags){for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(4&o.wrap&&d!==(65535&o.check)){t.msg="header crc mismatch",o.mode=ut;break}d=0,p=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),t.adler=o.check=0,o.mode=G;break;case z:for(;p<32;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}t.adler=o.check=ft(d),d=0,p=0,o.mode=j;case j:if(0===o.havedict)return t.next_out=c,t.avail_out=h,t.next_in=u,t.avail_in=l,o.hold=d,o.bits=p,O;t.adler=o.check=1,o.mode=G;case G:if(n===b||n===v)break t;case H:if(o.last){d>>>=7&p,p-=7&p,o.mode=rt;break}for(;p<3;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}switch(o.last=1&d,d>>>=1,p-=1,3&d){case 0:o.mode=q;break;case 1:if(vt(o),o.mode=Q,n===v){d>>>=2,p-=2;break t}break;case 2:o.mode=K;break;case 3:t.msg="invalid block type",o.mode=ut}d>>>=2,p-=2;break;case q:for(d>>>=7&p,p-=7&p;p<32;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if((65535&d)!=(d>>>16^65535)){t.msg="invalid stored block lengths",o.mode=ut;break}if(o.length=65535&d,d=0,p=0,o.mode=Y,n===v)break t;case Y:o.mode=W;case W:if(m=o.length,m){if(m>l&&(m=l),m>h&&(m=h),0===m)break t;a.set(r.subarray(u,u+m),c),l-=m,u+=m,h-=m,c+=m,o.length-=m;break}o.mode=G;break;case K:for(;p<14;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(o.nlen=257+(31&d),d>>>=5,p-=5,o.ndist=1+(31&d),d>>>=5,p-=5,o.ncode=4+(15&d),d>>>=4,p-=4,o.nlen>286||o.ndist>30){t.msg="too many length or distance symbols",o.mode=ut;break}o.have=0,o.mode=J;case J:for(;o.have<o.ncode;){for(;p<3;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.lens[Ot[o.have++]]=7&d,d>>>=3,p-=3}for(;o.have<19;)o.lens[Ot[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,bt={bits:o.lenbits},wt=_(y,o.lens,0,19,o.lencode,0,o.work,bt),o.lenbits=bt.bits,wt){t.msg="invalid code lengths set",o.mode=ut;break}o.have=0,o.mode=Z;case Z:for(;o.have<o.nlen+o.ndist;){for(;St=o.lencode[d&(1<<o.lenbits)-1],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(pt<16)d>>>=ht,p-=ht,o.lens[o.have++]=pt;else{if(16===pt){for(Ct=ht+2;p<Ct;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(d>>>=ht,p-=ht,0===o.have){t.msg="invalid bit length repeat",o.mode=ut;break}yt=o.lens[o.have-1],m=3+(3&d),d>>>=2,p-=2}else if(17===pt){for(Ct=ht+3;p<Ct;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}d>>>=ht,p-=ht,yt=0,m=3+(7&d),d>>>=3,p-=3}else{for(Ct=ht+7;p<Ct;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}d>>>=ht,p-=ht,yt=0,m=11+(127&d),d>>>=7,p-=7}if(o.have+m>o.nlen+o.ndist){t.msg="invalid bit length repeat",o.mode=ut;break}for(;m--;)o.lens[o.have++]=yt}}if(o.mode===ut)break;if(0===o.lens[256]){t.msg="invalid code -- missing end-of-block",o.mode=ut;break}if(o.lenbits=9,bt={bits:o.lenbits},wt=_(w,o.lens,0,o.nlen,o.lencode,0,o.work,bt),o.lenbits=bt.bits,wt){t.msg="invalid literal/lengths set",o.mode=ut;break}if(o.distbits=6,o.distcode=o.distdyn,bt={bits:o.distbits},wt=_(S,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,bt),o.distbits=bt.bits,wt){t.msg="invalid distances set",o.mode=ut;break}if(o.mode=Q,n===v)break t;case Q:o.mode=$;case $:if(l>=6&&h>=258){t.next_out=c,t.avail_out=h,t.next_in=u,t.avail_in=l,o.hold=d,o.bits=p,s(t,g),c=t.next_out,a=t.output,h=t.avail_out,u=t.next_in,r=t.input,l=t.avail_in,d=o.hold,p=o.bits,o.mode===G&&(o.back=-1);break}for(o.back=0;St=o.lencode[d&(1<<o.lenbits)-1],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(dt&&0==(240&dt)){for(gt=ht,_t=dt,xt=pt;St=o.lencode[xt+((d&(1<<gt+_t)-1)>>gt)],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(gt+ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}d>>>=gt,p-=gt,o.back+=gt}if(d>>>=ht,p-=ht,o.back+=ht,o.length=pt,0===dt){o.mode=ot;break}if(32&dt){o.back=-1,o.mode=G;break}if(64&dt){t.msg="invalid literal/length code",o.mode=ut;break}o.extra=15&dt,o.mode=tt;case tt:if(o.extra){for(Ct=o.extra;p<Ct;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.length+=d&(1<<o.extra)-1,d>>>=o.extra,p-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=et;case et:for(;St=o.distcode[d&(1<<o.distbits)-1],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(0==(240&dt)){for(gt=ht,_t=dt,xt=pt;St=o.distcode[xt+((d&(1<<gt+_t)-1)>>gt)],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(gt+ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}d>>>=gt,p-=gt,o.back+=gt}if(d>>>=ht,p-=ht,o.back+=ht,64&dt){t.msg="invalid distance code",o.mode=ut;break}o.offset=pt,o.extra=15&dt,o.mode=nt;case nt:if(o.extra){for(Ct=o.extra;p<Ct;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.offset+=d&(1<<o.extra)-1,d>>>=o.extra,p-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){t.msg="invalid distance too far back",o.mode=ut;break}o.mode=it;case it:if(0===h)break t;if(m=g-h,o.offset>m){if(m=o.offset-m,m>o.whave&&o.sane){t.msg="invalid distance too far back",o.mode=ut;break}m>o.wnext?(m-=o.wnext,x=o.wsize-m):x=o.wnext-m,m>o.length&&(m=o.length),lt=o.window}else lt=a,x=c-o.offset,m=o.length;m>h&&(m=h),h-=m,o.length-=m;do{a[c++]=lt[x++]}while(--m);0===o.length&&(o.mode=$);break;case ot:if(0===h)break t;a[c++]=o.length,h--,o.mode=$;break;case rt:if(o.wrap){for(;p<32;){if(0===l)break t;l--,d|=r[u++]<<p,p+=8}if(g-=h,t.total_out+=g,o.total+=g,4&o.wrap&&g&&(t.adler=o.check=o.flags?i(o.check,a,g,c-g):e(o.check,a,g,c-g)),g=h,4&o.wrap&&(o.flags?d:ft(d))!==o.check){t.msg="incorrect data check",o.mode=ut;break}d=0,p=0}o.mode=st;case st:if(o.wrap&&o.flags){for(;p<32;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(4&o.wrap&&d!==(4294967295&o.total)){t.msg="incorrect length check",o.mode=ut;break}d=0,p=0}o.mode=at;case at:wt=C;break t;case ut:wt=F;break t;case ct:return I;default:return N}return t.next_out=c,t.avail_out=h,t.next_in=u,t.avail_in=l,o.hold=d,o.bits=p,(o.wsize||g!==t.avail_out&&o.mode<ut&&(o.mode<rt||n!==T))&&Et(t,t.output,t.next_out,g-t.avail_out),f-=t.avail_in,g-=t.avail_out,t.total_in+=f,t.total_out+=g,o.total+=g,4&o.wrap&&g&&(t.adler=o.check=o.flags?i(o.check,a,g,t.next_out-g):e(o.check,a,g,t.next_out-g)),t.data_type=o.bits+(o.last?64:0)+(o.mode===G?128:0)+(o.mode===Q||o.mode===Y?256:0),(0===f&&0===g||n===T)&&wt===E&&(wt=M),wt},inflateEnd:t=>{if(mt(t))return N;let e=t.state;return e.window&&(e.window=null),t.state=null,E},inflateGetHeader:(t,e)=>{if(mt(t))return N;const n=t.state;return 0==(2&n.wrap)?N:(n.head=e,e.done=!1,E)},inflateSetDictionary:(t,n)=>{const i=n.length;let o,r,s;return mt(t)?N:(o=t.state,0!==o.wrap&&o.mode!==j?N:o.mode===j&&(r=1,r=e(r,n,i,0),r!==o.check)?F:(s=Et(t,n,i,i),s?(o.mode=ct,I):(o.havedict=1,E)))},inflateInfo:"pako inflate (from Nodeca project)"};const Ot=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Nt=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const e in n)Ot(n,e)&&(t[e]=n[e])}}return t},Ft={assign:Nt,flattenChunks:t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const n=new Uint8Array(e);for(let e=0,i=0,o=t.length;e<o;e++){let o=t[e];n.set(o,i),i+=o.length}return n}};let It=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){It=!1}const Mt=new Uint8Array(256);for(let t=0;t<256;t++)Mt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Mt[254]=Mt[254]=1;const Dt=(t,e)=>{if(e<65534&&t.subarray&&It)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n};var Rt={string2buf:t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,n,i,o,r,s=t.length,a=0;for(o=0;o<s;o++)n=t.charCodeAt(o),55296==(64512&n)&&o+1<s&&(i=t.charCodeAt(o+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),r=0,o=0;r<a;o++)n=t.charCodeAt(o),55296==(64512&n)&&o+1<s&&(i=t.charCodeAt(o+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?e[r++]=n:n<2048?(e[r++]=192|n>>>6,e[r++]=128|63&n):n<65536?(e[r++]=224|n>>>12,e[r++]=128|n>>>6&63,e[r++]=128|63&n):(e[r++]=240|n>>>18,e[r++]=128|n>>>12&63,e[r++]=128|n>>>6&63,e[r++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,o;const r=new Array(2*n);for(o=0,i=0;i<n;){let e=t[i++];if(e<128){r[o++]=e;continue}let s=Mt[e];if(s>4)r[o++]=65533,i+=s-1;else{for(e&=2===s?31:3===s?15:7;s>1&&i<n;)e=e<<6|63&t[i++],s--;s>1?r[o++]=65533:e<65536?r[o++]=e:(e-=65536,r[o++]=55296|e>>10&1023,r[o++]=56320|1023&e)}}return Dt(r,o)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+Mt[t[n]]>e?n:e}},Vt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function At(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Pt=At;function Lt(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Bt=Lt;const Xt=Object.prototype.toString,{Z_NO_FLUSH:Ut,Z_FINISH:kt,Z_OK:zt,Z_STREAM_END:jt,Z_NEED_DICT:Gt,Z_STREAM_ERROR:Ht,Z_DATA_ERROR:qt,Z_MEM_ERROR:Yt}=x;function Wt(t){this.options=Ft.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Pt,this.strm.avail_out=0;let n=Ct.inflateInit2(this.strm,e.windowBits);if(n!==zt)throw new Error(Vt[n]);if(this.header=new Bt,Ct.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Rt.string2buf(e.dictionary):"[object ArrayBuffer]"===Xt.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Ct.inflateSetDictionary(this.strm,e.dictionary),n!==zt)))throw new Error(Vt[n])}function Kt(t,e){const n=new Wt(e);if(n.push(t),n.err)throw n.msg||Vt[n.err];return n.result}function Jt(t,e){return(e=e||{}).raw=!0,Kt(t,e)}Wt.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,o=this.options.dictionary;let r,s,a;if(this.ended)return!1;for(s=e===~~e?e:!0===e?kt:Ut,"[object ArrayBuffer]"===Xt.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),r=Ct.inflate(n,s),r===Gt&&o&&(r=Ct.inflateSetDictionary(n,o),r===zt?r=Ct.inflate(n,s):r===qt&&(r=Gt));n.avail_in>0&&r===jt&&n.state.wrap>0&&0!==t[n.next_in];)Ct.inflateReset(n),r=Ct.inflate(n,s);switch(r){case Ht:case qt:case Gt:case Yt:return this.onEnd(r),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||r===jt))if("string"===this.options.to){let t=Rt.utf8border(n.output,n.next_out),e=n.next_out-t,o=Rt.buf2string(n.output,t);n.next_out=e,n.avail_out=i-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(o)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==zt||0!==a){if(r===jt)return r=Ct.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Wt.prototype.onData=function(t){this.chunks.push(t)},Wt.prototype.onEnd=function(t){t===zt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ft.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Zt=Wt,Qt=Kt,$t=Jt,te=Kt,ee=x,ne={Inflate:Zt,inflate:Qt,inflateRaw:$t,ungzip:te,constants:ee};t.Inflate=Zt,t.constants=ee,t.default=ne,t.inflate=Qt,t.inflateRaw=$t,t.ungzip=te,Object.defineProperty(t,"__esModule",{value:!0})}(e)},558:function(t,e){var n,i,o;i=[],void 0===(o="function"==typeof(n=function(){var t=function(t){return t.reduce((function(t,e){return 2*t+e}),0)},e=function(t){for(var e=[],n=7;n>=0;n--)e.push(!!(t&1<<n));return e},n=function(t){this.data=t,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return t instanceof Uint8Array?t[this.pos++]:255&t.charCodeAt(this.pos++)},this.readBytes=function(t){for(var e=[],n=0;n<t;n++)e.push(this.readByte());return e},this.read=function(t){for(var e="",n=0;n<t;n++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}},i=function(t,e){for(var n,i,o=0,r=function(t){for(var n=0,i=0;i<t;i++)e.charCodeAt(o>>3)&1<<(7&o)&&(n|=1<<i),o++;return n},s=[],a=1<<t,u=a+1,c=t+1,l=[],h=function(){l=[],c=t+1;for(var e=0;e<a;e++)l[e]=[e];l[a]=[],l[u]=null};;)if(i=n,(n=r(c))!==a){if(n===u)break;if(n<l.length)i!==a&&l.push(l[i].concat(l[n][0]));else{if(n!==l.length)throw new Error("Invalid LZW code.");l.push(l[i].concat(l[i][0]))}s.push.apply(s,l[n]),l.length===1<<c&&c<12&&c++}else h();return s},o=function(n,o){o||(o={});var r=function(t){for(var e=[],i=0;i<t;i++)e.push(n.readBytes(3));return e},s=function(){var t,e;e="";do{t=n.readByte(),e+=n.read(t)}while(0!==t);return e},a=function(){var i={};if(i.sig=n.read(3),i.ver=n.read(3),"GIF"!==i.sig)throw new Error("Not a GIF file.");i.width=n.readUnsigned(),i.height=n.readUnsigned();var s=e(n.readByte());i.gctFlag=s.shift(),i.colorRes=t(s.splice(0,3)),i.sorted=s.shift(),i.gctSize=t(s.splice(0,3)),i.bgColor=n.readByte(),i.pixelAspectRatio=n.readByte(),i.gctFlag&&(i.gct=r(1<<i.gctSize+1)),o.hdr&&o.hdr(i)},u=function(i){var r=function(i){n.readByte();var r=e(n.readByte());i.reserved=r.splice(0,3),i.disposalMethod=t(r.splice(0,3)),i.userInput=r.shift(),i.transparencyGiven=r.shift(),i.delayTime=n.readUnsigned(),i.transparencyIndex=n.readByte(),i.terminator=n.readByte(),o.gce&&o.gce(i)},a=function(t){t.comment=s(),o.com&&o.com(t)},u=function(t){n.readByte(),t.ptHeader=n.readBytes(12),t.ptData=s(),o.pte&&o.pte(t)},c=function(t){var e=function(t){n.readByte(),t.unknown=n.readByte(),t.iterations=n.readUnsigned(),t.terminator=n.readByte(),o.app&&o.app.NETSCAPE&&o.app.NETSCAPE(t)},i=function(t){t.appData=s(),o.app&&o.app[t.identifier]&&o.app[t.identifier](t)};n.readByte(),t.identifier=n.read(8),t.authCode=n.read(3),"NETSCAPE"===t.identifier?e(t):i(t)},l=function(t){t.data=s(),o.unknown&&o.unknown(t)};switch(i.label=n.readByte(),i.label){case 249:i.extType="gce",r(i);break;case 254:i.extType="com",a(i);break;case 1:i.extType="pte",u(i);break;case 255:i.extType="app",c(i);break;default:i.extType="unknown",l(i)}},c=function(a){var u=function(t,e){for(var n=new Array(t.length),i=t.length/e,o=function(i,o){var r=t.slice(o*e,(o+1)*e);n.splice.apply(n,[i*e,e].concat(r))},r=[0,4,2,1],s=[8,8,4,2],a=0,u=0;u<4;u++)for(var c=r[u];c<i;c+=s[u])o(c,a),a++;return n};a.leftPos=n.readUnsigned(),a.topPos=n.readUnsigned(),a.width=n.readUnsigned(),a.height=n.readUnsigned();var c=e(n.readByte());a.lctFlag=c.shift(),a.interlaced=c.shift(),a.sorted=c.shift(),a.reserved=c.splice(0,2),a.lctSize=t(c.splice(0,3)),a.lctFlag&&(a.lct=r(1<<a.lctSize+1)),a.lzwMinCodeSize=n.readByte();var l=s();a.pixels=i(a.lzwMinCodeSize,l),a.interlaced&&(a.pixels=u(a.pixels,a.width)),o.img&&o.img(a)},l=function(){var t={};switch(t.sentinel=n.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",u(t);break;case",":t.type="img",c(t);break;case";":t.type="eof",o.eof&&o.eof(t);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&setTimeout(l,0)};a(),setTimeout(l,0)};return function(t){var e,i,r={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var s in t)r[s]=t[s];r.vp_w&&r.vp_h&&(r.is_vp=!0);var a=null,u=!1,c=null,l=null,h=null,d=null,p=null,f=null,g=null,m=!0,_=!0,x=!1,y=[],w=[],S=r.gif;void 0===r.auto_play&&(r.auto_play=!S.getAttribute("rel:auto_play")||"1"==S.getAttribute("rel:auto_play"));var T,b,v,E,C=r.hasOwnProperty("on_end")?r.on_end:null,O=r.hasOwnProperty("on_error")?r.on_error:null,N=r.hasOwnProperty("loop_delay")?r.loop_delay:0,F=r.hasOwnProperty("loop_mode")?r.loop_mode:"auto",I=!r.hasOwnProperty("draw_while_loading")||r.draw_while_loading,M=!!I&&(!r.hasOwnProperty("show_progress_bar")||r.show_progress_bar),D=r.hasOwnProperty("progressbar_height")?r.progressbar_height:25,R=r.hasOwnProperty("progressbar_background_color")?r.progressbar_background_color:"rgba(255,255,255,0.4)",V=r.hasOwnProperty("progressbar_foreground_color")?r.progressbar_foreground_color:"rgba(255,0,22,.8)",A=function(){c=null,l=null,p=h,h=null,f=null},P=function(){try{o(e,K)}catch(t){U("parse")}},L=function(t,e){T.width=t*Z(),T.height=e*Z(),v.style.minWidth=t*Z()+"px",E.width=t,E.height=e,E.style.width=t+"px",E.style.height=e+"px",E.getContext("2d").setTransform(1,0,0,1,0,0)},B=function(t,e){w[t]?(void 0!==e.x&&(w[t].x=e.x),void 0!==e.y&&(w[t].y=e.y)):w[t]=e},X=function(t,e,n){if(n&&M){var i,o,s,a=D;r.is_vp?x?(o=(r.vp_t+r.vp_h-a)/Z(),a/=Z(),i=r.vp_l/Z()+t/e*(r.vp_w/Z()),s=T.width/Z()):(o=r.vp_t+r.vp_h-a,i=r.vp_l+t/e*r.vp_w,s=T.width):(o=(T.height-a)/(x?Z():1),i=t/e*T.width/(x?Z():1),s=T.width/(x?Z():1),a/=x?Z():1),b.fillStyle=R,b.fillRect(i,o,s-i,a),b.fillStyle=V,b.fillRect(0,o,i,a)}},U=function(t){var e=function(){b.fillStyle="black",b.fillRect(0,0,r.c_w?r.c_w:i.width,r.c_h?r.c_h:i.height),b.strokeStyle="red",b.lineWidth=3,b.moveTo(0,0),b.lineTo(r.c_w?r.c_w:i.width,r.c_h?r.c_h:i.height),b.moveTo(0,r.c_h?r.c_h:i.height),b.lineTo(r.c_w?r.c_w:i.width,0),b.stroke()};a=t,i={width:S.width,height:S.height},y=[],e(),t&&O(t)},k=function(t){L((i=t).width,i.height)},z=function(t){j(),A(),c=t.transparencyGiven?t.transparencyIndex:null,l=t.delayTime,h=t.disposalMethod},j=function(){f&&(y.push({data:f.getImageData(0,0,i.width,i.height),delay:l}),w.push({x:0,y:0}))},G=function(t){f||(f=E.getContext("2d"));var e=y.length,n=t.lctFlag?t.lct:i.gct;e>0&&(3===p?null!==d?f.putImageData(y[d].data,0,0):f.clearRect(g.leftPos,g.topPos,g.width,g.height):d=e-1,2===p&&f.clearRect(g.leftPos,g.topPos,g.width,g.height));var o=f.getImageData(t.leftPos,t.topPos,t.width,t.height);t.pixels.forEach((function(t,e){t!==c&&(o.data[4*e+0]=n[t][0],o.data[4*e+1]=n[t][1],o.data[4*e+2]=n[t][2],o.data[4*e+3]=255)})),f.putImageData(o,t.leftPos,t.topPos),x||(b.scale(Z(),Z()),x=!0),I&&(b.drawImage(E,0,0),I=r.auto_play),g=t},H=function(){var t,e,n,i=-1,o=0,s=function(){return(i+(_?1:-1)+y.length)%y.length},u=function(t){i+=t,l()},c=(t=!1,e=function(){null!==C&&C(S),o++,!1!==F||o<0?n():(t=!1,m=!1)},n=function(){if(t=m){u(1);var o=10*y[i].delay;o||(o=100),0===s()?(o+=N,setTimeout(e,o)):setTimeout(n,o)}},function(){t||setTimeout(n,0)}),l=function(){var t;(i=parseInt(i,10))>y.length-1&&(i=0),i<0&&(i=0),t=w[i],E.getContext("2d").putImageData(y[i].data,t.x,t.y),b.globalCompositeOperation="copy",b.drawImage(E,0,0)},h=function(){m=!0,c()};return{init:function(){a||(r.c_w&&r.c_h||b.scale(Z(),Z()),r.auto_play?c():(i=0,l()))},step:c,play:h,pause:function(){m=!1},playing:m,move_relative:u,current_frame:function(){return i},length:function(){return y.length},move_to:function(t){i=t,l()}}}(),q=function(t){X(e.pos,e.data.length,t)},Y=function(){},W=function(t,e){return function(n){t(n),q(e)}},K={hdr:W(k),gce:W(z),com:W(Y),app:{NETSCAPE:W(Y)},img:W(G,!0),eof:function(t){j(),q(!1),r.c_w&&r.c_h||(T.width=i.width*Z(),T.height=i.height*Z()),H.init(),u=!1,$&&$(S)}},J=function(){var t=S.parentNode,e=document.createElement("div");T=document.createElement("canvas"),b=T.getContext("2d"),v=document.createElement("div"),E=document.createElement("canvas"),e.width=T.width=S.width,e.height=T.height=S.height,v.style.minWidth=S.width+"px",e.className="jsgif",v.className="jsgif_toolbar",e.appendChild(T),e.appendChild(v),t.insertBefore(e,S),t.removeChild(S),r.c_w&&r.c_h&&L(r.c_w,r.c_h),Q=!0},Z=function(){return r.max_width&&i&&i.width>r.max_width?r.max_width/i.width:1},Q=!1,$=!1,tt=function(t){return!u&&($=t||!1,u=!0,y=[],A(),d=null,p=null,f=null,g=null,!0)},et=function(){return y.reduce((function(t,e){return t+e.delay}),0)};return{play:H.play,pause:H.pause,move_relative:H.move_relative,move_to:H.move_to,get_playing:function(){return m},get_canvas:function(){return T},get_canvas_scale:function(){return Z()},get_loading:function(){return u},get_auto_play:function(){return r.auto_play},get_length:function(){return H.length()},get_frames:function(){return y},get_duration:function(){return et()},get_duration_ms:function(){return 10*et()},get_current_frame:function(){return H.current_frame()},load_url:function(t,i){if(tt(i)){var o=new XMLHttpRequest;o.open("GET",t,!0),"overrideMimeType"in o?o.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in o?o.responseType="arraybuffer":o.setRequestHeader("Accept-Charset","x-user-defined"),o.onloadstart=function(){Q||J()},o.onload=function(t){200!=this.status&&U("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var i=this.response;i.toString().indexOf("ArrayBuffer")>0&&(i=new Uint8Array(i)),e=new n(i),setTimeout(P,0)},o.onprogress=function(t){t.lengthComputable&&X(t.loaded,t.total,!0)},o.onerror=function(){U("xhr")},o.send()}},load:function(t){this.load_url(S.getAttribute("rel:animated_src")||S.src,t)},load_raw:function(t,i){tt(i)&&(Q||J(),e=new n(t),setTimeout(P,0))},set_frame_offset:B}}})?n.apply(e,i):n)||(t.exports=o)}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var o={};return(()=>{"use strict";i.d(o,{default:()=>VI});const t=new Map;t.set("x_ite/Namespace",t);const n=t;let r=0,s=0,a=0;const u={CONNECTION_ERROR:r++,BROWSER_EVENT:r++,INITIALIZED_EVENT:r++,SHUTDOWN_EVENT:r++,INITIALIZED_ERROR:r++,NOT_STARTED_STATE:s++,IN_PROGRESS_STATE:s++,COMPLETE_STATE:s++,FAILED_STATE:s++,initializeOnly:1,inputOnly:2,outputOnly:4,inputOutput:7,SFBool:a++,SFColor:a++,SFColorRGBA:a++,SFDouble:a++,SFFloat:a++,SFImage:a++,SFInt32:a++,SFMatrix3d:a++,SFMatrix3f:a++,SFMatrix4d:a++,SFMatrix4f:a++,SFNode:a++,SFRotation:a++,SFString:a++,SFTime:a++,SFVec2d:a++,SFVec2f:a++,SFVec3d:a++,SFVec3f:a++,SFVec4d:a++,SFVec4f:a++,VrmlMatrix:a++,MFBool:a++,MFColor:a++,MFColorRGBA:a++,MFDouble:a++,MFFloat:a++,MFImage:a++,MFInt32:a++,MFMatrix3d:a++,MFMatrix3f:a++,MFMatrix4d:a++,MFMatrix4f:a++,MFNode:a++,MFRotation:a++,MFString:a++,MFTime:a++,MFVec2d:a++,MFVec2f:a++,MFVec3d:a++,MFVec3f:a++,MFVec4d:a++,MFVec4f:a++,X3DBaseNode:0};n.set("x_ite/Base/X3DConstants",u);const c=u,l=function(t,e="",n=!1){e=String(e).replace(/_\d+$/,"");let i=n?`${e}_1`:e,o=1,r=1;for(;t.has(i)||0===i.length;)o=r,r<<=1,i=`${e}_${o}`;if(o>>>=1,r>>>=1,o&&r){for(;o<r;){const n=o+r>>>1;t.has(`${e}_${n}`)?o=n+1:r=n}i=`${e}_${o}`}return i},h=class{static radians(t){return t*(Math.PI/180)}static degrees(t){return t*(180/Math.PI)}static random(t,e){return t+Math.random()*(e-t)}static fract(t){return t%1}static clamp(t,e,n){return Math.min(Math.max(t,e),n)}static interval(t,e,n){return t>=n?(t-e)%(n-e)+e:t<e?(t-n)%(n-e)+n:t}static lerp(t,e,n){return t+n*(e-t)}static slerp(t,e,n){let i=t.dot(e);if(i>=1)return t;i<0&&(i=-i,e.negate());const o=Math.acos(i),r=Math.sin(o),s=Math.sin((1-n)*o)/r,a=Math.sin(n*o)/r;return t.x=t.x*s+e.x*a,t.y=t.y*s+e.y*a,t.z=t.z*s+e.z*a,t.w=t.w*s+e.w*a,t}static simpleSlerp(t,e,n){const i=t.dot(e);if(i>=1)return t;const o=Math.acos(i),r=Math.sin(o),s=Math.sin((1-n)*o)/r,a=Math.sin(n*o)/r;return t.x=t.x*s+e.x*a,t.y=t.y*s+e.y*a,t.z=t.z*s+e.z*a,t.w=t.w*s+e.w*a,t}static isPowerOfTwo(t){return 0==(t-1&t)}static nextPowerOfTwo(t){return this.isPowerOfTwo(t)?t:1<<32-Math.clz32(t)}static bitCount(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}static cmp(t,e){return t>e?1:t<e?-1:0}static less(t,e){return t<e}static greater(t,e){return t>e}static lowerBound(t,e,n,i,o=this.less){let r=0,s=0,a=n-e;for(;a>0;)s=a>>>1,r=e+s,o(t[r],i)?(e=++r,a-=s+1):a=s;return e}static upperBound(t,e,n,i,o=this.less){let r=0,s=0,a=n-e;for(;a>0;)s=a>>>1,r=e+s,o(i,t[r])?a=s:(e=++r,a-=s+1);return e}};n.set("standard/Math/Algorithm",h);const d=h;function p({style:t="TIDY",indent:e="",precision:n=7,doublePrecision:i=15,html:o=!1,closingTags:r=!1}){this.string="",this.indent=e,this.listIndent=e,this.precision=d.clamp(n,1,21),this.doublePrecision=d.clamp(i,1,21),this.html=o,this.closingTags=o||r,this.floatFormat=new Intl.NumberFormat("en",{notation:"standard",maximumSignificantDigits:this.precision,useGrouping:!1}).format,this.floatExponentialFormat=new Intl.NumberFormat("en",{notation:"scientific",maximumSignificantDigits:this.precision,useGrouping:!1}).format,this.doubleFormat=new Intl.NumberFormat("en",{notation:"standard",maximumSignificantDigits:this.doublePrecision,useGrouping:!1}).format,this.doubleExponentialFormat=new Intl.NumberFormat("en",{notation:"scientific",maximumSignificantDigits:this.doublePrecision,useGrouping:!1}).format,this.Style(t),this.executionContextStack=[null],this.importedNodesIndex=new Map,this.exportedNodesIndex=new Map,this.nodes=new Set,this.names=new Map,this.namesByNode=new Map,this.importedNames=new Map,this.routeNodes=new Set,this.level=0,this.containerFields=[],this.units=!0,this.unitCategories=[],this.names.set(null,Object.assign(new Set,{index:0}))}p.prototype={constructor:p,Style:function(t){switch(t){case"CLEAN":this.listIndent="",this.comma=" ",this.break=" ",this.tidyBreak="",this.tidySpace="",this.indentChar="",this.listEnclosure="",this.listBreak="",this.listIndentChar="",this.attribBreak=" ";break;case"SMALL":this.listIndent="",this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace="",this.indentChar="",this.listEnclosure="",this.listBreak="",this.listIndentChar="",this.attribBreak=" ";break;case"COMPACT":this.listIndent="",this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace=" ",this.indentChar="  ",this.listEnclosure=" ",this.listBreak=" ",this.listIndentChar="",this.attribBreak=" ";break;default:this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace=" ",this.indentChar="  ",this.listEnclosure="\n",this.listBreak="\n",this.listIndentChar="  ",this.attribBreak="\n"}},Comma:function(){return this.comma},Break:function(){return this.break},TidyBreak:function(){return this.tidyBreak},ForceBreak:function(){return"\n"},Space:function(){return" "},TidySpace:function(){return this.tidySpace},ListStart:function(){return this.listEnclosure},ListEnd:function(){return this.listEnclosure},ListBreak:function(){return this.listBreak},AttribBreak:function(){return this.attribBreak},Indent:function(){return this.indent},ListIndent:function(){return this.listIndent},IncIndent:function(){return this.indent+=this.indentChar,this.listIndent+=this.listIndentChar,""},DecIndent:function(){return this.indent=this.indent.slice(0,this.indent.length-this.indentChar.length),this.listIndent=this.listIndent.slice(0,this.listIndent.length-this.listIndentChar.length),""},FloatFormat:function(t){if(Number.isFinite(t)){const e=Math.log10(Math.abs(t));return this.precision>e&&e>=-4||0===t?this.floatFormat(t):this.floatExponentialFormat(t).toLowerCase()}return String(t)},DoubleFormat:function(t){if(Number.isFinite(t)){const e=Math.log10(Math.abs(t));return this.doublePrecision>e&&e>=-4||0===t?this.doubleFormat(t):this.doubleExponentialFormat(t).toLowerCase()}return String(t)},PushExecutionContext:function(t){this.executionContextStack.push(t),this.names.has(t)||this.names.set(t,Object.assign(new Set,{index:0})),this.importedNodesIndex.has(t)||this.importedNodesIndex.set(t,new Set),this.exportedNodesIndex.has(t)||this.exportedNodesIndex.set(t,new Set)},PopExecutionContext:function(){this.executionContextStack.pop(),this.ExecutionContext()||(this.importedNodesIndex.clear(),this.exportedNodesIndex.clear())},ExecutionContext:function(){return this.executionContextStack.at(-1)},EnterScope:function(){++this.level},LeaveScope:function(){--this.level,0===this.level&&(this.nodes.clear(),this.namesByNode.clear(),this.importedNames.clear())},ExportedNodes:function(t){const e=this.exportedNodesIndex.get(this.ExecutionContext());t.forEach((function(t){try{e.add(t.getLocalNode())}catch(t){}}))},ImportedNodes:function(t){const e=this.importedNodesIndex.get(this.ExecutionContext());t.forEach((function(t){try{e.add(t.getInlineNode())}catch(t){}}))},AddImportedNode:function(t,e){this.importedNames.set(t,e)},AddRouteNode:function(t){this.routeNodes.add(t)},ExistsRouteNode:function(t){return this.routeNodes.has(t)},IsSharedNode:function(t){return this.ExecutionContext()!==t.getExecutionContext()},AddNode:function(t){this.nodes.add(t),this.AddRouteNode(t)},ExistsNode:function(t){return this.nodes.has(t)},Name:function(t){const e=this.namesByNode.get(t);if(void 0!==e)return e;{const e=t.getName(),i=e.match(/^(.*?)(_\d+)?$/),o=this.names.get(this.ExecutionContext());if(i[1])var n=l(o,e,!!i[2]);else{if(!this.NeedsName(t))return"";n="_"+ ++o.index}return o.add(n),this.namesByNode.set(t,n),n}},NeedsName:function(t){if(t.getCloneCount()>1)return!0;if(t.hasRoutes())return!0;const e=t.getExecutionContext(),n=this.importedNodesIndex.get(e);if(!n){const n=this.exportedNodesIndex.get(e);return!(!n||!n.has(t))}return!!n.has(t)||void 0},LocalName:function(t){const e=this.importedNames.get(t);if(void 0!==e)return e;if(this.ExistsNode(t))return this.Name(t);throw new Error("Couldn't get local name for node '"+t.getTypeName()+"'.")},PushContainerField:function(t){this.containerFields.push(t)},PopContainerField:function(){this.containerFields.pop()},ContainerField:function(){return this.containerFields.length?this.containerFields[this.containerFields.length-1]:null},AccessType:function(t){switch(t){case c.initializeOnly:return"initializeOnly";case c.inputOnly:return"inputOnly";case c.outputOnly:return"outputOnly";case c.inputOutput:return"inputOutput"}},SetUnits:function(t){this.units=t},GetUnits:function(){return this.units},PushUnitCategory:function(t){this.unitCategories.push(t)},PopUnitCategory:function(){this.unitCategories.pop()},Unit:function(t){return 0==this.unitCategories.length?t:this.unitCategories.at(-1)},ToUnit:function(t,e){if(this.units){const n=this.ExecutionContext();if(n)return n.toUnit(t,e)}return e},XMLEncode:function(){const t={"\\":"\\\\","\r":"&#xD;","\n":"&#xA;","\t":"&#x9;",'"':'\\"',"'":"&apos;","<":"&lt;",">":"&gt;","&":"&amp;"},e=/([\\\r\n\t"'<>&])/g;return function(n){return n.replace(e,(e=>t[e]))}}(),XMLEncodeSourceText:function(){const t={"\\":"\\\\",'"':'\\"',"'":"&apos;","<":"&lt;",">":"&gt;","&":"&amp;"},e=/([\\"'<>&])/g;return function(n){return n.replace(e,(e=>t[e]))}}(),JSONEncode:function(){const t={"\\":"\\\\","\r":"\\r","\n":"\\n","\t":"\\t",'"':'\\"'},e=/([\\\t\n\r"])/g;return function(n){return n.replace(e,(e=>t[e]))}}(),JSONNumber:function(t){switch(t){case"NaN":case"Infinity":case"-Infinity":return'"'+t+'"';default:return t}},JSONRemoveComma:function(){this.string=this.string.trimEnd(),this.string.endsWith(",")&&(this.string=this.string.slice(0,-1)),this.string+=this.TidyBreak()}};for(const t of Reflect.ownKeys(p.prototype))Object.defineProperty(p.prototype,t,{enumerable:!1});const f=p;n.set("x_ite/InputOutput/Generator",f);const g=f,m={assign:function(){function t(t,e){this.set(e,t)}return function(e,n){return e.clear(),n.forEach(t,e),e}}(),values:function(){function t(t){this.push(t)}return function(e,n){return e.length=0,n.forEach(t,e),e}}()},_=m;n.set("standard/Utility/MapUtilities",_);const x=_,y=Symbol(),w=Symbol(),S=Symbol(),T=Symbol();function b(){}b.prototype={constructor:b,[y]:"",[w]:new Map,[S]:[],[T]:new Map,getId:function(){return b.getId(this)},getTypeName:function(){return"X3DObject"},setName:function(t){this[y]=t},getName:function(){return this[y]},getDisplayName:function(){return this[y]},hasInterest:function(t,e){return this[w].has(b.getInterestId(t,e))},addInterest:function(t,e,...n){this[w]===b.prototype[w]&&(this[w]=new Map,this[S]=[]);const i=b.getInterestId(t,e),o=e[t];this[w].set(i,o.bind(e,...n,this))},removeInterest:function(t,e){this[w].delete(b.getInterestId(t,e))},getInterests:function(){return this[w]},processInterests:function(){if(this[w].size)for(const t of x.values(this[S],this[w]))t()},getUserData:function(t){return this[T].get(t)},setUserData:function(t,e){this[T]===b.prototype[T]&&(this[T]=new Map),this[T].set(t,e)},removeUserData:function(t){this[T].delete(t)},toString:function(t=Object.prototype){const e=new g(t);return t.scene&&e.PushExecutionContext(t.scene),this.toStream(e),e.string},toVRMLString:function(t=Object.prototype){const e=new g(t);return t.scene&&e.PushExecutionContext(t.scene),this.toVRMLStream(e),e.string},toXMLString:function(t=Object.prototype){const e=new g(t);return t.scene&&e.PushExecutionContext(t.scene),this.toXMLStream(e),e.string},toJSONString:function(t=Object.prototype){const e=new g(t);return t.scene&&e.PushExecutionContext(t.scene),this.toJSONStream(e),e.string},toStream:function(t){t.string=`[object ${this.getTypeName()}]`},dispose:function(){this[w].clear(),this[T].clear()}};for(const t of Reflect.ownKeys(b.prototype))Object.defineProperty(b.prototype,t,{enumerable:!1});Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.getTypeName()}}),Object.assign(b,{getId:function(){const t=new WeakMap;let e=0;return function(n){const i=t.get(n);return void 0!==i?i:(t.set(n,++e),e)}}(),getInterestId:function(t,e){return this.getId(e)+"."+this.getId(e[t])}});const v=b;n.set("x_ite/Base/X3DObject",v);const E=v,C=Symbol(),O=Symbol(),N=Symbol();function F(){E.call(this)}F.prototype=Object.assign(Object.create(E.prototype),{constructor:F,[C]:0,[O]:!1,[N]:new Set,setModificationTime:function(t){this[C]=t},getModificationTime:function(){return this[C]},setTainted:function(t){this[O]=t},isTainted:function(){return this[O]},addEvent:function(){this.setModificationTime(Date.now());for(const t of this[N])t.addEvent(this)},addEventObject:function(t,e){this.setModificationTime(Date.now());for(const t of this[N])t.addEventObject(this,e)},addParent:function(t){this[N]===F.prototype[N]&&(this[N]=new Set),this[N].add(t)},removeParent:function(t){this[N].delete(t)},getParents:function(){return this[N]},dispose:function(){this[N].clear(),E.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(F.prototype))Object.defineProperty(F.prototype,t,{enumerable:!1});const I=F;n.set("x_ite/Base/X3DChildObject",I);const M=I,D=Object.assign([],{create:function(t){if(this.length){const e=this.pop();return e.field=t,e.clear(),e}const e=new Set;return e.field=t,e},copy:function(t){if(this.length){const e=this.pop();e.field=t.field,e.clear();for(const n of t)e.add(n);return e}const e=new Set(t);return e.field=t.field,e},clear:function(){this.length=0}});for(const t of Reflect.ownKeys(D))Object.defineProperty(D,t,{enumerable:!1});const R=D;n.set("x_ite/Base/Events",R);const V=R,A=Symbol.for("X_ITE.X3DEventObject.browser");function P(t){M.call(this),this[A]=t}P.prototype=Object.assign(Object.create(M.prototype),{constructor:P,getBrowser:function(){return this[A]},getExtendedEventHandling:function(){return!0},addEvent:function(t){t.isTainted()||(t.setTainted(!0),this.addEventObject(t,V.create(t)))},addEventObject:function(t,e){const n=this.getBrowser();n.addTaintedField(t,e),n.addBrowserEvent(),this.isTainted()||(t.isInput()||this.getExtendedEventHandling()&&t.isInitializable())&&this.addNodeEvent()},addNodeEvent:function(){if(this.isTainted())return;const t=this.getBrowser();this.setTainted(!0),t.addTaintedNode(this),t.addBrowserEvent()},processEvents:function(){this.setTainted(!1),this.processInterests()}});for(const t of Reflect.ownKeys(P.prototype))Object.defineProperty(P.prototype,t,{enumerable:!1});const L=P;n.set("x_ite/Base/X3DEventObject",L);const B=L;function X(t,e,n){Object.defineProperties(this,{accessType:{value:t,enumerable:!0},dataType:{value:n.getType(),enumerable:!0},name:{value:e,enumerable:!0},value:{value:n}})}X.prototype=Object.assign(Object.create(E.prototype),{constructor:X,getTypeName:function(){return"X3DFieldDefinition"}});for(const t of Reflect.ownKeys(X.prototype))Object.defineProperty(X.prototype,t,{enumerable:!1});const U=X;n.set("x_ite/Base/X3DFieldDefinition",U);const k=U,z=Symbol(),j=Symbol(),G={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=+e;return Number.isInteger(n)?t[z][n]:void 0}},set:function(t,e,n){return void 0!==t[e]&&(t[e]=n,!0)},has:function(t,e){return Number.isInteger(+e)?e<t[z].length:e in t},ownKeys:function(t){return Object.keys(t[z])},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;if(Number.isInteger(n)&&n<t[z].length){const n=Object.getOwnPropertyDescriptor(t[z],e);return n&&(n.writable=!1),n}}};function H(t,e){if(this[z]=[],this[j]=new Map,t)for(const n of t){if(!(n instanceof e))throw new TypeError(`Wrong type in construction of ${this.getTypeName()}.`);this.add(n.name,n)}return new Proxy(this,G)}H.prototype={constructor:H,[Symbol.iterator]:function*(){yield*this[z]},copy:function(){return new this.constructor(this[z])},equals:function(t){const e=this[z],n=t[z],i=e.length;if(e===n)return!0;if(i!==n.length)return!1;for(let t=0;t<i;++t)if(e[t]!==n[t])return!1;return!0},has:function(t){return this[j].has(t)},get:function(t){return this[j].get(t)},add:function(t,e){this[z].push(e),this[j].set(t,e)},addAlias:function(t,e){this[j].set(t,this[j].get(e))},update:function(t,e,n){const i=this[j].get(t);if(t!==e&&this.remove(e),this[j].delete(t),this[j].set(e,n),void 0!==i){const t=this[z].indexOf(i);t>-1&&(this[z][t]=n)}else this[z].push(n)},remove:function(t){const e=this[j].get(t);if(void 0===e)return;const n=this[z].indexOf(e);this[j].delete(t),n>-1&&this[z].splice(n,1)},at:Array.prototype.at,entries:Array.prototype.entries,every:Array.prototype.every,filter:function(t,e){return new this.constructor(Array.prototype.filter.call(this,t,e))},find:Array.prototype.find,findIndex:Array.prototype.findIndex,findLast:Array.prototype.findLast,findLastIndex:Array.prototype.findLastIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:Array.prototype.keys,lastIndexOf:Array.prototype.lastIndexOf,map:function(t,e){return new this.constructor(Array.prototype.map.call(this,t,e))},reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice:function(t,e){return new this.constructor(Array.prototype.slice.call(this,t,e))},some:Array.prototype.some,toReversed:function(){return new this.constructor([...this].reverse())},toSorted:function(t){return new this.constructor([...this].sort(t))},toSpliced:function(t,e,...n){const i=[...this];return i.splice(t,e,...n),new this.constructor(i)},values:Array.prototype.values,with:function(t,e){const n=[...this];return n[t]=e,new this.constructor(n)},toString:function(t=Object.prototype){const e=new g(t);return t.scene&&e.PushExecutionContext(t.scene),this.toStream(e),e.string},toStream:function(t){t.string="[object "+this.getTypeName()+"]"},toVRMLStream:function(t){for(const e of this[z])try{e.toVRMLStream(t),t.string+=t.Break(),this.getTypeName().match(/Proto/)&&(t.string+=t.TidyBreak())}catch(t){}},toXMLStream:function(t){for(const e of this[z])try{e.toXMLStream(t),t.string+=t.TidyBreak()}catch(t){}},toJSONStream:function(t,e){let n=!1;for(const[e,i]of this[z].entries())try{i.toJSONStream(t,!0),t.string+=",",t.string+=t.TidyBreak(),n=!0}catch(t){}return n&&!e&&t.JSONRemoveComma(),n}};for(const t of Reflect.ownKeys(H.prototype))Object.defineProperty(H.prototype,t,{enumerable:!1});Object.defineProperties(H.prototype,{length:{get:function(){return this[z].length}},[Symbol.toStringTag]:{get:function(){return this.getTypeName()}}});const q=H;n.set("x_ite/Base/X3DInfoArray",q);const Y=q;function W(t){return Y.call(this,t,k)}W.prototype=Object.assign(Object.create(Y.prototype),{constructor:W,getTypeName:function(){return"FieldDefinitionArray"}});for(const t of Reflect.ownKeys(W.prototype))Object.defineProperty(W.prototype,t,{enumerable:!1});const K=W;n.set("x_ite/Base/FieldDefinitionArray",K);const J=K,Z=Symbol(),Q=Symbol(),$=Symbol(),tt=Symbol(),et=Symbol(),nt=Symbol(),it=Symbol(),ot=Symbol(),rt=Symbol(),st=Symbol(),at=Symbol.for("X_ITE.X3DField.uniformLocation");function ut(t){M.call(this),this[Z]=t}ut.prototype=Object.assign(Object.create(M.prototype),{constructor:ut,[Z]:null,[Q]:c.initializeOnly,[$]:null,[tt]:new Set,[et]:new Map,[nt]:new Set,[it]:new Map,[ot]:new Set,[rt]:new Set,[st]:new Map,[at]:null,create:function(){return new this.constructor},equals:function(t){return this[Z]===t.valueOf()},assign:function(t){this.set(t.getValue()),this.addEvent()},set:function(t){this[Z]=t},setValue:function(t){this.set(t instanceof this.constructor?t.getValue():t),this.addEvent()},getValue:function(){return this[Z]},setAccessType:function(t){this[Q]=t},getAccessType:function(){return this[Q]},isInitializable:function(){return!!(this[Q]&c.initializeOnly)},isInput:function(){return!!(this[Q]&c.inputOnly)},isOutput:function(){return!!(this[Q]&c.outputOnly)},isReadable:function(){return this[Q]!==c.inputOnly},isWritable:function(){return this[Q]!==c.outputOnly},setUnit:function(t){this[$]=t},getUnit:function(){return this[$]},hasReferences:function(){return 0!==this[tt].size},isReference:function(t){return t===this[Q]||t===c.inputOutput},addReference:function(t){const e=this.getReferences();if(!e.has(t)){switch(e.add(t),this.getAccessType()&t.getAccessType()){case c.initializeOnly:t.addFieldInterest(this),this.assign(t);break;case c.inputOnly:t.addFieldInterest(this);break;case c.outputOnly:this.addFieldInterest(t);break;case c.inputOutput:t.addFieldInterest(this),this.addFieldInterest(t),this.assign(t)}this.processReferencesCallbacks()}},removeReference:function(t){switch(this.getReferences().delete(t),this.getAccessType()&t.getAccessType()){case c.initializeOnly:case c.inputOnly:t.removeFieldInterest(this);break;case c.outputOnly:this.removeFieldInterest(t);break;case c.inputOutput:t.removeFieldInterest(this),this.removeFieldInterest(t)}this.processReferencesCallbacks()},getReferences:function(){return this[tt]===ut.prototype[tt]&&(this[tt]=new Set),this[tt]},addReferencesCallback:function(t,e){this[et]===ut.prototype[et]&&(this[et]=new Map),this[et].set(t,e)},removeReferencesCallback:function(t){this[et].delete(t)},getReferencesCallbacks:function(){return this[et]},processReferencesCallbacks:function(){const t=[];return function(){if(this[et].size)for(const e of x.values(t,this[et]))e()}}(),addFieldInterest:function(t){this[nt]===ut.prototype[nt]&&(this[nt]=new Set),this[nt].add(t)},removeFieldInterest:function(t){this[nt].delete(t)},getFieldInterests:function(){return this[nt]},addFieldCallback:function(t,e){this[it]===ut.prototype[it]&&(this[it]=new Map),this[it].set(t,e)},removeFieldCallback:function(t){this[it].delete(t)},getFieldCallbacks:function(){return this[it]},addInputRoute:function(t){this[ot]===ut.prototype[ot]&&(this[ot]=new Set),this[ot].add(t),this.processRouteCallbacks()},removeInputRoute:function(t){this[ot].delete(t),this.processRouteCallbacks()},getInputRoutes:function(){return this[ot]},addOutputRoute:function(t){this[rt]===ut.prototype[rt]&&(this[rt]=new Set),this[rt].add(t),this.processRouteCallbacks()},removeOutputRoute:function(t){this[rt].delete(t),this.processRouteCallbacks()},getOutputRoutes:function(){return this[rt]},addRouteCallback:function(t,e){this[st]===ut.prototype[st]&&(this[st]=new Map),this[st].set(t,e)},removeRouteCallback:function(t){this[st].delete(t)},getRouteCallbacks:function(){return this[st]},processRouteCallbacks:function(){const t=[];return function(){if(this[st].size)for(const e of x.values(t,this[st]))e()}}(),processEvent:function(){const t=[];return function(e=V.create(this)){if(e.has(this))return;e.add(this),this.setTainted(!1);const n=e.field;n!==this&&this.set(n.getValue(),n.length),this.processInterests();let i=!0;for(const t of this[nt])i?(i=!1,t.addEventObject(this,e)):t.addEventObject(this,V.copy(e));if(i&&V.push(e),this[it].size)for(const e of x.values(t,this[it]))e(this.valueOf())}}(),addCloneCount:Function.prototype,removeCloneCount:Function.prototype,fromString:function(t,e){},dispose:function(){this[tt].clear(),this[et].clear(),this[nt].clear(),this[it].clear(),this[st].clear();for(const t of new Set(this[ot]))t.dispose();for(const t of new Set(this[rt]))t.dispose();M.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(ut.prototype))Object.defineProperty(ut.prototype,t,{enumerable:!1});const ct=ut;n.set("x_ite/Base/X3DField",ct);const lt=ct;function ht(t){return Y.call(this,t,lt)}ht.prototype=Object.assign(Object.create(Y.prototype),{constructor:ht,getTypeName:function(){return"FieldArray"}});for(const t of Reflect.ownKeys(ht.prototype))Object.defineProperty(ht.prototype,t,{enumerable:!1});const dt=ht;n.set("x_ite/Base/FieldArray",dt);const pt=dt;function ft(t){return lt.call(this,!!t)}ft.prototype=Object.assign(Object.create(lt.prototype),{constructor:ft,copy:function(){return new ft(this.getValue())},isDefaultValue:function(){return!1===this.getValue()},set:function(t){lt.prototype.set.call(this,!!t)},getTypeName:function(){return"SFBool"},getType:function(){return c.SFBool},valueOf:function(){return this.getValue()},toStream:function(t){t.string+=this.getValue()?"TRUE":"FALSE"},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){t.string+=this.getValue()?"true":"false"},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){t.string+=this.getValue()?"true":"false"}});for(const t of Reflect.ownKeys(ft.prototype))Object.defineProperty(ft.prototype,t,{enumerable:!1});const gt=ft;n.set("x_ite/Fields/SFBool",gt);const mt=gt,{clamp:_t,interval:xt,degrees:yt}=d,wt=Symbol.for("X_ITE.Color3.r"),St=Symbol.for("X_ITE.Color3.g"),Tt=Symbol.for("X_ITE.Color3.b");function bt(t,e,n){this[wt]=_t(t,0,1),this[St]=_t(e,0,1),this[Tt]=_t(n,0,1)}bt.prototype={constructor:bt,[Symbol.iterator]:function*(){yield this[wt],yield this[St],yield this[Tt]},copy:function(){const t=Object.create(bt.prototype);return t[wt]=this[wt],t[St]=this[St],t[Tt]=this[Tt],t},assign:function(t){return this[wt]=t[wt],this[St]=t[St],this[Tt]=t[Tt],this},set:function(t,e,n){return this[wt]=_t(t,0,1),this[St]=_t(e,0,1),this[Tt]=_t(n,0,1),this},equals:function(t){return this[wt]===t[wt]&&this[St]===t[St]&&this[Tt]===t[Tt]},getHSV:function(t){let e,n,i;const o=Math.min(this[wt],this[St],this[Tt]),r=Math.max(this[wt],this[St],this[Tt]);i=r;const s=r-o;return 0!==r&&0!==s?(n=s/r,e=this[wt]===r?(this[St]-this[Tt])/s:this[St]===r?2+(this[Tt]-this[wt])/s:4+(this[wt]-this[St])/s,e*=Math.PI/3,e<0&&(e+=2*Math.PI)):n=e=0,t[0]=e,t[1]=n,t[2]=i,t},setHSV:function(t,e,n){if(e=_t(e,0,1),n=_t(n,0,1),0===e)this[wt]=this[St]=this[Tt]=n;else{const i=yt(xt(t,0,2*Math.PI))/60,o=Math.floor(i),r=i-o,s=n*(1-e),a=n*(1-e*r),u=n*(1-e*(1-r));switch(o%6){case 0:this[wt]=n,this[St]=u,this[Tt]=s;break;case 1:this[wt]=a,this[St]=n,this[Tt]=s;break;case 2:this[wt]=s,this[St]=n,this[Tt]=u;break;case 3:this[wt]=s,this[St]=a,this[Tt]=n;break;case 4:this[wt]=u,this[St]=s,this[Tt]=n;break;default:this[wt]=n,this[St]=s,this[Tt]=a}}return this},toString:function(){return this[wt]+" "+this[St]+" "+this[Tt]}};const vt={get:function(){return this[wt]},set:function(t){this[wt]=_t(t,0,1)}},Et={get:function(){return this[St]},set:function(t){this[St]=_t(t,0,1)}},Ct={get:function(){return this[Tt]},set:function(t){this[Tt]=_t(t,0,1)}};Object.defineProperties(bt.prototype,{length:{value:3},0:vt,1:Et,2:Ct,r:Object.assign({enumerable:!0},vt),g:Object.assign({enumerable:!0},Et),b:Object.assign({enumerable:!0},Ct)}),Object.assign(bt,{Black:new bt(0,0,0),White:new bt(1,1,1),HSV:function(t,e,n){const i=Object.create(this.prototype);return i.setHSV(t,e,n),i},lerp:function(t,e,n,i){let[o,r,s]=t,[a,u,c]=e;0===r&&(o=a),0===u&&(a=o);const l=Math.abs(a-o);if(l<=Math.PI)return i[0]=o+n*(a-o),i[1]=r+n*(u-r),i[2]=s+n*(c-s),i;const h=2*Math.PI,d=(h-l)*n;let p=o<a?o-d:o+d;return p<0?p+=h:p>h&&(p-=h),i[0]=p,i[1]=r+n*(u-r),i[2]=s+n*(c-s),i}});const Ot=bt;n.set("standard/Math/Numbers/Color3",Ot);const Nt=Ot;function Ft(t,e,n){switch(arguments.length){case 0:return lt.call(this,new Nt(0,0,0));case 1:return lt.call(this,arguments[0]);case 3:return lt.call(this,new Nt(+t,+e,+n))}throw new Error("Invalid arguments.")}Ft.prototype=Object.assign(Object.create(lt.prototype),{constructor:Ft,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Ft(this.getValue().copy())},getTypeName:function(){return"SFColor"},getType:function(){return c.SFColor},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(Nt.Black)},set:function(t){this.getValue().assign(t)},getHSV:function(){return this.getValue().getHSV([])},setHSV:function(t,e,n){this.getValue().setHSV(t,e,n),this.addEvent()},lerp:function(){const t=[],e=[],n=[];return function(i,o){const r=new Ft;return this.getValue().getHSV(t),i.getValue().getHSV(e),Nt.lerp(t,e,o,n),r.setHSV(n[0],n[1],n[2]),r}}(),toStream:function(t){const e=this.getValue(),n=e.length-1;for(let i=0;i<n;++i)t.string+=t.FloatFormat(e[i]),t.string+=t.TidySpace();t.string+=t.FloatFormat(e[n])},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.TidySpace(),this.toJSONStreamValue(t),t.string+=t.TidySpace(),t.string+="]"},toJSONStreamValue:function(t){const e=this.getValue(),n=e.length-1;for(let i=0;i<n;++i)t.string+=t.JSONNumber(t.FloatFormat(e[i])),t.string+=",",t.string+=t.TidySpace();t.string+=t.JSONNumber(t.FloatFormat(e[n]))}});for(const t of Reflect.ownKeys(Ft.prototype))Object.defineProperty(Ft.prototype,t,{enumerable:!1});const It={get:function(){return this.getValue().r},set:function(t){this.getValue().r=+t,this.addEvent()}},Mt={get:function(){return this.getValue().g},set:function(t){this.getValue().g=+t,this.addEvent()}},Dt={get:function(){return this.getValue().b},set:function(t){this.getValue().b=+t,this.addEvent()}};Object.defineProperties(Ft.prototype,{0:It,1:Mt,2:Dt,r:Object.assign({enumerable:!0},It),g:Object.assign({enumerable:!0},Mt),b:Object.assign({enumerable:!0},Dt)});const Rt=Ft;n.set("x_ite/Fields/SFColor",Rt);const Vt=Rt,{clamp:At}=d,Pt=Symbol.for("X_ITE.Color3.r"),Lt=Symbol.for("X_ITE.Color3.g"),Bt=Symbol.for("X_ITE.Color3.b"),Xt=Symbol();function Ut(t,e,n,i){this[Pt]=At(t,0,1),this[Lt]=At(e,0,1),this[Bt]=At(n,0,1),this[Xt]=At(i,0,1)}Ut.prototype={constructor:Ut,[Symbol.iterator]:function*(){yield this[Pt],yield this[Lt],yield this[Bt],yield this[Xt]},copy:function(){const t=Object.create(Ut.prototype);return t[Pt]=this[Pt],t[Lt]=this[Lt],t[Bt]=this[Bt],t[Xt]=this[Xt],t},assign:function(t){return this[Pt]=t[Pt],this[Lt]=t[Lt],this[Bt]=t[Bt],this[Xt]=t[Xt],this},set:function(t,e,n,i){return this[Pt]=At(t,0,1),this[Lt]=At(e,0,1),this[Bt]=At(n,0,1),this[Xt]=At(i,0,1),this},equals:function(t){return this[Pt]===t[Pt]&&this[Lt]===t[Lt]&&this[Bt]===t[Bt]&&this[Xt]===t[Xt]},getHSVA:function(t){return Nt.prototype.getHSV.call(this,t),t[3]=this[Xt],t},setHSVA:function(t,e,n,i){return Nt.prototype.setHSV.call(this,t,e,n),this[Xt]=At(i,0,1),this},toString:function(){return this[Pt]+" "+this[Lt]+" "+this[Bt]+" "+this[Xt]}};const kt={get:function(){return this[Pt]},set:function(t){this[Pt]=At(t,0,1)}},zt={get:function(){return this[Lt]},set:function(t){this[Lt]=At(t,0,1)}},jt={get:function(){return this[Bt]},set:function(t){this[Bt]=At(t,0,1)}},Gt={get:function(){return this[Xt]},set:function(t){this[Xt]=At(t,0,1)}};Object.defineProperties(Ut.prototype,{length:{value:4},0:kt,1:zt,2:jt,3:Gt,r:Object.assign({enumerable:!0},kt),g:Object.assign({enumerable:!0},zt),b:Object.assign({enumerable:!0},jt),a:Object.assign({enumerable:!0},Gt)}),Object.assign(Ut,{Transparent:new Ut(0,0,0,0),Black:new Ut(0,0,0,1),White:new Ut(1,1,1,1),HSVA:function(t,e,n,i){const o=Object.create(this.prototype);return o.setHSVA(t,e,n,i),o},lerp:function(t,e,n,i){const o=t[3];return Nt.lerp(t,e,n,i),i[3]=o+n*(e[3]-o),i}});const Ht=Ut;n.set("standard/Math/Numbers/Color4",Ht);const qt=Ht;function Yt(t,e,n,i){switch(arguments.length){case 0:return lt.call(this,new qt(0,0,0,0));case 1:return lt.call(this,arguments[0]);case 4:return lt.call(this,new qt(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}Yt.prototype=Object.assign(Object.create(lt.prototype),{constructor:Yt,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Yt(this.getValue().copy())},getTypeName:function(){return"SFColorRGBA"},getType:function(){return c.SFColorRGBA},equals:Vt.prototype.equals,isDefaultValue:function(){return this.getValue().equals(qt.Transparent)},set:Vt.prototype.set,getHSVA:function(){return this.getValue().getHSVA([])},setHSVA:function(t,e,n,i){this.getValue().setHSVA(t,e,n,i),this.addEvent()},lerp:function(){const t=[],e=[],n=[];return function(i,o){const r=new Yt;return this.getValue().getHSVA(t),i.getValue().getHSVA(e),qt.lerp(t,e,o,n),r.setHSVA(n[0],n[1],n[2],n[3]),r}}(),toStream:Vt.prototype.toStream,toVRMLStream:Vt.prototype.toVRMLStream,toXMLStream:Vt.prototype.toXMLStream,toJSONStream:Vt.prototype.toJSONStream,toJSONStreamValue:Vt.prototype.toJSONStreamValue});for(const t of Reflect.ownKeys(Yt.prototype))Object.defineProperty(Yt.prototype,t,{enumerable:!1});const Wt={get:function(){return this.getValue().r},set:function(t){this.getValue().r=+t,this.addEvent()}},Kt={get:function(){return this.getValue().g},set:function(t){this.getValue().g=+t,this.addEvent()}},Jt={get:function(){return this.getValue().b},set:function(t){this.getValue().b=+t,this.addEvent()}},Zt={get:function(){return this.getValue().a},set:function(t){this.getValue().a=+t,this.addEvent()}};Object.defineProperties(Yt.prototype,{0:Wt,1:Kt,2:Jt,3:Zt,r:Object.assign({enumerable:!0},Wt),g:Object.assign({enumerable:!0},Kt),b:Object.assign({enumerable:!0},Jt),a:Object.assign({enumerable:!0},Zt)});const Qt=Yt;n.set("x_ite/Fields/SFColorRGBA",Qt);const $t=Qt;function te(t){return lt.call(this,arguments.length?+t:0)}te.prototype=Object.assign(Object.create(lt.prototype),{constructor:te,copy:function(){return new te(this.getValue())},getTypeName:function(){return"SFDouble"},getType:function(){return c.SFDouble},isDefaultValue:function(){return 0===this.getValue()},set:function(t){lt.prototype.set.call(this,+t)},valueOf:lt.prototype.getValue,toStream:function(t){const e=t.Unit(this.getUnit());t.string+=t.DoubleFormat(t.ToUnit(e,this.getValue()))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){const e=t.Unit(this.getUnit());t.string+=t.JSONNumber(t.DoubleFormat(t.ToUnit(e,this.getValue())))}});for(const t of Reflect.ownKeys(te.prototype))Object.defineProperty(te.prototype,t,{enumerable:!1});const ee=te;n.set("x_ite/Fields/SFDouble",ee);const ne=ee;function ie(t){return lt.call(this,arguments.length?+t:0)}ie.prototype=Object.assign(Object.create(lt.prototype),{constructor:ie,copy:function(){return new ie(this.getValue())},getTypeName:function(){return"SFFloat"},getType:function(){return c.SFFloat},isDefaultValue:function(){return 0===this.getValue()},set:function(t){lt.prototype.set.call(this,+t)},valueOf:lt.prototype.getValue,toStream:function(t){const e=t.Unit(this.getUnit());t.string+=t.FloatFormat(t.ToUnit(e,this.getValue()))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){const e=t.Unit(this.getUnit());t.string+=t.JSONNumber(t.FloatFormat(t.ToUnit(e,this.getValue())))}});for(const t of Reflect.ownKeys(ie.prototype))Object.defineProperty(ie.prototype,t,{enumerable:!1});const oe=ie;n.set("x_ite/Fields/SFFloat",oe);const re=oe;function se(t){return lt.call(this,0|t)}se.prototype=Object.assign(Object.create(lt.prototype),{constructor:se,copy:function(){return new se(this.getValue())},getTypeName:function(){return"SFInt32"},getType:function(){return c.SFInt32},isDefaultValue:function(){return 0===this.getValue()},set:function(t){lt.prototype.set.call(this,0|t)},valueOf:lt.prototype.getValue,toStream:function(t){t.string+=this.getValue().toString()},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){this.toStream(t)},toJSONStreamValue:function(t){this.toStream(t)}});for(const t of Reflect.ownKeys(se.prototype))Object.defineProperty(se.prototype,t,{enumerable:!1});const ae=se;n.set("x_ite/Fields/SFInt32",ae);const ue=ae;const ce=function(t,e,n,i,o,r){const s=r?"DoubleFormat":"FloatFormat";return Object.assign(Object.create(lt.prototype),{constructor:t,[Symbol.iterator]:function*(){yield*this.getValue()},getTypeName:function(){return e},getType:function(){return n},copy:function(){return new this.constructor(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(i.Identity)},set:function(t){this.getValue().assign(t)},setTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e?e.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,o=o?o.getValue():null,this.getValue().set(t,e,n,i,o)},getTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e?e.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,o=o?o.getValue():null,this.getValue().get(t,e,n,i,o)},determinant:function(){return this.getValue().determinant()},transpose:function(){return new this.constructor(this.getValue().copy().transpose())},inverse:function(){return new this.constructor(this.getValue().copy().inverse())},multLeft:function(t){return new this.constructor(this.getValue().copy().multLeft(t.getValue()))},multRight:function(t){return new this.constructor(this.getValue().copy().multRight(t.getValue()))},multVecMatrix:function(t){return new o(this.getValue().multVecMatrix(t.getValue().copy()))},multMatrixVec:function(t){return new o(this.getValue().multMatrixVec(t.getValue().copy()))},multDirMatrix:function(t){return new o(this.getValue().multDirMatrix(t.getValue().copy()))},multMatrixDir:function(t){return new o(this.getValue().multMatrixDir(t.getValue().copy()))},toStream:function(t){const e=this.getValue(),n=e.length-1;for(let i=0;i<n;++i)t.string+=t[s](e[i]),t.string+=t.TidySpace();t.string+=t[s](e[n])},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.TidySpace(),this.toJSONStreamValue(t),t.string+=t.TidySpace(),t.string+="]"},toJSONStreamValue:function(t){const e=this.getValue(),n=e.length-1;for(let i=0;i<n;++i)t.string+=t.JSONNumber(t[s](e[i])),t.string+=",",t.string+=t.TidySpace();t.string+=t.JSONNumber(t[s](e[n]))}})};n.set("x_ite/Fields/SFMatrixPrototypeTemplate",ce);const le=ce;const he=function(t,e,n,i,o){const r=o?"DoubleFormat":"FloatFormat";return Object.assign(Object.create(lt.prototype),{constructor:t,[Symbol.iterator]:function*(){yield*this.getValue()},getTypeName:function(){return e},getType:function(){return n},copy:function(){return new this.constructor(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(i.Zero)},set:function(t){this.getValue().assign(t)},abs:function(){return new this.constructor(this.getValue().copy().abs())},add:function(t){return new this.constructor(this.getValue().copy().add(t.getValue()))},distance:function(t){return this.getValue().distance(t.getValue())},divide:function(t){return new this.constructor(this.getValue().copy().divide(t))},divVec:function(t){return new this.constructor(this.getValue().copy().divVec(t.getValue()))},dot:function(t){return this.getValue().dot(t.getValue())},inverse:function(){return new this.constructor(this.getValue().copy().inverse())},length:function(){return this.getValue().magnitude()},lerp:function(t,e){return new this.constructor(this.getValue().copy().lerp(t,e))},max:function(t){return new this.constructor(this.getValue().copy().max(t.getValue()))},min:function(t){return new this.constructor(this.getValue().copy().min(t.getValue()))},multiply:function(t){return new this.constructor(this.getValue().copy().multiply(t))},multVec:function(t){return new this.constructor(this.getValue().copy().multVec(t.getValue()))},negate:function(){return new this.constructor(this.getValue().copy().negate())},normalize:function(t){return new this.constructor(this.getValue().copy().normalize())},subtract:function(t){return new this.constructor(this.getValue().copy().subtract(t.getValue()))},toStream:function(t){const e=this.getValue(),n=e.length-1,i=t.Unit(this.getUnit());for(let o=0;o<n;++o)t.string+=t[r](t.ToUnit(i,e[o])),t.string+=t.TidySpace();t.string+=t[r](t.ToUnit(i,e[n]))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.TidySpace(),this.toJSONStreamValue(t),t.string+=t.TidySpace(),t.string+="]"},toJSONStreamValue:function(t){const e=this.getValue(),n=e.length-1,i=t.Unit(this.getUnit());for(let o=0;o<n;++o)t.string+=t.JSONNumber(t[r](t.ToUnit(i,e[o]))),t.string+=",",t.string+=t.TidySpace();t.string+=t.JSONNumber(t[r](t.ToUnit(i,e[n])))}})};n.set("x_ite/Fields/SFVecPrototypeTemplate",he);const de=he;function pe(t,e){this.x=t,this.y=e}pe.prototype={constructor:pe,[Symbol.iterator]:function*(){yield this.x,yield this.y},copy:function(){const t=Object.create(pe.prototype);return t.x=this.x,t.y=this.y,t},assign:function(t){return this.x=t.x,this.y=t.y,this},set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this.x===t.x&&this.y===t.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},multiply:function(t){return this.x*=t,this.y*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this},divide:function(t){return this.x/=t,this.y/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this},normalize:function(){const t=Math.hypot(this.x,this.y);return t&&(this.x/=t,this.y/=t),this},dot:function(t){return this.x*t.x+this.y*t.y},norm:function(){const{x:t,y:e}=this;return t*t+e*e},magnitude:function(){return Math.hypot(this.x,this.y)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y)},lerp:function(t,e){const{x:n,y:i}=this;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},min:function(t){let{x:e,y:n}=this;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y);return this.x=e,this.y=n,this},max:function(t){let{x:e,y:n}=this;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y);return this.x=e,this.y=n,this},toString:function(){return this.x+" "+this.y}},Object.defineProperties(pe.prototype,{length:{value:2},0:{get:function(){return this.x},set:function(t){this.x=t}},1:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(pe,{Zero:new pe(0,0),One:new pe(1,1),xAxis:new pe(1,0),yAxis:new pe(0,1)});const fe=pe;n.set("standard/Math/Numbers/Vector2",fe);const ge=fe;function me(t,e,n){function i(t,e){switch(arguments.length){case 0:return lt.call(this,new ge(0,0));case 1:return lt.call(this,arguments[0]);case 2:return lt.call(this,new ge(+t,+e))}throw new Error("Invalid arguments.")}i.prototype=de(i,t,e,ge,n);for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()}},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()}};return Object.defineProperties(i.prototype,{0:o,1:r,x:Object.assign({enumerable:!0},o),y:Object.assign({enumerable:!0},r)}),i}const _e={SFVec2d:me("SFVec2d",c.SFVec2d,!0),SFVec2f:me("SFVec2f",c.SFVec2f,!1)};n.set("x_ite/Fields/SFVec2",_e);const xe=_e;function ye(t,e,n){this.x=t,this.y=e,this.z=n}ye.prototype={constructor:ye,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z},copy:function(){const t=Object.create(ye.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},cross:function(t){const{x:e,y:n,z:i}=this,{x:o,y:r,z:s}=t;return this.x=n*s-i*r,this.y=i*o-e*s,this.z=e*r-n*o,this},normalize:function(){const t=Math.hypot(this.x,this.y,this.z);return t&&(this.x/=t,this.y/=t,this.z/=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},norm:function(){const{x:t,y:e,z:n}=this;return t*t+e*e+n*n},magnitude:function(){return Math.hypot(this.x,this.y,this.z)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)},lerp:function(t,e){const{x:n,y:i,z:o}=this;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=o+e*(t.z-o),this},slerp:function(){const t=new ye(0,0,0);return function(e,n){return d.simpleSlerp(this,t.assign(e),n)}}(),abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},min:function(t){let{x:e,y:n,z:i}=this;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y),i=Math.min(i,t.z);return this.x=e,this.y=n,this.z=i,this},max:function(t){let{x:e,y:n,z:i}=this;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y),i=Math.max(i,t.z);return this.x=e,this.y=n,this.z=i,this},toString:function(){return this.x+" "+this.y+" "+this.z}},Object.defineProperties(ye.prototype,{length:{value:3},0:{get:function(){return this.x},set:function(t){this.x=t}},1:{get:function(){return this.y},set:function(t){this.y=t}},2:{get:function(){return this.z},set:function(t){this.z=t}}}),Object.assign(ye,{Zero:new ye(0,0,0),One:new ye(1,1,1),xAxis:new ye(1,0,0),yAxis:new ye(0,1,0),zAxis:new ye(0,0,1)});const we=ye;n.set("standard/Math/Numbers/Vector3",we);const Se=we;function Te(){if(arguments.length)for(let t=0;t<4;++t)this[t]=arguments[t];else this.identity()}Te.prototype={constructor:Te,[Symbol.iterator]:function*(){for(let t=0;t<4;++t)yield this[t]},copy:function(){const t=Object.create(Te.prototype);for(let e=0;e<4;++e)t[e]=this[e];return t},assign:function(t){for(let e=0;e<4;++e)this[e]=t[e];return this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]},set1:function(t,e,n){this[t*this.order+e]=n},get1:function(t,e){return this[t*this.order+e]},set:function(){switch(arguments.length){case 0:this.identity();break;case 4:for(let t=0;t<4;++t)this[t]=arguments[t]}return this},determinant1:function(){return this[0]},determinant:function(){return this[0]*this[3]-this[1]*this[2]},transpose:function(){const t=this[1];return this[1]=this[2],this[2]=t,this},inverse:function(){const{0:t,1:e,2:n,3:i}=this,o=t*i-e*n;return this[0]=i/o,this[1]=-e/o,this[2]=-n/o,this[3]=t/o,this},multLeft:function(t){const{0:e,1:n,2:i,3:o}=this,{0:r,1:s,2:a,3:u}=t;return this[0]=e*r+i*s,this[1]=n*r+o*s,this[2]=e*a+i*u,this[3]=n*a+o*u,this},multRight:function(t){const{0:e,1:n,2:i,3:o}=this,{0:r,1:s,2:a,3:u}=t;return this[0]=r*e+a*n,this[1]=s*e+u*n,this[2]=r*i+a*o,this[3]=s*i+u*o,this},multVecMatrix:function(t){if("number"==typeof t){const e=t,n=e*this[1]+this[3];return(e*this[0]+this[2])/n}{const{x:e,y:n}=t;return t.x=e*this[0]+n*this[2],t.y=e*this[1]+n*this[3],t}},multMatrixVec:function(t){if("number"==typeof t){const e=t,n=e*this[2]+this[3];return(e*this[0]+this[1])/n}{const{x:e,y:n}=t;return t.x=e*this[0]+n*this[1],t.y=e*this[2]+n*this[3],t}},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=1},toString:function(){return Array.prototype.join.call(this," ")}},Object.defineProperties(Te.prototype,{order:{value:2},length:{value:4},x:{get:function(){const t=new ge(0,0);return function(){return t.set(this[0],this[1])}}()},y:{get:function(){const t=new ge(0,0);return function(){return t.set(this[2],this[3])}}()},xAxis:{get:function(){return this[0]}},origin:{get:function(){return this[2]}},submatrix:{get:function(){return this[0]}}}),Object.assign(Te,{Identity:new Te});const be=Te;n.set("standard/Math/Numbers/Matrix2",be);const ve=be,Ee=[],Ce=[],Oe=[];const Ne=function(t,e){const n=t.order,i=t.length,o=e.values,r=e.vectors;let s,a,u,c,l,h,d,p,f,g,m,_,x;for(_=0;_<n;++_)for(Ee[_]=Ee[_]??[],Ce[_]=o[_]=t.get1(_,_),Oe[_]=0,x=0;x<n;++x)r[_][x]=_===x?1:0,Ee[_][x]=t.get1(x,_);for(_=0;_<50;++_){for(s=0,g=0;g<n-1;++g)for(m=g+1;m<n;++m)s+=Math.abs(Ee[g][m]);if(0===s)break;for(f=_<3?.2*s/i:0,g=0;g<n-1;++g)for(m=g+1;m<n;++m)if(p=100*Math.abs(Ee[g][m]),_>3&&Math.abs(o[g])+p===Math.abs(o[g])&&Math.abs(o[m])+p===Math.abs(o[m]))Ee[g][m]=0;else if(Math.abs(Ee[g][m])>f){for(d=o[m]-o[g],Math.abs(d)+p===Math.abs(d)?l=Ee[g][m]/d:(a=.5*d/Ee[g][m],l=1/(Math.abs(a)+Math.sqrt(1+a*a)),a<0&&(l=-l)),u=1/Math.sqrt(1+l*l),c=l*u,h=c/(1+u),d=l*Ee[g][m],Oe[g]-=d,Oe[m]+=d,o[g]-=d,o[m]+=d,Ee[g][m]=0,x=0;x<g;++x)p=Ee[x][g],d=Ee[x][m],Ee[x][g]=p-c*(d+p*h),Ee[x][m]=d+c*(p-d*h);for(x=g+1;x<m;++x)p=Ee[g][x],d=Ee[x][m],Ee[g][x]=p-c*(d+p*h),Ee[x][m]=d+c*(p-d*h);for(x=m+1;x<n;++x)p=Ee[g][x],d=Ee[m][x],Ee[g][x]=p-c*(d+p*h),Ee[m][x]=d+c*(p-d*h);for(x=0;x<n;++x)p=r[x][g],d=r[x][m],r[x][g]=p-c*(d+p*h),r[x][m]=d+c*(p-d*h)}for(g=0;g<n;++g)o[g]=Ce[g]+=Oe[g],Oe[g]=0}return e};n.set("standard/Math/Algorithms/eigen_decomposition",Ne);const Fe=Ne;function Ie(){if(arguments.length)for(let t=0;t<9;++t)this[t]=arguments[t];else this.identity()}Ie.prototype={constructor:Ie,[Symbol.iterator]:function*(){for(let t=0;t<9;++t)yield this[t]},copy:function(){const t=Object.create(Ie.prototype);for(let e=0;e<9;++e)t[e]=this[e];return t},assign:function(t){for(let e=0;e<9;++e)this[e]=t[e];return this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]&&this[4]===t[4]&&this[5]===t[5]&&this[6]===t[6]&&this[7]===t[7]&&this[8]===t[8]},rotation:function(){return Math.atan2(this[1],this[0])},set1:function(t,e,n){return this[t*this.order+e]=n,this},get1:function(t,e){return this[t*this.order+e]},set:function(){const t=new ge(0,0);return function(e,n,i,o,r){switch(arguments.length){case 0:this.identity();break;case 1:null===e&&(e=ge.Zero),this.identity(),this.translate(e);break;case 2:null===e&&(e=ge.Zero),null===n&&(n=0),this.identity(),this.translate(e),0!==n&&this.rotate(n);break;case 3:null===e&&(e=ge.Zero),null===n&&(n=0),null===i&&(i=ge.One),this.identity(),this.translate(e),0!==n&&this.rotate(n),i.equals(ge.One)||this.scale(i);break;case 4:if(null===e&&(e=ge.Zero),null===n&&(n=0),null===i&&(i=ge.One),null===o&&(o=0),this.identity(),this.translate(e),0!==n&&this.rotate(n),!i.equals(ge.One)){0!==o?(this.rotate(o),this.scale(i),this.rotate(-o)):this.scale(i)}break;case 5:{null===e&&(e=ge.Zero),null===n&&(n=0),null===i&&(i=ge.One),null===o&&(o=0),null===r&&(r=ge.Zero),this.identity(),this.translate(e);const s=!r.equals(ge.Zero);s&&this.translate(r),0!==n&&this.rotate(n),i.equals(ge.One)||(0!==o?(this.rotate(o),this.scale(i),this.rotate(-o)):this.scale(i)),s&&this.translate(t.assign(r).negate());break}case 9:for(let t=0;t<9;++t)this[t]=arguments[t]}return this}}(),get:function(){const t=new ge(0,0),e=new Se(0,0,0),n=new ge(0,0),i=new Se(0,0,0),o=new ge(0,0),r=new ve,s=new ve,a=new ge(0,0);return function(u,c,l,h,d){switch(null===u&&(u=t),null===c&&(c=e),null===l&&(l=n),null===h&&(h=i),null===d&&(d=o),arguments.length){case 1:u.set(this[6],this[7]);break;case 2:this.factor(u,r,n,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]);break;case 3:this.factor(u,r,l,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]);break;case 4:this.factor(u,r,l,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]),h[0]=s[0],h[1]=s[1],h[2]=Math.atan2(s[1],s[0]);break;case 5:Me.set(a.assign(d).negate()),Me.multLeft(this),Me.translate(d),Me.get(u,c,l,h)}}}(),factor:function(){const t=new ve,e=new ve,n=new ve,i={values:[],vectors:[[],[]]};return function(o,r,s,a){o.set(this[6],this[7]);const u=this.submatrix,c=u.determinant()<0?-1:1;n.assign(u).transpose().multLeft(u);const l=Fe(n,i);a.set(l.vectors[0][0],l.vectors[1][0],l.vectors[0][1],l.vectors[1][1]),s.x=c*Math.sqrt(l.values[0]),s.y=c*Math.sqrt(l.values[1]),t[0]=1/s.x,t[3]=1/s.y,r.assign(e.assign(a).transpose().multRight(t).multRight(a).multRight(u))}}(),determinant2:function(){return this[0]*this[4]-this[1]*this[3]},determinant:function(){const{0:t,1:e,2:n,3:i,4:o,5:r,6:s,7:a,8:u}=this;return t*(o*u-r*a)-e*(i*u-r*s)+n*(i*a-o*s)},transpose:function(){let t;return t=this[1],this[1]=this[3],this[3]=t,t=this[2],this[2]=this[6],this[6]=t,t=this[5],this[5]=this[7],this[7]=t,this},inverse:function(){const{0:t,1:e,2:n,3:i,4:o,5:r,6:s,7:a,8:u}=this,c=t*o,l=t*a,h=i*e,d=i*a,p=s*e,f=s*o;let g=c*u-l*r-h*u+d*n+p*r-f*n;g=1/g;const m=(o*u-a*r)*g,_=-(e*u-a*n)*g,x=(e*r-o*n)*g,y=-(i*u-s*r)*g,w=(t*u-s*n)*g,S=-(t*r-i*n)*g;return this[0]=m,this[1]=_,this[2]=x,this[3]=y,this[4]=w,this[5]=S,this[6]=(d-f)*g,this[7]=-(l-p)*g,this[8]=(c-h)*g,this},multLeft:function(t){const{0:e,1:n,2:i,3:o,4:r,5:s,6:a,7:u,8:c}=this,{0:l,1:h,2:d,3:p,4:f,5:g,6:m,7:_,8:x}=t;return this[0]=e*l+o*h+a*d,this[1]=n*l+r*h+u*d,this[2]=i*l+s*h+c*d,this[3]=e*p+o*f+a*g,this[4]=n*p+r*f+u*g,this[5]=i*p+s*f+c*g,this[6]=e*m+o*_+a*x,this[7]=n*m+r*_+u*x,this[8]=i*m+s*_+c*x,this},multRight:function(t){const{0:e,1:n,2:i,3:o,4:r,5:s,6:a,7:u,8:c}=this,{0:l,1:h,2:d,3:p,4:f,5:g,6:m,7:_,8:x}=t;return this[0]=e*l+n*p+i*m,this[1]=e*h+n*f+i*_,this[2]=e*d+n*g+i*x,this[3]=o*l+r*p+s*m,this[4]=o*h+r*f+s*_,this[5]=o*d+r*g+s*x,this[6]=a*l+u*p+c*m,this[7]=a*h+u*f+c*_,this[8]=a*d+u*g+c*x,this},multVecMatrix:function(t){if(2===t.length){const{x:e,y:n}=t,i=e*this[2]+n*this[5]+this[8];return t.x=(e*this[0]+n*this[3]+this[6])/i,t.y=(e*this[1]+n*this[4]+this[7])/i,t}{const{x:e,y:n,z:i}=t;return t.x=e*this[0]+n*this[3]+i*this[6],t.y=e*this[1]+n*this[4]+i*this[7],t.z=e*this[2]+n*this[5]+i*this[8],t}},multMatrixVec:function(t){if(2===t.length){const{x:e,y:n}=t,i=e*this[6]+n*this[7]+this[8];return t.x=(e*this[0]+n*this[1]+this[2])/i,t.y=(e*this[3]+n*this[4]+this[5])/i,t}{const{x:e,y:n,z:i}=t;return t.x=e*this[0]+n*this[1]+i*this[2],t.y=e*this[3]+n*this[4]+i*this[5],t.z=e*this[6]+n*this[7]+i*this[8],t}},multDirMatrix:function(t){const{x:e,y:n}=t;return t.x=e*this[0]+n*this[3],t.y=e*this[1]+n*this[4],t},multMatrixDir:function(t){const{x:e,y:n}=t;return t.x=e*this[0]+n*this[1],t.y=e*this[3]+n*this[4],t},identity:function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this[6]=0,this[7]=0,this[8]=1,this},translate:function(t){const{x:e,y:n}=t;return this[6]+=this[0]*e+this[3]*n,this[7]+=this[1]*e+this[4]*n,this},rotate:function(t){return this.multLeft(Ie.Rotation(t))},scale:function(t){const{x:e,y:n}=t;return this[0]*=e,this[3]*=n,this[1]*=e,this[4]*=n,this},skewX:function(t){const e=Math.tan(t);return this[3]+=this[0]*e,this[4]+=this[1]*e,this[5]+=this[2]*e,this},skewY:function(t){const e=Math.tan(t);return this[0]+=this[3]*e,this[1]+=this[4]*e,this[2]+=this[5]*e,this},toString:function(){return Array.prototype.join.call(this," ")}},Object.defineProperties(Ie.prototype,{order:{value:3},length:{value:9},x:{get:function(){const t=new Se(0,0,0);return function(){return t.set(this[0],this[1],this[2])}}()},y:{get:function(){const t=new Se(0,0,0);return function(){return t.set(this[3],this[4],this[5])}}()},z:{get:function(){const t=new Se(0,0,0);return function(){return t.set(this[6],this[7],this[8])}}()},xAxis:{get:function(){const t=new ge(0,0);return function(){return t.set(this[0],this[1])}}()},yAxis:{get:function(){const t=new ge(0,0);return function(){return t.set(this[3],this[4])}}()},origin:{get:function(){const t=new ge(0,0);return function(){return t.set(this[6],this[7])}}()},submatrix:{get:function(){const t=new ve;return function(){return t[0]=this[0],t[1]=this[1],t[2]=this[3],t[3]=this[4],t}}()}}),Object.assign(Ie,{Identity:new Ie,Rotation:function(t){const e=Math.sin(t),n=Math.cos(t);return new Ie(n,e,0,-e,n,0,0,0,1)},Matrix2:function(t){return new Ie(t[0],t[1],0,t[2],t[3],0,0,0,1)}});const Me=new Ie,De=Ie;n.set("standard/Math/Numbers/Matrix3",De);const Re=De;function Ve(t,e,n,i){function o(t,e,n,i,o,r,s,a,u){switch(arguments.length){case 0:return lt.call(this,new Re);case 1:return lt.call(this,arguments[0]);case 3:{const t=arguments[0],e=arguments[1],n=arguments[2];return lt.call(this,new Re(t.x,t.y,t.z,e.x,e.y,e.z,n.x,n.y,n.z))}case 9:return lt.call(this,new Re(+t,+e,+n,+i,+o,+r,+s,+a,+u))}throw new Error("Invalid arguments.")}o.prototype=Object.assign(le(o,t,e,Re,n,i),{setTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e||0,n=n?n.getValue():null,i=i||0,o=o?o.getValue():null,this.getValue().set(t,e,n,i,o)}});for(const t of Reflect.ownKeys(o.prototype))Object.defineProperty(o.prototype,t,{enumerable:!1});function r(t){Object.defineProperty(o.prototype,t,{get:function(){return this.getValue()[t]},set:function(e){this.getValue()[t]=+e,this.addEvent()},enumerable:!0})}for(let t=0,e=Re.prototype.length;t<e;++t)r(t);return o}const Ae={SFMatrix3d:Ve("SFMatrix3d",c.SFMatrix3d,xe.SFVec2d,!0),SFMatrix3f:Ve("SFMatrix3f",c.SFMatrix3f,xe.SFVec2f,!1)};n.set("x_ite/Fields/SFMatrix3",Ae);const Pe=Ae;function Le(t,e,n){function i(t,e,n){switch(arguments.length){case 0:return lt.call(this,new Se(0,0,0));case 1:return lt.call(this,arguments[0]);case 3:return lt.call(this,new Se(+t,+e,+n))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(de(i,t,e,Se,n),{cross:function(t){return new this.constructor(this.getValue().copy().cross(t.getValue()))}});for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()}},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()}},s={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()}};return Object.defineProperties(i.prototype,{0:o,1:r,2:s,x:Object.assign({enumerable:!0},o),y:Object.assign({enumerable:!0},r),z:Object.assign({enumerable:!0},s)}),i}const Be={SFVec3d:Le("SFVec3d",c.SFVec3d,!0),SFVec3f:Le("SFVec3f",c.SFVec3f,!1)};n.set("x_ite/Fields/SFVec3",Be);const Xe=Be;function Ue(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i}Ue.prototype={constructor:Ue,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z,yield this.w},copy:function(){const t=Object.create(Ue.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},getReal:function(t){return t.x=this.x/this.w,t.y=this.y/this.w,t.z=this.z/this.w,t},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this.w=1/this.w,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},normalize:function(){const t=Math.hypot(this.x,this.y,this.z,this.w);return t&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},norm:function(){const{x:t,y:e,z:n,w:i}=this;return t*t+e*e+n*n+i*i},magnitude:function(){return Math.hypot(this.x,this.y,this.z,this.w)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},lerp:function(t,e){const{x:n,y:i,z:o,w:r}=this;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=o+e*(t.z-o),this.w=r+e*(t.w-r),this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},min:function(t){let{x:e,y:n,z:i,w:o}=this;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y),i=Math.min(i,t.z),o=Math.min(o,t.w);return this.x=e,this.y=n,this.z=i,this.w=o,this},max:function(t){let{x:e,y:n,z:i,w:o}=this;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y),i=Math.max(i,t.z),o=Math.max(o,t.w);return this.x=e,this.y=n,this.z=i,this.w=o,this},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}},Object.defineProperties(Ue.prototype,{length:{value:4},0:{get:function(){return this.x},set:function(t){this.x=t}},1:{get:function(){return this.y},set:function(t){this.y=t}},2:{get:function(){return this.z},set:function(t){this.z=t}},3:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Ue,{Zero:new Ue(0,0,0,0),One:new Ue(1,1,1,1),xAxis:new Ue(1,0,0,0),yAxis:new Ue(0,1,0,0),zAxis:new Ue(0,0,1,0),wAxis:new Ue(0,0,0,1)});const ke=Ue;n.set("standard/Math/Numbers/Vector4",ke);const ze=ke;function je(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i}je.prototype={constructor:je,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z,yield this.w},copy:function(){const t=Object.create(je.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},setMatrix:function(t){if(t[0]>t[4])var e=t[0]>t[8]?0:2;else e=t[4]>t[8]?1:2;const n=t[0]+t[4]+t[8];if(n>t[3*e+e]){this[3]=Math.sqrt(n+1)/2;const e=4*this[3];this[0]=(t[5]-t[7])/e,this[1]=(t[6]-t[2])/e,this[2]=(t[1]-t[3])/e}else{const n=(e+1)%3,i=(e+2)%3;this[e]=Math.sqrt(t[3*e+e]-t[3*n+n]-t[3*i+i]+1)/2;const o=4*this[e];this[n]=(t[3*e+n]+t[3*n+e])/o,this[i]=(t[3*e+i]+t[3*i+e])/o,this[3]=(t[3*n+i]-t[3*i+n])/o}return this},getMatrix:function(t=new Re){const{x:e,y:n,z:i,w:o}=this,r=e*e,s=e*n,a=n*n,u=n*i,c=i*e,l=i*i,h=o*e,d=o*n,p=o*i;return t[0]=1-2*(a+l),t[1]=2*(s+p),t[2]=2*(c-d),t[3]=2*(s-p),t[4]=1-2*(l+r),t[5]=2*(u+h),t[6]=2*(c+d),t[7]=2*(u-h),t[8]=1-2*(a+r),t},isReal:function(){return!(this.x||this.y||this.z)},isImag:function(){return!this.w},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},multLeft:function(t){const{x:e,y:n,z:i,w:o}=this,{x:r,y:s,z:a,w:u}=t;return this.x=o*r+e*u+n*a-i*s,this.y=o*s+n*u+i*r-e*a,this.z=o*a+i*u+e*s-n*r,this.w=o*u-e*r-n*s-i*a,this},multRight:function(t){const{x:e,y:n,z:i,w:o}=this,{x:r,y:s,z:a,w:u}=t;return this.x=u*e+r*o+s*i-a*n,this.y=u*n+s*o+a*e-r*i,this.z=u*i+a*o+r*n-s*e,this.w=u*o-r*e-s*n-a*i,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},multVecQuat:function(t){const{x:e,y:n,z:i,w:o}=this,{x:r,y:s,z:a}=t,u=o*o-e*e-n*n-i*i,c=2*(r*e+s*n+a*i),l=2*o;return t.x=u*r+c*e+l*(n*a-i*s),t.y=u*s+c*n+l*(i*r-e*a),t.z=u*a+c*i+l*(e*s-n*r),t},multQuatVec:function(t){const{x:e,y:n,z:i,w:o}=this,{x:r,y:s,z:a}=t,u=o*o-e*e-n*n-i*i,c=2*(r*e+s*n+a*i),l=2*o;return t.x=u*r+c*e-l*(n*a-i*s),t.y=u*s+c*n-l*(i*r-e*a),t.z=u*a+c*i-l*(e*s-n*r),t},normalize:function(){const t=Math.hypot(this.x,this.y,this.z,this.w);return t&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},norm:function(){const{x:t,y:e,z:n,w:i}=this;return t*t+e*e+n*n+i*i},magnitude:function(){return Math.hypot(this.x,this.y,this.z,this.w)},pow:function(t){if(t instanceof je)return this.assign(e.assign(t).multRight(this.log()).exp());if(this.isReal())return this.set(0,0,0,Math.pow(this.w,t));const n=this.magnitude(),i=Math.acos(this.w/n),o=this.imag.magnitude(),r=Math.pow(n,t),s=t*i,a=r/o*Math.sin(s);return this.x*=a,this.y*=a,this.z*=a,this.w=r*Math.cos(s),this},log:function(){if(this.isReal())return this.w>0?this.set(0,0,0,Math.log(this.w)):this.set(Math.PI,0,0,Math.log(-this.w));const t=this.magnitude(),e=this.imag.normalize().multiply(Math.acos(this.w/t)),n=Math.log(t);return this.x=e.x,this.y=e.y,this.z=e.z,this.w=n,this},exp:function(){if(this.isReal())return this.set(0,0,0,Math.exp(this.w));const t=this.imag,e=t.magnitude(),n=Math.exp(this.w),i=n*Math.cos(e),o=t.multiply(n*Math.sin(e)/e);return this.x=o.x,this.y=o.y,this.z=o.z,this.w=i,this},slerp:function(t,e){return d.slerp(this,Ge.assign(t),e)},squad:function(t,e,n,i){return d.slerp(d.slerp(this,Ge.assign(n),i),d.slerp(He.assign(t),qe.assign(e),i),2*i*(1-i))},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}},Object.defineProperties(je.prototype,{length:{value:4},0:{get:function(){return this.x},set:function(t){this.x=t}},1:{get:function(){return this.y},set:function(t){this.y=t}},2:{get:function(){return this.z},set:function(t){this.z=t}},3:{get:function(){return this.w},set:function(t){this.w=t}},real:{get:function(){return this.w}},imag:{get:function(){const t=new Se(0,0,0);return function(){return t.set(this.x,this.y,this.z)}}()}}),Object.assign(je,{Identity:new je(0,0,0,1),spline:function(){const t=new je(0,0,0,1),e=new je(0,0,0,1),n=new je(0,0,0,1),i=new je(0,0,0,1);return function(o,r,s){return t.assign(o),e.assign(r),n.assign(s),t.dot(e)<0&&t.negate(),n.dot(e)<0&&n.negate(),i.assign(e).inverse(),e.multRight(Ge.assign(i).multRight(t).log().add(He.assign(i).multRight(n).log()).divide(-4).exp()).normalize().copy()}}()});const Ge=new je(0,0,0,1),He=new je(0,0,0,1),qe=new je(0,0,0,1),Ye=je;n.set("standard/Math/Numbers/Quaternion",Ye);const We=Ye,Ke=Symbol(),Je=Symbol(),Ze=Symbol(),Qe=Symbol(),$e=Symbol();function tn(t,e,n,i){switch(this[Ke]=0,this[Je]=0,this[Ze]=1,this[Qe]=0,arguments.length){case 0:return void(this[$e]=new We(0,0,0,1));case 1:return this[$e]=arguments[0],void this.update();case 2:{const t=arguments[0],e=arguments[1];return this[$e]=new We(0,0,0,1),e instanceof Se?this.setFromToVec(t,e):void this.set(t.x,t.y,t.z,e)}case 4:return this[$e]=new We(0,0,0,1),void this.set(t,e,n,i)}}tn.prototype={constructor:tn,[Symbol.iterator]:function*(){yield this[Ke],yield this[Je],yield this[Ze],yield this[Qe]},update:function(){const t=this.get();return this[Ke]=t.x,this[Je]=t.y,this[Ze]=t.z,this[Qe]=t.w,this},copy:function(){const t=Object.create(tn.prototype);return t[Ke]=this[Ke],t[Je]=this[Je],t[Ze]=this[Ze],t[Qe]=this[Qe],t[$e]=this[$e].copy(),t},assign:function(t){return this[Ke]=t[Ke],this[Je]=t[Je],this[Ze]=t[Ze],this[Qe]=t[Qe],this[$e].assign(t[$e]),this},set:function(t,e,n,i){this[Ke]=t,this[Je]=e,this[Ze]=n,this[Qe]=i;const o=Math.hypot(t,e,n);if(0===o)return this[$e].set(0,0,0,1),this;const r=d.interval(i/2,0,Math.PI),s=Math.sin(r)/o;return this[$e].set(t*s,e*s,n*s,Math.cos(r)),this},get:function(){const t=new ze(0,0,0,0);return function(){const e=this[$e];if(Math.abs(e.w)>1)return ze.zAxis;{const n=2*Math.acos(e.w),i=Math.sin(n/2);if(0===i)return ze.zAxis;{const o=e.imag.divide(i);return t.set(o.x,o.y,o.z,n)}}}}(),setAxisAngle:function(t,e){return this.set(t.x,t.y,t.z,e)},setFromToVec:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new Se(0,0,0);return function(o,r){t.assign(o).normalize(),e.assign(r).normalize();const s=d.clamp(t.dot(e),-1,1),a=n.assign(t).cross(e).normalize();return 0===a.magnitude()?s>0?this[$e].set(0,0,0,1):(i.assign(t).cross(Se.xAxis),0===i.norm()&&i.assign(t).cross(Se.yAxis),i.normalize(),this[$e].set(i.x,i.y,i.z,0)):(a.multiply(Math.sqrt(Math.abs(1-s)/2)),this[$e].set(a.x,a.y,a.z,Math.sqrt(Math.abs(1+s)/2))),this.update(),this}}(),setAxis:function(t){this.set(t.x,t.y,t.z,this[Qe])},getAxis:function(t=new Se(0,0,0)){return t.set(this[Ke],this[Je],this[Ze])},setQuaternion:function(t){return this[$e].assign(t).normalize(),this.update(),this},getQuaternion:function(t=new We(0,0,0,1)){return t.assign(this[$e])},setMatrix:function(t){return this[$e].setMatrix(t).normalize(),this.update(),this},getMatrix:function(t=new Re){return this[$e].getMatrix(t)},equals:function(t){return this[$e].equals(t[$e])},inverse:function(){return this[$e].inverse(),this.update(),this},multLeft:function(t){return this[$e].multLeft(t[$e]).normalize(),this.update(),this},multRight:function(t){return this[$e].multRight(t[$e]).normalize(),this.update(),this},multVecRot:function(t){return this[$e].multVecQuat(t)},multRotVec:function(t){return this[$e].multQuatVec(t)},normalize:function(){return this[$e].normalize(),this.update(),this},pow:function(t){return this[$e].pow(t),this.update(),this},slerp:function(t,e){return this[$e].slerp(t[$e],e),this.update(),this},squad:function(t,e,n,i){return this[$e].squad(t[$e],e[$e],n[$e],i),this.update(),this},toString:function(){return this[Ke]+" "+this[Je]+" "+this[Ze]+" "+this[Qe]}};const en={get:function(){return this[Ke]},set:function(t){this[Ke]=t,this.set(t,this[Je],this[Ze],this[Qe])},enumerable:!0},nn={get:function(){return this[Je]},set:function(t){this[Je]=t,this.set(this[Ke],t,this[Ze],this[Qe])},enumerable:!0},on={get:function(){return this[Ze]},set:function(t){this[Ze]=t,this.set(this[Ke],this[Je],t,this[Qe])},enumerable:!0},rn={get:function(){return this[Qe]},set:function(t){this[Qe]=t,this.set(this[Ke],this[Je],this[Ze],t)},enumerable:!0};Object.defineProperties(tn.prototype,{length:{value:4},x:en,y:nn,z:on,angle:rn}),en.enumerable=!1,nn.enumerable=!1,on.enumerable=!1,rn.enumerable=!1,Object.defineProperties(tn.prototype,{0:en,1:nn,2:on,3:rn}),Object.assign(tn,{Identity:new tn,spline:function(t,e,n){const i=Object.create(this.prototype);return i[$e]=We.spline(t[$e],e[$e],n[$e]),i.update(),i}});const sn=tn;n.set("standard/Math/Numbers/Rotation4",sn);const an=sn;function un(){if(arguments.length)for(let t=0;t<16;++t)this[t]=arguments[t];else this.identity()}un.prototype={constructor:un,[Symbol.iterator]:function*(){for(let t=0;t<16;++t)yield this[t]},copy:function(){const t=Object.create(un.prototype);for(let e=0;e<16;++e)t[e]=this[e];return t},assign:function(t){for(let e=0;e<16;++e)this[e]=t[e];return this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]&&this[4]===t[4]&&this[5]===t[5]&&this[6]===t[6]&&this[7]===t[7]&&this[8]===t[8]&&this[9]===t[9]&&this[10]===t[10]&&this[11]===t[11]&&this[12]===t[12]&&this[13]===t[13]&&this[14]===t[14]&&this[15]===t[15]},set1:function(t,e,n){return this[t*this.order+e]=n,this},get1:function(t,e){return this[t*this.order+e]},set:function(){const t=new an,e=new Se(0,0,0);return function(n,i,o,r,s){switch(arguments.length){case 0:this.identity();break;case 1:null===n&&(n=Se.Zero),this.identity(),this.translate(n);break;case 2:null===n&&(n=Se.Zero),null===i&&(i=an.Identity),this.identity(),this.translate(n),i.equals(an.Identity)||this.rotate(i);break;case 3:null===n&&(n=Se.Zero),null===i&&(i=an.Identity),null===o&&(o=Se.One),this.identity(),this.translate(n),i.equals(an.Identity)||this.rotate(i),o.equals(Se.One)||this.scale(o);break;case 4:if(null===n&&(n=Se.Zero),null===i&&(i=an.Identity),null===o&&(o=Se.One),null===r&&(r=an.Identity),this.identity(),this.translate(n),i.equals(an.Identity)||this.rotate(i),!o.equals(Se.One)){!r.equals(an.Identity)?(this.rotate(r),this.scale(o),this.rotate(t.assign(r).inverse())):this.scale(o)}break;case 5:{null===n&&(n=Se.Zero),null===i&&(i=an.Identity),null===o&&(o=Se.One),null===r&&(r=an.Identity),null===s&&(s=Se.Zero),this.identity(),this.translate(n);const a=!s.equals(Se.Zero);a&&this.translate(s),i.equals(an.Identity)||this.rotate(i),o.equals(Se.One)||(r.equals(an.Identity)?this.scale(o):(this.rotate(r),this.scale(o),this.rotate(t.assign(r).inverse()))),a&&this.translate(e.assign(s).negate());break}case 16:for(let t=0;t<16;++t)this[t]=arguments[t]}return this}}(),get:function(){const t=new Se(0,0,0),e=new an,n=new Se(0,0,0),i=new an,o=new Se(0,0,0),r=new Re,s=new Re,a=new Se(0,0,0);return function(u,c,l,h,d){switch(null===u&&(u=t),null===c&&(c=e),null===l&&(l=n),null===h&&(h=i),null===d&&(d=o),arguments.length){case 1:u.set(this[12],this[13],this[14]);break;case 2:this.factor(u,r,n,s),c.setMatrix(r);break;case 3:this.factor(u,r,l,s),c.setMatrix(r);break;case 4:this.factor(u,r,l,s),c.setMatrix(r),h.setMatrix(s);break;case 5:ln.set(a.assign(d).negate()),ln.multLeft(this),ln.translate(d),ln.get(u,c,l,h)}}}(),setRotation:function(t){return this.setQuaternion(t.getQuaternion(cn))},setQuaternion:function(t){const{x:e,y:n,z:i,w:o}=t,r=n*n,s=i*i,a=e*n,u=i*o,c=i*e,l=n*o,h=e*e,d=n*i,p=e*o;return this[0]=1-2*(r+s),this[1]=2*(a+u),this[2]=2*(c-l),this[3]=0,this[4]=2*(a-u),this[5]=1-2*(s+h),this[6]=2*(d+p),this[7]=0,this[8]=2*(c+l),this[9]=2*(d-p),this[10]=1-2*(r+h),this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},factor:function(){const t=new Re,e=new Re,n=new Re,i={values:[],vectors:[[],[],[]]};return function(o,r,s,a){o.set(this[12],this[13],this[14]);const u=this.submatrix,c=u.determinant()<0?-1:1;n.assign(u).transpose().multLeft(u);const l=Fe(n,i);a.set(l.vectors[0][0],l.vectors[1][0],l.vectors[2][0],l.vectors[0][1],l.vectors[1][1],l.vectors[2][1],l.vectors[0][2],l.vectors[1][2],l.vectors[2][2]),s.x=c*Math.sqrt(l.values[0]),s.y=c*Math.sqrt(l.values[1]),s.z=c*Math.sqrt(l.values[2]),t[0]=1/s.x,t[4]=1/s.y,t[8]=1/s.z,r.assign(e.assign(a).transpose().multRight(t).multRight(a).multRight(u))}}(),determinant3:function(){const t=this[0],e=this[1],n=this[2],i=this[4],o=this[5],r=this[6],s=this[8],a=this[9],u=this[10];return t*(o*u-r*a)-e*(i*u-r*s)+n*(i*a-o*s)},determinant:function(){const{0:t,1:e,2:n,3:i,4:o,5:r,6:s,7:a,8:u,9:c,10:l,11:h,12:d,13:p,14:f,15:g}=this,m=l*g,_=f*h,x=s*g,y=f*a,w=s*h,S=l*a,T=n*g,b=f*i,v=n*h,E=l*i,C=n*a,O=s*i;return t*(m*r+y*c+w*p-_*r-x*c-S*p)+o*(_*e+T*c+E*p-m*e-b*c-v*p)+u*(x*e+b*r+C*p-y*e-T*r-O*p)+d*(S*e+v*r+O*c-w*e-E*r-C*c)},transpose:function(){let t;return t=this[1],this[1]=this[4],this[4]=t,t=this[2],this[2]=this[8],this[8]=t,t=this[3],this[3]=this[12],this[12]=t,t=this[6],this[6]=this[9],this[9]=t,t=this[7],this[7]=this[13],this[13]=t,t=this[11],this[11]=this[14],this[14]=t,this},inverse:function(){const{0:t,1:e,2:n,3:i,4:o,5:r,6:s,7:a,8:u,9:c,10:l,11:h,12:d,13:p,14:f,15:g}=this,m=l*g,_=f*h,x=s*g,y=f*a,w=s*h,S=l*a,T=n*g,b=f*i,v=n*h,E=l*i,C=n*a,O=s*i,N=u*p,F=d*c,I=o*p,M=d*r,D=o*c,R=u*r,V=t*p,A=d*e,P=t*c,L=u*e,B=t*r,X=o*e,U=m*r+y*c+w*p-(_*r+x*c+S*p),k=_*e+T*c+E*p-(m*e+b*c+v*p),z=x*e+b*r+C*p-(y*e+T*r+O*p),j=S*e+v*r+O*c-(w*e+E*r+C*c);let G=t*U+o*k+u*z+d*j;return G=1/G,this[0]=G*U,this[1]=G*k,this[2]=G*z,this[3]=G*j,this[4]=G*(_*o+x*u+S*d-m*o-y*u-w*d),this[5]=G*(m*t+b*u+v*d-_*t-T*u-E*d),this[6]=G*(y*t+T*o+O*d-x*t-b*o-C*d),this[7]=G*(w*t+E*o+C*u-S*t-v*o-O*u),this[8]=G*(N*a+M*h+D*g-F*a-I*h-R*g),this[9]=G*(F*i+V*h+L*g-N*i-A*h-P*g),this[10]=G*(I*i+A*a+B*g-M*i-V*a-X*g),this[11]=G*(R*i+P*a+X*h-D*i-L*a-B*h),this[12]=G*(I*l+R*f+F*s-D*f-N*s-M*l),this[13]=G*(P*f+N*n+A*l-V*l-L*f-F*n),this[14]=G*(V*s+X*f+M*n-B*f-I*n-A*s),this[15]=G*(B*l+D*n+L*s-P*s-X*l-R*n),this},multLeft:function(t){const{0:e,1:n,2:i,3:o,4:r,5:s,6:a,7:u,8:c,9:l,10:h,11:d,12:p,13:f,14:g,15:m}=this,{0:_,1:x,2:y,3:w,4:S,5:T,6:b,7:v,8:E,9:C,10:O,11:N,12:F,13:I,14:M,15:D}=t;return this[0]=e*_+r*x+c*y+p*w,this[1]=n*_+s*x+l*y+f*w,this[2]=i*_+a*x+h*y+g*w,this[3]=o*_+u*x+d*y+m*w,this[4]=e*S+r*T+c*b+p*v,this[5]=n*S+s*T+l*b+f*v,this[6]=i*S+a*T+h*b+g*v,this[7]=o*S+u*T+d*b+m*v,this[8]=e*E+r*C+c*O+p*N,this[9]=n*E+s*C+l*O+f*N,this[10]=i*E+a*C+h*O+g*N,this[11]=o*E+u*C+d*O+m*N,this[12]=e*F+r*I+c*M+p*D,this[13]=n*F+s*I+l*M+f*D,this[14]=i*F+a*I+h*M+g*D,this[15]=o*F+u*I+d*M+m*D,this},multRight:function(t){const{0:e,1:n,2:i,3:o,4:r,5:s,6:a,7:u,8:c,9:l,10:h,11:d,12:p,13:f,14:g,15:m}=this,{0:_,1:x,2:y,3:w,4:S,5:T,6:b,7:v,8:E,9:C,10:O,11:N,12:F,13:I,14:M,15:D}=t;return this[0]=e*_+n*S+i*E+o*F,this[1]=e*x+n*T+i*C+o*I,this[2]=e*y+n*b+i*O+o*M,this[3]=e*w+n*v+i*N+o*D,this[4]=r*_+s*S+a*E+u*F,this[5]=r*x+s*T+a*C+u*I,this[6]=r*y+s*b+a*O+u*M,this[7]=r*w+s*v+a*N+u*D,this[8]=c*_+l*S+h*E+d*F,this[9]=c*x+l*T+h*C+d*I,this[10]=c*y+l*b+h*O+d*M,this[11]=c*w+l*v+h*N+d*D,this[12]=p*_+f*S+g*E+m*F,this[13]=p*x+f*T+g*C+m*I,this[14]=p*y+f*b+g*O+m*M,this[15]=p*w+f*v+g*N+m*D,this},multVecMatrix:function(t){if(3===t.length){const{x:e,y:n,z:i}=t,o=1/(e*this[3]+n*this[7]+i*this[11]+this[15]);return t.x=(e*this[0]+n*this[4]+i*this[8]+this[12])*o,t.y=(e*this[1]+n*this[5]+i*this[9]+this[13])*o,t.z=(e*this[2]+n*this[6]+i*this[10]+this[14])*o,t}{const{x:e,y:n,z:i,w:o}=t;return t.x=e*this[0]+n*this[4]+i*this[8]+o*this[12],t.y=e*this[1]+n*this[5]+i*this[9]+o*this[13],t.z=e*this[2]+n*this[6]+i*this[10]+o*this[14],t.w=e*this[3]+n*this[7]+i*this[11]+o*this[15],t}},multMatrixVec:function(t){if(3===t.length){const{x:e,y:n,z:i}=t,o=1/(e*this[12]+n*this[13]+i*this[14]+this[15]);return t.x=(e*this[0]+n*this[1]+i*this[2]+this[3])*o,t.y=(e*this[4]+n*this[5]+i*this[6]+this[7])*o,t.z=(e*this[8]+n*this[9]+i*this[10]+this[11])*o,t}{const{x:e,y:n,z:i,w:o}=t;return t.x=e*this[0]+n*this[1]+i*this[2]+o*this[3],t.y=e*this[4]+n*this[5]+i*this[6]+o*this[7],t.z=e*this[8]+n*this[9]+i*this[10]+o*this[11],t.w=e*this[12]+n*this[13]+i*this[14]+o*this[15],t}},multDirMatrix:function(t){const{x:e,y:n,z:i}=t;return t.x=e*this[0]+n*this[4]+i*this[8],t.y=e*this[1]+n*this[5]+i*this[9],t.z=e*this[2]+n*this[6]+i*this[10],t},multMatrixDir:function(t){const{x:e,y:n,z:i}=t;return t.x=e*this[0]+n*this[1]+i*this[2],t.y=e*this[4]+n*this[5]+i*this[6],t.z=e*this[8]+n*this[9]+i*this[10],t},identity:function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},translate:function(t){const{x:e,y:n,z:i}=t;return this[12]+=this[0]*e+this[4]*n+this[8]*i,this[13]+=this[1]*e+this[5]*n+this[9]*i,this[14]+=this[2]*e+this[6]*n+this[10]*i,this},rotate:function(t){return this.multLeft(ln.setQuaternion(t.getQuaternion(cn)))},scale:function(t){const{x:e,y:n,z:i}=t;return this[0]*=e,this[4]*=n,this[8]*=i,this[1]*=e,this[5]*=n,this[9]*=i,this[2]*=e,this[6]*=n,this[10]*=i,this},toString:function(){return Array.prototype.join.call(this," ")}},Object.defineProperties(un.prototype,{order:{value:4},length:{value:16},x:{get:function(){const t=new ze(0,0,0,0);return function(){return t.set(this[0],this[1],this[2],this[3])}}()},y:{get:function(){const t=new ze(0,0,0,0);return function(){return t.set(this[4],this[5],this[6],this[7])}}()},z:{get:function(){const t=new ze(0,0,0,0);return function(){return t.set(this[8],this[9],this[10],this[11])}}()},w:{get:function(){const t=new ze(0,0,0,0);return function(){return t.set(this[12],this[13],this[14],this[15])}}()},xAxis:{get:function(){const t=new Se(0,0,0);return function(){return t.set(this[0],this[1],this[2])}}()},yAxis:{get:function(){const t=new Se(0,0,0);return function(){return t.set(this[4],this[5],this[6])}}()},zAxis:{get:function(){const t=new Se(0,0,0);return function(){return t.set(this[8],this[9],this[10])}}()},origin:{get:function(){const t=new Se(0,0,0);return function(){return t.set(this[12],this[13],this[14])}}()},submatrix:{get:function(){const t=new Re;return function(){return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[4],t[4]=this[5],t[5]=this[6],t[6]=this[8],t[7]=this[9],t[8]=this[10],t}}()}}),Object.assign(un,{Identity:new un,Rotation:function(t){return Object.create(this.prototype).setQuaternion(t.getQuaternion(cn))},Quaternion:function(t){return Object.create(this.prototype).setQuaternion(t)},Matrix3:function(t){return new un(t[0],t[1],0,0,t[3],t[4],0,0,0,0,1,0,t[6],t[7],0,1)},SubMatrix:function(t){return new un(t[0],t[1],t[2],0,t[3],t[4],t[5],0,t[6],t[7],t[8],0,0,0,0,1)}});const cn=new We,ln=new un,hn=un;n.set("standard/Math/Numbers/Matrix4",hn);const dn=hn;function pn(t,e,n,i){function o(t,e,n,i,o,r,s,a,u,c,l,h,d,p,f,g){switch(arguments.length){case 0:return lt.call(this,new dn);case 1:return lt.call(this,arguments[0]);case 4:{const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return lt.call(this,new dn(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,n.x,n.y,n.z,n.w,i.x,i.y,i.z,i.w))}case 16:return lt.call(this,new dn(+t,+e,+n,+i,+o,+r,+s,+a,+u,+c,+l,+h,+d,+p,+f,+g))}throw new Error("Invalid arguments.")}o.prototype=le(o,t,e,dn,n,i);for(const t of Reflect.ownKeys(o.prototype))Object.defineProperty(o.prototype,t,{enumerable:!1});function r(t){Object.defineProperty(o.prototype,t,{get:function(){return this.getValue()[t]},set:function(e){this.getValue()[t]=e,this.addEvent()},enumerable:!0})}for(let t=0,e=dn.prototype.length;t<e;++t)r(t);return o}const fn={SFMatrix4d:pn("SFMatrix4d",c.SFMatrix4d,Xe.SFVec3d,!0),SFMatrix4f:pn("SFMatrix4f",c.SFMatrix4f,Xe.SFVec3f,!1),VrmlMatrix:pn("VrmlMatrix",c.VrmlMatrix,Xe.SFVec3f,!1)};n.set("x_ite/Fields/SFMatrix4",fn);const gn=fn,mn=new WeakMap;const _n=Symbol.for("X_ITE.SFNode.target");function xn(){const t=this[_n],e=t.getValue();lt.prototype.dispose.call(t),e?.dispose(),mn.delete(e)}const yn=class{static get(t){const e=mn.get(t);if(e)return e;{const e=new On(t);return e.dispose=xn,mn.set(t,e),e}}};n.set("x_ite/Fields/SFNodeCache",yn);const wn=yn,Sn=Symbol.for("X_ITE.SFNode.target"),Tn=Symbol(),bn=Symbol(),vn={get:function(t,e){try{const n=t[e];if(void 0!==n)return n;const i=t.getValue().getField(e);if(i.getAccessType()===c.inputOnly)return;return i.valueOf()}catch(t){return}},set:function(t,e,n){if(e in t)return t[e]=n,!0;try{const i=t.getValue().getField(e);return i.getAccessType()!==c.outputOnly&&i.setValue(n),!0}catch(n){return console.error(t,e,n),!1}},has:function(t,e){try{return!!t.getValue().getField(e)}catch(n){return e in t}},ownKeys:function(t){const e=t.getValue(),n=[];if(e)for(const t of e.getFieldDefinitions())n.push(t.name);return n},getOwnPropertyDescriptor:function(t,e){const n=t.getValue();if(n){const i=n.getFieldDefinitions().get(e);if(i)return{value:this.get(t,e),writable:i.accessType!==c.outputOnly,enumerable:!0,configurable:!0}}}};function En(t){const e=new Proxy(this,vn);return this[Sn]=this,this[Tn]=e,t?(t.addParent(e),lt.call(this,t)):lt.call(this,null),e}En.prototype=Object.assign(Object.create(lt.prototype),{constructor:En,[Sn]:null,[Tn]:null,[bn]:0,copy:function(t){const e=this[Sn].getValue();return e?new En(t?e.copy(t):e):new En},getTypeName:function(){return"SFNode"},getType:function(){return c.SFNode},equals:function(t){const e=this[Sn];return t?e.getValue()===t.getValue():null===e.getValue()},isDefaultValue:function(){return null===this[Sn].getValue()},set:function(t){const e=this[Sn],n=e.getValue();n&&(n.removeCloneCount(e[bn]),n.removeParent(e[Tn])),t?(t.addParent(e[Tn]),t.addCloneCount(e[bn]),lt.prototype.set.call(e,t)):lt.prototype.set.call(e,null)},getNodeTypeName:function(){const t=this[Sn].getValue();if(t)return t.getTypeName();throw new Error("SFNode.getNodeTypeName: node is null.")},getNodeName:function(){const t=this[Sn].getValue();if(t)return t.getName();throw new Error("SFNode.getNodeName: node is null.")},getNodeDisplayName:function(){const t=this[Sn].getValue();if(t)return t.getDisplayName();throw new Error("SFNode.getNodeDisplayName: node is null.")},getNodeType:function(){const t=this[Sn].getValue();if(t)return Array.from(t.getType());throw new Error("SFNode.getNodeType: node is null.")},getFieldDefinitions:function(){const t=this[Sn].getValue();if(t)return t.getFieldDefinitions();throw new Error("SFNode.getFieldDefinitions: node is null.")},addFieldCallback:function(t,e,n){const i=this[Sn];switch(arguments.length){case 2:return lt.prototype.addFieldCallback.apply(i,arguments);case 3:{const o=i.getValue();if(o)return o.getField(t).addFieldCallback(e,n);throw new Error("SFNode.addFieldCallback: node is null.")}}},removeFieldCallback:function(t,e){const n=this[Sn];switch(arguments.length){case 1:return lt.prototype.removeFieldCallback.apply(n,arguments);case 2:{const i=n.getValue();if(i)return i.getField(t).removeFieldCallback(e);throw new Error("SFNode.removeFieldCallback: node is null.")}}},addCloneCount:function(t){const e=this[Sn],n=e.getValue();e[bn]+=t,n?.addCloneCount(t)},removeCloneCount:function(t){const e=this[Sn],n=e.getValue();e[bn]-=t,n?.removeCloneCount(t)},getNodeUserData:function(t){return this[Sn].getValue().getUserData(t)},setNodeUserData:function(t,e){this[Sn].getValue().setUserData(t,e)},removeNodeUserData:function(t){this[Sn].getValue().removeUserData(t)},valueOf:function(){const t=this[Sn].getValue();return t?wn.get(t):null},toVRMLString:function(t=Object.prototype){const e=new g(t),n=this.getValue();return n&&e.PushExecutionContext(n.getExecutionContext()),this.toVRMLStream(e),e.string},toXMLString:function(t=Object.prototype){const e=new g(t),n=this.getValue();return n&&e.PushExecutionContext(n.getExecutionContext()),this.toXMLStream(e),e.string},toJSONString:function(t=Object.prototype){const e=new g(t),n=this.getValue();return n&&e.PushExecutionContext(n.getExecutionContext()),this.toJSONStream(e),e.string},toStream:function(t){const e=this[Sn].getValue();e?e.toStream(t):t.string+="NULL"},toVRMLStream:function(t){const e=this[Sn].getValue();e?e.toVRMLStream(t):t.string+="NULL"},toXMLStream:function(t){const e=this[Sn].getValue();e?e.toXMLStream(t):t.string+="\x3c!-- NULL --\x3e"},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){const e=this[Sn].getValue();e?e.toJSONStream(t):t.string+="null"},dispose:function(){const t=this[Sn];t.set(null),t.processInterests(),lt.prototype.dispose.call(t)}});for(const t of Reflect.ownKeys(En.prototype))Object.defineProperty(En.prototype,t,{enumerable:!1});const Cn=En;n.set("x_ite/Fields/SFNode",Cn);const On=Cn,Nn=Xe.SFVec3f,Fn=Pe.SFMatrix3f;function In(t,e,n,i){switch(arguments.length){case 0:return lt.call(this,new an);case 1:return arguments[0]instanceof Fn?lt.call(this,(new an).setMatrix(arguments[0].getValue())):lt.call(this,arguments[0]);case 2:return arguments[1]instanceof Nn?lt.call(this,new an(arguments[0].getValue(),arguments[1].getValue())):lt.call(this,new an(arguments[0].getValue(),+arguments[1]));case 4:return lt.call(this,new an(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}In.prototype=Object.assign(Object.create(lt.prototype),{constructor:In,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new In(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(an.Identity)},getTypeName:function(){return"SFRotation"},getType:function(){return c.SFRotation},set:function(t){this.getValue().assign(t)},setAxis:function(t){this.getValue().setAxis(t.getValue()),this.addEvent()},getAxis:function(){return new Nn(this.getValue().getAxis())},setMatrix:function(t){this.getValue().setMatrix(t.getValue()),this.addEvent()},getMatrix:function(){return new Fn(this.getValue().getMatrix())},inverse:function(){return new In(this.getValue().copy().inverse())},multiply:function(t){return new In(this.getValue().copy().multRight(t.getValue()))},multVec:function(t){return new Nn(this.getValue().multVecRot(t.getValue().copy()))},slerp:function(t,e){return new In(this.getValue().copy().slerp(t.getValue(),e))},toStream:function(t){const e=this.getValue();t.string+=t.DoubleFormat(e.x),t.string+=t.TidySpace(),t.string+=t.DoubleFormat(e.y),t.string+=t.TidySpace(),t.string+=t.DoubleFormat(e.z),t.string+=t.TidySpace(),t.string+=t.DoubleFormat(t.ToUnit("angle",e.angle))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.TidySpace(),this.toJSONStreamValue(t),t.string+=t.TidySpace(),t.string+="]"},toJSONStreamValue:function(t){const e=this.getValue();t.string+=t.JSONNumber(t.DoubleFormat(e.x)),t.string+=",",t.string+=t.TidySpace(),t.string+=t.JSONNumber(t.DoubleFormat(e.y)),t.string+=",",t.string+=t.TidySpace(),t.string+=t.JSONNumber(t.DoubleFormat(e.z)),t.string+=",",t.string+=t.TidySpace(),t.string+=t.JSONNumber(t.DoubleFormat(t.ToUnit("angle",e.angle)))}});for(const t of Reflect.ownKeys(In.prototype))Object.defineProperty(In.prototype,t,{enumerable:!1});const Mn={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()}},Dn={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()}},Rn={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()}},Vn={get:function(){return this.getValue().angle},set:function(t){this.getValue().angle=+t,this.addEvent()}};Object.defineProperties(In.prototype,{0:Mn,1:Dn,2:Rn,3:Vn,x:Object.assign({enumerable:!0},Mn),y:Object.assign({enumerable:!0},Dn),z:Object.assign({enumerable:!0},Rn),angle:Object.assign({enumerable:!0},Vn)});const An=In;n.set("x_ite/Fields/SFRotation",An);const Pn=An;function Ln(t){return lt.call(this,arguments.length?""+t:"")}Object.assign(Ln,{unescape:function(t){return t.replace(/\\([\\"])/g,"$1")},escape:function(t){return t.replace(/([\\"])/g,"\\$1")}}),Ln.prototype=Object.assign(Object.create(lt.prototype),{constructor:Ln,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Ln(this.getValue())},getTypeName:function(){return"SFString"},getType:function(){return c.SFString},isDefaultValue:function(){return""===this.getValue()},set:function(t){lt.prototype.set.call(this,""+t)},valueOf:lt.prototype.getValue,toStream:function(t){t.string+='"',t.string+=Ln.escape(this.getValue()),t.string+='"'},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t,e){t.string+=e?t.XMLEncodeSourceText(this.getValue()):t.XMLEncode(this.getValue())},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){t.string+='"',t.string+=t.JSONEncode(this.getValue()),t.string+='"'}});for(const t of Reflect.ownKeys(Ln.prototype))Object.defineProperty(Ln.prototype,t,{enumerable:!1});Object.defineProperty(Ln.prototype,"length",{get:function(){return this.getValue().length}});const Bn=Ln;n.set("x_ite/Fields/SFString",Bn);const Xn=Bn;function Un(t){return lt.call(this,arguments.length?+t:0)}Un.prototype=Object.assign(Object.create(lt.prototype),{constructor:Un,copy:function(){return new Un(this.getValue())},getTypeName:function(){return"SFTime"},getType:function(){return c.SFTime},isDefaultValue:function(){return 0===this.getValue()},set:function(t){lt.prototype.set.call(this,+t)},valueOf:lt.prototype.getValue,toStream:function(t){t.string+=this.getValue()},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){t.string+=t.JSONNumber(t.DoubleFormat(this.getValue()))}});for(const t of Reflect.ownKeys(Un.prototype))Object.defineProperty(Un.prototype,t,{enumerable:!1});const kn=Un;n.set("x_ite/Fields/SFTime",kn);const zn=kn;function jn(t,e,n){function i(t,e,n,i){switch(arguments.length){case 0:return lt.call(this,new ze(0,0,0,0));case 1:return lt.call(this,arguments[0]);case 4:return lt.call(this,new ze(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}i.prototype=de(i,t,e,ze,n);for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()}},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()}},s={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()}},a={get:function(){return this.getValue().w},set:function(t){this.getValue().w=+t,this.addEvent()}};return Object.defineProperties(i.prototype,{0:o,1:r,2:s,3:a,x:Object.assign({enumerable:!0},o),y:Object.assign({enumerable:!0},r),z:Object.assign({enumerable:!0},s),w:Object.assign({enumerable:!0},a)}),i}const Gn={SFVec4d:jn("SFVec4d",c.SFVec4d,!0),SFVec4f:jn("SFVec4f",c.SFVec4f,!1)};n.set("x_ite/Fields/SFVec4",Gn);const Hn=Gn;function qn(t){lt.call(this,t)}qn.prototype=Object.assign(Object.create(lt.prototype),{constructor:qn,at:Array.prototype.at,entries:Array.prototype.entries,every:Array.prototype.every,fill:Array.prototype.fill,filter:function(t,e){return new this.constructor(...Array.prototype.filter.call(this,t,e))},find:Array.prototype.find,findIndex:Array.prototype.findIndex,findLast:Array.prototype.findLast,findLastIndex:Array.prototype.findLastIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:Array.prototype.keys,lastIndexOf:Array.prototype.lastIndexOf,map:function(t,e){return new this.constructor(...Array.prototype.map.call(this,t,e))},reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,reverse:Array.prototype.reverse,slice:function(t,e){return new this.constructor(...Array.prototype.slice.call(this,t,e))},some:Array.prototype.some,sort:Array.prototype.sort,toReversed:function(){return this.copy().reverse()},toSorted:function(t){return this.copy().sort(t)},toSpliced:function(t,e,...n){const i=this.copy();return i.splice(t,e,...n),i},values:Array.prototype.values,with:function(t,e){const n=this.copy();return n[t]=e,n}});for(const t of Reflect.ownKeys(qn.prototype))Object.defineProperty(qn.prototype,t,{enumerable:!1});const Yn=qn;n.set("x_ite/Base/X3DArrayField",Yn);const Wn=Yn,Kn=Symbol(),Jn=Symbol(),Zn={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=t.getValue(),i=+e;return Number.isInteger(i)?(i>=n.length&&t.resize(i+1),n[i].valueOf()):t[e]}},set:function(t,e,n){if(e in t)return t[e]=n,!0;const i=t.getValue(),o=+e;return o>=i.length&&t.resize(o+1),i[o].setValue(n),!0},has:function(t,e){return Number.isInteger(+e)?e<t.getValue().length:e in t},ownKeys:function(t){return Object.keys(t.getValue())},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;return Number.isInteger(n)&&n<t.getValue().length?Object.getOwnPropertyDescriptor(t.getValue(),e):void 0}};function Qn(t){Wn.call(this,[]);const e=new Proxy(this,Zn);return this[Kn]=this,this[Jn]=e,t[0]instanceof Array&&(t=t[0]),this.push(...t),e}Qn.prototype=Object.assign(Object.create(Wn.prototype),{constructor:Qn,[Kn]:null,[Jn]:null,[Symbol.iterator]:function*(){const t=this[Kn].getValue();for(const e of t)yield e.valueOf()},getTarget:function(){return this[Kn]},copy:function(){const t=this[Kn],e=t.create(),n=t.getValue();return e.push(...n),e.setModificationTime(0),e},equals:function(t){const e=this[Kn].getValue(),n=t.getValue(),i=e.length;if(e===n)return!0;if(i!==n.length)return!1;for(let t=0;t<i;++t)if(!e[t].equals(n[t]))return!1;return!0},isDefaultValue:function(){return 0===this.length},set:function(t){const e=this[Kn],n=e.getValue(),i=t.length;e.resize(i,void 0,!0);for(let e=0;e<i;++e)n[e].set(t[e]instanceof lt?t[e].getValue():t[e])},setValue:function(t){const e=this[Kn];e.set(t instanceof Qn?t.getValue():t),e.addEvent()},unshift:function(t){const e=this[Kn],n=e.getValue();for(let t=arguments.length-1;t>=0;--t){const i=new(e.getSingleType());i.setValue(arguments[t]),e.addChildObject(i),n.unshift(i)}return e.addEvent(),n.length},shift:function(){const t=this[Kn],e=t.getValue();if(e.length){const n=e.shift(),i=n.valueOf();return t.removeChildObject(n),t.addEvent(),i}},push:function(t){const e=this[Kn],n=e.getValue();for(const t of arguments){const i=new(e.getSingleType());i.setValue(t),e.addChildObject(i),n.push(i)}return e.addEvent(),n.length},pop:function(){const t=this[Kn],e=t.getValue();if(e.length){const n=e.pop(),i=n.valueOf();return t.removeChildObject(n),t.addEvent(),i}},splice:function(t,e,...n){const i=this[Kn],o=i.getValue();t>o.length&&(t=o.length),t+e>o.length&&(e=o.length-t);const r=i.erase(t,t+e);return n.length&&i.insert(t,n,0,n.length),r},insert:function(t,e,n,i){const o=this[Kn],r=[];for(let t=n;t<i;++t){const n=new(o.getSingleType());n.setValue(e[t]),o.addChildObject(n),r.push(n)}o.getValue().splice(t,0,...r),o.addEvent()},remove:function(t,e,n){const i=this[Kn],o=i.getValue(),r="function"==typeof n?n:t=>t===n;if(-1!==(t=o.findIndex(((e,n)=>n>=t&&r(e.valueOf())))))for(let n=t;++n<e;){const e=o[n];if(!r(e.valueOf())){const i=o[t];o[t++]=e,o[n]=i}}else t=e;return t!==e&&i.addEvent(),t},erase:function(t,e){const n=this[Kn],i=n.getValue().splice(t,e-t),o=new n.constructor(i);for(const t of i)n.removeChildObject(t);return n.addEvent(),o},resize:function(t,e,n){const i=this[Kn],o=i.getValue(),r=o.length;if(t<r){for(let e=t;e<r;++e)i.removeChildObject(o[e]);o.length=t,n||i.addEvent()}else if(t>r){for(let n=r;n<t;++n){const t=new(i.getSingleType());void 0!==e&&t.setValue(e),i.addChildObject(t),o.push(t)}n||i.addEvent()}},addChildObject:function(t){t.addParent(this[Jn])},removeChildObject:function(t){t.removeParent(this[Jn]),t.dispose()},reverse:function(){const t=this[Kn];return t.getValue().reverse(),t.addEvent(),t[Jn]},sort:function(t){const e=this[Kn];return Array.prototype.sort.call(this,t),e.addEvent(),e[Jn]},toStream:function(t){const e=this[Kn],n=e.getValue();switch(n.length){case 0:t.string+="[",t.string+=t.TidySpace(),t.string+="]";break;case 1:t.PushUnitCategory(e.getUnit()),n[0].toStream(t),t.PopUnitCategory();break;default:t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.ListStart(),t.IncIndent();for(let e=0,i=n.length-1;e<i;++e)t.string+=t.ListIndent(),n[e].toStream(t),t.string+=t.Comma(),t.string+=t.ListBreak();t.string+=t.ListIndent(),n.at(-1).toStream(t),t.string+=t.ListEnd(),t.DecIndent(),t.string+=t.ListIndent(),t.string+="]",t.PopUnitCategory()}},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){const e=this[Kn];if(e.length){const n=e.getValue();t.PushUnitCategory(e.getUnit());for(let e=0,i=n.length-1;e<i;++e)n[e].toXMLStream(t),t.string+=t.Comma(),t.string+=t.TidySpace();n.at(-1).toXMLStream(t),t.PopUnitCategory()}},toJSONStream:function(t){const e=this[Kn],n=e.length;if(n){const i=this.getValue();t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.ListBreak(),t.string+=t.IncIndent();for(let e=0,o=n-1;e<o;++e)t.string+=t.ListIndent(),i[e].toJSONStreamValue(t),t.string+=",",t.string+=t.ListBreak();t.string+=t.ListIndent(),i.at(-1).toJSONStreamValue(t),t.string+=t.ListBreak(),t.string+=t.DecIndent(),t.string+=t.ListIndent(),t.string+="]",t.PopUnitCategory()}else t.string+="[",t.string+=t.TidySpace(),t.string+="]"}});for(const t of Reflect.ownKeys(Qn.prototype))Object.defineProperty(Qn.prototype,t,{enumerable:!1});Object.defineProperty(Qn.prototype,"length",{get:function(){return this[Kn].getValue().length},set:function(t){this[Kn].resize(t)}});const $n=Qn;n.set("x_ite/Base/X3DObjectArrayField",$n);const ti=$n,ei=Symbol(),ni=Symbol(),ii=Symbol(),oi=Symbol(),ri=Symbol(),si=Symbol(),ai=Symbol(),ui=Symbol(),ci={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=+e;if(Number.isInteger(n)){const e=t.getComponents(),i=t.getValueType();let o=t.getValue();return n>=t[ri]&&(o=t.resize(n+1)),1===e?i(o[n]):t[ii][n]??(t[ii][n]=hi(t,n,e,i))}return t[e]}},set:function(t,e,n){if(e in t)return t[e]=n,!0;const i=t.getComponents();let o=+e,r=t.getValue();if(o>=t[ri]&&(r=t.resize(o+1)),1===i){const e=t.getValueType();r[o]=e(n)}else{o*=i;for(let t=0;t<i;++t,++o)r[o]=n[t]}return t.addEvent(),!0},has:function(t,e){return Number.isInteger(+e)?e<t[ri]:e in t},ownKeys:function(t){const e=[];for(let n=0,i=t[ri];n<i;++n)e.push(String(n));return e},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;return Number.isInteger(n)&&n<t[ri]?Object.getOwnPropertyDescriptor(t.getValue(),e):void 0}};function li(t){Wn.call(this,new(this.getArrayType())(16));const e=new Proxy(this,ci);return this[ei]=this,this[ni]=e,this.getComponents()>1&&(this[ii]=[],this[oi]=[]),this.push(...t),e}li.prototype=Object.assign(Object.create(Wn.prototype),{constructor:li,[ei]:null,[oi]:null,[ri]:0,[Symbol.iterator]:function*(){const t=this[ei],e=t.getValue(),n=t.getComponents(),i=t.getValueType(),o=t[ri];if(1===n)for(let t=0;t<o;++t)yield i(e[t]);else{const e=t[ii];for(let r=0;r<o;++r)yield e[r]??(e[r]=hi(t,r,n,i))}},getTarget:function(){return this[ei]},copy:function(){const t=this[ei],e=t.getValue(),n=t.create(),i=new(t.getArrayType())(e);return n[ri]=t[ri],Wn.prototype.set.call(n,i),n.setModificationTime(0),n},equals:function(t){const e=this[ei],n=t[ei],i=e[ri];if(e===n)return!0;if(i!==n[ri])return!1;const o=e.getValue(),r=n.getValue();for(let t=0,n=i*e.getComponents();t<n;++t)if(o[t]!==r[t])return!1;return!0},assign:function(t){const e=this[ei];e.set(t.getValue(),t.length),e.addEvent()},set:function(t,e){const n=this[ei],i=n.getComponents(),o=n[ri];let r=n.getValue(),s=void 0!==e?e*i:t.length;const a=s%i;a&&(s-=a,console.warn("Array length must be multiple of components size, which is "+i+".")),s/=i,r.length<t.length?(r=n[ui](t.length),r.set(t),a&&r.fill(0,s*i,s*i+a)):(r.set(t),s<o&&r.fill(0,s*i,o*i)),n[ri]=s},isDefaultValue:function(){return 0===this[ri]},setValue:function(t){const e=this[ei];t instanceof e.constructor?e.assign(t):(e.set(t),e.addEvent())},unshift:function(t){const e=this[ei],n=e.getComponents(),i=e[ri],o=arguments.length,r=e[ui]((i+o)*n);if(r.copyWithin(o*n,0,i*n),1===n){const t=e.getValueType();for(let e=0;e<o;++e)r[e]=t(arguments[e])}else for(let t=0,e=0;e<o;++e){const i=arguments[e];for(let e=0;e<n;++e,++t)r[t]=i[e]}return e[ri]+=o,e.addEvent(),e[ri]},shift:function(){const t=this[ei],e=t[ri];if(e){const i=t.getValue(),o=t.getComponents(),r=t.getValueType(),s=e-1;if(1===o)var n=r(i[0]);else{const e=t[oi];for(let t=0;t<o;++t)e[t]=i[t];n=new r(...e)}return i.copyWithin(0,o,e*o),i.fill(0,o*s,e*o),t[ri]=s,t.addEvent(),n}},push:function(t){const e=this[ei],n=e.getComponents(),i=e[ri],o=arguments.length,r=e[ui]((i+o)*n);if(1===n){const t=e.getValueType();for(let e=0,n=i;e<o;++e,++n)r[n]=t(arguments[e])}else for(let t=i*n,e=0;e<o;++e){const i=arguments[e];for(let e=0;e<n;++e,++t)r[t]=i[e]}return e[ri]+=o,e.addEvent(),e[ri]},pop:function(){const t=this[ei],e=t[ri];if(e){const i=t.getValue(),o=t.getComponents(),r=t.getValueType(),s=e-1;if(1===o)var n=r(i[e-1]);else{const e=t[oi];for(let t=0,n=s*o;t<o;++t,++n)e[t]=i[n];n=new r(...e)}return i.fill(0,s*o,e*o),t[ri]=s,t.addEvent(),n}},splice:function(t,e,...n){const i=this[ei],o=i[ri];t>o&&(t=o),t+e>o&&(e=o-t);const r=i[ai](t,t+e);return n.length&&i[si](t,n),i.addEvent(),r},[si]:function(t,e){const n=this[ei],i=n.getComponents(),o=n[ri],r=e.length,s=n[ui]((o+r)*i);if(t*=i,s.copyWithin(t+r*i,t,o*i),1===i){const i=n.getValueType();for(let n=0,o=t;n<r;++n,++o)s[o]=i(e[n])}else for(let n=0,o=t;n<r;++n){const t=e[n];for(let e=0;e<i;++e,++o)s[o]=t[e]}n[ri]+=r},[ai]:function(t,e){const n=this[ei],i=n.getValue(),o=n.getComponents(),r=e-t,s=n[ri],a=s-r,u=n[ni].slice(t,e);return t*=o,e*=o,i.copyWithin(t,e,s*o),i.fill(0,a*o,s*o),n[ri]=a,o>1&&(n[ii].length=a),n.addEvent(),u},resize:function(t,e,n){const i=this[ei],o=i[ri],r=i.getComponents();let s=i.getValue();if(t<o)s.fill(0,t*r,o*r),r>1&&(i[ii].length=t),n||i.addEvent();else if(t>o){if(s=i[ui](t*r),void 0!==e)if(1===r)s.fill(e,o*r,t*r);else for(let n=o*r,i=t*r;n<i;)for(let t=0;t<r;++t,++n)s[n]=e[t];n||i.addEvent()}return i[ri]=t,s},[ui]:function(t){const e=this[ei],n=e.getValue();if(t<n.length)return n;const i=d.nextPowerOfTwo(t),o=new(e.getArrayType())(i);return o.set(n),Wn.prototype.set.call(e,o),o},shrinkToFit:function(){const t=this[ei],e=t.getValue(),n=t[ri]*t.getComponents();if(e.length==n)return e;const i=e.subarray(0,n);return Wn.prototype.set.call(t,i),i},reverse:function(){const t=this[ei],e=t.getValue(),n=t.getComponents(),i=t[ri]*n,o=Math.floor(t[ri]/2)*n;if(1===n)for(let t=0;t<o;++t){const n=i-t-1,o=e[t];e[t]=e[n],e[n]=o}else for(let t=0;t<o;t+=n)for(let o=0;o<n;++o){const r=t+o,s=i-t-1-(n-o-1),a=e[r];e[r]=e[s],e[s]=a}return t.addEvent(),t[ni]},sort:function(t){const e=this[ei],n=e.getValue(),i=e.getComponents(),o=e[ri];if(1===i){const i=e.getValueType(),r=t?(e,n)=>t(i(e),i(n)):d.cmp;e.set(n.subarray(0,o).sort(r))}else{const r=Array.prototype.map.call(e[ni],(t=>t.copy())).sort(t??((t,e)=>{for(let n=0;n<i;++n){if(t[n]<e[n])return-1;if(e[n]<t[n])return 1}return 0}));for(let t=0;t<o;++t){const e=r[t];for(let o=0,r=t*i;o<i;++o,++r)n[r]=e[o]}}return e.addEvent(),e[ni]},toStream:function(t){const e=this[ei],n=e.getValue(),i=e[ri],o=e.getComponents(),r=new(e.getSingleType());switch(i){case 0:t.string+="[",t.string+=t.TidySpace(),t.string+="]";break;case 1:if(t.PushUnitCategory(e.getUnit()),1===o)r.set(n[0]),r.toStream(t);else{for(let t=0,e=0;t<o;++t,++e)r[t]=n[e];r.toStream(t)}t.PopUnitCategory();break;default:if(t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.ListStart(),t.IncIndent(),1===o){for(let e=0,s=i-1;e<s;++e)t.string+=t.ListIndent(),r.set(n[e*o]),r.toStream(t),t.string+=t.Comma(),t.string+=t.ListBreak();t.string+=t.ListIndent(),r.set(n[(i-1)*o]),r.toStream(t)}else{for(let e=0,s=i-1;e<s;++e){t.string+=t.ListIndent();for(let t=0,i=e*o;t<o;++t,++i)r[t]=n[i];r.toStream(t),t.string+=t.Comma(),t.string+=t.ListBreak()}t.string+=t.ListIndent();for(let t=0,e=(i-1)*o;t<o;++t,++e)r[t]=n[e];r.toStream(t)}t.string+=t.ListEnd(),t.DecIndent(),t.string+=t.ListIndent(),t.string+="]",t.PopUnitCategory()}},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){const e=this[ei],n=e[ri];if(n){const i=e.getValue(),o=e.getComponents(),r=new(e.getSingleType());if(t.PushUnitCategory(e.getUnit()),1===o){for(let e=0,s=n-1;e<s;++e)r.set(i[e*o]),r.toXMLStream(t),t.string+=t.Comma(),t.string+=t.TidySpace();r.set(i[(n-1)*o]),r.toXMLStream(t)}else{for(let e=0,s=n-1;e<s;++e){for(let t=0,n=e*o;t<o;++t,++n)r[t]=i[n];r.toXMLStream(t),t.string+=t.Comma(),t.string+=t.TidySpace()}for(let t=0,e=(n-1)*o;t<o;++t,++e)r[t]=i[e];r.toXMLStream(t)}t.PopUnitCategory()}},toJSONStream:function(t){const e=this[ei],n=e.length;if(n){const i=e.getValue(),o=e.getComponents(),r=new(e.getSingleType());if(t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.ListBreak(),t.string+=t.IncIndent(),1===o){for(let e=0,s=n-1;e<s;++e)t.string+=t.ListIndent(),r.set(i[e*o]),r.toJSONStreamValue(t),t.string+=",",t.string+=t.ListBreak();t.string+=t.ListIndent(),r.set(i[(n-1)*o]),r.toJSONStreamValue(t)}else{for(let e=0,s=n-1;e<s;++e){t.string+=t.ListIndent();for(let t=0,n=e*o;t<o;++t,++n)r[t]=i[n];r.toJSONStreamValue(t),t.string+=",",t.string+=t.ListBreak()}t.string+=t.ListIndent();for(let t=0,e=(n-1)*o;t<o;++t,++e)r[t]=i[e];r.toJSONStreamValue(t)}t.string+=t.ListBreak(),t.string+=t.DecIndent(),t.string+=t.ListIndent(),t.string+="]",t.PopUnitCategory()}else t.string+="[",t.string+=t.TidySpace(),t.string+="]"},dispose:function(){Wn.prototype.dispose.call(this[ei])}});for(const t of Reflect.ownKeys(li.prototype))Object.defineProperty(li.prototype,t,{enumerable:!1});function hi(t,e,n,i){const o=new i,r=o.getValue(),s=e*n;return o.addEvent=pi.bind(t,s,n,r),o.getValue=di.bind(t,s,n,r),o}function di(t,e,n){const i=this.getValue();for(let o=0;o<e;++o,++t)n[o]=i[t];return n}function pi(t,e,n){const i=this.getValue();for(let o=0;o<e;++o,++t)i[t]=n[o];this.addEvent()}Object.defineProperty(li.prototype,"length",{get:function(){return this[ri]},set:function(t){this[ei].resize(t)}});const fi=li;n.set("x_ite/Base/X3DTypedArrayField",fi);const gi=fi,mi=Pe.SFMatrix3d,_i=Pe.SFMatrix3f,xi=gn.SFMatrix4d,yi=gn.SFMatrix4f,wi=xe.SFVec2d,Si=xe.SFVec2f,Ti=Xe.SFVec3d,bi=Xe.SFVec3f,vi=Hn.SFVec4d,Ei=Hn.SFVec4f,Ci=Symbol();function Oi(...t){return ti.call(this,t)}Oi.prototype=Object.assign(Object.create(ti.prototype),{constructor:Oi,[Ci]:0,getSingleType:function(){return On},getValueType:function(){return On},getArrayType:function(){return Array},getComponents:function(){return 1},getTypeName:function(){return"MFNode"},getType:function(){return c.MFNode},copy:function(t){if(t){const e=new Oi;for(const n of this.getValue())e.push(n.copy(t));return e.setModificationTime(0),e}return ti.prototype.copy.call(this)},addCloneCount:function(t){const e=this.getTarget();e[Ci]+=t;for(const n of e.getValue())n.addCloneCount(t)},removeCloneCount:function(t){const e=this.getTarget();e[Ci]-=t;for(const n of e.getValue())n.removeCloneCount(t)},addChildObject:function(t){const e=this.getTarget();ti.prototype.addChildObject.call(e,t),t.addCloneCount(e[Ci])},removeChildObject:function(t){const e=this.getTarget();ti.prototype.removeChildObject.call(e,t),t.removeCloneCount(e[Ci])},toStream:function(t){const e=this.getTarget(),n=e.getValue();switch(n.length){case 0:t.string+="[",t.string+=t.TidySpace(),t.string+="]";break;case 1:t.PushUnitCategory(e.getUnit()),n[0].toStream(t),t.PopUnitCategory();break;default:t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.TidyBreak(),t.IncIndent();for(let e=0,i=n.length;e<i;++e)t.string+=t.Indent(),n[e].toStream(t),t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.PopUnitCategory()}},toVRMLString:function(){const t=this.getTarget();t.addCloneCount(1);const e=ti.prototype.toVRMLString.call(t);return t.removeCloneCount(1),e},toVRMLStream:function(t){const e=this.getTarget().getValue();switch(e.length){case 0:t.string+="[",t.string+=t.TidySpace(),t.string+="]";break;case 1:t.EnterScope(),e[0].toVRMLStream(t),t.LeaveScope();break;default:t.EnterScope(),t.string+="[",t.string+=t.TidyBreak(),t.IncIndent();for(const n of e)t.string+=t.Indent(),n.toVRMLStream(t),t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.LeaveScope()}},toXMLString:function(){const t=this.getTarget();t.addCloneCount(1);const e=ti.prototype.toXMLString.call(t);return t.removeCloneCount(1),e},toXMLStream:function(t){const e=this.getTarget(),n=e.length;if(n){t.EnterScope();const i=e.getValue();for(let e=0,o=n-1;e<o;++e){const n=i[e].getValue();if(n)n.toXMLStream(t),t.string+=t.TidyBreak();else{t.string+=t.Indent(),t.string+="<",t.string+="NULL";const e=t.ContainerField();e&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(e.getName()),t.string+="'"),t.string+=t.closingTags?"></NULL>":"/>"}}const o=i.at(-1).getValue();if(o)o.toXMLStream(t);else{t.string+=t.Indent(),t.string+="<",t.string+="NULL";const e=t.ContainerField();e&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(e.getName()),t.string+="'")}t.LeaveScope()}},toJSONStream:function(t){const e=this.getTarget(),n=e.length;if(n){const i=e.getValue();t.EnterScope(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(let e=0,o=n-1;e<o;++e)t.string+=t.Indent(),i[e]?i[e].toJSONStreamValue(t):t.string+="null",t.string+=",",t.string+=t.TidyBreak();t.string+=t.Indent(),i.at(-1)?i.at(-1).toJSONStreamValue(t):t.string+="null",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.LeaveScope()}else t.string+="[",t.string+=t.TidySpace(),t.string+="]"},dispose:function(){const t=this.getTarget();t.resize(0,void 0,!1),t.processInterests(),ti.prototype.dispose.call(t)}});for(const t of Reflect.ownKeys(Oi.prototype))Object.defineProperty(Oi.prototype,t,{enumerable:!1});function Ni(...t){return ti.call(this,t)}Ni.prototype=Object.assign(Object.create(ti.prototype),{constructor:Ni,getValueType:function(){return String},getSingleType:function(){return Xn},getArrayType:function(){return Array},getComponents:function(){return 1},getTypeName:function(){return"MFString"},getType:function(){return c.MFString},toXMLStream:function(t,e){const n=this.getTarget(),i=n.length;if(i){const o=n.getValue();for(let n=0,r=i-1;n<r;++n)t.string+='"',o[n].toXMLStream(t,e),t.string+='"',t.string+=t.Comma(),t.string+=t.TidySpace();t.string+='"',o.at(-1).toXMLStream(t,e),t.string+='"'}}});for(const t of Reflect.ownKeys(Ni.prototype))Object.defineProperty(Ni.prototype,t,{enumerable:!1});function Fi(t,e,n,i,o,r){function s(...t){return gi.call(this,t)}s.prototype=Object.assign(Object.create(gi.prototype),{constructor:s,getSingleType:function(){return n},getValueType:function(){return i},getArrayType:function(){return o},getComponents:function(){return r},getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(s.prototype))Object.defineProperty(s.prototype,t,{enumerable:!1});return s}const Ii=t=>t,Mi={MFBool:Fi("MFBool",c.MFBool,mt,Boolean,Uint8Array,1),MFColor:Fi("MFColor",c.MFColor,Vt,Vt,Float32Array,3),MFColorRGBA:Fi("MFColorRGBA",c.MFColorRGBA,$t,$t,Float32Array,4),MFDouble:Fi("MFDouble",c.MFDouble,ne,Ii,Float64Array,1),MFFloat:Fi("MFFloat",c.MFFloat,re,Ii,Float32Array,1),MFImage:function(t,e,n,i,o,r){function s(...t){return ti.call(this,t)}s.prototype=Object.assign(Object.create(ti.prototype),{constructor:s,getSingleType:function(){return ki},getValueType:function(){return ki},getArrayType:function(){return o},getComponents:function(){return r},getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(s.prototype))Object.defineProperty(s.prototype,t,{enumerable:!1});return s}("MFImage",c.MFImage,0,0,Array,1),MFInt32:Fi("MFInt32",c.MFInt32,ue,Ii,Int32Array,1),MFMatrix3d:Fi("MFMatrix3d",c.MFMatrix3d,mi,mi,Float64Array,9),MFMatrix3f:Fi("MFMatrix3f",c.MFMatrix3f,_i,_i,Float32Array,9),MFMatrix4d:Fi("MFMatrix4d",c.MFMatrix4d,xi,xi,Float64Array,16),MFMatrix4f:Fi("MFMatrix4f",c.MFMatrix4f,yi,yi,Float32Array,16),MFNode:Oi,MFRotation:Fi("MFRotation",c.MFRotation,Pn,Pn,Float64Array,4),MFString:Ni,MFTime:Fi("MFTime",c.MFTime,zn,Ii,Float64Array,1),MFVec2d:Fi("MFVec2d",c.MFVec2d,wi,wi,Float64Array,2),MFVec2f:Fi("MFVec2f",c.MFVec2f,Si,Si,Float32Array,2),MFVec3d:Fi("MFVec3d",c.MFVec3d,Ti,Ti,Float64Array,3),MFVec3f:Fi("MFVec3f",c.MFVec3f,bi,bi,Float32Array,3),MFVec4d:Fi("MFVec4d",c.MFVec4d,vi,vi,Float64Array,4),MFVec4f:Fi("MFVec4f",c.MFVec4f,Ei,Ei,Float32Array,4)},Di=Mi;n.set("x_ite/Fields/ArrayFields",Di);const Ri=Di,Vi=Ri.MFInt32;function Ai(t,e,n,i){this.width=Math.max(0|t,0),this.height=Math.max(0|e,0),this.comp=d.clamp(0|n,0,4),this.array=new Vi,this.array.setValue(i),this.array.length=this.width*this.height}Ai.prototype={constructor:Ai,copy:function(){return new Ai(this.width,this.height,this.comp,this.array)},equals:function(t){return this.width===t.width&&this.height===t.height&&this.comp===t.comp&&this.array.equals(t.array)},assign:function(t){this.width=t.width,this.height=t.height,this.comp=t.comp,this.array.assign(t.array)},set:function(t,e,n,i){this.width=0|t,this.height=0|e,this.comp=0|n,this.array.assign(i)},setWidth:function(t){this.width=Math.max(0|t,0),this.array.length=this.width*this.height},getWidth:function(){return this.width},setHeight:function(t){this.height=Math.max(0|t,0),this.array.length=this.width*this.height},getHeight:function(){return this.height},setComp:function(t){this.comp=d.clamp(0|t,0,4)},getComp:function(){return this.comp},setArray:function(t){this.array.setValue(t),this.array.length=this.width*this.height},getArray:function(){return this.array}};const Pi=Symbol();function Li(t,e,n,i){switch(arguments.length){case 0:lt.call(this,new Ai(0,0,0,new Vi));break;case 1:lt.call(this,arguments[0]);break;case 3:lt.call(this,new Ai(t,e,n,new Vi));break;case 4:lt.call(this,new Ai(t,e,n,i));break;default:throw new Error("Invalid arguments.")}this.getValue().getArray().addParent(this),this.addInterest(Pi,this)}Li.prototype=Object.assign(Object.create(lt.prototype),{constructor:Li,[Pi]:function(){this.getValue().getArray().length=this.width*this.height},[Symbol.iterator]:function*(){yield this.width,yield this.height,yield this.comp,yield this.array},copy:function(){return new Li(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return 0===this.width&&0===this.height&&0===this.comp},set:function(t){this.getValue().assign(t)},getTypeName:function(){return"SFImage"},getType:function(){return c.SFImage},toStream:function(t){const e=this.array;t.string+=this.width,t.string+=t.Space(),t.string+=this.height,t.string+=t.Space(),t.string+=this.comp,t.string+=t.AttribBreak(),t.IncIndent();for(let n=0,i=this.height;n<i;++n){t.string+=t.ListIndent();const o=n*this.width;for(let n=0,i=this.width;n<i;++n)t.string+="0x",t.string+=e[n+o].toString(16),n!==i-1&&(t.string+=t.Space());n!==i-1&&(t.string+=t.AttribBreak())}t.DecIndent()},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.ListBreak(),t.string+=t.IncIndent(),t.string+=t.ListIndent(),this.toJSONStreamValue(t),t.string+=t.DecIndent(),t.string+=t.ListBreak(),t.string+=t.ListIndent(),t.string+="]"},toJSONStreamValue:function(t){const e=this.array,n=e.length;if(t.string+=this.width,t.string+=",",t.string+=t.TidySpace(),t.string+=this.height,t.string+=",",t.string+=t.TidySpace(),t.string+=this.comp,t.string+=",",this.width&&this.height){t.string+=t.ListBreak(),t.string+=t.IncIndent();for(let i=0,o=this.height;i<o;++i){t.string+=t.ListIndent();const r=i*this.width;for(let i=0,o=this.width;i<o;++i)t.string+=e[i+r],i+r!==n-1&&(t.string+=","),i!==o-1&&(t.string+=t.TidySpace());i!==o-1&&(t.string+=t.ListBreak())}t.string+=t.DecIndent()}}});for(const t of Reflect.ownKeys(Li.prototype))Object.defineProperty(Li.prototype,t,{enumerable:!1});const Bi={get:function(){return this.getValue().getWidth()},set:function(t){this.getValue().setWidth(t),this.addEvent()}},Xi={get:function(){return this.getValue().getHeight()},set:function(t){this.getValue().setHeight(t),this.addEvent()}};Object.defineProperties(Li.prototype,{x:Bi,y:Xi,width:Object.assign({enumerable:!0},Bi),height:Object.assign({enumerable:!0},Xi),comp:Object.assign({enumerable:!0},{get:function(){return this.getValue().getComp()},set:function(t){this.getValue().setComp(t),this.addEvent()}}),array:Object.assign({enumerable:!0},{get:function(){return this.getValue().getArray()},set:function(t){this.getValue().setArray(t),this.addEvent()}})});const Ui=Li;n.set("x_ite/Fields/SFImage",Ui);const ki=Ui,zi={SFBool:mt,SFColor:Vt,SFColorRGBA:$t,SFDouble:ne,SFFloat:re,SFImage:ki,SFInt32:ue,SFMatrix3d:Pe.SFMatrix3d,SFMatrix3f:Pe.SFMatrix3f,SFMatrix4d:gn.SFMatrix4d,SFMatrix4f:gn.SFMatrix4f,SFNode:On,SFRotation:Pn,SFString:Xn,SFTime:zn,SFVec2d:xe.SFVec2d,SFVec2f:xe.SFVec2f,SFVec3d:Xe.SFVec3d,SFVec3f:Xe.SFVec3f,SFVec4d:Hn.SFVec4d,SFVec4f:Hn.SFVec4f,VrmlMatrix:gn.VrmlMatrix,...Ri};n.set("x_ite/Fields",zi);const ji=zi,Gi=new Map,Hi=new Map,qi={addNodeTypeName:function(t){Gi.set(t,t),Gi.set(t.toUpperCase(),t)},getNodeTypeName:function(t){return Gi.get(t)},addFieldName:function(t){Hi.set(t,t),Hi.set(t.toLowerCase(),t)},getFieldName:function(t){return Hi.get(t)}};n.set("x_ite/Parser/HTMLSupport",qi);const Yi=qi,Wi=Symbol(),Ki=Symbol(),Ji=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),Zi=Symbol(),Qi=Symbol(),$i=Symbol(),to=Symbol(),eo=Symbol(),no=Symbol(),io=Symbol(),oo=Symbol(),ro=Symbol();function so(t){if(!this[Wi]){B.call(this,t.getBrowser()),this[Wi]=t,this[Ki]=[c.X3DBaseNode],this[Zi]=new pt,this[Qi]=new pt,this[$i]=new Map,this[to]=new pt,this[eo]=[],this[io]=!0,this[no]=!1,this[ro]=0,this.addChildObjects("name_changed",new ji.SFTime,"typeName_changed",new ji.SFTime,"fields_changed",new ji.SFTime,"cloneCount_changed",new ji.SFTime,"private",new ji.SFBool),this.canUserDefinedFields()&&(this[Ji]=new J(this[Ji]));for(const t of this[Ji])this.addField(t)}}so.prototype=Object.assign(Object.create(B.prototype),{constructor:so,[Ji]:new J([]),setName:function(t){B.prototype.setName.call(this,t),this[no]&&(this._name_changed=this.getBrowser().getCurrentTime())},getMainScene:function(){let t=this[Wi].getScene();for(;!t.isMainScene();)t=t.getScene();return t},getScene:function(){let t=this[Wi];for(;!t.isScene();)t=t.getExecutionContext();return t},getExecutionContext:function(){return this[Wi]},setExecutionContext:function(t){this[Wi]=t},addType:function(t){this[Ki].push(t)},getType:function(){return this[Ki]},getInnerNode:function(){return this},isLive:function(){return this[io]},setLive:function(t){this[io]=t.valueOf(),this[oo]()},getLive:function(){function t(){return this._live}return function(){return Object.defineProperty(this,"getLive",{value:t}),this.addChildObjects("live",new ji.SFBool(this.getLiveState())),this._live.removeParent(this),this.getOuterNode?.()?this.getOuterNode().getLive().addInterest(oo,this):this[Wi]!==this&&this[Wi].getLive().addInterest(oo,this),this._live}}(),getLiveState:function(){return this.getOuterNode?.()?this[io]&&this.getOuterNode().getLive().getValue():this!==this[Wi]?this[io]&&this[Wi].getLive().getValue():this[io]},[oo]:function(){const t=this._live;if(t)if(this.getLiveState()){if(t.getValue())return;t.set(!0),t.processEvent()}else t.getValue()&&(t.set(!1),t.processEvent())},create:function(t){return new this.constructor(t||this[Wi])},setup:function(){Object.freeze(this[Ki]);for(const t of this[Zi])t.setTainted(!1);this.initialize(),this[no]=!0},initialize:function(){},isInitialized:function(){return this[no]},copy:function(t){const e=this.create(t);if(this.canUserDefinedFields())for(const t of this[Ji])e.getFields().has(t.name)||e.addUserDefinedField(t.accessType,t.name,t.value.copy());for(const t of this[Zi])e.getFields().get(t.getName()).assign(t);return e.setup(),e},addChildObjects:function(t,e){for(let t=0,e=arguments.length;t<e;t+=2)this.addChildObject(arguments[t],arguments[t+1])},addChildObject:function(t,e){this[eo].push(e),e.addParent(this),e.setName(t),Object.defineProperty(this,"_"+t,{get:function(){return e},set:function(t){e.setValue(t)}})},getFieldDefinitions:function(){return this[Ji]},addField:function(t){const e=t.accessType,n=t.name,i=t.value.copy();i.setTainted(!this[no]),i.addParent(this),i.setName(n),i.setAccessType(e),this[Zi].add(n,i),this[Qi].add(n,i),Object.defineProperty(this,"_"+n,{get:function(){return i},set:function(t){i.setValue(t)},configurable:!0,enumerable:!1}),this.isPrivate()||i.addCloneCount(1),this[no]&&(this._fields_changed=this.getBrowser().getCurrentTime())},getField:function(){const t=/^set_(.*?)$/,e=/^(.*?)_changed$/;return function(n){const i=this[Zi].get(n)||this[$i].get(n);if(i)return i;const o=n.match(t);if(o){const t=this[Zi].get(o[1])||this[$i].get(o[1]);if(t&&t.getAccessType()===c.inputOutput)return t}else{const t=n.match(e);if(t){const e=this[Zi].get(t[1])||this[$i].get(t[1]);if(e&&e.getAccessType()===c.inputOutput)return e}}throw new Error("Unknown field '"+n+"' in node class "+this.getTypeName()+".")}}(),addAlias:function(t,e){this[$i].set(t,e),Object.defineProperty(this,"_"+t,{get:function(){return e},set:function(t){e.setValue(t)}}),e.isInitializable()&&Yi.addFieldName(t)},removeField:function(t){const e=this[Qi].get(t);e&&(e.removeParent(this),this[Zi].remove(t),this[Qi].remove(t),delete this["_"+e.getName()],this.isPrivate()||e.removeCloneCount(1),this[no]&&(this._fields_changed=this.getBrowser().getCurrentTime()))},canUserDefinedFields:function(){return!1},addUserDefinedField:function(t,e,n){this[to].has(e)&&this.removeUserDefinedField(e),n.setTainted(!this[no]),n.addParent(this),n.setName(e),n.setAccessType(t),this[Ji].add(e,new k(t,e,n)),this[Zi].add(e,n),this[to].add(e,n),this.isPrivate()||n.addCloneCount(1),this[no]&&(this._fields_changed=this.getBrowser().getCurrentTime())},removeUserDefinedField:function(t){const e=this[to].get(t);e&&(e.removeParent(this),this[Zi].remove(t),this[to].remove(t),this[Ji].remove(t),this.isPrivate()||e.removeCloneCount(1),this[no]&&(this._fields_changed=this.getBrowser().getCurrentTime()))},getUserDefinedFields:function(){return this[to]},getPredefinedFields:function(){return this[Qi]},getChangedFields:function(t){const e=[];if(t)for(const t of this[to])e.push(t);for(const n of this[Qi])if(t&&(n.getInputRoutes().size||n.getOutputRoutes().size))e.push(n);else{if(0===n.getReferences().size){if(!n.isInitializable())continue;if(this.isDefaultValue(n))continue}e.push(n)}return e},isDefaultValue:function(t){const e=this.getFieldDefinitions().get(t.getName());return e?e.value.equals(t):!t.getModificationTime()},getFields:function(){return this[Zi]},hasRoutes:function(){for(const t of this[Zi])if(t.getInputRoutes().size||t.getOutputRoutes().size)return!0;return!1},isPrivate:function(){return this._private.getValue()},setPrivate:function(t){if(this._private=t,t)for(const t of this[Zi])t.removeCloneCount(1);else for(const t of this[Zi])t.addCloneCount(1)},getPrivate:function(){return this._private},getCloneCount:function(){return this[ro]},addCloneCount:function(t){if(0===t)return;const e=this.getBrowser().getCurrentTime();this[ro]+=t,this[Wi]._sceneGraph_changed=e,this[no]&&(this._cloneCount_changed=e)},removeCloneCount:function(t){if(0===t)return;const e=this.getBrowser().getCurrentTime();this[ro]-=t,this[Wi]._sceneGraph_changed=e,this[no]&&(this._cloneCount_changed=e)},getEnum:function(t,e,n){return t.hasOwnProperty(e)?t[e]:n},dispose:function(){this.setLive(!1);for(const t of this[eo])t.dispose();for(const t of this[Zi])t.dispose();B.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(so.prototype))Object.defineProperty(so.prototype,t,{enumerable:!1});const ao=so;n.set("x_ite/Base/X3DBaseNode",ao);const uo=ao,co="8.7.9";n.set("x_ite/Browser/VERSION",co);const lo=co;n.set("x_ite/DEBUG",false);const ho=false,po=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_sRGB","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","EXT_float_blend","OES_fbo_render_mipmap","WEBGL_get_buffer_sub_data_async","WEBGL_multiview","WEBGL_security_sensitive_resources","WEBGL_shared_resources","EXT_clip_cull_distance","WEBGL_debug","WEBGL_dynamic_texture","WEBGL_subarray_uploads","WEBGL_texture_multisample","WEBGL_texture_source_iframe","WEBGL_video_texture","EXT_texture_storage","OES_depth24","WEBGL_debug_shader_precision","WEBGL_draw_elements_no_range_check","WEBGL_subscribe_uniform","WEBGL_texture_from_depth_video"],fo={create:function(t,e,n){const i={preserveDrawingBuffer:n};let o=null;if(e>=2&&!o&&(o=t.getContext("webgl2",{...i,antialias:!1}),o&&(o.getVersion=function(){return 2})),e>=1&&!o&&(o=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),o)){o.getVersion=function(){return 1};{const t=o.getExtension("OES_vertex_array_object");o.bindVertexArray=t.bindVertexArrayOES.bind(t),o.createVertexArray=t.createVertexArrayOES.bind(t),o.deleteVertexArray=t.deleteVertexArrayOES.bind(t),o.isVertexArray=t.isVertexArrayOES.bind(t)}}if(!o)throw new Error("Couldn't create WebGL context.");const r=o.getParameter(o.ALIASED_LINE_WIDTH_RANGE);if(1===r[0]&&1===r[1]?(o.lineWidth=Function.prototype,o.HAS_FEATURE_TRANSFORMED_LINES=o.getVersion()>=2):o.HAS_FEATURE_TRANSFORMED_LINES=!1,o.HAS_FEATURE_DEPTH_TEXTURE=o.getVersion()>=2||!!o.getExtension("WEBGL_depth_texture"),o.HAS_FEATURE_FRAG_DEPTH=o.getVersion()>=2||!!o.getExtension("EXT_frag_depth"),1===o.getVersion()){const t=o.getExtension("WEBGL_color_buffer_float"),e=o.getExtension("WEBGL_draw_buffers");o.RGBA32F=t.RGBA32F_EXT,o.MAX_COLOR_ATTACHMENTS=e.MAX_COLOR_ATTACHMENTS_WEBGL,o.drawBuffers=e.drawBuffersWEBGL.bind(e);for(let t=0,n=o.getParameter(o.MAX_COLOR_ATTACHMENTS);t<n;++t){const n=e.COLOR_ATTACHMENT0_WEBGL+t;void 0===o[`COLOR_ATTACHMENT${t}`]&&(o[`COLOR_ATTACHMENT${t}`]=n)}}for(const t of po)o.getExtension(t);return Object.assign(o,1===o.getVersion()?{readPixelsAsync:o.readPixels}:{clientWaitAsync:function(t,e,n){return new Promise(((i,o)=>{const r=()=>{switch(this.clientWaitSync(t,e,0)){case this.WAIT_FAILED:return void o();case this.TIMEOUT_EXPIRED:return void setTimeout(r,n);default:return void i()}};setTimeout(r)}))},getBufferSubDataAsync:async function(t,e,n,i,o,r){const s=this.fenceSync(this.SYNC_GPU_COMMANDS_COMPLETE,0);this.flush(),await this.clientWaitAsync(s,0,10),this.deleteSync(s),this.bindBuffer(t,e),this.getBufferSubData(t,n,i,o,r),this.bindBuffer(t,null)},readPixelsAsync:async function(t,e,n,i,o,r,s,a){const u=this.createBuffer();this.bindBuffer(this.PIXEL_PACK_BUFFER,u),this.bufferData(this.PIXEL_PACK_BUFFER,s.byteLength,this.STREAM_READ),this.readPixels(t,e,n,i,o,r,0),this.bindBuffer(this.PIXEL_PACK_BUFFER,null),await this.getBufferSubDataAsync(this.PIXEL_PACK_BUFFER,u,0,s,a),this.deleteBuffer(u)}}),o}},go=fo;n.set("x_ite/Browser/Core/Context",go);const mo=go;const _o=class{#t=0;#e=0;cycles=0;elapsedTime=0;start(){this.#t=Date.now()}stop(){this.#t<=this.#e||(this.#e=Date.now(),this.cycles+=1,this.elapsedTime+=this.#e-this.#t)}reset(){this.#t=0,this.#e=0,this.cycles=0,this.elapsedTime=0}get averageTime(){return this.cycles?this.elapsedTime/this.cycles:0}};n.set("standard/Time/StopWatch",_o);const xo=_o,yo='msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:56+0100\n"\n"PO-Revision-Date: 2015-12-23 04:57+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: de\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Weniger Eigenschaften"\n\nmsgid "More Properties"\nmsgstr "Mehr Eigenschaften"\n\nmsgid "Frame rate"\nmsgstr "Bildrate"\n\nmsgid "fps"\nmsgstr "BpS"\n\nmsgid "Speed"\nmsgstr "Geschwindigkeit"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr ""\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D gesamt"\n\nmsgid "Event Processing"\nmsgstr "Ereignisverarbeitung"\n\nmsgid "Pointer"\nmsgstr "Zeigegerät"\n\nmsgid "Camera"\nmsgstr "Kamera"\n\nmsgid "Collision Detection"\nmsgstr "Kollisionserkennung"\n\nmsgid "Rendering"\nmsgstr "Rendering"\n\nmsgid "Number of Shapes"\nmsgstr "Anzahl der Formen"\n\nmsgid "Number of Sensors"\nmsgstr "Anzahl der Sensoren"\n\nmsgid "Browser Timings"\nmsgstr "Zeitberechnung"\n\nmsgid "X_ITE Browser"\nmsgstr ""\n\nmsgid "Viewpoints"\nmsgstr "Ansichtspunkte"\n\nmsgid "Available Viewers"\nmsgstr "Verfügbare Betrachter"\n\nmsgid "Straighten Horizon"\nmsgstr "Horizont gerade richten"\n\nmsgid "Primitive Quality"\nmsgstr "Qualität der Grundobjekte"\n\nmsgid "High"\nmsgstr "Hoch"\n\nmsgid "high"\nmsgstr "hoch"\n\nmsgid "Medium"\nmsgstr "Mittel"\n\nmsgid "medium"\nmsgstr "mittel"\n\nmsgid "Low"\nmsgstr "Niedrig"\n\nmsgid "low"\nmsgstr "niedrig"\n\nmsgid "Texture Quality"\nmsgstr "Textur Qualität"\n\nmsgid "Display Rubberband"\nmsgstr "Gummiband anzeigen"\n\nmsgid "Rubberband"\nmsgstr "Gummiband"\n\nmsgid "on"\nmsgstr "an"\n\nmsgid "off"\nmsgstr "aus"\n\nmsgid "Mute Browser"\nmsgstr "Browser stumm schalten"\n\nmsgid "Browser muted"\nmsgstr "Browser stumm geschalten"\n\nmsgid "Browser unmuted"\nmsgstr "Browser Ton an"\n\nmsgid "Leave Fullscreen"\nmsgstr "Vollbild verlassen"\n\nmsgid "Fullscreen"\nmsgstr "Vollbild"\n\nmsgid "About X_ITE"\nmsgstr "Über X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Untersuchen"\n\nmsgid "Walk Viewer"\nmsgstr "Laufen"\n\nmsgid "Fly Viewer"\nmsgstr "Fliegen"\n\nmsgid "Plane Viewer"\nmsgstr "Ebenen Betrachter"\n\nmsgid "Look At Viewer"\nmsgstr "Auf Objekte zielen"\n\nmsgid "None Viewer"\nmsgstr "Kein Betrachter"\n\nmsgid "Points"\nmsgstr "Punkte"\n\nmsgid "Flat"\nmsgstr "Flach"\n\nmsgid "Wireframe"\nmsgstr "Drahtgittermodel"\n\nmsgid "Loading %1 file"\nmsgstr "Lade %1 Datei"\n\nmsgid "Loading %1 files"\nmsgstr "Lade %1 Dateien"\n\nmsgid "Loading done"\nmsgstr "Fertig mit Laden"\n\nmsgid "Failed loading world."\nmsgstr "Laden der Dateien fehlgeschlagen."\n\nmsgid "Show World Info"\nmsgstr "World Info anzeigen"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Ansichtspunkt wurde in die Zwischenablage kopiert."\n';n.set("locale/de.po",yo);const wo=yo,So='msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:58+0100\n"\n"PO-Revision-Date: 2015-12-23 05:07+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: fr\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Moins de Propriétés"\n\nmsgid "More Properties"\nmsgstr "Plus de Propriétés"\n\nmsgid "Frame rate"\nmsgstr "Fréquence d\'Images"\n\nmsgid "fps"\nmsgstr "fps"\n\nmsgid "Speed"\nmsgstr "Vélocité"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D total"\n\nmsgid "Event Processing"\nmsgstr "Traitement des Événements"\n\nmsgid "Pointer"\nmsgstr "Pointeur"\n\nmsgid "Camera"\nmsgstr "Caméra"\n\nmsgid "Collision Detection"\nmsgstr "Détection des Collisions"\n\nmsgid "Rendering"\nmsgstr "Rendement"\n\nmsgid "Number of Shapes"\nmsgstr "Nombre de Formes"\n\nmsgid "Number of Sensors"\nmsgstr "Nombre de Senseurs"\n\nmsgid "Browser Timings"\nmsgstr "Calcul du Temps"\n\nmsgid "X_ITE Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "Viewpoints"\nmsgstr "Points de Vue"\n\nmsgid "Available Viewers"\nmsgstr "Visionneurs disponibles"\n\nmsgid "Straighten Horizon"\nmsgstr "Redresser l\'Horizon"\n\nmsgid "Primitive Quality"\nmsgstr "Qualité des Objets simples"\n\nmsgid "High"\nmsgstr "Haut"\n\nmsgid "high"\nmsgstr "haut"\n\nmsgid "Medium"\nmsgstr "Moyenne"\n\nmsgid "medium"\nmsgstr "moyenne"\n\nmsgid "Low"\nmsgstr "Faible"\n\nmsgid "low"\nmsgstr "faible"\n\nmsgid "Texture Quality"\nmsgstr "Qualité des Textures"\n\nmsgid "Display Rubberband"\nmsgstr "Présenter le Bande élastique"\n\nmsgid "Rubberband"\nmsgstr "Bande élastique"\n\nmsgid "on"\nmsgstr "marche"\n\nmsgid "off"\nmsgstr "arrêt"\n\nmsgid "Mute Browser"\nmsgstr "Rendre Navigateur muet"\n\nmsgid "Browser muted"\nmsgstr "Navigateur muet"\n\nmsgid "Browser unmuted"\nmsgstr "Son de Navigateur réactivé"\n\nmsgid "Leave Fullscreen"\nmsgstr "Laisser le plein Écran"\n\nmsgid "Fullscreen"\nmsgstr "Plein Écran"\n\nmsgid "About X_ITE"\nmsgstr "À propos de X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Examiner"\n\nmsgid "Walk Viewer"\nmsgstr "Aller"\n\nmsgid "Fly Viewer"\nmsgstr "Voler"\n\nmsgid "Plane Viewer"\nmsgstr "Visionneur de la Plaine"\n\nmsgid "Look At Viewer"\nmsgstr "Regarder un Objet de près"\n\nmsgid "None Viewer"\nmsgstr "Pas de Visionneur"\n\nmsgid "Flat"\nmsgstr "Plat"\n\nmsgid "Wireframe"\nmsgstr "Image filaire"\n\nmsgid "Loading %1 file"\nmsgstr "Télécharger %1 Fichier"\n\nmsgid "Loading %1 files"\nmsgstr "Télécharger %1 Fichiers"\n\nmsgid "Loading done"\nmsgstr "Téléchargement fini"\n\nmsgid "Failed loading world."\nmsgstr "Le chargement des Fichiers a échoué."\n\nmsgid "Show World Info"\nmsgstr "Afficher World Info"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Le point de Vue est copié dans le Presse-Papiers."\n';n.set("locale/fr.po",So);const To={en:"C",de:wo,fr:So},bo=/msgid\s+"(.*?)"\nmsgstr\s+"(.*?)"\n/g,vo=function(){for(const t of navigator.languages){const e=t.split("-")[0];if(To[e])return e}return(navigator.language||navigator.userLanguage).split("-")[0]}();!function(t){if(To[t]){const i=function(t,e){const n=[];let i=null;for(;i=t.exec(e);)n.push(i);return n}(bo,To[t]),o=To[t]={};for(var e=0,n=i.length;e<n;++e)i[e][2].length&&(o[i[e][1]]=i[e][2])}}(vo);const Eo=function(t){const e=To[vo];if(void 0===e)return t;const n=e[t];return void 0===n?t:n};n.set("locale/gettext",Eo);const Co=Eo;var Oo=i(532);function No(t){uo.call(this,t),this.localStorage=this.getBrowser().getLocalStorage().addNameSpace("BrowserTimings."),this.fps=new xo}No.prototype=Object.assign(Object.create(uo.prototype),{constructor:No,getTypeName:function(){return"BrowserTimings"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserTimings"},initialize:function(){uo.prototype.initialize.call(this),this.getBrowser().getBrowserOptions()._Timings.addInterest("set_enabled__",this),this.localStorage.addDefaultValues({type:"LESS"}),this.element=Oo("<div></div>").hide().addClass("x_ite-private-browser-timings").appendTo(this.getBrowser().getSurface()),this.table=Oo("<table></table>").appendTo(this.element),this.header=Oo("<thead></thead>").append(Oo("<tr></tr>").append(Oo("<th colspan='2'></th>").text(Co("Browser Timings")))).appendTo(this.table),this.body=Oo("<tbody></tbody>").appendTo(this.table),this.footer=Oo("<tfoot></tfoot>").append(Oo("<tr></tr>").append(Oo("<td colspan='2'></td>"))).appendTo(this.table),this.button=Oo("<button></button>").attr("type","button").appendTo(this.footer.find("td")),this.frameRate=Oo("<td></td>"),this.speed=Oo("<td></td>"),this.frameRate=Oo("<td></td>"),this.speed=Oo("<td></td>"),this.browserTime=Oo("<td></td>"),this.x3dTotal=Oo("<td></td>"),this.eventProcessing=Oo("<td></td>"),this.pointerTime=Oo("<td></td>"),this.cameraTime=Oo("<td></td>"),this.pickingTime=Oo("<td></td>"),this.collisionTime=Oo("<td></td>"),this.renderTime=Oo("<td></td>"),this.numShapes=Oo("<td></td>"),this.sensors=Oo("<td></td>"),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Frame rate")+":")).append(this.frameRate)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Speed")+":")).append(this.speed).addClass("x_ite-private-more")),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Browser")+":")).append(this.browserTime)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("X3D total")+":")).append(this.x3dTotal)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Event Processing")+":")).append(this.eventProcessing)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Pointer")+":")).append(this.pointerTime)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Camera")+":")).append(this.cameraTime)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Picking")+":")).append(this.pickingTime)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Collision Detection")+":")).append(this.collisionTime)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Rendering")+":")).append(this.renderTime)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Number of Shapes")+":")).append(this.numShapes)),this.body.append(Oo("<tr></tr>").append(Oo("<td></td>").text(Co("Number of Sensors")+":")).append(this.sensors)),this.button.on("click touchend",this.set_type__.bind(this)),this.localStorage.type="MORE"===this.localStorage.type?"LESS":"MORE",this.set_type__()},set_enabled__:function(){this.getBrowser().getBrowserOption("Timings")?(this.element.stop(!0,!0).fadeIn(),this.fps.reset(),this.getBrowser().prepareEvents().addInterest("update",this),this.update(),this.build()):(this.element.stop(!0,!0).fadeOut(),this.getBrowser().prepareEvents().removeInterest("update",this))},set_type__:function(){"MORE"===this.localStorage.type?(this.localStorage.type="LESS",this.table.addClass("less"),this.table.removeClass("more")):(this.localStorage.type="MORE",this.table.addClass("more"),this.table.removeClass("less")),this.set_button__(),this.build()},set_button__:function(){"MORE"===this.localStorage.type?this.button.text(Co("Less Properties")):this.button.text(Co("More Properties"))},update:function(){this.fps.stop(),this.fps.elapsedTime>1e3&&(this.build(),this.fps.reset()),this.fps.start()},build:function(){const t=this.getBrowser();if(this.frameRate.text(Fo(1e3/this.fps.averageTime)+" "+Co("fps")),this.speed.text(Fo(this.getSpeed(t.currentSpeed))+" "+this.getSpeedUnit(t.currentSpeed)),"MORE"!==this.localStorage.type||!t.getWorld())return;const e=t.getWorld().getLayerSet().getLayers(),n=t.getActiveLayer(),i=n&&t.getCollisionCount()?n.getCollisionTime().averageTime:0,o=t.getCollisionTime().averageTime+i,r=Math.max(0,t.getBrowserTime().averageTime-(t.getCameraTime().averageTime+t.getCollisionTime().averageTime+t.getDisplayTime().averageTime)),s=t.prepareEvents().getInterests().size-1,a=t.sensorEvents().getInterests().size,u=e.reduce(((t,e)=>t+e.getNumOpaqueShapes()),0),c=e.reduce(((t,e)=>t+e.getNumTransparentShapes()),0);this.browserTime.text(Fo(t.getSystemTime().averageTime)+" "+Co("ms")),this.x3dTotal.text(Fo(t.getBrowserTime().averageTime)+" "+Co("ms")),this.eventProcessing.text(Fo(r)+" "+Co("ms")),this.pointerTime.text(Fo(t.getPointingTime().averageTime)+" "+Co("ms")),this.cameraTime.text(Fo(t.getCameraTime().averageTime)+" "+Co("ms")),this.pickingTime.text(Fo(t.getPickingTime().averageTime)+" "+Co("ms")),this.collisionTime.text(Fo(o)+" "+Co("ms")),this.renderTime.text(Fo(t.getDisplayTime().averageTime)+" "+Co("ms")),this.numShapes.text(u+" + "+c),this.sensors.text(s+a),t.getSystemTime().reset(),t.getBrowserTime().reset(),t.getPointingTime().reset(),t.getCameraTime().reset(),t.getPickingTime().reset(),t.getCollisionTime().reset(),t.getDisplayTime().reset(),n?.getCollisionTime().reset()},getSpeed:function(t){return t<15?t:3.6*t},getSpeedUnit:function(t){return Co(t<15?"m/s":"km/h")}});const Fo=function(){const t=new Intl.NumberFormat(navigator.language||navigator.userLanguage,{notation:"standard",minimumFractionDigits:2,maximumFractionDigits:2}).format;return function(e){return t(Number.isFinite(e)?e:0)}}(),Io=No;n.set("x_ite/Browser/Core/BrowserTimings",Io);const Mo=Io;let Do=0;const Ro={LOW:Do++,MEDIUM:Do++,HIGH:Do++};n.set("x_ite/Browser/Core/PrimitiveQuality",Ro);const Vo=Ro;let Ao=0;const Po={POINT:Ao++,WIREFRAME:Ao++,FLAT:Ao++,GOURAUD:Ao++,PHONG:Ao++};n.set("x_ite/Browser/Core/Shading",Po);const Lo=Po;let Bo=0;const Xo={LOW:Bo++,MEDIUM:Bo++,HIGH:Bo++};n.set("x_ite/Browser/Core/TextureQuality",Xo);const Uo=Xo;var ko=i(532);function zo(t){uo.call(this,t),this.addAlias("AntiAliased",this._Antialiased);const e=this.getBrowser();this.localStorage=e.getLocalStorage().addNameSpace("BrowserOptions."),this.textureQuality=Uo.MEDIUM,this.primitiveQuality=Vo.MEDIUM,this.shading=Lo.GOURAUD}zo.prototype=Object.assign(Object.create(uo.prototype),{constructor:zo,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"SplashScreen",new ji.SFBool(!0)),new k(c.inputOutput,"Dashboard",new ji.SFBool(!0)),new k(c.inputOutput,"Rubberband",new ji.SFBool(!0)),new k(c.inputOutput,"EnableInlineViewpoints",new ji.SFBool(!0)),new k(c.inputOutput,"Antialiased",new ji.SFBool(!0)),new k(c.inputOutput,"TextureQuality",new ji.SFString("MEDIUM")),new k(c.inputOutput,"PrimitiveQuality",new ji.SFString("MEDIUM")),new k(c.inputOutput,"QualityWhenMoving",new ji.SFString("SAME")),new k(c.inputOutput,"Shading",new ji.SFString("GOURAUD")),new k(c.inputOutput,"MotionBlur",new ji.SFBool),new k(c.inputOutput,"AutoUpdate",new ji.SFBool(!1)),new k(c.inputOutput,"Cache",new ji.SFBool(!0)),new k(c.inputOutput,"ContentScale",new ji.SFDouble(1)),new k(c.inputOutput,"ContextMenu",new ji.SFBool(!0)),new k(c.inputOutput,"Debug",new ji.SFBool),new k(c.inputOutput,"Gravity",new ji.SFDouble(9.80665)),new k(c.inputOutput,"LogarithmicDepthBuffer",new ji.SFBool),new k(c.inputOutput,"Notifications",new ji.SFBool(!0)),new k(c.inputOutput,"Multisampling",new ji.SFInt32(4)),new k(c.inputOutput,"OptimizeStaticGroup",new ji.SFBool(!0)),new k(c.inputOutput,"PrivateSensors",new ji.SFBool(!1)),new k(c.inputOutput,"StraightenHorizon",new ji.SFBool(!0)),new k(c.inputOutput,"Timings",new ji.SFBool)]),getTypeName:function(){return"BrowserOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserOptions"},initialize:function(){uo.prototype.initialize.call(this),this.localStorage.addDefaultValues({Rubberband:this._Rubberband.getValue(),PrimitiveQuality:this._PrimitiveQuality.getValue(),TextureQuality:this._TextureQuality.getValue(),StraightenHorizon:this._StraightenHorizon.getValue(),Timings:this._Timings.getValue()}),this._Rubberband.addInterest("set_rubberband__",this),this._Antialiased.addInterest("set_antialiased__",this),this._PrimitiveQuality.addInterest("set_primitiveQuality__",this),this._TextureQuality.addInterest("set_textureQuality__",this),this._Shading.addInterest("set_shading__",this),this._StraightenHorizon.addInterest("set_straightenHorizon__",this),this._AutoUpdate.addInterest("set_autoUpdate__",this),this._ContentScale.addInterest("set_contentScale__",this),this._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this._Multisampling.addInterest("set_multisampling__",this),this._Timings.addInterest("set_timings__",this),this.set_antialiased__(this._Antialiased),this.set_shading__(this._Shading),this.set_contentScale__(this._ContentScale),this.set_logarithmicDepthBuffer__(this._LogarithmicDepthBuffer),this.set_multisampling__(this._Multisampling),this.configure()},configure:function(){const t=new Set(["Antialiased","AutoUpdate","Cache","ContentScale","ContextMenu","Debug","Multisampling","Notifications","SplashScreen"]),e=new Set(["PrimitiveQuality","Rubberband","StraightenHorizon","TextureQuality","Timings"]);return function(){const n=this.getBrowser(),i=this.localStorage;for(const{name:o,value:r}of this.getFieldDefinitions()){if(t.has(o)){const t=ko.toLowerCaseFirst(o),e=n.getElement().attr(t);if(void 0!==e){n.attributeChangedCallback(t,null,e);continue}}if(e.has(o)){const t=i[o],e=this.getField(o);t!==e.getValue()&&e.setValue(t);continue}const s=this.getField(o);s.equals(r)||s.assign(r)}}}(),getPrimitiveQuality:function(){return this.primitiveQuality},getShading:function(){return this.shading},getTextureQuality:function(){return this.textureQuality},set_rubberband__:function(t){this.localStorage.Rubberband=t.getValue()},set_antialiased__:function(){this.set_multisampling__(this._Multisampling)},set_primitiveQuality__:function(t){const e=this.getBrowser(),n=t.getValue().toUpperCase();this.localStorage.PrimitiveQuality=n,this.primitiveQuality=this.getEnum(Vo,n,Vo.MEDIUM),"function"==typeof e.setPrimitiveQuality2D&&e.setPrimitiveQuality2D(this.primitiveQuality),"function"==typeof e.setPrimitiveQuality3D&&e.setPrimitiveQuality3D(this.primitiveQuality)},set_textureQuality__:function(t){const e=this.getBrowser(),n=t.getValue().toUpperCase();this.localStorage.TextureQuality=n,this.textureQuality=this.getEnum(Uo,n,Uo.MEDIUM),"function"==typeof e.setTextureQuality&&e.setTextureQuality(this.textureQuality)},set_shading__:function(){const t={[Lo.POINT]:"POINT",[Lo.WIREFRAME]:"WIREFRAME",[Lo.FLAT]:"FLAT",[Lo.GOURAUD]:"GOURAUD",[Lo.PHONG]:"PHONG"};return function(e){const n=this.getBrowser(),i=e.getValue().toUpperCase().replace("POINTSET","POINT");this.shading=this.getEnum(Lo,i,Lo.GOURAUD),n.getRenderingProperties()._Shading=t[this.shading],n.setShading(this.shading)}}(),set_straightenHorizon__:function(t){this.localStorage.StraightenHorizon=t.getValue(),t.getValue()&&this.getBrowser().getActiveLayer()?.straightenView()},updateContentScale:function(){const t=this.getBrowser(),e=window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),n=this.updateContentScale.bind(this);this.removeUpdateContentScale&&this.removeUpdateContentScale(),this.removeUpdateContentScale=function(){e.removeEventListener("change",n)},e.addEventListener("change",n),t.getRenderingProperties()._ContentScale=window.devicePixelRatio,t.reshape()},set_autoUpdate__:function(t){const e=["resize","scroll","load"].map((t=>`${t}.${this.getTypeName()}${this.getId()}`)).join(" ");if(t.getValue()){const t=this.getBrowser(),n=t.getElement(),i=()=>{n.isInViewport()?t.isLive()||t.beginUpdate():t.isLive()&&t.endUpdate()};ko(window).on(e,i),i()}else ko(window).off(e)},set_contentScale__:function(t){const e=this.getBrowser();this.removeUpdateContentScale&&this.removeUpdateContentScale(),-1===t.getValue()?this.updateContentScale():e.getRenderingProperties()._ContentScale=Math.max(t.getValue(),0)||1,e.reshape()},set_logarithmicDepthBuffer__:function(t){const e=this.getBrowser(),n=e.getContext();e.getRenderingProperties()._LogarithmicDepthBuffer=t.getValue()&&n.HAS_FEATURE_FRAG_DEPTH},set_multisampling__:function(t){const e=this.getBrowser(),n=d.clamp(t.getValue(),0,e.getMaxSamples());e.getRenderingProperties()._Multisampling=this._Antialiased.getValue()?n:0,e.getRenderingProperties()._Antialiased=e.getAntialiased(),e.reshape()},set_timings__:function(t){this.localStorage.Timings=t.getValue()}});const jo=zo;n.set("x_ite/Browser/Core/BrowserOptions",jo);const Go=jo;function Ho(t){uo.call(this,t)}Ho.prototype=Object.assign(Object.create(uo.prototype),{constructor:Ho,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.initializeOnly,"ABSTRACT_NODES",new ji.SFBool(!0)),new k(c.initializeOnly,"CONCRETE_NODES",new ji.SFBool(!0)),new k(c.initializeOnly,"EXTERNAL_INTERACTIONS",new ji.SFBool(!0)),new k(c.initializeOnly,"PROTOTYPE_CREATE",new ji.SFBool(!0)),new k(c.initializeOnly,"DOM_IMPORT",new ji.SFBool(!0)),new k(c.initializeOnly,"XML_ENCODING",new ji.SFBool(!0)),new k(c.initializeOnly,"CLASSIC_VRML_ENCODING",new ji.SFBool(!0)),new k(c.initializeOnly,"BINARY_ENCODING",new ji.SFBool)]),getTypeName:function(){return"BrowserProperties"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserProperties"}});const qo=Ho;n.set("x_ite/Browser/Core/BrowserProperties",qo);const Yo=qo;function Wo(t){uo.call(this,t),this.addAlias("AntiAliased",this._Antialiased)}Wo.prototype=Object.assign(Object.create(uo.prototype),{constructor:Wo,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.outputOnly,"Shading",new ji.SFString),new k(c.outputOnly,"MaxTextureSize",new ji.SFInt32),new k(c.outputOnly,"TextureUnits",new ji.SFInt32),new k(c.outputOnly,"MaxLights",new ji.SFInt32),new k(c.outputOnly,"Antialiased",new ji.SFBool(!0)),new k(c.outputOnly,"ColorDepth",new ji.SFInt32),new k(c.outputOnly,"TextureMemory",new ji.SFDouble),new k(c.outputOnly,"ContentScale",new ji.SFDouble(1)),new k(c.outputOnly,"LogarithmicDepthBuffer",new ji.SFBool),new k(c.outputOnly,"MaxSamples",new ji.SFInt32),new k(c.outputOnly,"Multisampling",new ji.SFInt32(4))]),getTypeName:function(){return"RenderingProperties"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"renderingProperties"},initialize:function(){uo.prototype.initialize.call(this);const t=this.getBrowser();this._MaxTextureSize=t.getMaxTextureSize(),this._TextureUnits=t.getMaxCombinedTextureUnits(),this._MaxLights=t.getMaxLights(),this._ColorDepth=t.getColorDepth(),this._TextureMemory=t.getTextureMemory(),this._MaxSamples=t.getMaxSamples()}});const Ko=Wo;n.set("x_ite/Browser/Core/RenderingProperties",Ko);const Jo=Ko;var Zo=i(532);function Qo(t){uo.call(this,t),this.addChildObjects("string",new Xn)}Zo.fn.textWidth=function(t){const e=Zo(this).children(),n="<span>"+Zo(this).html()+"</span>";Zo(this).html(n);const i=Zo(this).find("span:first").width();return Zo(this).empty(),Zo(this).append(e),i},Qo.prototype=Object.assign(Object.create(uo.prototype),{constructor:Qo,getTypeName:function(){return"Notification"},getComponentName:function(){return"X_ITE"},initialize:function(){uo.prototype.initialize.call(this),this.element=Zo("<div></div>").hide().addClass("x_ite-private-notification").appendTo(this.getBrowser().getSurface()).animate({width:0}),Zo("<span></span>").appendTo(this.element),this._string.addInterest("set_string__",this)},set_string__:function(){this.getBrowser().getBrowserOption("Notifications")&&0!==this._string.length&&(this.element.children().text(this._string.getValue()),this.element.stop(!0,!0).fadeIn(0).animate({width:this.element.textWidth()}).animate({delay:1},5e3).animate({width:0}).fadeOut(0))}});const $o=Qo;n.set("x_ite/Browser/Core/Notification",$o);const tr=$o;i(642);var er=i(532);const nr=Symbol();function ir(t){uo.call(this,t),this[nr]=null}ir.prototype=Object.assign(Object.create(uo.prototype),{constructor:ir,getTypeName:function(){return"ContextMenu"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"contextMenu"},initialize:function(){uo.prototype.initialize.call(this);const t=this.getBrowser();this.init({element:t.getElement(),appendTo:t.getShadow(),build:this.build.bind(this),animation:{duration:500,show:"fadeIn",hide:"fadeOut"}})},getUserMenu:function(){return this[nr]},setUserMenu:function(t){this[nr]=t},createUserMenu:function(){const t={};if("function"==typeof this[nr]){const e=this[nr]();if(er.isPlainObject(e))for(const n in e)t["user-"+n]=e[n]}return t},build:function(t){const e=this.getBrowser(),n=e.getElement().fullScreen();if(!e.getBrowserOption("ContextMenu"))return;const i={className:"x_ite-private-menu",items:{title:{name:e.getName()+" Browser v"+e.getVersion(),className:"context-menu-title context-menu-not-selectable"},separator0:"--------",viewpoints:{name:Co("Viewpoints"),className:"context-menu-icon x_ite-private-icon-viewpoint",items:this.getViewpoints()},"available-viewers":{name:Co("Available Viewers"),items:this.getAvailableViewers()},"straighten-horizon":{name:Co("Straighten Horizon"),type:"checkbox",selected:e.getBrowserOption("StraightenHorizon"),events:{click:function(t){const n=er(t.target).is(":checked");e.setBrowserOption("StraightenHorizon",n),e.getNotification()._string=n?Co("Straighten Horizon")+": "+Co("on"):Co("Straighten Horizon")+": "+Co("off")}.bind(this)}},"display-rubberband":{name:Co("Display Rubberband"),type:"checkbox",selected:e.getBrowserOption("Rubberband"),events:{click:function(t){const n=er(t.target).is(":checked");e.setBrowserOption("Rubberband",n),e.getNotification()._string=n?Co("Rubberband")+": "+Co("on"):Co("Rubberband")+": "+Co("off")}.bind(this)}},separator1:"--------","primitive-quality":{name:Co("Primitive Quality"),className:"context-menu-icon x_ite-private-icon-primitive-quality",items:{high:{name:Co("High"),type:"radio",radio:"primitive-quality",selected:"HIGH"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","HIGH"),e.getNotification()._string=Co("Primitive Quality")+": "+Co("high")}.bind(this)}},medium:{name:Co("Medium"),type:"radio",radio:"primitive-quality",selected:"MEDIUM"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","MEDIUM"),e.getNotification()._string=Co("Primitive Quality")+": "+Co("medium")}.bind(this)}},low:{name:Co("Low"),type:"radio",radio:"primitive-quality",selected:"LOW"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","LOW"),e.getNotification()._string=Co("Primitive Quality")+": "+Co("low")}.bind(this)}}}},"texture-quality":{name:Co("Texture Quality"),className:"context-menu-icon x_ite-private-icon-texture-quality",items:{high:{name:Co("High"),type:"radio",radio:"texture-quality",selected:"HIGH"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","HIGH"),e.getNotification()._string=Co("Texture Quality")+": "+Co("high")}.bind(this)}},medium:{name:Co("Medium"),type:"radio",radio:"texture-quality",selected:"MEDIUM"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","MEDIUM"),e.getNotification()._string=Co("Texture Quality")+": "+Co("medium")}.bind(this)}},low:{name:Co("Low"),type:"radio",radio:"texture-quality",selected:"LOW"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","LOW"),e.getNotification()._string=Co("Texture Quality")+": "+Co("low")}.bind(this)}}}},shading:{name:Co("Shading"),className:"context-menu-icon x_ite-private-icon-shading",items:{point:{name:Co("Points"),type:"radio",radio:"shading",selected:"POINT"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","POINT"),e.getNotification()._string=Co("Shading")+": "+Co("Points")}.bind(this)}},wireframe:{name:Co("Wireframe"),type:"radio",radio:"shading",selected:"WIREFRAME"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","WIREFRAME"),e.getNotification()._string=Co("Shading")+": "+Co("Wireframe")}.bind(this)}},flat:{name:Co("Flat"),type:"radio",radio:"shading",selected:"FLAT"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","FLAT"),e.getNotification()._string=Co("Shading")+": "+Co("Flat")}.bind(this)}},gouraud:{name:Co("Gouraud"),type:"radio",radio:"shading",selected:"GOURAUD"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","GOURAUD"),e.getNotification()._string=Co("Shading")+": "+Co("Gouraud")}.bind(this)}},phong:{name:Co("Phong"),type:"radio",radio:"shading",selected:"PHONG"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","PHONG"),e.getNotification()._string=Co("Shading")+": "+Co("Phong")}.bind(this)}}}},separator2:"--------","browser-timings":{name:Co("Browser Timings"),type:"checkbox",selected:e.getBrowserOption("Timings"),events:{click:function(t){e.setBrowserOption("Timings",er(t.target).is(":checked")),e.getSurface().focus()}.bind(this)}},fullscreen:{name:Co(n?"Leave Fullscreen":"Fullscreen"),className:"context-menu-icon "+(n?"x_ite-private-icon-leave-fullscreen":"x_ite-private-icon-enter-fullscreen"),callback:function(){e.getElement().toggleFullScreen()}.bind(this)},separator3:"--------"}};Object.assign(i.items,this.createUserMenu()),Object.assign(i.items,{separator4:"--------","world-info":{name:Co("Show World Info"),className:"context-menu-icon x_ite-private-icon-world-info",callback:function(){e.getShadow().find(".x_ite-private-world-info").remove();const t=e.getShadow().find(".x_ite-private-browser"),n=er("<div></div>").addClass("x_ite-private-world-info-overlay").appendTo(t),i=er("<div></div>").addClass("x_ite-private-world-info").appendTo(n),o=e.getExecutionContext().getWorldInfos()[0],r=o.title,s=o.info;er("<div></div>").addClass("x_ite-private-world-info-top").text("World Info").appendTo(i),r.length&&er("<div></div>").addClass("x_ite-private-world-info-title").text(r).appendTo(i);for(const t of s)er("<div></div>").addClass("x_ite-private-world-info-info").text(t).appendTo(i);i.find("a").on("click",(function(t){t.stopPropagation()})),i.find("a[href^=http]").each((function(){-1===this.href.indexOf(location.hostname)&&er(this).attr("target","_blank")})),n.on("click",(function(){n.remove()}))}},about:{name:Co("About X_ITE"),className:"context-menu-icon x_ite-private-icon-help-about",callback:function(){window.open(e.getProviderUrl())}}}),er.isEmptyObject(i.items.viewpoints.items)&&delete i.items.viewpoints,Object.keys(i.items["available-viewers"].items).length<2&&delete i.items["available-viewers"],e.getCurrentViewer().match(/^(?:EXAMINE|FLY)$/)||delete i.items["straighten-horizon"],e.getBrowserOption("Debug")||delete i.items.shading;const o=e.getExecutionContext().getWorldInfos()[0];return(!o||0===o.title.length&&0===o.info.length)&&delete i.items["world-info"],i},getViewpoints:function(){const t=this.getBrowser(),e=t.getActiveLayer();if(!e)return{};const n=t.getBrowserOption("EnableInlineViewpoints"),i=t.currentScene,o=e.getViewpoints().get(),r=e.getViewpoint(),s={};for(const e of o){const o=e._description.getValue();if(""===o)continue;if(!n&&e.getScene()!==i)continue;const a={name:o,callback:function(e){t.bindViewpoint(t.getActiveLayer(),e),t.getSurface().focus()}.bind(this,e)};e===r&&(a.className="context-menu-selected"),s["Viewpoint"+e.getId()]=a}return s},getAvailableViewers:function(){const t=this.getBrowser(),e=t._viewer.getValue(),n=t._availableViewers,i={};for(const o of n)i[o]={name:Co(this.getViewerName(o)),className:"context-menu-icon x_ite-private-icon-"+o.toLowerCase()+"-viewer",callback:function(e){t._viewer=e,t.getNotification()._string=Co(this.getViewerName(e)),t.getSurface().focus()}.bind(this,o)},o===e&&(i[o].className+=" context-menu-selected");return i},getViewerName:function(t){switch(t){case"EXAMINE":return Co("Examine Viewer");case"WALK":return Co("Walk Viewer");case"FLY":return Co("Fly Viewer");case"PLANE":return Co("Plane Viewer");case"LOOKAT":return Co("Look At Viewer");case"NONE":return Co("None Viewer")}},init:function(t){this.show=this.createRoot.bind(this,t),t.element.on("contextmenu",this.show)},show:function(t){},hide:function(t){},createRoot:function(t,e){const n=t.build(e);if(!n)return;const i=er("<div></div>").addClass("context-menu-layer").addClass(n.className).appendTo(t.appendTo),o=this.hide=function(){return delete this.hide,i.remove(),r[t.animation.hide](t.animation.duration,(function(){r.remove(),t.events&&"function"==typeof t.events.hide&&t.events.hide()})),!1}.bind(this),r=er("<ul></ul>").hide().addClass("context-menu-root").addClass("context-menu-list").addClass(n.className).appendTo(t.appendTo).offset({left:e.pageX,top:e.pageY});for(const t in n.items)r.append(this.createItem(n.items[t],"context-menu-root",t,2,o));return r[t.animation.show](t.animation.duration),r.offset({left:e.pageX,top:e.pageY}),r.offset().left-er(document).scrollLeft()+r.outerWidth()>er(window).width()&&r.offset({left:er(document).scrollLeft()+Math.max(0,er(window).width()-r.outerWidth())}),r.offset().top-er(document).scrollTop()+r.outerHeight()>er(window).height()&&r.offset({top:er(document).scrollTop()+Math.max(0,er(window).height()-r.outerHeight())}),r.find("ul").each((function(t,e){const n=(e=er(e)).outerWidth()+r.outerWidth(),i=r.offset().left-er(document).scrollLeft()+n>er(window).width()?"right":"left";e.css("width",e.outerWidth()),e.css(i,e.parent().closest("ul").width()),e.outerHeight()>=er(window).height()&&e.css({"max-height":"100vh","overflow-y":"scroll"})})),r.find("li").on("mouseenter touchstart",(function(t){t.stopImmediatePropagation();const e=er(t.target).closest("li").children("ul");if(!e.length)return;e.css("top","");const n=e.offset().top+e.outerHeight()-er(window).scrollTop()-er(window).height();n>0&&e.offset({top:e.offset().top-n})})),i.on("click contextmenu",o),r.on("contextmenu",o),t.events&&"function"==typeof t.events.show&&t.events.show(r),!1},createItem:function(t,e,n,i,o){const r=er("<li></li>").addClass("context-menu-item");switch(typeof t){case"string":t.match(/^-+$/)&&r.addClass(["context-menu-separator","context-menu-not-selectable"]);break;case"object":switch(t.className&&r.addClass(t.className),t.type){case"radio":case"checkbox":{const n=er("<label></label>").appendTo(r),i=er("<input></input>").appendTo(n);i.attr("type",t.type).attr("name","context-menu-input-"+(t.radio||e)),er("<span></span>").text(t.name).appendTo(n),t.selected&&i.attr("checked","checked");for(const e in t.events)"function"==typeof t.events[e]&&i.on(e,t.events[e]);r.addClass("context-menu-input");break}default:t.name&&er("<span></span>").text(t.name).appendTo(r),"function"==typeof t.callback&&r.on("click",t.callback).on("click",o)}}if("object"==typeof t.items&&i<3){const e=er("<ul></ul>").addClass("context-menu-list").css({"z-index":i}).appendTo(r);for(const r in t.items)e.append(this.createItem(t.items[r],n,r,i+1,o));r.addClass("context-menu-submenu")}return r}});const or=ir;n.set("x_ite/Browser/Core/ContextMenu",or);const rr=or,sr={NODE_ENV:"object"==typeof process&&-1!==process.release.name.search(/node|io.js/)};n.set("x_ite/Browser/Networking/Features",sr);const ar=sr,ur={getScriptUrl:function(){if(ar.NODE_ENV)var t=i.g.require("url").pathToFileURL(__filename).href;else if(document.currentScript)t=document.currentScript.src;else t=document.location.href;return function(){return t}}(),getProviderUrl:function(t){return t?(this.getScriptUrl().match(/\.min\.js$/)&&(t+=".min"),new URL("assets/components/"+t+".js",this.getScriptUrl()).href):"https://create3000.github.io/x_ite/"},getFontsUrl:function(t){return new URL("assets/fonts/"+t,this.getScriptUrl()).href},getLinetypeUrl:function(){return new URL("assets/linetype/linetypes.png",this.getScriptUrl()).href},getHatchingUrl:function(t){return new URL("assets/hatching/"+t+".png",this.getScriptUrl()).href},getLibUrl:function(t){return new URL("assets/lib/"+t,this.getScriptUrl()).href}};n.set("x_ite/Browser/Networking/URLs",ur);const cr=ur;function lr(t){uo.call(this,t),this.addType(c.X3DNode)}lr.prototype=Object.assign(Object.create(uo.prototype),{constructor:lr,copy:function(t){if(!t||t.getType().includes(c.X3DExecutionContext))return uo.prototype.copy.call(this,t);{const e=t.getBody();if(this.getName().length){const t=e.getNamedNodes().get(this.getName());if(t)return t.getValue()}const n=this.create(e);this.getNeedsName()&&this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(),this),this.getName().length&&e.updateNamedNode(this.getName(),n);for(const e of this.getPredefinedFields())try{const i=n.getField(e.getName());if(e.hasReferences())for(const n of e.getReferences())try{i.addReference(t.getField(n.getName()))}catch(t){console.error(t)}else if(e.getAccessType()&c.initializeOnly)switch(e.getType()){case c.SFNode:case c.MFNode:i.assign(e.copy(t));break;default:i.assign(e)}i.setModificationTime(e.getModificationTime())}catch(t){console.error(t)}for(const e of this.getUserDefinedFields()){const i=e.copy(t);if(n.addUserDefinedField(e.getAccessType(),e.getName(),i),e.hasReferences())for(const n of e.getReferences())try{i.addReference(t.getField(n.getName()))}catch(e){console.error("No reference '"+n.getName()+"' inside execution context "+t.getTypeName()+" '"+t.getName()+"'.")}i.setModificationTime(e.getModificationTime())}return n.setup(),n}},getDisplayName:function(){return this.getName().replace(/_\d+$/,"")},getNeedsName:function(){if(this.getName().length)return!1;if(this.getCloneCount()>1)return!0;if(this.hasRoutes())return!0;const t=this.getExecutionContext();for(const e of t.getImportedNodes())if(e.getInlineNode()===this)return!0;if(t.isScene())for(const e of t.getExportedNodes())if(e.getLocalNode()===this)return!0;return!1},getSourceText:function(){return null},traverse:function(){},toStream:function(t){t.string+=this.getTypeName()+" { }"},toVRMLStream:function(t){t.EnterScope();const e=t.Name(this);if(e.length&&t.ExistsNode(this))return t.string+="USE",t.string+=t.Space(),t.string+=e,void t.LeaveScope();e.length&&(t.AddNode(this),t.string+="DEF",t.string+=t.Space(),t.string+=e,t.string+=t.Space()),t.string+=this.getTypeName(),t.string+=t.TidySpace(),t.string+="{";const n=this.getChangedFields(),i=this.getUserDefinedFields();if(this.canUserDefinedFields()&&i.length){let e=0,o=0;for(const n of i)e=Math.max(e,n.getTypeName().length),o=Math.max(o,t.AccessType(n.getAccessType()).length);const r=i.at(-1);t.string+=t.TidyBreak(),t.IncIndent();for(const n of i)this.toVRMLStreamUserDefinedField(t,n,e,o),t.string+=n===r?t.TidyBreak():t.Break();t.DecIndent(),0!==n.length&&(t.string+=t.TidyBreak())}if(0===n.length)i.length?t.string+=t.Indent():t.string+=t.TidySpace();else{const e=n.at(-1);0===i.length&&(t.string+=t.TidyBreak()),t.IncIndent();for(const i of n)this.toVRMLStreamField(t,i),t.string+=i===e?t.TidyBreak():t.Break();t.DecIndent(),t.string+=t.Indent()}t.string+="}",t.LeaveScope()},toVRMLStreamUserDefinedField:function(t,e,n,i){const o=t.IsSharedNode(this);if(0===e.getReferences().size||!t.ExecutionContext()||o)t.string+=t.Indent(),t.string+=t.AccessType(e.getAccessType()).padEnd(i," "),t.string+=t.Space(),t.string+=e.getTypeName().padEnd(n," "),t.string+=t.Space(),t.string+=e.getName(),e.isInitializable()&&(t.string+=t.Space(),e.toVRMLStream(t));else{let o=0,r=!1;for(const s of e.getReferences())r=r||s.isInitializable(),t.string+=t.Indent(),t.string+=t.AccessType(e.getAccessType()).padEnd(i," "),t.string+=t.Space(),t.string+=e.getTypeName().padEnd(n," "),t.string+=t.Space(),t.string+=e.getName(),t.string+=t.Space(),t.string+="IS",t.string+=t.Space(),t.string+=s.getName(),++o,o!==e.getReferences().size&&(t.string+=t.Break());e.getAccessType()!==c.inputOutput||r||e.isDefaultValue()||(t.string+=t.Break(),t.string+=t.Indent(),t.string+=t.AccessType(e.getAccessType()).padEnd(i," "),t.string+=t.Space(),t.string+=e.getTypeName().padEnd(n," "),t.string+=t.Space(),t.string+=e.getName(),e.isInitializable()&&(t.string+=t.Space(),e.toVRMLStream(t)))}},toVRMLStreamField:function(t,e){const n=t.IsSharedNode(this);if(0===e.getReferences().size||!t.ExecutionContext()||n)e.isInitializable()&&(t.string+=t.Indent(),t.string+=e.getName(),t.string+=t.Space(),e.toVRMLStream(t));else{let n=0,i=!1;for(const o of e.getReferences())i=i||o.isInitializable(),t.string+=t.Indent(),t.string+=e.getName(),t.string+=t.Space(),t.string+="IS",t.string+=t.Space(),t.string+=o.getName(),++n,n!==e.getReferences().size&&(t.string+=t.Break());e.getAccessType()!==c.inputOutput||i||this.isDefaultValue(e)||(t.string+=t.Break(),t.string+=t.Indent(),t.string+=e.getName(),t.string+=t.Space(),e.toVRMLStream(t))}},toXMLStream:function(t){const e=t.IsSharedNode(this);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this)){t.string+=t.Indent(),t.string+="<",t.string+=this.getTypeName(),t.html&&"Script"===this.getTypeName()&&(t.string+=t.Space(),t.string+="type='model/x3d+xml'"),t.string+=t.Space(),t.string+="USE='",t.string+=t.XMLEncode(n),t.string+="'";const e=t.ContainerField();return e&&e.getName()!==this.getContainerField()&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(e.getName()),t.string+="'"),t.closingTags?(t.string+="></",t.string+=this.getTypeName(),t.string+=">"):t.string+="/>",void t.LeaveScope()}t.string+=t.Indent(),t.string+="<",t.string+=this.getTypeName(),t.html&&"Script"===this.getTypeName()&&(t.string+=t.Space(),t.string+="type='model/x3d+xml'"),n.length&&(t.AddNode(this),t.string+=t.Space(),t.string+="DEF='",t.string+=t.XMLEncode(n),t.string+="'");const i=t.ContainerField();i&&i.getName()!==this.getContainerField()&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(i.getName()),t.string+="'");const o=this.getChangedFields(),r=this.getUserDefinedFields(),s=[],a=[];let u=this.getSourceText();(0===u?.length||t.html&&"Script"!==this.getTypeName())&&(u=null),t.IncIndent(),t.IncIndent();for(const n of o){let i=!1;if(t.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(n))),0===n.getReferences().size||!t.ExecutionContext()||e||i){if(i&&s.push(n),n.isInitializable())switch(n.getType()){case c.SFNode:case c.MFNode:a.push(n);break;default:if(n===u)break;t.string+=t.AttribBreak(),t.string+=t.ListIndent(),t.string+=n.getName(),t.string+="='",n.toXMLStream(t,n===this.getSourceText()),t.string+="'"}}else s.push(n)}if(t.DecIndent(),t.DecIndent(),this.canUserDefinedFields()&&r.length||s.length&&!e||a.length||u){if(t.string+=">",t.string+=t.TidyBreak(),t.IncIndent(),this.canUserDefinedFields())for(const n of r){t.string+=t.Indent(),t.string+="<field",t.string+=t.Space(),t.string+="accessType='",t.string+=t.AccessType(n.getAccessType()),t.string+="'",t.string+=t.Space(),t.string+="type='",t.string+=n.getTypeName(),t.string+="'",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(n.getName()),t.string+="'";let i=!1;if(t.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(n))),0===n.getReferences().size||!t.ExecutionContext()||e||i)if(i&&t.ExecutionContext()&&s.push(n),!n.isInitializable()||n.isDefaultValue())t.string+=t.closingTags?"></field>":"/>",t.string+=t.TidyBreak();else switch(n.getType()){case c.SFNode:case c.MFNode:t.PushContainerField(null),t.string+=">",t.string+=t.TidyBreak(),t.IncIndent(),n.toXMLStream(t),t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</field>",t.string+=t.TidyBreak(),t.PopContainerField();break;default:t.string+=t.Space(),t.string+="value='",n.toXMLStream(t),t.string+="'",t.string+=t.closingTags?"></field>":"/>",t.string+=t.TidyBreak()}else t.ExecutionContext()&&s.push(n),t.string+=t.closingTags?"></field>":"/>",t.string+=t.TidyBreak()}if(s.length&&!e){t.string+=t.Indent(),t.string+="<IS>",t.string+=t.TidyBreak(),t.IncIndent();for(const e of s){const n=e.getReferences();for(const i of n)t.string+=t.Indent(),t.string+="<connect",t.string+=t.Space(),t.string+="nodeField='",t.string+=t.XMLEncode(e.getName()),t.string+="'",t.string+=t.Space(),t.string+="protoField='",t.string+=t.XMLEncode(i.getName()),t.string+="'",t.string+=t.closingTags?"></connect>":"/>",t.string+=t.TidyBreak()}t.DecIndent(),t.string+=t.Indent(),t.string+="</IS>",t.string+=t.TidyBreak()}for(const e of a)t.PushContainerField(e),e.toXMLStream(t),t.string+=t.TidyBreak(),t.PopContainerField();if(u)for(const e of u)t.string+="<![CDATA[",t.string+=e,t.string+="]]>",t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="</",t.string+=this.getTypeName(),t.string+=">"}else t.closingTags?(t.string+="></",t.string+=this.getTypeName(),t.string+=">"):t.string+="/>";t.LeaveScope()},toJSONStream:function(t){const e=t.IsSharedNode(this);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this))return t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+=this.getTypeName(),t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@USE",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n),t.string+='"',t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",void t.LeaveScope();t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+=this.getTypeName(),t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),n.length&&(t.AddNode(this),t.string+=t.Indent(),t.string+='"',t.string+="@DEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n),t.string+='"',t.string+=",",t.string+=t.TidyBreak());const i=this.getChangedFields(),o=this.getUserDefinedFields(),r=[];let s=this.getSourceText();if(s&&1!==s.length&&(s=null),i.length){const n=[];for(const o of i){let i=!1;t.ExecutionContext()&&o.getAccessType()===c.inputOutput&&0!==o.getReferences().size&&([...o.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(o))),0===o.getReferences().size||!t.ExecutionContext()||e||i?(i&&r.push(o),o!==s&&n.push(o)):r.push(o)}for(const e of n)if(e.isInitializable()){switch(e.getType()){case c.SFNode:case c.MFNode:t.string+=t.Indent(),t.string+='"',t.string+="-",t.string+=e.getName(),t.string+='"',t.string+=":",t.string+=t.TidySpace(),e.toJSONStream(t);break;default:t.string+=t.Indent(),t.string+='"',t.string+="@",t.string+=e.getName(),t.string+='"',t.string+=":",t.string+=t.TidySpace(),e.toJSONStream(t)}t.string+=",",t.string+=t.TidyBreak()}}if(this.canUserDefinedFields()&&o.length){t.string+=t.Indent(),t.string+='"',t.string+="field",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const n of o){t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@accessType",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.AccessType(n.getAccessType()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@type",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=n.getTypeName(),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n.getName()),t.string+='"';let i=!1;if(t.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(n))),0===n.getReferences().size||!t.ExecutionContext()||e||i)if(i&&t.ExecutionContext()&&r.push(n),!n.isInitializable()||n.isDefaultValue());else switch(t.string+=",",t.string+=t.TidyBreak(),n.getType()){case c.SFNode:t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),n.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]";break;case c.MFNode:t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),n.toJSONStream(t);break;default:t.string+=t.Indent(),t.string+='"',t.string+="@value",t.string+='"',t.string+=":",t.string+=t.TidySpace(),n.toJSONStream(t)}else t.ExecutionContext()&&r.push(n);t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",n!==o.at(-1)&&(t.string+=","),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=",",t.string+=t.TidyBreak()}else;if(s){t.string+=t.Indent(),t.string+='"',t.string+="#sourceText",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();const e=s[0].split("\n");for(let n=0,i=e.length;n<i;++n)t.string+=t.ListIndent(),t.string+='"',t.string+=t.JSONEncode(e[n]),t.string+='"',n!==i-1&&(t.string+=","),t.string+=t.TidyBreak();t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=",",t.string+=t.TidyBreak()}if(r.length&&!e){t.string+=t.Indent(),t.string+='"',t.string+="IS",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="connect",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const e of r){const n=[...e.getReferences()];for(const i of n)t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@nodeField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(e.getName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@protoField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(i.getName()),t.string+='"',t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",e===r.at(-1)&&i===n.at(-1)||(t.string+=","),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak()}t.JSONRemoveComma(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.LeaveScope()},dispose:function(){const t=this.getExecutionContext();if(this.getName()&&t.removeNamedNode(this.getName()),t.isScene()){if(!t.isMainScene()){const e=t.getExecutionContext();for(const t of[...e.getImportedNodes()])try{t.getExportedNode()===this&&e.removeImportedNode(t.getImportedName())}catch(t){}}for(const e of[...t.getExportedNodes()])e.getLocalNode()===this&&t.removeExportedNode(e.getExportedName())}for(const t of new Set(this.getParents()))if(t instanceof ji.SFNode){for(const e of new Set(t.getParents())){if(!(e instanceof ji.MFNode))continue;const n=e.length;e.erase(e.remove(0,n,t.valueOf()),n)}t.setValue(null)}uo.prototype.dispose.call(this)}});const hr=lr;n.set("x_ite/Components/Core/X3DNode",hr);const dr=hr;function pr(t){return Y.call(this,t,dr)}pr.prototype=Object.assign(Object.create(Y.prototype),{constructor:pr,getTypeName:function(){return"NodeTypeArray"}});for(const t of Reflect.ownKeys(pr.prototype))Object.defineProperty(pr.prototype,t,{enumerable:!1});const fr=pr;n.set("x_ite/Configuration/NodeTypeArray",fr);const gr=fr,mr=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),_r=new gr,xr=new gr;let yr=c.X3DBaseNode;const wr={addNodeType:function(t,e){c[t]=++yr,_r.add(t,e),Yi.addNodeTypeName(t);for(const{name:t,accessType:n}of e.prototype[mr])n&c.initializeOnly&&Yi.addFieldName(t)},getNodeTypes:()=>_r,addAbstractNodeType:function(t,e){c[t]=++yr,xr.add(t,e)},getAbstractNodeTypes:()=>xr};n.set("x_ite/Configuration/SupportedNodes",wr);const Sr=wr;function Tr(t){const e=Y.call(this);if(t)for(const e of t){if(!(e instanceof uo))throw new TypeError(`Wrong type in construction of ${this.getTypeName()}.`);this.add(e.getName(),e)}return e}Tr.prototype=Object.assign(Object.create(Y.prototype),{constructor:Tr,getTypeName:function(){return"NamedNodesArray"}});for(const t of Reflect.ownKeys(Tr.prototype))Object.defineProperty(Tr.prototype,t,{enumerable:!1});const br=Tr;n.set("x_ite/Execution/NamedNodesArray",br);const vr=br,Er=Symbol(),Cr=Symbol(),Or=Symbol(),Nr=Symbol();function Fr(t,e,n,i){dr.call(this,t),this[Er]=e,this[Cr]=n,this[Or]=i,this[Nr]=new Set,this[Er]._loadState.addInterest("set_loadState__",this)}Fr.prototype=Object.assign(Object.create(dr.prototype),{constructor:Fr,getInlineNode:function(){return this[Er]},getExportedName:function(){return this[Cr]},getExportedNode:function(){return this[Er].getInternalScene().getExportedNode(this[Cr]).getValue()},getImportedName:function(){return this[Or]},addRoute:function(t,e,n,i){const o={sourceNode:t,sourceField:e,destinationNode:n,destinationField:i};this[Nr].add(o),this[Er].checkLoadState()===c.COMPLETE_STATE&&this.resolveRoute(o)},resolveRoute:function(t){try{const e=t.sourceField,n=t.destinationField;let i=t.sourceNode,o=t.destinationNode;t.real&&t.real.dispose(),i instanceof Fr&&(i=i.getExportedNode()),o instanceof Fr&&(o=o.getExportedNode()),t.real=this.getExecutionContext().addSimpleRoute(i,e,o,n)}catch(t){console.error(t.message)}},deleteRoute:function(t){for(const e of this[Nr])e.real===t&&this[Nr].delete(e)},deleteRoutes:function(){for(const t of this[Nr]){const e=t.real;e&&(delete t.real,this.getExecutionContext().deleteSimpleRoute(e))}},set_loadState__:function(){switch(this[Er].checkLoadState()){case c.NOT_STARTED_STATE:case c.FAILED_STATE:this.deleteRoutes();break;case c.COMPLETE_STATE:this.deleteRoutes();for(const t of this[Nr])this.resolveRoute(t)}},toVRMLStream:function(t){if(!t.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");t.string+=t.Indent(),t.string+="IMPORT",t.string+=t.Space(),t.string+=t.Name(this.getInlineNode()),t.string+=".",t.string+=this.getExportedName(),this.getImportedName()!==this.getExportedName()&&(t.string+=t.Space(),t.string+="AS",t.string+=t.Space(),t.string+=this.getImportedName());try{t.AddRouteNode(this),t.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(e){for(const e of this[Nr]){const n=e.sourceNode,i=e.sourceField,o=e.destinationNode,r=e.destinationField;if(t.ExistsRouteNode(n)&&t.ExistsRouteNode(o)){const e=n instanceof Fr?n.getImportedName():t.Name(n),s=o instanceof Fr?o.getImportedName():t.Name(o);t.string+=t.Break(),t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="ROUTE",t.string+=t.Space(),t.string+=e,t.string+=".",t.string+=i,t.string+=t.Space(),t.string+="TO",t.string+=t.Space(),t.string+=s,t.string+=".",t.string+=r}}}},toXMLStream:function(t){if(!t.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");t.string+=t.Indent(),t.string+="<IMPORT",t.string+=t.Space(),t.string+="inlineDEF='",t.string+=t.XMLEncode(t.Name(this.getInlineNode())),t.string+="'",t.string+=t.Space(),t.string+="importedDEF='",t.string+=t.XMLEncode(this.getExportedName()),t.string+="'",this.getImportedName()!==this.getExportedName()&&(t.string+=t.Space(),t.string+="AS='",t.string+=t.XMLEncode(this.getImportedName()),t.string+="'"),t.string+=t.closingTags?"></IMPORT>":"/>";try{t.AddRouteNode(this),t.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(e){for(const e of this[Nr]){const n=e.sourceNode,i=e.sourceField,o=e.destinationNode,r=e.destinationField;if(t.ExistsRouteNode(n)&&t.ExistsRouteNode(o)){const e=n instanceof Fr?n.getImportedName():t.Name(n),s=o instanceof Fr?o.getImportedName():t.Name(o);t.string+=t.Break(),t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="<ROUTE",t.string+=t.Space(),t.string+="fromNode='",t.string+=t.XMLEncode(e),t.string+="'",t.string+=t.Space(),t.string+="fromField='",t.string+=t.XMLEncode(i),t.string+="'",t.string+=t.Space(),t.string+="toNode='",t.string+=t.XMLEncode(s),t.string+="'",t.string+=t.Space(),t.string+="toField='",t.string+=t.XMLEncode(r),t.string+="'",t.string+=t.closingTags?"></ROUTE>":"/>"}}}},toJSONStream:function(t){if(!t.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toJSONStream: Inline node does not exist.");t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="IMPORT",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@inlineDEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(t.Name(this.getInlineNode())),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@importedDEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(this.getExportedName()),t.string+='"',this.getImportedName()!==this.getExportedName()?(t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@AS",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(this.getImportedName()),t.string+='"',t.string+=t.TidyBreak()):t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}";try{t.AddRouteNode(this),t.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(e){for(const e of this[Nr]){const n=e.sourceNode,i=e.sourceField,o=e.destinationNode,r=e.destinationField;if(t.ExistsRouteNode(n)&&t.ExistsRouteNode(o)){const e=n instanceof Fr?n.getImportedName():t.Name(n),s=o instanceof Fr?o.getImportedName():t.Name(o);t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ROUTE",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@fromNode",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(e),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@fromField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(i),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@toNode",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(s),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@toField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(r),t.string+='"',t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}}}},dispose:function(){this[Er]._loadState.removeInterest("set_loadState__",this),this.deleteRoutes(),dr.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(Fr.prototype))Object.defineProperty(Fr.prototype,t,{enumerable:!1});Object.defineProperties(Fr.prototype,{inlineNode:{get:function(){return wn.get(this[Er])},enumerable:!0},exportedName:{get:function(){return this[Cr]},enumerable:!0},exportedNode:{get:function(){return this[Er].getInternalScene().getExportedNode(this[Cr])},enumerable:!0},importedName:{get:function(){return this[Or]},enumerable:!0}});const Ir=Fr;n.set("x_ite/Execution/X3DImportedNode",Ir);const Mr=Ir;function Dr(t){return Y.call(this,t,Mr)}Dr.prototype=Object.assign(Object.create(Y.prototype),{constructor:Dr,getTypeName:function(){return"ImportedNodesArray"}});for(const t of Reflect.ownKeys(Dr.prototype))Object.defineProperty(Dr.prototype,t,{enumerable:!1});const Rr=Dr;n.set("x_ite/Execution/ImportedNodesArray",Rr);const Vr=Rr,Ar=Symbol(),Pr=Symbol(),Lr=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),Br=Symbol();function Xr(t,e){this[Ar]=e,this[Pr]=new Map([...e.getFields()].map((t=>[t,t.getName()]))),this[Lr]=e.getFieldDefinitions(),this[Br]=null,dr.call(this,t),this.addType(c.X3DPrototypeInstance)}Xr.prototype=Object.assign(Object.create(dr.prototype),{constructor:Xr,create:function(t){return new Xr(t,this[Ar])},getTypeName:function(){return this[Ar].getName()},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},initialize:function(){dr.prototype.initialize.call(this),this.setProtoNode(this[Ar])},construct:function(){this[Br]?.dispose();const t=this[Ar].getProtoDeclaration();if(!t)return this[Br]=new ih(this.getExecutionContext(),this),this[Br].setup(),void(this.isInitialized()&&M.prototype.addEvent.call(this));if(this[Ar].isExternProto)for(const e of t.getUserDefinedFields())try{const t=this.getField(e.getName());if(t.getAccessType()!==e.getAccessType())continue;if(t.getType()!==e.getType())continue;if(!t.isInitializable())continue;if(t.getModificationTime())continue;if(t.hasReferences())continue;if(t.equals(e))continue;t.assign(e)}catch(n){this.addField(t.getFieldDefinitions().get(e.getName()))}this[Br]=new ih(t.getExecutionContext(),this),this.importExternProtos(t.getBody().externprotos),this.importProtos(t.getBody().protos),this.copyRootNodes(t.getBody().rootNodes),this.copyImportedNodes(t.getBody(),t.getBody().getImportedNodes()),this.copyRoutes(t.getBody(),t.getBody().routes),this[Br].setup(),this.isInitialized()&&M.prototype.addEvent.call(this),this[Ar]._updateInstances.removeInterest("construct",this),this[Ar]._updateInstances.addInterest("update",this)},update:function(){const t=this[Pr],e=new Map([...this.getFields()].map((t=>[t.getName(),t])));for(const t of e.values())this.removeField(t.getName());this[Pr]=new Map([...this[Ar].getFields()].map((t=>[t,t.getName()])));for(const t of this.getFieldDefinitions())this.addField(t);for(const n of this[Pr].keys()){const i=t.get(n);if(!i)continue;const o=this.getFields().get(n.getName()),r=e.get(i);r.addParent(this),r.setAccessType(o.getAccessType()),r.setName(o.getName()),this.getPredefinedFields().update(o.getName(),o.getName(),r),this.getFields().update(o.getName(),o.getName(),r),this.isPrivate()||r.addCloneCount(1),e.delete(i),o.dispose()}for(const t of e.values())t.dispose();this.construct()},getExtendedEventHandling:function(){return!1},getProtoNode:function(){return this[Ar]},setProtoNode:function(t){if(t!==this[Ar]){if(this[Ar]){const t=this[Ar];t._name_changed.removeFieldInterest(this._typeName_changed),t._updateInstances.removeInterest("construct",this),t._updateInstances.removeInterest("update",this)}this[Pr]=new Map([...t.getFields()].map((t=>[t,t.getName()]))),this[Lr]=t.getFieldDefinitions()}this[Ar]=t,t._name_changed.addFieldInterest(this._typeName_changed),t.isExternProto?this[Ar].checkLoadState()===c.COMPLETE_STATE?this.construct():(t._updateInstances.addInterest("construct",this),t.requestImmediateLoad().catch(Function.prototype)):this.construct()},getBody:function(){return this[Br]},getInnerNode:function(){const t=this[Br].getRootNodes();if(t.length){const e=t[0];if(e)return e.getValue().getInnerNode()}throw new Error("Root node not available.")},importExternProtos:function(t){const e=this[Br].externprotos;for(const n of t)e.add(n.getName(),n)},importProtos:function(t){const e=this[Br].protos;for(const n of t)e.add(n.getName(),n)},copyRootNodes:function(t){const e=this[Br].getRootNodes();for(const n of t)e.push(n.copy(this))},copyImportedNodes:function(t,e){for(const t of e)try{const e=this[Br].getNamedNode(t.getInlineNode().getName()),n=t.getImportedName(),i=t.getExportedName();this[Br].addImportedNode(e,i,n)}catch(t){console.error("Bad IMPORT specification in copy: ",t)}},copyRoutes:function(t,e){for(const n of e)try{const e=this[Br].getLocalNode(t.getLocalName(n.sourceNode)),i=this[Br].getLocalNode(t.getLocalName(n.destinationNode));this[Br].addRoute(e,n.sourceField,i,n.destinationField)}catch(t){console.error(t)}},toXMLStream:function(t){const e=t.IsSharedNode(this);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this)){t.string+=t.Indent(),t.string+="<ProtoInstance",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.getTypeName()),t.string+="'",t.string+=t.Space(),t.string+="USE='",t.string+=t.XMLEncode(n),t.string+="'";const e=t.ContainerField();return e&&e.getName()!==this.getContainerField()&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(e.getName()),t.string+="'"),t.string+=t.closingTags?"></ProtoInstance>":"/>",void t.LeaveScope()}t.string+=t.Indent(),t.string+="<ProtoInstance",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.getTypeName()),t.string+="'",n.length&&(t.AddNode(this),t.string+=t.Space(),t.string+="DEF='",t.string+=t.XMLEncode(n),t.string+="'");const i=t.ContainerField();i&&i.getName()!==this.getContainerField()&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(i.getName()),t.string+="'");const o=this.getChangedFields();if(0===o.length)t.string+=t.closingTags?"></ProtoInstance>":"/>";else{t.string+=">",t.string+=t.TidyBreak(),t.IncIndent();const n=[];for(const i of o){let o=!1;if(t.ExecutionContext()&&i.getAccessType()===c.inputOutput&&0!==i.getReferences().size&&([...i.getReferences()].some((t=>t.isInitializable()))||(o=!this.isDefaultValue(i))),0===i.getReferences().size||!t.ExecutionContext()||e||o)switch(o&&n.push(i),i.getType()){case c.MFNode:t.string+=t.Indent(),t.string+="<fieldValue",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(i.getName()),t.string+="'",0===i.length?(t.string+=t.closingTags?"></fieldValue>":"/>",t.string+=t.TidyBreak()):(t.PushContainerField(i),t.string+=">",t.string+=t.TidyBreak(),t.IncIndent(),i.toXMLStream(t),t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</fieldValue>",t.string+=t.TidyBreak(),t.PopContainerField());break;case c.SFNode:if(null!==i.getValue()){t.PushContainerField(null),t.string+=t.Indent(),t.string+="<fieldValue",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(i.getName()),t.string+="'",t.string+=">",t.string+=t.TidyBreak(),t.IncIndent(),i.toXMLStream(t),t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</fieldValue>",t.string+=t.TidyBreak(),t.PopContainerField();break}default:t.string+=t.Indent(),t.string+="<fieldValue",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(i.getName()),t.string+="'",t.string+=t.Space(),t.string+="value='",i.toXMLStream(t),t.string+="'",t.string+=t.closingTags?"></fieldValue>":"/>",t.string+=t.TidyBreak()}else n.push(i)}if(n.length&&!e){t.string+=t.Indent(),t.string+="<IS>",t.string+=t.TidyBreak(),t.IncIndent();for(const e of n){const n=e.getReferences();for(const i of n)t.string+=t.Indent(),t.string+="<connect",t.string+=t.Space(),t.string+="nodeField='",t.string+=t.XMLEncode(e.getName()),t.string+="'",t.string+=t.Space(),t.string+="protoField='",t.string+=t.XMLEncode(i.getName()),t.string+="'",t.string+=t.closingTags?"></connect>":"/>",t.string+=t.TidyBreak()}t.DecIndent(),t.string+=t.Indent(),t.string+="</IS>",t.string+=t.TidyBreak()}t.DecIndent(),t.string+=t.Indent(),t.string+="</ProtoInstance>"}t.LeaveScope()},toJSONStream:function(t){const e=t.IsSharedNode(this);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this))return t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ProtoInstance",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(this.getTypeName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@USE",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n),t.string+='"',t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",void t.LeaveScope();t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ProtoInstance",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),n.length&&(t.AddNode(this),t.string+=t.Indent(),t.string+='"',t.string+="@DEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n),t.string+='"',t.string+=",",t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(this.getTypeName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak();const i=this.getChangedFields(),o=[];if(i.length){t.string+=t.Indent(),t.string+='"',t.string+="fieldValue",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();const n=[];for(const r of i){let i=!1;t.ExecutionContext()&&r.getAccessType()===c.inputOutput&&0!==r.getReferences().size&&([...r.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(r))),0===r.getReferences().size||!t.ExecutionContext()||e||i?(i&&o.push(r),n.push(r)):o.push(r)}for(const e of n){switch(e.getType()){case c.SFNode:t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(e.getName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),e.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}";break;case c.MFNode:t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(e.getName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),e.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}";break;default:t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(e.getName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@value",t.string+='"',t.string+=":",t.string+=t.TidySpace(),e.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}e!==n.at(-1)&&(t.string+=","),t.string+=t.TidyBreak()}if(t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=",",t.string+=t.TidyBreak(),o.length&&!e){t.string+=t.Indent(),t.string+='"',t.string+="IS",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="connect",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const e of o){const n=[...e.getReferences()];for(const i of n)t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@nodeField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(e.getName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@protoField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(i.getName()),t.string+='"',t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",e===o.at(-1)&&i===n.at(-1)||(t.string+=","),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=",",t.string+=t.TidyBreak()}}t.JSONRemoveComma(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.LeaveScope()},dispose:function(){this[Ar]._name_changed.removeFieldInterest(this._typeName_changed),this[Ar]._updateInstances.removeInterest("construct",this),this[Ar]._updateInstances.removeInterest("update",this),this[Br]?.dispose(),dr.prototype.dispose.call(this)}});const Ur=Xr;n.set("x_ite/Components/Core/X3DPrototypeInstance",Ur);const kr=Ur;function zr(t){uo.call(this,t),this.addType(c.X3DProtoDeclarationNode),this.addChildObjects("updateInstances",new ji.SFTime)}Sr.addAbstractNodeType("X3DProtoDeclarationNode",zr),zr.prototype=Object.assign(Object.create(uo.prototype),{constructor:zr,canUserDefinedFields:function(){return!0},createInstance:function(t,e=!0){if(!1===e)return new kr(t,this);{const e=new kr(t,this);return e.setup(),wn.get(e)}},newInstance:function(){return this.createInstance(this.getExecutionContext())},requestUpdateInstances:function(){this._updateInstances=this.getBrowser().getCurrentTime()},updateInstances:function(){this._updateInstances.processEvent()}});for(const t of Reflect.ownKeys(zr.prototype))Object.defineProperty(zr.prototype,t,{enumerable:!1});const jr=zr;n.set("x_ite/Prototype/X3DProtoDeclarationNode",jr);const Gr=jr;Sr.addAbstractNodeType("X3DProtoDeclaration",qr);const Hr=Symbol();function qr(t){Gr.call(this,t),this.addType(c.X3DProtoDeclaration),this[Hr]=new ih(t,this),this[Hr].setLive(!1),this.setLive(!1)}qr.prototype=Object.assign(Object.create(Gr.prototype),{constructor:qr,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode)]),getTypeName:function(){return"X3DProtoDeclaration"},initialize:function(){Gr.prototype.initialize.call(this),this[Hr].setup()},getProtoDeclaration:function(){return this},getBody:function(){return this[Hr]},canUserDefinedFields:function(){return!0},toVRMLStream:function(t){t.string+=t.Indent(),t.string+="PROTO",t.string+=t.Space(),t.string+=this.getName(),t.string+=t.TidySpace(),t.string+="[",t.EnterScope();const e=this.getUserDefinedFields();if(0===e.length)t.string+=t.TidySpace();else{let n=0,i=0;for(const o of e)n=Math.max(n,o.getTypeName().length),i=Math.max(i,t.AccessType(o.getAccessType()).length);t.string+=t.TidyBreak(),t.IncIndent();for(const o of e)this.toVRMLStreamUserDefinedField(t,o,n,i),t.string+=t.Break();t.DecIndent(),t.string+=t.Indent()}t.LeaveScope(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.IncIndent(),this[Hr].toVRMLStream(t),t.DecIndent(),t.string+=t.Indent(),t.string+="}"},toVRMLStreamUserDefinedField:function(t,e,n,i){t.string+=t.Indent(),t.string+=t.AccessType(e.getAccessType()).padEnd(i," "),t.string+=t.Space(),t.string+=e.getTypeName().padEnd(n," "),t.string+=t.Space(),t.string+=e.getName(),e.isInitializable()&&(t.string+=t.Space(),e.toVRMLStream(t))},toXMLStream:function(t){t.string+=t.Indent(),t.string+="<ProtoDeclare",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.getName()),t.string+="'",t.string+=">",t.string+=t.TidyBreak(),t.EnterScope();const e=this.getUserDefinedFields();if(0!==e.length){t.IncIndent(),t.string+=t.Indent(),t.string+="<ProtoInterface>",t.string+=t.TidyBreak(),t.IncIndent();for(const n of e)if(t.string+=t.Indent(),t.string+="<field",t.string+=t.Space(),t.string+="accessType='",t.string+=t.AccessType(n.getAccessType()),t.string+="'",t.string+=t.Space(),t.string+="type='",t.string+=n.getTypeName(),t.string+="'",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(n.getName()),t.string+="'",n.isDefaultValue())t.string+=t.closingTags?"></field>":"/>",t.string+=t.TidyBreak();else switch(n.getType()){case c.SFNode:case c.MFNode:t.PushContainerField(n),t.string+=t.TidyBreak(),t.IncIndent(),n.toXMLStream(t),t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</field>",t.string+=t.TidyBreak(),t.PopContainerField();break;default:t.string+=t.Space(),t.string+="value='",n.toXMLStream(t),t.string+="'",t.string+=t.closingTags?"></field>":"/>",t.string+=t.TidyBreak()}t.DecIndent(),t.string+=t.Indent(),t.string+="</ProtoInterface>",t.string+=t.TidyBreak(),t.DecIndent()}t.LeaveScope(),t.IncIndent(),t.string+=t.Indent(),t.string+="<ProtoBody>",t.string+=t.TidyBreak(),t.IncIndent(),this[Hr].toXMLStream(t),t.DecIndent(),t.string+=t.Indent(),t.string+="</ProtoBody>",t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</ProtoDeclare>"},toJSONStream:function(t){t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ProtoDeclare",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+='"',t.string+=t.JSONEncode(this.getName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="ProtoInterface",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.EnterScope();const e=this.getUserDefinedFields();if(e.length){t.string+=t.Indent(),t.string+='"',t.string+="field",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const n of e){if(t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@accessType",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.AccessType(n.getAccessType()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@type",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=n.getTypeName(),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n.getName()),t.string+='"',n.isDefaultValue())t.string+=t.TidyBreak();else switch(t.string+=",",t.string+=t.TidyBreak(),n.getType()){case c.SFNode:t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),n.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak();break;case c.MFNode:t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),n.toJSONStream(t),t.string+=t.TidyBreak();break;default:t.string+=t.Indent(),t.string+='"',t.string+="@value",t.string+='"',t.string+=":",t.string+=t.TidySpace(),n.toJSONStream(t),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",n!==e.at(-1)&&(t.string+=","),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]"}t.string+=t.DecIndent(),t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="}",t.string+=",",t.string+=t.TidyBreak(),t.LeaveScope(),t.string+=t.Indent(),t.string+='"',t.string+="ProtoBody",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),this[Hr].toJSONStream(t),t.JSONRemoveComma(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(qr.prototype))Object.defineProperty(qr.prototype,t,{enumerable:!1});Object.defineProperties(qr.prototype,{name:{get:qr.prototype.getName,enumerable:!0},fields:{get:qr.prototype.getFieldDefinitions,enumerable:!0},isExternProto:{value:!1,enumerable:!0}});const Yr=qr;n.set("x_ite/Prototype/X3DProtoDeclaration",Yr);const Wr=Yr,Kr=Symbol(),Jr=Symbol(),Zr=Symbol(),Qr=Symbol();function $r(t){this.addType(c.X3DUrlObject),this.addChildObjects("loadState",new ji.SFInt32(c.NOT_STARTED_STATE),"loadData",new ji.SFTime),this[Kr]=!0,this[Jr]=Date.now()}$r.prototype={constructor:$r,initialize:function(){this.getLive().addInterest("set_live__",this),this._load.addInterest("set_load__",this),this._url.addInterest("set_url__",this),this._loadData.addInterest("loadData",this),this._autoRefresh.addInterest("set_autoRefresh__",this),this._autoRefreshTimeLimit.addInterest("set_autoRefresh__",this)},setLoadState:function(t,e=!0){if(this._loadState=t,t===c.COMPLETE_STATE&&(this[Zr]=Date.now(),this.setAutoRefreshTimer(this._autoRefresh.getValue())),e)switch(t){case c.NOT_STARTED_STATE:break;case c.IN_PROGRESS_STATE:this.getScene().addLoadingObject(this);break;case c.COMPLETE_STATE:case c.FAILED_STATE:this.getScene().removeLoadingObject(this)}},checkLoadState:function(){return this._loadState.getValue()},getLoadState:function(){return this._loadState},setCache:function(t){this[Kr]=t},getCache:function(){return this[Kr]&&this.getBrowser().getBrowserOption("Cache")},requestImmediateLoad:function(t=!0){return new Promise(((e,n)=>{const i=()=>{const t=Symbol();this._loadState.addFieldCallback(t,(()=>{switch(this.checkLoadState()){case c.COMPLETE_STATE:this._loadState.removeFieldCallback(t),e();break;case c.FAILED_STATE:this._loadState.removeFieldCallback(t),n()}}))},o=this.checkLoadState();o!==c.COMPLETE_STATE?o!==c.IN_PROGRESS_STATE?this._load.getValue()?0!==this._url.length?(this.setCache(t),this.setLoadState(c.IN_PROGRESS_STATE),this.isInitialized()?this._loadData=this.getBrowser().getCurrentTime():this.loadData(),i()):e():n():i():e()}))},loadNow:function(){return this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad()},loadData:function(){},requestUnload:function(){const t=this.checkLoadState();t!==c.NOT_STARTED_STATE&&t!==c.FAILED_STATE&&(this.setLoadState(c.NOT_STARTED_STATE),this.unloadData())},unloadNow:function(){this.requestUnload()},unloadData:function(){},setAutoRefreshTimer:function(t){if(clearTimeout(this[Qr]),this._autoRefresh.getValue()<=0)return;const e=this._autoRefreshTimeLimit.getValue();0!==e&&(Date.now()-this[Jr])/1e3>e-t||(this[Qr]=setTimeout(this.performAutoRefresh.bind(this),1e3*t))},performAutoRefresh:function(){this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad(!1).catch(Function.prototype)},set_live__:function(){this.getLive().getValue()?this.set_autoRefresh__():clearTimeout(this[Qr])},set_load__:function(){this._load.getValue()?this.requestImmediateLoad().catch(Function.prototype):this.requestUnload()},set_url__:function(){this._load.getValue()&&(this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad().catch(Function.prototype))},set_autoRefresh__:function(){if(this.checkLoadState()!==c.COMPLETE_STATE)return;const t=(Date.now()-this[Zr])/1e3,e=this._autoRefresh.getValue();let n=e-t;n<0&&(n=Math.ceil(t/e)*e-t),this.setAutoRefreshTimer(n)},dispose:function(){}};const ts=$r;n.set("x_ite/Components/Networking/X3DUrlObject",ts);const es=ts;var ns=i(532);function is(t){this.scene=t,this.executionContexts=[t],this.prototypes=[]}is.prototype={constructor:is,getBrowser:function(){return this.scene.getBrowser()},getScene:function(){return this.scene},getExecutionContext:function(){return this.executionContexts.at(-1)},pushExecutionContext:function(t){return this.executionContexts.push(t)},popExecutionContext:function(){this.executionContexts.pop()},getPrototype:function(){return this.prototypes.at(-1)},pushPrototype:function(t){return this.prototypes.push(t)},popPrototype:function(){this.prototypes.pop()},isInsideProtoDefinition:function(){return!!this.prototypes.length},loadComponents:function(){const t=this.getBrowser(),e=this.getScene();return Promise.all([t.loadComponents(e.getProfile()||t.getProfile("Full")),t.loadComponents(e.getComponents())])},setUnits:function(t){t?delete this.fromUnit:this.fromUnit=function(t,e){return e}},fromUnit:function(t,e){return this.scene.fromUnit(t,e)},convertColor:function(t,e="white"){const n=ns("<div></div>").hide().css("color",e).appendTo(ns("body")),i=ns("<div></div>").css("color",t).appendTo(n),o=window.getComputedStyle(i[0]).color.replace(/^rgba?\(|\)$/g,"").split(/[\s,]+/).map((t=>parseFloat(t)));return n.remove(),o[0]/=255,o[1]/=255,o[2]/=255,"number"!=typeof o[3]&&(o[3]=1),o},sanitizeName:function(t=""){return t=(t=(t=(t=t.replace(/^[\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f]*/,"")).replace(/[\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f]+/g,"-")).trim().replace(/[\s_-]+/g,"-")).replace(/^-+|-+$/g,"")}};const os=is;n.set("x_ite/Parser/X3DParser",os);const rs=os;function ss(t){return this.lastIndex=t.lastIndex,t.result=this.exec(t.input),!!t.result&&(t.lastIndex=this.lastIndex,!0)}function as(t){const e=t.lastIndex,n=this.parse(t);return t.lastIndex=e,n}const us=function(t){for(const e of Object.values(t))e.parse=ss,e.lookahead=as;return t};n.set("x_ite/Parser/Expressions",us);const cs=us,ls=cs({Whitespaces:/([\x20\n,\t\r]+)/gy,Comment:/#(.*?)(?=[\n\r])/gy,Break:/\r?\n/g,Header:/^#(VRML|X3D) V(.*?) (utf8)(?:[ \t]+(.*?))?[ \t]*[\n\r]/gy,AS:/AS/gy,COMPONENT:/COMPONENT/gy,DEF:/DEF/gy,EXPORT:/EXPORT/gy,EXTERNPROTO:/EXTERNPROTO/gy,FALSE:/FALSE|false/gy,IMPORT:/IMPORT/gy,IS:/IS/gy,META:/META/gy,NULL:/NULL/gy,TRUE:/TRUE|true/gy,PROFILE:/PROFILE/gy,PROTO:/PROTO/gy,ROUTE:/ROUTE/gy,TO:/TO/gy,UNIT:/UNIT/gy,USE:/USE/gy,OpenBrace:/\{/gy,CloseBrace:/\}/gy,OpenBracket:/\[/gy,CloseBracket:/\]/gy,Period:/\./gy,Colon:/\:/gy,Id:/([^\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f]{1}[^\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f]*)/gy,ComponentNameId:/([^\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f\x3a]{1}[^\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f\x3a]*)/gy,initializeOnly:/initializeOnly/gy,inputOnly:/inputOnly/gy,outputOnly:/outputOnly/gy,inputOutput:/inputOutput/gy,field:/field/gy,eventIn:/eventIn/gy,eventOut:/eventOut/gy,exposedField:/exposedField/gy,FieldType:/(MFBool|MFColorRGBA|MFColor|MFDouble|MFFloat|MFImage|MFInt32|MFMatrix3d|MFMatrix3f|MFMatrix4d|MFMatrix4f|MFNode|MFRotation|MFString|MFTime|MFVec2d|MFVec2f|MFVec3d|MFVec3f|MFVec4d|MFVec4f|SFBool|SFColorRGBA|SFColor|SFDouble|SFFloat|SFImage|SFInt32|SFMatrix3d|SFMatrix3f|SFMatrix4d|SFMatrix4f|SFNode|SFRotation|SFString|SFTime|SFVec2d|SFVec2f|SFVec3d|SFVec3f|SFVec4d|SFVec4f)/gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,string:/"((?:[^\\"]|\\\\|\\")*)"/gy,CONSTANTS:/([+-]?)\b(NAN|INFINITY|INF|PI|PI2|PI1_4|PI2_4|PI3_4|PI4_4|PI5_4|PI6_4|PI7_4|PI8_4|PI1_2|PI2_2|PI3_2|PI4_2|PI1_3|PI2_3|PI3_3|PI4_3|PI5_3|PI6_3|SQRT1_2|SQRT2)\b/giy,HTMLColor:/([a-zA-Z]+|0[xX][\da-fA-F]+|rgba?\(.*?\))/gy});function hs(t){rs.call(this,t)}hs.prototype=Object.assign(Object.create(rs.prototype),{constructor:hs,accessTypes:{field:c.initializeOnly,eventIn:c.inputOnly,eventOut:c.outputOnly,exposedField:c.inputOutput,initializeOnly:c.initializeOnly,inputOnly:c.inputOnly,outputOnly:c.outputOnly,inputOutput:c.inputOutput},SFBool:new ji.SFBool,SFColor:new ji.SFColor,SFColorRGBA:new ji.SFColorRGBA,SFDouble:new ji.SFDouble,SFFloat:new ji.SFFloat,SFImage:new ji.SFImage,SFInt32:new ji.SFInt32,SFMatrix3f:new ji.SFMatrix3f,SFMatrix3d:new ji.SFMatrix3d,SFMatrix4f:new ji.SFMatrix4f,SFMatrix4d:new ji.SFMatrix4d,SFNode:new ji.SFNode,SFRotation:new ji.SFRotation,SFString:new ji.SFString,SFTime:new ji.SFTime,SFVec2d:new ji.SFVec2d,SFVec2f:new ji.SFVec2f,SFVec3d:new ji.SFVec3d,SFVec3f:new ji.SFVec3f,SFVec4d:new ji.SFVec4d,SFVec4f:new ji.SFVec4f,MFBool:new ji.MFBool,MFColor:new ji.MFColor,MFColorRGBA:new ji.MFColorRGBA,MFDouble:new ji.MFDouble,MFFloat:new ji.MFFloat,MFImage:new ji.MFImage,MFInt32:new ji.MFInt32,MFMatrix3d:new ji.MFMatrix3d,MFMatrix3f:new ji.MFMatrix3f,MFMatrix4d:new ji.MFMatrix4d,MFMatrix4f:new ji.MFMatrix4f,MFNode:new ji.MFNode,MFRotation:new ji.MFRotation,MFString:new ji.MFString,MFTime:new ji.MFTime,MFVec2d:new ji.MFVec2d,MFVec2f:new ji.MFVec2f,MFVec3d:new ji.MFVec3d,MFVec3f:new ji.MFVec3f,MFVec4d:new ji.MFVec4d,MFVec4f:new ji.MFVec4f,CONSTANTS:{NAN:Number.NaN,INFINITY:Number.POSITIVE_INFINITY,INF:Number.POSITIVE_INFINITY,PI:Math.PI,PI2:2*Math.PI,PI1_4:1*Math.PI/4,PI2_4:2*Math.PI/4,PI3_4:3*Math.PI/4,PI4_4:4*Math.PI/4,PI5_4:5*Math.PI/4,PI6_4:6*Math.PI/4,PI7_4:7*Math.PI/4,PI8_4:8*Math.PI/4,PI1_2:1*Math.PI/2,PI2_2:2*Math.PI/2,PI3_2:3*Math.PI/2,PI4_2:4*Math.PI/2,PI1_3:1*Math.PI/3,PI2_3:2*Math.PI/3,PI3_3:3*Math.PI/3,PI4_3:4*Math.PI/3,PI5_3:5*Math.PI/3,PI6_3:6*Math.PI/3,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2},getEncoding:function(){return"STRING"},isValid:function(){return"string"==typeof this.input&&!!this.input.match(/^(?:#X3D|#VRML|(?:[\x20\n,\t\r]*|#.*?[\r\n])*(PROFILE|COMPONENT|META|UNIT|EXTERNPROTO|PROTO|DEF|NULL|IMPORT|EXPORT|ROUTE|\w+(?:[\x20\n,\t\r]*|#.*?[\r\n])\{|$))/)},setInput:function(t){this.input=t,this.lineNumber=1,this.lastIndex=0},parseIntoScene:function(t,e){try{this.success=t,this.error=e,this.getScene().setEncoding("VRML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.x3dScene()}catch(e){throw new Error(this.getError(e))}},exception:function(t){if(this.getBrowser().isStrict())throw new Error(t);console.warn(t)},getError:function(t){var e=t.message,n=this.getLine(),i=this.getLastLine(),o=this.getLastLine(),r=i.length-n.length+1;return i.length>80&&(i=i.substr(r-40,80),o="",r=40),"\n********************************************************************************\nParser error at line "+this.lineNumber+":"+r+"\nin '"+this.getExecutionContext().getWorldURL()+"'\n\n"+o+"\n"+i+"\n"+Array(r).join(" ")+"^\n"+e+"\n********************************************************************************\n"},getLine:function(){for(var t=this.input,e=this.lastIndex,n="";e<t.length&&"\n"!==t[e]&&"\r"!==t[e];)n+=t[e++];return this.lastIndex=e,n},getLastLine:function(){var t=this.input,e=this.lastIndex,n="";for(e<t.length&&("\n"!==t[e]||"\r"!==t[e])&&--e;e>=0&&"\n"!==t[e]&&"\r"!==t[e];)n=t[e--]+n;return this.lastIndex=e,n},comments:function(){for(;this.comment(););},comment:function(){return!!this.whitespaces()||ls.Comment.parse(this)},whitespaces:function(){return!!ls.Whitespaces.parse(this)&&(this.lines(this.result[1]),!0)},lines:function(t){var e=t.match(ls.Break);e&&(this.lineNumber+=e.length)},x3dScene:function(){const t=["Core","EnvironmentalEffects","EnvironmentalSensor","Geometry3D","Grouping","Interpolation","Lighting","Navigation","Networking","PointingDeviceSensor","Rendering","Scripting","Shape","Sound","Text","Texturing","Time"];return function(){if(this.headerStatement(),this.profileStatement(),this.componentStatements(),this.unitStatements(),this.metaStatements(),"2.0"===this.getScene().getSpecificationVersion()){this.getScene().setProfile(this.getBrowser().getProfile("Core"));for(const e of t)this.getScene().addComponent(this.getBrowser().getComponent(e))}if(this.success)this.loadComponents().then((()=>{try{if(this.statements(this.getExecutionContext().rootNodes),this.lastIndex<this.input.length)throw new Error("Unknown statement.");this.success(this.getScene())}catch(t){console.error(t),this.error(new Error(this.getError(t)))}})).catch(this.error.bind(this));else if(this.statements(this.getExecutionContext().rootNodes),this.lastIndex<this.input.length)throw new Error("Unknown statement.")}}(),headerStatement:function(){ls.Header.lastIndex=0;var t=ls.Header.exec(this.input);return!!t&&(this.getScene().setSpecificationVersion(t[2]),this.getScene().setEncoding("VRML"),!0)},profileStatement:function(){if(this.comments(),ls.PROFILE.parse(this)){if(this.profileNameId()){var t=this.getBrowser().getProfile(this.result[1]);return void this.getScene().setProfile(t)}throw new Error("Expected a profile name.")}},componentStatements:function(){for(var t=this.componentStatement();t;)this.getScene().addComponent(t),t=this.componentStatement()},componentStatement:function(){if(this.comments(),ls.COMPONENT.parse(this)){if(this.componentNameId()){var t=this.result[1];if(this.comments(),ls.Colon.parse(this)){if(this.componentSupportLevel()){var e=this.value;return this.getBrowser().getComponent(t,e)}throw new Error("Expected a component support level.")}throw new Error("Expected a ':' after component name.")}throw new Error("Expected a component name.")}return null},componentSupportLevel:function(){return this.int32()},unitStatements:function(){for(;this.unitStatement(););},unitStatement:function(){if(this.comments(),ls.UNIT.parse(this)){if(this.categoryNameId()){var t=this.result[1];if(this.unitNameId()){var e=this.result[1];if(this.unitConversionFactor()){var n=this.value;try{return this.getScene().updateUnit(t,e,n),!0}catch(t){return console.log(t.message),!0}}throw new Error("Expected unit conversion factor.")}throw new Error("Expected unit name identifier.")}throw new Error("Expected category name identifier after UNIT statement.")}return!1},unitConversionFactor:function(){return this.double()},metaStatements:function(){for(;this.metaStatement(););},metaStatement:function(){if(this.comments(),ls.META.parse(this)){if(this.metakey()){var t=this.value;if(this.metavalue()){var e=this.value;return this.getScene().addMetaData(t,e),!0}throw new Error("Expected metadata value.")}throw new Error("Expected metadata key.")}return!1},metakey:function(){return this.string()},metavalue:function(){return this.string()},exportStatement:function(){if(this.comments(),ls.EXPORT.parse(this)){if(this.nodeNameId()){var t=this.result[1],e="";this.comments();var n=this.getScene().getLocalNode(t);if(ls.AS.parse(this)){if(!this.exportedNodeNameId())throw new Error("No name given after AS.");e=this.result[1]}else e=t;if(this.getScene()===this.getExecutionContext())return this.getScene().updateExportedNode(e,n),!0;throw new Error("Export statement not allowed here.")}throw new Error("No name given after EXPORT.")}return!1},importStatement:function(){if(this.comments(),ls.IMPORT.parse(this)){if(this.nodeNameId()){var t=this.result[1],e=this.getExecutionContext().getNamedNode(t);if(this.comments(),ls.Period.parse(this)){if(this.exportedNodeNameId()){var n=this.result[1],i=n;if(this.comments(),ls.AS.parse(this)){if(!this.nodeNameId())throw new Error("No name given after AS.");i=this.result[1]}return this.getExecutionContext().updateImportedNode(e,n,i),!0}throw new Error("Expected exported node name.")}throw new Error("Expected a '.' after exported node name.")}throw new Error("No name given after IMPORT statement.")}return!1},statements:function(t){for(;this.statement(t););},statement:function(t){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.importStatement())return!0;if(this.exportStatement())return!0;var e=this.nodeStatement();return!1!==e&&(t.push(e),!0)},nodeStatement:function(){if(this.comments(),ls.DEF.parse(this)){if(this.nodeNameId())return this.node(this.result[1]);throw new Error("No name given after DEF.")}if(ls.USE.parse(this)){if(this.nodeNameId())return this.getExecutionContext().getNamedNode(this.result[1]).getValue();throw new Error("No name given after USE.")}return ls.NULL.parse(this)?null:this.node("")},protoStatement:function(){return!!this.proto()||!!this.externproto()},protoStatements:function(){for(;this.protoStatement(););},proto:function(){if(this.comments(),ls.PROTO.parse(this)){if(this.nodeTypeId()){var t=this.result[1];if(this.comments(),ls.OpenBracket.parse(this)){var e=this.interfaceDeclarations();if(this.comments(),ls.CloseBracket.parse(this)){if(this.comments(),ls.OpenBrace.parse(this)){for(var n=new Wr(this.getExecutionContext()),i=0,o=e.length;i<o;++i){var r=e[i];n.addUserDefinedField(r.getAccessType(),r.getName(),r)}if(this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.protoBody(n.getBody().rootNodes),this.popExecutionContext(),this.popPrototype(),this.comments(),ls.CloseBrace.parse(this)){n.setup();try{const e=this.getExecutionContext().getProtoDeclaration(t);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(t),e)}catch(t){}return this.getExecutionContext().updateProtoDeclaration(t,n),!0}throw new Error("Expected a '}' at the end of PROTO body.")}throw new Error("Expected a '{' at the beginning of PROTO body.")}throw new Error("Expected a ']' at the end of PROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of PROTO interface declaration.")}throw new Error("Invalid PROTO definition name.")}return!1},protoBody:function(t){this.protoStatements();const e=this.rootNodeStatement();!1!==e&&t.push(e),this.statements(t)},rootNodeStatement:function(){if(this.comments(),ls.DEF.parse(this)){if(this.nodeNameId()){var t=this.result[0];if(!1!==(e=this.node(t)))return e;throw new Error("Expected node type name after DEF.")}throw new Error("No name given after DEF.")}var e;return!1!==(e=this.node(""))&&e},interfaceDeclarations:function(){for(var t=[],e=this.interfaceDeclaration();e;)t.push(e),e=this.interfaceDeclaration();return t},restrictedInterfaceDeclaration:function(){if(this.comments(),ls.inputOnly.parse(this)||ls.eventIn.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOnlyId()){var e=this.result[1];return(n=this[t].create()).setAccessType(c.inputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(ls.outputOnly.parse(this)||ls.eventOut.parse(this)){if(this.fieldType()){t=this.result[1];if(this.outputOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(c.outputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(ls.initializeOnly.parse(this)||ls.field.parse(this)){if(this.fieldType()){t=this.result[1];if(this.initializeOnlyId()){e=this.result[1];var n=this[t].create();if(this.fieldValue(n))return n.setAccessType(c.initializeOnly),n.setName(e),n;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},interfaceDeclaration:function(){if(n=this.restrictedInterfaceDeclaration())return n;if(this.comments(),ls.inputOutput.parse(this)||ls.exposedField.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOutputId()){var e=this.result[1],n=this[t].create();if(this.fieldValue(n))return n.setAccessType(c.inputOutput),n.setName(e),n;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},externproto:function(){if(this.comments(),ls.EXTERNPROTO.parse(this)){if(this.nodeTypeId()){var t=this.result[1];if(this.comments(),ls.OpenBracket.parse(this)){var e=this.externInterfaceDeclarations();if(this.comments(),ls.CloseBracket.parse(this)){if(this.URLList(this.MFString)){for(var n=new Ml(this.getExecutionContext(),this.MFString),i=0,o=e.length;i<o;++i){var r=e[i];n.addUserDefinedField(r.getAccessType(),r.getName(),r)}n.setup();try{const e=this.getExecutionContext().getExternProtoDeclaration(t);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(t),e)}catch(t){}return this.getExecutionContext().updateExternProtoDeclaration(t,n),!0}throw new Error("Expected a URL list after EXTERNPROTO interface declaration '"+t+"'.")}throw new Error("Expected a ']' at the end of EXTERNPROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of EXTERNPROTO interface declaration.")}throw new Error("Invalid EXTERNPROTO definition name.")}return!1},externInterfaceDeclarations:function(){for(var t=[],e=this.externInterfaceDeclaration();e;)t.push(e),e=this.externInterfaceDeclaration();return t},externInterfaceDeclaration:function(){if(this.comments(),ls.inputOnly.parse(this)||ls.eventIn.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOnlyId()){var e=this.result[1];return(n=this[t].create()).setAccessType(c.inputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(ls.outputOnly.parse(this)||ls.eventOut.parse(this)){if(this.fieldType()){t=this.result[1];if(this.outputOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(c.outputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(ls.initializeOnly.parse(this)||ls.field.parse(this)){if(this.fieldType()){t=this.result[1];if(this.initializeOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(c.initializeOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(ls.inputOutput.parse(this)||ls.exposedField.parse(this)){if(this.fieldType()){t=this.result[1];if(this.inputOutputId()){var n;e=this.result[1];return(n=this[t].create()).setAccessType(c.inputOutput),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},URLList:function(t){return this.mfstringValue(t)},routeStatement:function(){if(this.comments(),ls.ROUTE.parse(this)){if(this.nodeNameId()){var t=this.result[1],e=this.getExecutionContext().getLocalNode(t);if(this.comments(),ls.Period.parse(this)){if(this.outputOnlyId()){var n=this.result[1];if(this.comments(),ls.TO.parse(this)){if(this.nodeNameId()){var i=this.result[1],o=this.getExecutionContext().getLocalNode(i);if(this.comments(),ls.Period.parse(this)){if(this.inputOnlyId())try{var r=this.result[1];return this.getExecutionContext().addRoute(e,n,o,r),!0}catch(t){return this.exception(t.message),!0}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}throw new Error("Bad ROUTE specification: Expected a 'TO'.")}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}return!1},node:function(t){if(this.nodeTypeId()){var e=this.result[1],n=this.getExecutionContext().createNode(e,!1);if(!n&&!(n=this.getExecutionContext().createProto(e,!1)))throw new Error("Unknown node type or proto '"+e+"', you probably have insufficient component/profile statements, and/or an inappropriate specification version.");if(t.length){try{var i=this.getExecutionContext().getNamedNode(t);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(t),i)}catch(t){}this.getExecutionContext().updateNamedNode(t,n)}if(this.comments(),ls.OpenBrace.parse(this)){if(n.canUserDefinedFields()?this.scriptBody(n):this.nodeBody(n),this.comments(),ls.CloseBrace.parse(this))return this.isInsideProtoDefinition()||n.setup(),n;throw new Error("Expected '}' at the end of node body.")}throw new Error("Expected '{' at the beginning of node body.")}return!1},scriptBody:function(t){for(;this.scriptBodyElement(t););},scriptBodyElement:function(t){var e=this.lastIndex,n=this.lineNumber;if(this.Id()){var i=this.accessTypes[this.result[1]];if(i&&this.fieldType()){var o=this.result[1];if(this.Id()){var r=this.result[1];if(this.comments(),ls.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){var s=this.result[1];try{var a=this.getPrototype().getField(s)}catch(t){return this.exception("No such event or field '"+s+"' inside PROTO "+this.getPrototype().getName()+" interface declaration."),!0}var u=this[o];if(u.getType()===a.getType()){if(a.isReference(i)){try{i===(l=t.getField(r)).getAccessType()&&a.getType()===l.getType()||(l=this.createUserDefinedField(t,i,r,u))}catch(e){var l=this.createUserDefinedField(t,i,r,u)}return l.addReference(a),!0}throw new Error("Field '"+r+"' and '"+a.getName()+"' in PROTO '"+this.getPrototype().getName()+"' are incompatible as an IS mapping.")}throw new Error("Field '"+r+"' and '"+a.getName()+"' in PROTO '"+this.getPrototype().getName()+"' have different types.")}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}}}}if(this.lastIndex=e,this.lineNumber=n,l=this.interfaceDeclaration()){try{if(l.getAccessType()===c.inputOutput){var h=t.getField(l.getName());if(h.getAccessType()===c.inputOutput&&l.getType()===h.getType())return h.setValue(l),!0}}catch(t){}return t.addUserDefinedField(l.getAccessType(),l.getName(),l),!0}return this.nodeBodyElement(t)},createUserDefinedField:function(t,e,n,i){var o=i.create();return t.addUserDefinedField(e,n,o),o},nodeBody:function(t){for(;this.nodeBodyElement(t););},nodeBodyElement:function(t){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.Id()){var e=this.result[1];try{var n=t.getField(e)}catch(n){throw new Error("Unknown field '"+e+"' in class '"+t.getTypeName()+"'.")}if(this.comments(),ls.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){var i=this.result[1];try{var o=this.getPrototype().getField(i)}catch(t){return this.exception("No such event or field '"+i+"' inside PROTO "+this.getPrototype().getName()),!0}if(n.getType()===o.getType()){if(o.isReference(n.getAccessType()))return n.addReference(o),!0;throw new Error("Field '"+n.getName()+"' and '"+o.getName()+"' in PROTO "+this.getPrototype().getName()+" are incompatible as an IS mapping.")}throw new Error("Field '"+n.getName()+"' and '"+o.getName()+"' in PROTO "+this.getPrototype().getName()+" have different types.")}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}if(n.isInitializable()){if(this.fieldValue(n))return!0;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Couldn't assign value to "+this.accessTypeToString(n.getAccessType())+" field '"+e+"'.")}return!1},profileNameId:function(){return this.Id()},componentNameId:function(){return this.comments(),ls.ComponentNameId.parse(this)},categoryNameId:function(){return this.Id()},unitNameId:function(){return this.Id()},exportedNodeNameId:function(){return this.Id()},nodeNameId:function(){return this.Id()},nodeTypeId:function(){return this.Id()},initializeOnlyId:function(){return this.Id()},inputOnlyId:function(){return this.Id()},outputOnlyId:function(){return this.Id()},inputOutputId:function(){return this.Id()},Id:function(){return this.comments(),ls.Id.parse(this)},fieldType:function(){return this.comments(),ls.FieldType.parse(this)},fieldValue:function(t){return this.fieldTypes[t.getType()].call(this,t)},double:function(){return this.comments(),ls.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!ls.CONSTANTS.parse(this)&&(this.value=this.CONSTANTS[this.result[2].toUpperCase()],"-"===this.result[1]&&(this.value=-this.value),!0)},int32:function(){return this.comments(),!!ls.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},string:function(){return this.comments(),!!ls.string.parse(this)&&(this.value=ji.SFString.unescape(this.result[1]),this.lines(this.value),!0)},sfboolValue:function(t){return this.comments(),ls.TRUE.parse(this)?(t.setValue(!0),!0):!!ls.FALSE.parse(this)&&(t.setValue(!1),!0)},mfboolValue:function(t){if(t.length=0,this.sfboolValue(this.SFBool))return t.push(this.SFBool),!0;if(ls.OpenBracket.parse(this)){if(this.sfboolValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfboolValues:function(t){for(t.length=0,t=t.getTarget();this.sfboolValue(this.SFBool);)t.push(this.SFBool)},sfcolorValue:function(t){const e=this.lastIndex;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;return t.r=n,t.g=i,t.b=o,!0}}}if(this.lastIndex=e,this.comments(),ls.HTMLColor.parse(this)){const e=this.convertColor(this.result[1].replace(/0x/i,"#"));return t.r=e[0],t.g=e[1],t.b=e[2],!0}return!1},mfcolorValue:function(t){if(t.length=0,this.sfcolorValue(this.SFColor))return t.push(this.SFColor),!0;if(ls.OpenBracket.parse(this)){if(this.sfcolorValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorValues:function(t){for(t.length=0,t=t.getTarget();this.sfcolorValue(this.SFColor);)t.push(this.SFColor)},sfcolorrgbaValue:function(t){const e=this.lastIndex;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;return t.r=n,t.g=i,t.b=o,t.a=r,!0}}}}if(this.lastIndex=e,this.comments(),ls.HTMLColor.parse(this)){const e=this.convertColor(this.result[1].replace(/0x/i,"#"));return t.r=e[0],t.g=e[1],t.b=e[2],t.a=e[3],!0}return!1},mfcolorrgbaValue:function(t){if(t.length=0,this.sfcolorrgbaValue(this.SFColorRGBA))return t.push(this.SFColorRGBA),!0;if(ls.OpenBracket.parse(this)){if(this.sfcolorrgbaValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorrgbaValues:function(t){for(t.length=0,t=t.getTarget();this.sfcolorrgbaValue(this.SFColorRGBA);)t.push(this.SFColorRGBA)},sfdoubleValue:function(t){return!!this.double()&&(t.setValue(this.fromUnit(t.getUnit(),this.value)),!0)},mfdoubleValue:function(t){if(t.length=0,this.SFDouble.setUnit(t.getUnit()),this.sfdoubleValue(this.SFDouble))return t.push(this.SFDouble),!0;if(ls.OpenBracket.parse(this)){if(this.sfdoubleValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfdoubleValues:function(t){for(t.length=0,t=t.getTarget(),this.SFDouble.setUnit(t.getUnit());this.sfdoubleValue(this.SFDouble);)t.push(this.SFDouble)},sffloatValue:function(t){return this.sfdoubleValue(t)},mffloatValue:function(t){if(t.length=0,this.SFFloat.setUnit(t.getUnit()),this.sffloatValue(this.SFFloat))return t.push(this.SFFloat),!0;if(ls.OpenBracket.parse(this)){if(this.sffloatValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sffloatValues:function(t){for(t.length=0,t=t.getTarget(),this.SFFloat.setUnit(t.getUnit());this.sffloatValue(this.SFFloat);)t.push(this.SFFloat)},sfimageValue:function(t){if(this.int32()){var e=this.value;if(this.int32()){var n=this.value;if(this.int32()){var i=this.value,o=e*n;t.width=e,t.height=n,t.comp=i;for(var r=t.array,s=0;s<o;++s){if(!this.int32())return!1;r[s]=this.value}return!0}}}return!1},mfimageValue:function(t){if(t.length=0,this.sfimageValue(this.SFImage))return t.push(this.SFImage),!0;if(ls.OpenBracket.parse(this)){if(this.sfimageValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfimageValues:function(t){for(t.length=0,t=t.getTarget();this.sfimageValue(this.SFImage);)t.push(this.SFImage)},sfint32Value:function(t){return!!this.int32()&&(t.setValue(this.value),!0)},mfint32Value:function(t){if(t.length=0,this.sfint32Value(this.SFInt32))return t.push(this.SFInt32),!0;if(ls.OpenBracket.parse(this)){if(this.sfint32Values(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfint32Values:function(t){for(t.length=0,t=t.getTarget();this.sfint32Value(this.SFInt32);)t.push(this.SFInt32)},sfmatrix3dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;if(this.double()){var s=this.value;if(this.double()){var a=this.value;if(this.double()){var u=this.value;if(this.double()){var c=this.value;return t[0]=e,t[1]=n,t[2]=i,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=c,!0}}}}}}}}}return!1},mfmatrix3dValue:function(t){if(t.length=0,this.sfmatrix3dValue(this.SFMatrix3d))return t.push(this.SFMatrix3d),!0;if(ls.OpenBracket.parse(this)){if(this.sfmatrix3dValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3dValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix3dValue(this.SFMatrix3d);)t.push(this.SFMatrix3d)},sfmatrix3fValue:function(t){return this.sfmatrix3dValue(t)},mfmatrix3fValue:function(t){if(t.length=0,this.sfmatrix3fValue(this.SFMatrix3f))return t.push(this.SFMatrix3f),!0;if(ls.OpenBracket.parse(this)){if(this.sfmatrix3fValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3fValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix3fValue(this.SFMatrix3f);)t.push(this.SFMatrix3f)},sfmatrix4dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;if(this.double()){var s=this.value;if(this.double()){var a=this.value;if(this.double()){var u=this.value;if(this.double()){var c=this.value;if(this.double()){var l=this.value;if(this.double()){var h=this.value;if(this.double()){var d=this.value;if(this.double()){var p=this.value;if(this.double()){var f=this.value;if(this.double()){var g=this.value;if(this.double()){var m=this.value;return t[0]=e,t[1]=n,t[2]=i,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=c,t[9]=l,t[10]=h,t[11]=d,t[12]=p,t[13]=f,t[14]=g,t[15]=m,!0}}}}}}}}}}}}}}}}return!1},mfmatrix4dValue:function(t){if(t.length=0,this.sfmatrix4dValue(this.SFMatrix4d))return t.push(this.SFMatrix4d),!0;if(ls.OpenBracket.parse(this)){if(this.sfmatrix4dValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4dValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix4dValue(this.SFMatrix4d);)t.push(this.SFMatrix4d)},sfmatrix4fValue:function(t){return this.sfmatrix4dValue(t)},mfmatrix4fValue:function(t){if(t.length=0,this.sfmatrix4fValue(this.SFMatrix4f))return t.push(this.SFMatrix4f),!0;if(ls.OpenBracket.parse(this)){if(this.sfmatrix4fValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4fValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix4fValue(this.SFMatrix4f);)t.push(this.SFMatrix4f)},sfnodeValue:function(t){var e=this.nodeStatement();return!1!==e&&(t.setValue(e),!0)},mfnodeValue:function(t){t.length=0;var e=this.nodeStatement();if(!1!==e)return t.push(e),!0;if(ls.OpenBracket.parse(this)){if(this.nodeStatements(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},nodeStatements:function(t){this.statements(t)},sfrotationValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;return t.x=e,t.y=n,t.z=i,t.angle=this.fromUnit("angle",o),!0}}}}return!1},mfrotationValue:function(t){if(t.length=0,this.sfrotationValue(this.SFRotation))return t.push(this.SFRotation),!0;if(ls.OpenBracket.parse(this)){if(this.sfrotationValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfrotationValues:function(t){for(t.length=0,t=t.getTarget();this.sfrotationValue(this.SFRotation);)t.push(this.SFRotation)},sfstringValue:function(t){return!!this.string()&&(t.setValue(this.value),!0)},mfstringValue:function(t){if(t.length=0,this.sfstringValue(this.SFString))return t.push(this.SFString),!0;if(ls.OpenBracket.parse(this)){if(this.sfstringValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfstringValues:function(t){for(t.length=0,t=t.getTarget();this.sfstringValue(this.SFString);)t.push(this.SFString)},sftimeValue:function(t){return this.sfdoubleValue(t)},mftimeValue:function(t){if(t.length=0,this.sftimeValue(this.SFTime))return t.push(this.SFTime),!0;if(ls.OpenBracket.parse(this)){if(this.sftimeValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sftimeValues:function(t){for(t.length=0,t=t.getTarget();this.sftimeValue(this.SFTime);)t.push(this.SFTime)},sfvec2dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value,i=t.getUnit();return t.x=this.fromUnit(i,e),t.y=this.fromUnit(i,n),!0}}return!1},mfvec2dValue:function(t){if(t.length=0,this.SFVec2d.setUnit(t.getUnit()),this.sfvec2dValue(this.SFVec2d))return t.push(this.SFVec2d),!0;if(ls.OpenBracket.parse(this)){if(this.sfvec2dValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec2d.setUnit(t.getUnit());this.sfvec2dValue(this.SFVec2d);)t.push(this.SFVec2d)},sfvec2fValue:function(t){return this.sfvec2dValue(t)},mfvec2fValue:function(t){if(t.length=0,this.SFVec2f.setUnit(t.getUnit()),this.sfvec2fValue(this.SFVec2f))return t.push(this.SFVec2f),!0;if(ls.OpenBracket.parse(this)){if(this.sfvec2fValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec2f.setUnit(t.getUnit());this.sfvec2fValue(this.SFVec2f);)t.push(this.SFVec2f)},sfvec3dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value,o=t.getUnit();return t.x=this.fromUnit(o,e),t.y=this.fromUnit(o,n),t.z=this.fromUnit(o,i),!0}}}return!1},mfvec3dValue:function(t){if(t.length=0,this.SFVec3d.setUnit(t.getUnit()),this.sfvec3dValue(this.SFVec3d))return t.push(this.SFVec3d),!0;if(ls.OpenBracket.parse(this)){if(this.sfvec3dValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec3d.setUnit(t.getUnit());this.sfvec3dValue(this.SFVec3d);)t.push(this.SFVec3d)},sfvec3fValue:function(t){return this.sfvec3dValue(t)},mfvec3fValue:function(t){if(t.length=0,this.SFVec3f.setUnit(t.getUnit()),this.sfvec3fValue(this.SFVec3f))return t.push(this.SFVec3f),!0;if(ls.OpenBracket.parse(this)){if(this.sfvec3fValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec3f.setUnit(t.getUnit());this.sfvec3fValue(this.SFVec3f);)t.push(this.SFVec3f)},sfvec4dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value,r=t.getUnit();return t.x=this.fromUnit(r,e),t.y=this.fromUnit(r,n),t.z=this.fromUnit(r,i),t.w=this.fromUnit(r,o),!0}}}}return!1},mfvec4dValue:function(t){if(t.length=0,this.SFVec4d.setUnit(t.getUnit()),this.sfvec4dValue(this.SFVec4d))return t.push(this.SFVec4d),!0;if(ls.OpenBracket.parse(this)){if(this.sfvec4dValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec4d.setUnit(t.getUnit());this.sfvec4dValue(this.SFVec4d);)t.push(this.SFVec4d)},sfvec4fValue:function(t){return this.sfvec4dValue(t)},mfvec4fValue:function(t){if(t.length=0,this.SFVec4f.setUnit(t.getUnit()),this.sfvec4fValue(this.SFVec4f))return t.push(this.SFVec4f),!0;if(ls.OpenBracket.parse(this)){if(this.sfvec4fValues(t),this.comments(),ls.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec4f.setUnit(t.getUnit());this.sfvec4fValue(this.SFVec4f);)t.push(this.SFVec4f)},accessTypeToString:function(t){switch(t){case c.initializeOnly:return"initializeOnly";case c.inputOnly:return"inputOnly";case c.outputOnly:return"outputOnly";case c.inputOutput:return"inputOutput"}}}),hs.prototype.fieldTypes=[],hs.prototype.fieldTypes[c.SFBool]=hs.prototype.sfboolValue,hs.prototype.fieldTypes[c.SFColor]=hs.prototype.sfcolorValue,hs.prototype.fieldTypes[c.SFColorRGBA]=hs.prototype.sfcolorrgbaValue,hs.prototype.fieldTypes[c.SFDouble]=hs.prototype.sfdoubleValue,hs.prototype.fieldTypes[c.SFFloat]=hs.prototype.sffloatValue,hs.prototype.fieldTypes[c.SFImage]=hs.prototype.sfimageValue,hs.prototype.fieldTypes[c.SFInt32]=hs.prototype.sfint32Value,hs.prototype.fieldTypes[c.SFMatrix3f]=hs.prototype.sfmatrix3dValue,hs.prototype.fieldTypes[c.SFMatrix3d]=hs.prototype.sfmatrix3fValue,hs.prototype.fieldTypes[c.SFMatrix4f]=hs.prototype.sfmatrix4dValue,hs.prototype.fieldTypes[c.SFMatrix4d]=hs.prototype.sfmatrix4fValue,hs.prototype.fieldTypes[c.SFNode]=hs.prototype.sfnodeValue,hs.prototype.fieldTypes[c.SFRotation]=hs.prototype.sfrotationValue,hs.prototype.fieldTypes[c.SFString]=hs.prototype.sfstringValue,hs.prototype.fieldTypes[c.SFTime]=hs.prototype.sftimeValue,hs.prototype.fieldTypes[c.SFVec2d]=hs.prototype.sfvec2dValue,hs.prototype.fieldTypes[c.SFVec2f]=hs.prototype.sfvec2fValue,hs.prototype.fieldTypes[c.SFVec3d]=hs.prototype.sfvec3dValue,hs.prototype.fieldTypes[c.SFVec3f]=hs.prototype.sfvec3fValue,hs.prototype.fieldTypes[c.SFVec4d]=hs.prototype.sfvec4dValue,hs.prototype.fieldTypes[c.SFVec4f]=hs.prototype.sfvec4fValue,hs.prototype.fieldTypes[c.MFBool]=hs.prototype.mfboolValue,hs.prototype.fieldTypes[c.MFColor]=hs.prototype.mfcolorValue,hs.prototype.fieldTypes[c.MFColorRGBA]=hs.prototype.mfcolorrgbaValue,hs.prototype.fieldTypes[c.MFDouble]=hs.prototype.mfdoubleValue,hs.prototype.fieldTypes[c.MFFloat]=hs.prototype.mffloatValue,hs.prototype.fieldTypes[c.MFImage]=hs.prototype.mfimageValue,hs.prototype.fieldTypes[c.MFInt32]=hs.prototype.mfint32Value,hs.prototype.fieldTypes[c.MFMatrix3d]=hs.prototype.mfmatrix3dValue,hs.prototype.fieldTypes[c.MFMatrix3f]=hs.prototype.mfmatrix3fValue,hs.prototype.fieldTypes[c.MFMatrix4d]=hs.prototype.mfmatrix4dValue,hs.prototype.fieldTypes[c.MFMatrix4f]=hs.prototype.mfmatrix4fValue,hs.prototype.fieldTypes[c.MFNode]=hs.prototype.mfnodeValue,hs.prototype.fieldTypes[c.MFRotation]=hs.prototype.mfrotationValue,hs.prototype.fieldTypes[c.MFString]=hs.prototype.mfstringValue,hs.prototype.fieldTypes[c.MFTime]=hs.prototype.mftimeValue,hs.prototype.fieldTypes[c.MFVec2d]=hs.prototype.mfvec2dValue,hs.prototype.fieldTypes[c.MFVec2f]=hs.prototype.mfvec2fValue,hs.prototype.fieldTypes[c.MFVec3d]=hs.prototype.mfvec3dValue,hs.prototype.fieldTypes[c.MFVec3f]=hs.prototype.mfvec3fValue,hs.prototype.fieldTypes[c.MFVec4d]=hs.prototype.mfvec4dValue,hs.prototype.fieldTypes[c.MFVec4f]=hs.prototype.mfvec4fValue,lt.prototype.fromString=function(t,e){const n=new hs(e);if(n.setUnits(!!e),n.setInput(t),!n.fieldValue(this))throw new Error("Couldn't read value for field '"+this.getName()+"'.")};const ds=hs;n.set("x_ite/Parser/VRMLParser",ds);const ps=ds;var fs=i(532);const gs={initializeOnly:c.initializeOnly,inputOnly:c.inputOnly,outputOnly:c.outputOnly,inputOutput:c.inputOutput};function ms(t){rs.call(this,t),this.protoDeclarations=[],this.parents=[],this.parser=new ps(t),this.url=new ji.MFString,this.protoNames=new Map,this.protoFields=new WeakMap}ms.prototype=Object.assign(Object.create(rs.prototype),{constructor:ms,getEncoding:function(){return"XML"},isValid:function(){return this.input instanceof XMLDocument||this.input instanceof HTMLElement||null===this.input},setInput(t){try{"string"==typeof t&&(t=fs.parseXML(t)),this.input=t,this.xml=this.isXML(t),this.xml||Object.assign(this,_s)}catch(t){this.input=void 0}},isXML:function(t){return!(t instanceof HTMLElement)},parseIntoScene:function(t,e){this.success=t,this.error=e,this.getScene().setEncoding("XML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.xmlElement(this.input)},xmlElement:function(t){if(null===t&&this.success)return this.success(this.getScene());switch(t.nodeName){case"#document":{const e=fs(t).children("X3D");if(e.length)for(const t of e)this.x3dElement(t);else this.success?this.loadComponents().then((()=>{this.childrenElements(t),this.success(this.getScene())})).catch((t=>{this.error&&this.error(t)})):this.childrenElements(t);break}case"X3D":this.x3dElement(t);break;case"Scene":case"SCENE":this.success?this.loadComponents().then((()=>{this.sceneElement(t),this.success(this.getScene())})).catch((t=>{this.error&&this.error(t)})):this.sceneElement(t);break;default:this.success?this.loadComponents().then((()=>{this.childrenElements(t),this.success(this.getScene())})).catch((t=>{this.error&&this.error(t)})):this.childrenElements(t)}},x3dElement:function(t){try{var e=t.getAttribute("profile"),n=this.getBrowser().getProfile(e||"Full");fs.data(this.scene,"X3D",t),this.getScene().setProfile(n)}catch(t){console.error(t)}var i=t.getAttribute("version");i&&this.getScene().setSpecificationVersion(i);for(var o=t.childNodes,r=0;r<o.length;++r)this.x3dElementChildHead(o[r]);if(this.xml||this.headElement(t),this.success)this.loadComponents().then(function(){for(var t=0;t<o.length;++t)this.x3dElementChildScene(o[t]);this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this));else for(r=0;r<o.length;++r)this.x3dElementChildScene(o[r])},x3dElementChildHead:function(t){switch(t.nodeName){case"head":case"HEAD":return void this.headElement(t)}},x3dElementChildScene:function(t){switch(t.nodeName){case"Scene":case"SCENE":return void this.sceneElement(t)}},headElement:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.headElementChild(e[n])},headElementChild:function(t){switch(t.nodeName){case"component":case"COMPONENT":return void this.componentElement(t);case"unit":case"UNIT":return void this.unitElement(t);case"meta":case"META":return void this.metaElement(t)}},componentElement:function(t){try{var e=t.getAttribute("name"),n=parseInt(t.getAttribute("level"));if(null===e)return console.warn("XML Parser Error: Bad component statement. Expected name attribute.");if(null===n)return console.warn("XML Parser Error: Bad component statement. Expected level attribute.");var i=this.getBrowser().getComponent(e,n);this.getScene().addComponent(i)}catch(t){console.log(t.message)}},unitElement:function(t){var e=t.getAttribute("category"),n=t.getAttribute("name"),i=t.getAttribute("conversionFactor");return null===e?console.warn("XML Parser Error: Bad unit statement. Expected category attribute."):null===n?console.warn("XML Parser Error: Bad unit statement. Expected name attribute."):null===i?console.warn("XML Parser Error: Bad unit statement. Expected conversionFactor attribute."):void this.getScene().updateUnit(e,n,parseFloat(i))},metaElement:function(t){var e=t.getAttribute("name"),n=t.getAttribute("content");return null===e?console.warn("XML Parser Error: Bad meta statement. Expected name attribute."):null===n?console.warn("XML Parser Error: Bad meta statement. Expected content attribute."):void this.getScene().addMetaData(e,n)},sceneElement:function(t){fs.data(t,"node",this.scene),this.childrenElements(t)},childrenElements:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.childElement(e[n])},childElement:function(t){switch(t.nodeName){case"#comment":case"#text":return;case"#cdata-section":return void this.cdataNode(t);case"ExternProtoDeclare":case"EXTERNPROTODECLARE":return void this.externProtoDeclareElement(t);case"ProtoDeclare":case"PROTODECLARE":return void this.protoDeclareElement(t);case"IS":return void this.isElement(t);case"ProtoInstance":case"PROTOINSTANCE":return void this.protoInstanceElement(t);case"fieldValue":case"FIELDVALUE":return void this.fieldValueElement(t);case"field":case"FIELD":return void this.fieldElement(t);case"ROUTE":return void this.routeElement(t);case"IMPORT":return void this.importElement(t);case"EXPORT":return void this.exportElement(t);default:return void this.nodeElement(t)}},externProtoDeclareElement:function(t){const e=t.getAttribute("name");if(this.id(e)){const n=t.getAttribute("url");this.parser.setInput(n??""),this.parser.sfstringValues(this.url),this.url.length||console.warn("XML Parser Error: Bad ExternProtoDeclare statement. Expected url attribute with value.");const i=new Ml(this.getExecutionContext(),this.url);this.pushParent(i),this.protoInterfaceElement(t),this.popParent(),this.addProtoFieldNames(i),i.setup();try{const t=this.getExecutionContext().getExternProtoDeclaration(e);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(e),t)}catch(t){}this.getExecutionContext().updateExternProtoDeclaration(e,i),this.addProtoName(e)}},protoDeclareElement:function(t){var e=t.getAttribute("name");if(this.id(e)){for(var n=new Wr(this.getExecutionContext()),i=t.childNodes,o=0;o<i.length;++o){switch((r=i[o]).nodeName){case"ProtoInterface":case"PROTOINTERFACE":this.pushParent(n),this.protoInterfaceElement(r),this.popParent(),this.addProtoFieldNames(n);break;default:continue}break}for(o=0;o<i.length;++o){var r;switch((r=i[o]).nodeName){case"ProtoBody":case"PROTOBODY":this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.pushParent(n),this.protoBodyElement(r),this.popParent(),this.popExecutionContext(),this.popPrototype();break;default:continue}break}n.setup();try{const t=this.getExecutionContext().getProtoDeclaration(e);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(e),t)}catch(t){}this.getExecutionContext().updateProtoDeclaration(e,n),this.addProtoName(e)}},protoInterfaceElement:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.protoInterfaceElementChild(e[n])},protoInterfaceElementChild:function(t){switch(t.nodeName){case"field":case"FIELD":return void this.fieldElement(t)}},fieldElement:function(t){try{if(0===this.getParents().length)return;var e=this.getParent();if(!(e instanceof uo))return;if(!e.canUserDefinedFields())return;var n=gs[t.getAttribute("accessType")];void 0===n&&(n=c.initializeOnly);var i=ji[t.getAttribute("type")];if(void 0===i)return;var o=t.getAttribute("name");if(!this.id(o))return;var r=new i;n&c.initializeOnly&&(this.fieldValue(r,t.getAttribute("value")),this.pushParent(r),this.childrenElements(t),this.popParent()),e.addUserDefinedField(n,o,r)}catch(t){}},protoBodyElement:function(t){this.childrenElements(t)},isElement:function(t){if(this.isInsideProtoDefinition())for(var e=t.childNodes,n=0;n<e.length;++n)this.isElementChild(e[n])},isElementChild:function(t){switch(t.nodeName){case"connect":case"CONNECT":return void this.connectElement(t)}},connectElement:function(t){var e=t.getAttribute("nodeField"),n=t.getAttribute("protoField");if(null===e)return console.warn("XML Parser Error: Bad connect statement. Expected nodeField attribute.");if(null===n)return console.warn("XML Parser Error: Bad connect statement. Expected protoField attribute.");try{if(0===this.getParents().length)return;var i=this.getParent(),o=this.getPrototype();if(!(i instanceof dr))return;var r=i.getField(e),s=o.getField(n);if(r.getType()!==s.getType())throw new Error("Field '"+r.getName()+"' and '"+s.getName()+"' in PROTO "+this.proto.getName()+" have different types.");if(!s.isReference(r.getAccessType()))throw new Error("Field '"+r.getName()+"' and '"+s.getName()+"' in PROTO "+o.getName()+" are incompatible as an IS mapping.");r.addReference(s)}catch(t){console.warn("XML Parser Error: Couldn't create IS reference. "+t.message)}},protoInstanceElement:function(t){try{if(this.useAttribute(t))return;var e=t.getAttribute("name");if(this.id(e)){var n=this.getExecutionContext().createProto(e,!1);if(!n)throw new Error("Unknown proto or externproto type '"+e+"'.");fs.data(t,"node",n),this.defAttribute(t,n),this.addNode(t,n),this.pushParent(n),this.childrenElements(t),this.isInsideProtoDefinition()||n.setup(),this.popParent()}}catch(t){console.warn("XML Parser Error: ",t.message)}},fieldValueElement:function(t){try{if(0===this.getParents().length)return;var e=this.getParent(),n=t.getAttribute("name");if(!(e instanceof kr))return;if(!this.id(n))return;var i=e.getField(n);i.getAccessType()&c.initializeOnly&&(i.getType()===c.MFNode&&(i.length=0),this.fieldValue(i,t.getAttribute("value")),this.pushParent(i),this.childrenElements(t),this.popParent())}catch(t){console.warn("XML Parser Error: Couldn't assign field value. "+t.message)}},nodeElement:function(t){try{if(this.useAttribute(t))return;var e=this.getExecutionContext().createNode(this.nodeNameToCamelCase(t.nodeName),!1);if(e||(e=this.getExecutionContext().createProto(this.protoNameToCamelCase(t.nodeName),!1)),!e)throw new Error(`Unknown node type '${t.nodeName}', you probably have insufficient component/profile statements and/or an inappropriate specification version.`);fs.data(t,"node",e),"SCRIPT"===t.nodeName&&this.scriptElement(t),this.defAttribute(t,e),this.addNode(t,e),this.pushParent(e),this.nodeAttributes(t,e),this.childrenElements(t),this.isInsideProtoDefinition()||e.setup(),this.popParent()}catch(e){if("NULL"==t.nodeName)return void this.addNode(t,null);console.error("XML Parser Error: "+e.message)}},scriptElement(t){const e=(new DOMParser).parseFromString(t.outerHTML,"application/xml").children[0].childNodes;t.textContent="// Content moved into childNodes.";for(const n of e)1!==n.nodeType&&4!==n.nodeType||t.appendChild(n)},routeElement:function(t){try{var e=t.getAttribute("fromNode"),n=t.getAttribute("fromField"),i=t.getAttribute("toNode"),o=t.getAttribute("toField");if(null===e)throw new Error("Bad ROUTE statement: Expected fromNode attribute.");if(null===n)throw new Error("Bad ROUTE statement: Expected fromField attribute.");if(null===i)throw new Error("Bad ROUTE statement: Expected toNode attribute.");if(null===o)throw new Error("Bad ROUTE statement: Expected toField attribute.");var r=this.getExecutionContext(),s=r.getLocalNode(e),a=r.getLocalNode(i),u=r.addRoute(s,n,a,o);fs.data(t,"node",u)}catch(t){console.warn("XML Parser Error: "+t.message)}},importElement:function(t){try{var e=t.getAttribute("inlineDEF"),n=t.getAttribute("importedDEF")||t.getAttribute("exportedDEF"),i=t.getAttribute("AS");if(null===e)throw new Error("Bad IMPORT statement: Expected inlineDEF attribute.");if(null===n)throw new Error("Bad IMPORT statement: Expected importedDEF attribute.");i||(i=n);var o=this.getExecutionContext().getNamedNode(e);this.getExecutionContext().updateImportedNode(o,n,i)}catch(t){console.warn("XML Parser Error: "+t.message)}},exportElement:function(t){try{if(this.getScene()!==this.getExecutionContext())return void console.warn("XML Parser Error: Export statement not allowed here.");var e=t.getAttribute("localDEF"),n=t.getAttribute("AS");if(null===e)throw new Error("Bad EXPORT statement: Expected localDEF attribute.");n||(n=e);var i=this.getExecutionContext().getLocalNode(e);this.getScene().updateExportedNode(n,i)}catch(t){console.warn("XML Parser Error: "+t.message)}},cdataNode:function(t){if(0===this.getParents().length)return;const e=this.getParent();e instanceof dr&&e.getSourceText()?.push(t.data)},useAttribute:function(t){try{var e=t.getAttribute("USE");if(this.id(e)){var n=this.getExecutionContext().getNamedNode(e);return this.addNode(t,n.getValue()),!0}}catch(t){console.warn("Invalid USE name: "+t.message)}return!1},defAttribute:function(t,e){try{var n=t.getAttribute("DEF");if(n){try{var i=this.getExecutionContext().getNamedNode(n);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(n),i)}catch(t){}this.getExecutionContext().updateNamedNode(n,e)}}catch(t){console.warn("Invalid DEF name: "+t.message)}},nodeAttributes:function(t,e){for(var n=t.attributes,i=0;i<n.length;++i)this.nodeAttribute(n[i],e)},nodeAttribute:function(t,e){try{const n=e.getField(this.attributeToCamelCase(e,t.name));n.isInitializable()&&this.fieldValue(n,t.value)}catch(t){}},fieldValue:function(t,e){null!==e&&(this.parser.pushExecutionContext(this.getExecutionContext()),this.parser.setInput(e),this.fieldTypes[t.getType()].call(this.parser,t),this.parser.popExecutionContext())},id:function(t){return null!==t&&0!==t.length},getParents:function(){return this.parents},getParent:function(){return this.parents.at(-1)},pushParent:function(t){return this.parents.push(t)},popParent:function(){this.parents.pop()},addNode:function(t,e){if(0===this.parents.length||this.getParent()instanceof Wr)this.getExecutionContext().rootNodes.push(e);else{var n=this.getParent();if(n instanceof lt)switch(n.getType()){case c.SFNode:return void n.setValue(e);case c.MFNode:return void n.push(e)}else try{var i=t.getAttribute("containerField");if(!i){if(!e)throw new Error("NULL node must have a container field attribute.");i=e.getContainerField()}var o=n.getField(i);switch(o.getType()){case c.SFNode:return void o.setValue(e);case c.MFNode:return void o.push(e)}}catch(t){}}},addProtoName:function(t){},addProtoFieldNames:function(t){},protoNameToCamelCase:function(t){return t},nodeNameToCamelCase:function(t){return t},attributeToCamelCase:function(t,e){return e}}),ms.prototype.fieldTypes=[],ms.prototype.fieldTypes[c.SFBool]=ps.prototype.sfboolValue,ms.prototype.fieldTypes[c.SFColor]=ps.prototype.sfcolorValue,ms.prototype.fieldTypes[c.SFColorRGBA]=ps.prototype.sfcolorrgbaValue,ms.prototype.fieldTypes[c.SFDouble]=ps.prototype.sfdoubleValue,ms.prototype.fieldTypes[c.SFFloat]=ps.prototype.sffloatValue,ms.prototype.fieldTypes[c.SFImage]=ps.prototype.sfimageValue,ms.prototype.fieldTypes[c.SFInt32]=ps.prototype.sfint32Value,ms.prototype.fieldTypes[c.SFMatrix3f]=ps.prototype.sfmatrix3dValue,ms.prototype.fieldTypes[c.SFMatrix3d]=ps.prototype.sfmatrix3fValue,ms.prototype.fieldTypes[c.SFMatrix4f]=ps.prototype.sfmatrix4dValue,ms.prototype.fieldTypes[c.SFMatrix4d]=ps.prototype.sfmatrix4fValue,ms.prototype.fieldTypes[c.SFNode]=function(t){t.setValue(null)},ms.prototype.fieldTypes[c.SFRotation]=ps.prototype.sfrotationValue,ms.prototype.fieldTypes[c.SFString]=function(t){t.setValue(ji.SFString.unescape(this.input))},ms.prototype.fieldTypes[c.SFTime]=ps.prototype.sftimeValue,ms.prototype.fieldTypes[c.SFVec2d]=ps.prototype.sfvec2dValue,ms.prototype.fieldTypes[c.SFVec2f]=ps.prototype.sfvec2fValue,ms.prototype.fieldTypes[c.SFVec3d]=ps.prototype.sfvec3dValue,ms.prototype.fieldTypes[c.SFVec3f]=ps.prototype.sfvec3fValue,ms.prototype.fieldTypes[c.SFVec4d]=ps.prototype.sfvec4dValue,ms.prototype.fieldTypes[c.SFVec4f]=ps.prototype.sfvec4fValue,ms.prototype.fieldTypes[c.MFBool]=ps.prototype.sfboolValues,ms.prototype.fieldTypes[c.MFColor]=ps.prototype.sfcolorValues,ms.prototype.fieldTypes[c.MFColorRGBA]=ps.prototype.sfcolorrgbaValues,ms.prototype.fieldTypes[c.MFDouble]=ps.prototype.sfdoubleValues,ms.prototype.fieldTypes[c.MFFloat]=ps.prototype.sffloatValues,ms.prototype.fieldTypes[c.MFImage]=ps.prototype.sfimageValues,ms.prototype.fieldTypes[c.MFInt32]=ps.prototype.sfint32Values,ms.prototype.fieldTypes[c.MFMatrix3d]=ps.prototype.sfmatrix3dValues,ms.prototype.fieldTypes[c.MFMatrix3f]=ps.prototype.sfmatrix3fValues,ms.prototype.fieldTypes[c.MFMatrix4d]=ps.prototype.sfmatrix4dValues,ms.prototype.fieldTypes[c.MFMatrix4f]=ps.prototype.sfmatrix4fValues,ms.prototype.fieldTypes[c.MFNode]=function(t){t.length=0},ms.prototype.fieldTypes[c.MFRotation]=ps.prototype.sfrotationValues,ms.prototype.fieldTypes[c.MFString]=ps.prototype.sfstringValues,ms.prototype.fieldTypes[c.MFTime]=ps.prototype.sftimeValues,ms.prototype.fieldTypes[c.MFVec2d]=ps.prototype.sfvec2dValues,ms.prototype.fieldTypes[c.MFVec2f]=ps.prototype.sfvec2fValues,ms.prototype.fieldTypes[c.MFVec3d]=ps.prototype.sfvec3dValues,ms.prototype.fieldTypes[c.MFVec3f]=ps.prototype.sfvec3fValues,ms.prototype.fieldTypes[c.MFVec4d]=ps.prototype.sfvec4dValues,ms.prototype.fieldTypes[c.MFVec4f]=ps.prototype.sfvec4fValues;const _s={addProtoName:function(t){this.protoNames.set(t,t),this.protoNames.set(t.toUpperCase(),t)},addProtoFieldNames:function(){const t=new Set;for(const e of["DEF","USE","containerField"])t.add(e).add(e.toLowerCase());return function(e){const n=new Map;this.protoFields.set(e,n);for(const{name:i}of e.getFieldDefinitions())t.has(i)||(n.set(i,i),n.set(i.toLowerCase(),i))}}(),protoNameToCamelCase:function(t){return this.protoNames.get(t)},nodeNameToCamelCase:function(t){return Yi.getNodeTypeName(t)},attributeToCamelCase:function(t,e){return t instanceof kr?this.protoFields.get(t.getProtoNode()).get(e):Yi.getFieldName(e)}},xs=ms;n.set("x_ite/Parser/XMLParser",xs);const ys=xs;function ws(t){rs.call(this,t),this.namespace="http://www.web3d.org/specifications/x3d-namespace"}ws.prototype=Object.assign(Object.create(rs.prototype),{constructor:ws,getEncoding:function(){return"JSON"},isValid:function(){return this.input instanceof Object},setInput:function(t){try{"string"==typeof t&&(t=JSON.parse(t)),this.input=t}catch(t){this.input=void 0}},parseIntoScene:function(t,e){const n=this.createElement("X3D");this.convertToDOM(this.input,"",n);const i=new ys(this.getScene());i.setInput(n),i.parseIntoScene(t,e),this.getScene().setEncoding("JSON")},elementSetAttribute:function(t,e,n){switch(e){case"SON schema":case"ncoding":break;default:"function"==typeof t.setAttribute&&t.setAttribute(e,n)}},convertChildren:function(t,e,n){for(const i in e)"object"==typeof e[i]&&(isNaN(parseInt(i))?this.convertObject(i,e,n,t.substr(1)):this.convertToDOM(e[i],i,n,t.substr(1)))},createElement:function(t,e){if(void 0===this.namespace)var n=document.createElement(t);else null==(n=document.createElementNS(this.namespace,t))&&(console.error("Trouble creating element for",t),n=document.createElement(t));return void 0!==e&&this.elementSetAttribute(n,"containerField",e),n},createCDATA:function(t,e,n){const i=(new DOMParser).parseFromString("<xml></xml>","application/xml").createCDATASection(n);e.appendChild(i)},convertObject:function(t,e,n,i){if(null!==e&&"object"==typeof e[t])if("@"===t.substr(0,1))this.convertToDOM(e[t],t,n);else if("-"===t.substr(0,1))this.convertChildren(t,e[t],n);else if("#comment"===t)for(const i in e[t]){const o=document.createComment(this.commentStringToXML(e[t][i]));n.appendChild(o)}else if("#sourceCode"===t||"@sourceCode"===t||"#sourceText"===t)this.createCDATA(document,n,e[t].join("\n"));else if("connect"===t||"fieldValue"===t||"field"===t||"meta"===t||"component"===t||"unit"===t){for(const o in e[t])if("object"==typeof e[t][o]){const r=this.createElement(t,i);this.convertToDOM(e[t][o],o,r),n.appendChild(r),n.appendChild(document.createTextNode("\n"))}}else{const o=this.createElement(t,i);this.convertToDOM(e[t],t,o),n.appendChild(o),n.appendChild(document.createTextNode("\n"))}},commentStringToXML:function(t){return t.replace(/\\\\/g,"\\")},SFStringToXML:function(t){return t.replace(/([\\"])/g,"\\$1")},JSONStringToXML:function(t){return t=(t=t.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")},convertToDOM:function(t,e,n,i){let o=!1,r=[],s=!1;for(const e in t)if(o=!isNaN(parseInt(e)),o)switch(typeof t[e]){case"number":case"boolean":r.push(t[e]);break;case"string":r.push(t[e]),s=!0;break;case"object":this.convertToDOM(t[e],e,n);break;case"undefined":break;default:console.error("Unknown type found in array "+typeof t[e])}else switch(typeof t[e]){case"object":"X3D"===e?this.convertToDOM(t[e],e,n):this.convertObject(e,t,n,i);break;case"number":case"boolean":this.elementSetAttribute(n,e.substr(1),t[e]);break;case"string":if("#comment"!==e)this.elementSetAttribute(n,e.substr(1),this.JSONStringToXML(t[e]));else{const i=document.createComment(this.commentStringToXML(t[e]));n.appendChild(i)}break;case"undefined":break;default:console.error("Unknown type found in object "+typeof t[e]),console.error(t)}if(o){if("@"===e.substr(0,1))if(s){s=!1;for(const t in r)r[t]=this.SFStringToXML(r[t]);this.elementSetAttribute(n,e.substr(1),'"'+r.join('" "')+'"')}else this.elementSetAttribute(n,e.substr(1),r.join(" "));o=!1}return n}});const Ss=ws;n.set("x_ite/Parser/JSONParser",Ss);const Ts=Ss;function bs(){}bs.prototype={constructor:bs,removeGroups:!1,removeEmptyGroups:!1,combineGroupingNodes:!1,optimizeSceneGraph:function(t){const e=[];t.setValue(this.optimizeNodes(t,!0,e)),e.forEach((t=>t.dispose()))},optimizeNodes:function(t,e,n){return[...t].flatMap((t=>this.optimizeNode(t,e,n)))},optimizeNode:function(t,e,n){if(!t)return[];switch(t.getNodeTypeName()){case"Transform":t.children=this.optimizeNodes(t.children,!0,n);break;case"Anchor":case"Group":if(t.children=this.optimizeNodes(t.children,!0,n),this.removeEmptyGroups&&0===t.children.length)return[];if(this.removeGroups)break;return t;case"LOD":case"Switch":return this.optimizeNodes(t.children,!1,n),t;default:return t}if(!e)return t;if(this.removeEmptyGroups&&0===t.children.length)return[];if(!this.combineGroupingNodes)return t;if(t.getValue().hasRoutes())return t;if("Transform"===t.getNodeTypeName()){if(this.combineSingleChild(t,n),!t.translation.getValue().equals(Se.Zero))return t;if(!t.rotation.getValue().equals(an.Identity))return t;if(!t.scale.getValue().equals(Se.One))return t}return n.push(t.getValue()),[...t.children]},combineSingleChild:function(t,e){if(1!==t.children.length)return;const n=t.children[0];if("Transform"!==n.getNodeTypeName())return;if(n.getValue().hasRoutes())return;const i=new Se(0,0,0),o=new an,r=new Se(1,1,1),s=new an,a=new dn,u=new dn;a.set(t.translation.getValue(),t.rotation.getValue(),t.scale.getValue(),t.scaleOrientation.getValue()),u.set(n.translation.getValue(),n.rotation.getValue(),n.scale.getValue(),n.scaleOrientation.getValue()),a.multLeft(u),a.get(i,o,r,s),t.translation=i,t.rotation=o,t.scale=r,t.scaleOrientation=s,t.children=n.children,e.push(n.getValue())}};const vs=bs;n.set("x_ite/Parser/X3DOptimizer",vs);const Es=vs;var Cs=i(532);function Os(t){rs.call(this,t),Es.call(this),this.removeGroups=!1,this.removeEmptyGroups=!0,this.combineGroupingNodes=!0,this.extensions=new Set,this.lights=[],this.usedLights=0,this.buffers=[],this.bufferViews=[],this.accessors=[],this.samplers=[],this.materials=[],this.textureTransformNodes=[],this.cameras=[],this.viewpoints=0,this.nodes=[],this.animations=0}Os.prototype=Object.assign(Object.create(rs.prototype),Es.prototype,{constructor:Os,getEncoding:function(){return"JSON"},isValid:function(){const t=new Set(["asset","extra","extensions","extensionsRequired","extensionsUsed","buffers","bufferViews","accessors","samplers","images","textures","materials","meshes","cameras","nodes","scenes","scene","animations","skins"]);return function(){if(!(this.input instanceof Object))return!1;if(!Object.keys(this.input).every((e=>t.has(e))))return!1;const e=this.input.asset;return e instanceof Object&&"2.0"===e.version}}(),setInput:function(t){try{"string"==typeof t&&(t=JSON.parse(t)),this.input=t}catch(t){this.input=void 0}},setBuffers:function(t){this.buffers=t},parseIntoScene:function(t,e){this.rootObject(this.input).then(t).catch(e)},rootObject:async function(t){if(!(t instanceof Object))return;const e=this.getBrowser(),n=this.getScene();return n.setEncoding("GLTF"),n.setProfile(e.getProfile("Interchange")),this.assetObject(t.asset),this.extensionsArray(t.extensionsUsed,this.extensions),this.extensionsArray(t.extensionsRequired,this.extensions),this.extensionsObject(t.extensions),await this.loadComponents(),await this.buffersArray(t.buffers),this.extensions.has("KHR_draco_mesh_compression")&&(this.draco=await this.createDraco()),this.bufferViewsArray(t.bufferViews),this.accessorsArray(t.accessors),this.samplersArray(t.samplers),await this.imagesArray(t.images),this.texturesArray(t.textures),this.materialsArray(t.materials),this.meshesArray(t.meshes),this.camerasArray(t.cameras),this.nodesArray(t.nodes),this.scenesArray(t.scenes,t.scene),this.animationsArray(t.animations),this.skinsArray(t.skins),this.getScene()},assetObject:function(t){if(!(t instanceof Object))return;const e=this.getExecutionContext(),n=e.getWorldURL(),i=e.createNode("WorldInfo",!1);for(const[e,n]of Object.entries(t))"string"==typeof n&&i._info.push(`${e}: ${n}`);if(t.extras instanceof Object)for(const[e,n]of Object.entries(t.extras))"string"==typeof n&&("title"===e?i._title=n:i._info.push(`${e}: ${n}`));i._info.sort(),i._title.getValue()||(i._title=decodeURI(new URL(n).pathname.split("/").at(-1)||n)),i.setup(),e.getRootNodes().push(i)},extensionsArray:function(t,e){if(!(t instanceof Array))return;const n=this.getBrowser(),i=this.getExecutionContext();for(const o of t)if(e.add(o),"KHR_texture_transform"===o)i.addComponent(n.getComponent("Texturing3D",2))},extensionsObject:function(t){if(t instanceof Object)for(const[e,n]of Object.entries(t))if("KHR_lights_punctual"===e)return this.khrLightsPunctualObject(n)},khrLightsPunctualObject:function(t){t instanceof Object&&this.lightsArray(t.lights)},lightsArray:function(t){t instanceof Array&&(this.lights=t)},lightObject:function(t){if(!(t instanceof Object))return null;const e=this.lightType(t);if(!e)return null;const n=this.getExecutionContext(),i=this.sanitizeName(t.name),o=new Nt(1,1,1);return this.vectorValue(t.color,o)&&(e._color=o),e._global=!0,e._intensity=this.numberValue(t.intensity,1),e.setup(),i&&(n.addNamedNode(n.getUniqueName(i),e),n.addExportedNode(n.getUniqueExportName(i),e)),e},lightType:function(t){switch(t.type){case"directional":return this.directionalLight(t);case"spot":return this.spotLight(t);case"point":return this.pointLight(t)}},directionalLight:function(t){return this.getExecutionContext().createNode("DirectionalLight",!1)},spotLight:function(t){const e=this.getExecutionContext().createNode("SpotLight",!1);return e._radius=this.numberValue(t.range,0)||1e9,e._cutOffAngle=this.numberValue(t.outerConeAngle,Math.PI/4),e._beamWidth=this.numberValue(t.innerConeAngle,0),e._attenuation=new Se(0,0,1),e},pointLight:function(t){const e=this.getExecutionContext().createNode("PointLight",!1);return e._radius=this.numberValue(t.range,0)||1e9,e._attenuation=new Se(0,0,1),e},buffersArray:async function(t){t instanceof Array&&(this.buffers=await Promise.all(t.map(((t,e)=>this.bufferObject(t,e)))))},bufferObject:async function(t,e){if(!(t instanceof Object))return;if(!t.uri)return this.buffers[e];const n=new URL(t.uri,this.getExecutionContext().getWorldURL()),i=await fetch(n),o=await i.blob(),r=await o.arrayBuffer();return Cs.ungzip(r)},bufferViewsArray:function(t){if(t instanceof Array){this.bufferViews=t;for(const e of t)e.buffer=this.bufferViewObject(e)}},bufferViewObject:function(t){if(!(t instanceof Object))return;const e=this.buffers[t.buffer];if(!e)return;const n=t.byteOffset||0,i=t.byteLength;return e.slice(n,n+i)},accessorsArray:function(t){if(t instanceof Array){this.accessors=t;for(const e of t)this.accessorObject(e)}},accessorObject:function(){const t=new Map([[5120,Int8Array],[5121,Uint8Array],[5122,Int16Array],[5123,Uint16Array],[5124,Int32Array],[5125,Uint32Array],[5126,Float32Array]]),e=new Map([["SCALAR",1],["VEC2",2],["VEC3",3],["VEC4",4],["MAT2",4],["MAT3",9],["MAT4",16]]);return function(n){n instanceof Object&&Object.defineProperty(n,"array",{get:()=>{const i=t.get(n.componentType),o=this.bufferViews[n.bufferView||0],r=n.byteOffset||0,s=o.byteStride||0,a=e.get(n.type),u=n.count||0,c=s?s/i.BYTES_PER_ELEMENT:a,l=Math.min(c*u,(o.byteLength-r)/i.BYTES_PER_ELEMENT),h=new i(o.buffer,r,l);if(c===a){const t=this.sparseObject(n.sparse,h,a);return Object.defineProperty(n,"array",{value:t}),t}{const t=u*a,e=new i(t);for(let n=0,i=0;n<t;i+=c)for(let t=0;t<a;++t,++n)e[n]=h[i+t];const o=this.sparseObject(n.sparse,e,a);return Object.defineProperty(n,"array",{value:o}),o}},configurable:!0})}}(),sparseObject:function(){const t=new Map([[5121,Uint8Array],[5123,Uint16Array],[5125,Uint32Array]]);return function(e,n,i){if(!(e instanceof Object))return n;if(!(e.indices instanceof Object))return n;if(!(e.values instanceof Object))return n;const o=t.get(e.indices.componentType),r=this.bufferViews[e.indices.bufferView],s=e.indices.byteOffset,a=new o(r.buffer,s,e.count),u=n.constructor,c=this.bufferViews[e.values.bufferView],l=e.values.byteOffset,h=new u(c.buffer,l,e.count*i);n=n.slice();let d=0;for(const t of a)for(let e=0;e<i;++e,++d)n[t*i+e]=h[d];return n}}(),samplersArray:function(t){if(t instanceof Array){this.samplers=t;for(const e of t)this.samplerObject(e)}},samplerObject:function(){const t=new Map([[9728,["NEAREST_PIXEL",!1]],[9729,["AVG_PIXEL",!1]],[9984,["NEAREST_PIXEL_NEAREST_MIPMAP",!0]],[9985,["AVG_PIXEL_NEAREST_MIPMAP",!0]],[9986,["NEAREST_PIXEL_AVG_MIPMAP",!0]],[9987,["AVG_PIXEL_AVG_MIPMAP",!0]]]),e=new Map([[9728,"NEAREST_PIXEL"],[9729,"AVG_PIXEL"]]),n=new Map([[33071,"CLAMP_TO_EDGE"],[33648,"MIRRORED_REPEAT"],[10497,"REPEAT"]]);return function(i){i instanceof Object&&Object.defineProperty(i,"texturePropertiesNode",{get:()=>{const o=this.getExecutionContext(),r=o.createNode("TextureProperties",!1),s=this.sanitizeName(i.name);s&&(o.addNamedNode(o.getUniqueName(s),r),o.addExportedNode(o.getUniqueExportName(s),r));const a=t.get(i.minFilter)||["AVG_PIXEL",!1];return r._minificationFilter=a[0],r._generateMipMaps=a[1],r._magnificationFilter=e.get(i.magFilter)||"AVG_PIXEL",r._boundaryModeS=n.get(i.wrapS)||"REPEAT",r._boundaryModeT=n.get(i.wrapT)||"REPEAT",r.setup(),Object.defineProperty(i,"texturePropertiesNode",{value:r}),r},configurable:!0})}}(),imagesArray:async function(t){t instanceof Array&&(this.images=await Promise.all(t.map((t=>this.imageObject(t)))))},imageObject:async function(t){if(!(t instanceof Object))return;if(t.uri)return t;const e=this.bufferViews[t.bufferView];if(!e)return t;const n=e.buffer,i=new Blob([new Uint8Array(n)],{type:t.mimeType}),o=await this.blobToDataUrl(i);return t.uri=o,t},blobToDataUrl:function(t){return new Promise(((e,n)=>{const i=new FileReader;i.onload=e,i.onerror=n,i.readAsDataURL(t)})).then((t=>t.target.result))},texturesArray:function(t){t instanceof Array&&(this.textures=t)},textureObject:function(t){if(!(t instanceof Object))return;const e=this.images[t.source];if(!e)return null;if(t.textureNode)return t.textureNode;const n=this.getExecutionContext(),i=n.createNode("ImageTexture",!1),o=this.sanitizeName(t.name||e.name);o&&(n.addNamedNode(n.getUniqueName(o),i),n.addExportedNode(n.getUniqueExportName(o),i)),i._url=[e.uri];const r=this.samplers[t.sampler];return r instanceof Object&&(i._textureProperties=r.texturePropertiesNode),i.setup(),t.textureNode=i},materialsArray:function(t){t instanceof Array&&(this.materials=t)},materialObject:function(t){if(!(t instanceof Object))return this.getDefaultAppearance();if(t.appearanceNode)return t.appearanceNode;const e=this.texCoordIndices("",t);this.texCoordIndex=[...e].reduce(Math.max,-1),this.textureTransformNodes=[],this.texCoordMappings=new Map,t.texCoordMappings=this.texCoordMappings;const n=this.getExecutionContext(),i=n.createNode("Appearance",!1),o=this.createMaterial(t),r=this.sanitizeName(t.name),s=new Nt(0,0,0);this.vectorValue(t.emissiveFactor,s)&&(o._emissiveColor=s),o._emissiveTexture=this.textureInfo(t.emissiveTexture),o._emissiveTextureMapping=this.textureMapping(t.emissiveTexture),this.occlusionTextureInfo(t.occlusionTexture,o),this.normalTextureInfo(t.normalTexture,o),this.materialExtensions(t.extensions,o),o.setup();for(const t of e){const e=`TEXCOORD_${t}`;if(this.textureTransformNodes.length){const t=n.createNode("TextureTransform",!1);t._mapping=e,t._translation.y=-1,t._scale.y=-1,t.setup(),this.textureTransformNodes.push(t)}this.texCoordMappings.set(e,t)}return r&&(n.addNamedNode(n.getUniqueName(r),i),n.addExportedNode(n.getUniqueExportName(r),i)),i._alphaMode=this.stringValue(t.alphaMode,"OPAQUE"),i._alphaCutoff=this.numberValue(t.alphaCutoff,.5),i._material=o,i._textureTransform=this.createMultiTextureTransform(o),i.setup(),t.appearanceNode=i},texCoordIndices:function(t,e,n=new Set){if(!(e instanceof Object))return n;t.endsWith("Texture")&&!e?.extensions?.KHR_texture_transform&&n.add(e.texCoord||0);for(const[t,i]of Object.entries(e))this.texCoordIndices(t,i,n);return n},createMaterial:function(t){const e=[this.pbrMetallicRoughnessObject.bind(this,t.pbrMetallicRoughness),this.pbrSpecularGlossinessObject.bind(this,t.extensions?.KHR_materials_pbrSpecularGlossiness),this.pbrMetallicRoughnessObject.bind(this,{})];for(const t of e){const e=t();if(e)return e}},pbrMetallicRoughnessObject:function(t){if(!(t instanceof Object))return null;const e=this.getExecutionContext().createNode("PhysicalMaterial",!1),n=new qt(0,0,0,0),i=new Nt(0,0,0);return this.vectorValue(t.baseColorFactor,n)&&(e._baseColor=i.set(...n),e._transparency=1-n.a),e._metallic=this.numberValue(t.metallicFactor,1),e._roughness=this.numberValue(t.roughnessFactor,1),e._baseTexture=this.textureInfo(t.baseColorTexture),e._baseTextureMapping=this.textureMapping(t.baseColorTexture),e._metallicRoughnessTexture=this.textureInfo(t.metallicRoughnessTexture),e._metallicRoughnessTextureMapping=this.textureMapping(t.metallicRoughnessTexture),e},pbrSpecularGlossinessObject:function(t){if(!(t instanceof Object))return null;const e=this.getExecutionContext().createNode("Material",!1),n=new qt(0,0,0,0),i=new Nt(0,0,0),o=new Nt(0,0,0);return this.vectorValue(t.diffuseFactor,n)?(e._diffuseColor=i.set(...n),e._transparency=1-n.a):e._diffuseColor=Nt.White,this.vectorValue(t.specularFactor,o)?e._specularColor=o:e._specularColor=Nt.White,e._shininess=this.numberValue(t.glossinessFactor,1),e._diffuseTexture=this.textureInfo(t.diffuseTexture),e._diffuseTextureMapping=this.textureMapping(t.diffuseTexture),e._specularTexture=this.textureInfo(t.specularGlossinessTexture),e._specularTextureMapping=this.textureMapping(t.specularGlossinessTexture),e._shininessTexture=this.textureInfo(t.specularGlossinessTexture),e._shininessTextureMapping=this.textureMapping(t.specularGlossinessTexture),e},occlusionTextureInfo:function(t,e){if(!(t instanceof Object))return null;e._occlusionStrength=this.numberValue(t.strength,1),e._occlusionTexture=this.textureInfo(t),e._occlusionTextureMapping=this.textureMapping(t)},normalTextureInfo:function(t,e){if(!(t instanceof Object))return null;e._normalScale=this.numberValue(t.scale,1),e._normalTexture=this.textureInfo(t),e._normalTextureMapping=this.textureMapping(t)},textureInfo:function(t){return t instanceof Object?(t.extensions instanceof Object?t.mapping=this.textureTransformObject(t.extensions.KHR_texture_transform,t.texCoord||0):t.mapping=`TEXCOORD_${t.texCoord||0}`,this.textureObject(this.textures[t.index])):null},textureMapping:function(t){return t instanceof Object?t.mapping:""},materialExtensions:function(t,e){if(t instanceof Object)for(const[n,i]of Object.entries(t))switch(n){case"KHR_materials_unlit":this.khrMaterialsUnlitObject(e);break;case"KHR_materials_emissive_strength":this.khrMaterialsEmissiveStrengthObject(i,e)}},khrMaterialsUnlitObject:function(t){switch(t.getTypeName()){case"PhysicalMaterial":t._emissiveColor=t._baseColor,t._emissiveTextureMapping=t._baseTextureMapping,t._emissiveTexture=t._baseTexture,t._baseColor=Nt.Black,t._baseTextureMapping="",t._baseTexture=null;break;case"Material":t._emissiveColor=t._diffuseColor,t._emissiveTextureMapping=t._diffuseTextureMapping,t._emissiveTexture=t._diffuseTexture,t._diffuseColor=Nt.Black,t._diffuseTextureMapping="",t._diffuseTexture=null}},khrMaterialsEmissiveStrengthObject:function(t,e){if(!(t instanceof Object))return;const n=this.numberValue(t.emissiveStrength,1);e._emissiveColor.r*=n,e._emissiveColor.g*=n,e._emissiveColor.b*=n},textureTransformObject:function(t,e){if(!(t instanceof Object))return;if(!this.extensions.has("KHR_texture_transform"))return;const n=this.getExecutionContext().createNode("TextureTransformMatrix3D",!1),i=`TEXCOORD_${this.texCoordIndex+this.textureTransformNodes.length+1}`,o=new ge(0,0),r=new ge(1,1),s=new dn;return s.scale(new Se(1,-1,1)),s.translate(new Se(0,-1,0)),this.vectorValue(t.offset,o)&&s.translate(new Se(...o,0)),s.rotate(new an(0,0,-1,this.numberValue(t.rotation,0))),this.vectorValue(t.scale,r)&&s.scale(new Se(...r,1)),n._mapping=i,n._matrix=s,n.setup(),this.textureTransformNodes.push(n),this.texCoordMappings.set(i,t.texCoord??e),i},meshesArray:function(t){t instanceof Array&&(this.meshes=t)},meshObject:function(t){if(!(t instanceof Object))return;if(t.shapeNodes)return t.shapeNodes;const e=this.primitivesArray(t.primitives),n=this.getExecutionContext(),i=this.sanitizeName(t.name);if(i)for(const t of e)n.addNamedNode(n.getUniqueName(i),t),n.addExportedNode(n.getUniqueExportName(i),t);return t.shapeNodes=e},primitivesArray:function(t){if(!(t instanceof Array))return[];const e=[];for(const n of t)this.primitiveObject(n,e);return e},primitiveObject:function(t,e){t instanceof Object&&(this.attributesObject(t.attributes),this.targetsArray(t.targets),t.indices=this.accessors[t.indices],t.material=this.materials[t.material],this.primitiveExtensionsObject(t.extensions,t),e.push(this.createShape(t)))},attributesObject:function(t){if(t instanceof Object){for(const e in t)t[e]=this.accessors[t[e]];t.TEXCOORD=[],t.COLOR=[],t.JOINTS=[],t.WEIGHTS=[];for(let e=0;t["TEXCOORD_"+e];++e)t.TEXCOORD.push(t["TEXCOORD_"+e]);for(let e=0;t["COLOR_"+e];++e)t.COLOR.push(t["COLOR_"+e]);for(let e=0;t["JOINTS_"+e];++e)t.JOINTS.push(t["JOINTS_"+e]);for(let e=0;t["WEIGHTS_"+e];++e)t.WEIGHTS.push(t["WEIGHTS_"+e])}},targetsArray:function(t){},primitiveExtensionsObject:function(t,e){if(t instanceof Object)for(const[n,i]of Object.entries(t))if("KHR_draco_mesh_compression"===n)return this.khrDracoMeshCompressionObject(i,e)},khrDracoMeshCompressionObject:function(t,e){if(!(t instanceof Object))return;if(!this.draco)return;const n=e.attributes,i=new Uint8Array(this.bufferViews[t.bufferView].buffer);this.dracoDecodeMesh(this.draco,i,t.attributes,(function(t){Object.defineProperty(e.indices,"array",{value:t})}),(function(t,e){n[t]&&Object.defineProperty(n[t],"array",{value:e})}))},dracoDecodeMesh:function(t,e,n,i,o){const r=new t.DecoderBuffer,s=new t.Decoder;let a,u;r.Init(e,e.byteLength);try{const e=s.GetEncodedGeometryType(r);switch(e){case t.TRIANGULAR_MESH:a=new t.Mesh,u=s.DecodeBufferToMesh(r,a);break;case t.POINT_CLOUD:a=new t.PointCloud,u=s.DecodeBufferToPointCloud(r,a);break;default:throw new Error(`Invalid geometry type ${e}.`)}if(!u.ok()||!a.ptr)throw new Error(u.error_msg());if(e===t.TRIANGULAR_MESH){const e=3*a.num_faces(),n=4*e,o=t._malloc(n);try{const r=new Uint32Array(e);s.GetTrianglesUInt32Array(a,n,o),r.set(new Uint32Array(t.HEAPF32.buffer,o,e)),i(r)}finally{t._free(o)}}for(const[e,i]of Object.entries(n)){const n=s.GetAttributeByUniqueId(a,i),r=n.num_components(),u=a.num_points()*r,c=u*Float32Array.BYTES_PER_ELEMENT,l=t._malloc(c);try{const i=new Float32Array(u);s.GetAttributeDataArrayForAllPoints(a,n,t.DT_FLOAT32,c,l),i.set(new Float32Array(t.HEAPF32.buffer,l,u)),o(e,i)}finally{t._free(l)}}}finally{a&&t.destroy(a),t.destroy(s),t.destroy(r)}},createDraco:async function(){if(this.constructor.draco)return this.constructor.draco;{const t=await fetch(cr.getLibUrl("draco_decoder_gltf.js")),e=await t.text(),n=await new Function(e)()();return this.constructor.draco=n}},camerasArray:function(t){t instanceof Array&&(this.cameras=t)},cameraObject:function(t){if(!(t instanceof Object))return null;if(void 0!==t.viewpointNode)return t.viewpointNode;const e=this.cameraType(t);if(!e)return t.viewpointNode=null;const n=this.getExecutionContext(),i=this.sanitizeName(t.name);return i&&(n.addNamedNode(n.getUniqueName(i),e),n.addExportedNode(n.getUniqueExportName(i),e)),t.name?e._description=t.name:e._description="Viewpoint "+ ++this.viewpoints,e._position=Se.Zero,e._centerOfRotation=new Se(0,0,-10),t.viewpointNode=e},cameraType:function(t){switch(t.type){case"orthographic":return this.orthographicCamera(t.orthographic);case"perspective":return this.perspectiveCamera(t.perspective);default:return null}},orthographicCamera:function(t){const e=this.getExecutionContext().createNode("OrthoViewpoint",!1);return"number"==typeof t.xmag&&(e._fieldOfView[0]=-t.xmag/2,e._fieldOfView[2]=+t.xmag/2),"number"==typeof t.ymag&&(e._fieldOfView[1]=-t.ymag/2,e._fieldOfView[3]=+t.ymag/2),"number"==typeof t.znear&&(e._nearDistance=t.znear),"number"==typeof t.zfar&&(e._farDistance=t.zfar),e.setup(),e},perspectiveCamera:function(t){const e=this.getExecutionContext().createNode("Viewpoint",!1);return"number"==typeof t.yfov&&(e._fieldOfView=t.yfov),"number"==typeof t.znear&&(e._nearDistance=t.znear),"number"==typeof t.zfar&&(e._farDistance=t.zfar),e.setup(),e},nodesArray:function(t){t instanceof Array&&(this.nodes=t)},nodeObject:function(t){if(!(t instanceof Object))return;if(void 0!==t.childNode)return t.childNode;const e=this.getExecutionContext(),n=e.createNode("Transform",!1),i=this.sanitizeName(t.name);i&&(e.addNamedNode(e.getUniqueName(i),n),e.addExportedNode(e.getUniqueExportName(i),n));const o=new Se(0,0,0),r=new We(0,0,0,1),s=new an,a=new Se(1,1,1),u=new an,c=new dn;this.vectorValue(t.matrix,c)?(c.get(o,s,a,u),n._translation=o,n._rotation=s,n._scale=a,n._scaleOrientation=u):(this.vectorValue(t.translation,o)&&(n._translation=o),this.vectorValue(t.rotation,r)&&(n._rotation=new an(r)),this.vectorValue(t.scale,a)&&(n._scale=a));const l=this.cameraObject(this.cameras[t.camera]);l&&n._children.push(l),this.nodeExtensions(t.extensions,n);const h=this.meshes[t.mesh];return h&&n._children.push(...this.meshObject(h)),n._children.push(...this.nodeChildrenArray(t.children)),n.setup(),0===n._children.length?t.childNode=null:t.childNode=n},nodeExtensions:function(t,e){t instanceof Object&&this.nodeLight(t.KHR_lights_punctual,e)},nodeLight:function(t,e){if(!(t instanceof Object))return;const n=this.lightObject(this.lights[t.light]);n&&(++this.usedLights,e._children.push(n))},nodeChildrenArray:function(t){return t instanceof Array?t.map((t=>this.nodeObject(this.nodes[t],t))).filter((t=>t)):[]},scenesArray:function(t,e){if(!(t instanceof Array))return;const n=this.getExecutionContext(),i=t.map((t=>this.sceneObject(t)));switch(i.length){case 0:return;case 1:if(0===e)return this.usedLights&&n.getRootNodes().push(this.createNavigationInfo()),void n.getRootNodes().push(i[0]);default:{this.usedLights&&n.getRootNodes().push(this.createNavigationInfo());const t=n.createNode("Switch",!1);return n.addNamedNode(n.getUniqueName("Scenes"),t),n.addExportedNode(n.getUniqueExportName("Scenes"),t),t._whichChoice=e,t._children=i,t.setup(),void n.getRootNodes().push(t)}}},sceneObject:function(t){if(!(t instanceof Object))return null;const e=this.sceneNodesArray(t.nodes);switch(e.length){case 0:return null;case 1:return e[0];default:{const n=this.getExecutionContext(),i=n.createNode("Group",!1),o=this.sanitizeName(t.name);return o&&(n.addNamedNode(n.getUniqueName(o),i),n.addExportedNode(n.getUniqueExportName(o),i)),i._children=e,i.setup(),i}}},sceneNodesArray:function(t){return this.nodeChildrenArray(t)},animationsArray:function(t){if(!(t instanceof Array))return;const e=t.map((t=>this.animationObject(t))).filter((t=>t));if(!e.length)return;const n=this.getExecutionContext(),i=n.createNode("Group",!1);n.addNamedNode(n.getUniqueName("Animations"),i),n.addExportedNode(n.getUniqueExportName("Animations"),i),i._children=e,i.setup(),n.getRootNodes().push(i)},animationObject:function(t){if(!(t instanceof Object))return null;const e=this.getExecutionContext(),n=e.createNode("TimeSensor",!1),i=this.animationChannelsArray(t.channels,t.samplers,n);if(!i.length)return null;const o=e.createNode("Group",!1),r=this.sanitizeName(t.name);return++this.animations,e.addNamedNode(e.getUniqueName(r||`Animation${this.animations}`),o),e.addNamedNode(e.getUniqueName(`Timer${this.animations}`),n),e.addExportedNode(e.getUniqueExportName(r||`Animation${this.animations}`),o),e.addExportedNode(e.getUniqueExportName(`Timer${this.animations}`),n),n._description=t.name||`Animation ${this.animations}`,o._children.push(n,...i),n.setup(),o.setup(),o},animationChannelsArray:function(t,e,n){if(!(t instanceof Array))return[];if(!(e instanceof Array))return[];const i=e.map((t=>this.accessors[t.input])).filter((t=>t&&t.array.length)).reduce(((t,e)=>Math.max(t,e.array.at(-1))),0);return n._loop=ho,n._cycleInterval=i,t.map((t=>this.animationChannelObject(t,e,n))).filter((t=>t))},animationChannelObject:function(t,e,n){if(!(t instanceof Object))return null;const i=t.target;if(!(i instanceof Object))return null;const o=this.nodeObject(this.nodes[i.node]);if(!o)return null;const r=e[t.sampler];if(!r)return null;const s=this.accessors[r.input];if(!s)return null;if(!s.array.length)return null;const a=this.accessors[r.output];if(!a)return null;if(!a.array.length)return null;const u=this.getExecutionContext(),c=this.createInterpolator(i.path,r.interpolation,s.array,a.array,n._cycleInterval.getValue());return c?(u.addRoute(n,"fraction_changed",c,"set_fraction"),u.addRoute(c,"value_changed",o,i.path),c):null},skinsArray:function(t){},createNavigationInfo:function(){const t=this.getExecutionContext().createNode("NavigationInfo",!1);return t._headlight=!1,t.setup(),t},createShape:function(t){const e=this.getExecutionContext().createNode("Shape",!1),n=this.materialObject(t.material),i=this.createGeometry(t);return e._appearance=n,e._geometry=i,e.setup(),e},getDefaultAppearance:function(){if(this.defaultAppearance)return this.defaultAppearance;const t=this.getExecutionContext(),e=t.createNode("Appearance",!1),n=t.createNode("PhysicalMaterial",!1);return e._alphaMode="OPAQUE",e._material=n,n.setup(),e.setup(),this.defaultAppearance=e,e},createMultiTextureTransform:function(t){if(!+t.getTextureBits())return null;const e=this.textureTransformNodes.sort(((t,e)=>d.cmp(t._mapping.getValue(),e._mapping.getValue())));switch(e.length){case 0:{if(this.textureTransformNode)return this.textureTransformNode;const t=this.getExecutionContext().createNode("TextureTransform",!1);return t._translation.y=-1,t._scale.y=-1,t.setup(),this.textureTransformNode=t}case 1:return e[0];default:{const t=this.getExecutionContext().createNode("MultiTextureTransform",!1);return t._textureTransform=e,t.setup(),t}}},createGeometry:function(t){switch(t.mode){case 0:return this.createPointSet(t);case 1:return t.indices?this.createIndexedLineSet(t,1):this.createLineSet(t);case 2:return this.createIndexedLineSet(t,2);case 3:return this.createIndexedLineSet(t,3);default:case 4:return t.indices?this.createIndexedTriangleSet(t):this.createTriangleSet(t);case 5:return t.indices?this.createIndexedTriangleStripSet(t):this.createTriangleStripSet(t);case 6:return t.indices?this.createIndexedTriangleFanSet(t):this.createTriangleFanSet(t)}},createPointSet:function({attributes:t,material:e}){const n=this.getExecutionContext().createNode("PointSet",!1);return n._color=this.createColor(t.COLOR[0],e),n._normal=this.createNormal(t.NORMAL),n._coord=this.createCoordinate(t.POSITION),n.setup(),n},createIndexedLineSet:function({attributes:t,indices:e,material:n},i){const o=this.getExecutionContext().createNode("IndexedLineSet",!1);switch(o._color=this.createColor(t.COLOR[0],n),o._normal=this.createNormal(t.NORMAL),o._coord=this.createCoordinate(t.POSITION),i){case 1:{const t=o._coordIndex,n=e.array,i=n.length;for(let e=0;e<i;e+=2)t.push(n[e],n[e+1],-1);break}case 2:{const t=o._coordIndex;if(e)t.push(...e.array),t.length&&t.push(t[0],-1);else{const e=o._coord;e&&e.point.length&&t.push(...e.point.keys(),0,-1)}break}case 3:{const t=o._coordIndex;if(e)t.push(...e.array),t.length&&t.push(-1);else{const e=o._coord;e&&e.point.length&&t.push(...e.point.keys(),-1)}break}}return o.setup(),o},createLineSet:function({attributes:t,material:e}){const n=this.getExecutionContext().createNode("LineSet",!1);return n._color=this.createColor(t.COLOR[0],e),n._normal=this.createNormal(t.NORMAL),n._coord=this.createCoordinate(t.POSITION),n.setup(),n},createIndexedTriangleSet:function({attributes:t,indices:e,material:n}){const i=this.getExecutionContext().createNode("IndexedTriangleSet",!1);return i._solid=!n||!n.doubleSided,i._index=e.array,i._color=this.createColor(t.COLOR[0],n),i._texCoord=this.createMultiTextureCoordinate(t.TEXCOORD,n),i._normal=this.createNormal(t.NORMAL),i._coord=this.createCoordinate(t.POSITION),i._normalPerVertex=!!i._normal,i.setup(),i},createTriangleSet:function({attributes:t,material:e}){const n=this.getExecutionContext().createNode("TriangleSet",!1);return n._solid=!e||!e.doubleSided,n._color=this.createColor(t.COLOR[0],e),n._texCoord=this.createMultiTextureCoordinate(t.TEXCOORD,e),n._normal=this.createNormal(t.NORMAL),n._coord=this.createCoordinate(t.POSITION),n._normalPerVertex=!!n._normal,n.setup(),n},createIndexedTriangleStripSet:function({attributes:t,indices:e,material:n}){const i=this.getExecutionContext().createNode("IndexedTriangleStripSet",!1);return i._solid=!n||!n.doubleSided,i._index=e.array,i._color=this.createColor(t.COLOR[0],n),i._texCoord=this.createMultiTextureCoordinate(t.TEXCOORD,n),i._normal=this.createNormal(t.NORMAL),i._coord=this.createCoordinate(t.POSITION),i._normalPerVertex=!!i._normal,i.setup(),i},createTriangleStripSet:function({attributes:t,material:e}){const n=this.getExecutionContext().createNode("TriangleStripSet",!1);n._solid=!e||!e.doubleSided,n._color=this.createColor(t.COLOR[0],e),n._texCoord=this.createMultiTextureCoordinate(t.TEXCOORD,e),n._normal=this.createNormal(t.NORMAL),n._coord=this.createCoordinate(t.POSITION),n._normalPerVertex=!!n._normal;const i=n._coord;return i&&i.point.length&&(n._stripCount=[i.point.length]),n.setup(),n},createIndexedTriangleFanSet:function({attributes:t,indices:e,material:n}){const i=this.getExecutionContext().createNode("IndexedTriangleFanSet",!1);return i._solid=!n||!n.doubleSided,i._index=e.array,i._color=this.createColor(t.COLOR[0],n),i._texCoord=this.createMultiTextureCoordinate(t.TEXCOORD,n),i._normal=this.createNormal(t.NORMAL),i._coord=this.createCoordinate(t.POSITION),i._normalPerVertex=!!i._normal,i.setup(),i},createTriangleFanSet:function({attributes:t,material:e}){const n=this.getExecutionContext().createNode("TriangleFanSet",!1);n._solid=!e||!e.doubleSided,n._color=this.createColor(t.COLOR[0],e),n._texCoord=this.createMultiTextureCoordinate(t.TEXCOORD,e),n._normal=this.createNormal(t.NORMAL),n._coord=this.createCoordinate(t.POSITION),n._normalPerVertex=!!n._normal;const i=n._coord;return i&&i.point.length&&(n._fanCount=[i.point.length]),n.setup(),n},createColor:function(){const t=new Map([["VEC3","Color"],["VEC4","ColorRGBA"]]);return function(e,n){if(!(e instanceof Object))return null;const i=t.get(e.type);if(!i)return null;if(e.colorNode)return e.colorNode;const o=this.getExecutionContext(),r="OPAQUE"===this.materialObject(n)._alphaMode.getValue(),s=o.createNode(r?"Color":i,!1);return s._color=r&&"Color"!==i?e.array.filter(((t,e)=>(e+1)%4)):e.array,s.setup(),e.colorNode=s}}(),createMultiTextureCoordinate:function(t,e){if(!+this.materialObject(e)._material.getValue().getTextureBits())return null;if(t.textureCoordinateNode)return t.textureCoordinateNode;switch(e.texCoordMappings.size){case 0:return null;case 1:return t.textureCoordinateNode=[...e.texCoordMappings.entries()].map((([e,n])=>this.createTextureCoordinate(t[n],e)))[0];default:{const n=[...e.texCoordMappings.entries()].map((([e,n])=>this.createTextureCoordinate(t[n],e))).filter((t=>t)).sort(((t,e)=>d.cmp(t._mapping.getValue(),e._mapping.getValue())));if(!n.length)return null;const i=this.getExecutionContext().createNode("MultiTextureCoordinate",!1);return i._texCoord=n,i.setup(),t.textureCoordinateNode=i}}},createTextureCoordinate:function(t,e){if(!(t instanceof Object))return null;if("VEC2"!==t.type)return null;if(t[e])return t[e];const n=this.getExecutionContext().createNode("TextureCoordinate",!1);return n._mapping=e,n._point=t.array,n.setup(),t[e]=n},createNormal:function(t){if(!(t instanceof Object))return null;if("VEC3"!==t.type)return null;if(t.normalNode)return t.normalNode;const e=this.getExecutionContext().createNode("Normal",!1);return e._vector=t.array,e.setup(),t.normalNode=e},createCoordinate:function(t){if(!(t instanceof Object))return null;if("VEC3"!==t.type)return null;if(t.coordinateNode)return t.coordinateNode;const e=this.getExecutionContext().createNode("Coordinate",!1);return e._point=t.array,e.setup(),t.coordinateNode=e},createInterpolator:function(t,e,n,i,o){const r=this.getExecutionContext();switch(t){case"translation":{const t=this.createPositionInterpolator(e,n,i,o);return r.addNamedNode(r.getUniqueName("TranslationInterpolator"),t),t}case"rotation":{const t=this.createOrientationInterpolator(e,n,i,o);return r.addNamedNode(r.getUniqueName("RotationInterpolator"),t),t}case"scale":{const t=this.createPositionInterpolator(e,n,i,o);return r.addNamedNode(r.getUniqueName("ScaleInterpolator"),t),t}default:return null}},createPositionInterpolator:function(t,e,n,i){const o=this.getExecutionContext();switch(t){case"STEP":{const t=o.createNode("PositionInterpolator",!1);t._key.push(e[0]/i);for(let n=1,o=e.length;n<o;++n)t._key.push(e[n]/i,e[n]/i);t._keyValue.push(new Se(n[0],n[1],n[2]));for(let e=0,i=n.length-3;e<i;e+=3)t._keyValue.push(new Se(n[e+0],n[e+1],n[e+2]),new Se(n[e+3],n[e+4],n[e+5]));return t.setup(),t}default:case"LINEAR":{const t=o.createNode("PositionInterpolator",!1);return t._key=e.map((t=>t/i)),t._keyValue=n,t.setup(),t}case"CUBICSPLINE":{const t=o.createNode("PositionInterpolator",!1),r=[];for(let t=0,e=n.length;t<e;t+=3)r.push(new Se(n[t+0],n[t+1],n[t+2]));const s=[...Array(Math.floor(30*e.at(-1))).keys()].map(((t,n,i)=>n/(i.length-1)*e.at(-1)));for(const n of s)t._key.push(n/i),t._keyValue.push(this.cubicSpline(n,e,r));return t.setup(),t}}},createOrientationInterpolator:function(t,e,n,i){const o=this.getExecutionContext();switch(t){case"STEP":{const t=o.createNode("OrientationInterpolator",!1);t._key.push(e[0]/i);for(let n=1,o=e.length;n<o;++n)t._key.push(e[n]/i,e[n]/i);t._keyValue.push(new an(new We(n[0],n[1],n[2],n[3])));for(let e=0,i=n.length-4;e<i;e+=4)t._keyValue.push(new an(new We(n[e+0],n[e+1],n[e+2],n[e+3])),new an(new We(n[e+4],n[e+5],n[e+6],n[e+7])));return t.setup(),t}default:case"LINEAR":{const t=o.createNode("OrientationInterpolator",!1);t._key=e.map((t=>t/i));for(let e=0,i=n.length;e<i;e+=4)t._keyValue.push(new an(new We(n[e+0],n[e+1],n[e+2],n[e+3])));return t.setup(),t}case"CUBICSPLINE":{const t=o.createNode("OrientationInterpolator",!1),r=[];for(let t=0,e=n.length;t<e;t+=4)r.push(new We(n[t+0],n[t+1],n[t+2],n[t+3]));const s=[...Array(Math.floor(30*e.at(-1))).keys()].map(((t,n,i)=>n/(i.length-1)*e.at(-1)));for(const n of s){const o=this.cubicSpline(n,e,r).normalize();t._key.push(n/i),t._keyValue.push(new an(o))}return t.setup(),t}}},cubicSpline:function(t,e,n){const i=d.clamp(d.upperBound(e,0,e.length,t),1,e.length-1),o=i-1,r=e[i]-e[o],s=(t-e[o])/r,a=s*s,u=a*s,c=n[3*o+1].copy(),l=n[3*o+2].copy(),h=n[3*i+1].copy(),p=n[3*i+0].copy();return c.multiply(2*u-3*a+1),l.multiply(r*(u-2*a+s)),h.multiply(-2*u+3*a),p.multiply(r*(u-a)),c.add(l).add(h).add(p)},vectorValue:function(t,e){return t instanceof Array&&(t.length===e.length&&(e.set(...t),!0))},numberValue:function(t,e){return"number"!=typeof t?e:t},stringValue:function(t,e){return"string"!=typeof t?e:t}});const Ns=Os;n.set("x_ite/Parser/GLTF2Parser",Ns);const Fs=Ns;var Is=i(532);function Ms(t){rs.call(this,t),this.json=[],this.buffers=[]}Ms.prototype=Object.assign(Object.create(rs.prototype),{constructor:Ms,getEncoding:function(){return"ARRAY_BUFFER"},isValid:function(){return this.arrayBuffer instanceof ArrayBuffer&&(!(this.dataView.byteLength<12)&&(1179937895===this.dataView.getUint32(0,!0)&&(2===this.dataView.getUint32(4,!0)&&this.dataView.getUint32(8,!0)===this.dataView.byteLength)))},setInput:function(t){this.arrayBuffer=t,this.dataView=new DataView(t)},parseIntoScene:function(t,e){this.glb().then(t).catch(e)},glb:async function(){this.chunks();const t=new Fs(this.getScene());t.setBuffers(this.buffers);for(const e of this.json)t.setInput(e),t.isValid()&&await t.rootObject(t.input);return this.getScene()},chunks:function(){for(let t=12;t<this.dataView.byteLength;){const e=this.dataView.getUint32(t,!0),n=this.dataView.getUint32(t+4,!0);switch(t+=8,n){case 1313821514:this.json.push(Is.decodeText(this.arrayBuffer.slice(t,t+e)));break;case 5130562:this.buffers.push(this.arrayBuffer.slice(t,t+e))}t+=e}return this.getScene()}});const Ds=Ms;n.set("x_ite/Parser/GLB2Parser",Ds);const Rs=Ds;var Vs=i(532);const As=cs({whitespaces:/[\x20\n\t\r]+/gy,whitespacesNoLineTerminator:/[\x20\t]+/gy,comment:/#.*?(?=[\n\r])/gy,untilEndOfLine:/([^\r\n]+)/gy,mtllib:/\bmtllib\b/gy,usemtl:/\busemtl\b/gy,newmtl:/\bnewmtl\b/gy,Ka:/\bKa\b/gy,Kd:/\bKd\b/gy,Ks:/\bKs\b/gy,Ns:/\bNs\b/gy,d:/\bd\b/gy,Tr:/\bTr\b/gy,illum:/\billum\b/gy,map_Kd:/\bmap_Kd\b/gy,o:/\bo\b/gy,v:/\bv\b/gy,vt:/\bvt\b/gy,vn:/\bvn\b/gy,g:/\bg\b/gy,s:/\bs\b/gy,off:/\boff\b/gy,f:/\bf\b/gy,slash:/\//gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy});function Ps(t){rs.call(this,t),Es.call(this),this.removeGroups=!0,this.removeEmptyGroups=!0,this.combineGroupingNodes=!1,this.smoothingGroup=0,this.smoothingGroups=new Map,this.groups=new Map,this.materials=new Map,this.textures=new Map,this.point2=new ge,this.point3=new Se,this.lastIndex=0}function Ls(t,e){this.executionContext=t,this.input=e,this.material=t.createNode("Material"),this.materials=new Map,this.textures=new Map,this.color3=new Nt(0,0,0),this.id=""}Ps.prototype=Object.assign(Object.create(rs.prototype),Es.prototype,{constructor:Ps,CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:function(){return"STRING"},isValid:function(){return"string"==typeof this.input&&!!this.input.match(/^(?:[\x20\n\t\r]+|#.*?[\r\n])*\b(?:mtllib|usemtl|o|g|s|vt|vn|v|f)\b/)},setInput:function(t){this.input=t},parseIntoScene:function(t,e){this.obj().then(t).catch(e)},obj:async function(){const t=this.getBrowser(),e=this.getScene();return e.setEncoding("OBJ"),e.setProfile(t.getProfile("Interchange")),await this.loadComponents(),this.object=e.createNode("Transform"),this.group=e.createNode("Group"),this.defaultMaterial=e.createNode("Material"),this.texCoord=e.createNode("TextureCoordinate"),this.normal=e.createNode("Normal"),this.coord=e.createNode("Coordinate"),this.object.children.push(this.group),e.getRootNodes().push(this.object),await this.statements(),this.optimizeSceneGraph(e.getRootNodes()),this.getScene()},comments:function(){for(;this.comment(););},comment:function(){return this.whitespaces(),!!As.comment.parse(this)},whitespaces:function(){As.whitespaces.parse(this)},whitespacesNoLineTerminator:function(){As.whitespacesNoLineTerminator.parse(this)},statements:async function(){for(;await this.statement(););},statement:async function(){return!!await this.mtllibs()||(!!this.usemtl()||(!!this.o()||(!!this.g()||(!!this.s()||(!!this.vts()||(!!this.vns()||(!!this.vs()||(!!this.fs()||!!As.untilEndOfLine.parse(this)))))))))},mtllibs:async function(){if(this.comments(),As.mtllib.parse(this)){if(this.whitespacesNoLineTerminator(),As.untilEndOfLine.parse(this)){const t=this.result[1].trim().split(/\s+/);await Promise.all(t.map((t=>this.mtllib(t))))}return!0}return!1},mtllib:async function(t){try{const e=this.getExecutionContext(),n=new URL(t,e.getWorldURL()),i=await fetch(n),o=await i.arrayBuffer(),r=new Ls(e,Vs.decodeText(Vs.ungzip(o)));r.parse();for(const[t,n]of r.materials){const i=this.sanitizeName(t);i&&(e.addNamedNode(e.getUniqueName(i),n),e.addExportedNode(e.getUniqueExportName(i),n)),this.materials.set(t,n)}for(const[t,n]of r.textures){const i=this.sanitizeName(t);i&&(e.addNamedNode(e.getUniqueName(i),n),e.addExportedNode(e.getUniqueExportName(i),n)),this.textures.set(t,n)}}catch(t){console.warn(t)}},usemtl:function(){if(this.comments(),As.usemtl.parse(this)){if(this.whitespacesNoLineTerminator(),As.untilEndOfLine.parse(this)){const t=this.result[1];this.material=this.materials.get(t)||this.defaultMaterial,this.texture=this.textures.get(t);const e=this.smoothingGroups.get(this.group.getNodeName());e&&e.delete(this.smoothingGroup)}return!0}return!1},o:function(){if(this.comments(),As.o.parse(this)){if(this.whitespacesNoLineTerminator(),As.untilEndOfLine.parse(this)){const t=this.getExecutionContext(),e=this.sanitizeName(this.result[1]);this.group.children.length&&(this.object=t.createNode("Transform"),this.group=t.createNode("Group"),this.object.children.push(this.group),t.getRootNodes().push(this.object)),e&&(t.addNamedNode(t.getUniqueName(e),this.object),t.addExportedNode(t.getUniqueExportName(e),this.object))}return!0}return!1},g:function(){if(this.comments(),As.g.parse(this)){if(this.whitespacesNoLineTerminator(),As.untilEndOfLine.parse(this)){const t=this.getExecutionContext(),e=this.result[1],n=this.sanitizeName(e),i=this.groups.get(e);i?this.group=i:this.group.children.length&&(this.group=t.createNode("Group"),this.object.children.push(this.group)),this.groups.set(e,this.group),n&&(t.addNamedNode(t.getUniqueName(n),this.group),t.addExportedNode(t.getUniqueExportName(n),this.group)),this.smoothingGroup=0}return!0}return!1},s:function(){return this.comments(),!!As.s.parse(this)&&(this.whitespacesNoLineTerminator(),As.off.parse(this)?(this.smoothingGroup=0,!0):!this.int32()||(this.smoothingGroup=this.value,!0))},vts:function(){const t=this.texCoord.point;let e=!1;for(;this.vt(t);)e=!0;return e},vt:function(t){if(this.comments(),As.vt.parse(this)){if(this.vec2())return t.push(this.point2),!0;throw new Error("Expected a texture coordinate.")}return!1},vns:function(){const t=this.normal.vector;let e=!1;for(;this.vn(t);)e=!0;return e},vn:function(t){if(this.comments(),As.vn.parse(this)){if(this.vec3())return t.push(this.point3),!0;throw new Error("Expected a normal vector.")}return!1},vs:function(){const t=this.coord.point;let e=!1;for(;this.v(t);)e=!0;return e},v:function(t){if(this.comments(),As.v.parse(this)){if(this.vec3())return t.push(this.point3),!0;throw new Error("Expected a vertex coordinate.")}return!1},fs:function(){if(this.comments(),As.f.lookahead(this)){try{this.shape=this.smoothingGroups.get(this.group.getNodeName()).get(this.smoothingGroup),this.geometry=this.shape.geometry}catch(t){const e=this.getExecutionContext(),n=e.createNode("Appearance");this.geometry=e.createNode("IndexedFaceSet"),this.shape=e.createNode("Shape"),n.material=this.material,n.texture=this.texture,this.geometry.creaseAngle=this.smoothingGroup?Math.PI:0,this.shape.appearance=n,this.shape.geometry=this.geometry,this.group.children.push(this.shape),this.smoothingGroups.has(this.group.getNodeName())||this.smoothingGroups.set(this.group.getNodeName(),new Map),this.smoothingGroups.get(this.group.getNodeName()).set(this.smoothingGroup,this.shape)}for(;this.f(););return this.geometry.texCoordIndex.length&&(this.geometry.texCoord=this.texCoord),this.geometry.normalIndex.length&&(this.geometry.normal=this.normal),this.geometry.coord=this.coord,!0}return!1},f:function(){if(this.comments(),As.f.parse(this)){const t=this.geometry,e=t.texCoordIndex,n=t.normalIndex,i=t.coordIndex,o=e.length,r=n.length,s=this.texCoord.point.length,a=this.normal.vector.length,u=this.coord.point.length;for(;this.indices(e,n,i,s,a,u););return e.length!==o&&e.push(-1),n.length!==r&&n.push(-1),i.push(-1),!0}return!1},indices:function(t,e,n,i,o,r){return!!this.int32()&&(n.push(this.index(this.value,r)),As.slash.parse(this)&&(this.int32()&&t.push(this.index(this.value,i)),As.slash.parse(this)&&this.int32()&&e.push(this.index(this.value,o))),!0)},index:function(t,e){if(0===t)throw new Error("Invalid index.");return t<0?e+t:t-1},int32:function(){return this.whitespaces(),!!As.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double:function(){return this.whitespaces(),As.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!As.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},vec2:function(){return!(!this.double()||(this.point2.x=this.value,!this.double()))&&(this.point2.y=this.value,!0)},vec3:function(){return!!(this.double()&&(this.point3.x=this.value,this.double()&&(this.point3.y=this.value,this.double())))&&(this.point3.z=this.value,!0)}}),Ls.prototype={CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),parse:function(){try{this.statements()}catch(t){ho}},comments:function(){for(;this.comment(););},comment:function(){return this.whitespaces(),!!As.comment.parse(this)},whitespaces:function(){As.whitespaces.parse(this)},whitespacesNoLineTerminator:function(){As.whitespacesNoLineTerminator.parse(this)},statements:function(){for(;this.statement(););},statement:function(){return!!this.newmtl()||(!!this.Ka()||(!!this.Kd()||(!!this.Ks()||(!!this.Ns()||(!!this.d()||(!!this.Tr()||(!!this.illum()||(!!this.map_Kd()||!!As.untilEndOfLine.parse(this)))))))))},newmtl:function(){return this.comments(),!!As.newmtl.parse(this)&&(this.whitespacesNoLineTerminator(),this.id="",As.untilEndOfLine.parse(this)?(this.id=this.result[1],this.material=this.executionContext.createNode("Material"),this.materials.set(this.id,this.material),!0):(As.untilEndOfLine.parse(this),!0))},Ka:function(){if(this.comments(),As.Ka.parse(this)){if(this.col3()){const t=this.color3.getHSV([]);return this.material.ambientIntensity=t[2],!0}return As.untilEndOfLine.parse(this),!0}return!1},Kd:function(){return this.comments(),!!As.Kd.parse(this)&&(this.col3()?(this.material.diffuseColor=this.color3,!0):(As.untilEndOfLine.parse(this),!0))},Ks:function(){return this.comments(),!!As.Ks.parse(this)&&(this.col3()?(this.material.specularColor=this.color3,!0):(As.untilEndOfLine.parse(this),!0))},Ns:function(){return this.comments(),!!As.Ns.parse(this)&&(this.double()?(this.material.shininess=this.value/1e3,!0):(As.untilEndOfLine.parse(this),!0))},d:function(){return this.comments(),!!As.d.parse(this)&&(this.double()?(this.material.transparency=1-this.value,!0):(As.untilEndOfLine.parse(this),!0))},Tr:function(){return this.comments(),!!As.Tr.parse(this)&&(this.double()?(this.material.transparency=this.value,!0):(As.untilEndOfLine.parse(this),!0))},illum:function(){return this.comments(),!!As.illum.parse(this)&&(this.int32()||As.untilEndOfLine.parse(this),!0)},map_Kd:function(){if(this.comments(),As.map_Kd.parse(this)){if(this.whitespacesNoLineTerminator(),As.untilEndOfLine.parse(this)){const t=this.result[1];if(t.length&&this.id.length){const e=t.trim().split(/\s+/);if(e.length){const t=this.executionContext.createNode("ImageTexture"),n=e.at(-1).replace(/\\/g,"/");t.url=[n],this.textures.set(this.id,t)}}return!0}return As.untilEndOfLine.parse(this),!0}return!1},int32:function(){return this.whitespaces(),!!As.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double:function(){return this.whitespaces(),As.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!As.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},col3:function(){return!!(this.double()&&(this.color3.r=this.value,this.double()&&(this.color3.g=this.value,this.double())))&&(this.color3.b=this.value,!0)}};const Bs=Ps;n.set("x_ite/Parser/OBJParser",Bs);const Xs=Bs,Us=cs({whitespaces:/[\x20\n\t\r]+/gy,whitespacesNoLineTerminator:/[\x20\t]+/gy,comment:/;.*?(?=[\n\r])/gy,untilEndOfLine:/([^\r\n]+)/gy,solid:/solid/gy,facet:/facet/gy,normal:/normal/gy,outer:/outer/gy,loop:/loop/gy,vertex:/vertex/gy,endloop:/endloop/gy,endfacet:/endfacet/gy,endsolid:/endsolid/gy,name:/(\w+)/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy});function ks(t){rs.call(this,t),this.vector=[],this.point=[]}ks.prototype=Object.assign(Object.create(rs.prototype),{constructor:ks,CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:function(){return"STRING"},isValid:function(){return"string"==typeof this.input&&!!this.input.match(/^(?:[\x20\n\t\r]+|;.*?[\r\n])*\b(?:solid)\b/)},setInput:function(t){this.input=t},parseIntoScene:function(t,e){this.stl().then(t).catch(e)},stl:async function(){const t=this.getBrowser(),e=this.getScene();return e.setEncoding("STL"),e.setProfile(t.getProfile("Interchange")),await this.loadComponents(),this.material=e.createNode("Material"),this.appearance=e.createNode("Appearance"),this.material.diffuseColor=Nt.White,this.appearance.material=this.material,this.statements(),this.getScene()},comments:function(){for(;this.comment(););},comment:function(){return this.whitespaces(),!!Us.comment.parse(this)},whitespaces:function(){Us.whitespaces.parse(this)},whitespacesNoLineTerminator:function(){Us.whitespacesNoLineTerminator.parse(this)},statements:function(){for(;this.solid(););},solid:function(){if(this.comments(),Us.solid.parse(this)){this.whitespacesNoLineTerminator();const t=this.getExecutionContext(),e=t.createNode("Shape"),n=t.createNode("TriangleSet"),i=t.createNode("Normal"),o=t.createNode("Coordinate"),r=this.sanitizeName(Us.name.parse(this)?this.result[1]:"");if(Us.untilEndOfLine.parse(this),this.facets(),e.appearance=this.appearance,e.geometry=n,n.normalPerVertex=!1,n.normal=i,n.coord=o,i.vector=this.vector,o.point=this.point,r&&(t.addNamedNode(t.getUniqueName(r),e),t.addExportedNode(t.getUniqueExportName(r),e)),t.getRootNodes().push(e),this.comments(),Us.endsolid.parse(this))return!0;throw new Error("Expected 'endsolid' statement.")}return!1},facets:function(){for(this.vector.length=0,this.point.length=0;this.facet(););},facet:function(){if(this.comments(),Us.facet.parse(this)&&this.normal()&&this.loop()){if(this.comments(),Us.endfacet.parse(this))return!0;throw new Error("Expected 'endfacet' statement.")}return!1},normal:function(){if(this.whitespacesNoLineTerminator(),Us.normal.parse(this)){if(this.double()){if(this.vector.push(this.value),this.double()){if(this.vector.push(this.value),this.double())return this.vector.push(this.value),!0;throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected 'normal' statement.")},loop:function(){if(this.comments(),Us.outer.parse(this)){if(this.whitespacesNoLineTerminator(),Us.loop.parse(this)&&this.vertex()&&this.vertex()&&this.vertex()){if(this.comments(),Us.endloop.parse(this))return!0;throw new Error("Expected 'endloop' statement.")}throw new Error("Expected 'loop' statement.")}throw new Error("Expected 'outer' statement.")},vertex:function(){if(this.comments(),Us.vertex.parse(this)){if(this.double()){if(this.point.push(this.value),this.double()){if(this.point.push(this.value),this.double())return this.point.push(this.value),!0;throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected 'vertex' statement.")},double:function(){return this.whitespacesNoLineTerminator(),Us.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!Us.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)}});const zs=ks;n.set("x_ite/Parser/STLAParser",zs);const js=zs;function Gs(t){rs.call(this,t)}Gs.prototype=Object.assign(Object.create(rs.prototype),{constructor:Gs,getEncoding:function(){return"ARRAY_BUFFER"},isValid:function(){if(!(this.arrayBuffer instanceof ArrayBuffer))return!1;if(this.dataView.byteLength<84)return!1;return 50*this.dataView.getUint32(80,!0)+84===this.dataView.byteLength},setInput:function(t){this.arrayBuffer=t,this.dataView=new DataView(t)},parseIntoScene:function(t,e){this.stl().then(t).catch(e)},stl:async function(){const t=this.getBrowser(),e=this.getScene();return e.setEncoding("STL"),e.setProfile(t.getProfile("Interchange")),await this.loadComponents(),this.material=e.createNode("Material"),this.appearance=e.createNode("Appearance"),this.material.diffuseColor=Nt.White,this.appearance.material=this.material,this.shape(),this.getScene()},shape:function(){const t=this.getExecutionContext(),e=t.createNode("Shape"),n=t.createNode("TriangleSet"),i=t.createNode("Normal"),o=t.createNode("Coordinate"),r=this.dataView,s=this.dataView.byteLength,a=[],u=[];for(let t=84;t<s;t+=50){for(let e=0;e<3;++e)a.push(r.getFloat32(t+4*e,!0));for(let e=3;e<12;++e)u.push(r.getFloat32(t+4*e,!0))}e.appearance=this.appearance,e.geometry=n,n.normalPerVertex=!1,n.normal=i,n.coord=o,i.vector=a,o.point=u,t.getRootNodes().push(e)}});const Hs=Gs;n.set("x_ite/Parser/STLBParser",Hs);const qs=Hs;function Ys(t,e){this.real=t,this.imag=e}Ys.prototype={constructor:Ys,[Symbol.iterator]:function*(){yield this.real,yield this.imag},copy:function(){const t=Object.create(Ys.prototype);return t.real=this.real,t.imag=this.imag,t},assign:function(t){return this.real=t.real,this.imag=t.imag,this},equals:function(t){return this.real===t.real&&this.imag===t.imag},set:function(t,e){return this.real=t,this.imag=e,this},setPolar:function(t,e){return this.real=t*Math.cos(e),this.imag=t*Math.sin(e),this},conjugate:function(){return this.imag=-this.imag,this},negate:function(){return this.real=-this.real,this.imag=-this.imag,this},inverse:function(){const t=this.real*this.real+this.imag*this.imag;return this.real/=t,this.imag/=-t,this},add:function(t){return this.real+=t.real,this.imag+=t.imag,this},subtract:function(t){return this.real-=t.real,this.imag-=t.imag,this},multiply:function(t){return this.real*=t,this.imag*=t,this},multComp:function(t){const{real:e,imag:n}=this,{real:i,imag:o}=t;return this.real=e*i-n*o,this.imag=e*o+n*i,this},divide:function(t){return this.real/=t,this.imag/=t,this},divComp:function(t){const{real:e,imag:n}=this,{real:i,imag:o}=t,r=i*i+o*o;return this.real=(e*i+n*o)/r,this.imag=(n*i-e*o)/r,this},toString:function(){let t="";return t+=this.real,this.imag<0?(t+=this.imag,t+="i"):this.imag>0&&(t+="+",t+=this.imag,t+="i"),t}},Object.defineProperties(Ys.prototype,{length:{value:2},0:{get:function(){return this.real},set:function(t){this.real=t}},1:{get:function(){return this.imag},set:function(t){this.imag=t}},magnitude:{get:function(){return this.real?this.imag?Math.hypot(this.real,this.imag):Math.abs(this.real):Math.abs(this.imag)},set:function(t){this.setPolar(t,this.angle)}},angle:{get:function(){return Math.atan2(this.imag,this.real)},set:function(t){this.setPolar(this.magnitude,t)}}}),Object.assign(Ys,{Polar:function(t,e){return Object.create(Ys.prototype).setPolar(t,e)},multiply:function(t,e){return t.copy().multiply(e)}});const Ws=Ys;n.set("standard/Math/Numbers/Complex",Ws);const Ks=Ws;function Js(){this.matrix=new Re,this.set(...arguments)}Js.prototype={constructor:Js,copy:function(){const t=Object.create(Js.prototype);return t.matrix=this.matrix.copy(),t},assign:function(t){return this.matrix.assign(t.matrix),this},equals:function(t){return this.matrix.equals(t.matrix)},set:function(t,e){switch(arguments.length){case 0:return this.matrix.set(0,0,0,0,0,0,0,0,0),this;case 2:return this.matrix.set(t.x/2,0,0,0,t.y/2,0,e.x,e.y,1),this}},setExtents:function(t,e){const n=(e.x-t.x)/2,i=(e.y-t.y)/2,o=(e.x+t.x)/2,r=(e.y+t.y)/2;return this.matrix.set(n,0,0,0,i,0,o,r,1),this},isEmpty:function(){return 0===this.matrix[8]},add:function(){const t=new ge(0,0),e=new ge(0,0),n=new ge(0,0),i=new ge(0,0);return function(o){return this.isEmpty()?this.assign(o):o.isEmpty()?this:(this.getExtents(t,e),o.getExtents(n,i),this.setExtents(t.min(n),e.max(i)))}}(),multLeft:function(t){return this.matrix.multLeft(t),this},multRight:function(t){return this.matrix.multRight(t),this},getExtents:function(t,e){this.getAbsoluteExtents(t,e),t.add(this.center),e.add(this.center)},getAbsoluteExtents:function(){const t=new ge(0,0);return function(e,n){const i=this.matrix,o=i.xAxis,r=i.yAxis;t.assign(o).add(r);const s=r.subtract(o);e.assign(t).min(s),n.assign(t).max(s),t.negate(),s.negate(),e.min(t,s),n.max(t,s)}}(),containsPoint:function(){const t=new ge(0,0),e=new ge(0,0);return function(n){return this.getExtents(t,e),t.x<=n.x&&e.x>=n.x&&t.y<=n.y&&e.y>=n.y}}(),toString:function(){return this.size+", "+this.center}},Object.assign(Js,{Extents:function(t,e){return(new Js).setExtents(t,e)},Points:function(...t){return(new Js).setExtents(t[0].copy().min(...t),t[0].copy().max(...t))}}),Object.defineProperties(Js.prototype,{size:{get:function(){const t=new ge(0,0),e=new ge(0,0);return function(){return this.getAbsoluteExtents(t,e),e.subtract(t)}}(),enumerable:!0},center:{get:function(){return this.matrix.origin},enumerable:!0}});const Zs=Js;n.set("standard/Math/Geometry/Box2",Zs);const Qs=Zs,{interval:$s}=d,ta={quadric:function(){const t=new Re(1,0,0,-2,2,0,1,-2,1),e=new Re;return function(n,i,o,r,s,a,u,c,l,h,d){e.set(n,i,o,r,s,a,u,c,l).multLeft(t);for(let t=0,n=h-1;t<h;++t){const i=t/n;d.push(e.multVecMatrix(new Se(1,i,i*i)))}}}(),cubic:function(){const t=new ze(0,0,0,0),e=new dn(1,0,0,0,-3,3,0,0,3,-6,3,0,-1,3,-3,1),n=new dn;return function(i,o,r,s,a,u,c,l,h,d,p,f,g,m){n.set(i,o,r,0,s,a,u,0,c,l,h,0,d,p,f,0).multLeft(e);for(let e=0,i=g-1;e<g;++e){const o=e/i;n.multVecMatrix(t.set(1,o,o*o,o*o*o)),m.push(new Se(t.x,t.y,t.z))}}}(),arc:function(t,e,n,i,o,r,s,a,u,c,l){if(t===a&&e===u)return void l.push(new Se(a,u,0));if(n=Math.abs(n),i=Math.abs(i),0===n||0===i)return void l.push(new Se(t,e,0),new Se(a,u,0));const h=n*n,d=i*i;o=$s(o,0,2*Math.PI);const p=Math.sin(o),f=Math.cos(o),g=new ge(t-a,e-u).divide(2),m=new ge(f*g.x+p*g.y,-p*g.x+f*g.y),_=m.copy().multVec(m),x=_.x/h+_.y/d;x>1&&(n=Math.sqrt(x)*n,i=Math.sqrt(x)*i);let y=(h*d-h*_.y-d*_.x)/(h*_.y+d*_.x);y=Math.max(0,y);const w=(r!==s?1:-1)*Math.sqrt(y),S=new ge(w*n*m.y/i,-w*i*m.x/n),T=new ge(f*S.x-p*S.y+(t+a)/2,p*S.x+f*S.y+(e+u)/2),b=new ge((m.x-S.x)/n,(m.y-S.y)/i),v=new ge((-m.x-S.x)/n,(-m.y-S.y)/i),E=t=>t>0?t:2*Math.PI+t,C=E(Math.atan2(b.y,b.x));let O=E(Math.atan2(v.y,v.x))-C;r?O<0&&(O+=2*Math.PI):O>0&&(O-=2*Math.PI),s&&O<0?O+=2*Math.PI:!s&&O>0&&(O-=2*Math.PI);const N=Math.max(4,Math.abs(O)*c/(2*Math.PI))-1;l.push(new Se(t,e,0));for(let t=1;t<N;++t){const e=C+O*(t/N),o=n*Math.cos(e),r=i*Math.sin(e);l.push(new Se(f*o-p*r+T.x,p*o+f*r+T.y,0))}l.push(new Se(a,u,0))}},ea=ta;n.set("standard/Math/Algorithms/Bezier",ea);const na=ea;const ia=function(t){return Object.assign([new t],{top:0,set:function(t){this[this.top].assign(t)},get:function(){return this[this.top]},push:function(){const t=++this.top;t<this.length?this[t].assign(this[t-1]):this[t]=this[t-1].copy()},pushMatrix:function(t){const e=++this.top;e<this.length?this[e].assign(t):this[e]=t.copy()},pop:function(){--this.top},clear:function(){this.top=0},size:function(){return this.top+1},identity:function(){this[this.top].identity()},multLeft:function(t){this[this.top].multLeft(t)},translate:function(t){this[this.top].translate(t)},rotate:function(t){this[this.top].rotate(t)},scale:function(t){this[this.top].scale(t)}})};n.set("standard/Math/Utility/MatrixStack",ia);const oa=ia;var ra=i(532),sa=i(513);const aa=cs({whitespaces:/[\x20\n\t\r]+/gy,comma:/,/gy,openParenthesis:/\(/gy,closeParenthesis:/\)/gy,length:/(em|ex|px|in|cm|mm|pt|pc|%)/gy,percent:/%/gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy,matrix:/matrix/gy,translate:/translate/gy,rotate:/rotate/gy,scale:/scale/gy,skewX:/skewX/gy,skewY:/skewY/gy,color:/([a-zA-Z]+|#[\da-fA-F]+|rgba?\(.*?\))/gy,url:/url\("?(.*?)"?\)/gy,path:/([mMlLhHvVqQtTcCsSaAzZ])/gy}),ua=.0254,ca=ua/90,la=16;function ha(t){rs.call(this,t),Es.call(this),this.removeGroups=!0,this.removeEmptyGroups=!0,this.combineGroupingNodes=!1,this.solid=!1,this.viewBox=new ze(0,0,100,100),this.modelMatrix=new oa(dn),this.fillGeometries=new Map,this.strokeGeometries=new Map,this.lineProperties=new Map,this.tessy=this.createTesselator(),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.styles=[{display:"inline",fillType:"COLOR",fillColor:qt.Black,fillURL:"",fillOpacity:1,fillRule:"nonzero",strokeType:"none",strokeColor:qt.Black,strokeURL:"",strokeOpacity:1,strokeWidth:1,opacity:1,stopColor:qt.Black,stopOpacity:1,vectorEffect:"none"}];const e=t.getBrowser();switch(e.getBrowserOption("PrimitiveQuality")){case"LOW":this.BEZIER_STEPS=6,this.CIRCLE_STEPS=20;break;case"HIGH":this.BEZIER_STEPS=10,this.CIRCLE_STEPS=64;break;default:this.BEZIER_STEPS=8,this.CIRCLE_STEPS=32}switch(e.getBrowserOption("TextureQuality")){case"LOW":this.GRADIENT_SIZE=128;break;case"HIGH":this.GRADIENT_SIZE=512;break;default:this.GRADIENT_SIZE=256}this.canvas.width=this.GRADIENT_SIZE,this.canvas.height=this.GRADIENT_SIZE}ha.prototype=Object.assign(Object.create(rs.prototype),Es.prototype,{constructor:ha,CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:function(){return"XML"},isValid:function(){return this.input instanceof XMLDocument&&(!!ra(this.input).children("svg").length||"svg"===this.input.nodeName)},setInput(t){try{"string"==typeof t&&(t=ra.parseXML(t)),this.input=t}catch(t){this.input=void 0}},parseIntoScene:function(t,e){this.xmlElement(this.input).then(t).catch(e)},xmlElement:async function(t){switch(t.nodeName){case"#document":{const e=ra(t).children("svg");for(const t of e)await this.svgElement(t);break}case"svg":await this.svgElement(t)}return this.getScene()},svgElement:async function(t){const e=this.getBrowser(),n=this.getScene();n.setEncoding("SVG"),n.setProfile(e.getProfile("Interchange")),n.addComponent(e.getComponent("Geometry2D",2)),await this.loadComponents(),this.document=this.input,this.rootTransform=n.createNode("Transform"),this.groupNodes=[this.rootTransform],this.texturePropertiesNode=this.createTextureProperties();const i=n.createNode("Background");i.skyColor=[1,1,1],n.getRootNodes().push(i);const o=n.createNode("NavigationInfo");o.type=["PLANE_create3000.github.io","PLANE","EXAMINE","ANY"],n.getRootNodes().push(o);const r=this.lengthAttribute(t.getAttribute("width"),300,"width"),s=this.lengthAttribute(t.getAttribute("height"),150,"height"),a=this.viewBox.set(0,0,r,s),u=this.viewBoxAttribute(t.getAttribute("viewBox"),a),c=this.lengthAttribute(t.getAttribute("width"),u[2],"width"),l=this.lengthAttribute(t.getAttribute("height"),u[3],"height");{const t=c/l;u[2]/u[3]>t?u[3]+=u[2]/t-u[3]:u[2]+=u[3]*t-u[2]}const h=n.createNode("OrthoViewpoint"),d=(u.x+c/2)*ca,p=-(u.y+l/2)*ca;h.position=new Se(d,p,10),h.centerOfRotation=new Se(d,p,0),h.fieldOfView=[-c/2*ca,-l/2*ca,c/2*ca,l/2*ca],n.getRootNodes().push(h);const f=new Se(c*ca/u[2],-l*ca/u[3],1),g=new Se(-u.x,u.y,0).multVec(f);this.rootTransform.translation=g,this.rootTransform.scale=f,this.elements(t),n.addNamedNode(n.getUniqueName("ViewBox"),this.rootTransform),n.addExportedNode(n.getUniqueExportName("ViewBox"),this.rootTransform),n.getRootNodes().push(this.rootTransform),this.optimizeSceneGraph(n.getRootNodes())},elements:function(t){for(const e of t.childNodes)this.element(e)},element:function(t){switch(t.nodeName){case"use":return this.useElement(t);case"g":return this.gElement(t);case"switch":return this.switchElement(t);case"a":return this.aElement(t);case"rect":return this.rectElement(t);case"circle":return this.circleElement(t);case"ellipse":return this.ellipseElement(t);case"text":return this.textElement(t);case"image":return this.imageElement(t);case"polyline":return this.polylineElement(t);case"polygon":return this.polygonElement(t);case"path":return this.pathElement(t)}},useElement:function(t){const e=this.hrefAttribute(t.getAttribute("href")||t.getAttribute("xlink:href"));if(!e)return;if(!this.styleAttributes(t))return;const n=this.lengthAttribute(t.getAttribute("x"),0,"width"),i=this.lengthAttribute(t.getAttribute("y"),0,"height"),o=(this.lengthAttribute(t.getAttribute("width"),0,"width"),this.lengthAttribute(t.getAttribute("height"),0,"height"),this.createTransform(t,new ge(n,i)));this.groupNodes.push(o),this.element(e),this.popAll()},gElement:function(t){if(!this.styleAttributes(t))return;const e=this.createTransform(t);this.groupNodes.push(e),this.elements(t),this.popAll()},switchElement:function(t){if(!this.styleAttributes(t))return;const e=this.getExecutionContext(),n=this.createTransform(t),i=e.createNode("Switch");n.children.push(i),i.whichChoice=0,this.groupNodes.push(i),this.elements(t),this.popAll()},aElement:function(t){if(!this.styleAttributes(t))return;const e=t.getAttribute("href")||t.getAttribute("xlink:href"),n=t.getAttribute("title")||t.getAttribute("xlink:title"),i=t.getAttribute("target"),o=this.getExecutionContext(),r=this.createTransform(t),s=o.createNode("Anchor");r.children.push(s),s.description=n,s.url=[e],i&&(s.parameter=["target="+i]),this.groupNodes.push(s),this.elements(t),this.popAll()},rectElement:function(t){const e=this.lengthAttribute(t.getAttribute("x"),0,"width"),n=this.lengthAttribute(t.getAttribute("y"),0,"height"),i=this.lengthAttribute(t.getAttribute("width"),0,"width"),o=this.lengthAttribute(t.getAttribute("height"),0,"height");let r=Math.max(0,this.lengthAttribute(t.getAttribute("rx"),0,"width")),s=Math.max(0,this.lengthAttribute(t.getAttribute("ry"),0,"height"));if(0===r&&0===s){if(!this.styleAttributes(t))return;const r=this.getExecutionContext(),s=new ge(i,o),a=new ge(e+i/2,n+o/2),u=new Qs(s,a),c=this.createTransform(t,a);if(this.groupNodes.push(c),"none"!==this.style.fillType){const e=r.createNode("Shape"),n=this.fillGeometries.get(t);if(c.children.push(e),e.appearance=this.createFillAppearance(u),n)e.geometry=n;else{const n=r.createNode("Rectangle2D");this.fillGeometries.set(t,n),e.geometry=n,n.solid=this.solid,n.size=s}}if("none"!==this.style.strokeType){const e=r.createNode("Shape"),n=this.strokeGeometries.get(t);if(c.children.push(e),e.appearance=this.createStrokeAppearance(),n)e.geometry=n;else{const n=r.createNode("Polyline2D"),s=i/2,a=o/2;this.strokeGeometries.set(t,n),e.geometry=n,n.lineSegments=[s,a,-s,a,-s,-a,s,-a,s,a]}}this.popAll()}else{r&&!s&&(s=r),s&&!r&&(r=s),r=Math.min(r,i/2),s=Math.min(s,o/2);const a=[e+i-r,e+r,e+r,e+i-r],u=[n+o-s,n+o-s,n+s,n+s],c=Object.assign([],{closed:!0});for(let t=0;t<4;++t){const e=t*Math.PI/2;for(let n=0,i=this.CIRCLE_STEPS/4;n<i;++n){const o=Ks.Polar(1,e+Math.PI/2*n/(i-1));c.push(new Se(a[t]+o.real*r,u[t]+o.imag*s,0))}}c.pop(),this.pathLikeElement(t,[c])}},circleElement:function(t){if(!this.styleAttributes(t))return;const e=this.lengthAttribute(t.getAttribute("cx"),0,"width"),n=this.lengthAttribute(t.getAttribute("cy"),0,"height"),i=this.lengthAttribute(t.getAttribute("r"),0),o=this.getExecutionContext(),r=new Qs(new ge(2*i,2*i),new ge(e,n)),s=this.createTransform(t,new ge(e,n));if(this.groupNodes.push(s),"none"!==this.style.fillType){const e=o.createNode("Shape"),n=this.fillGeometries.get(t);if(s.children.push(e),e.appearance=this.createFillAppearance(r),n)e.geometry=n;else{const n=o.createNode("Disk2D");this.fillGeometries.set(t,n),e.geometry=n,n.solid=this.solid,n.outerRadius=i}}if("none"!==this.style.strokeType){const e=o.createNode("Shape"),n=this.strokeGeometries.get(t);if(s.children.push(e),e.appearance=this.createStrokeAppearance(),n)e.geometry=n;else{const n=o.createNode("Circle2D");this.strokeGeometries.set(t,n),e.geometry=n,n.radius=i}}this.popAll()},ellipseElement:function(t){if(!this.styleAttributes(t))return;const e=this.lengthAttribute(t.getAttribute("cx"),0,"width"),n=this.lengthAttribute(t.getAttribute("cy"),0,"height"),i=this.lengthAttribute(t.getAttribute("rx"),0,"width"),o=this.lengthAttribute(t.getAttribute("ry"),0,"height"),r=this.getExecutionContext(),s=Math.min(i,o),a=new Qs(new ge(2*i,2*o),new ge(e,n)),u=this.createTransform(t,new ge(e,n),new ge(i/s,o/s));if(this.groupNodes.push(u),"none"!==this.style.fillType){const e=r.createNode("Shape"),n=this.fillGeometries.get(t);if(u.children.push(e),e.appearance=this.createFillAppearance(a),n)e.geometry=n;else{const n=r.createNode("Disk2D");this.fillGeometries.set(t,n),e.geometry=n,n.solid=this.solid,n.outerRadius=s}}if("none"!==this.style.strokeType){const e=r.createNode("Shape"),n=this.strokeGeometries.get(t);if(u.children.push(e),e.appearance=this.createStrokeAppearance(),n)e.geometry=n;else{const n=r.createNode("Circle2D");this.strokeGeometries.set(t,n),e.geometry=n,n.radius=s}}this.popAll()},textElement:function(t){},imageElement:function(t){const e=this.fillGeometries.get(t);if(e)this.groupNodes.at(-1).children.push(e);else{if(!this.styleAttributes(t))return;const e=this.lengthAttribute(t.getAttribute("x"),0,"width"),n=this.lengthAttribute(t.getAttribute("y"),0,"height"),i=this.lengthAttribute(t.getAttribute("width"),0,"width"),o=this.lengthAttribute(t.getAttribute("height"),0,"height"),r=t.getAttribute("href")||t.getAttribute("xlink:href"),s=this.getExecutionContext(),a=this.createTransform(t,new ge(e+i/2,n+o/2),new ge(1,-1));this.fillGeometries.set(t,a),this.groupNodes.push(a);const u=s.createNode("Shape"),c=s.createNode("Appearance"),l=s.createNode("ImageTexture"),h=s.createNode("Rectangle2D");u.appearance=c,u.geometry=h,c.texture=l,l.url=[r],l.textureProperties=this.texturePropertiesNode,h.solid=this.solid,h.size=new ge(i,o),a.children.push(u),this.popAll()}},polylineElement:function(t){const e=[];this.pointsAttribute(t.getAttribute("points"),e)&&this.pathLikeElement(t,[e])},polygonElement:function(t){const e=Object.assign([],{closed:!0});this.pointsAttribute(t.getAttribute("points"),e)&&this.pathLikeElement(t,[e])},pathElement:function(t){const e=[];this.dAttribute(t.getAttribute("d"),e)&&this.pathLikeElement(t,e)},pathLikeElement:function(t,e){if(!this.styleAttributes(t))return;e=e.map((function(t){return t.closed?Object.assign(t.filter(((t,e,n)=>t.distance(n[(e+1)%n.length])>1e-9)),{closed:!0}):t.filter(((t,e,n)=>!e||t.distance(n[e-1])>1e-9))})).filter((t=>t.length>2)),e.forEach(((t,e,n)=>t.index=e?n[e-1].index+n[e-1].length:0));const n=this.getExecutionContext(),i=this.createTransform(t),o=new Qs;for(const t of e)o.add(Qs.Points(...t));this.groupNodes.push(i);const r=n.createNode("Coordinate");for(const t of e)r.point.push(...t);if("none"!==this.style.fillType){const s=n.createNode("Shape"),a=this.fillGeometries.get(t);if(i.children.push(s),s.appearance=this.createFillAppearance(o),a)s.geometry=a;else{const i=n.createNode("IndexedTriangleSet");this.fillGeometries.set(t,i),s.geometry=i,i.solid=this.solid,i.index=this.triangulatePolygon(e,r),i.texCoord=this.createTextureCoordinate(r,o,s.appearance),i.coord=r}}if("none"!==this.style.strokeType){const o=n.createNode("Shape"),s=this.strokeGeometries.get(t);if(i.children.push(o),o.appearance=this.createStrokeAppearance(),s)o.geometry=s;else{const i=n.createNode("IndexedLineSet");this.strokeGeometries.set(t,i),o.geometry=i,i.coord=r;const s=i.coordIndex;for(const t of e){for(const e of t.keys())s.push(t.index+e);t.closed&&s.push(t.index),s.push(-1)}}}this.popAll()},linearGradientElementUrl:function(t,e){const n=this.linearGradientElement(t,e,{stops:[]}),i=this.context.createLinearGradient(n.x1,n.y1,n.x2,n.y2);return this.drawGradient(i,n,e)},linearGradientElement:function(t,e,n){if("linearGradient"!==t.nodeName)return;const i=this.hrefAttribute(t.getAttribute("href")||t.getAttribute("xlink:href"));i&&this.gradientElement(i,e,n),n.x1=this.lengthAttribute(t.getAttribute("x1"),n.x1||0,"width"),n.y1=this.lengthAttribute(t.getAttribute("y1"),n.y1||0,"height"),n.x2=this.lengthAttribute(t.getAttribute("x2"),n.x2||1,"width"),n.y2=this.lengthAttribute(t.getAttribute("y2"),n.y2||0,"height"),n.units=t.getAttribute("gradientUnits")||"objectBoundingBox",n.transform=this.transformAttribute(t.getAttribute("gradientTransform"));const o=new Re,r=new ge(n.x1,n.y1);o.translate(r),o.scale(new ge(la,la)),o.translate(r.negate()),n.spreadMatrix=o;for(const e of t.childNodes)this.gradientChild(e,n);return n},radialGradientElementUrl:function(t,e){const n=this.radialGradientElement(t,e,{stops:[]}),i=this.context.createRadialGradient(n.fx,n.fy,n.fr,n.cx,n.cy,n.r);return this.drawGradient(i,n,e)},radialGradientElement:function(t,e,n){const i=this.hrefAttribute(t.getAttribute("href")||t.getAttribute("xlink:href"));i&&this.gradientElement(i,e,n),n.cx=this.lengthAttribute(t.getAttribute("cx"),n.cx||.5,"width"),n.cy=this.lengthAttribute(t.getAttribute("cy"),n.cy||.5,"height"),n.r=this.lengthAttribute(t.getAttribute("r"),n.r||.5),n.fx=this.lengthAttribute(t.getAttribute("fx"),n.fx||n.cx,"width"),n.fy=this.lengthAttribute(t.getAttribute("fy"),n.fy||n.cy,"height"),n.fr=this.lengthAttribute(t.getAttribute("fr"),n.fr||0),n.units=t.getAttribute("gradientUnits")||"objectBoundingBox",n.spreadMethod=t.getAttribute("spreadMethod"),n.transform=this.transformAttribute(t.getAttribute("gradientTransform"));const o=new Re,r=new ge(n.fx,n.fy);o.translate(r),o.scale(new ge(la,la)),o.translate(r.negate()),n.spreadMatrix=o;for(const e of t.childNodes)this.gradientChild(e,n);return n},gradientElement:function(t,e,n){if(t)switch(t.nodeName){case"linearGradient":return this.linearGradientElement(t,e,n);case"radialGradient":return this.radialGradientElement(t,e,n)}},gradientChild:function(t,e){if("stop"===t.nodeName)return this.stopElement(t,e)},stopElement:function(t,e){if(!this.styleAttributes(t))return;const n=this.percentAttribute(t.getAttribute("offset"),0);if(n<0||n>1)return;const{stopColor:i,stopOpacity:o}=this.style;e.stops.push([n,i,o]),this.styles.pop()},drawGradient:function(t,e,n){switch(e.spreadMethod){default:e.spreadMatrix.identity();for(const[n,i,o]of e.stops)t.addColorStop(n,this.cssColor(i,o));break;case"repeat":for(let n=0;n<la;++n){const i=n/la;for(const[n,o,r]of e.stops)t.addColorStop(i+n/la,this.cssColor(o,r))}break;case"reflect":for(let n=0;n<la;++n){const i=n/la;for(const[o,r,s]of e.stops)t.addColorStop(i+(n%2?1-o:o)/la,this.cssColor(r,s))}}const i=new Re;i.scale(new ge(this.GRADIENT_SIZE/2,this.GRADIENT_SIZE/2)),i.translate(ge.One),i.scale(new ge(1,-1)),"userSpaceOnUse"===e.units?i.multLeft(n.matrix.copy().inverse()):i.multLeft(new Re(2,0,0,0,2,0,-1,-1,1)),i.multLeft(e.transform),i.multLeft(e.spreadMatrix);const o=this.context;return o.fillStyle=t,o.save(),o.clearRect(0,0,this.GRADIENT_SIZE,this.GRADIENT_SIZE),o.rect(0,0,this.GRADIENT_SIZE,this.GRADIENT_SIZE),o.transform(i[0],i[1],i[3],i[4],i[6],i[7]),o.fill(),o.restore(),this.canvas.toDataURL("image/png")},patternUrl:function(t){},idAttribute:function(t,e){if(null===t)return;const n=this.getExecutionContext(),i=this.sanitizeName(t);i&&(n.addNamedNode(n.getUniqueName(i),e),n.addExportedNode(n.getUniqueExportName(i),e))},viewBoxAttribute:function(t,e){if(null===t)return e;if(this.parseValue(t),this.double()){const t=this.value;if(this.double()){const e=this.value;if(this.double()){const n=this.value;if(this.double()){const i=this.value;return new ze(t,e,n,i)}}}}return e},hrefAttribute:function(t){if(!t)return;const e=this.getExecutionContext(),n=new URL(t,e.getWorldURL()).hash.slice(1);return this.document.getElementById(n)},lengthAttribute:function(t,e,n){if(null===t)return e;if(this.parseValue(t),this.double()){let t=this.value;if(aa.length.parse(this))switch(this.result[1]){case"em":t*=16;break;case"ex":case"px":break;case"in":t*=90;break;case"cm":t*=.01/ca;break;case"mm":t*=.001/ca;break;case"pt":t*=1.25;break;case"pc":t*=14.999999999999998;break;case"%":switch(n){case"width":t*=this.viewBox[2]/100;break;case"height":t*=this.viewBox[3]/100;break;default:t*=Math.hypot(this.viewBox[2],this.viewBox[3])/100}}return t}return e},percentAttribute:function(t,e){if(this.parseValue(t),this.double()){let t=this.value;return aa.percent.parse(this)&&(t/=100),d.clamp(t,0,1)}return e},pointsAttribute:function(t,e){if(null===t)return!1;for(this.parseValue(t);;){if(this.double()){const t=this.value;if(this.comma()&&this.double()){const n=this.value;if(e.push(new Se(t,n,0)),this.comma())continue}}break}return!!e.length},dAttribute:function(t,e){if(null===t)return!1;this.parseValue(t);let n=[],i="",o="",r=!1,s=0,a=0,u=0,c=0;for(;this.whitespaces(),aa.path.parse(this);){switch(i=o,o=this.result[1],r=o===o.toLowerCase(),o){case"m":case"M":for(n.length>2&&e.push(Object.assign(n,{closed:!1})),n=[];;){if(this.double()){let t=this.value;if(this.comma(),this.double()){let e=this.value;r&&(t+=s,e+=a),n.push(new Se(t,e,0)),s=t,a=e,this.comma();continue}}break}continue;case"l":case"L":for(;;){if(this.double()){let t=this.value;if(this.comma(),this.double()){let e=this.value;r&&(t+=s,e+=a),n.push(new Se(t,e,0)),s=t,a=e,this.comma();continue}}break}continue;case"h":case"H":for(;this.double();){let t=this.value;r&&(t+=s),n.push(new Se(t,a,0)),s=t,this.comma()}continue;case"v":case"V":for(;this&&this.double();){let t=this.value;r&&(t+=a),n.push(new Se(s,t,0)),a=t,this.comma()}continue;case"q":case"Q":for(;;){if(this.double()){let t=this.value;if(this.comma(),this.double()){let e=this.value;if(this.comma(),this.double()){let i=this.value;if(this.comma(),this.double()){let o=this.value;r&&(t+=s,e+=a,i+=s,o+=a),na.quadric(s,a,0,t,e,0,i,o,0,this.BEZIER_STEPS,n),s=i,a=o,u=t,c=e,this.comma();continue}}}}break}continue;case"t":case"T":for(;;){if(this.double()){let t=this.value;if(this.comma(),this.double()){let e=this.value;switch(r&&(t+=s,e+=a),i){case"Q":case"q":case"T":case"t":l=s+(s-u),h=a+(a-c);break;default:l=s,h=a}na.quadric(s,a,0,l,h,0,t,e,0,this.BEZIER_STEPS,n),s=t,a=e,this.comma();continue}}break}continue;case"c":case"C":for(;;){if(this.double()){let t=this.value;if(this.comma(),this.double()){let e=this.value;if(this.comma(),this.double()){let i=this.value;if(this.comma(),this.double()){let o=this.value;if(this.comma(),this.double()){let l=this.value;if(this.comma(),this.double()){let h=this.value;r&&(t+=s,e+=a,i+=s,o+=a,l+=s,h+=a),na.cubic(s,a,0,t,e,0,i,o,0,l,h,0,this.BEZIER_STEPS,n),s=l,a=h,u=i,c=o,this.comma();continue}}}}}}break}continue;case"s":case"S":for(;;){if(this.double()){let t=this.value;if(this.comma(),this.double()){let e=this.value;if(this.comma(),this.double()){let o=this.value;if(this.comma(),this.double()){let d=this.value;switch(r&&(t+=s,e+=a,o+=s,d+=a),i){case"C":case"c":case"S":case"s":var l=s+(s-u),h=a+(a-c);break;default:l=s,h=a}na.cubic(s,a,0,l,h,0,t,e,0,o,d,0,this.BEZIER_STEPS,n),s=o,a=d,u=t,c=e,this.comma();continue}}}}break}continue;case"a":case"A":for(;;){if(this.double()){let t=this.value;if(this.comma(),this.double()){let e=this.value;if(this.comma(),this.double()){let i=d.radians(this.value);if(this.comma(),this.int32()){let o=this.value;if(this.comma(),this.int32()){let u=this.value;if(this.comma(),this.double()){let c=this.value;if(this.comma(),this.double()){let l=this.value;r&&(c+=s,l+=a),na.arc(s,a,t,e,i,o,u,c,l,this.CIRCLE_STEPS,n),s=c,a=l,this.comma();continue}}}}}}}break}continue;case"z":case"Z":n.length>2&&(s=n[0].x,a=n[0].y,e.push(Object.assign(n,{closed:!0}))),n=[],this.comma();continue}break}return n.length>2&&e.push(Object.assign(n,{closed:!1})),!!e.length},transformAttribute:function(t){const e=new Re;if(null===t)return e;for(this.parseValue(t);;){if(this.comma(),this.whitespaces(),aa.matrix.parse(this)){if(this.whitespaces(),aa.openParenthesis.parse(this)&&this.double()){const t=this.value;if(this.comma()&&this.double()){const n=this.value;if(this.comma()&&this.double()){const i=this.value;if(this.comma()&&this.double()){const o=this.value;if(this.comma()&&this.double()){const r=this.value;if(this.comma()&&this.double()){const s=this.value;if(this.whitespaces(),aa.closeParenthesis.parse(this)){e.multLeft(new Re(t,n,0,i,o,0,r,s,1));continue}}}}}}}}else if(aa.translate.parse(this)){if(this.whitespaces(),aa.openParenthesis.parse(this)&&this.double()){const t=this.value;if(this.comma()){if(this.double())var n=this.value}else n=0;if(this.whitespaces(),aa.closeParenthesis.parse(this)){e.translate(new ge(t,n));continue}}}else if(aa.rotate.parse(this)){if(this.whitespaces(),aa.openParenthesis.parse(this)&&this.double()){const t=this.value;if(this.whitespaces(),aa.closeParenthesis.parse(this)){e.rotate(d.radians(t));continue}if(this.comma()&&this.double()){const n=this.value;if(this.comma()&&this.double()){const i=this.value;if(this.whitespaces(),aa.closeParenthesis.parse(this)){e.translate(new ge(n,i)),e.rotate(d.radians(t)),e.translate(new ge(-n,-i));continue}}}}}else if(aa.scale.parse(this)){if(this.whitespaces(),aa.openParenthesis.parse(this)&&this.double()){const t=this.value;if(this.comma()){if(this.double())var i=this.value}else i=t;if(this.whitespaces(),aa.closeParenthesis.parse(this)){e.scale(new ge(t,i));continue}}}else if(aa.skewX.parse(this)){if(this.whitespaces(),aa.openParenthesis.parse(this)&&this.double()){const t=this.value;if(this.whitespaces(),aa.closeParenthesis.parse(this)){e.skewX(d.radians(t));continue}}}else if(aa.skewY.parse(this)&&(this.whitespaces(),aa.openParenthesis.parse(this)&&this.double())){const t=this.value;if(this.whitespaces(),aa.closeParenthesis.parse(this)){e.skewY(d.radians(t));continue}}break}return e},styleAttributes:function(t){const e=Object.assign({},this.styles.at(-1));if("none"===this.style.display)return!1;this.styles.push(e);for(const e of t.attributes)this.parseStyle(e.name,e.value);return this.styleAttribute(t.getAttribute("style")),!0},styleAttribute:function(t){if(null===t)return;const e=t.split(";");for(const t of e){const e=t.split(":");2===e.length&&this.parseStyle(e[0].trim(),e[1].trim())}},parseStyle:function(t,e){if("inherit"!==e&&"unset"!=e)switch(this.parseValue(e),t){case"display":this.displayStyle(e);break;case"fill":this.fillStyle(e);break;case"fill-opacity":this.fillOpacityStyle(e);break;case"fill-rule":this.fillRuleStyle(e);break;case"stroke":this.strokeStyle(e);break;case"stroke-opacity":this.strokeOpacityStyle(e);break;case"stroke-width":this.strokeWidthStyle(e);break;case"opacity":this.opacityStyle(e);break;case"stop-color":this.stopColorStyle(e);break;case"stop-opacity":this.stopOpacityStyle(e);break;case"vector-effect":this.vectorEffectStyle(e)}},displayStyle:function(t){this.style.display="default"!==t?t:"inline"},fillStyle:function(t){if("default"===t)return this.style.fillType=this.styles[0].fillType,this.style.fillColor=this.styles[0].fillColor,void(this.style.fillURL=this.styles[0].fillURL);if("transparent"!==t){if("none"!==t)return this.urlValue()?(this.style.fillType="URL",void(this.style.fillURL=this.result[1].trim())):this.colorValue(this.styles.at(-1).fillColor)?(this.style.fillType="COLOR",void(this.style.fillColor=this.value.copy())):void 0;this.style.fillType="none"}else this.style.fillType="none"},fillOpacityStyle:function(t){"default"!==t?"transparent"!==t?this.double()&&(this.style.fillOpacity=d.clamp(this.value,0,1)):this.style.fillOpacity=0:this.style.fillOpacity=this.styles[0].fillOpacity},fillRuleStyle:function(t){this.style.fillRule="default"!==t?t:this.styles[0].fillRule},strokeStyle:function(t){if("default"===t)return this.style.strokeType=this.styles[0].strokeType,this.style.strokeColor=this.styles[0].strokeColor,void(this.style.strokeURL=this.styles[0].strokeURL);if("transparent"!==t){if("none"!==t)return this.urlValue()?(this.style.strokeType="URL",void(this.style.strokeURL=this.result[1].trim())):this.colorValue(this.styles.at(-1).strokeColor)?(this.style.strokeType="COLOR",void(this.style.strokeColor=this.value.copy())):void 0;this.style.strokeType="none"}else this.style.strokeType="none"},strokeOpacityStyle:function(t){"default"!==t?"transparent"!==t?this.double()&&(this.style.strokeOpacity=d.clamp(this.value,0,1)):this.style.strokeOpacity=0:this.style.strokeOpacity=this.styles[0].strokeOpacity},strokeWidthStyle:function(t){"default"!==t?"none"!==t?this.double()&&(this.style.strokeWidth=this.lengthAttribute(this.value,1)):this.style.strokeWidth=0:this.style.strokeWidth=this.styles[0].strokeWidth},opacityStyle:function(t){"default"!==t?"transparent"!==t?this.double()&&(this.style.opacity=d.clamp(this.value,0,1)*this.styles.at(-1).opacity):this.style.opacity=0:this.style.opacity=this.styles[0].opacity},stopColorStyle:function(t){"default"!==t?this.colorValue(qt.Black)&&(this.style.stopColor=this.value.copy()):this.style.stopColor=this.styles[0].stopColor},stopOpacityStyle:function(t){"default"!==t?"transparent"!==t?this.double()&&(this.style.stopOpacity=d.clamp(this.value,0,1)):this.style.stopOpacity=0:this.style.stopOpacity=this.styles[0].stopOpacity},vectorEffectStyle:function(t){this.style.vectorEffect="default"!==t?t:this.styles[0].vectorEffect},parseValue:function(t){this.input=t,this.lastIndex=0,this.value=void 0},whitespaces:function(){return aa.whitespaces.parse(this)},comma:function(){return!!(this.whitespaces()|aa.comma.parse(this))},int32:function(){return this.whitespaces(),!!aa.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double:function(){return this.whitespaces(),aa.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!aa.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},colorValue:function(){const t=new qt(0,0,0,0);return function(e){if(!aa.color.parse(this))return!1;const n=this.cssColor(e);return this.value=t.set(...this.convertColor(this.result[1],n)),!0}}(),urlValue:function(){return aa.url.parse(this)},cssColor:function(t,e=t.a){return`rgba(${255*t.r},${255*t.g},${255*t.b},${e})`},createTransform:function(t,e=ge.Zero,n=ge.One){const i=this.getExecutionContext(),o=this.transformAttribute(t.getAttribute("transform"));this.modelMatrix.push(),this.modelMatrix.multLeft(dn.Matrix3(o)),o.translate(e),o.scale(n);const r=i.createNode("Transform"),s=dn.Matrix3(o),a=new Se(0,0,0),u=new an,c=new Se(1,1,1),l=new an;return s.get(a,u,c,l),r.translation=a,r.rotation=u,r.scale=c,r.scaleOrientation=l,this.idAttribute(t.getAttribute("id"),r),this.groupNodes.at(-1).children.push(r),r},popAll:function(){this.groupNodes.pop(),this.modelMatrix.pop(),this.styles.pop()},createFillAppearance:function(t){const e=this.getExecutionContext(),n=e.createNode("Appearance");switch(this.style.fillType){case"none":return null;case"COLOR":{const t=e.createNode("UnlitMaterial");n.material=t,t.emissiveColor=new Nt(...this.style.fillColor),t.transparency=1-this.style.fillOpacity*this.style.opacity;break}case"URL":{const e=this.getExecutionContext().createNode("ImageTexture"),i=this.getFillUrl(this.style.fillURL,t);if(!i)return null;e.url=[i],e.textureProperties=this.texturePropertiesNode,n.texture=e;break}}return n},getFillUrl:function(t,e){const n=this.hrefAttribute(t);if(n)switch(n.nodeName){case"linearGradient":return this.linearGradientElementUrl(n,e);case"radialGradient":return this.radialGradientElementUrl(n,e);case"pattern":return this.patternUrl(n)}},createStrokeAppearance:function(){const t=this.getExecutionContext(),e=t.createNode("Appearance"),n=t.createNode("UnlitMaterial");e.material=n,n.emissiveColor=new Nt(...this.style.strokeColor),n.transparency=1-this.style.strokeOpacity*this.style.opacity;const i="non-scaling-stroke"===this.vectorEffect?this.style.strokeWidth:this.getStokeWidth();return i>1&&(e.lineProperties=this.getLineProperties(i)),e},getStokeWidth:function(){const t=this.modelMatrix.get().multDirMatrix(new Se(this.style.strokeWidth,this.style.strokeWidth,0));return(t.x+t.y)/2},getLineProperties:function(t){const e=this.lineProperties.get(t);if(e)return e;{const e=this.getExecutionContext().createNode("LineProperties");return e.linewidthScaleFactor=t,this.lineProperties.set(t,e),e}},createTextureProperties:function(){const t=this.getExecutionContext().createNode("TextureProperties");return t.generateMipMaps=!0,t.minificationFilter="NICEST",t.magnificationFilter="NICEST",t.boundaryModeS="CLAMP_TO_EDGE",t.boundaryModeT="CLAMP_TO_EDGE",t.boundaryModeR="CLAMP_TO_EDGE",t.textureCompression="DEFAULT",t},createTextureCoordinate:function(t,e,n){if(!n||!n.texture)return null;const i=this.getExecutionContext().createNode("TextureCoordinate"),o=e.matrix.copy().inverse();for(const e of t.point)i.point.push(o.multVecMatrix(new ge(e.x,e.y)).add(ge.One).divide(2));return i},createTesselator:function(){const t=new sa.GluTesselator;return t.gluTessCallback(sa.gluEnum.GLU_TESS_VERTEX_DATA,(function(t,e){e.push(t)})),t.gluTessNormal(0,0,1),t},triangulatePolygon:function(t,e){const n=this.tessy,i="evenodd"===this.style.fillRule?"GLU_TESS_WINDING_ODD":"GLU_TESS_WINDING_NONZERO",o=[];n.gluTessProperty(sa.gluEnum.GLU_TESS_WINDING_RULE,sa.windingRule[i]),n.gluTessCallback(sa.gluEnum.GLU_TESS_COMBINE,(function(t,n,i){const o=e.point.length;return e.point.push(new Se(...t)),o})),n.gluTessBeginPolygon(o);for(const e of t){n.gluTessBeginContour();for(const[t,i]of e.entries())n.gluTessVertex(i,e.index+t);n.gluTessEndContour()}return n.gluTessEndPolygon(),o}}),Object.defineProperty(ha.prototype,"style",{get:function(){return this.styles.at(-1)}});const da=ha;n.set("x_ite/Parser/SVGParser",da);const pa=da;var fa=i(532);function ga(t){rs.call(this,t),this.inputs=new Map}ga.prototype=Object.assign(Object.create(rs.prototype),{constructor:ga,parseIntoScene:function(t,e,n){for(const i of ga.Parser)try{const o=new i(this.getScene()),r=this.getInput(o.getEncoding(),t);if(void 0===r)continue;if(o.setInput(r),!o.isValid())continue;return o.pushExecutionContext(this.getExecutionContext()),o.parseIntoScene(e,n),void o.popExecutionContext()}catch(t){if(!n)throw t;return void n(t)}throw this.getScene().worldURL.startsWith("data:")?new Error("Couldn't parse X3D. No suitable file handler found for 'data:' URL."):new Error("Couldn't parse X3D. No suitable file handler found for '"+this.getScene().worldURL+"'.")},getInput:function(t,e){if(this.inputs.has(t))return this.inputs.get(t);const n=this.createInput(t,e);return this.inputs.set(t,n),n},createInput:function(t,e){try{switch(t){case"STRING":return fa.decodeText(e);case"XML":return fa.parseXML(this.getInput("STRING",e));case"JSON":return JSON.parse(this.getInput("STRING",e));case"ARRAY_BUFFER":return e instanceof ArrayBuffer?e:void 0}}catch(t){return}}}),ga.Parser=[pa,ys,Fs,Rs,Ts,ps,Xs,js,qs];const ma=ga;n.set("x_ite/Parser/GoldenGate",ma);const _a=ma,xa=new Se(0,0,0),ya=new Se(0,0,0),wa=new dn;function Sa(t,e){this.normal=e.copy(),this.distanceFromOrigin=e.dot(t)}Sa.prototype={constructor:Sa,copy:function(){const t=Object.create(Sa.prototype);return t.normal=this.normal.copy(),t.distanceFromOrigin=this.distanceFromOrigin,t},assign:function(t){return this.normal.assign(t.normal),this.distanceFromOrigin=t.distanceFromOrigin,this},set:function(t,e){return this.normal.assign(e),this.distanceFromOrigin=e.dot(t),this},multRight:function(t){return ya.assign(this.normal).multiply(this.distanceFromOrigin),wa.assign(t).inverse(),wa.multMatrixDir(xa.assign(this.normal)).normalize(),t.multVecMatrix(ya),this.normal.assign(xa),this.distanceFromOrigin=xa.dot(ya),this},multLeft:function(t){return ya.assign(this.normal).multiply(this.distanceFromOrigin),wa.assign(t).inverse(),wa.multDirMatrix(xa.assign(this.normal)).normalize(),t.multMatrixVec(ya),this.normal.assign(xa),this.distanceFromOrigin=xa.dot(ya),this},getDistanceToPoint:function(t){return t.dot(this.normal)-this.distanceFromOrigin},intersectsLine:function(t,e){const{point:n,direction:i}=t,o=i.dot(this.normal);if(0===o)return!1;const r=(this.distanceFromOrigin-this.normal.dot(n))/o;return e.x=n.x+i.x*r,e.y=n.y+i.y*r,e.z=n.z+i.z*r,!0},toString:function(){return this.normal.toString()+" "+this.distanceFromOrigin}};const Ta=Sa;n.set("standard/Math/Geometry/Plane3",Ta);const ba=Ta;var va=i(513);const Ea={area:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i,o){return t.assign(i).subtract(n).cross(e.assign(o).subtract(n)).magnitude()/2}}(),normal:function(t,e,n,i){const o=n.x-e.x,r=n.y-e.y,s=n.z-e.z,a=t.x-e.x,u=t.y-e.y,c=t.z-e.z;return i.set(r*c-s*u,s*a-o*c,o*u-r*a),i.normalize()},quadNormal:function(t,e,n,i,o){const r=n.x-t.x,s=n.y-t.y,a=n.z-t.z,u=i.x-e.x,c=i.y-e.y,l=i.z-e.z;return o.set(s*l-a*c,a*u-r*l,r*c-s*u),o.normalize()},triangulatePolygon:function(){const t=new va.GluTesselator;return t.gluTessCallback(va.gluEnum.GLU_TESS_VERTEX_DATA,(function(t,e){e.push(t)})),t.gluTessCallback(va.gluEnum.GLU_TESS_COMBINE,(function(t,e,n){return e[0]})),t.gluTessProperty(va.gluEnum.GLU_TESS_WINDING_RULE,va.windingRule.GLU_TESS_WINDING_ODD),function(e,n){t.gluTessBeginPolygon(n),t.gluTessBeginContour();for(const n of e)t.gluTessVertex(n,n.index);return t.gluTessEndContour(),t.gluTessEndPolygon(),n}}(),triangulateConvexPolygon:function(t,e){for(let n=1,i=t.length-1;n<i;++n)e.push(t[0],t[n],t[n+1])}},Ca=Ea;n.set("standard/Math/Geometry/Triangle3",Ca);const Oa=Ca,Na={min:0,max:0},Fa={min:0,max:0};function Ia(){}function Ma(t,e,n){n.min=Number.POSITIVE_INFINITY,n.max=Number.NEGATIVE_INFINITY;for(const i of t){const t=i.dot(e);t<n.min&&(n.min=t),t>n.max&&(n.max=t)}}function Da(t,e,n){return e<=t&&t<=n}Ia.isSeparated=function(t,e,n){for(const s of t)if(Ma(e,s,Na),Ma(n,s,Fa),r=Fa.max,!Da(o=Fa.min,i=Na.min,Na.max)&&!Da(i,o,r))return!0;var i,o,r;return!1};const Ra=Ia;n.set("standard/Math/Algorithms/SAT",Ra);const Va=Ra;function Aa(t,e,n){this.viewport=new ze(0,0,0,0),this.scissor=new ze(0,0,0,0),this.points=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],this.normals=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],this.edges=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],this.planes=[new ba(Se.Zero,Se.Zero),new ba(Se.Zero,Se.Zero),new ba(Se.Zero,Se.Zero),new ba(Se.Zero,Se.Zero),new ba(Se.Zero,Se.Zero),new ba(Se.Zero,Se.Zero)],arguments.length&&this.set(t,e,n)}Aa.prototype={constructor:Aa,set:function(){const t=new dn;return function(e,n,i){this.viewport.assign(n),this.scissor.assign(i);const[o,r,s,a,u,c,l,h]=this.points,d=i[0],p=d+i[2],f=i[1],g=f+i[3];t.assign(e).inverse(),Aa.unProjectPointMatrix(d,f,0,t,n,o),Aa.unProjectPointMatrix(p,f,0,t,n,r),Aa.unProjectPointMatrix(p,g,0,t,n,s),Aa.unProjectPointMatrix(d,g,0,t,n,a),Aa.unProjectPointMatrix(d,f,1,t,n,u),Aa.unProjectPointMatrix(p,f,1,t,n,c),Aa.unProjectPointMatrix(p,g,1,t,n,l),Aa.unProjectPointMatrix(d,g,1,t,n,h);const m=this.normals;Oa.normal(o,r,s,m[0]),Oa.normal(h,u,o,m[1]),Oa.normal(l,s,r,m[2]),Oa.normal(s,l,h,m[3]),Oa.normal(r,o,u,m[4]),Oa.normal(u,h,l,m[5]);const _=this.planes;return _[0].set(r,m[0]),_[1].set(u,m[1]),_[2].set(s,m[2]),_[3].set(l,m[3]),_[4].set(o,m[4]),_[5].set(h,m[5]),this.edges.tainted=!0,this}}(),getViewport:function(){return this.viewport},getScissor:function(){return this.scissor},getEdges:function(){const t=this.edges;if(t.tainted){const[e,n,i,o,r,s,a,u]=this.points;t[0].assign(e).subtract(n),t[1].assign(n).subtract(i),t[2].assign(i).subtract(o),t[3].assign(o).subtract(e),t[4].assign(e).subtract(r),t[5].assign(n).subtract(s),t[6].assign(i).subtract(a),t[7].assign(o).subtract(u),t.tainted=!1}return t},intersectsSphere:function(t,e){const[n,i,o,r,s,a,u,c]=this.planes;return!(n.getDistanceToPoint(e)>t)&&(!(i.getDistanceToPoint(e)>t)&&(!(o.getDistanceToPoint(e)>t)&&(!(r.getDistanceToPoint(e)>t)&&(!(s.getDistanceToPoint(e)>t)&&!(a.getDistanceToPoint(e)>t)))))},intersectsBox:function(){const t=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],e=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],n=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],i=[];for(let t=0;t<24;++t)i.push(new Se(0,0,0));return function(o){o.getPoints(t);const r=this.points;if(Va.isSeparated(o.getNormals(e),t,r))return!1;if(Va.isSeparated(this.normals,t,r))return!1;o.getAxes(n);const s=this.getEdges();for(let t=0;t<3;++t)for(let e=0;e<8;++e)i[3*t+e].assign(n[t]).cross(s[e]);return!Va.isSeparated(i,t,r)}}()},Object.assign(Aa,{unProjectPoint:function(){const t=new dn;return function(e,n,i,o,r,s,a){return this.unProjectPointMatrix(e,n,i,t.assign(o).multRight(r).inverse(),s,a)}}(),unProjectPointMatrix:function(){const t=new ze(0,0,0,0);return function(e,n,i,o,r,s){t.set((e-r[0])/r[2]*2-1,(n-r[1])/r[3]*2-1,2*i-1,1),o.multVecMatrix(t);const a=1/t.w;return s.set(t.x*a,t.y*a,t.z*a,1)}}(),unProjectRay:function(){const t=new dn;return function(e,n,i,o,r,s){return this.unProjectRayMatrix(e,n,t.assign(i).multRight(o).inverse(),r,s)}}(),unProjectRayMatrix:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i,o,r,s){return Aa.unProjectPointMatrix(n,i,0,o,r,t),Aa.unProjectPointMatrix(n,i,.9,o,r,e),s.setPoints(t,e)}}(),projectPoint:function(){const t=new ze(0,0,0,0);return function(e,n,i,o,r){4===e.length?t.assign(e):t.set(e.x,e.y,e.z,1),i.multVecMatrix(n.multVecMatrix(t));const s=1/(2*t.w);return r.set((t.x*s+.5)*o[2]+o[0],(t.y*s+.5)*o[3]+o[1],t.z*s+.5)}}(),projectPointMatrix:function(){const t=new ze(0,0,0,0);return function(e,n,i,o){4===e.length?t.assign(e):t.set(e.x,e.y,e.z,1),n.multVecMatrix(t);const r=1/(2*t.w);return o.set((t.x*r+.5)*i[2]+i[0],(t.y*r+.5)*i[3]+i[1],t.z*r+.5)}}(),projectLine:function(){const t=new dn;return function(e,n,i,o,r){return this.projectLineMatrix(e,t.assign(n).multRight(i),o,r)}}(),projectLineMatrix:function(){const t=new ge(0,0),e=new ge(0,0),n=new Se(0,0,0);return function(i,o,r,s){return Aa.projectPointMatrix(i.point,o,r,t),Aa.projectPointMatrix(n.assign(i.direction).multiply(1e9).add(i.point),o,r,e),s.setPoints(t,e)}}()});const Pa=Aa;n.set("standard/Math/Geometry/ViewVolume",Pa);const La=Pa;function Ba(t,e,n,i=!1){const o=t.getContext();if(this.browser=t,this.width=e,this.height=n,Object.defineProperty(this,"array",{get:function(){const t=i?new Float32Array(e*n*4):new Uint8Array(e*n*4);return Object.defineProperty(this,"array",{value:t}),t},configurable:!0}),this.lastBuffer=o.getParameter(o.FRAMEBUFFER_BINDING),this.frameBuffer=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,this.frameBuffer),this.colorTexture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.colorTexture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),i?o.texImage2D(o.TEXTURE_2D,0,o.getVersion()>1?o.RGBA32F:o.RGBA,e,n,0,o.RGBA,o.FLOAT,null):o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,n,0,o.RGBA,o.UNSIGNED_BYTE,null),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,this.colorTexture,0),o.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.depthTexture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);const t=o.getVersion()>=2?o.DEPTH_COMPONENT24:o.DEPTH_COMPONENT;o.texImage2D(o.TEXTURE_2D,0,t,e,n,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null),o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,this.depthBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,e,n),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this.depthBuffer);const r=o.checkFramebufferStatus(o.FRAMEBUFFER)===o.FRAMEBUFFER_COMPLETE;if(o.bindTexture(o.TEXTURE_2D,null),o.bindFramebuffer(o.FRAMEBUFFER,this.lastBuffer),!r)throw new Error("Couldn't create frame buffer.")}Ba.prototype={constructor:Ba,getWidth:function(){return this.width},getHeight:function(){return this.height},getColorTexture:function(){return this.colorTexture},getDepthTexture:function(){return this.depthTexture},readPixels:function(){const t=this.browser.getContext(),e=this.array,n=this.width,i=this.height;return t.readPixels(0,0,n,i,t.RGBA,t.UNSIGNED_BYTE,e),e},readDepth:function(){const t=new dn,e=new Se(0,0,0);return function(n,i){const o=this.browser.getContext(),r=this.array,s=this.width,a=this.height;o.readPixels(0,0,s,a,o.RGBA,o.FLOAT,r);let u=0,c=0,l=Number.POSITIVE_INFINITY;for(let t=0,e=0;t<a;++t)for(let n=0;n<s;++n,e+=4){const i=r[e];i<l&&(u=n,c=t,l=i)}return t.assign(n).inverse(),La.unProjectPointMatrix(u,c,l,t,i,e),e.z}}(),bind:function(){const t=this.browser.getContext();this.lastBuffer=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer)},unbind:function(){const t=this.browser.getContext();t.bindFramebuffer(t.FRAMEBUFFER,this.lastBuffer)},delete:function(){const t=this.browser.getContext();t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.colorTexture),t.HAS_FEATURE_DEPTH_TEXTURE?t.deleteTexture(this.depthTexture):t.deleteRenderbuffer(this.depthBuffer)}};for(const t of Reflect.ownKeys(Ba.prototype))Object.defineProperty(Ba.prototype,t,{enumerable:!1});const Xa=Ba;n.set("x_ite/Rendering/TextureBuffer",Xa);const Ua=Xa;let ka=0;const za={POINTER:ka++,CAMERA:ka++,PICKING:ka++,COLLISION:ka++,SHADOW:ka++,DISPLAY:ka++};n.set("x_ite/Rendering/TraverseType",za);const ja=za;function Ga(t,e){this.array=t,this.auxiliary=[],e&&(this.compare=e)}Ga.prototype={compare:function(t,e){return t<e},sort:function(t,e){this.mergeSort(t,e-1)},mergeSort:function(t,e){if(t<e){const n=t+e>>>1;this.mergeSort(t,n),this.mergeSort(n+1,e),this.merge(t,n,e)}},merge:function(t,e,n){const{array:i,auxiliary:o,compare:r}=this;let s,a,u;for(s=0,a=t;a<=e;)o[s++]=i[a++];for(s=0,u=t;u<a&&a<=n;)r(i[a],o[s])?i[u++]=i[a++]:i[u++]=o[s++];for(;u<a;)i[u++]=o[s++]}};const Ha=Ga;n.set("standard/Math/Algorithms/MergeSort",Ha);const qa=Ha,Ya={frustum:function(t,e,n,i,o,r,s){const a=e-t,u=i-n,c=r-o,l=2*o,h=(e+t)/a,d=(i+n)/u,p=-(r+o)/c,f=-l*r/c,g=l/a,m=l/u;return s.set(g,0,0,0,0,m,0,0,h,d,p,-1,0,0,f,0)},perspective:function(t,e,n,i,o,r){const s=Math.tan(t/2)*e;if(i>o){const t=i*s/o;return this.frustum(-t,t,-s,s,e,n,r)}{const t=o*s/i;return this.frustum(-s,s,-t,t,e,n,r)}},perspective2:function(t,e,n,i,o,r){const s=Math.tan(t/2)*e;return this.frustum(-s,s,-s,s,e,n,r)},ortho:function(t,e,n,i,o,r,s){const a=e-t,u=i-n,c=r-o,l=2/a,h=2/u,d=-2/c,p=-(e+t)/a,f=-(i+n)/u,g=-(r+o)/c;return s.set(l,0,0,0,0,h,0,0,0,0,d,0,p,f,g,1)},orthoBox:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i){return n.getExtents(t,e),this.ortho(t.x,e.x,t.y,e.y,-e.z,-t.z,i)}}()},Wa=Ya;n.set("standard/Math/Geometry/Camera",Wa);const Ka=Wa;function Ja(){this.matrix=new dn,this.set(...arguments)}Ja.prototype={constructor:Ja,copy:function(){const t=Object.create(Ja.prototype);return t.matrix=this.matrix.copy(),t},assign:function(t){return this.matrix.assign(t.matrix),this},equals:function(t){return this.matrix.equals(t.matrix)},getMatrix:function(){return this.matrix},set:function(t,e){switch(arguments.length){case 0:return this.matrix.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this;case 2:return this.matrix.set(t.x/2,0,0,0,0,t.y/2,0,0,0,0,t.z/2,0,e.x,e.y,e.z,1),this}},setExtents:function(t,e){const n=(e.x-t.x)/2,i=(e.y-t.y)/2,o=(e.z-t.z)/2,r=(e.x+t.x)/2,s=(e.y+t.y)/2,a=(e.z+t.z)/2;return this.matrix.set(n,0,0,0,0,i,0,0,0,0,o,0,r,s,a,1),this},getExtents:function(t,e){this.getAbsoluteExtents(t,e),t.add(this.center),e.add(this.center)},getAbsoluteExtents:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0);return function(i,o){const r=this.matrix,s=r.xAxis,a=r.yAxis,u=r.zAxis;t.assign(a).add(u);const c=u.subtract(a);e.assign(s).add(t),n.assign(s).add(c);const l=t.subtract(s),h=c.subtract(s);i.assign(e).min(l,h,n),o.assign(e).max(l,h,n),e.negate(),l.negate(),h.negate(),n.negate(),i.min(e,l,h,n),o.max(e,l,h,n)}}(),getPoints:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new Se(0,0,0);return function(o){const r=this.matrix;t.assign(r.xAxis),e.assign(r.yAxis),n.assign(r.zAxis),i.assign(e).add(n);const s=n.subtract(e);o[0].assign(t).add(i),o[1].assign(i).subtract(t),o[2].assign(s).subtract(t),o[3].assign(t).add(s),o[4].assign(o[2]).negate(),o[5].assign(o[3]).negate(),o[6].assign(o[0]).negate(),o[7].assign(o[1]).negate();const a=this.center;return o[0].add(a),o[1].add(a),o[2].add(a),o[3].add(a),o[4].add(a),o[5].add(a),o[6].add(a),o[7].add(a),o}}(),getAxes:function(t){const e=this.matrix;return t[0].assign(e.xAxis),t[1].assign(e.yAxis),t[2].assign(e.zAxis),t},getNormals:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=[Se.xAxis,Se.yAxis,Se.zAxis];return function(o){const r=this.matrix;if(t.assign(r.xAxis),e.assign(r.yAxis),n.assign(r.zAxis),0===t.norm()&&(t.assign(e).cross(n),0===t.norm())){for(const n of i)if(t.assign(n).cross(e),0!==t.norm())break;if(0===t.norm()){for(const e of i)if(t.assign(e).cross(n),0!==t.norm())break;0===t.norm()&&t.assign(Se.xAxis)}}if(0===e.norm()&&(e.assign(n).cross(t),0===e.norm())){for(const t of i)if(e.assign(t).cross(n),0!==e.norm())break;if(0===e.norm()){for(const n of i)if(e.assign(n).cross(t),0!==e.norm())break;0===e.norm()&&e.assign(Se.yAxis)}}if(0===n.norm()&&(n.assign(t).cross(e),0===n.norm())){for(const e of i)if(n.assign(e).cross(t),0!==n.norm())break;if(0===n.norm()){for(const t of i)if(n.assign(t).cross(e),0!==n.norm())break;0===n.norm()&&n.assign(Se.zAxis)}}return o[0].assign(e).cross(n).normalize(),o[1].assign(n).cross(t).normalize(),o[2].assign(t).cross(e).normalize(),o}}(),isEmpty:function(){return 0===this.matrix[15]},add:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new Se(0,0,0);return function(o){return this.isEmpty()?this.assign(o):o.isEmpty()?this:(this.getExtents(t,e),o.getExtents(n,i),this.setExtents(t.min(n),e.max(i)))}}(),multLeft:function(t){return this.matrix.multLeft(t),this},multRight:function(t){return this.matrix.multRight(t),this},containsPoint:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n){return this.getExtents(t,e),t.x<=n.x&&e.x>=n.x&&t.y<=n.y&&e.y>=n.y&&t.z<=n.z&&e.z>=n.z}}(),intersectsBox:function(){const t=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],e=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],n=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],i=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],o=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],r=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)];return function(s){if(this.isEmpty())return!1;if(s.isEmpty())return!1;if(this.getPoints(t),s.getPoints(e),Va.isSeparated(this.getNormals(r),t,e))return!1;if(Va.isSeparated(s.getNormals(r),t,e))return!1;this.getAxes(n),s.getAxes(i);for(let t=0;t<3;++t)for(let e=0;e<3;++e)o[3*t+e].assign(n[t]).cross(i[e]);return!Va.isSeparated(o,t,e)}}(),intersectsTriangle:function(){const t=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],e=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],n=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],i=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)],o=[],r=[new Se(0,0,0)],s=[new Se(0,0,0),new Se(0,0,0),new Se(0,0,0)];return function(a,u,c){if(this.isEmpty())return!1;if(this.getPoints(t),o[0]=a,o[1]=u,o[2]=c,Va.isSeparated(this.getNormals(i),t,o))return!1;if(Oa.normal(a,u,c,r[0]),Va.isSeparated(r,t,o))return!1;this.getAxes(e),s[0].assign(a).subtract(u),s[1].assign(u).subtract(c),s[2].assign(c).subtract(a);for(let t=0;t<3;++t)for(let i=0;i<3;++i)n[3*t+i].assign(e[t]).cross(s[i]);return!Va.isSeparated(n,t,o)}}(),toString:function(){return this.size+", "+this.center}},Object.assign(Ja,{Extents:function(t,e){return(new Ja).setExtents(t,e)},Points:function(...t){return(new Ja).setExtents(t[0].copy().min(...t),t[0].copy().max(...t))}}),Object.defineProperties(Ja.prototype,{size:{get:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(){return this.getAbsoluteExtents(t,e),e.subtract(t)}}(),enumerable:!0},center:{get:function(){return this.matrix.origin},enumerable:!0}});const Za=Ja;n.set("standard/Math/Geometry/Box3",Za);const Qa=Za;function $a(t,e){this.point=t.copy(),this.direction=e.copy()}$a.prototype={constructor:$a,copy:function(){const t=Object.create($a.prototype);return t.point=this.point.copy(),t.direction=this.direction.copy(),t},assign:function(t){return this.point.assign(t.point),this.direction.assign(t.direction),this},set:function(t,e){return this.point.assign(t),this.direction.assign(e),this},setPoints:function(t,e){return this.point.assign(t),this.direction.assign(e).subtract(t).normalize(),this},multMatrixLine:function(t){return t.multMatrixVec(this.point),t.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(t){return t.multVecMatrix(this.point),t.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(t,e){const n=e.assign(t).subtract(this.point).dot(this.direction);return e.assign(this.direction).multiply(n).add(this.point)},getClosestPointToLine:function(){const t=new Se(0,0,0);return function(e,n){const{point:i,direction:o}=this,{point:r,direction:s}=e;let a=o.dot(s);return!(Math.abs(a)>=1)&&(t.assign(r).subtract(i),a=(t.dot(o)-a*t.dot(s))/(1-a*a),n.assign(o).multiply(a).add(i),!0)}}(),getPerpendicularVectorToPoint:function(){const t=new Se(0,0,0);return function(e,n){return n.assign(this.point).subtract(e),n.subtract(t.assign(this.direction).multiply(n.dot(this.direction)))}}(),getPerpendicularVectorToLine:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i){const o=i;t.assign(this.point).subtract(n.point);const r=t.dot(this.direction),s=t.dot(n.direction),a=this.direction.dot(n.direction),u=a*a,c=(r-s*a)/(1-u),l=-(s-r*a)/(1-u);return e.assign(this.direction).multiply(c),o.assign(n.direction).multiply(l),o.subtract(e).add(t)}}(),intersectsTriangle:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i,o,r){const s=i.subtract(n),a=o.subtract(n);t.assign(this.direction).cross(a);const u=s.dot(t);if(0===u)return!1;const c=1/u;e.assign(this.point).subtract(n);const l=e.dot(t)*c;if(l<0||l>1)return!1;const h=e.cross(s),d=this.direction.dot(h)*c;return!(d<0||l+d>1)&&(r.u=l,r.v=d,r.t=1-l-d,!0)}}(),toString:function(){return this.point+", "+this.direction}},$a.Points=function(t,e){const n=Object.create($a.prototype);return n.point=t.copy(),n.direction=e.copy().subtract(t).normalize(),n};const tu=$a;n.set("standard/Math/Geometry/Line3",tu);const eu=tu;function nu(t){this.viewVolumes=[],this.cameraSpaceMatrix=new oa(dn),this.viewMatrix=new oa(dn),this.projectionMatrix=new oa(dn),this.modelViewMatrix=new oa(dn),this.viewportArray=new Int32Array(4),this.projectionMatrixArray=new Float32Array(16),this.cameraSpaceMatrixArray=new Float32Array(16),this.hitRay=new eu(Se.Zero,Se.Zero),this.sensors=[[]],this.localObjectsCount=[0,0,0],this.globalObjects=[],this.localObjects=[],this.lights=[],this.globalShadows=[!1],this.localShadows=[!1],this.localFogs=[null],this.layouts=[],this.textureProjectors=[],this.generatedCubeMapTextures=[],this.collisions=[],this.collisionTime=new xo,this.numPointingShapes=0,this.numCollisionShapes=0,this.numShadowShapes=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.pointingShapes=[],this.collisionShapes=[],this.activeCollisions=[],this.shadowShapes=[],this.opaqueShapes=[],this.transparentShapes=[],this.transparencySorter=new qa(this.transparentShapes,((t,e)=>t.distance<e.distance)),this.speed=0;try{this.depthBuffer=new Ua(t.getBrowser(),16,16,!0)}catch(t){console.error(t),this.getDepth=function(){return 0}}}function iu(t,e){for(var n=0,i=e.length;n<i;++n)t[n]=e[n];t.length=i}nu.prototype={constructor:nu,initialize:function(){},isIndependent:function(){return!0},getRenderTime:function(){return this.renderTime},getViewVolumes:function(){return this.viewVolumes},getViewVolume:function(){return this.viewVolumes.at(-1)},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getViewMatrix:function(){return this.viewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getModelViewMatrix:function(){return this.modelViewMatrix},getViewportArray:function(){return this.viewportArray},getProjectionMatrixArray:function(){return this.projectionMatrixArray},getCameraSpaceMatrixArray:function(){return this.cameraSpaceMatrixArray},getHitRay:function(){return this.hitRay},getSensors:function(){return this.sensors},getGlobalObjects:function(){return this.globalObjects},getLocalObjects:function(){return this.localObjects},getLocalObjectsCount:function(){return this.localObjectsCount},getLights:function(){return this.lights},pushGlobalShadows:function(t){this.globalShadows.push(t||this.globalShadows.at(-1))},getGlobalShadows:function(){return this.globalShadows},pushLocalShadows:function(t){this.localShadows.push(t||this.localShadows.at(-1))},popLocalShadows:function(){this.localShadows.pop()},setGlobalFog:function(){const t=new dn;return function(e){if(e.getFogType()){const n=this.localFogs[0]||e.getFogs().pop();t.assign(e.getModelMatrix()).multRight(this.getViewMatrix().get()),n.set(e,t),this.localFogs[0]=n}else this.localFogs[0]=null}}(),getLocalFogs:function(){return this.localFogs},getLayouts:function(){return this.layouts},getParentLayout:function(){return this.layouts.at(-1)},getTextureProjectors:function(){return this.textureProjectors},getGeneratedCubeMapTextures:function(){return this.generatedCubeMapTextures},getCollisions:function(){return this.collisions},getCollisionTime:function(){return this.collisionTime},setNumPointingShapes:function(t){this.numPointingShapes=t},getNumPointingShapes:function(){return this.numPointingShapes},getPointingShapes:function(){return this.pointingShapes},setNumCollisionShapes:function(t){this.numCollisionShapes=t},getNumCollisionShapes:function(){return this.numCollisionShapes},getCollisionShapes:function(){return this.collisionShapes},setNumShadowShapes:function(t){this.numShadowShapes=t},getNumShadowShapes:function(){return this.numShadowShapes},getShadowShapes:function(){return this.shadowShapes},setNumOpaqueShapes:function(t){this.numOpaqueShapes=t},getNumOpaqueShapes:function(){return this.numOpaqueShapes},getOpaqueShapes:function(){return this.opaqueShapes},setNumTransparentShapes:function(t){this.numTransparentShapes=t},getNumTransparentShapes:function(){return this.numTransparentShapes},getTransparentShapes:function(){return this.transparentShapes},constrainTranslation:function(t,e){const n=this.getDistance(t)-this.getNavigationInfo().getCollisionRadius();if(n>0){return t.magnitude()>n?t.normalize().multiply(n):t}return e?this.constrainTranslation(t.normalize().multiply(n),!1):t.assign(Se.Zero)},getDistance:function(){const t=new dn,e=new dn,n=new an,i=new Se(0,0,0),o=new an;return function(r){this.collisionTime.start();const s=this.getViewpoint(),a=this.getNavigationInfo(),u=a.getCollisionRadius(),c=a.getStepHeight()-a.getAvatarHeight(),l=a.getNearValue(),h=a.getAvatarHeight();Ka.ortho(-u,u,Math.min(c,-u),u,l,Math.max(2*u,2*h),t),n.assign(s._orientation.getValue()).inverse().multRight(s.getOrientation()),o.setFromToVec(Se.zAxis,i.assign(r).negate()).multRight(n),s.straightenHorizon(o),e.assign(s.getModelMatrix()),e.translate(s.getUserPosition()),e.rotate(o),e.inverse(),e.multRight(t),e.multLeft(s.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(e);const d=this.getDepth(t);return this.getProjectionMatrix().pop(),this.collisionTime.stop(),-d}}(),getDepth:function(){const t=new ze(0,0,16,16),e=new La;return e.set(dn.Identity,t,t),function(n){this.depthBuffer.bind(),this.viewVolumes.push(e),this.depth(this.collisionShapes,this.numCollisionShapes);const i=this.depthBuffer.readDepth(n,t);return this.viewVolumes.pop(),this.depthBuffer.unbind(),i}}(),render:function(t,e,n){switch(t){case ja.POINTER:this.numPointingShapes=0,e.call(n,t,this),this.pointing(this.pointingShapes,this.numPointingShapes);break;case ja.COLLISION:this.numCollisionShapes=0,e.call(n,t,this),this.collide(),this.gravite();break;case ja.SHADOW:this.numShadowShapes=0,e.call(n,t,this),this.depth(this.shadowShapes,this.numShadowShapes);break;case ja.DISPLAY:this.lightIndex=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.setGlobalFog(this.getFog()),e.call(n,t,this),this.draw()}},setHitRay:function(t,e,n){La.unProjectRay(n.x,n.y,dn.Identity,t,e,this.hitRay)},addPointingShape:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){const t=this.numPointingShapes++;t===this.pointingShapes.length&&this.pointingShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[],sensors:[]});const e=this.pointingShapes[t];return e.modelViewMatrix.set(i),e.shapeNode=n,e.scissor=r.getScissor(),iu(e.clipPlanes,this.localObjects),iu(e.sensors,this.sensors.at(-1)),!0}return!1}}(),addCollisionShape:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){const t=this.numCollisionShapes++;t===this.collisionShapes.length&&this.collisionShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),collisions:[],clipPlanes:[]});const e=this.collisionShapes[t];return e.modelViewMatrix.set(i),e.shapeNode=n,e.scissor=r.getScissor(),iu(e.collisions,this.collisions),iu(e.clipPlanes,this.localObjects),!0}return!1}}(),addShadowShape:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){const t=this.numShadowShapes++;t===this.shadowShapes.length&&this.shadowShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[]});const e=this.shadowShapes[t];return e.modelViewMatrix.set(i),e.shapeNode=n,e.scissor=r.getScissor(),iu(e.clipPlanes,this.localObjects),!0}return!1}}(),addDisplayShape:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){if(n.isTransparent()){const t=this.numTransparentShapes++;t===this.transparentShapes.length&&this.transparentShapes.push(this.createRenderContext(!0)),(s=this.transparentShapes[t]).distance=e.z}else{const t=this.numOpaqueShapes++;t===this.opaqueShapes.length&&this.opaqueShapes.push(this.createRenderContext(!1));var s=this.opaqueShapes[t]}return s.modelViewMatrix.set(i),s.scissor.assign(r.getScissor()),s.shadows=this.localShadows.at(-1),s.fogNode=this.localFogs.at(-1),s.shapeNode=n,s.appearanceNode=n.getAppearance(),iu(s.localObjects,this.localObjects),iu(s.objectsCount,this.localObjectsCount),!0}return!1}}(),createRenderContext:function(t){return{renderObject:this,transparent:t,modelViewMatrix:new Float32Array(16),scissor:new ze(0,0,0,0),localObjects:[],objectsCount:[0,0,0]}},pointing:function(){const t=new Float32Array(16);return function(e,n){const i=this.getBrowser(),o=i.getContext(),r=this.getViewVolume().getViewport(),[s,a]=i.getPointer();t.set(this.getProjectionMatrix().get()),o.viewport(r[0]-s,r[1]-a,r[2],r[3]),o.scissor(0,0,1,1),o.clear(o.DEPTH_BUFFER_BIT),o.depthMask(!0),o.enable(o.DEPTH_TEST),o.disable(o.BLEND),o.disable(o.CULL_FACE);for(let r=0;r<n;++r){const n=e[r],{scissor:u,clipPlanes:c,modelViewMatrix:l,shapeNode:h}=n,d=h.getAppearance(),p=h.getGeometryContext(),f=d.getStyleProperties(p.geometryType),g=i.getPointingShader(c.length,h),m=i.addPointingShape(n);o.scissor(u.x-s,u.y-a,u.z,u.w),g.enable(o),g.setClipPlanes(o,c),o.uniformMatrix4fv(g.x3d_ProjectionMatrix,!1,t),o.uniformMatrix4fv(g.x3d_ModelViewMatrix,!1,l),o.uniform1f(g.x3d_Id,m),f&&f.setShaderUniforms(o,g),h.displaySimple(o,n,g),i.resetTextureUnits()}}}(),collide:function(){const t=new dn,e=new dn,n=new Qa(Se.Zero,Se.Zero),i=new Se(0,0,0);return function(){const o=[],r=2.2*this.getNavigationInfo().getCollisionRadius();i.set(r,r,r);for(let r=0,s=this.numCollisionShapes;r<s;++r){const s=this.collisionShapes[r],a=s.collisions;if(a.length&&(n.set(i,Se.Zero),n.multRight(t.assign(s.modelViewMatrix).inverse()),s.shapeNode.intersectsBox(n,s.clipPlanes,e.assign(s.modelViewMatrix))))for(const t of a)o.push(t)}if(this.activeCollisions.length){const t=o.length?this.activeCollisions.filter((t=>!o.includes(t))):this.activeCollisions;for(const e of t)e.set_active(!1)}this.activeCollisions=o;for(const t of o)t.set_active(!0)}}(),gravite:function(){const t=new dn,e=new dn,n=new Se(0,0,0),i=new an;return function(){const o=this.getBrowser();if(o.getActiveLayer()===this){if("WALK"!==o.getCurrentViewer())return}else if("WALK"!==this.getNavigationInfo().getViewer())return;const r=this.getNavigationInfo(),s=this.getViewpoint(),a=r.getCollisionRadius(),u=r.getNearValue(),c=r.getAvatarHeight(),l=r.getStepHeight();Ka.ortho(-a,a,-a,a,u,Math.max(2*a,2*c),t);const h=s.getUpVector(),d=i.setFromToVec(Se.zAxis,h);e.assign(s.getModelMatrix()),e.translate(s.getUserPosition()),e.rotate(d),e.inverse(),e.multRight(t),e.multLeft(s.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(e);let p=-this.getDepth(t);this.getProjectionMatrix().pop(),p-=c;const f=i.setFromToVec(Se.yAxis,h);if(p>0){const t=this.speed?o.getCurrentFrameRate():1e6;this.speed-=o.getBrowserOptions()._Gravity.getValue()/t;let e=this.speed/t;e<-p&&(e=-p,this.speed=0),s._positionOffset=s._positionOffset.getValue().add(f.multVecRot(n.set(0,e,0)))}else this.speed=0,p=-p,p>.01&&p<l&&(this.constrainTranslation(f.multVecRot(n.set(0,p,0)),!1),s._positionOffset=n.add(s._positionOffset.getValue()))}}(),depth:function(){const t=new Float32Array(16);return function(e,n){const i=this.getBrowser(),o=i.getContext(),r=this.getViewVolume().getViewport();t.set(this.getProjectionMatrix().get()),o.viewport(...r),o.scissor(...r),o.clearColor(1,0,0,0),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.depthMask(!0),o.enable(o.DEPTH_TEST),o.disable(o.BLEND),o.disable(o.CULL_FACE);for(let r=0;r<n;++r){const n=e[r],{scissor:s,clipPlanes:a,modelViewMatrix:u,shapeNode:c}=n,l=c.getAppearance(),h=c.getGeometryContext(),d=l.getStyleProperties(h.geometryType),p=i.getDepthShader(a.length,c);o.scissor(...s),p.enable(o),p.setClipPlanes(o,a),o.uniformMatrix4fv(p.x3d_ProjectionMatrix,!1,t),o.uniformMatrix4fv(p.x3d_ModelViewMatrix,!1,u),d&&d.setShaderUniforms(o,p),c.displaySimple(o,n,p),i.resetTextureUnits()}}}(),draw:function(){const t=this.getBrowser(),e=t.getContext(),n=this.getViewVolume().getViewport(),i=this.globalObjects,o=this.lights,r=this.textureProjectors,s=this.generatedCubeMapTextures,a=this.globalShadows,u=a.at(-1),c=this.getNavigationInfo()._headlight.getValue(),l=i.reduce(((t,e)=>t+!!e.lightNode),0),h=i.reduce(((t,e)=>t+!!e.textureProjectorNode),0);if(this.renderTime=Date.now(),this.isIndependent()){for(const t of o)t.renderShadowMap(this);for(const t of s)t.renderTexture(this)}c&&t.getHeadlight().setGlobalVariables(this);for(const t of o)t.setGlobalVariables(this);for(const t of r)t.setGlobalVariables(this);this.viewportArray.set(n),this.cameraSpaceMatrixArray.set(this.getCameraSpaceMatrix().get()),this.projectionMatrixArray.set(this.getProjectionMatrix().get()),e.viewport(...n),e.scissor(...n),e.clear(e.DEPTH_BUFFER_BIT),this.getBackground().display(e,this,n),e.depthMask(!0),e.enable(e.DEPTH_TEST),e.disable(e.BLEND);const d=this.opaqueShapes;for(let n=0,i=this.numOpaqueShapes;n<i;++n){const i=d[n];e.scissor(...i.scissor),i.shadows=i.shadows||u,i.objectsCount[1]+=l,i.objectsCount[2]+=h,i.shapeNode.display(e,i),t.resetTextureUnits()}e.depthMask(!1),e.enable(e.BLEND);const p=this.transparentShapes;this.transparencySorter.sort(0,this.numTransparentShapes);for(let n=0,i=this.numTransparentShapes;n<i;++n){const i=p[n];e.scissor(...i.scissor),i.shadows=i.shadows||u,i.objectsCount[1]+=l,i.objectsCount[2]+=h,i.shapeNode.display(e,i),t.resetTextureUnits()}if(e.depthMask(!0),e.disable(e.BLEND),this.isIndependent()){const e=t.getLocalObjects();for(const t of e)t.dispose();e.length=0;for(const t of i)t.dispose()}i.length=0,o.length=0,a.length=1,r.length=0,s.length=0}};const ou=nu;n.set("x_ite/Rendering/X3DRenderObject",ou);const ru=ou;function su(t,e){uo.call(this,t),this.nodes=[e]}su.prototype=Object.assign(Object.create(uo.prototype),{constructor:su,getTypeName:function(){return"BindableStack"},get:function(){return this.nodes},top:function(){return this.nodes.at(-1)},pushOnTop:function(t){t!==this.nodes[0]&&(this.nodes.at(-1)._isBound=!1,this.nodes.push(t)),t._isBound=!0,t._bindTime=this.getBrowser().getCurrentTime(),this.addNodeEvent()},update:function(t,e,n){if(0===e.length&&0===n.length)return;const i=this.top(),o=this.nodes.at(-1);for(const t of e){const e=this.nodes.indexOf(t);e>0&&this.nodes.splice(e,1)}o!==this.nodes[0]&&n.some((t=>!t._set_bind.getValue()&&t===o))&&this.nodes.pop();for(const t of n)if(t._set_bind.getValue()){const e=this.nodes.indexOf(t);e>-1&&this.nodes.splice(e,1),this.nodes.push(t)}const r=this.nodes.at(-1);r!==o&&(o._set_bind=!1,o._isBound=!1,r._set_bind=!0,r._isBound=!0,r._bindTime=this.getBrowser().getCurrentTime()),r.transitionStart(t,i),this.addNodeEvent()}});for(const t of Reflect.ownKeys(su.prototype))Object.defineProperty(su.prototype,t,{enumerable:!1});const au=su;n.set("x_ite/Execution/BindableStack",au);const uu=au;function cu(t,e){uo.call(this,t),this.updateTime=0,this.nodes=[e],this.collectedNodes=[e],this.changedNodes=[],this.removedNodes=[]}cu.prototype=Object.assign(Object.create(uo.prototype),{constructor:cu,getTypeName:function(){return"BindableList"},get:function(){return this.nodes},getBound:function(t){const e=this.nodes.length;if(1===e)return this.nodes[0];if(t)for(let n=1;n<e;++n){const e=this.nodes[n];if((e.getExecutionContext().getOuterNode()?.getScene()??e.getScene()).isMainScene()&&e.getName()==t)return e}for(let t=1;t<e;++t){const e=this.nodes[t];if((e.getExecutionContext().getOuterNode()?.getScene()??e.getScene()).isMainScene()&&e._isBound.getValue())return e}for(let t=1;t<e;++t){const e=this.nodes[t];if((e.getExecutionContext().getOuterNode()?.getScene()??e.getScene()).isMainScene())return e}return this.nodes[0]},push:function(t){return this.collectedNodes.push(t)},update:function(t,e){const n=this.collectedNodes,i=this.changedNodes,o=this.removedNodes;for(const t of n)t._set_bind.getModificationTime()>this.updateTime&&i.push(t);if(!function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(n,this.nodes)){for(const t of this.nodes)n.includes(t)||o.push(t);const t=this.nodes;this.nodes=n,this.collectedNodes=t}this.collectedNodes.length=1,e.update(t,o,i),i.length=0,o.length=0,this.updateTime=Date.now()}});for(const t of Reflect.ownKeys(cu.prototype))Object.defineProperty(cu.prototype,t,{enumerable:!1});const lu=cu;n.set("x_ite/Execution/BindableList",lu);const hu=lu;function du(t){this.getExecutionContext()||(dr.call(this,t),this.addType(c.X3DChildNode),this.addChildObjects("isCameraObject",new ji.SFBool,"isPickableObject",new ji.SFBool),this._isCameraObject.setAccessType(c.outputOnly),this._isPickableObject.setAccessType(c.outputOnly))}du.prototype=Object.assign(Object.create(dr.prototype),{constructor:du,setCameraObject:function(t){t!==this._isCameraObject.getValue()&&(this._isCameraObject=t)},isCameraObject:function(){return this._isCameraObject.getValue()},setPickableObject:function(t){t!==this._isPickableObject.getValue()&&(this._isPickableObject=t)},isPickableObject:function(){return this._isPickableObject.getValue()}});const pu=du;n.set("x_ite/Components/Core/X3DChildNode",pu);const fu=pu;function gu(t){fu.call(this,t),this.addType(c.X3DBindableNode)}gu.prototype=Object.assign(Object.create(fu.prototype),{constructor:gu,isCameraObject:function(){return!0},transitionStart:function(){}});const mu=gu;n.set("x_ite/Components/Core/X3DBindableNode",mu);const _u=mu,xu={TELEPORT:!0,LINEAR:!0,ANIMATE:!0};function yu(t){_u.call(this,t),this.addType(c.NavigationInfo),this.addChildObjects("transitionStart",new ji.SFBool,"transitionActive",new ji.SFBool,"availableViewers",new ji.MFString,"viewer",new ji.SFString("EXAMINE")),this._avatarSize.setUnit("length"),this._speed.setUnit("speed"),this._visibilityLimit.setUnit("speed")}yu.prototype=Object.assign(Object.create(_u.prototype),{constructor:yu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_bind",new ji.SFBool),new k(c.inputOutput,"type",new ji.MFString("EXAMINE","ANY")),new k(c.inputOutput,"avatarSize",new ji.MFFloat(.25,1.6,.75)),new k(c.inputOutput,"speed",new ji.SFFloat(1)),new k(c.inputOutput,"headlight",new ji.SFBool(!0)),new k(c.inputOutput,"visibilityLimit",new ji.SFFloat),new k(c.inputOutput,"transitionType",new ji.MFString("LINEAR")),new k(c.inputOutput,"transitionTime",new ji.SFTime(1)),new k(c.outputOnly,"transitionComplete",new ji.SFBool),new k(c.outputOnly,"isBound",new ji.SFBool),new k(c.outputOnly,"bindTime",new ji.SFTime)]),getTypeName:function(){return"NavigationInfo"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){_u.prototype.initialize.call(this),this._type.addInterest("set_type__",this),this._headlight.addInterest("set_headlight__",this),this._transitionStart.addInterest("set_transitionStart__",this),this._transitionComplete.addInterest("set_transitionComplete__",this),this._isBound.addInterest("set_isBound__",this),this.set_type__(),this.set_headlight__()},getViewer:function(){return this._viewer.getValue()},getCollisionRadius:function(){return this._avatarSize.length>0&&this._avatarSize[0]>0?this._avatarSize[0]:.25},getAvatarHeight:function(){return this._avatarSize.length>1?this._avatarSize[1]:1.6},getStepHeight:function(){return this._avatarSize.length>2?this._avatarSize[2]:.75},getNearValue:function(){const t=this.getCollisionRadius();return 0===t?1e-5:t/2},getFarValue:function(t){return this._visibilityLimit.getValue()?this._visibilityLimit.getValue():t.getMaxFarValue()},getTransitionType:function(){for(const t of this._transitionType){if(xu[t])return t}return"LINEAR"},set_type__:function(){this._viewer="EXAMINE";for(const t of this._type){switch(t){case"EXAMINE":case"WALK":case"FLY":case"LOOKAT":case"PLANE":case"NONE":this._viewer=t;break;case"PLANE_create3000.github.io":case"PLANE_create3000.de":this._viewer="PLANE";break;default:continue}break}let t=!1,e=!1,n=!1,i=!1,o=!1,r=!1;if(this._type.length)for(const s of this._type){switch(s){case"EXAMINE":default:t=!0;continue;case"WALK":e=!0;continue;case"FLY":n=!0;continue;case"LOOKAT":r=!0;continue;case"PLANE":i=!0;continue;case"NONE":o=!0;continue;case"ANY":t=!0,e=!0,n=!0,i=!0,o=!0,r=!0}break}else t=!0,e=!0,n=!0,i=!0,o=!0,r=!0;this._availableViewers.length=0,t&&this._availableViewers.push("EXAMINE"),e&&this._availableViewers.push("WALK"),n&&this._availableViewers.push("FLY"),i&&this._availableViewers.push("PLANE"),r&&this._availableViewers.push("LOOKAT"),o&&this._availableViewers.push("NONE")},set_headlight__:function(){this._headlight.getValue()?delete this.enable:this.enable=Function.prototype},set_transitionStart__:function(){this._transitionActive.getValue()||(this._transitionActive=!0)},set_transitionComplete__:function(){this._transitionActive.getValue()&&(this._transitionActive=!1)},set_isBound__:function(){this._isBound.getValue()||this._transitionActive.getValue()&&(this._transitionActive=!1)},enable:function(t,e){t===ja.DISPLAY&&this._headlight.getValue()&&e.getGlobalObjects().push(this.getBrowser().getHeadlight())},traverse:function(t,e){t===ja.CAMERA&&e.getLayer().getNavigationInfos().push(this)}});const wu=yu;n.set("x_ite/Components/Navigation/NavigationInfo",wu);const Su=wu;const Tu=function(t){return Object.assign([],{top:0,pop:function(){return 0!==this.top?this[--this.top]:new t},push:function(t){this[this.top++]=t},clear:function(){this.length=0,this.top=0}})};n.set("standard/Utility/ObjectCache",Tu);const bu=Tu,vu=bu(Eu);function Eu(){this.fogMatrix=new Float32Array(9)}function Cu(t){this.addType(c.X3DFogObject),this._visibilityRange.setUnit("length"),this.hidden=!1,this.colorArray=new Float32Array(3)}Eu.prototype={constructor:Eu,set:function(t,e){this.fogNode=t,this.fogMatrix.set(e.submatrix.inverse())},getFogType:function(){return this.fogNode.getFogType()},setShaderUniforms:function(t,e){if(e.hasFog(this))return;const n=this.fogNode;t.uniform3fv(e.x3d_FogColor,n.colorArray),t.uniform1f(e.x3d_FogVisibilityRange,n.visibilityRange),t.uniformMatrix3fv(e.x3d_FogMatrix,!1,this.fogMatrix)},dispose:function(){vu.push(this)}},Cu.prototype={constructor:Cu,initialize:function(){this._fogType.addInterest("set_fogType__",this),this._color.addInterest("set_color__",this),this._visibilityRange.addInterest("set_visibilityRange__",this),this.set_color__(),this.set_visibilityRange__()},isHidden:function(){return this.hidden},setHidden:function(t){this.hidden=t,this.set_fogType__(),this.getBrowser().addBrowserEvent()},getFogType:function(){return this.fogType},getFogs:function(){return vu},set_fogType__:function(){const t=new Map([["LINEAR",1],["EXPONENTIAL",2]]);return function(){this.hidden||0===this.visibilityRange?this.fogType=0:this.fogType=t.get(this._fogType.getValue())||1}}(),set_color__:function(){const t=this._color.getValue(),e=this.colorArray;e[0]=t.r,e[1]=t.g,e[2]=t.b},set_visibilityRange__:function(){this.visibilityRange=Math.max(0,this._visibilityRange.getValue()),this.set_fogType__()},dispose:function(){}};const Ou=Cu;n.set("x_ite/Components/EnvironmentalEffects/X3DFogObject",Ou);const Nu=Ou;function Fu(t){_u.call(this,t),Nu.call(this,t),this.addType(c.Fog),this.modelMatrix=new dn}Fu.prototype=Object.assign(Object.create(_u.prototype),Nu.prototype,{constructor:Fu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_bind",new ji.SFBool),new k(c.inputOutput,"fogType",new ji.SFString("LINEAR")),new k(c.inputOutput,"color",new ji.SFColor(1,1,1)),new k(c.inputOutput,"visibilityRange",new ji.SFFloat),new k(c.outputOnly,"isBound",new ji.SFBool),new k(c.outputOnly,"bindTime",new ji.SFTime)]),getTypeName:function(){return"Fog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){_u.prototype.initialize.call(this),Nu.prototype.initialize.call(this)},getModelMatrix:function(){return this.modelMatrix},traverse:function(t,e){t===ja.CAMERA&&(e.getLayer().getFogs().push(this),this.modelMatrix.assign(e.getModelViewMatrix().get()))},dispose:function(){Nu.prototype.dispose.call(this),_u.prototype.dispose.call(this)}});const Iu=Fu;n.set("x_ite/Components/EnvironmentalEffects/Fog",Iu);const Mu=Iu;function Du(t){this.gl=t,this.vertexArrays=new Map}Du.prototype={update:function(t=!0){return t&&this.delete(),this},enable:function(t){const e=this.vertexArrays.get(t);if(e)return this.gl.bindVertexArray(e),!1;{const e=this.gl.createVertexArray();return this.vertexArrays.set(t,e),this.gl.bindVertexArray(e),!0}},delete:function(){for(const t of this.vertexArrays.values())this.gl.deleteVertexArray(t);this.vertexArrays.clear()}};const Ru=Du;n.set("x_ite/Rendering/VertexArray",Ru);const Vu=Ru,Au=[new Se(0,0,1),new Se(0,0,-1),new Se(0,1,0),new Se(0,-1,0),new Se(1,0,0)];function Pu(t){dr.call(this,t),this.addType(c.X3DGeometryNode),this.addChildObjects("transparent",new ji.SFBool,"bbox_changed",new ji.SFTime,"rebuild",new ji.SFTime),this._transparent.setAccessType(c.outputOnly),this._bbox_changed.setAccessType(c.outputOnly),this._rebuild.setAccessType(c.outputOnly);const e=this.getBrowser();this.min=new Se(0,0,0),this.max=new Se(0,0,0),this.bbox=Qa.Extents(this.min,this.max),this.solid=!0,this.primitiveMode=e.getContext().TRIANGLES,this.geometryType=3,this.flatShading=void 0,this.colorMaterial=!1,this.attribNodes=[],this.attribArrays=[],this.textureCoordinateMapping=new Map,this.multiTexCoords=[],this.texCoords=Pu.createArray(),this.fogDepths=Pu.createArray(),this.colors=Pu.createArray(),this.normals=Pu.createArray(),this.flatNormals=Pu.createArray(),this.vertices=Pu.createArray(),this.hasFogCoords=!1,this.hasNormals=!1,this.geometryKey="",this.vertexCount=0,this.planes=[];for(let t=0;t<5;++t)this.planes[t]=new ba(Se.Zero,Se.zAxis)}Pu.createArray=function(){const t=[];return t.typedArray=new Float32Array,t.assign=function(t){const e=t.length;for(let n=0;n<e;++n)this[n]=t[n];this.length=e},t.getValue=function(){return this.typedArray},t.shrinkToFit=function(){this.length===this.typedArray.length?this.typedArray.set(this):this.typedArray=new Float32Array(this)},t},Pu.prototype=Object.assign(Object.create(dr.prototype),{constructor:Pu,setup:function(){dr.prototype.setup.call(this),this.rebuild()},initialize:function(){dr.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getContext();this.getLive().addInterest("set_live__",this),this.addInterest("requestRebuild",this),this._rebuild.addInterest("rebuild",this),this.frontFace=e.CCW,this.backFace=new Map([[e.CCW,e.CW],[e.CW,e.CCW]]),this.attribBuffers=[],this.textureCoordinateNode=t.getDefaultTextureCoordinate(),this.texCoordBuffers=Array.from({length:t.getMaxTexCoords()},(()=>e.createBuffer())),this.fogDepthBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.normalBuffer=e.createBuffer(),this.vertexBuffer=e.createBuffer(),this.vertexArrayObject=new Vu(e),this.set_live__()},setGeometryType:function(t){this.geometryType=t},getGeometryType:function(){return this.geometryType},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},isTransparent:function(){return this._transparent.getValue()},getBBox:function(){return this.bbox},setBBox:function(t){if(!t.equals(this.bbox)){t.getExtents(this.min,this.max),this.bbox.assign(t);for(let t=0;t<5;++t)this.planes[t].set(t%2?this.min:this.max,Au[t]);this._bbox_changed.addEvent()}},getMin:function(){return this.min},getMax:function(){return this.max},getMatrix:function(){return dn.Identity},setPrimitiveMode:function(t){this.primitiveMode=t},getPrimitiveMode:function(){return this.primitiveMode},setSolid:function(t){this.solid=t},setCCW:function(t){const e=this.getBrowser().getContext();this.frontFace=t?e.CCW:e.CW},getAttrib:function(){return this.attribNodes},getAttribs:function(){return this.attribArrays},getAttribBuffers:function(){return this.attribBuffers},setFogDepths:function(t){this.fogDepths.assign(t)},getFogDepths:function(){return this.fogDepths},setColors:function(t){this.colors.assign(t)},getColors:function(){return this.colors},setMultiTexCoords:function(t){const e=this.multiTexCoords,n=t.length;for(let i=0;i<n;++i)e[i]=t[i];e.length=n},getMultiTexCoords:function(){return this.multiTexCoords},getTexCoords:function(){return this.texCoords},getTextureCoordinate:function(){return this.textureCoordinateNode},setTextureCoordinate:function(t){this.textureCoordinateNode.removeInterest("updateTextureCoordinateMapping",this),this.textureCoordinateNode=t||this.getBrowser().getDefaultTextureCoordinate(),this.textureCoordinateNode.addInterest("updateTextureCoordinateMapping",this),this.updateTextureCoordinateMapping()},getTextureCoordinateMapping:function(){return this.textureCoordinateMapping},updateTextureCoordinateMapping:function(){this.textureCoordinateMapping.clear(),this.textureCoordinateNode.getTextureCoordinateMapping(this.textureCoordinateMapping)},setNormals:function(t){this.normals.assign(t)},getNormals:function(){return this.normals},setVertices:function(t){this.vertices.assign(t)},getVertices:function(){return this.vertices},updateVertexArrays:function(){this.vertexArrayObject.update(),this.updateParticles=!0},buildTexCoords:function(){const t=this.texCoords;if(0===t.length){const e=this.getTexCoordParams(),n=e.min,i=e.Sindex,o=e.Tindex,r=e.Ssize,s=n[i],a=n[o],u=this.vertices.getValue();for(let e=0,n=u.length;e<n;e+=4)t.push((u[e+i]-s)/r,(u[e+o]-a)/r,0,1);t.shrinkToFit()}this.getMultiTexCoords().push(t)},getTexCoordParams:function(){const t={min:new Se(0,0,0),Ssize:0,Sindex:0,Tindex:0};return function(){const e=this.getBBox(),n=e.size,i=n.x,o=n.y,r=n.z;return t.min.assign(e.center).subtract(n.divide(2)),i>=o&&i>=r?(t.Ssize=i,t.Sindex=0,t.Tindex=o>=r?1:2):o>=i&&o>=r?(t.Ssize=o,t.Sindex=1,t.Tindex=i>=r?0:2):(t.Ssize=r,t.Sindex=2,t.Tindex=i>=o?0:1),t}}(),refineNormals:function(t,e,n){if(0===n)return e;const i=Math.cos(d.clamp(n,0,Math.PI)),o=[];for(const n in t){const r=t[n];for(const t of r){const n=e[t],s=new Se(0,0,0);for(const t of r){const o=e[t];o.dot(n)>=i&&s.add(o)}o[t]=s.normalize()}}return o},transformLine:function(t){},transformMatrix:function(t){},isClipped:function(t,e){return e.some((function(e){return e.isClipped(t)}))},intersectsLine:function(){const t=new dn,e={u:0,v:0,t:0},n=new Se(0,0,0),i=new Se(0,0,0),o=new Se(0,0,0),r=new Se(0,0,0);return function(s,a,u,c){if(this.intersectsBBox(s)){this.transformLine(s),this.transformMatrix(t.assign(a));const l=this.multiTexCoords[0].getValue(),h=this.normals.getValue(),d=this.vertices.getValue(),p=this.vertexCount;for(let a=0;a<p;a+=3){const p=4*a;if(n.x=d[p],n.y=d[p+1],n.z=d[p+2],i.x=d[p+4],i.y=d[p+5],i.z=d[p+6],o.x=d[p+8],o.y=d[p+9],o.z=d[p+10],s.intersectsTriangle(n,i,o,e)){const n=e.u,i=e.v,o=e.t,s=new Se(o*d[p]+n*d[p+4]+i*d[p+8],o*d[p+1]+n*d[p+5]+i*d[p+9],o*d[p+2]+n*d[p+6]+i*d[p+10]);if(u.length&&this.isClipped(t.multVecMatrix(r.assign(s)),u))continue;const f=new ge(o*l[p]+n*l[p+4]+i*l[p+8],o*l[p+1]+n*l[p+5]+i*l[p+9]),g=3*a,m=new Se(o*h[g]+n*h[g+3]+i*h[g+6],o*h[g+1]+n*h[g+4]+i*h[g+7],o*h[g+2]+n*h[g+5]+i*h[g+8]);c.push({texCoord:f,normal:m,point:this.getMatrix().multVecMatrix(s)})}}}return c.length}}(),getPlanesWithOffset:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=[];for(let t=0;t<5;++t)n[t]=new ba(Se.Zero,Se.zAxis);return function(i,o,r,s,a,u){t.set(i,o,r),e.set(s,a,u);for(let i=0;i<5;++i)n[i].set(i%2?t:e,Au[i]);return n}}(),intersectsBBox:function(){const t=new Se(0,0,0);return function(e,n){if(n)var i=this.min,o=this.max,r=i.x-n.x,s=o.x+n.x,a=i.y-n.y,u=o.y+n.y,c=i.z-n.z,l=o.z+n.z,h=this.getPlanesWithOffset(r,a,c,s,u,l);else i=this.min,o=this.max,r=i.x,s=o.x,a=i.y,u=o.y,c=i.z,l=o.z,h=this.planes;return!!(h[0].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.y>=a&&t.y<=u)||(!!(h[1].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.y>=a&&t.y<=u)||(!!(h[2].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.z>=c&&t.z<=l)||(!!(h[3].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.z>=c&&t.z<=l)||!!(h[4].intersectsLine(e,t)&&t.y>=a&&t.y<=u&&t.z>=c&&t.z<=l))))}}(),intersectsBox:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new dn,o=new Se(0,0,0);return function(r,s,a){if(r.intersectsBox(this.bbox)){r.multRight(i.assign(this.getMatrix()).inverse()),this.transformMatrix(a);const u=this.vertices.getValue();for(let i=0,c=this.vertexCount;i<c;i+=3){const c=4*i;if(t.x=u[c],t.y=u[c+1],t.z=u[c+2],e.x=u[c+4],e.y=u[c+5],e.z=u[c+6],n.x=u[c+8],n.y=u[c+9],n.z=u[c+10],r.intersectsTriangle(t,e,n)){if(s.length){if(this.isClipped(a.multVecMatrix(o.assign(t)),s))continue;if(this.isClipped(a.multVecMatrix(o.assign(e)),s))continue;if(this.isClipped(a.multVecMatrix(o.assign(n)),s))continue}return!0}}}return!1}}(),set_live__:function(){this.getLive().getValue()?this.getBrowser().getBrowserOptions()._Shading.addInterest("set_shading__",this):this.getBrowser().getBrowserOptions()._Shading.removeInterest("set_shading__",this)},set_shading__:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new Se(0,0,0);return function(o){const r=this.getBrowser(),s=r.getContext();if(this.geometryType<2)s.bindBuffer(s.ARRAY_BUFFER,this.normalBuffer),s.bufferData(s.ARRAY_BUFFER,this.normals.getValue(),s.DYNAMIC_DRAW);else{const o=r.getBrowserOptions().getShading()===Lo.FLAT;if(o===this.flatShading)return;if(this.flatShading=o,o&&!this.flatNormals.length){const o=this.frontFace===s.CW,r=this.flatNormals,a=this.vertices.getValue();for(let s=0,u=a.length;s<u;s+=12)Oa.normal(t.set(a[s],a[s+1],a[s+2]),e.set(a[s+4],a[s+5],a[s+6]),n.set(a[s+8],a[s+9],a[s+10]),i),o&&i.negate(),r.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z);r.shrinkToFit()}s.bindBuffer(s.ARRAY_BUFFER,this.normalBuffer),s.bufferData(s.ARRAY_BUFFER,o?this.flatNormals.getValue():this.normals.getValue(),s.DYNAMIC_DRAW)}}}(),requestRebuild:function(){this._rebuild.addEvent()},rebuild:function(){const t=new Se(0,0,0);return function(){this.clear(),this.build();for(const t of this.attribArrays)t.shrinkToFit();for(const t of this.multiTexCoords)t.shrinkToFit();this.fogDepths.shrinkToFit(),this.colors.shrinkToFit(),this.normals.shrinkToFit(),this.vertices.shrinkToFit();const e=this.min,n=this.max,i=this.vertices.getValue();if(i.length){if(e.x===Number.POSITIVE_INFINITY)for(let o=0,r=i.length;o<r;o+=4)t.set(i[o],i[o+1],i[o+2]),e.min(t),n.max(t);this.bbox.setExtents(e,n)}else this.bbox.setExtents(e.set(0,0,0),n.set(0,0,0));this._bbox_changed.addEvent();for(let t=0;t<5;++t)this.planes[t].set(t%2?e:n,Au[t]);0===this.multiTexCoords.length&&this.buildTexCoords(),this.transfer(),this.updateGeometryKey(),this.updateRenderFunctions()}}(),clear:function(){this.min.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.max.set(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);{const t=this.attribArrays;for(const e of t)e.length=0;const e=this.attribNodes.length;for(let n=t.length;n<e;++n)t[n]=Pu.createArray();t.length=e}this.flatShading=void 0,this.fogDepths.length=0,this.colors.length=0,this.multiTexCoords.length=0,this.texCoords.length=0,this.normals.length=0,this.flatNormals.length=0,this.vertices.length=0},transfer:function(){const t=this.getBrowser().getContext();for(let e=this.attribBuffers.length,n=this.attribArrays.length;e<n;++e)this.attribBuffers.push(t.createBuffer());for(let e=0,n=this.attribArrays.length;e<n;++e)t.bindBuffer(t.ARRAY_BUFFER,this.attribBuffers[e]),t.bufferData(t.ARRAY_BUFFER,this.attribArrays[e].getValue(),t.DYNAMIC_DRAW);const e=this.hasFogCoords;t.bindBuffer(t.ARRAY_BUFFER,this.fogDepthBuffer),t.bufferData(t.ARRAY_BUFFER,this.fogDepths.getValue(),t.DYNAMIC_DRAW),this.hasFogCoords=!!this.fogDepths.length,this.hasFogCoords!==e&&this.updateVertexArrays();const n=this.colorMaterial;t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors.getValue(),t.DYNAMIC_DRAW),this.colorMaterial=!!this.colors.length,this.colorMaterial!==n&&this.updateVertexArrays();for(let e=0,n=this.multiTexCoords.length;e<n;++e)t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffers[e]),t.bufferData(t.ARRAY_BUFFER,this.multiTexCoords[e].getValue(),t.DYNAMIC_DRAW);const i=this.hasNormals;this.set_shading__(this.getBrowser().getBrowserOptions()._Shading),this.hasNormals=!!this.normals.length,this.hasNormals!==i&&this.updateVertexArrays(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices.getValue(),t.DYNAMIC_DRAW),this.vertexCount=this.vertices.length/4},updateGeometryKey:function(){this.geometryKey="",this.geometryKey+=this.geometryType,this.geometryKey+=this.hasFogCoords?"1":"0",this.geometryKey+=this.colorMaterial?"1":"0",this.geometryKey+=this.hasNormals?"1":"0"},updateRenderFunctions:function(){this.vertexCount?(delete this.displaySimple,delete this.display,delete this.displaySimpleParticles,delete this.displayParticles):(this.displaySimple=Function.prototype,this.display=Function.prototype,this.displaySimpleParticles=Function.prototype,this.displayParticles=Function.prototype)},traverse:function(t,e){},displaySimple:function(t,e,n){this.vertexArrayObject.enable(n)&&(this.multiTexCoords.length&&n.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),this.hasNormals&&n.enableNormalAttribute(t,this.normalBuffer,0,0),n.enableVertexAttribute(t,this.vertexBuffer,0,0)),t.drawArrays(this.primitiveMode,0,this.vertexCount)},display:function(t,e){const n=e.appearanceNode,i=n.getShader(this,e);if(this.solid||!n.getBackMaterial()||this.getBrowser().getWireframe())this.displayGeometry(t,e,n,i,!0,!0);else{const o=n.getBackShader(this,e);this.displayGeometry(t,e,n,o,!0,!1),this.displayGeometry(t,e,n,i,!1,!0)}},displayGeometry:function(t,e,n,i,o,r){const s=this.getBrowser(),a=n.getBlendMode(),u=this.attribNodes,c=this.attribBuffers,l=s.getPrimitiveMode(this.primitiveMode);if(a?.enable(t),i.enable(t),i.setUniforms(t,this,e,r),this.vertexArrayObject.enable(i)){for(let e=0,n=u.length;e<n;++e)u[e].enable(t,i,c[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),i.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),i.enableNormalAttribute(t,this.normalBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0)}if(s.getWireframe())for(let e=0,n=this.vertexCount;e<n;e+=3)t.drawArrays(l,e,3);else{const n=dn.prototype.determinant3.call(e.modelViewMatrix)>0;t.frontFace(n?this.frontFace:this.backFace.get(this.frontFace)),e.transparent||o!==r?(t.enable(t.CULL_FACE),o&&!this.solid&&(t.cullFace(t.FRONT),t.drawArrays(l,0,this.vertexCount)),r&&(t.cullFace(t.BACK),t.drawArrays(l,0,this.vertexCount))):(this.solid?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.drawArrays(l,0,this.vertexCount))}a?.disable(t)},displaySimpleParticles:function(t,e,n){const i=n.outputParticles;if(i.vertexArrayObject.update(this.updateParticles).enable(e)){const{particleStride:o,particleOffset:r,matrixOffset:s}=n;e.enableParticleAttribute(t,i,o,r,1),e.enableParticleMatrixAttribute(t,i,o,s,1),e.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),e.enableNormalAttribute(t,this.normalBuffer,0,0),e.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}t.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,n.numParticles)},displayParticles:function(t,e,n){const i=e.appearanceNode,o=i.getShader(this,e);if(this.solid||!i.getBackMaterial()||this.getBrowser().getWireframe())this.displayParticlesGeometry(t,e,i,o,!0,!0,n);else{const r=i.getBackShader(this,e);this.displayParticlesGeometry(t,e,i,r,!0,!1,n),this.displayParticlesGeometry(t,e,i,o,!1,!0,n)}},displayParticlesGeometry:function(t,e,n,i,o,r,s){const a=this.getBrowser(),u=n.getBlendMode(),c=this.attribNodes,l=this.attribBuffers,h=a.getPrimitiveMode(this.primitiveMode);u?.enable(t),i.enable(t),i.setUniforms(t,this,e,r);const d=s.outputParticles;if(d.vertexArrayObject.update(this.updateParticles).enable(i)){const{particleStride:e,particleOffset:n,matrixOffset:o}=s;i.enableParticleAttribute(t,d,e,n,1),i.enableParticleMatrixAttribute(t,d,e,o,1);for(let e=0,n=c.length;e<n;++e)c[e].enable(t,i,l[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),i.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),i.enableNormalAttribute(t,this.normalBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}const p=dn.prototype.determinant3.call(e.modelViewMatrix)>0;t.frontFace(p?this.frontFace:this.backFace.get(this.frontFace)),e.transparent||o!==r?(t.enable(t.CULL_FACE),o&&!this.solid&&(t.cullFace(t.FRONT),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles)),r&&(t.cullFace(t.BACK),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles))):(this.solid?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles)),u?.disable(t)}});const Lu=Pu;n.set("x_ite/Components/Rendering/X3DGeometryNode",Lu);const Bu=Lu;let Xu=0;const Uu={AUTO:Xu++,OPAQUE:Xu++,MASK:Xu++,BLEND:Xu++};n.set("x_ite/Browser/Shape/AlphaMode",Uu);const ku=Uu;function zu(t={}){Object.assign(this,{alphaMode:ku.OPAQUE,geometryType:3,hasFogCoords:!1,colorMaterial:!1,hasNormals:!1,textureNode:!1,objectsCount:[0,0,0],textureCoordinateMapping:new Map,textureCoordinateNode:null},t),this.updateGeometryKey()}zu.prototype={constructor:zu,updateGeometryKey:Bu.prototype.updateGeometryKey,getTextureCoordinateMapping:function(){return this.textureCoordinateMapping},getTextureCoordinate:function(){return this.textureCoordinateNode}};const ju=zu;n.set("x_ite/Browser/Rendering/GeometryContext",ju);const Gu=ju;function Hu(t=0){this.value=t}Hu.prototype={constructor:Hu,[Symbol.iterator]:function*(){let t=this.value,e=0;for(;t;)1&t&&(yield e),t>>>=1,e+=1},get:function(t){const e=1<<t;return!!(this.value&e)},set:function(t,e){const n=1<<t;e?this.value|=n:this.value&=~n},clear:function(){this.value=0},entries:function*(){for(const t of this)yield[t,t]},valueOf:function(){return this.value},toString:function(t){return this.value.toString(t)}},Hu.prototype.keys=Hu.prototype[Symbol.iterator],Hu.prototype.values=Hu.prototype[Symbol.iterator],Object.defineProperty(Hu.prototype,"size",{get:function(){return d.bitCount(this.value)}});const qu=Hu;n.set("standard/Utility/BitSet",qu);const Yu=qu,Wu=Math.SQRT2/2;function Ku(t){_u.call(this,t),this.addType(c.X3DBackgroundNode),this._skyAngle.setUnit("angle"),this._groundAngle.setUnit("angle"),this.hidden=!1,this.projectionMatrixArray=new Float32Array(16),this.modelMatrix=new dn,this.modelViewMatrixArray=new Float32Array(16),this.clipPlanes=[],this.colors=[],this.sphere=[],this.textureNodes=new Array(6),this.textureBits=new Yu,this.sphereContext=new Gu({colorMaterial:!0}),this.sphereAlphaContext=new Gu({colorMaterial:!0,alphaMode:ku.BLEND}),this.texturesContext=new Gu({textureNode:!0}),this.texturesAlphaContext=new Gu({textureNode:!0,alphaMode:ku.BLEND})}Ku.prototype=Object.assign(Object.create(_u.prototype),{constructor:Ku,initialize:function(){_u.prototype.initialize.call(this);const t=this.getBrowser().getContext();this.colorBuffer=t.createBuffer(),this.sphereBuffer=t.createBuffer(),this.texCoordBuffers=[t.createBuffer()],this.textureBuffers=Array.from({length:6},(()=>t.createBuffer())),this.sphereArrayObject=new Vu(t),this.textureArrayObjects=Array.from({length:6},(()=>new Vu(t))),this._groundAngle.addInterest("build",this),this._groundColor.addInterest("build",this),this._skyAngle.addInterest("build",this),this._skyColor.addInterest("build",this),this.build(),this.transferRectangle()},isHidden:function(){return this.hidden},setHidden:function(t){this.hidden=t,this.getBrowser().addBrowserEvent()},isTransparent:function(){if(this.hidden)return!0;if(this._transparency.getValue()<=0)return!1;if(6!==this.textureBits.size)return!0;for(const t of this.textureBits)if(this.textureNodes[t]._transparent.getValue())return!0;return!1},set_texture__:function(t,e){this.textureNodes[e]?._loadState.removeInterest("set_loadState__",this),this.textureNodes[e]=t,t?._loadState.addInterest("set_loadState__",this,t,e),this.set_loadState__(t,e)},set_loadState__:function(t,e){this.setTextureBit(e,t,t?.checkLoadState()??c.NOT_STARTED)},setTextureBit:function(t,e,n){this.textureBits.set(t,n===c.COMPLETE_STATE||e?.getWidth())},getColor:function(t,e,n){return e[d.upperBound(n,0,n.length,t)]},build:function(){const t=Wu;if(this.colors.length=0,this.sphere.length=0,0===this._groundColor.length&&1==this._skyColor.length){this.sphere.vertices=36,this.sphere.push(t,t,-t,1,-t,t,-t,1,-t,-t,-t,1,t,t,-t,1,-t,-t,-t,1,t,-t,-t,1,-t,t,t,1,t,t,t,1,-t,-t,t,1,-t,-t,t,1,t,t,t,1,t,-t,t,1,-t,t,-t,1,-t,t,t,1,-t,-t,t,1,-t,t,-t,1,-t,-t,t,1,-t,-t,-t,1,t,t,t,1,t,t,-t,1,t,-t,t,1,t,-t,t,1,t,t,-t,1,t,-t,-t,1,t,t,t,1,-t,t,t,1,-t,t,-t,1,t,t,t,1,-t,t,-t,1,t,t,-t,1,-t,-t,t,1,t,-t,t,1,-t,-t,-t,1,-t,-t,-t,1,t,-t,t,1,t,-t,-t,1);const e=this._skyColor[0];for(let t=0,n=this.sphere.vertices;t<n;++t)this.colors.push(...e,1)}else{if(this._skyColor.length>this._skyAngle.length){const t=this._skyAngle.slice();(0===t.length||t[0]>0)&&t.unshift(0),t.at(-1)<Math.PI&&t.push(Math.PI),2===t.length&&t.splice(1,0,(t[0]+t[1])/2),this.buildSphere(1,t,this._skyAngle,this._skyColor,!1)}if(this._groundColor.length>this._groundAngle.length){const t=this._groundAngle.slice().reverse();(0===t.length||t[0]<Math.PI/2)&&t.unshift(Math.PI/2),t.at(-1)>0&&t.push(0),this.buildSphere(1,t,this._groundAngle,this._groundColor,!0)}}this.transferSphere()},buildSphere:function(){const t=new Ks(0,0),e=new Ks(0,0),n=new Ks(0,0),i=new Ks(0,0),o=new Ks(0,0),r=new Ks(0,0);return function(s,a,u,c,l){const h=l?Math.PI/2:Math.PI,p=a.length-1;for(let f=0;f<p;++f){let p=d.clamp(a[f],0,h),g=d.clamp(a[f+1],0,h);l&&(p=Math.PI-p,g=Math.PI-g),t.setPolar(s,p),e.setPolar(s,g);const m=this.getColor(a[f],c,u),_=this.getColor(a[f+1],c,u);for(let s=0;s<20;++s){const a=s<19?s+1:0;let u=2*Math.PI*(s/20);n.setPolar(-t.imag,u),i.setPolar(-e.imag,u),u=2*Math.PI*(a/20),o.setPolar(-e.imag,u),r.setPolar(-t.imag,u),this.colors.push(...m,1,..._,1,..._,1,...m,1,...m,1,..._,1),this.sphere.push(n.imag,t.real,n.real,1,o.imag,e.real,o.real,1,i.imag,e.real,i.real,1,n.imag,t.real,n.real,1,r.imag,t.real,r.real,1,o.imag,e.real,o.real,1)}}}}(),transferSphere:function(){const t=this.getBrowser().getContext();t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.colors),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.sphereBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.sphere),t.DYNAMIC_DRAW),this.sphereCount=this.sphere.length/4},transferRectangle:function(){const t=Wu,e=new Float32Array([1,1,0,1,0,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,1]),n=[new Float32Array([t,t,-t,1,-t,t,-t,1,-t,-t,-t,1,t,t,-t,1,-t,-t,-t,1,t,-t,-t,1]),new Float32Array([-t,t,t,1,t,t,t,1,t,-t,t,1,-t,t,t,1,t,-t,t,1,-t,-t,t,1]),new Float32Array([-t,t,-t,1,-t,t,t,1,-t,-t,t,1,-t,t,-t,1,-t,-t,t,1,-t,-t,-t,1]),new Float32Array([t,t,t,1,t,t,-t,1,t,-t,-t,1,t,t,t,1,t,-t,-t,1,t,-t,t,1]),new Float32Array([t,t,t,1,-t,t,t,1,-t,t,-t,1,t,t,t,1,-t,t,-t,1,t,t,-t,1]),new Float32Array([t,-t,-t,1,-t,-t,-t,1,-t,-t,t,1,t,-t,-t,1,-t,-t,t,1,t,-t,t,1])];return function(){const t=this.getBrowser().getContext();t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffers[0]),t.bufferData(t.ARRAY_BUFFER,e,t.DYNAMIC_DRAW);for(let e=0;e<6;++e)t.bindBuffer(t.ARRAY_BUFFER,this.textureBuffers[e]),t.bufferData(t.ARRAY_BUFFER,n[e],t.DYNAMIC_DRAW)}}(),traverse:function(t,e){switch(t){case ja.CAMERA:return e.getLayer().getBackgrounds().push(this),void this.modelMatrix.assign(e.getModelViewMatrix().get());case ja.DISPLAY:{const t=e.getLocalObjects(),n=this.clipPlanes;let i=0;for(let e=0,o=t.length;e<o;++e)t[e].isClipped&&(n[i++]=t[e]);return n.length=i,this.sphereContext.objectsCount[0]=n.length,void(this.texturesContext.objectsCount[0]=n.length)}}},display:function(){const t=new dn,e=new an,n=new Se(0,0,0);return function(i,o,r){this.hidden||(i.depthMask(!1),i.disable(i.DEPTH_TEST),i.enable(i.CULL_FACE),i.frontFace(i.CCW),this.projectionMatrixArray.set(o.getViewpoint().getProjectionMatrixWithLimits(.125,2e5,r)),t.assign(this.modelMatrix),t.multRight(o.getViewMatrix().get()),t.get(null,e),t.identity(),t.rotate(e),t.scale(n.set(1e5,1e5,1e5)),this.modelViewMatrixArray.set(t),this.drawSphere(o),+this.textureBits&&this.drawCube(o))}}(),drawSphere:function(t){const e=d.clamp(this._transparency.getValue(),0,1);if(1===e)return;const n=this.getBrowser(),i=n.getContext(),o=n.getDefaultMaterial().getShader(e?this.sphereAlphaContext:this.sphereContext);o.enable(i),o.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniform1f(o.x3d_Transparency,e),i.uniform1i(o.x3d_TextureCoordinateGeneratorMode[0],0),this.sphereArrayObject.enable(o)&&(o.enableColorAttribute(i,this.colorBuffer,0,0),o.enableVertexAttribute(i,this.sphereBuffer,0,0)),e?i.enable(i.BLEND):i.disable(i.BLEND),i.drawArrays(i.TRIANGLES,0,this.sphereCount)},drawCube:function(){const t=new Float32Array(dn.Identity);return function(e){const n=this.getBrowser(),i=n.getContext(),o=n.getDefaultMaterial().getShader(this.texturesContext),r=n.getDefaultMaterial().getShader(this.texturesAlphaContext);o.enable(i),o.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniformMatrix4fv(o.x3d_TextureMatrix[0],!1,t),i.uniform3f(o.x3d_EmissiveColor,1,1,1),i.uniform1f(o.x3d_Transparency,0),i.uniform1i(o.x3d_TextureCoordinateGeneratorMode[0],0);for(const t of this.textureBits){const s=this.textureNodes[t];this.drawRectangle(i,n,s._transparent.getValue()?r:o,e,s,this.textureBuffers[t],this.textureArrayObjects[t])}}}(),drawRectangle:function(t,e,n,i,o,r,s){o.setShaderUniforms(t,n,i),s.enable(t,n)&&(n.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),n.enableVertexAttribute(t,r,0,0)),o._transparent.getValue()?t.enable(t.BLEND):t.disable(t.BLEND),t.drawArrays(t.TRIANGLES,0,6),e.resetTextureUnits()}});const Ju=Ku;n.set("x_ite/Components/EnvironmentalEffects/X3DBackgroundNode",Ju);const Zu=Ju;function Qu(t){dr.call(this,t),this.addType(c.X3DAppearanceChildNode)}Qu.prototype=Object.assign(Object.create(dr.prototype),{constructor:Qu});const $u=Qu;n.set("x_ite/Components/Shape/X3DAppearanceChildNode",$u);const tc=$u;function ec(t){tc.call(this,t),this.addType(c.X3DTextureNode),this.addChildObjects("transparent",new ji.SFBool),this._transparent.setAccessType(c.outputOnly)}ec.prototype=Object.assign(Object.create(tc.prototype),{constructor:ec,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},isTransparent:function(){return this._transparent.getValue()}});const nc=ec;n.set("x_ite/Components/Texturing/X3DTextureNode",nc);const ic=nc;const oc=function(t,e,n=!0){try{if(e&&(e instanceof ji.SFNode&&(e=e.getValue()),e&&(n&&(e=e.getInnerNode()),e.getType().includes(t))))return e}catch(t){}return null};n.set("x_ite/Base/X3DCast",oc);const rc=oc;function sc(t){ic.call(this,t),this.addType(c.X3DSingleTextureNode)}sc.prototype=Object.assign(Object.create(ic.prototype),{constructor:sc,initialize:function(){ic.prototype.initialize.call(this),this._textureProperties.addInterest("set_textureProperties__",this,!0);const t=this.getBrowser().getContext();this.texture=t.createTexture(),this.set_textureProperties__(!1)},set_textureProperties__:function(t){this.texturePropertiesNode&&this.texturePropertiesNode.removeInterest("updateTextureParameters",this),this.texturePropertiesNode=rc(c.TextureProperties,this._textureProperties),this.texturePropertiesNode||(this.texturePropertiesNode=this.getBrowser().getDefaultTextureProperties()),this.texturePropertiesNode.addInterest("updateTextureParameters",this),t&&this.updateTextureParameters()},getCount:function(){return 1},getTexture:function(){return this.texture},updateTextureParameters:function(){const t=["EXT_texture_filter_anisotropic","MOZ_EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"];return function(e,n,i,o,r,s,a,u){const c=this.getBrowser().getContext();c.bindTexture(e,this.getTexture()),Math.max(o,r)<this.getBrowser().getMinTextureSize()&&!n?(c.texParameteri(e,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(e,c.TEXTURE_MAG_FILTER,c.NEAREST)):(i._generateMipMaps.getValue()&&c.generateMipmap(e),c.texParameteri(e,c.TEXTURE_MIN_FILTER,c[i.getMinificationFilter()]),c.texParameteri(e,c.TEXTURE_MAG_FILTER,c[i.getMagnificationFilter()])),n?(c.texParameteri(e,c.TEXTURE_WRAP_S,c[i.getBoundaryModeS()]),c.texParameteri(e,c.TEXTURE_WRAP_T,c[i.getBoundaryModeT()]),c.getVersion()>=2&&c.texParameteri(e,c.TEXTURE_WRAP_R,c[i.getBoundaryModeR()])):(c.texParameteri(e,c.TEXTURE_WRAP_S,s?c.REPEAT:c.CLAMP_TO_EDGE),c.texParameteri(e,c.TEXTURE_WRAP_T,a?c.REPEAT:c.CLAMP_TO_EDGE),c.getVersion()>=2&&c.texParameteri(e,c.TEXTURE_WRAP_R,u?c.REPEAT:c.CLAMP_TO_EDGE));for(const n of t){const t=c.getExtension(n);if(t){c.texParameterf(e,t.TEXTURE_MAX_ANISOTROPY_EXT,i._anisotropicDegree.getValue());break}}}}(),updateTextureBits:function(t,e=0){const n=this.getTextureType()-1;t.set(2*e+0,1&n),t.set(2*e+1,2&n)},getShaderOptions:function(){const t={2:"2D",3:"3D",4:"CUBE"};return function(e,n=0){e.push("X3D_TEXTURE"+n+"_"+t[this.getTextureType()])}}()});const ac=sc;n.set("x_ite/Components/Texturing/X3DSingleTextureNode",ac);const uc=ac,cc=new Uint8Array([255,255,255,255]);function lc(t){uc.call(this,t),this.addType(c.X3DTexture2DNode);const e=this.getBrowser().getContext();this.target=e.TEXTURE_2D,this.width=0,this.height=0}lc.prototype=Object.assign(Object.create(uc.prototype),{constructor:lc,initialize:function(){uc.prototype.initialize.call(this),this._repeatS.addInterest("updateTextureParameters",this),this._repeatT.addInterest("updateTextureParameters",this);const t=this.getBrowser().getContext();t.bindTexture(t.TEXTURE_2D,this.getTexture()),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,cc)},getTarget:function(){return this.target},getTextureType:function(){return 2},getTextureTypeString:function(){return"2D"},getWidth:function(){return this.width},getHeight:function(){return this.height},clearTexture:function(){this.setTexture(1,1,!1,cc,!1)},setTexture:function(t,e,n,i,o){this.width=t,this.height=e;const r=this.getBrowser().getContext();r.bindTexture(r.TEXTURE_2D,this.getTexture()),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,i),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),this.setTransparent(n),this.updateTextureParameters(),this.addNodeEvent()},updateTexture:function(t,e){const n=this.getBrowser().getContext();n.bindTexture(n.TEXTURE_2D,this.getTexture()),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),this.texturePropertiesNode._generateMipMaps.getValue()&&n.generateMipmap(n.TEXTURE_2D),this.addNodeEvent()},updateTextureParameters:function(){uc.prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,this.width,this.height,this._repeatS.getValue(),this._repeatT.getValue(),!1)},setShaderUniforms:function(t,e,n,i=e.x3d_Texture[0]){const o=this.getBrowser().getTexture2DUnit();t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,this.getTexture()),t.uniform1i(i.texture2D,o)}});const hc=lc;n.set("x_ite/Components/Texturing/X3DTexture2DNode",hc);const dc=hc;var pc=i(532);function fc(t){dc.call(this,t),es.call(this,t),this.addType(c.ImageTexture),this.image=pc("<img></img>"),this.urlStack=new ji.MFString}fc.prototype=Object.assign(Object.create(dc.prototype),es.prototype,{constructor:fc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600)),new k(c.initializeOnly,"repeatS",new ji.SFBool(!0)),new k(c.initializeOnly,"repeatT",new ji.SFBool(!0)),new k(c.initializeOnly,"textureProperties",new ji.SFNode)]),getTypeName:function(){return"ImageTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){dc.prototype.initialize.call(this),es.prototype.initialize.call(this),this.image.on("load",this.setImage.bind(this)),this.image.on("abort error",this.setError.bind(this)),this.image.prop("crossOrigin","Anonymous"),this.requestImmediateLoad().catch(Function.prototype)},getElement:function(){return this.image[0]},unloadData:function(){this.clearTexture()},loadData:function(){this.urlStack.setValue(this._url),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.clearTexture(),void this.setLoadState(c.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.image.attr("src",this.URL.href)},setError:function(t){"data:"!==this.URL.protocol&&console.warn(`Error loading image '${decodeURI(this.URL.href)}'`,t.type),this.loadNext()},setImage:async function(){try{const t=this.getBrowser().getContext(),e=this.image[0];if(1!==t.getVersion()||d.isPowerOfTwo(e.width)&&d.isPowerOfTwo(e.height)){const t=await this.getImageData(e),n=this.isImageTransparent(t),i=e.width,o=e.height;this.flipImage(t,i,o,4),this.setTexture(i,o,n,t,!1),this.setLoadState(c.COMPLETE_STATE)}else{const t=document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0}),i=d.nextPowerOfTwo(e.width),o=d.nextPowerOfTwo(e.height);t.width=i,t.height=o,n.clearRect(0,0,i,o),n.save(),n.translate(0,o),n.scale(1,-1),n.drawImage(e,0,0,e.width,e.height,0,0,i,o),n.restore();const r=n.getImageData(0,0,i,o).data,s=this.isImageTransparent(r);this.setTexture(i,o,s,r,!1),this.setLoadState(c.COMPLETE_STATE)}}catch(t){this.setError({type:t.message})}},getImageData:async function(t){const e=this.getBrowser().getContext(),n=e.createFramebuffer(),i=e.createTexture(),o=new Uint8Array(t.width*t.height*4);return e.bindFramebuffer(e.FRAMEBUFFER,n),e.bindTexture(e.TEXTURE_2D,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),await e.readPixelsAsync(0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,o),e.deleteFramebuffer(n),e.deleteTexture(i),o},isImageTransparent:function(t){for(let e=3,n=t.length;e<n;e+=4)if(255!==t[e])return!0;return!1},flipImage(t,e,n,i){const o=n>>>1,r=e*i,s=new Uint8Array(r);for(let e=0;e<o;++e){const i=e*r,o=(n-e-1)*r;s.set(t.subarray(i,i+r)),t.copyWithin(i,o,o+r),t.set(s,o)}return t},dispose:function(){es.prototype.dispose.call(this),dc.prototype.dispose.call(this)}});const gc=fc;n.set("x_ite/Components/Texturing/ImageTexture",gc);const mc=gc;function _c(t){Zu.call(this,t),this.addType(c.Background)}_c.prototype=Object.assign(Object.create(Zu.prototype),{constructor:_c,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_bind",new ji.SFBool),new k(c.inputOutput,"frontUrl",new ji.MFString),new k(c.inputOutput,"backUrl",new ji.MFString),new k(c.inputOutput,"leftUrl",new ji.MFString),new k(c.inputOutput,"rightUrl",new ji.MFString),new k(c.inputOutput,"topUrl",new ji.MFString),new k(c.inputOutput,"bottomUrl",new ji.MFString),new k(c.inputOutput,"skyAngle",new ji.MFFloat),new k(c.inputOutput,"skyColor",new ji.MFColor(new ji.SFColor)),new k(c.inputOutput,"groundAngle",new ji.MFFloat),new k(c.inputOutput,"groundColor",new ji.MFColor),new k(c.inputOutput,"transparency",new ji.SFFloat),new k(c.outputOnly,"isBound",new ji.SFBool),new k(c.outputOnly,"bindTime",new ji.SFTime)]),getTypeName:function(){return"Background"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Zu.prototype.initialize.call(this);const t=new mc(this.getExecutionContext()),e=new mc(this.getExecutionContext()),n=new mc(this.getExecutionContext()),i=new mc(this.getExecutionContext()),o=new mc(this.getExecutionContext()),r=new mc(this.getExecutionContext()),s=this.getBrowser().getBackgroundTextureProperties();this._frontUrl.addFieldInterest(t._url),this._backUrl.addFieldInterest(e._url),this._leftUrl.addFieldInterest(n._url),this._rightUrl.addFieldInterest(i._url),this._topUrl.addFieldInterest(o._url),this._bottomUrl.addFieldInterest(r._url),t._url=this._frontUrl,e._url=this._backUrl,n._url=this._leftUrl,i._url=this._rightUrl,o._url=this._topUrl,r._url=this._bottomUrl,t._textureProperties=s,e._textureProperties=s,n._textureProperties=s,i._textureProperties=s,o._textureProperties=s,r._textureProperties=s,t.setup(),e.setup(),n.setup(),i.setup(),o.setup(),r.setup(),this.set_texture__(t,0),this.set_texture__(e,1),this.set_texture__(n,2),this.set_texture__(i,3),this.set_texture__(o,4),this.set_texture__(r,5)}});const xc=_c;n.set("x_ite/Components/EnvironmentalEffects/Background",xc);const yc=xc;function wc(t,e,n){dr.call(this,t),ru.call(this,t),this.addType(c.X3DLayerNode),t.getSpecificationVersion()<4&&this.addAlias("isPickable",this._pickable),this.groupNode=n,this.viewportNode=null,this.defaultNavigationInfo=new Su(t),this.defaultViewpoint=e,this.defaultBackground=new yc(t),this.defaultFog=new Mu(t),this.navigationInfoStack=new uu(t,this.defaultNavigationInfo),this.viewpointStack=new uu(t,this.defaultViewpoint),this.backgroundStack=new uu(t,this.defaultBackground),this.fogStack=new uu(t,this.defaultFog),this.navigationInfos=new hu(t,this.defaultNavigationInfo),this.viewpoints=new hu(t,this.defaultViewpoint),this.backgrounds=new hu(t,this.defaultBackground),this.fogs=new hu(t,this.defaultFog),this.defaultBackground.setHidden(!0),this.defaultFog.setHidden(!0)}wc.prototype=Object.assign(Object.create(dr.prototype),ru.prototype,{constructor:wc,layer0:!1,initialize:function(){dr.prototype.initialize.call(this),ru.prototype.initialize.call(this),this.defaultNavigationInfo.setup(),this.defaultViewpoint.setup(),this.defaultBackground.setup(),this.defaultFog.setup(),this.navigationInfoStack.setup(),this.viewpointStack.setup(),this.backgroundStack.setup(),this.fogStack.setup(),this.navigationInfos.setup(),this.viewpoints.setup(),this.backgrounds.setup(),this.fogs.setup(),this._viewport.addInterest("set_viewport__",this),this.set_viewport__()},isLayer0:function(t){this.layer0=t,this.defaultBackground.setHidden(!t)},getLayer:function(){return this},getBBox:function(t,e){return this.groupNode.getBBox(t,e)},getGroup:function(){return this.groupNode},setGroup:function(t){this.groupNode=t},getViewport:function(){return this.viewportNode},getBackground:function(){return this.backgroundStack.top()},getFog:function(){return this.fogStack.top()},getNavigationInfo:function(){return this.navigationInfoStack.top()},getViewpoint:function(){return this.viewpointStack.top()},getBackgrounds:function(){return this.backgrounds},getFogs:function(){return this.fogs},getNavigationInfos:function(){return this.navigationInfos},getViewpoints:function(){return this.viewpoints},getUserViewpoints:function(){const t=[];for(const e of this.viewpoints.get())e._description.length&&t.push(e);return t},getBackgroundStack:function(){return this.backgroundStack},getFogStack:function(){return this.fogStack},getNavigationInfoStack:function(){return this.navigationInfoStack},getViewpointStack:function(){return this.viewpointStack},getCollisionTime:function(){return this.collisionTime},viewAll:function(t=1,e=!1){const n=this.getViewpoint(),i=this.getBBox(new Qa).multRight(n.getModelMatrix().copy().inverse());n.lookAt(this,i.center,n.getLookAtDistance(i),t,e)},straightenView:function(){this.getViewpoint().straightenView(this)},set_viewport__:function(){this.viewportNode=rc(c.X3DViewportNode,this._viewport),this.viewportNode||(this.viewportNode=this.getBrowser().getDefaultViewport())},bindBindables:function(t){this.traverse(ja.CAMERA,this);const e=this.navigationInfos.getBound(),n=this.backgrounds.getBound(),i=this.fogs.getBound(),o=this.viewpoints.getBound(t);this.navigationInfoStack.pushOnTop(e),this.viewpointStack.pushOnTop(o),this.backgroundStack.pushOnTop(n),this.fogStack.pushOnTop(i),o.resetUserOffsets(),o._viewAll.getValue()&&o.viewAll(this.getBBox(new Qa))},traverse:function(t,e=this){const n=this.getViewpoint();switch(this.getProjectionMatrix().pushMatrix(n.getProjectionMatrix(this)),this.getCameraSpaceMatrix().pushMatrix(n.getCameraSpaceMatrix()),this.getViewMatrix().pushMatrix(n.getViewMatrix()),t){case ja.POINTER:this.pointer(t,e);break;case ja.CAMERA:this.camera(t,e);break;case ja.PICKING:this.picking(t,e);break;case ja.COLLISION:this.collision(t,e);break;case ja.SHADOW:case ja.DISPLAY:this.display(t,e)}this.getViewMatrix().pop(),this.getCameraSpaceMatrix().pop(),this.getProjectionMatrix().pop()},pointer:function(t,e){const n=this.getBrowser(),i=this.viewportNode.getRectangle();if(n.getPointingLayer()){if(n.getPointingLayer()!==this)return}else if(!n.isPointerInRectangle(i))return;this.setHitRay(this.getProjectionMatrix().get(),i,n.getPointer()),this.getNavigationInfo().enable(t,e),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),e.render(t,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop()},camera:function(t,e){this._visible.getValue()&&(this.getModelViewMatrix().pushMatrix(dn.Identity),this.viewportNode.push(this),this.groupNode.traverse(t,e),this.viewportNode.pop(this),this.getModelViewMatrix().pop(),this.navigationInfos.update(this,this.navigationInfoStack),this.viewpoints.update(this,this.viewpointStack),this.backgrounds.update(this,this.backgroundStack),this.fogs.update(this,this.fogStack),this.getViewpoint().update())},picking:function(t,e){this._pickable.getValue()&&(this.getModelViewMatrix().pushMatrix(dn.Identity),this.viewportNode.push(this),this.groupNode.traverse(t,e),this.viewportNode.pop(this),this.getModelViewMatrix().pop())},collision:function(){const t=new dn;return function(e,n){if(this._visible.getValue()){const i=this.getNavigationInfo();if(i._transitionActive.getValue())return;const o=i.getCollisionRadius(),r=i.getAvatarHeight(),s=Math.max(2*o,2*r);Ka.ortho(-s,s,-s,s,-s,s,t),this.getProjectionMatrix().pushMatrix(t),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),n.render(e,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop(),this.getProjectionMatrix().pop()}}}(),display:function(t,e){this._visible.getValue()&&(this.getNavigationInfo().enable(t,e),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),e.render(t,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop())}});const Sc=wc;n.set("x_ite/Components/Layering/X3DLayerNode",Sc);const Tc=Sc;function bc(t){fu.call(this,t),this.addType(c.X3DSensorNode)}bc.prototype=Object.assign(Object.create(fu.prototype),{constructor:bc});const vc=bc;n.set("x_ite/Components/Core/X3DSensorNode",vc);const Ec=vc;function Cc(t){this.addType(c.X3DTimeDependentNode),this.addChildObjects("initialized",new ji.SFTime,"isEvenLive",new ji.SFBool),this.startTimeValue=0,this.pauseTimeValue=0,this.resumeTimeValue=0,this.stopTimeValue=0,this.start=0,this.pause=0,this.pauseInterval=0,this.timeouts=new Map,this.disabled=!1}Cc.prototype=Object.assign(Object.create(fu.prototype),{constructor:Cc,initialize:function(){this.getLive().addInterest("set_live__",this),this._isEvenLive.addInterest("set_live__",this),this._initialized.addInterest("set_loop__",this),this._enabled.addInterest("set_enabled__",this),this._loop.addInterest("set_loop__",this),this._startTime.addInterest("set_startTime__",this),this._pauseTime.addInterest("set_pauseTime__",this),this._resumeTime.addInterest("set_resumeTime__",this),this._stopTime.addInterest("set_stopTime__",this),this.startTimeValue=this._startTime.getValue(),this.pauseTimeValue=this._pauseTime.getValue(),this.resumeTimeValue=this._resumeTime.getValue(),this.stopTimeValue=this._stopTime.getValue(),this._initialized=this.getBrowser().getCurrentTime()},getDisabled:function(){return this.disabled},getLiveState:function(){return this.isLive()&&(this.getExecutionContext().getLive().getValue()||this._isEvenLive.getValue())},getElapsedTime:function(){return this.getBrowser().getCurrentTime()-this.start-this.pauseInterval},resetElapsedTime:function(){this.start=this.getBrowser().getCurrentTime(),this.pause=this.getBrowser().getCurrentTime(),this.pauseInterval=0},set_live__:function(){this.getLive().getValue()||this._isEvenLive.getValue()?this.disabled&&(this.disabled=!1,this._isActive.getValue()&&!this._isPaused.getValue()&&this.real_resume()):this.disabled||!this._isActive.getValue()||this._isPaused.getValue()||(this.disabled=!0,this.real_pause())},set_enabled__:function(){this._enabled.getValue()?this.set_loop__():this.stop()},set_loop__:function(){this._enabled.getValue()&&this._loop.getValue()&&this.stopTimeValue<=this.startTimeValue&&this.startTimeValue<=this.getBrowser().getCurrentTime()&&this.do_start(),this.set_loop()},set_startTime__:function(){this.startTimeValue=this._startTime.getValue(),this._enabled.getValue()&&(this.removeTimeout("start"),this.startTimeValue<=this.getBrowser().getCurrentTime()?this.do_start():this.addTimeout("start","do_start",this.startTimeValue))},set_pauseTime__:function(){if(this.pauseTimeValue=this._pauseTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("pause"),this.pauseTimeValue<=this.resumeTimeValue)return;this.pauseTimeValue<=this.getBrowser().getCurrentTime()?this.do_pause():this.addTimeout("pause","do_pause",this.pauseTimeValue)}},set_resumeTime__:function(){if(this.resumeTimeValue=this._resumeTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("resume"),this.resumeTimeValue<=this.pauseTimeValue)return;this.resumeTimeValue<=this.getBrowser().getCurrentTime()?this.do_resume():this.addTimeout("resume","do_resume",this.resumeTimeValue)}},set_stopTime__:function(){if(this.stopTimeValue=this._stopTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("stop"),this.stopTimeValue<=this.startTimeValue)return;this.stopTimeValue<=this.getBrowser().getCurrentTime()?this.do_stop():this.addTimeout("stop","do_stop",this.stopTimeValue)}},do_start:function(){this._isActive.getValue()||(this.resetElapsedTime(),this._isActive=!0,this._elapsedTime=0,this.set_start(),this.getLive().getValue()?this.getBrowser().timeEvents().addInterest("set_time",this):(this.disabled=!0,this.real_pause()))},do_pause:function(){this._isActive.getValue()&&!this._isPaused.getValue()&&(this._isPaused=!0,this.pauseTimeValue!==this.getBrowser().getCurrentTime()&&(this.pauseTimeValue=this.getBrowser().getCurrentTime()),this.getLive().getValue()&&this.real_pause())},real_pause:function(){this.pause=Date.now(),this.set_pause(),this.getBrowser().timeEvents().removeInterest("set_time",this)},do_resume:function(){this._isActive.getValue()&&this._isPaused.getValue()&&(this._isPaused=!1,this.resumeTimeValue!==this.getBrowser().getCurrentTime()&&(this.resumeTimeValue=this.getBrowser().getCurrentTime()),this.getLive().getValue()&&this.real_resume())},real_resume:function(){const t=(Date.now()-this.pause)/1e3;this.pauseInterval+=t,this.set_resume(t),this.getBrowser().timeEvents().addInterest("set_time",this),this.getBrowser().addBrowserEvent()},do_stop:function(){this.stop()},stop:function(){this._isActive.getValue()&&(this.set_stop(),this._elapsedTime=this.getElapsedTime(),this._isPaused.getValue()&&(this._isPaused=!1),this._isActive=!1,this.getBrowser().timeEvents().removeInterest("set_time",this))},addTimeout:function(t,e,n){this.removeTimeout(t),this.timeouts.set(t,setTimeout(this.processTimeout.bind(this,e),1e3*(n-this.getBrowser().getCurrentTime())))},removeTimeout:function(t){clearTimeout(this.timeouts.get(t)),this.timeouts.delete(t)},processTimeout:function(t){this._enabled.getValue()&&(this.getLive().getValue()||this._isEvenLive.getValue())&&(this.getBrowser().advanceTime(),this[t]())},set_loop:Function.prototype,set_start:Function.prototype,set_pause:Function.prototype,set_resume:Function.prototype,set_stop:Function.prototype,set_time:Function.prototype,dispose:function(){for(const t of[...this.timeouts.keys()])this.removeTimeout(t)}});const Oc=Cc;n.set("x_ite/Components/Time/X3DTimeDependentNode",Oc);const Nc=Oc;function Fc(t){Ec.call(this,t),Nc.call(this,t),this.addType(c.TimeSensor),this.addChildObjects("range",new ji.MFFloat(0,0,1)),this.cycle=0,this.interval=0,this.fraction=0,this.first=0,this.last=1,this.scale=1}Fc.prototype=Object.assign(Object.create(Ec.prototype),Nc.prototype,{constructor:Fc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"cycleInterval",new ji.SFTime(1)),new k(c.inputOutput,"loop",new ji.SFBool),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"cycleTime",new ji.SFTime),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.outputOnly,"fraction_changed",new ji.SFFloat),new k(c.outputOnly,"time",new ji.SFTime)]),getTypeName:function(){return"TimeSensor"},getComponentName:function(){return"Time"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Ec.prototype.initialize.call(this),Nc.prototype.initialize.call(this),this._cycleInterval.addInterest("set_cycleInterval__",this),this._range.addInterest("set_range__",this)},setRange:function(t,e,n){const i=this.getBrowser().getCurrentTime(),o=this._startTime.getValue(),r=this._cycleInterval.getValue();this.first=e,this.last=n,this.scale=this.last-this.first,this.interval=r*this.scale,this.fraction=d.fract((t>=1?0:t)+(this.interval?(i-o)/this.interval:0)),this.cycle=i-(this.fraction-this.first)*r},set_cycleInterval__:function(){this._isActive.getValue()&&this.setRange(this.fraction,this._range[1],this._range[2])},set_range__:function(){this._isActive.getValue()&&(this.setRange(this._range[0],this._range[1],this._range[2]),this._isPaused.getValue()||this.set_fraction(this.getBrowser().getCurrentTime()))},set_start:function(){this.setRange(this._range[0],this._range[1],this._range[2]),this.getLive().getValue()&&(this._fraction_changed=this.fraction,this._time=this.getBrowser().getCurrentTime())},set_resume:function(t){const e=this.getBrowser().getCurrentTime(),n=this._startTime.getValue();this.setRange(this.interval?d.fract(this.fraction-(e-n)/this.interval):0,this._range[1],this._range[2])},set_fraction:function(t){this._fraction_changed=this.fraction=this.first+(this.interval?d.fract((t-this.cycle)/this.interval):0)*this.scale},set_time:function(){const t=this.getBrowser().getCurrentTime();t-this.cycle>=this.interval?this._loop.getValue()?this.interval&&(this.cycle+=this.interval*Math.floor((t-this.cycle)/this.interval),this._elapsedTime=this.getElapsedTime(),this._cycleTime=t,this.set_fraction(t)):(this._fraction_changed=this.fraction=this.last,this.stop()):(this._elapsedTime=this.getElapsedTime(),this.set_fraction(t)),this._time=t},dispose:function(){Nc.prototype.dispose.call(this),Ec.prototype.dispose.call(this)}});const Ic=Fc;n.set("x_ite/Components/Time/TimeSensor",Ic);const Mc=Ic;function Dc(t){fu.call(this,t),this.addType(c.X3DInterpolatorNode)}Dc.prototype=Object.assign(Object.create(fu.prototype),{constructor:Dc,setup:function(){this.set_key__(),this._key.length&&this.interpolate(0,0,0),fu.prototype.setup.call(this)},initialize:function(){fu.prototype.initialize.call(this),this._set_fraction.addInterest("set_fraction__",this),this._key.addInterest("set_key__",this)},set_fraction__:function(){const t=this._key,e=t.length,n=this._set_fraction.getValue();switch(e){case 0:return;case 1:return this.interpolate(0,0,0);default:{if(n<=t[0])return this.interpolate(0,1,0);const i=d.upperBound(t,0,e,n);if(i!==e){const e=i-1,o=(n-t[e])/(t[i]-t[e]);this.interpolate(e,i,d.clamp(o,0,1))}else this.interpolate(e-2,e-1,1)}}},set_key__:function(){this.set_keyValue__()},set_keyValue__:function(){},interpolate:function(){}});const Rc=Dc;n.set("x_ite/Components/Interpolation/X3DInterpolatorNode",Rc);const Vc=Rc;function Ac(t){Vc.call(this,t),this.addType(c.EaseInEaseOut)}Ac.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Ac,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"easeInEaseOut",new ji.MFVec2f),new k(c.outputOnly,"modifiedFraction_changed",new ji.SFFloat)]),getTypeName:function(){return"EaseInEaseOut"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._easeInEaseOut.addInterest("set_keyValue__",this)},set_keyValue__:function(){this._easeInEaseOut.length<this._key.length&&this._easeInEaseOut.resize(this._key.length,this._easeInEaseOut.length?this._easeInEaseOut[this._easeInEaseOut.length-1]:new ji.SFVec2f)},interpolate:function(t,e,n){let i=this._easeInEaseOut[t].y,o=this._easeInEaseOut[e].x;const r=i+o;if(r<0)this._modifiedFraction_changed=n;else{r>1&&(o/=r,i/=r);const t=1/(2-i-o);if(n<i)this._modifiedFraction_changed=t/i*n*n;else if(n<=1-o)this._modifiedFraction_changed=t*(2*n-i);else{const e=1-n;this._modifiedFraction_changed=1-t*e*e/o}}}});const Pc=Ac;n.set("x_ite/Components/Interpolation/EaseInEaseOut",Pc);const Lc=Pc;function Bc(t){Vc.call(this,t),this.addType(c.PositionInterpolator)}Bc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Bc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFVec3f),new k(c.outputOnly,"value_changed",new ji.SFVec3f)]),getTypeName:function(){return"PositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new ji.SFVec3f)},interpolate:function(){const t=new Se(0,0,0);return function(e,n,i){this._value_changed=t.assign(this._keyValue[e].getValue()).lerp(this._keyValue[n].getValue(),i)}}()});const Xc=Bc;n.set("x_ite/Components/Interpolation/PositionInterpolator",Xc);const Uc=Xc;function kc(t){Vc.call(this,t),this.addType(c.OrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle")}kc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:kc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFRotation),new k(c.outputOnly,"value_changed",new ji.SFRotation)]),getTypeName:function(){return"OrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new ji.SFRotation)},interpolate:function(){const t=new an,e=new an;return function(n,i,o){t.assign(this._keyValue[n].getValue()),e.assign(this._keyValue[i].getValue()),this._value_changed=t.slerp(e,o)}}()});const zc=kc;n.set("x_ite/Components/Interpolation/OrientationInterpolator",zc);const jc=zc;function Gc(t){Vc.call(this,t),this.addType(c.ScalarInterpolator)}Gc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Gc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFFloat),new k(c.outputOnly,"value_changed",new ji.SFFloat)]),getTypeName:function(){return"ScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:0)},interpolate:function(t,e,n){this._value_changed=d.lerp(this._keyValue[t],this._keyValue[e],n)}});const Hc=Gc;n.set("x_ite/Components/Interpolation/ScalarInterpolator",Hc);const qc=Hc;function Yc(t){_u.call(this,t),this.addType(c.X3DViewpointNode),this.addChildObjects("positionOffset",new ji.SFVec3f,"orientationOffset",new ji.SFRotation,"scaleOffset",new ji.SFVec3f(1,1,1),"scaleOrientationOffset",new ji.SFRotation,"centerOfRotationOffset",new ji.SFVec3f,"fieldOfViewScale",new ji.SFFloat(1)),this.userPosition=new Se(0,1,0),this.userOrientation=new an,this.userCenterOfRotation=new Se(0,0,0),this.modelMatrix=new dn,this.cameraSpaceMatrix=new dn(1,0,0,0,0,1,0,0,0,0,1,0,0,0,10,1),this.viewMatrix=new dn(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-10,1);const e=this.getBrowser();this.timeSensor=new Mc(e.getPrivateScene()),this.easeInEaseOut=new Lc(e.getPrivateScene()),this.positionInterpolator=new Uc(e.getPrivateScene()),this.orientationInterpolator=new jc(e.getPrivateScene()),this.scaleInterpolator=new Uc(e.getPrivateScene()),this.scaleOrientationInterpolator=new jc(e.getPrivateScene()),this.fieldOfViewScaleInterpolator=new qc(e.getPrivateScene())}Yc.prototype=Object.assign(Object.create(_u.prototype),{constructor:Yc,initialize:function(){_u.prototype.initialize.call(this),this.timeSensor._stopTime=1,this.timeSensor.setup(),this.easeInEaseOut._key=new ji.MFFloat(0,1),this.easeInEaseOut._easeInEaseOut=new ji.MFVec2f(new ji.SFVec2f(0,0),new ji.SFVec2f(0,0)),this.easeInEaseOut.setup(),this.positionInterpolator._key=new ji.MFFloat(0,1),this.orientationInterpolator._key=new ji.MFFloat(0,1),this.scaleInterpolator._key=new ji.MFFloat(0,1),this.scaleOrientationInterpolator._key=new ji.MFFloat(0,1),this.fieldOfViewScaleInterpolator._key=new ji.MFFloat(0,1),this.positionInterpolator.setup(),this.orientationInterpolator.setup(),this.scaleInterpolator.setup(),this.scaleOrientationInterpolator.setup(),this.fieldOfViewScaleInterpolator.setup(),this.timeSensor._fraction_changed.addFieldInterest(this.easeInEaseOut._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.positionInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.orientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleOrientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewScaleInterpolator._set_fraction),this.positionInterpolator._value_changed.addFieldInterest(this._positionOffset),this.orientationInterpolator._value_changed.addFieldInterest(this._orientationOffset),this.scaleInterpolator._value_changed.addFieldInterest(this._scaleOffset),this.scaleOrientationInterpolator._value_changed.addFieldInterest(this._scaleOrientationOffset),this.fieldOfViewScaleInterpolator._value_changed.addFieldInterest(this._fieldOfViewScale),this._nearDistance.addInterest("set_nearDistance__",this),this._farDistance.addInterest("set_farDistance__",this),this._viewAll.addInterest("set_viewAll__",this),this._navigationInfo.addInterest("set_navigationInfo__",this),this._isBound.addInterest("set_bound__",this),this.set_nearDistance__(),this.set_farDistance__(),this.set_navigationInfo__()},set_nearDistance__:function(){const t=this._nearDistance.getValue();this.nearDistance=t>=0?t:void 0},set_farDistance__:function(){const t=this._farDistance.getValue();this.farDistance=t>=0?t:void 0},set_viewAll__:function(){this._viewAll.getValue()&&this._isBound.getValue()&&(this._set_bind=!0)},set_navigationInfo__:function(){this.navigationInfoNode&&this._isBound.removeFieldInterest(this.navigationInfoNode._set_bind),this.navigationInfoNode=rc(c.NavigationInfo,this._navigationInfo),this.navigationInfoNode&&this._isBound.addFieldInterest(this.navigationInfoNode._set_bind)},set_bound__:function(){const t=this.getBrowser();this._isBound.getValue()?t.getNotification()._string=this._description:this.timeSensor._stopTime=t.getCurrentTime()},set_active__:function(t,e){e.getValue()||(this.timeSensor._isActive.removeInterest("set_active__",this),this._isBound.getValue()&&1===this.timeSensor._fraction_changed.getValue()&&(t._transitionComplete=!0))},setInterpolators:function(){},getPosition:function(){return this._position.getValue()},getUserPosition:function(){return this.userPosition.assign(this.getPosition()).add(this._positionOffset.getValue())},getOrientation:function(){return this._orientation.getValue()},getUserOrientation:function(){return this.userOrientation.assign(this.getOrientation()).multRight(this._orientationOffset.getValue())},getCenterOfRotation:function(){return this._centerOfRotation.getValue()},getUserCenterOfRotation:function(){return this.userCenterOfRotation.assign(this.getCenterOfRotation()).add(this._centerOfRotationOffset.getValue())},getProjectionMatrix:function(t){const e=t.getNavigationInfo();return this.getProjectionMatrixWithLimits(this.nearDistance??e.getNearValue(),this.farDistance??e.getFarValue(this),t.getLayer().getViewport().getRectangle())},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getViewMatrix:function(){return this.viewMatrix},getModelMatrix:function(){return this.modelMatrix},getMaxFarValue:function(){return this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")?1e10:1e5},getUpVector:function(){return Se.yAxis},getSpeedFactor:function(){return 1},setVRMLTransition:function(t){this.VRMLTransition=t},getVRMLTransition:function(){return this.VRMLTransition},transitionStart:function(t,e){if(this._jump.getValue()){const n=this.getRelativeTransformation(e);this._retainUserOffsets.getValue()||this.resetUserOffsets(),this._viewAll.getValue()&&this.viewAll(t.getBBox(new Qa));const i=t.getNavigationInfo(),o=i._transitionTime.getValue();let r=i.getTransitionType();switch("2.0"===this.getExecutionContext().getSpecificationVersion()&&(r=this.getVRMLTransition()?"LINEAR":"TELEPORT"),this.setVRMLTransition(!1),o<=0&&(r="TELEPORT"),this.constructor!==e.constructor&&(r="TELEPORT"),r){case"TELEPORT":return void(i._transitionComplete=!0);case"ANIMATE":this.easeInEaseOut._easeInEaseOut=new ji.MFVec2f(new ji.SFVec2f(0,1),new ji.SFVec2f(1,0));break;default:this.easeInEaseOut._easeInEaseOut=new ji.MFVec2f(new ji.SFVec2f(0,0),new ji.SFVec2f(0,0))}i._transitionStart=!0,this.timeSensor._cycleInterval=o,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,i),this.positionInterpolator._keyValue=new ji.MFVec3f(n.position,this._positionOffset),this.orientationInterpolator._keyValue=new ji.MFRotation(n.orientation,this._orientationOffset),this.scaleInterpolator._keyValue=new ji.MFVec3f(n.scale,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new ji.MFRotation(n.scaleOrientation,this._scaleOrientationOffset),this._positionOffset=n.position,this._orientationOffset=n.orientation,this._scaleOffset=n.scale,this._scaleOrientationOffset=n.scaleOrientation,this.setInterpolators(e,n)}else{t.getNavigationInfo()._transitionComplete=!0;const n=this.getRelativeTransformation(e);this._positionOffset=n.position,this._orientationOffset=n.orientation,this._scaleOffset=n.scale,this._scaleOrientationOffset=n.scaleOrientation,this.setInterpolators(e,n)}},transitionStop:function(){this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.removeInterest("set_active__",this)},resetUserOffsets:function(){this._positionOffset=Se.Zero,this._orientationOffset=an.Identity,this._scaleOffset=Se.One,this._scaleOrientationOffset=an.Identity,this._centerOfRotationOffset=Se.Zero,this._fieldOfViewScale=1,this.set_nearDistance__(),this.set_farDistance__()},getRelativeTransformation:function(){const t=new Se(0,0,0),e=new an,n=new Se(0,0,0),i=new an;return function(o){return this.modelMatrix.copy().multRight(o.getViewMatrix()).inverse().get(t,e,n,i),t.subtract(this.getPosition()),e.multLeft(this.getOrientation().copy().inverse()),{position:t,orientation:e,scale:n,scaleOrientation:i}}}(),getLookAtRotation:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new Re,o=new an;return function(r,s){const a=this.getUpVector(!0);return n.assign(r).subtract(s).normalize(),t.assign(a).cross(n).normalize(),e.assign(n).cross(t).normalize(),i.set(...t,...e,...n),o.setMatrix(i),o}}(),lookAtPoint:function(t,e,n,i){this.getCameraSpaceMatrix().multVecMatrix(e),this.getModelMatrix().copy().inverse().multVecMatrix(e);const o=2*t.getNavigationInfo().getNearValue();this.lookAt(t,e,o,n,i)},lookAtBBox:function(t,e,n,i){e=e.copy().multRight(this.getModelMatrix().copy().inverse());const o=Math.max(2*t.getNavigationInfo().getNearValue(),this.getLookAtDistance(e));this.lookAt(t,e.center,o,n,i)},lookAt:function(t,e,n,i,o){const r=e.copy().add(this.getUserOrientation().multVecRot(new Se(0,0,n))).subtract(this.getPosition());t.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=1,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,t.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new ji.MFVec2f(new ji.SFVec2f(0,1),new ji.SFVec2f(1,0));const s=this._positionOffset.getValue().copy().lerp(r,i),a=this.getPosition().copy().add(s).subtract(e);let u=this._orientationOffset.getValue().copy().multRight(new an(this.getUserOrientation().multVecRot(new Se(0,0,1)),a));o&&(u=this.getOrientation().copy().inverse().multRight(this.straightenHorizon(this.getOrientation().copy().multRight(u)))),this.positionInterpolator._keyValue=new ji.MFVec3f(this._positionOffset,s),this.orientationInterpolator._keyValue=new ji.MFRotation(this._orientationOffset,u),this.scaleInterpolator._keyValue=new ji.MFVec3f(this._scaleOffset,Se.One),this.scaleOrientationInterpolator._keyValue=new ji.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset);const c=this.getRelativeTransformation(this);this._fieldOfViewScale=1,this._centerOfRotationOffset=e.copy().subtract(this.getCenterOfRotation()),this.nearDistance=Math.min(n/2,.125),this.farDistance=this.nearDistance*this.getMaxFarValue()/.125,this.setInterpolators(this,c)},straightenView:function(t){t.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=1,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,t.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new ji.MFVec2f(new ji.SFVec2f(0,1),new ji.SFVec2f(1,0));const e=this.getOrientation().copy().inverse().multRight(this.straightenHorizon(this.getUserOrientation()));this.positionInterpolator._keyValue=new ji.MFVec3f(this._positionOffset,this._positionOffset),this.orientationInterpolator._keyValue=new ji.MFRotation(this._orientationOffset,e),this.scaleInterpolator._keyValue=new ji.MFVec3f(this._scaleOffset,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new ji.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset);const n=this.getRelativeTransformation(this);this._fieldOfViewScale=1,this.setInterpolators(this,n)},straightenHorizon:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new an;return function(i,o=this.getUpVector(!0)){i.multVecRot(t.assign(Se.xAxis).negate()),i.multVecRot(e.assign(Se.zAxis));const r=e.cross(o);return Math.abs(e.dot(o))>=1||Math.abs(r.dot(t))>=1?i:(n.setFromToVec(t,r),i.multRight(n))}}(),viewAll:function(t){t.multRight(this.modelMatrix.copy().inverse());const e=this.getUserPosition().copy().subtract(t.center).normalize(),n=this.getLookAtDistance(t),i=t.center.copy().add(e.multiply(n)),o=this.getLookAtRotation(i,t.center);this._positionOffset=i.subtract(this.getPosition()),this._orientationOffset=this.getOrientation().copy().inverse().multRight(o),this._centerOfRotationOffset=t.center.copy().subtract(this.getCenterOfRotation()),this._fieldOfViewScale=1,this.nearDistance=Math.min((n-t.size.magnitude())/2,.125),this.farDistance=this.nearDistance*this.getMaxFarValue()/.125},traverse:function(t,e){t===ja.CAMERA&&(this.navigationInfoNode&&this.navigationInfoNode.traverse(t,e),e.getLayer().getViewpoints().push(this),this.modelMatrix.assign(e.getModelViewMatrix().get()))},update:function(){this.cameraSpaceMatrix.set(this.getUserPosition(),this.getUserOrientation(),this._scaleOffset.getValue(),this._scaleOrientationOffset.getValue()),this.cameraSpaceMatrix.multRight(this.modelMatrix),this.viewMatrix.assign(this.cameraSpaceMatrix).inverse()}});const Wc=Yc;n.set("x_ite/Components/Navigation/X3DViewpointNode",Wc);const Kc=Wc;function Jc(t){Kc.call(this,t),this.addType(c.Viewpoint),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("angle"),this.projectionMatrix=new dn}Jc.prototype=Object.assign(Object.create(Kc.prototype),{constructor:Jc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_bind",new ji.SFBool),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"position",new ji.SFVec3f(0,0,10)),new k(c.inputOutput,"orientation",new ji.SFRotation),new k(c.inputOutput,"centerOfRotation",new ji.SFVec3f),new k(c.inputOutput,"fieldOfView",new ji.SFFloat(.7854)),new k(c.inputOutput,"nearDistance",new ji.SFFloat(-1)),new k(c.inputOutput,"farDistance",new ji.SFFloat(-1)),new k(c.inputOutput,"viewAll",new ji.SFBool),new k(c.inputOutput,"jump",new ji.SFBool(!0)),new k(c.inputOutput,"retainUserOffsets",new ji.SFBool),new k(c.outputOnly,"isBound",new ji.SFBool),new k(c.outputOnly,"bindTime",new ji.SFTime),new k(c.inputOutput,"navigationInfo",new ji.SFNode)]),getTypeName:function(){return"Viewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},getRelativeTransformation:function(t){const e=Kc.prototype.getRelativeTransformation.call(this,t);return t.constructor===this.constructor&&(e.fieldOfView=t.getFieldOfView()),e},setInterpolators:function(t,e){if(t.constructor===this.constructor){const t=e.fieldOfView/this.getFieldOfView();this.fieldOfViewScaleInterpolator._keyValue=new ji.MFFloat(t,this._fieldOfViewScale.getValue()),this._fieldOfViewScale=t}else this.fieldOfViewScaleInterpolator._keyValue=new ji.MFFloat(this._fieldOfViewScale.getValue(),this._fieldOfViewScale.getValue()),this._fieldOfViewScale=this._fieldOfViewScale.getValue()},getLogarithmicDepthBuffer:function(){return!1},getFieldOfView:function(){const t=this._fieldOfView.getValue()*this._fieldOfViewScale.getValue();return t>0&&t<Math.PI?t:Math.PI/4},getScreenScale:function(t,e,n){const i=e[2],o=e[3];let r=Math.abs(t.z)*Math.tan(this.getFieldOfView()/2)*2;return r/=i>o?o:i,n.set(r,r,r)},getViewportSize:function(){const t=new ge(0,0);return function(e,n){const i=e[2],o=e[3],r=n*Math.tan(this.getFieldOfView()/2)*2,s=i/o;return s>1?t.set(r*s,r):t.set(r,r/s)}}(),getLookAtDistance:function(t){return t.size.magnitude()/2/Math.tan(this.getFieldOfView()/2)},getProjectionMatrixWithLimits:function(t,e,n){return Ka.perspective(this.getFieldOfView(),t,e,n[2],n[3],this.projectionMatrix)}});const Zc=Jc;n.set("x_ite/Components/Navigation/Viewpoint",Zc);const Qc=Zc;function $c(t){this.addType(c.X3DBoundedObject),this.addChildObjects("transformSensors_changed",new ji.SFTime),this._bboxSize.setUnit("length"),this._bboxCenter.setUnit("length"),this.childBBox=new Qa,this.transformSensorNodes=new Set}$c.prototype={constructor:$c,initialize:function(){},getDefaultBBoxSize:function(){const t=new Se(-1,-1,-1);return function(){return t}}(),getBBox:function(t,e,n){const i=this.childBBox;e.set();for(const o of t)o.getBBox&&e.add(o.getBBox(i,n));return e},displayBBox:function(){const t=new Qa,e=new dn;return function(n,i){const o=i.getModelViewMatrix();this.getBBox(t),e.set(t.center,null,t.size),o.push(),o.multLeft(e),this.getBrowser().getBBoxNode().traverse(n,i),o.pop()}}(),addTransformSensor:function(t){this.transformSensorNodes.add(t),this._transformSensors_changed=this.getBrowser().getCurrentTime()},removeTransformSensor:function(t){this.transformSensorNodes.delete(t),this._transformSensors_changed=this.getBrowser().getCurrentTime()},getTransformSensors:function(){return this.transformSensorNodes},dispose:function(){}};const tl=$c;n.set("x_ite/Components/Grouping/X3DBoundedObject",tl);const el=tl;function nl(t){fu.call(this,t),el.call(this,t),this.addType(c.X3DGroupingNode),this.hidden=!1,this.allowedTypes=new Set,this.clipPlaneNodes=[],this.localFogNodes=[],this.lightNodes=[],this.textureProjectorNodes=[],this.pointingDeviceSensorNodes=[],this.maybeCameraObjects=[],this.cameraObjects=[],this.maybePickableSensorNodes=[],this.pickableSensorNodes=[],this.pickableObjects=[],this.childNodes=[],this.displayNodes=[],this.visibleNodes=[],this.boundedObjects=[],this.sensors=[]}function il(t,e,n,i,o,r){const s=new Set;for(let t=o;t<r;++t)s.add(i[t]);return t.remove(e,n,(t=>s.has(t)))}nl.prototype=Object.assign(Object.create(fu.prototype),el.prototype,{constructor:nl,initialize:function(){fu.prototype.initialize.call(this),el.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this._addChildren.addInterest("set_addChildren__",this),this._removeChildren.addInterest("set_removeChildren__",this),this._children.addInterest("set_children__",this),this.set_children__()},getBBox:function(t,e){return this.getSubBBox(t,e)},getSubBBox:function(t,e){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?el.prototype.getBBox.call(this,this.visibleNodes,t,e):t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},isHidden:function(){return this.hidden},setHidden:function(t){t!==this.hidden&&(this.hidden=t,this.set_children__(),this.getBrowser().addBrowserEvent())},setAllowedTypes:function(){const t=this.allowedTypes;t.clear();for(const e of arguments)t.add(e)},set_addChildren__:function(){0!==this._addChildren.length&&(this._addChildren.setTainted(!0),this._addChildren.erase(il(this._addChildren,0,this._addChildren.length,this._children,0,this._children.length),this._addChildren.length),this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.insert(this._children.length,this._addChildren,0,this._addChildren.length),this.add(this._addChildren),this._addChildren.length=0,this._addChildren.setTainted(!1))},set_removeChildren__:function(){0!==this._removeChildren.length&&(this._removeChildren.setTainted(!0),this._children.length>0&&(this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.erase(il(this._children,0,this._children.length,this._removeChildren,0,this._removeChildren.length),this._children.length),this.remove(this._removeChildren)),this._removeChildren.length=0,this._removeChildren.setTainted(!1))},set_children__:function(){this.clear(),this.add(this._children)},connectChildren:function(){this._children.removeInterest("connectChildren",this),this._children.addInterest("set_children__",this)},clear:function(){for(const t of this.maybePickableSensorNodes)t._isPickableObject.removeInterest("set_pickableObjects__",this);for(const t of this.childNodes)t._isCameraObject.removeInterest("set_cameraObjects__",this),t._isPickableObject.removeInterest("set_pickableObjects__",this),rc(c.X3DBoundedObject,t)&&(t._visible.removeInterest("set_visibles__",this),t._bboxDisplay.removeInterest("set_bboxDisplays__",this));this.clipPlaneNodes.length=0,this.localFogNodes.length=0,this.lightNodes.length=0,this.textureProjectorNodes.length=0,this.pointingDeviceSensorNodes.length=0,this.maybeCameraObjects.length=0,this.maybePickableSensorNodes.length=0,this.childNodes.length=0},add:function(t){if(!this.hidden){for(const e of t)if(e)try{const t=e.getValue().getInnerNode(),n=t.getType();for(let e=n.length-1;e>=0;--e){switch(n[e]){case c.X3DPointingDeviceSensorNode:this.pointingDeviceSensorNodes.push(t);break;case c.ClipPlane:this.clipPlaneNodes.push(t);break;case c.LocalFog:this.localFogNodes.push(t);break;case c.X3DTextureProjectorNode:this.textureProjectorNodes.push(t);break;case c.X3DLightNode:this.lightNodes.push(t);break;case c.X3DBindableNode:this.maybeCameraObjects.push(t);break;case c.TransformSensor:case c.X3DPickSensorNode:t._isPickableObject.addInterest("set_pickableObjects__",this),this.maybePickableSensorNodes.push(t);break;case c.X3DBackgroundNode:case c.X3DChildNode:t._isCameraObject.addInterest("set_cameraObjects__",this),t._isPickableObject.addInterest("set_pickableObjects__",this),rc(c.X3DBoundedObject,t)&&(t._visible.addInterest("set_visibles__",this),t._bboxDisplay.addInterest("set_bboxDisplays__",this)),this.maybeCameraObjects.push(t),this.childNodes.push(t);break;case c.BooleanFilter:case c.BooleanToggle:case c.NurbsOrientationInterpolator:case c.NurbsPositionInterpolator:case c.NurbsSurfaceInterpolator:case c.TimeSensor:case c.X3DFollowerNode:case c.X3DInfoNode:case c.X3DInterpolatorNode:case c.X3DKeyDeviceSensorNode:case c.X3DLayoutNode:case c.X3DScriptNode:case c.X3DSequencerNode:case c.X3DTriggerNode:break;default:continue}break}}catch(t){}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()}},remove:function(t){for(const n of t)if(n)try{const t=n.getValue().getInnerNode(),i=t.getType();for(let n=i.length-1;n>=0;--n){switch(i[n]){case c.X3DPointingDeviceSensorNode:{const e=this.pointingDeviceSensorNodes.indexOf(t);e>=0&&this.pointingDeviceSensorNodes.splice(e,1);break}case c.ClipPlane:{const e=this.clipPlaneNodes.indexOf(t);e>=0&&this.clipPlaneNodes.splice(e,1);break}case c.LocalFog:{const e=this.localFogNodes.indexOf(t);e>=0&&this.localFogNodes.splice(e,1);break}case c.X3DTextureProjectorNode:{const e=this.textureProjectorNodes.indexOf(t);e>=0&&this.textureProjectorNodes.splice(e,1);break}case c.X3DLightNode:{const e=this.lightNodes.indexOf(t);e>=0&&this.lightNodes.splice(e,1);break}case c.X3DBindableNode:{const e=this.maybeCameraObjects.indexOf(t);e>=0&&this.maybeCameraObjects.splice(e,1);break}case c.TransformSensor:case c.X3DPickSensorNode:{t._isPickableObject.removeInterest("set_pickableObjects__",this);const e=this.maybePickableSensorNodes.indexOf(t);e>=0&&this.maybePickableSensorNodes.splice(e,1);break}case c.X3DBackgroundNode:case c.X3DChildNode:var e;t._isCameraObject.removeInterest("set_cameraObjects__",this),t._isPickableObject.removeInterest("set_pickableObjects__",this),rc(c.X3DBoundedObject,t)&&(t._visible.removeInterest("set_visibles__",this),t._bboxDisplay.removeInterest("set_bboxDisplays__",this)),(e=this.maybeCameraObjects.indexOf(t))>=0&&this.maybeCameraObjects.splice(e,1),(e=this.childNodes.indexOf(t))>=0&&this.childNodes.splice(e,1);break;case c.BooleanFilter:case c.BooleanToggle:case c.NurbsOrientationInterpolator:case c.NurbsPositionInterpolator:case c.NurbsSurfaceInterpolator:case c.TimeSensor:case c.X3DFollowerNode:case c.X3DInfoNode:case c.X3DInterpolatorNode:case c.X3DKeyDeviceSensorNode:case c.X3DLayoutNode:case c.X3DScriptNode:case c.X3DSequencerNode:case c.X3DTriggerNode:break;default:continue}break}}catch(t){}this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()},set_cameraObjects__:function(){const t=this.cameraObjects;t.length=0;for(const e of this.maybeCameraObjects)e.isCameraObject()&&(rc(c.X3DBoundedObject,e)?e._visible.getValue()&&t.push(e):t.push(e));this.setCameraObject(!!t.length)},set_pickableObjects__:function(){const t=this.pickableSensorNodes,e=this.pickableObjects;t.length=0,e.length=0;for(const e of this.maybePickableSensorNodes)e.isPickableObject()&&t.push(e);for(const t of this.visibleNodes)t.isPickableObject()&&e.push(t);this.set_transformSensors__()},set_transformSensors__:function(){this.setPickableObject(!!(this.getTransformSensors().size||this.pickableSensorNodes.length||this.pickableObjects.length))},set_displayNodes__:function(){const t=this.displayNodes;t.length=0;for(const e of this.clipPlaneNodes)t.push(e);for(const e of this.localFogNodes)t.push(e);for(const e of this.lightNodes)t.push(e);for(const e of this.textureProjectorNodes)t.push(e)},set_visibles__:function(){const t=this.visibleNodes;t.length=0;for(const e of this.childNodes)rc(c.X3DBoundedObject,e)?e._visible.getValue()&&t.push(e):t.push(e);this.set_cameraObjects__(),this.set_pickableObjects__()},set_bboxDisplays__:function(){const t=this.boundedObjects;t.length=0;for(const e of this.childNodes)rc(c.X3DBoundedObject,e)&&e._bboxDisplay.getValue()&&t.push(e)},traverse:function(t,e){switch(t){case ja.POINTER:{const n=this.pointingDeviceSensorNodes,i=this.clipPlaneNodes,o=this.sensors;if(o.length=0,n.length){for(const t of n)t.push(e,o);o.length&&e.getSensors().push(o)}for(const t of i)t.push(e);for(const n of this.visibleNodes)n.traverse(t,e);for(const t of i)t.pop(e);return void(o.length&&e.getSensors().pop())}case ja.CAMERA:for(const n of this.cameraObjects)n.traverse(t,e);return;case ja.PICKING:{if(this.getTransformSensors().size){const t=e.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}for(const n of this.pickableSensorNodes)n.traverse(t,e);const n=this.getBrowser(),i=n.getPickingHierarchy();if(i.push(this),n.getPickable().at(-1))for(const n of this.visibleNodes)n.traverse(t,e);else for(const n of this.pickableObjects)n.traverse(t,e);return void i.pop()}case ja.COLLISION:{const n=this.clipPlaneNodes;for(const t of n)t.push(e);for(const n of this.visibleNodes)n.traverse(t,e);for(const t of n)t.pop(e);return}case ja.SHADOW:{const n=this.clipPlaneNodes;for(const t of n)t.push(e);for(const n of this.visibleNodes)n.traverse(t,e);for(const t of n)t.push(e);return}case ja.DISPLAY:{const n=this.displayNodes;for(const t of n)t.push(e,this);for(const n of this.visibleNodes)n.traverse(t,e);for(const n of this.boundedObjects)n.displayBBox(t,e);for(const t of n)t.pop(e);return}}},dispose:function(){el.prototype.dispose.call(this),fu.prototype.dispose.call(this)}});const ol=nl;n.set("x_ite/Components/Grouping/X3DGroupingNode",ol);const rl=ol;function sl(t){rl.call(this,t),this.addType(c.Group)}sl.prototype=Object.assign(Object.create(rl.prototype),{constructor:sl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Group"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]}});const al=sl;n.set("x_ite/Components/Grouping/Group",al);const ul=al;function cl(t){Tc.call(this,t,new Qc(t),new ul(t)),this.addType(c.Layer)}cl.prototype=Object.assign(Object.create(Tc.prototype),{constructor:cl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"pickable",new ji.SFBool(!0)),new k(c.inputOutput,"objectType",new ji.MFString("ALL")),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"viewport",new ji.SFNode),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Layer"},getComponentName:function(){return"Layering"},getContainerField:function(){return"layers"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){Tc.prototype.initialize.call(this),this._addChildren.addFieldInterest(this.getGroup()._addChildren),this._removeChildren.addFieldInterest(this.getGroup()._removeChildren),this._children.addFieldInterest(this.getGroup()._children),this.getGroup()._children=this._children,this.getGroup().setPrivate(!0),this.getGroup().setup()}});const ll=cl;n.set("x_ite/Components/Layering/Layer",ll);const hl=ll;function dl(t){dr.call(this,t),this.addType(c.LayerSet),this.layerNodes=[new hl(t)],this.layerNode0=this.layerNodes[0],this.activeLayerNode=null}dl.prototype=Object.assign(Object.create(dr.prototype),{constructor:dl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"activeLayer",new ji.SFInt32),new k(c.inputOutput,"order",new ji.MFInt32(0)),new k(c.inputOutput,"layers",new ji.MFNode)]),getTypeName:function(){return"LayerSet"},getComponentName:function(){return"Layering"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){dr.prototype.initialize.call(this),this.layerNode0.setPrivate(!0),this.layerNode0.setup(),this.layerNode0.isLayer0(!0),this._activeLayer.addInterest("set_activeLayer__",this),this._order.addInterest("set_layers__",this),this._layers.addInterest("set_layers__",this),this.set_layers__()},getActiveLayer:function(){return this.activeLayerNode},setLayer0:function(t){this.layerNode0=t,this.set_layers__()},getLayer0:function(){return this.layerNode0},getLayers:function(){return this.layerNodes},set_activeLayer__:function(){if(0===this._activeLayer.getValue())this.activeLayerNode!==this.layerNode0&&(this.activeLayerNode=this.layerNode0);else{const t=this._activeLayer-1;t>=0&&t<this._layers.length?this.activeLayerNode!==this._layers[t].getValue()&&(this.activeLayerNode=rc(c.X3DLayerNode,this._layers[t])):null!==this.activeLayerNode&&(this.activeLayerNode=null)}},set_layers__:function(){const t=this._layers.getValue();this.layerNodes.length=0;for(let e of this._order)if(0===e)this.layerNodes.push(this.layerNode0);else if(--e,e>=0&&e<t.length){const n=rc(c.X3DLayerNode,t[e]);n&&this.layerNodes.push(n)}this.set_activeLayer__()},bindBindables:function(t){const e=this._layers.getValue();this.layerNode0.bindBindables(t);for(let n=0,i=e.length;n<i;++n){const i=rc(c.X3DLayerNode,e[n]);i&&i.bindBindables(t)}},traverse:function(t,e){for(const n of this.layerNodes)n.traverse(t,e)}});const pl=dl;n.set("x_ite/Components/Layering/LayerSet",pl);const fl=pl;function gl(t){uo.call(this,t),this.addType(c.X3DWorld),this.addChildObjects("activeLayer",new On(this.layer0)),this.defaultLayerSet=new fl(t),this.layerSet=this.defaultLayerSet,this.layer0=new hl(t)}Sr.addAbstractNodeType("X3DWorld",gl),gl.prototype=Object.assign(Object.create(uo.prototype),{constructor:gl,getTypeName:function(){return"X3DWorld"},initialize:function(){uo.prototype.initialize.call(this),this.layerSet.setPrivate(!0),this.layerSet.setup(),this.layerSet.setLayer0(this.layer0),this.layerSet._activeLayer.addInterest("set_rootNodes__",this),this.getExecutionContext().getRootNodes().addInterest("set_rootNodes__",this),this.set_rootNodes__(),this.layer0.setPrivate(!0),this.layer0.isLayer0(!0),this.layer0.setup(),this.set_activeLayer__()},getCache:function(){return this.getBrowser().getBrowserOption("Cache")},getLayerSet:function(){return this.layerSet},getActiveLayer:function(){return this._activeLayer.getValue()},set_rootNodes__:function(){const t=this.layerSet,e=this.getExecutionContext().getRootNodes();this.layerSet=this.defaultLayerSet,this.layer0._children=e;for(const t of e){const e=rc(c.LayerSet,t);e&&(this.layerSet=e)}this.layerSet!==t&&(this.layerSet.setLayer0(this.layer0),t._activeLayer.removeInterest("set_activeLayer__",this),this.layerSet._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__())},set_activeLayer__:function(){this._activeLayer=this.layerSet.getActiveLayer()},bindBindables:function(){const t=this.getExecutionContext().getWorldURL();this.layerSet.bindBindables(decodeURIComponent(new URL(t,t).hash.substr(1)))},traverse:function(t,e){this.layerSet.traverse(t,e)}});for(const t of Reflect.ownKeys(gl.prototype))Object.defineProperty(gl.prototype,t,{enumerable:!1});const ml=gl;n.set("x_ite/Execution/X3DWorld",ml);const _l=ml;var xl=i(532);const yl=/^\s*(?:vrmlscript|javascript|ecmascript)\:(.*)$/s,wl=/^data:(.*?)(?:;charset=(.*?))?(?:;(base64))?,(.*)$/s,Sl=new RegExp(".(?:html|htm|xhtml)$"),Tl={"text/html":!0,"application/xhtml+xml":!0},bl=new ji.MFString;function vl(t){E.call(this),this.node=t,this.browser=t.getBrowser(),this.external=this.browser.isExternal(),this.executionContext=this.external?t.getExecutionContext():this.browser.currentScene,this.target="",this.url=[],this.URL=new URL(this.getReferer(),this.getReferer()),this.controller=new AbortController}vl.prototype=Object.assign(Object.create(E.prototype),{constructor:vl,abort:function(){this.url.length=0,this.controller.abort()},getURL:function(){return this.URL},getReferer:function(){return this.node instanceof _l&&this.external?this.browser.getBaseURL():this.executionContext.getWorldURL()},getTarget:function(t){for(const e of t){const t=e.split("=");if(2===t.length&&"target"===t[0])return t[1]}return""},createX3DFromString:function(t,e="",n,i){try{const o=this.browser.createScene();return this.node instanceof _l?o.loader=this:o.setExecutionContext(this.executionContext),o.setWorldURL(new URL(t,this.getReferer()).href),n&&(n=this.setScene.bind(this,o,n,i)),new _a(o).parseIntoScene(e,n,i),o}catch(t){if(!i)throw t;i(t)}},setScene:function(t,e,n){t._initLoadCount.addInterest("set_initLoadCount__",this,t,e,n),t._initLoadCount.addEvent()},set_initLoadCount__:function(t,e,n,i){i.getValue()||(t._initLoadCount.removeInterest("set_initLoadCount__",this),delete t.loader,setTimeout((()=>{try{e(t)}catch(t){if(!n)throw t;n(t)}})))},createX3DFromURL:function(t,e,n,i,o){return this.bindViewpoint=i,this.foreign=o,this.target=this.getTarget(e||bl),this.loadDocument(t,this.createX3DFromURLAsync.bind(this,n))},createX3DFromURLAsync:function(t,e){null===e?t(null):this.createX3DFromString(this.URL,e,t,this.loadDocumentError.bind(this))},loadDocument:function(t,e){if(this.url=t.copy(),this.callback=e,0===t.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift()).catch(this.loadDocumentError.bind(this))},loadDocumentAsync:async function(t){if(0===t.length)return void this.loadDocumentError(new Error("URL is empty."));{const e=yl.exec(t);if(e)return void this.callback(e[1])}{const e=wl.exec(t);if(e){let t=e[4];return t="base64"===e[3]?atob(t):unescape(t),void this.callback(t)}}if(this.URL=new URL(t,this.getReferer()),this.bindViewpoint){const t=new URL(this.getReferer());if(this.URL.protocol===t.protocol&&this.URL.hostname===t.hostname&&this.URL.port===t.port&&this.URL.pathname===t.pathname&&this.URL.hash)return void this.bindViewpoint(decodeURIComponent(this.URL.hash.substr(1)))}if(this.foreign){if(this.target.length&&"_self"!==this.target)return this.foreign(this.URL.href,this.target);if(this.URL.href.match(Sl))return this.foreign(this.URL.href,this.target)}const e={cache:this.node.getCache()?"default":"reload",signal:this.controller.signal},n=this.handleErrors(await fetch(this.URL.href,e)),i=n.headers.get("content-type")?.replace(/;.*$/,"");if(this.foreign&&Tl[i])return this.foreign(this.URL.href,this.target);this.callback(xl.ungzip(await n.arrayBuffer()),this.URL)},handleErrors:function(t){if(t.ok)return t;throw Error(t.statusText||t.status)},loadDocumentError:function(t){this.error(t),this.url.length?this.loadDocumentAsync(this.url.shift()).catch(this.loadDocumentError.bind(this)):this.callback(null)},error:function(t){"data:"===this.URL.protocol?console.warn(`Couldn't load data URL: ${t.message}`):console.warn(`Couldn't load URL '${decodeURI(this.URL.href)}': ${t.message}`)}});for(const t of Reflect.ownKeys(vl.prototype))Object.defineProperty(vl.prototype,t,{enumerable:!1});const El=vl;n.set("x_ite/InputOutput/FileLoader",El);const Cl=El;Sr.addAbstractNodeType("X3DExternProtoDeclaration",Fl);const Ol=Symbol(),Nl=Symbol();function Fl(t,e){Gr.call(this,t),es.call(this,t),this.addType(c.X3DExternProtoDeclaration),this.addChildObjects("load",new ji.SFBool(!0),"url",e.copy(),"autoRefresh",new ji.SFTime,"autoRefreshTimeLimit",new ji.SFTime(3600))}Fl.prototype=Object.assign(Object.create(Gr.prototype),es.prototype,{constructor:Fl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode)]),getTypeName:function(){return"X3DExternProtoDeclaration"},initialize:function(){Gr.prototype.initialize.call(this),es.prototype.initialize.call(this)},set_live__:function(){es.prototype.set_live__.call(this),this.checkLoadState()===c.COMPLETE_STATE&&this[Nl].setLive(this.getLive().getValue())},canUserDefinedFields:function(){return!0},setProtoDeclaration:function(t){if(this[Ol]=t,t){for(const t of[...this.getUserDefinedFields()])this.removeUserDefinedField(t.getName());for(const e of t.getUserDefinedFields())this.addUserDefinedField(e.getAccessType(),e.getName(),e)}this.updateInstances()},getProtoDeclaration:function(){return this[Ol]},loadData:function(){this.getScene().addInitLoadCount(this),new Cl(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},setInternalSceneAsync:function(t){t?this.setInternalScene(t):this.setError(new Error("File could not be loaded.")),this.getScene().removeInitLoadCount(this)},setInternalScene:function(t){this[Nl]=t;const e=decodeURIComponent(new URL(this[Nl].getWorldURL()).hash.substr(1)),n=e?this[Nl].protos.get(e):this[Nl].protos[0];if(!n)throw new Error("PROTO not found");this[Nl].setLive(this.getLive().getValue()),this[Nl].setPrivate(this.getScene().isPrivate()),this[Nl].setExecutionContext(this.getExecutionContext()),this.setLoadState(c.COMPLETE_STATE),this.setProtoDeclaration(n)},getInternalScene:function(){return this[Nl]},setError:function(t){console.error(`Error loading extern prototype '${this.getName()}':`,t),this[Nl]=this.getBrowser().getPrivateScene(),this.setLoadState(c.FAILED_STATE),this.setProtoDeclaration(null)},toVRMLStream:function(t){t.string+=t.Indent(),t.string+="EXTERNPROTO",t.string+=t.Space(),t.string+=this.getName(),t.string+=t.TidySpace(),t.string+="[";const e=this.getUserDefinedFields();if(0===e.length)t.string+=t.TidySpace();else{let n=0,i=0;for(const o of e)n=Math.max(n,o.getTypeName().length),i=Math.max(i,t.AccessType(o.getAccessType()).length);t.string+=t.TidyBreak(),t.IncIndent();for(const o of e)this.toVRMLStreamUserDefinedField(t,o,n,i),t.string+=t.Break();t.DecIndent(),t.string+=t.Indent()}t.string+="]",t.string+=t.TidyBreak(),t.string+=t.Indent(),this._url.toVRMLStream(t)},toVRMLStreamUserDefinedField:function(t,e,n,i){t.string+=t.Indent(),t.string+=t.AccessType(e.getAccessType()).padEnd(i," "),t.string+=t.Space(),t.string+=e.getTypeName().padEnd(n," "),t.string+=t.Space(),t.string+=e.getName()},toXMLStream:function(t){t.string+=t.Indent(),t.string+="<ExternProtoDeclare",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.getName()),t.string+="'",t.string+=t.Space(),t.string+="url='",this._url.toXMLStream(t),t.string+="'",t.string+=">",t.string+=t.TidyBreak(),t.IncIndent();const e=this.getUserDefinedFields();for(const n of e)t.string+=t.Indent(),t.string+="<field",t.string+=t.Space(),t.string+="accessType='",t.string+=t.AccessType(n.getAccessType()),t.string+="'",t.string+=t.Space(),t.string+="type='",t.string+=n.getTypeName(),t.string+="'",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(n.getName()),t.string+="'",t.string+=t.closingTags?"></field>":"/>",t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="</ExternProtoDeclare>"},toJSONStream:function(t){t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ExternProtoDeclare",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+='"',t.string+=t.JSONEncode(this.getName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak();const e=this.getUserDefinedFields();if(e.length){t.string+=t.Indent(),t.string+='"',t.string+="field",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const n of e)t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@accessType",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.AccessType(n.getAccessType()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@type",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=n.getTypeName(),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n.getName()),t.string+='"',t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",n!==e.at(-1)&&(t.string+=","),t.string+=t.TidyBreak();t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=",",t.string+=t.TidyBreak()}t.string+=t.Indent(),t.string+='"',t.string+="@url",t.string+='"',t.string+=":",t.string+=t.TidySpace(),this._url.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(Fl.prototype))Object.defineProperty(Fl.prototype,t,{enumerable:!1});Object.defineProperties(Fl.prototype,{name:{get:Fl.prototype.getName,enumerable:!0},fields:{get:Fl.prototype.getFieldDefinitions,enumerable:!0},isExternProto:{value:!0,enumerable:!0},urls:{get:function(){return this._url},enumerable:!0},loadState:{get:Fl.prototype.checkLoadState,enumerable:!0}});const Il=Fl;n.set("x_ite/Prototype/X3DExternProtoDeclaration",Il);const Ml=Il;function Dl(t){return Y.call(this,t,Ml)}Dl.prototype=Object.assign(Object.create(Y.prototype),{constructor:Dl,getTypeName:function(){return"ExternProtoDeclarationArray"}});for(const t of Reflect.ownKeys(Dl.prototype))Object.defineProperty(Dl.prototype,t,{enumerable:!1});const Rl=Dl;n.set("x_ite/Prototype/ExternProtoDeclarationArray",Rl);const Vl=Rl;function Al(t){return Y.call(this,t,Wr)}Al.prototype=Object.assign(Object.create(Y.prototype),{constructor:Al,getTypeName:function(){return"ProtoDeclarationArray"}});for(const t of Reflect.ownKeys(Al.prototype))Object.defineProperty(Al.prototype,t,{enumerable:!1});const Pl=Al;n.set("x_ite/Prototype/ProtoDeclarationArray",Pl);const Ll=Pl,Bl=Symbol(),Xl=Symbol(),Ul=Symbol(),kl=Symbol(),zl=Symbol();function jl(t,e,n,i,o){E.call(this,t),this[Bl]=t,this[Xl]=e,this[Ul]=n,this[kl]=i,this[zl]=o,n.addFieldInterest(o),n.addOutputRoute(this),o.addInputRoute(this)}jl.prototype=Object.assign(Object.create(E.prototype),{constructor:jl,getTypeName:function(){return"X3DRoute"},getExecutionContext:function(){return this[Bl]},getSourceNode:function(){return this[Xl]},getSourceField:function(){return this[Ul]},getDestinationNode:function(){return this[kl]},getDestinationField:function(){return this[zl]},disconnect:function(){this[Ul].removeFieldInterest(this[zl]),this[Ul].removeOutputRoute(this),this[zl].removeInputRoute(this)},toVRMLStream:function(t){const e=t.LocalName(this[Xl]),n=t.LocalName(this[kl]);t.string+=t.Indent(),t.string+="ROUTE",t.string+=t.Space(),t.string+=e,t.string+=".",t.string+=this[Ul].getName(),this[Ul].getAccessType()===c.inputOutput&&(t.string+="_changed"),t.string+=t.Space(),t.string+="TO",t.string+=t.Space(),t.string+=n,t.string+=".",this[zl].getAccessType()===c.inputOutput&&(t.string+="set_"),t.string+=this[zl].getName()},toXMLStream:function(t){const e=t.LocalName(this[Xl]),n=t.LocalName(this[kl]);t.string+=t.Indent(),t.string+="<ROUTE",t.string+=t.Space(),t.string+="fromNode='",t.string+=t.XMLEncode(e),t.string+="'",t.string+=t.Space(),t.string+="fromField='",t.string+=t.XMLEncode(this[Ul].getName()),this[Ul].getAccessType()===c.inputOutput&&(t.string+="_changed"),t.string+="'",t.string+=t.Space(),t.string+="toNode='",t.string+=t.XMLEncode(n),t.string+="'",t.string+=t.Space(),t.string+="toField='",this[zl].getAccessType()===c.inputOutput&&(t.string+="set_"),t.string+=t.XMLEncode(this[zl].getName()),t.string+="'",t.string+=t.closingTags?"></ROUTE>":"/>"},toJSONStream:function(t){const e=t.LocalName(this[Xl]),n=t.LocalName(this[kl]);t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ROUTE",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@fromNode",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(e),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@fromField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(this[Ul].getName()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@toNode",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@toField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(this[zl].getName()),t.string+='"',t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"},dispose:function(){this.disconnect(),this[Bl].deleteRoute(this),E.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(jl.prototype))Object.defineProperty(jl.prototype,t,{enumerable:!1});Object.defineProperties(jl.prototype,{sourceNode:{get:function(){return wn.get(this[Xl])},enumerable:!0},sourceField:{get:function(){return this[Ul].getName()},enumerable:!0},destinationNode:{get:function(){return wn.get(this[kl])},enumerable:!0},destinationField:{get:function(){return this[zl].getName()},enumerable:!0}}),Object.assign(jl,{getId:function(t,e){return t.getId()+"."+e.getId()}});const Gl=jl;n.set("x_ite/Routing/X3DRoute",Gl);const Hl=Gl;function ql(t){return Y.call(this,t,Hl)}ql.prototype=Object.assign(Object.create(Y.prototype),{constructor:ql,getTypeName:function(){return"RouteArray"}});for(const t of Reflect.ownKeys(ql.prototype))Object.defineProperty(ql.prototype,t,{enumerable:!1});const Yl=ql;n.set("x_ite/Routing/RouteArray",Yl);const Wl=Yl;Sr.addAbstractNodeType("X3DExecutionContext",eh);const Kl=Symbol(),Jl=Symbol(),Zl=Symbol(),Ql=Symbol(),$l=Symbol(),th=Symbol();function eh(t,e=null){uo.call(this,t),this.addType(c.X3DExecutionContext),this.addChildObjects("rootNodes",new ji.MFNode,"worldInfos",new ji.MFNode,"sceneGraph_changed",new ji.SFTime,"namedNodes_changed",new ji.SFTime,"importedNodes_changed",new ji.SFTime,"protos_changed",new ji.SFTime,"externprotos_changed",new ji.SFTime,"routes_changed",new ji.SFTime),this._rootNodes.setAccessType(c.initializeOnly),this._rootNodes.addCloneCount(1),this[th]=e,this[Kl]=new vr,this[Jl]=new Vr,this[Zl]=new Ll,this[Ql]=new Vl,this[$l]=new Wl}eh.prototype=Object.assign(Object.create(uo.prototype),{constructor:eh,initialize:function(){uo.prototype.initialize.call(this),this.isScene()||this._sceneGraph_changed.addInterest("set_sceneGraph",this)},set_sceneGraph:function(){this.getExecutionContext()._sceneGraph_changed=this.getBrowser().getCurrentTime()},isScene:function(){return!1},getTypeName:function(){return"X3DExecutionContext"},getOuterNode:function(){return this[th]},getSpecificationVersion:function(){return this.getExecutionContext().getSpecificationVersion()},getEncoding:function(){return this.getExecutionContext().getEncoding()},getWorldURL:function(){return this.getExecutionContext().getWorldURL()},getProfile:function(){return this.getExecutionContext().getProfile()},hasComponent:function(t){return this.getExecutionContext().hasComponent(t)},getComponents:function(){return this.getExecutionContext().getComponents()},fromUnit:function(t,e){return this.getExecutionContext().fromUnit(t,e)},toUnit:function(t,e){return this.getExecutionContext().toUnit(t,e)},getUnits:function(){return this.getExecutionContext().getUnits()},createNode:function(t,e=!0){if(t=String(t),!1===e){const e=this.getBrowser().getSupportedNode(t);if(!e)return null;const n=e.prototype.getSpecificationRange();return this.getSpecificationVersion()<n[0]||this.getSpecificationVersion()>n[1]?null:(this.hasComponent(e.prototype.getComponentName())||console.warn(`Node type '${t}' does not match component/profile statements in '${this.getWorldURL()}'.`),new e(this))}{const e=this.getBrowser().getSupportedNode(t);if(!e)throw new Error(`Unknown node type '${t}'.`);const n=e.prototype.getSpecificationRange();if(this.getSpecificationVersion()<n[0])throw new Error(`Node type '${t}' does not match specification version in '${this.getWorldURL()}.`);if(this.getSpecificationVersion()>n[1])throw new Error(`Node type '${t}' does not match specification version in '${this.getWorldURL()}.`);this.hasComponent(e.prototype.getComponentName())||console.warn(`Node type '${t}' does not match component/profile statements in '${this.getWorldURL()}'.`);const i=new e(this);return i.setup(),wn.get(i)}},createProto:function(t,e=!0){t=String(t);let n=this;for(;;){const i=n.protos.get(t)??n.externprotos.get(t);if(i)return i.createInstance(this,e);if(n.isScene())break;n=n.getExecutionContext()}if(!1===e)return null;throw new Error("Unknown proto or externproto type '"+t+"'.")},addNamedNode:function(t,e){if(t=String(t),!(e=rc(c.X3DNode,e,!1)))throw new Error("Couldn't add named node: node must be of type X3DNode.");if(e.getExecutionContext()!==this)throw new Error("Couldn't add named node: node does not belong to this execution context.");if(0===t.length)throw new Error("Couldn't add named node: node name is empty.");if(this[Kl].has(t))throw new Error("Couldn't add named node: node named '"+t+"' is already in use.");if(this[Kl].get(e.getName())?.getValue()===e)throw new Error("Couldn't add named node: node named '"+e.getName()+"' is already added.");e.setName(t),this[Kl].add(t,wn.get(e)),this._namedNodes_changed=this.getBrowser().getCurrentTime()},updateNamedNode:function(t,e){if(t=String(t),!(e=rc(c.X3DNode,e,!1)))throw new Error("Couldn't update named node: node must be of type X3DNode.");if(e.getExecutionContext()!==this)throw new Error("Couldn't update named node: node does not belong to this execution context.");if(0===t.length)throw new Error("Couldn't update named node: node name is empty.");this.removeNamedNode(e.getName()),this.removeNamedNode(t),e.setName(t),this[Kl].add(t,wn.get(e)),this._namedNodes_changed=this.getBrowser().getCurrentTime()},removeNamedNode:function(t){t=String(t);const e=this[Kl].get(t);e&&e.getValue()&&(e.getValue().setName(""),this[Kl].remove(t),this._namedNodes_changed=this.getBrowser().getCurrentTime())},getNamedNode:function(t){t=String(t);const e=this[Kl].get(t);if(e)return e;throw new Error("Named node '"+t+"' not found.")},getNamedNodes:function(){return this[Kl]},getUniqueName:function(t){return l(this[Kl],t)},addImportedNode:function(t,e,n=e){if(e=String(e),n=String(n),this[Jl].has(n))throw new Error("Couldn't add imported node: imported name '"+n+"' already in use.");this.updateImportedNode(t,e,n)},updateImportedNode:function(t,e,n){if(t=rc(c.Inline,t,!1),e=String(e),n=void 0===n?e:String(n),!t)throw new Error("Node must be of type Inline node.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update imported node: Inline node does not belong to this execution context.");if(0===e.length)throw new Error("Couldn't update imported node: exported name is empty.");if(0===n.length)throw new Error("Couldn't update imported node: imported name is empty.");this.removeImportedNode(n);const i=new Mr(this,t,e,n);this[Jl].add(n,i),this._importedNodes_changed=this.getBrowser().getCurrentTime()},removeImportedNode:function(t){t=String(t);const e=this[Jl].get(t);e&&(e.dispose(),this[Jl].remove(t),this._importedNodes_changed=this.getBrowser().getCurrentTime())},getImportedNode:function(t){t=String(t);const e=this[Jl].get(t);if(e)return wn.get(e.getExportedNode());throw new Error("Imported node '"+t+"' not found.")},getImportedNodes:function(){return this[Jl]},getLocalNode:function(t){t=String(t);try{return this.getNamedNode(t)}catch(e){const n=this[Jl].get(t);if(n)return wn.get(n);throw new Error("Unknown named or imported node '"+t+"'.")}},getLocalName:function(t){if(!(t=rc(c.X3DNode,t,!1)))throw new Error("Couldn't get local name: node must be of type X3DNode.");if(t.getExecutionContext()===this)return t.getName();for(const e of this[Jl])try{if(e.getExportedNode()===t)return e.getImportedName()}catch(t){}throw new Error("Couldn't get local name: node is shared.")},setRootNodes:function(){},getRootNodes:function(){return this._rootNodes},getProtoDeclaration:function(t){t=String(t);const e=this[Zl].get(t);if(e)return e;throw new Error("Proto declaration '"+t+"' not found.")},addProtoDeclaration(t,e){if(t=String(t),!(e instanceof Wr))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(e.getExecutionContext()!==this)throw new Error("Couldn't add proto declaration: proto does not belong to this execution context.");if(this[Zl].get(t))throw new Error("Couldn't add proto declaration: proto '"+t+"' already in use.");if(this[Zl].get(e.getName())===e)throw new Error("Couldn't add proto declaration: proto '"+e.getName()+"' already added.");if(0===(t=String(t)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[Zl].add(t,e),e.setName(t),this._protos_changed=this.getBrowser().getCurrentTime()},updateProtoDeclaration(t,e){if(t=String(t),!(e instanceof Wr))throw new Error("Couldn't update proto declaration: proto must be of type X3DProtoDeclaration.");if(e.getExecutionContext()!==this)throw new Error("Couldn't update proto declaration: proto does not belong to this execution context.");if(0===(t=String(t)).length)throw new Error("Couldn't update proto declaration: proto name is empty.");this[Zl].update(e.getName(),t,e),e.setName(t),this._protos_changed=this.getBrowser().getCurrentTime()},removeProtoDeclaration(t){t=String(t),this[Zl].remove(t),this._protos_changed=this.getBrowser().getCurrentTime()},getProtoDeclarations:function(){return this[Zl]},getUniqueProtoName:function(t){return l(this[Zl],t)},getExternProtoDeclaration:function(t){t=String(t);const e=this[Ql].get(t);if(e)return e;throw new Error("Extern proto declaration '"+t+"' not found.")},addExternProtoDeclaration(t,e){if(t=String(t),!(e instanceof Ml))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(e.getExecutionContext()!==this)throw new Error("Couldn't add extern proto declaration: extern proto does not belong to this execution context.");if(this[Ql].get(t))throw new Error("Couldn't add extern proto declaration: extern proto '"+t+"' already in use.");if(this[Ql].get(e.getName())===e)throw new Error("Couldn't add extern proto declaration: extern proto '"+e.getName()+"' already added.");if(0===(t=String(t)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[Ql].add(t,e),e.setName(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},updateExternProtoDeclaration(t,e){if(t=String(t),!(e instanceof Ml))throw new Error("Couldn't update extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(e.getExecutionContext()!==this)throw new Error("Couldn't update extern proto declaration: extern proto does not belong to this execution context.");if(0===(t=String(t)).length)throw new Error("Couldn't update extern proto declaration: extern proto name is empty.");this[Ql].update(e.getName(),t,e),e.setName(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},removeExternProtoDeclaration(t){t=String(t),this[Ql].remove(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},getExternProtoDeclarations:function(){return this[Ql]},getUniqueExternProtoName:function(t){return l(this[Ql],t)},addRoute:function(t,e,n,i){if(t=rc(c.X3DNode,t,!1),e=String(e),n=rc(c.X3DNode,n,!1),i=String(i),!t)throw new Error("Bad ROUTE specification: source node must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destination node must be of type X3DNode.");let o=t instanceof Mr?t:null,r=n instanceof Mr?n:null;try{t.getExecutionContext()!==this&&(o=this.getLocalNode(this.getLocalName(t)).getValue())}catch(t){}try{n.getExecutionContext()!==this&&(r=this.getLocalNode(this.getLocalName(n)).getValue())}catch(t){}if(o instanceof Mr&&r instanceof Mr?(o.addRoute(o,e,r,i),r.addRoute(o,e,r,i)):o instanceof Mr?o.addRoute(o,e,n,i):r instanceof Mr&&r.addRoute(t,e,r,i),o!==t&&r!==n)return this.addSimpleRoute(t,e,n,i)},addSimpleRoute:function(t,e,n,i){try{if(e=t.getField(e),i=n.getField(i),!e.isOutput())throw new Error("Field named '"+e.getName()+"' in node named '"+t.getName()+"' of type "+t.getTypeName()+" is not an output field.");if(!i.isInput())throw new Error("Field named '"+i.getName()+"' in node named '"+n.getName()+"' of type "+n.getTypeName()+" is not an input field.");if(e.getType()!==i.getType())throw new Error("ROUTE types "+e.getTypeName()+" and "+i.getTypeName()+" do not match.");const o=Hl.getId(e,i);let r=this[$l].get(o);return r||(r=new Hl(this,t,e,n,i),this[$l].add(o,r),this._routes_changed=this.getBrowser().getCurrentTime(),r)}catch(t){throw new Error("Bad ROUTE specification: "+t.message)}},deleteRoute:function(t){4===arguments.length&&(t=this.getRoute(...arguments)),t instanceof Hl&&t.getExecutionContext()===this&&(this.deleteSimpleRoute(t),this.deleteImportedRoute(t.sourceNode,t.destinationNode,t))},deleteSimpleRoute:function(t){const e=Hl.getId(t.getSourceField(),t.getDestinationField());this[$l].remove(e),t.disconnect(),this._routes_changed=this.getBrowser().getCurrentTime()},deleteImportedRoute(t,e,n){let i=null,o=null;try{t.getValue().getExecutionContext()!==this&&(i=this.getLocalNode(this.getLocalName(t)).getValue())}catch(t){}try{e.getValue().getExecutionContext()!==this&&(o=this.getLocalNode(this.getLocalName(e)).getValue())}catch(t){}i instanceof Mr&&o instanceof Mr?(i.deleteRoute(n),o.deleteRoute(n)):i instanceof Mr?i.deleteRoute(n):o instanceof Mr&&o.deleteRoute(n)},getRoute:function(t,e,n,i){if(t=rc(c.X3DNode,t,!1),e=String(e),n=rc(c.X3DNode,n,!1),i=String(i),!t)throw new Error("Bad ROUTE specification: sourceNode must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destinationNode must be of type X3DNode.");return e=t.getField(e),i=n.getField(i),this[$l].get(Hl.getId(e,i))},getRoutes:function(){return this[$l]},getWorldInfos:function(){return this._worldInfos},addWorldInfo:function(t){this._worldInfos.push(t)},removeWorldInfo:function(t){for(let e=this._worldInfos.length-1;e>=0;--e)this._worldInfos[e].getValue()===t&&this._worldInfos.splice(e,1)},toVRMLStream:function(t){t.PushExecutionContext(this),t.EnterScope(),t.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toVRMLStream(t),this.getProtoDeclarations().toVRMLStream(t);const e=this.getRootNodes();for(let n=0,i=e.length;n<i;++n){const o=e[n];t.string+=t.Indent(),o?o.toVRMLStream(t):t.string+="NULL",t.string+=t.TidyBreak(),n!==i-1&&(t.string+=t.TidyBreak())}const n=this.getImportedNodes();n.length&&(t.string+=t.TidyBreak(),n.toVRMLStream(t));const i=this.getRoutes();i.length&&(t.string+=t.TidyBreak(),i.toVRMLStream(t)),t.LeaveScope(),t.PopExecutionContext()},toXMLStream:function(t){t.PushExecutionContext(this),t.EnterScope(),t.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toXMLStream(t),this.getProtoDeclarations().toXMLStream(t);const e=this.getRootNodes();e.length&&(e.toXMLStream(t),t.string+=t.TidyBreak()),this.getImportedNodes().toXMLStream(t),this.getRoutes().toXMLStream(t),t.LeaveScope(),t.PopExecutionContext()},toJSONStream:function(t){if(t.PushExecutionContext(this),t.EnterScope(),t.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toJSONStream(t,!0),this.getProtoDeclarations().toJSONStream(t,!0),this.getRootNodes().length)for(const e of this.getRootNodes())t.string+=t.Indent(),e?e.toJSONStream(t):(t.string+=t.Indent(),t.string+="null"),t.string+=",",t.string+=t.TidyBreak();this.getImportedNodes().toJSONStream(t,!0),this.getRoutes().toJSONStream(t,!0),t.LeaveScope(),t.PopExecutionContext()},dispose:function(){for(const t of[...this[$l]])this.deleteRoute(t);uo.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(eh.prototype))Object.defineProperty(eh.prototype,t,{enumerable:!1});Object.defineProperties(eh.prototype,{specificationVersion:{get:eh.prototype.getSpecificationVersion,enumerable:!0},encoding:{get:eh.prototype.getEncoding,enumerable:!0},profile:{get:eh.prototype.getProfile,enumerable:!0},components:{get:eh.prototype.getComponents,enumerable:!0},worldURL:{get:eh.prototype.getWorldURL,enumerable:!0},units:{get:eh.prototype.getUnits,enumerable:!0},rootNodes:{get:eh.prototype.getRootNodes,set:eh.prototype.setRootNodes,enumerable:!0},protos:{get:eh.prototype.getProtoDeclarations,enumerable:!0},externprotos:{get:eh.prototype.getExternProtoDeclarations,enumerable:!0},routes:{get:eh.prototype.getRoutes,enumerable:!0}});const nh=eh;n.set("x_ite/Execution/X3DExecutionContext",nh);const ih=nh;function oh({name:t,level:e,title:n,providerUrl:i,external:o=!1,dependencies:r=[]}){Object.defineProperties(this,{name:{value:t,enumerable:!0},level:{value:e,enumerable:!0},title:{value:n,enumerable:!0},providerUrl:{value:i||cr.getProviderUrl(o&&t),enumerable:!0},external:{value:o},dependencies:{value:r}})}oh.prototype=Object.assign(Object.create(E.prototype),{constructor:oh,getTypeName:function(){return"ComponentInfo"},toVRMLStream:function(t){t.string+=t.Indent(),t.string+="COMPONENT",t.string+=t.Space(),t.string+=this.name,t.string+=t.TidySpace(),t.string+=":",t.string+=t.TidySpace(),t.string+=this.level},toXMLStream:function(t){t.string+=t.Indent(),t.string+="<component",t.string+=t.Space(),t.string+="name='",t.string+=this.name,t.string+="'",t.string+=t.Space(),t.string+="level='",t.string+=this.level,t.string+="'",t.string+=t.closingTags?"></component>":"/>"},toJSONStream:function(t){t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=this.name,t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@level",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=this.level,t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(oh.prototype))Object.defineProperty(oh.prototype,t,{enumerable:!1});const rh=oh;n.set("x_ite/Configuration/ComponentInfo",rh);const sh=rh;function ah(t){return Y.call(this,t,sh)}ah.prototype=Object.assign(Object.create(Y.prototype),{constructor:ah,getTypeName:function(){return"ComponentInfoArray"},addComponent:function(t){this.add(t.name,new sh(t))}});for(const t of Reflect.ownKeys(ah.prototype))Object.defineProperty(ah.prototype,t,{enumerable:!1});const uh=ah;n.set("x_ite/Configuration/ComponentInfoArray",uh);const ch=uh;function lh(t,e,n){Object.defineProperties(this,{category:{value:t,enumerable:!0},name:{value:e,enumerable:!0},conversionFactor:{value:n,enumerable:!0}})}lh.prototype=Object.assign(Object.create(E.prototype),{constructor:lh,getTypeName:function(){return"UnitInfo"},toVRMLStream:function(t){t.string+=t.Indent(),t.string+="UNIT",t.string+=t.Space(),t.string+=this.category,t.string+=t.Space(),t.string+=this.name,t.string+=t.Space(),t.string+=this.conversionFactor},toXMLStream:function(t){t.string+=t.Indent(),t.string+="<unit",t.string+=t.Space(),t.string+="category='",t.string+=this.category,t.string+="'",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.name),t.string+="'",t.string+=t.Space(),t.string+="conversionFactor='",t.string+=this.conversionFactor,t.string+="'",t.string+=t.closingTags?"></unit>":"/>"},toJSONStream:function(t,e){if(1===this.conversionFactor)throw new Error("conversionFactor is 1");t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@category",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=this.category,t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(this.name),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@conversionFactor",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=this.conversionFactor,t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(lh.prototype))Object.defineProperty(lh.prototype,t,{enumerable:!1});Object.defineProperty(lh.prototype,"conversion_factor",{get:function(){return this.conversionFactor}});const hh=lh;n.set("x_ite/Configuration/UnitInfo",hh);const dh=hh;function ph(t){const e=Y.call(this);if(t)for(const e of t){if(!(e instanceof dh))throw new TypeError(`Wrong type in construction of ${this.getTypeName()}.`);this.add(e.category,e)}return e}ph.prototype=Object.assign(Object.create(Y.prototype),{constructor:ph,getTypeName:function(){return"UnitInfoArray"}});for(const t of Reflect.ownKeys(ph.prototype))Object.defineProperty(ph.prototype,t,{enumerable:!1});const fh=ph;n.set("x_ite/Configuration/UnitInfoArray",fh);const gh=fh,mh=Symbol(),_h=Symbol();function xh(t,e){E.call(this),this[mh]=t,this[_h]=e}xh.prototype=Object.assign(Object.create(E.prototype),{constructor:xh,getExportedName:function(){return this[mh]},getLocalNode:function(){return this[_h]},toVRMLStream:function(t){const e=t.LocalName(this[_h]);t.string+=t.Indent(),t.string+="EXPORT",t.string+=t.Space(),t.string+=e,this[mh]!==e&&(t.string+=t.Space(),t.string+="AS",t.string+=t.Space(),t.string+=this[mh])},toXMLStream:function(t){const e=t.LocalName(this[_h]);t.string+=t.Indent(),t.string+="<EXPORT",t.string+=t.Space(),t.string+="localDEF='",t.string+=t.XMLEncode(e),t.string+="'",this[mh]!==e&&(t.string+=t.Space(),t.string+="AS='",t.string+=t.XMLEncode(this[mh]),t.string+="'"),t.string+=t.closingTags?"></EXPORT>":"/>"},toJSONStream:function(t){const e=t.LocalName(this[_h]);t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="EXPORT",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@localDEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(e),t.string+='"',this[mh]!==e?(t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@AS",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(this[mh]),t.string+='"',t.string+=t.TidyBreak()):t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(xh.prototype))Object.defineProperty(xh.prototype,t,{enumerable:!1});Object.defineProperties(xh.prototype,{exportedName:{get:function(){return wn.get(this[mh])},enumerable:!0},localNode:{get:function(){return wn.get(this[_h])},enumerable:!0}});const yh=xh;n.set("x_ite/Execution/X3DExportedNode",yh);const wh=yh;function Sh(t){return Y.call(this,t,wh)}Sh.prototype=Object.assign(Object.create(Y.prototype),{constructor:Sh,getTypeName:function(){return"ExportedNodesArray"}});for(const t of Reflect.ownKeys(Sh.prototype))Object.defineProperty(Sh.prototype,t,{enumerable:!1});const Th=Sh;n.set("x_ite/Execution/ExportedNodesArray",Th);const bh=Th;Sr.addAbstractNodeType("X3DScene",Ah);const vh=Symbol.for("X_ITE.X3DEventObject.browser"),Eh=Symbol(),Ch=Symbol(),Oh=Symbol(),Nh=Symbol(),Fh=Symbol(),Ih=Symbol(),Mh=Symbol(),Dh=Symbol(),Rh=Symbol(),Vh="4.0";function Ah(t){this[vh]=t,ih.call(this,this),this.addType(c.X3DScene),this.addChildObjects("profile_changed",new ji.SFTime,"components_changed",new ji.SFTime,"units_changed",new ji.SFTime,"metadata_changed",new ji.SFTime,"exportedNodes_changed",new ji.SFTime,"initLoadCount",new ji.SFInt32,"loadCount",new ji.SFInt32),this[Eh]=Vh,this[Ch]="SCRIPTED",this[Oh]=null,this[Nh]=new ch([]),this[Fh]=location.toString(),this[Ih]=new gh,this[Ih].add("angle",new dh("angle","radian",1)),this[Ih].add("force",new dh("force","newton",1)),this[Ih].add("length",new dh("length","metre",1)),this[Ih].add("mass",new dh("mass","kilogram",1)),this[Mh]=new Map,this[Dh]=new bh,this[Rh]=new Set,this.getRootNodes().setAccessType(c.inputOutput),this.setLive(!1)}Ah.prototype=Object.assign(Object.create(ih.prototype),{constructor:Ah,getTypeName:function(){return"X3DScene"},isMainScene:function(){return this===this.getExecutionContext()},isScene:function(){return!0},setSpecificationVersion:function(t){this[Eh]=String(t)},getSpecificationVersion:function(){return this[Eh]},setEncoding:function(t){this[Ch]=String(t)},getEncoding:function(){return this[Ch]},setWorldURL:function(t){this[Fh]=String(t)},getWorldURL:function(){return this[Fh]},setProfile:function(t){this[Oh]=t,this._profile_changed=this.getBrowser().getCurrentTime()},getProfile:function(){return this[Oh]},hasComponent:function(t){return(this[Oh]?.components.has(t)??!0)||this[Nh].has(t)},addComponent:function(t){this[Nh].add(t.name,t),this._components_changed=this.getBrowser().getCurrentTime()},removeComponent:function(t){this[Nh].remove(t),this._components_changed=this.getBrowser().getCurrentTime()},getComponents:function(){return this[Nh]},updateUnit:function(t,e,n){this[Ih].has(t)&&(this[Ih].update(t,t,new dh(t,String(e),Number(n))),this._units_changed=this.getBrowser().getCurrentTime())},getUnit:function(t){return this[Ih].get(t)},getUnits:function(){return this[Ih]},fromUnit:function(t,e){switch(t){case"angle":case"force":case"length":case"mass":return e*this.getUnits().get(t).conversionFactor;case"acceleration:":case"speed":return e*this.getUnits().get("length").conversionFactor;case"angularRate":return e*this.getUnits().get("angle").conversionFactor;case"area":return e*Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return e*Math.pow(this.getUnits().get("length").conversionFactor,3)}return e},toUnit:function(t,e){switch(t){case"angle":case"force":case"length":case"mass":return e/this.getUnits().get(t).conversionFactor;case"acceleration:":case"speed":return e/this.getUnits().get("length").conversionFactor;case"angularRate":return e/this.getUnits().get("angle").conversionFactor;case"area":return e/Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return e/Math.pow(this.getUnits().get("length").conversionFactor,3)}return e},setMetaData:function(t,e){if(!(t=String(t)).length)throw new Error("Couldn't add metadata: name is empty.");if(Array.isArray(e)||(e=[String(e)]),!e.length)throw new Error("Couldn't add metadata: values length is 0.");this[Mh].set(t,e.map((t=>String(t)))),this._metadata_changed=this.getBrowser().getCurrentTime()},addMetaData:function(t,e){if(t=String(t),e=String(e),!t.length)throw new Error("Couldn't add metadata: name is empty.");let n=this[Mh].get(t);n||this[Mh].set(t,n=[]),n.push(e)},removeMetaData:function(t){t=String(t),this[Mh].delete(t),this._metadata_changed=this.getBrowser().getCurrentTime()},getMetaData:function(t){t=String(t);const e=this[Mh].get(t);if(e)return Array.from(e)},getMetaDatas:function(){return new Map(this[Mh])},addExportedNode:function(t,e){if(t=String(t),this[Dh].has(t))throw new Error("Couldn't add exported node: exported name '"+t+"' already in use.");this.updateExportedNode(t,e),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},updateExportedNode:function(t,e){if(t=String(t),e=rc(c.X3DNode,e,!1),0===t.length)throw new Error("Couldn't update exported node: node exported name is empty.");if(!e)throw new Error("Couldn't update exported node: node must be of type X3DNode.");this.removeExportedNode(t);const n=new wh(t,e);this[Dh].add(t,n),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},removeExportedNode:function(t){t=String(t),this[Dh].remove(t),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},getExportedNode:function(t){t=String(t);const e=this[Dh].get(t);if(e)return wn.get(e.getLocalNode());throw new Error("Exported node '"+t+"' not found.")},getExportedNodes:function(){return this[Dh]},getUniqueExportName:function(t){return l(this[Dh],t)},addRootNode:function(t){t=wn.get(rc(c.X3DNode,t,!1));const e=this.getRootNodes();for(const n of e)if(n.equals(t))return;e.push(t)},removeRootNode:function(t){t=wn.get(rc(c.X3DNode,t,!1));const e=this.getRootNodes(),n=e.length;e.erase(e.remove(0,n,t),n)},setRootNodes:function(t){if(!(t instanceof ji.MFNode))throw new Error("Value must be of type MFNode.");this.getRootNodes().assign(t)},toVRMLStream:function(t){t.string+=t.Indent(),t.string+="#X3D V",t.string+=Vh,t.string+=t.Space(),t.string+="utf8",t.string+=t.Space(),t.string+=this.getBrowser().name,t.string+=t.Space(),t.string+="V",t.string+=this.getBrowser().version,t.string+=t.ForceBreak(),t.string+=t.ForceBreak();const e=this.getProfile();e&&(e.toVRMLStream(t),t.string+=t.Break(),t.string+=t.TidyBreak());const n=this.getComponents();n.length&&(n.toVRMLStream(t),t.string+=t.TidyBreak());const i=this.getUnits().filter((t=>1!==t.conversionFactor));if(i.length){for(const e of i)e.toVRMLStream(t),t.string+=t.Break();t.string+=t.TidyBreak()}const o=this.getMetaDatas();if(o.size){for(const[e,n]of o)for(const i of n)t.string+=t.Indent(),t.string+="META",t.string+=t.Space(),t.string+=new ji.SFString(e).toString(),t.string+=t.Space(),t.string+=new ji.SFString(i).toString(),t.string+=t.Break();t.string+=t.TidyBreak()}const r=this.getExportedNodes();t.PushExecutionContext(this),t.EnterScope(),t.ExportedNodes(r),ih.prototype.toVRMLStream.call(this,t),r.length&&(t.string+=t.TidyBreak(),r.toVRMLStream(t)),t.LeaveScope(),t.PopExecutionContext()},toXMLStream:function(t){if(t.html||(t.string+=t.Indent(),t.string+='<?xml version="1.0" encoding="UTF-8"?>',t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D ',t.string+=Vh,t.string+='//EN" "http://www.web3d.org/specifications/x3d-',t.string+=Vh,t.string+='.dtd">',t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+="<X3D",t.string+=t.Space(),t.string+="profile='",t.string+=this.getProfile()?this.getProfile().name:"Full",t.string+="'",t.string+=t.Space(),t.string+="version='",t.string+=Vh,t.string+="'",t.string+=t.Space(),t.string+="xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance'",t.string+=t.Space(),t.string+="xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-",t.string+=Vh,t.string+=".xsd'>",t.string+=t.TidyBreak(),t.IncIndent(),this.getComponents().length||this.getUnits().some((t=>1!==t.conversionFactor))||this.getMetaDatas().size){t.string+=t.Indent(),t.string+="<head>",t.string+=t.TidyBreak(),t.IncIndent(),this.getComponents().toXMLStream(t);for(const e of this.getUnits())1!==e.conversionFactor&&(e.toXMLStream(t),t.string+=t.TidyBreak());for(const[e,n]of this.getMetaDatas())for(const i of n)t.string+=t.Indent(),t.string+="<meta",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(e),t.string+="'",t.string+=t.Space(),t.string+="content='",t.string+=t.XMLEncode(i),t.string+="'",t.string+=t.closingTags?"></meta>":"/>",t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="</head>",t.string+=t.TidyBreak()}if(this.getExternProtoDeclarations().length||this.getProtoDeclarations().length||this.getRootNodes().length){t.string+=t.Indent(),t.string+="<Scene>",t.string+=t.TidyBreak(),t.IncIndent();const e=this.getExportedNodes();t.PushExecutionContext(this),t.EnterScope(),t.ExportedNodes(e),ih.prototype.toXMLStream.call(this,t),e.toXMLStream(t),t.LeaveScope(),t.PopExecutionContext(),t.DecIndent(),t.string+=t.Indent(),t.string+="</Scene>",t.string+=t.TidyBreak()}else t.string+=t.Indent(),t.string+="<Scene/>",t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="</X3D>"},toJSONStream:function(t){t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="X3D",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="encoding",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+="UTF-8",t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@profile",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=this.getProfile()?this.getProfile().name:"Full",t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@version",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=Vh,t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@xsd:noNamespaceSchemaLocation",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+="http://www.web3d.org/specifications/x3d-",t.string+=Vh,t.string+=".xsd",t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="JSON schema",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+="http://www.web3d.org/specifications/x3d-",t.string+=Vh,t.string+="-JSONSchema.json",t.string+='"',t.string+=",",t.string+=t.TidyBreak();const e=this.getUnits().some((t=>1!==t.conversionFactor));if(this.getComponents().length||e||this.getMetaDatas().size){let n=!1;if(t.string+=t.Indent(),t.string+='"',t.string+="head",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),this.getMetaDatas().size){n&&(t.string+=",",t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+='"',t.string+="meta",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const[e,[n,i]]of[...this.getMetaDatas()].entries())for(const[o,r]of i.entries())t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(n),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@content",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.JSONEncode(r),t.string+='"',t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",e===this.getMetaDatas().size-1&&o===i.length-1||(t.string+=","),t.string+=t.TidyBreak();t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",n=!0}this.getComponents().length&&(n&&(t.string+=",",t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+='"',t.string+="component",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),this.getComponents().toJSONStream(t),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",n=!0),e&&(n&&(t.string+=",",t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+='"',t.string+="unit",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),this.getUnits().toJSONStream(t),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",n=!0),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=",",t.string+=t.TidyBreak()}t.string+=t.Indent(),t.string+='"',t.string+="Scene",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();const n=this.getExportedNodes();t.PushExecutionContext(this),t.EnterScope(),t.ExportedNodes(n),ih.prototype.toJSONStream.call(this,t),this.getExportedNodes().toJSONStream(t,!0),t.JSONRemoveComma(),t.LeaveScope(),t.PopExecutionContext(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}},{setExecutionContext:function(t){if(!this.isMainScene()){const t=this.getScene();for(const e of this[Rh])t.removeLoadingObject(e)}if(ih.prototype.setExecutionContext.call(this,t),!this.isMainScene()){const t=this.getScene();for(const e of this[Rh])t.addLoadingObject(e)}},addInitLoadCount:function(t){this._initLoadCount=this._initLoadCount.getValue()+1},removeInitLoadCount:function(t){this._initLoadCount=this._initLoadCount.getValue()-1},getLoadingObjects:function(){return this[Rh]},addLoadingObject:function(t){if(this[Rh].has(t))return;this[Rh].add(t),this._loadCount=this[Rh].size;const e=this.getBrowser(),n=this.getScene();this!==e.getExecutionContext()&&this.loader!==e.loader||e.addLoadingObject(t),this.isMainScene()||n.addLoadingObject(t)},removeLoadingObject:function(t){if(!this[Rh].has(t))return;this[Rh].delete(t),this._loadCount=this[Rh].size;const e=this.getBrowser(),n=this.getScene();this!==e.getExecutionContext()&&this.loader!==e.loader||e.removeLoadingObject(t),this.isMainScene()||n.removeLoadingObject(t)}});for(const t of Reflect.ownKeys(Ah.prototype))Object.defineProperty(Ah.prototype,t,{enumerable:!1});Object.defineProperties(Ah.prototype,{specificationVersion:{get:Ah.prototype.getSpecificationVersion,enumerable:!0},encoding:{get:Ah.prototype.getEncoding,enumerable:!0},profile:{get:Ah.prototype.getProfile,enumerable:!0},components:{get:Ah.prototype.getComponents,enumerable:!0},worldURL:{get:Ah.prototype.getWorldURL,enumerable:!0},units:{get:Ah.prototype.getUnits,enumerable:!0},rootNodes:{get:Ah.prototype.getRootNodes,set:Ah.prototype.setRootNodes,enumerable:!0}});const Ph=Ah;n.set("x_ite/Execution/X3DScene",Ph);const Lh=Ph,Bh=new WeakMap,Xh=new WeakMap,Uh=new WeakMap,kh={get:function(t,e){const n=t[e];if(void 0!==n)return n;const i=t.getStorage()[t.getNameSpace()+e];if(void 0===i||"undefined"===i||null===i)return t.getDefaultValue(e);return JSON.parse(i)},set:function(t,e,n){return void 0===n?t.getStorage().removeItem(t.getNameSpace()+e):t.getStorage()[t.getNameSpace()+e]=JSON.stringify(n),!0}};function zh(t,e){return this.target=this,Bh.set(this,t),Xh.set(this,e),Uh.set(this,{}),new Proxy(this,kh)}zh.prototype={constructor:zh,getStorage:function(){return Bh.get(this.target)},getNameSpace:function(){return Xh.get(this.target)},addNameSpace:function(t){return new zh(this.getStorage(),this.getNameSpace()+t)},addDefaultValues:function(t){Object.assign(Uh.get(this.target),t)},getDefaultValue(t){const e=Uh.get(this.target)[t];return void 0===e?void 0:JSON.parse(JSON.stringify(e))},clear:function(){const t=this.getStorage(),e=this.getNameSpace();for(const n of Object.keys(t))n.startsWith(e)&&t.removeItem(n)}};const jh=zh;n.set("standard/Utility/DataStorage",jh);const Gh=jh;var Hh=i(532);const qh=Symbol(),Yh=Symbol(),Wh=Symbol(),Kh=Symbol(),Jh=Symbol(),Zh=Symbol(),Qh=Symbol(),$h=Symbol(),td=Symbol(),ed=Symbol(),nd=Symbol(),id=Symbol(),od=Symbol(),rd=Symbol(),sd=Symbol(),ad=Symbol(),ud=Symbol(),cd=Symbol(),ld=Symbol();let hd=0;function dd(t){const e=Hh("<div></div>").addClass("x_ite-private-browser").attr("tabindex",0),n=Hh("<div></div>").addClass("x_ite-private-surface").appendTo(e),i=Hh("<div></div>").hide().addClass("x_ite-private-splash-screen").appendTo(e),o=(Hh("<div></div>").addClass("x_ite-private-spinner").appendTo(i),Hh("<div></div>").addClass("x_ite-private-progress").appendTo(i));if("x3d-canvas"===t.prop("nodeName").toLowerCase()){const n=Hh(t[0].attachShadow({mode:"open",delegatesFocus:!0})),i=Hh("<link/>");i.on("load",(()=>e.show())).attr("rel","stylesheet").attr("type","text/css").attr("href",new URL("x_ite.css",cr.getScriptUrl()).href),this[Wh]=n.append(i).append(e.hide())}else this[Wh]=t.prepend(e);Hh("<div></div>").addClass("x_ite-private-x_ite").html(this.getName()+"<span class='x_ite-private-x3d'>X3D</span>").appendTo(o),Hh("<div></div>").addClass("x_ite-private-progressbar").appendTo(o).append(Hh("<div></div>")),Hh("<div></div>").addClass("x_ite-private-spinner-text").appendTo(o),this[qh]=++hd,this[Yh]=t,this[Kh]=n,this[Jh]=Hh("<canvas></canvas>").addClass("x_ite-private-canvas").prependTo(n),this[Zh]=mo.create(this[Jh][0],2,"true"===t.attr("preserveDrawingBuffer")),this[Qh]=i,this[$h]=new Gh(localStorage,"X_ITE.X3DBrowser("+this[qh]+")."),this[td]=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this[od]=new Jo(this.getPrivateScene()),this[nd]=new Go(this.getPrivateScene()),this[id]=new Yo(this.getPrivateScene()),this[ed]=new Mo(this.getPrivateScene()),this[rd]=new tr(this.getPrivateScene()),this[sd]=new rr(this.getPrivateScene());const r=Hh("<div></div>").hide().css("height","10in").appendTo(Hh("body"));this[ld]=r.height()/720||1,r.remove(),this.addChildObjects("controlKey",new ji.SFBool,"shiftKey",new ji.SFBool,"altKey",new ji.SFBool,"altGrKey",new ji.SFBool)}dd.prototype={initialize:function(){this[od].setup(),this[nd].setup(),this[id].setup(),this[ed].setup(),this[rd].setup(),this[sd].setup(),Object.defineProperties(this.getElement().get(0),{browser:{value:this,enumerable:!0},src:{get:()=>this.getExecutionContext().getWorldURL(),set:t=>{this.loadURL(new ji.MFString(t),new ji.MFString)},enumerable:!0},url:{get:()=>new ji.MFString(this.getExecutionContext().getWorldURL()),set:t=>{this.loadURL(t,new ji.MFString)},enumerable:!0}}),this.getElement().on("keydown.X3DCoreContext",this[ud].bind(this)).on("keyup.X3DCoreContext",this[cd].bind(this))},getInstanceId:function(){return this[qh]},isStrict:function(){return!1},getElement:function(){return this[Yh]},getShadow:function(){return this[Wh]},getSurface:function(){return this[Kh]},getSplashScreen:function(){return this[Qh]},getCanvas:function(){return this[Jh]},getContext:function(){return this[Zh]},getMobile:function(){return this[td]},getLocalStorage:function(){return this[$h]},getBrowserTimings:function(){return this[ed]},getBrowserOptions:function(){return this[nd]},getBrowserProperties:function(){return this[id]},getRenderingProperties:function(){return this[od]},getNotification:function(){return this[rd]},getContextMenu:function(){return this[sd]},getPrivateScene:function(){return this[ad]||(this[ad]=new Lh(this),this[ad].setPrivate(!0),this[ad].setLive(!0),this[ad].setup()),this[ad]},getPixelPerPoint:function(){return this[ld]*this.getRenderingProperty("ContentScale")},connectedCallback:function(){},attributeChangedCallback:function(t,e,n){switch(t){case"antialiased":this.setBrowserOption("Antialiased",this.parseBooleanAttribute(n,!0));break;case"baseURL":case"baseurl":this.setBaseURL(n);break;case"cache":this.setBrowserOption("Cache",this.parseBooleanAttribute(n,!0));break;case"contentScale":case"contentscale":this.setBrowserOption("ContentScale","auto"===n?-1:parseFloat(n));break;case"contextMenu":case"contextmenu":this.setBrowserOption("ContextMenu",this.parseBooleanAttribute(n,!0));break;case"debug":this.setBrowserOption("Debug",this.parseBooleanAttribute(n,!1));break;case"multisampling":{const t=parseInt(n);this.setBrowserOption("Multisampling",isNaN(t)?4:t);break}case"notifications":this.setBrowserOption("Notifications",this.parseBooleanAttribute(n,!0));break;case"oninitialized":case"onshutdown":try{this.getElement()[0][t]=new Function("event",n)}catch(t){console.error(t)}break;case"splashScreen":case"splashscreen":this.setBrowserOption("SplashScreen",this.parseBooleanAttribute(n,!0)),this.getBrowserOption("SplashScreen")||(this.getCanvas().show(),this.getSplashScreen().stop(!0,!0).hide());break;case"src":n&&this.loadURL(new ji.MFString(n),new ji.MFString);break;case"timings":this.setBrowserOption("Timings",this.parseBooleanAttribute(n,!1));break;case"update":"auto"===n?this.setBrowserOption("AutoUpdate",!0):(this.setBrowserOption("AutoUpdate",!1),this.parseBooleanAttribute(n,!0)?this.beginUpdate():this.endUpdate());break;case"url":n&&this.loadURL(this.parseUrlAttribute(n),new ji.MFString)}},parseBooleanAttribute:function(t,e){return"true"===t||"false"!==t&&e},parseUrlAttribute:function(t){const e=new ji.MFString;return e.fromString("["+t+"]",this.getExecutionContext()),e},callBrowserEventHandler:function(){const t=new Set(["error","load"]);return function(e){const n=this.getElement()[0];for(const i of e.split(" ")){const e=new CustomEvent(i);try{t.has(i)||n[`on${i}`]?.(e)}catch(t){console.error(t)}n.dispatchEvent(e)}}}(),getShiftKey:function(){return this._shiftKey.getValue()},getControlKey:function(){return this._controlKey.getValue()},getAltKey:function(){return this._altKey.getValue()},getAltGrKey:function(){return this._altGrKey.getValue()},[ud]:function(t){switch(t.keyCode){case 16:this._shiftKey=!0;break;case 17:this._controlKey=!0;break;case 18:this._altKey=!0;break;case 49:this.getBrowserOption("Debug")&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","POINT"),this.getNotification()._string="Shading: Pointset");break;case 50:this.getBrowserOption("Debug")&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","WIREFRAME"),this.getNotification()._string="Shading: Wireframe");break;case 51:this.getBrowserOption("Debug")&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","FLAT"),this.getNotification()._string="Shading: Flat");break;case 52:this.getBrowserOption("Debug")&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","GOURAUD"),this.getNotification()._string="Shading: Gouraud");break;case 53:this.getBrowserOption("Debug")&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","PHONG"),this.getNotification()._string="Shading: Phong");break;case 83:this.getBrowserOption("Debug")&&this.getControlKey()&&(t.preventDefault(),this.isLive()?this.endUpdate():this.beginUpdate(),this.getNotification()._string=this.getLive().getValue()?"Begin Update":"End Update");break;case 225:this._altGrKey=!0;break;case 171:case 187:this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Timings",!this.getBrowserOption("Timings")));break;case 36:t.preventDefault(),this.firstViewpoint();break;case 35:t.preventDefault(),this.lastViewpoint();break;case 33:t.preventDefault(),this.previousViewpoint();break;case 34:t.preventDefault(),this.nextViewpoint();break;case 119:if(this.getShiftKey()){t.preventDefault();const e=this.getActiveViewpoint();if(!e)break;const n=this.getPrivateScene().createNode(e.getTypeName());switch(e.getTypeName()){case"Viewpoint":n.position=e.getUserPosition(),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getUserCenterOfRotation(),n.fieldOfView=e.getFieldOfView();break;case"OrthoViewpoint":n.position=e.getUserPosition(),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getUserCenterOfRotation(),n.fieldOfView=new ji.MFFloat(e.getMinimumX(),e.getMinimumY(),e.getMaximumX(),e.getMaximumY());break;case"GeoViewpoint":{const t=e._geoOrigin,i=new Se(0,0,0);if(t.getValue()&&"GeoOrigin"===t.getNodeTypeName()){const e=this.getPrivateScene().createNode("GeoOrigin");n.geoOrigin=e,e.geoSystem=t.geoSystem,e.geoCoords=t.geoCoords,e.rotateYUp=t.rotateYUp}n.geoSystem=e._geoSystem,n.position=e.getGeoCoord(e.getUserPosition(),i),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getGeoCoord(e.getUserCenterOfRotation(),i),n.fieldOfView=e.getFieldOfView();break}}let i;switch(this.getExecutionContext().getEncoding()){case"ASCII":case"VRML":i=n.toVRMLString();break;case"JSON":i=n.toJSONString();break;default:i=n.toXMLString()}i+="\n",this.copyToClipboard(i),this.getNotification()._string=Co("Viewpoint copied to clipboard."),console.log("Viewpoint copied to clipboard."),console.debug(i)}}},[cd]:function(t){switch(t.which){case 16:this._shiftKey=!1;break;case 17:this._controlKey=!1;break;case 18:this._altKey=!1;break;case 225:this._altGrKey=!1}},copyToClipboard:function(t){const e=Hh("<textarea></textarea>");this.getShadow().find(".x_ite-private-browser").prepend(e),e.text(t).trigger("select"),document.execCommand("copy"),e.remove()},dispose:function(){this[Zh].getExtension("WEBGL_lose_context")?.loseContext()}};const pd=dd;n.set("x_ite/Browser/Core/X3DCoreContext",pd);const fd=pd;function gd(t){dr.call(this,t),this.addType(c.TextureProperties),t.getSpecificationVersion()<4&&(this._minificationFilter="DEFAULT",this._magnificationFilter="DEFAULT",this._textureCompression="DEFAULT")}gd.prototype=Object.assign(Object.create(dr.prototype),{constructor:gd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"borderColor",new ji.SFColorRGBA),new k(c.inputOutput,"borderWidth",new ji.SFInt32),new k(c.inputOutput,"anisotropicDegree",new ji.SFFloat(1)),new k(c.initializeOnly,"generateMipMaps",new ji.SFBool),new k(c.inputOutput,"minificationFilter",new ji.SFString("FASTEST")),new k(c.inputOutput,"magnificationFilter",new ji.SFString("FASTEST")),new k(c.inputOutput,"boundaryModeS",new ji.SFString("REPEAT")),new k(c.inputOutput,"boundaryModeT",new ji.SFString("REPEAT")),new k(c.inputOutput,"boundaryModeR",new ji.SFString("REPEAT")),new k(c.inputOutput,"textureCompression",new ji.SFString("FASTEST")),new k(c.inputOutput,"texturePriority",new ji.SFFloat)]),getTypeName:function(){return"TextureProperties"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureProperties"},getSpecificationRange:function(){return["3.0","Infinity"]},getBorderWidth:function(){return d.clamp(this._borderWidth.getValue(),0,1)},getBoundaryMode:function(){const t=new Map([["CLAMP","CLAMP_TO_EDGE"],["CLAMP_TO_EDGE","CLAMP_TO_EDGE"],["CLAMP_TO_BOUNDARY","CLAMP_TO_EDGE"],["MIRRORED_REPEAT","MIRRORED_REPEAT"],["REPEAT","REPEAT"]]);return function(e){const n=t.get(e);return void 0!==n?n:"REPEAT"}}(),getBoundaryModeS:function(){return this.getBoundaryMode(this._boundaryModeS.getValue())},getBoundaryModeT:function(){return this.getBoundaryMode(this._boundaryModeT.getValue())},getBoundaryModeR:function(){return this.getBoundaryMode(this._boundaryModeR.getValue())},getMinificationFilter:function(){const t=new Map([["AVG_PIXEL_AVG_MIPMAP","LINEAR_MIPMAP_LINEAR"],["AVG_PIXEL","LINEAR"],["AVG_PIXEL_NEAREST_MIPMAP","LINEAR_MIPMAP_NEAREST"],["NEAREST_PIXEL_AVG_MIPMAP","NEAREST_MIPMAP_LINEAR"],["NEAREST_PIXEL_NEAREST_MIPMAP","NEAREST_MIPMAP_NEAREST"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR_MIPMAP_LINEAR"],["FASTEST","NEAREST"]]);return function(){if(this._generateMipMaps.getValue()){const e=t.get(this._minificationFilter.getValue());return void 0!==e?e:this.getBrowser().getDefaultTextureProperties().getMinificationFilter()}return"LINEAR"}}(),getMagnificationFilter:function(){const t=new Map([["AVG_PIXEL","LINEAR"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR"],["FASTEST","NEAREST"]]);return function(){const e=t.get(this._magnificationFilter.getValue());return void 0!==e?e:this.getBrowser().getDefaultTextureProperties().getMagnificationFilter()}}(),getTextureCompression:function(){const t=new Map([["DEFAULT","RGBA"],["NICEST","RGBA"],["FASTEST","RGBA"],["LOW","RGBA"],["MEDIUM","RGBA"],["HIGH","RGBA"]]);return function(){const e=this.getBrowser().getContext(),n=e.getExtension("WEBGL_compressed_texture_etc"),i=n?n[t.get(this._textureCompression.getValue())]:void 0;return void 0!==i?i:e.RGBA}}()});const md=gd;n.set("x_ite/Components/Texturing/TextureProperties",md);const _d=md,xd=Symbol();function yd(){}yd.prototype={getBackgroundTextureProperties:function(){return this[xd]=new _d(this.getPrivateScene()),this[xd]._boundaryModeS="CLAMP_TO_EDGE",this[xd]._boundaryModeT="CLAMP_TO_EDGE",this[xd]._boundaryModeR="CLAMP_TO_EDGE",this[xd]._minificationFilter="NICEST",this[xd]._magnificationFilter="NICEST",this[xd]._textureCompression="DEFAULT",this[xd].setup(),this.getBackgroundTextureProperties=function(){return this[xd]},Object.defineProperty(this,"getBackgroundTextureProperties",{enumerable:!1}),this[xd]}};const wd=yd;n.set("x_ite/Browser/EnvironmentalEffects/X3DEnvironmentalEffectsContext",wd);const Sd=wd;function Td(t){Bu.call(this,t),this.addType(c.X3DComposedGeometryNode),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}Td.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Td,initialize:function(){Bu.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__(),this.set_coord__()},getFogCoord:function(){return this.fogCoordNode},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getCoord:function(){return this.coordNode},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=rc(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=rc(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=rc(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_texCoord__:function(){this.texCoordNode?.removeInterest("requestRebuild",this),this.texCoordNode=rc(c.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode?.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__:function(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=rc(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=rc(c.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},getPolygonIndex:function(t){return t},getTriangleIndex:function(t){return t},build:function(t,e,n,i){if(!this.coordNode||this.coordNode.isEmpty())return;e-=e%t,i-=i%n;const o=this._colorPerVertex.getValue(),r=this._normalPerVertex.getValue(),s=this.getAttrib(),a=s.length,u=this.getAttribs(),c=this.getFogCoord(),l=this.getColor(),h=this.getTexCoord(),d=this.getNormal(),p=this.getCoord(),f=this.getFogDepths(),g=this.getColors(),m=this.getMultiTexCoords(),_=this.getNormals(),x=this.getVertices();h?.init(m);for(let t=0;t<i;++t){const e=Math.floor(t/n),i=this.getPolygonIndex(this.getTriangleIndex(t));for(let t=0;t<a;++t)s[t].addValue(i,u[t]);c?.addDepth(i,f),l&&(o?l.addColor(i,g):l.addColor(e,g)),h?.addPoint(i,m),d&&(r?d.addVector(i,_):d.addVector(e,_)),p.addPoint(i,x)}this.getNormal()||this.buildNormals(t,e,i),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},buildNormals:function(t,e,n){const i=this.createNormals(t,e),o=this.getNormals();for(let t=0;t<n;++t){const e=i[this.getTriangleIndex(t)];o.push(e.x,e.y,e.z)}},createNormals:function(t,e){const n=this.createFaceNormals(t,e);if(this._normalPerVertex.getValue()){const t=[];for(let n=0;n<e;++n){const e=this.getPolygonIndex(n);let i=t[e];i||(i=t[e]=[]),i.push(n)}return this.refineNormals(t,n,Math.PI)}return n},createFaceNormals:function(t,e){const n=!this._ccw.getValue(),i=this.coordNode,o=[];for(let r=0;r<e;r+=t){const e=this.getPolygonNormal(r,t,i);n&&e.negate();for(let n=0;n<t;++n)o.push(e)}return o},getPolygonNormal:function(){let t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i,o){const r=new Se(0,0,0);o.get1Point(this.getPolygonIndex(n),e);for(let s=0;s<i;++s){const a=t;t=e,e=a,o.get1Point(this.getPolygonIndex(n+(s+1)%i),e),r.x+=(t.y-e.y)*(t.z+e.z),r.y+=(t.z-e.z)*(t.x+e.x),r.z+=(t.x-e.x)*(t.y+e.y)}return r.normalize()}}()});const bd=Td;n.set("x_ite/Components/Rendering/X3DComposedGeometryNode",bd);const vd=bd;function Ed(t){vd.call(this,t),this.addType(c.IndexedFaceSet),this._creaseAngle.setUnit("angle")}Ed.prototype=Object.assign(Object.create(vd.prototype),{constructor:Ed,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_colorIndex",new ji.MFInt32),new k(c.inputOnly,"set_texCoordIndex",new ji.MFInt32),new k(c.inputOnly,"set_normalIndex",new ji.MFInt32),new k(c.inputOnly,"set_coordIndex",new ji.MFInt32),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"convex",new ji.SFBool(!0)),new k(c.initializeOnly,"creaseAngle",new ji.SFFloat),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"normalPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"colorIndex",new ji.MFInt32),new k(c.initializeOnly,"texCoordIndex",new ji.MFInt32),new k(c.initializeOnly,"normalIndex",new ji.MFInt32),new k(c.initializeOnly,"coordIndex",new ji.MFInt32),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"IndexedFaceSet"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){vd.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_texCoordIndex.addFieldInterest(this._texCoordIndex),this._set_normalIndex.addFieldInterest(this._normalIndex),this._set_coordIndex.addFieldInterest(this._coordIndex)},getTexCoordPerVertexIndex:function(t){return t<this._texCoordIndex.length?this._texCoordIndex[t]:this._coordIndex[t]},getColorPerVertexIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:this._coordIndex[t]},getColorIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:t},getNormalPerVertexIndex:function(t){return t<this._normalIndex.length?this._normalIndex[t]:this._coordIndex[t]},getNormalIndex:function(t){return t<this._normalIndex.length?this._normalIndex[t]:t},build:function(){const t=this.triangulate();if(0===t.length)return;const e=this._colorPerVertex.getValue(),n=this._normalPerVertex.getValue(),i=this._coordIndex.getValue(),o=this.getAttrib(),r=o.length,s=this.getAttribs(),a=this.getFogCoord(),u=this.getColor(),c=this.getTexCoord(),l=this.getNormal(),h=this.getCoord(),d=this.getFogDepths(),p=this.getColors(),f=this.getMultiTexCoords(),g=this.getNormals(),m=this.getVertices();c?.init(f);for(const _ of t){const t=_.triangles,x=_.face;for(const _ of t){const t=i[_];for(let e=0;e<r;++e)o[e].addValue(t,s[e]);a?.addDepth(t,d),u&&(e?u.addColor(this.getColorPerVertexIndex(_),p):u.addColor(this.getColorIndex(x),p)),c?.addPoint(this.getTexCoordPerVertexIndex(_),f),l&&(n?l.addVector(this.getNormalPerVertexIndex(_),g):l.addVector(this.getNormalIndex(x),g)),h.addPoint(t,m)}}this.getNormal()||this.buildNormals(t),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},triangulate:function(){const t=this._convex.getValue(),e=this._coordIndex.length,n=[];if(!this.getCoord())return n;if(e&&this._coordIndex[e-1]>-1&&this._coordIndex.push(-1),e){const e=this._coordIndex.getValue(),i=this._coordIndex.length;let o=[];for(let r=0,s=0;r<i;++r){if(e[r]>-1)o.push(r);else{if(o.length)switch(o.length){case 0:case 1:case 2:o.length=0;break;case 3:n.push({vertices:o,triangles:o,face:s}),o=[];break;default:{const e=[],i={vertices:o,triangles:e,face:s};t?Oa.triangulateConvexPolygon(o,e):this.triangulatePolygon(o,e),e.length<3?o.length=0:(n.push(i),o=[]);break}}++s}}}return n},triangulatePolygon:function(){const t=[];return function(e,n){const i=this._coordIndex.getValue(),o=this.getCoord(),r=e.length;for(let e=t.length;e<r;++e)t.push(new Se(0,0,0));for(let n=0;n<r;++n){const r=e[n],s=t[n];s.index=r,o.get1Point(i[r],s)}t.length=r,Oa.triangulatePolygon(t,n)}}(),buildNormals:function(t){const e=this.createNormals(t),n=this.getNormals();for(const i of t)for(const t of i.triangles){const i=e[t];n.push(i.x,i.y,i.z)}},createNormals:function(){const t=[],e=[];return function(n){const i=!this._ccw.getValue(),o=this._coordIndex.getValue(),r=this.getCoord();t.length=0,e.length=0;for(const a of n){const n=a.vertices,u=n.length;switch(u){case 3:var s=r.getNormal(o[n[0]],o[n[1]],o[n[2]]);break;case 4:s=r.getQuadNormal(o[n[0]],o[n[1]],o[n[2]],o[n[3]]);break;default:s=this.getPolygonNormal(n,o,r)}for(let t=0;t<u;++t){const i=n[t],r=o[i];let s=e[r];s||(s=e[r]=[]),s.push(i)}i&&s.negate();for(let e=0;e<u;++e)t[n[e]]=s}return this.refineNormals(e,t,this._creaseAngle.getValue())}}(),getPolygonNormal:function(){let t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i,o){const r=new Se(0,0,0);o.get1Point(i[n[0]],e);for(let s=0,a=n.length;s<a;++s){const u=t;t=e,e=u,o.get1Point(i[n[(s+1)%a]],e),r.x+=(t.y-e.y)*(t.z+e.z),r.y+=(t.z-e.z)*(t.x+e.x),r.z+=(t.x-e.x)*(t.y+e.y)}return r.normalize()}}()});const Cd=Ed;n.set("x_ite/Components/Geometry3D/IndexedFaceSet",Cd);const Od=Cd;function Nd(t){dr.call(this,t),this.addType(c.X3DGeometricPropertyNode)}Nd.prototype=Object.assign(Object.create(dr.prototype),{constructor:Nd});const Fd=Nd;n.set("x_ite/Components/Rendering/X3DGeometricPropertyNode",Fd);const Id=Fd;function Md(t){Id.call(this,t),this.addType(c.X3DCoordinateNode)}Md.prototype=Object.assign(Object.create(Id.prototype),{constructor:Md,initialize:function(){Id.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},set1Point:function(t,e){this._point[t]=e},get1Point:function(t,e){if(t<this.length){const n=this.point;return t*=3,e.set(n[t],n[t+1],n[t+2])}return e.set(0,0,0)},addPoint:function(t,e){if(t<this.length){const n=this.point;t*=3,e.push(n[t],n[t+1],n[t+2],1)}else e.push(0,0,0,1)},addPoints:function(t,e){const n=this.point;for(var i=0,o=3*this.length;i<o;i+=3)t.push(n[i],n[i+1],n[i+2],1);for(i=o,o=3*e;i<o;i+=3)t.push(0,0,0,1)},getNormal:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0);return function(i,o,r){const s=this.length;return i<s&&o<s&&r<s?Oa.normal(this.get1Point(i,t),this.get1Point(o,e),this.get1Point(r,n),new Se(0,0,0)):new Se(0,0,0)}}(),getQuadNormal:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new Se(0,0,0);return function(o,r,s,a){const u=this.length;return o<u&&r<u&&s<u&&a<u?Oa.quadNormal(this.get1Point(o,t),this.get1Point(r,e),this.get1Point(s,n),this.get1Point(a,i),new Se(0,0,0)):new Se(0,0,0)}}()});const Dd=Md;n.set("x_ite/Components/Rendering/X3DCoordinateNode",Dd);const Rd=Dd;function Vd(t){Rd.call(this,t),this.addType(c.Coordinate),this._point.setUnit("length")}Vd.prototype=Object.assign(Object.create(Rd.prototype),{constructor:Vd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"point",new ji.MFVec3f)]),getTypeName:function(){return"Coordinate"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"coord"},getSpecificationRange:function(){return["2.0","Infinity"]}});const Ad=Vd;n.set("x_ite/Components/Rendering/Coordinate",Ad);const Pd=Ad;function Ld(t){Id.call(this,t),this.addType(c.X3DTextureCoordinateNode)}Ld.prototype=Object.assign(Object.create(Id.prototype),{constructor:Ld});const Bd=Ld;n.set("x_ite/Components/Texturing/X3DTextureCoordinateNode",Bd);const Xd=Bd;function Ud(t){Xd.call(this,t),this.addType(c.X3DSingleTextureCoordinateNode),this.texCoordArray=Bu.createArray()}Ud.prototype=Object.assign(Object.create(Xd.prototype),{constructor:Ud,getCount:function(){return 1},init:function(t){this.texCoordArray.length=0,t.push(this.texCoordArray)},addPoint:function(t,e){this.addPointToChannel(t,e[0])},getTextureCoordinateMapping:function(t,e=0){t.set(this._mapping.getValue()||e,e)},setShaderUniforms:function(t,e,n=0){t.uniform1i(e.x3d_TextureCoordinateGeneratorMode[n],0)}});const kd=Ud;n.set("x_ite/Components/Texturing/X3DSingleTextureCoordinateNode",kd);const zd=kd;function jd(t){zd.call(this,t),this.addType(c.TextureCoordinate)}jd.prototype=Object.assign(Object.create(zd.prototype),{constructor:jd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"mapping",new ji.SFString),new k(c.inputOutput,"point",new ji.MFVec2f)]),getTypeName:function(){return"TextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){zd.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(t,e){if(t>=0&&t<this.length){const n=this.point;return t*=2,e.set(n[t],n[t+1],0,1)}if(t>=0&&this.length){const n=this.point;return t%=this.length,t*=2,e.set(n[t],n[t+1],0,1)}return e.set(0,0,0,1)},getPoints:function(t){const e=this.point,n=this.length;for(let i=0,o=0;i<n;++i,o+=2)t.push(e[o],e[o+1],0,1);return t},addPointToChannel:function(t,e){if(t>=0&&t<this.length){const n=this.point;t*=2,e.push(n[t],n[t+1],0,1)}else if(t>=0&&this.length){const n=this.point;t%=this.length,t*=2,e.push(n[t],n[t+1],0,1)}else e.push(0,0,0,1)}});const Gd=jd;n.set("x_ite/Components/Texturing/TextureCoordinate",Gd);const Hd=Gd;function qd(t){uo.call(this,t)}qd.prototype=Object.assign(Object.create(uo.prototype),{constructor:qd,getTypeName:function(){return"BoxOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"boxOptions"},initialize:function(){uo.prototype.initialize.call(this)},getGeometry:function(){if(this.geometry)return this.geometry;this.geometry=new Od(this.getExecutionContext()),this.geometry._texCoord=new Hd(this.getExecutionContext()),this.geometry._coord=new Pd(this.getExecutionContext());const t=this.geometry,e=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();return t._texCoordIndex=new ji.MFInt32(0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1),t._coordIndex=new ji.MFInt32(0,1,2,3,-1,5,4,7,6,-1,1,5,6,2,-1,4,0,3,7,-1,4,5,1,0,-1,3,2,6,7,-1),e._point=new ji.MFVec2f(new ji.SFVec2f(1,1),new ji.SFVec2f(0,1),new ji.SFVec2f(0,0),new ji.SFVec2f(1,0)),n._point=new ji.MFVec3f(new ji.SFVec3f(1,1,1),new ji.SFVec3f(-1,1,1),new ji.SFVec3f(-1,-1,1),new ji.SFVec3f(1,-1,1),new ji.SFVec3f(1,1,-1),new ji.SFVec3f(-1,1,-1),new ji.SFVec3f(-1,-1,-1),new ji.SFVec3f(1,-1,-1)),e.setup(),n.setup(),t.setup(),this.geometry}});const Yd=qd;n.set("x_ite/Browser/Geometry3D/BoxOptions",Yd);const Wd=Yd;function Kd(t){uo.call(this,t),this.addChildObjects("xDimension",new ji.SFInt32(20),"yDimension",new ji.SFInt32(1))}Kd.prototype=Object.assign(Object.create(uo.prototype),{constructor:Kd,getTypeName:function(){return"ConeOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"coneOptions"}});const Jd=Kd;n.set("x_ite/Browser/Geometry3D/ConeOptions",Jd);const Zd=Jd;function Qd(t){uo.call(this,t),this.addChildObjects("xDimension",new ji.SFInt32(20),"yDimension",new ji.SFInt32(1))}Qd.prototype=Object.assign(Object.create(uo.prototype),{constructor:Qd,getTypeName:function(){return"CylinderOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"cylinderOptions"}});const $d=Qd;n.set("x_ite/Browser/Geometry3D/CylinderOptions",$d);const tp=$d;function ep(t){uo.call(this,t),this.addChildObjects("xDimension",new ji.SFInt32(32),"yDimension",new ji.SFInt32(15))}ep.prototype=Object.assign(Object.create(uo.prototype),{constructor:ep,getTypeName:function(){return"QuadSphereOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"quadSphereOptions"},initialize:function(){uo.prototype.initialize.call(this),this.addInterest("eventsProcessed",this)},getGeometry:function(){return this.geometry||this.eventsProcessed(),this.geometry},createTexCoordIndex:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._texCoordIndex;for(let e=0,i=t-1;e<i;++e)n.push(e),n.push(e+t-1),n.push(e+t),n.push(-1);for(let i=t-1,o=0,r=e-3;o<r;++o,++i)for(let e=0,o=t-1;e<o;++e,++i)n.push(i),n.push(i+t),n.push(i+t+1),n.push(i+1),n.push(-1);let i=(e-2)*t-1;for(let e=0,o=t-1;e<o;++e,++i)n.push(i+t),n.push(i+1),n.push(i),n.push(-1)},createTexCoord:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._texCoord.getValue()._point,i=-.5/(t-1);for(let e=1;e<t;++e){const o=e/(t-1)+i;n.push(new ge(o,1))}for(let i=1,o=e-1;i<o;++i){const o=1-i/(e-1);for(let e=0;e<t;++e){const i=e/(t-1);n.push(new ge(i,o))}}for(let e=1;e<t;++e){const o=e/(t-1)+i;n.push(new ge(o,0))}},createCoordIndex:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._coordIndex;let i=1;for(const e=t-1;i<e;++i)n.push(0),n.push(i),n.push(i+1),n.push(-1);n.push(0),n.push(i),n.push(1),n.push(-1);let o=1;for(let i=0,r=e-3;i<r;++i,++o){for(let e=0,i=t-2;e<i;++e,++o)n.push(o),n.push(o+t-1),n.push(o+t),n.push(o+1),n.push(-1);n.push(o),n.push(o+t-1),n.push(o+1),n.push(o-t+2),n.push(-1)}const r=o+t-1;for(let e=0,i=t-2;e<i;++e,++o)n.push(r),n.push(o+1),n.push(o),n.push(-1);n.push(r),n.push(r-t+1),n.push(o),n.push(-1)},createPoints:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._coord.getValue()._point;n.push(new Se(0,1,0));for(let i=1,o=e-1;i<o;++i){const e=Ks.Polar(1,-Math.PI*i/o);for(let i=0,o=t-1;i<o;++i){const t=Ks.Polar(e.imag,2*Math.PI*i/o);n.push(new Se(t.imag,e.real,t.real))}}n.push(new Se(0,-1,0))},eventsProcessed:function(){this.geometry=new Od(this.getExecutionContext()),this.geometry._texCoord=new Hd(this.getExecutionContext()),this.geometry._coord=new Pd(this.getExecutionContext()),this.createTexCoordIndex(),this.createTexCoord(),this.createCoordIndex(),this.createPoints();const t=this.geometry,e=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();t._creaseAngle=Math.PI,e.setup(),n.setup(),t.setup()}});const np=ep;n.set("x_ite/Browser/Geometry3D/QuadSphereOptions",np);const ip=np;function op(){}function rp(t,e){const n=new e(this.getPrivateScene());return n.setup(),this[t]=function(){return n},Object.defineProperty(this,t,{enumerable:!1}),n}op.prototype={initialize:function(){this.setPrimitiveQuality3D(this.getBrowserOptions().getPrimitiveQuality())},getBoxOptions:function(){return rp.call(this,"getBoxOptions",Wd)},getConeOptions:function(){return rp.call(this,"getConeOptions",Zd)},getCylinderOptions:function(){return rp.call(this,"getCylinderOptions",tp)},getSphereOptions:function(){return rp.call(this,"getSphereOptions",ip)},setPrimitiveQuality3D:function(t){const e=this.getConeOptions(),n=this.getCylinderOptions(),i=this.getSphereOptions();switch(t){case Vo.LOW:e._xDimension=16,n._xDimension=16,i._xDimension=20,i._yDimension=9;break;case Vo.MEDIUM:e._xDimension=20,n._xDimension=20,i._xDimension=32,i._yDimension=15;break;case Vo.HIGH:e._xDimension=32,n._xDimension=32,i._xDimension=64,i._yDimension=31}}};const sp=op;n.set("x_ite/Browser/Geometry3D/X3DGeometry3DContext",sp);const ap=sp;function up(t){fu.call(this,t),el.call(this,t),this.addType(c.X3DShapeNode),this.bbox=new Qa,this.bboxSize=new Se(0,0,0),this.bboxCenter=new Se(0,0,0)}up.prototype=Object.assign(Object.create(fu.prototype),el.prototype,{constructor:up,initialize:function(){fu.prototype.initialize.call(this),el.prototype.initialize.call(this),this._bboxSize.addInterest("set_bbox__",this),this._bboxCenter.addInterest("set_bbox__",this),this._appearance.addInterest("set_appearance__",this),this._geometry.addInterest("set_geometry__",this),this._appearance.addInterest("set_transparent__",this),this._geometry.addInterest("set_transparent__",this),this.set_appearance__(),this.set_geometry__(),this.set_transparent__()},getBBox:function(t,e){return e?this._castShadow.getValue()?t.assign(this.bbox):t.set():t.assign(this.bbox)},getBBoxSize:function(){return this.bboxSize},getBBoxCenter:function(){return this.bboxCenter},getAppearance:function(){return this.appearanceNode},getGeometry:function(){return this.geometryNode},setTransparent:function(t){this.transparent=t},isTransparent:function(){return this.transparent},set_bbox__:function(){this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.getGeometry()?this.bbox.assign(this.getGeometry().getBBox()):this.bbox.set():this.bbox.set(this._bboxSize.getValue(),this._bboxCenter.getValue()),this.bboxSize.assign(this.bbox.size),this.bboxCenter.assign(this.bbox.center)},set_appearance__:function(){this.appearanceNode&&this.appearanceNode._transparent.removeInterest("set_transparent__",this),this.appearanceNode=rc(c.X3DAppearanceNode,this._appearance),this.appearanceNode?(this.appearanceNode._alphaMode.addInterest("set_transparent__",this),this.appearanceNode._transparent.addInterest("set_transparent__",this)):this.appearanceNode=this.getBrowser().getDefaultAppearance()},set_geometry__:function(){this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.geometryNode=rc(c.X3DGeometryNode,this._geometry),this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.set_bbox__()},set_transparent__:function(){this.appearanceNode.getAlphaMode()===ku.AUTO?this.transparent=!(!this.appearanceNode.isTransparent()&&!this.geometryNode?.isTransparent()):this.transparent=this.appearanceNode.isTransparent()},dispose:function(){el.prototype.dispose.call(this),fu.prototype.dispose.call(this)}});const cp=up;n.set("x_ite/Components/Shape/X3DShapeNode",cp);const lp=cp;function hp(t){lp.call(this,t),this.addType(c.Shape)}hp.prototype=Object.assign(Object.create(lp.prototype),{constructor:hp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"castShadow",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.inputOutput,"appearance",new ji.SFNode),new k(c.inputOutput,"geometry",new ji.SFNode)]),getTypeName:function(){return"Shape"},getComponentName:function(){return"Shape"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){lp.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this.set_transformSensors__()},getShapeKey:function(){return 0},getGeometryContext:lp.prototype.getGeometry,set_geometry__:function(){lp.prototype.set_geometry__.call(this),this.getGeometry()?delete this.traverse:this.traverse=Function.prototype},set_transformSensors__:function(){this.setPickableObject(this.getTransformSensors().size)},intersectsBox:function(t,e,n){return this.getGeometry().intersectsBox(t,e,n)},traverse:function(t,e){switch(t){case ja.POINTER:e.addPointingShape(this);break;case ja.PICKING:this.picking(e);break;case ja.COLLISION:e.addCollisionShape(this);break;case ja.SHADOW:this._castShadow.getValue()&&e.addShadowShape(this);break;case ja.DISPLAY:e.addDisplayShape(this)&&this.getAppearance().traverse(t,e)}this.getGeometry().traverse(t,e)},picking:function(t){const e=t.getModelViewMatrix().get();if(this.getTransformSensors().size)for(const t of this.getTransformSensors())t.collect(e);const n=this.getBrowser(),i=n.getPickSensors(),o=n.getPickingHierarchy();o.push(this);for(const t of i.at(-1))t.collect(this.getGeometry(),e,o);o.pop()},displaySimple:function(t,e,n){this.getGeometry().displaySimple(t,e,n)},display:function(t,e){this.getGeometry().display(t,e)}});const dp=hp;n.set("x_ite/Components/Shape/Shape",dp);const pp=dp;function fp(t){this.getExecutionContext()||Bu.call(this,t);const e=this.getBrowser().getContext();this.lineStipples=new Float32Array,this.lineStippleBuffer=e.createBuffer(),this.trianglesBuffer=e.createBuffer(),this.thickVertexArrayObject=new Vu(e),this.setGeometryType(1),this.setPrimitiveMode(e.LINES),this.setSolid(!1)}fp.prototype=Object.assign(Object.create(Bu.prototype),{constructor:fp,intersectsLine:function(){return!1},intersectsBox:function(){return!1},updateVertexArrays:function(){Bu.prototype.updateVertexArrays.call(this),this.thickVertexArrayObject.update()},buildTexCoords:function(){if(this.lineStipples.length/6==this.getVertices().length/8)return;const t=this.getBrowser().getContext(),e=this.getVertices().length/8;this.lineStipples=new Float32Array(6*e),t.bindBuffer(t.ARRAY_BUFFER,this.lineStippleBuffer),t.bufferData(t.ARRAY_BUFFER,this.lineStipples,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.trianglesBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(90*e),t.DYNAMIC_DRAW)},updateLengthSoFar:function(){const t=new dn,e=new ze(0,0,0,0),n=new ze(0,0,0,0),i=new ge(0,0),o=new ge(0,0);return function(r,s){const a=s.renderObject.getViewVolume().getViewport(),u=s.renderObject.getProjectionMatrix().get(),c=this.lineStipples,l=this.getVertices().getValue(),h=l.length;t.assign(s.modelViewMatrix).multRight(u);let d=0;for(let r=0,s=0;r<h;r+=8,s+=6)e.set(l[r],l[r+1],l[r+2],l[r+3]),n.set(l[r+4],l[r+5],l[r+6],l[r+7]),La.projectPointMatrix(e,t,a,i),La.projectPointMatrix(n,t,a,o),c[s]=o.x,c[s+1]=o.y,c[s+3]=i.x,c[s+4]=i.y,c[s+5]=d,d+=o.subtract(i).magnitude();r.bindBuffer(r.ARRAY_BUFFER,this.lineStippleBuffer),r.bufferData(r.ARRAY_BUFFER,c,r.DYNAMIC_DRAW)}}(),displaySimple:function(t,e,n){const i=e.shapeNode.getAppearance().getStyleProperties(1);if(i&&i.getTransformLines()){if(this.thickVertexArrayObject.enable(n)){const e=15*Float32Array.BYTES_PER_ELEMENT,i=0,o=8*Float32Array.BYTES_PER_ELEMENT,r=11*Float32Array.BYTES_PER_ELEMENT;n.enableLineStippleAttribute(t,this.trianglesBuffer,e,i),this.hasNormals&&n.enableNormalAttribute(t,this.trianglesBuffer,e,o),n.enableVertexAttribute(t,this.trianglesBuffer,e,r),t.bindBuffer(t.ARRAY_BUFFER,null)}return t.frontFace(t.CCW),t.enable(t.CULL_FACE),void t.drawArrays(t.TRIANGLES,0,3*this.vertexCount)}this.vertexArrayObject.enable(n)&&(n.enableLineStippleAttribute(t,this.lineStippleBuffer,0,0),this.hasNormals&&n.enableNormalAttribute(t,this.normalBuffer,0,0),n.enableVertexAttribute(t,this.vertexBuffer,0,0)),t.drawArrays(this.primitiveMode,0,this.vertexCount),t.lineWidth(1)},display:function(){const t=new dn,e=new Float32Array(16),n=new Float32Array(16);return function(i,o){const r=this.getBrowser(),s=o.appearanceNode,a=s.getLineProperties(),u=s.getShader(this,o),c=s.getBlendMode(),l=this.getAttrib(),h=this.getAttribBuffers();if(a&&(a.getApplied()&&1!==a.getLinetype()&&this.updateLengthSoFar(i,o),a.getTransformLines())){const s=o.renderObject,l=s.getViewVolume().getViewport(),h=s.getProjectionMatrix().get(),d=r.getWireframe()?i.TRIANGLES:r.getPrimitiveMode(i.TRIANGLES),p=r.getLineTransformShader();if(e.set(t.assign(o.modelViewMatrix).multRight(h)),n.set(t.inverse()),p.enable(i),i.uniform4f(p.viewport,l.x,l.y,l.z,l.w),i.uniformMatrix4fv(p.modelViewProjectionMatrix,!1,e),i.uniformMatrix4fv(p.invModelViewProjectionMatrix,!1,n),i.uniform1f(p.scale,a.getLinewidthScaleFactor()/2),this.thickVertexArrayObject.enable(p)){const t=6*Float32Array.BYTES_PER_ELEMENT,e=0,n=3*Float32Array.BYTES_PER_ELEMENT,o=2*Float32Array.BYTES_PER_ELEMENT,r=0,s=1*Float32Array.BYTES_PER_ELEMENT,a=8*Float32Array.BYTES_PER_ELEMENT,u=0,c=4*Float32Array.BYTES_PER_ELEMENT,l=6*Float32Array.BYTES_PER_ELEMENT,h=0,d=3*Float32Array.BYTES_PER_ELEMENT,f=8*Float32Array.BYTES_PER_ELEMENT,g=0,m=4*Float32Array.BYTES_PER_ELEMENT;p.enableFloatAttrib(i,"x3d_LineStipple0",this.lineStippleBuffer,3,t,e),p.enableFloatAttrib(i,"x3d_LineStipple1",this.lineStippleBuffer,3,t,n),this.hasFogCoords&&(p.enableFloatAttrib(i,"x3d_FogDepth0",this.fogDepthBuffer,1,o,r),p.enableFloatAttrib(i,"x3d_FogDepth1",this.fogDepthBuffer,1,o,s)),this.colorMaterial&&(p.enableFloatAttrib(i,"x3d_Color0",this.colorBuffer,4,a,u),p.enableFloatAttrib(i,"x3d_Color1",this.colorBuffer,4,a,c)),this.hasNormals&&(p.enableFloatAttrib(i,"x3d_Normal0",this.normalBuffer,3,l,h),p.enableFloatAttrib(i,"x3d_Normal1",this.normalBuffer,3,l,d)),p.enableFloatAttrib(i,"x3d_Vertex0",this.vertexBuffer,4,f,g),p.enableFloatAttrib(i,"x3d_Vertex1",this.vertexBuffer,4,f,m)}if(i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r.getLineTransformFeedback()),i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,0,this.trianglesBuffer),i.enable(i.RASTERIZER_DISCARD),i.beginTransformFeedback(i.POINTS),i.drawArraysInstanced(i.POINTS,0,this.vertexCount/2,2),i.endTransformFeedback(),i.disable(i.RASTERIZER_DISCARD),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),c?.enable(i),u.enable(i),u.setUniforms(i,this,o),this.thickVertexArrayObject.enable(u)){const t=15*Float32Array.BYTES_PER_ELEMENT,e=0,n=3*Float32Array.BYTES_PER_ELEMENT,o=4*Float32Array.BYTES_PER_ELEMENT,r=8*Float32Array.BYTES_PER_ELEMENT,s=11*Float32Array.BYTES_PER_ELEMENT;u.enableLineStippleAttribute(i,this.trianglesBuffer,t,e),this.hasFogCoords&&u.enableFogDepthAttribute(i,this.trianglesBuffer,t,n),this.colorMaterial&&u.enableColorAttribute(i,this.trianglesBuffer,t,o),this.hasNormals&&u.enableNormalAttribute(i,this.trianglesBuffer,t,r),u.enableVertexAttribute(i,this.trianglesBuffer,t,s),i.bindBuffer(i.ARRAY_BUFFER,null)}return i.frontFace(i.CCW),i.enable(i.CULL_FACE),i.drawArrays(d,0,3*this.vertexCount),void c?.disable(i)}const d=r.getPrimitiveMode(this.getPrimitiveMode());if(c?.enable(i),u.enable(i),u.setUniforms(i,this,o),this.vertexArrayObject.enable(u)){for(let t=0,e=l.length;t<e;++t)l[t].enable(i,u,h[t]);u.enableLineStippleAttribute(i,this.lineStippleBuffer,0,0),this.hasFogCoords&&u.enableFogDepthAttribute(i,this.fogDepthBuffer,0,0),this.colorMaterial&&u.enableColorAttribute(i,this.colorBuffer,0,0),this.hasNormals&&u.enableNormalAttribute(i,this.normalBuffer,0,0),u.enableVertexAttribute(i,this.vertexBuffer,0,0)}i.drawArrays(d,0,this.vertexCount),c?.disable(i),i.lineWidth(1)}}(),displayParticles:function(t,e,n){const i=this.getBrowser(),o=e.appearanceNode,r=o.getShader(this,e),s=o.getBlendMode(),a=this.getAttrib(),u=this.getAttribBuffers(),c=i.getPrimitiveMode(this.getPrimitiveMode());s?.enable(t),r.enable(t),r.setUniforms(t,this,e);const l=n.outputParticles;if(l.vertexArrayObject.update(this.updateParticles).enable(r)){const e=n.particleStride;r.enableParticleAttribute(t,l,e,n.particleOffset,1),r.enableParticleMatrixAttribute(t,l,e,n.matrixOffset,1);for(let e=0,n=a.length;e<n;++e)a[e].enable(t,r,u[e]);this.hasFogCoords&&r.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&r.enableColorAttribute(t,this.colorBuffer,0,0),this.hasNormals&&r.enableNormalAttribute(t,this.normalBuffer,0,0),r.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}t.drawArraysInstanced(c,0,this.vertexCount,n.numParticles),s?.disable(t),t.lineWidth(1)}});const gp=fp;n.set("x_ite/Components/Rendering/X3DLineGeometryNode",gp);const mp=gp;function _p(t){mp.call(this,t),this.addType(c.IndexedLineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}_p.prototype=Object.assign(Object.create(mp.prototype),{constructor:_p,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_colorIndex",new ji.MFInt32),new k(c.inputOnly,"set_coordIndex",new ji.MFInt32),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"colorIndex",new ji.MFInt32),new k(c.initializeOnly,"coordIndex",new ji.MFInt32),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"IndexedLineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){mp.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_coordIndex.addFieldInterest(this._coordIndex),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=rc(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=rc(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=rc(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_normal__:function(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=rc(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=rc(c.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},getColorPerVertexIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:this._coordIndex[t]},getColorIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:t},getPolylineIndices:function(){const t=this._coordIndex,e=[];let n=[];if(t.length){for(let i=0,o=t.length;i<o;++i){t[i]>=0?n.push(i):(e.push(n),n=[])}t[t.length-1]>=0&&e.push(n)}return e},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this._coordIndex,e=this.getPolylineIndices(),n=this._colorPerVertex.getValue(),i=this.getAttrib(),o=i.length,r=this.getAttribs(),s=this.fogCoordNode,a=this.colorNode,u=this.coordNode,c=this.normalNode,l=this.getFogDepths(),h=this.getColors(),d=this.getNormals(),p=this.getVertices();let f=0;for(const g of e){if(g.length>1)for(let e=0,m=g.length-1;e<m;++e)for(let m=e,_=e+2;m<_;++m){const e=g[m],_=t[e];for(let t=0;t<o;++t)i[t].addValue(_,r[t]);s?.addDepth(_,l),a&&(n?a.addColor(this.getColorPerVertexIndex(e),h):a.addColor(this.getColorIndex(f),h)),c?.addVector(_,d),u.addPoint(_,p)}++f}}});const xp=_p;n.set("x_ite/Components/Rendering/IndexedLineSet",xp);const yp=xp,wp=Symbol();function Sp(){}Sp.prototype={getBBoxNode:function(){const t=new pp(this.getPrivateScene()),e=new yp(this.getPrivateScene()),n=new Pd(this.getPrivateScene());return t._geometry=e,e._coordIndex=[0,1,2,3,0,-1,4,5,6,7,4,-1,0,4,-1,1,5,-1,2,6,-1,3,7,-1],e._coord=n,n._point=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5],n.setup(),e.setup(),t.setup(),this[wp]=t,this.getBBoxNode=function(){return this[wp]},Object.defineProperty(this,"getBBoxNode",{enumerable:!1}),t}};const Tp=Sp;n.set("x_ite/Browser/Grouping/X3DGroupingContext",Tp);const bp=Tp;function vp(t){rl.call(this,t),this.addType(c.X3DViewportNode)}vp.prototype=Object.assign(Object.create(rl.prototype),{constructor:vp});const Ep=vp;n.set("x_ite/Components/Layering/X3DViewportNode",Ep);const Cp=Ep,Op=bu(La);function Np(t){Cp.call(this,t),this.addType(c.Viewport),this.rectangle=new ze(0,0,0,0)}Np.prototype=Object.assign(Object.create(Cp.prototype),{constructor:Np,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"clipBoundary",new ji.MFFloat(0,1,0,1)),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Viewport"},getComponentName:function(){return"Layering"},getContainerField:function(){return"viewport"},getSpecificationRange:function(){return["3.2","Infinity"]},getRectangle:function(){const t=this.getBrowser().getViewport(),e=Math.floor(t[2]*this.getLeft()),n=Math.floor(t[2]*this.getRight()),i=Math.floor(t[3]*this.getBottom()),o=Math.floor(t[3]*this.getTop());return this.rectangle.set(e,i,Math.max(0,n-e),Math.max(0,o-i)),this.rectangle},getLeft:function(){return this._clipBoundary.length>0?this._clipBoundary[0]:0},getRight:function(){return this._clipBoundary.length>1?this._clipBoundary[1]:1},getBottom:function(){return this._clipBoundary.length>2?this._clipBoundary[2]:0},getTop:function(){return this._clipBoundary.length>3?this._clipBoundary[3]:1},traverse:function(t,e){if(this.push(e),t===ja.POINTER)this.getBrowser().isPointerInRectangle(this.rectangle)&&Cp.prototype.traverse.call(this,t,e);else Cp.prototype.traverse.call(this,t,e);this.pop(e)},push:function(t){const e=t.getViewVolumes(),n=this.getRectangle(),i=e.length?e.at(-1).getViewport():n,o=Op.pop();o.set(t.getProjectionMatrix().get(),i,n),e.push(o)},pop:function(t){Op.push(t.getViewVolumes().pop())}});const Fp=Np;n.set("x_ite/Components/Layering/Viewport",Fp);const Ip=Fp,Mp=Symbol();function Dp(){this[Mp]=new Ip(this.getPrivateScene())}Dp.prototype={initialize:function(){this[Mp].setPrivate(!0),this[Mp].setup()},getDefaultViewport:function(){return this[Mp]}};const Rp=Dp;n.set("x_ite/Browser/Layering/X3DLayeringContext",Rp);const Vp=Rp,Ap=Symbol(),Pp=Symbol();function Lp(){const t=this.getContext(),e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this[Ap]=e>8?8:2,this[Pp]=[]}Lp.prototype={getMaxLights:function(){return this[Ap]},popShadowBuffer:function(t){try{const e=this[Pp][t];if(e){if(e.length)return e.pop()}else this[Pp][t]=[];return new Ua(this,t,t,!0)}catch(t){return console.error(t),null}},pushShadowBuffer:function(t){t&&this[Pp][t.getWidth()].push(t)}};const Bp=Lp;n.set("x_ite/Browser/Lighting/X3DLightingContext",Bp);const Xp=Bp;function Up(t){Kc.call(this,t),this.addType(c.OrthoViewpoint),this.addChildObjects("fieldOfViewOffset",new ji.MFFloat(0,0,0,0)),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("length"),this.projectionMatrix=new dn,this.fieldOfViewOffsetInterpolator0=new qc(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator1=new qc(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator2=new qc(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator3=new qc(this.getBrowser().getPrivateScene())}Up.prototype=Object.assign(Object.create(Kc.prototype),{constructor:Up,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_bind",new ji.SFBool),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"position",new ji.SFVec3f(0,0,10)),new k(c.inputOutput,"orientation",new ji.SFRotation),new k(c.inputOutput,"centerOfRotation",new ji.SFVec3f),new k(c.inputOutput,"fieldOfView",new ji.MFFloat(-1,-1,1,1)),new k(c.inputOutput,"nearDistance",new ji.SFFloat(-1)),new k(c.inputOutput,"farDistance",new ji.SFFloat(-1)),new k(c.inputOutput,"viewAll",new ji.SFBool),new k(c.inputOutput,"jump",new ji.SFBool(!0)),new k(c.inputOutput,"retainUserOffsets",new ji.SFBool),new k(c.outputOnly,"isBound",new ji.SFBool),new k(c.outputOnly,"bindTime",new ji.SFTime),new k(c.inputOutput,"navigationInfo",new ji.SFNode)]),getTypeName:function(){return"OrthoViewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){Kc.prototype.initialize.call(this),this.fieldOfViewOffsetInterpolator0._key=new ji.MFFloat(0,1),this.fieldOfViewOffsetInterpolator1._key=new ji.MFFloat(0,1),this.fieldOfViewOffsetInterpolator2._key=new ji.MFFloat(0,1),this.fieldOfViewOffsetInterpolator3._key=new ji.MFFloat(0,1),this.fieldOfViewOffsetInterpolator0.setup(),this.fieldOfViewOffsetInterpolator1.setup(),this.fieldOfViewOffsetInterpolator2.setup(),this.fieldOfViewOffsetInterpolator3.setup(),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator0._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator1._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator2._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator3._set_fraction),this.fieldOfViewOffsetInterpolator0._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator1._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator2._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator3._value_changed.addInterest("set_fieldOfViewOffset__",this)},set_fieldOfViewOffset__:function(){this._fieldOfViewOffset[0]=this.fieldOfViewOffsetInterpolator0._value_changed.getValue(),this._fieldOfViewOffset[1]=this.fieldOfViewOffsetInterpolator1._value_changed.getValue(),this._fieldOfViewOffset[2]=this.fieldOfViewOffsetInterpolator2._value_changed.getValue(),this._fieldOfViewOffset[3]=this.fieldOfViewOffsetInterpolator3._value_changed.getValue()},resetUserOffsets:function(){Kc.prototype.resetUserOffsets.call(this),this._fieldOfViewOffset[0]=0,this._fieldOfViewOffset[1]=0,this._fieldOfViewOffset[2]=0,this._fieldOfViewOffset[3]=0},getRelativeTransformation:function(t){const e=Kc.prototype.getRelativeTransformation.call(this,t);return t.constructor===this.constructor&&(e.userMinimumX=t.getUserMinimumX(),e.userMinimumY=t.getUserMinimumY(),e.userMaximumX=t.getUserMaximumX(),e.userMaximumY=t.getUserMaximumY()),e},setInterpolators:function(t,e){if(t.constructor===this.constructor){const t=e.userMinimumX-this.getMinimumX(),n=e.userMinimumY-this.getMinimumY(),i=e.userMaximumX-this.getMaximumX(),o=e.userMaximumY-this.getMaximumY();this.fieldOfViewOffsetInterpolator0._keyValue=new ji.MFFloat(t,this._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new ji.MFFloat(n,this._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new ji.MFFloat(i,this._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new ji.MFFloat(o,this._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new ji.MFFloat(1,this._fieldOfViewScale.getValue()),this._fieldOfViewOffset[0]=e.offset0,this._fieldOfViewOffset[1]=e.offset1,this._fieldOfViewOffset[2]=e.offset2,this._fieldOfViewOffset[3]=e.offset3,this._fieldOfViewScale=1}else this.fieldOfViewOffsetInterpolator0._keyValue=new ji.MFFloat(this._fieldOfViewOffset[0],this._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new ji.MFFloat(this._fieldOfViewOffset[1],this._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new ji.MFFloat(this._fieldOfViewOffset[2],this._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new ji.MFFloat(this._fieldOfViewOffset[3],this._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new ji.MFFloat(1,this._fieldOfViewOffset.getValue()),this._fieldOfViewOffset=this._fieldOfViewOffset.getValue(),this._fieldOfViewScale=1},getLogarithmicDepthBuffer:function(){return!1},getMinimumX:function(){return this._fieldOfView.length>0?this._fieldOfView[0]:-1},getUserMinimumX:function(){return(this.getMinimumX()+this._fieldOfViewOffset[0])*this._fieldOfViewScale.getValue()},getMinimumY:function(){return this._fieldOfView.length>1?this._fieldOfView[1]:-1},getUserMinimumY:function(){return(this.getMinimumY()+this._fieldOfViewOffset[1])*this._fieldOfViewScale.getValue()},getMaximumX:function(){return this._fieldOfView.length>2?this._fieldOfView[2]:1},getUserMaximumX:function(){return(this.getMaximumX()+this._fieldOfViewOffset[2])*this._fieldOfViewScale.getValue()},getMaximumY:function(){return this._fieldOfView.length>3?this._fieldOfView[3]:1},getUserMaximumY:function(){return(this.getMaximumY()+this._fieldOfViewOffset[3])*this._fieldOfViewScale.getValue()},getSizeX:function(){return this.getMaximumX()-this.getMinimumX()},getUserSizeX:function(){return this.getUserMaximumX()-this.getUserMinimumX()},getSizeY:function(){return this.getMaximumY()-this.getMinimumY()},getUserSizeY:function(){return this.getUserMaximumY()-this.getUserMinimumY()},getMaxFarValue:function(){return 1e4},getScreenScale:function(t,e,n){const i=e[2],o=e[3],r=this.getUserSizeX(),s=this.getUserSizeY();if(i/o>r/s){const t=s/o;return n.set(t,t,t)}{const t=r/i;return n.set(t,t,t)}},getViewportSize:function(){const t=new ge(0,0);return function(e,n){const i=e[2],o=e[3],r=this.getUserSizeX(),s=this.getUserSizeY(),a=i/o;return a>r/s?t.set(s*a,s):t.set(r,r/a)}}(),getLookAtDistance:function(t){return t.size.magnitude()/2+10},getProjectionMatrixWithLimits:function(t,e,n){const i=n[2]/n[3],o=this.getUserSizeX(),r=this.getUserSizeY();if(i>o/r){const n=(this.getUserMinimumX()+this.getUserMaximumX())/2,o=r*i/2;return Ka.ortho(n-o,n+o,this.getUserMinimumY(),this.getUserMaximumY(),t,e,this.projectionMatrix)}{const n=(this.getUserMinimumY()+this.getUserMaximumY())/2,r=o/i/2;return Ka.ortho(this.getUserMinimumX(),this.getUserMaximumX(),n-r,n+r,t,e,this.projectionMatrix)}},viewAll:function(t){Kc.prototype.viewAll.call(this,t);const e=t.size,n=e.x/this.getSizeX(),i=e.y/this.getSizeY(),o=1.1*Math.max(n,i);this._fieldOfViewOffset[0]=this.getMinimumX()*o-this.getMinimumX(),this._fieldOfViewOffset[1]=this.getMinimumY()*o-this.getMinimumY(),this._fieldOfViewOffset[2]=this.getMaximumX()*o-this.getMaximumX(),this._fieldOfViewOffset[3]=this.getMaximumY()*o-this.getMaximumY()}});const kp=Up;n.set("x_ite/Components/Navigation/OrthoViewpoint",kp);const zp=kp;function jp(t,e){uo.call(this,t),this.navigationInfo=e}jp.prototype=Object.assign(Object.create(uo.prototype),{constructor:jp,getTypeName:function(){return"X3DViewer"},getActiveLayer:function(){return this.getBrowser().getActiveLayer()},getViewport:function(){return this.getBrowser().getActiveLayer().getViewport().getRectangle()},getNavigationInfo:function(){return this.navigationInfo},getActiveViewpoint:function(){return this.getBrowser().getActiveLayer().getViewpoint()},getStraightenHorizon:function(){return this.getBrowser().getBrowserOption("StraightenHorizon")},getButton:function(t){return 0===t&&this.getBrowser().getAltKey()?1:t},getPointer:function(t){const e=this.getBrowser(),n=e.getRenderingProperty("ContentScale"),i=e.getSurface().offset();return[(t.pageX-i.left)*n,e.getViewport()[3]-(t.pageY-i.top)*n]},isPointerInRectangle:function(){const t=new ge(0,0);return function(e,n){const i=this.getBrowser(),o=this.getViewport();return i.isPointerInRectangle(o,t.set(e,n))}}(),getPointOnCenterPlane:function(){const t=new Se(0,0,-1),e=new Se(0,0,0),n=new Se(0,0,0);return function(i,o,r){const s=this.getNavigationInfo(),a=this.getActiveViewpoint(),u=this.getViewport(),c=a.getProjectionMatrixWithLimits(s.getNearValue(),s.getFarValue(a),u);if(La.unProjectPoint(i,o,.9,dn.Identity,c,u,n),a instanceof zp)return r.set(n.x,n.y,-this.getDistanceToCenter(e).magnitude());const l=n.normalize();return r.assign(l).multiply(this.getDistanceToCenter(e).magnitude()/l.dot(t))}}(),getDistanceToCenter:function(t,e){const n=this.getActiveViewpoint();return t.assign(n.getPosition()).add(e||n._positionOffset.getValue()).subtract(n.getUserCenterOfRotation())},trackballProjectToSphere:function(t,e,n){const i=this.getViewport();return t=(t-i[0])/i[2]-.5,e=(e-i[1])/i[3]-.5,n.set(t,e,function(t,e,n){const i=Math.hypot(e,n);if(i<t*Math.sqrt(.5))return Math.sqrt(t*t-i*i);const o=t/Math.sqrt(2);return o*o/i}(.5,t,e))},lookAtPoint:function(t,e,n){if(!this.touch(t,e))return;const i=this.getActiveViewpoint(),o=this.getBrowser().getHit();i.lookAtPoint(this.getActiveLayer(),o.point,.381966,n)},lookAtBBox:function(t,e,n){if(!this.touch(t,e))return;const i=this.getActiveViewpoint(),o=this.getBrowser().getHit(),r=o.shapeNode.getBBox(new Qa).multRight(o.modelViewMatrix).multRight(i.getCameraSpaceMatrix());i.lookAtBBox(this.getActiveLayer(),r,.381966,n)},touch:function(t,e){return this.getBrowser().touch(t,e)}});const Gp=jp;n.set("x_ite/Browser/Navigation/X3DViewer",Gp);const Hp=Gp;function qp(t){fu.call(this,t),this.addType(c.X3DFollowerNode),this.buffer=[],this.a=this.getVector(),this.vector=this.getVector()}qp.prototype=Object.assign(Object.create(fu.prototype),{constructor:qp,initialize:function(){fu.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this)},getBuffer:function(){return this.buffer},getValue:function(){return this._set_value.getValue()},getDestination:function(){return this._set_destination.getValue()},getInitialValue:function(){return this._initialValue.getValue()},getInitialDestination:function(){return this._initialDestination.getValue()},setValue:function(t){this._value_changed=t},setDestination:function(t){this.destination.assign(t)},duplicate:function(t){return t.copy()},assign:function(t,e,n){t[e].assign(n)},equals:function(t,e,n){return this.a.assign(t).subtract(e).magnitude()<n},interpolate:function(t,e,n){return this.vector.assign(t).lerp(e,n)},set_live__:function(){(this.getLive().getValue()||this.isPrivate())&&this._isActive.getValue()?(this.getBrowser().prepareEvents().addInterest("prepareEvents",this),this.getBrowser().addBrowserEvent()):this.getBrowser().prepareEvents().removeInterest("prepareEvents",this)},set_active:function(t){t!==this._isActive.getValue()&&(this._isActive=t,this.set_live__())}});const Yp=qp;n.set("x_ite/Components/Followers/X3DFollowerNode",Yp);const Wp=Yp;function Kp(t){Wp.call(this,t),this.addType(c.X3DChaserNode),this.destination=null,this.previousValue=null,this.bufferEndTime=0,this.stepTime=0,this.deltaOut=this.getVector()}Kp.prototype=Object.assign(Object.create(Wp.prototype),{constructor:Kp,initialize:function(){Wp.prototype.initialize.call(this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this),this._duration.addInterest("set_duration__",this),this.set_duration__();var t=this.getBuffer(),e=this.getInitialValue(),n=this.getInitialDestination(),i=this.getNumBuffers();this.bufferEndTime=this.getBrowser().getCurrentTime(),this.previousValue=this.duplicate(e),t[0]=this.duplicate(n);for(var o=1;o<i;++o)t[o]=this.duplicate(e);this.destination=this.duplicate(n),this.equals(n,e,this.getTolerance())?this.setValue(n):this.set_active(!0)},getNumBuffers:function(){return 60},getTolerance:function(){return 1e-8},getArray:function(){return this.getVector()},setPreviousValue:function(t){this.previousValue.assign(t)},step:function(t,e,n){this.output.add(this.deltaOut.assign(t).subtract(e).multiply(n))},stepResponse:function(t){if(t<=0)return 0;var e=this._duration.getValue();return t>=e?1:.5-.5*Math.cos(t/e*Math.PI)},set_value__:function(){this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime());for(var t=this.getBuffer(),e=this.getValue(),n=0,i=t.length;n<i;++n)this.assign(t,n,e);this.setPreviousValue(e),this.setValue(e),this.set_active(!0)},set_destination__:function(){this.setDestination(this.getDestination()),this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime()),this.set_active(!0)},set_duration__:function(){this.stepTime=this._duration.getValue()/this.getNumBuffers()},prepareEvents:function(){var t=this.getBuffer(),e=t.length,n=this.updateBuffer();this.output=this.interpolate(this.previousValue,t[e-1],this.stepResponse((e-1+n)*this.stepTime));for(var i=e-2;i>=0;--i)this.step(t[i],t[i+1],this.stepResponse((i+n)*this.stepTime));this.setValue(this.output),this.equals(this.output,this.destination,this.getTolerance())&&this.set_active(!1)},updateBuffer:function(){var t=this.getBuffer(),e=t.length,n=(this.getBrowser().getCurrentTime()-this.bufferEndTime)/this.stepTime;if(n>=1){var i=Math.floor(n);if(n-=i,i<e){this.setPreviousValue(t[e-i]);for(var o=e-1;o>=i;--o)this.assign(t,o,t[o-i]);for(o=0;o<i;++o){var r=o/i;this.assign(t,o,this.interpolate(this.destination,t[i],r))}}else{this.setPreviousValue(i==e?t[0]:this.destination);for(o=0;o<e;++o)this.assign(t,o,this.destination)}this.bufferEndTime+=i*this.stepTime}return n}});const Jp=Kp;n.set("x_ite/Components/Followers/X3DChaserNode",Jp);const Zp=Jp;function Qp(t){Zp.call(this,t),this.addType(c.PositionChaser)}Qp.prototype=Object.assign(Object.create(Zp.prototype),{constructor:Qp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFVec3f),new k(c.inputOnly,"set_destination",new ji.SFVec3f),new k(c.initializeOnly,"initialValue",new ji.SFVec3f),new k(c.initializeOnly,"initialDestination",new ji.SFVec3f),new k(c.initializeOnly,"duration",new ji.SFTime(1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFVec3f)]),getTypeName:function(){return"PositionChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new Se(0,0,0)}});const $p=Qp;n.set("x_ite/Components/Followers/PositionChaser",$p);const tf=$p;var ef=new an,nf=new an;function of(t){Zp.call(this,t),this.addType(c.OrientationChaser),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}of.prototype=Object.assign(Object.create(Zp.prototype),{constructor:of,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFRotation),new k(c.inputOnly,"set_destination",new ji.SFRotation),new k(c.initializeOnly,"initialValue",new ji.SFRotation),new k(c.initializeOnly,"initialDestination",new ji.SFRotation),new k(c.initializeOnly,"duration",new ji.SFTime(1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFRotation)]),getTypeName:function(){return"OrientationChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new an},equals:function(t,e,n){return ef.assign(t).inverse().multRight(e),Math.abs(ef.angle)<n},interpolate:function(t,e,n){return nf.assign(t).slerp(e,n)},step:function(t,e,n){this.deltaOut.assign(e).inverse().multRight(t).multLeft(this.output),this.output.slerp(this.deltaOut,n)}});const rf=of;n.set("x_ite/Components/Followers/OrientationChaser",rf);const sf=rf;i(292);var af=i(532);const uf=/Mac OS X/i.test(navigator.userAgent),cf=uf?1/120:.05;function lf(t,e){Hp.call(this,t,e),this.button=-1,this.orientationOffset=new an,this.fromVector=new Se(0,0,0),this.toVector=new Se(0,0,0),this.fromPoint=new Se(0,0,0),this.toPoint=new Se(0,0,0),this.rotation=new an,this.direction=new Se(0,0,0),this.axis=new Se(0,0,0),this.pressTime=0,this.motionTime=0,this.touchMode=0,this.touch1=new ge(0,0),this.touch2=new ge(0,0),this.tapStart=0,this.dblTapInterval=.4,this.initialPositionOffset=new Se(0,0,0),this.initialOrientationOffset=new an,this.positionChaser=new tf(t),this.centerOfRotationChaser=new tf(t),this.rotationChaser=new sf(t),this.timeSensor=new Mc(t)}lf.prototype=Object.assign(Object.create(Hp.prototype),{constructor:lf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.outputOnly,"isActive",new ji.SFBool)]),initialize:function(){Hp.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getSurface();this.getNavigationInfo()._transitionStart.addInterest("disconnect",this),t.getBrowserOptions()._StraightenHorizon.addInterest("disconnect",this),t._activeViewpoint.addInterest("set_activeViewpoint__",this),e.on("mousedown.ExamineViewer",this.mousedown.bind(this)),e.on("mouseup.ExamineViewer",this.mouseup.bind(this)),e.on("dblclick.ExamineViewer",this.dblclick.bind(this)),e.on("mousewheel.ExamineViewer",this.mousewheel.bind(this)),e.on("touchstart.ExamineViewer",this.touchstart.bind(this)),e.on("touchend.ExamineViewer",this.touchend.bind(this)),this.positionChaser._duration=.2,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.2,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.rotationChaser._duration=.2,this.rotationChaser.setPrivate(!0),this.rotationChaser.setup(),this.timeSensor._loop=!0,this.timeSensor._stopTime=t.getCurrentTime(),this.timeSensor.setPrivate(!0),this.timeSensor.setup(),this.timeSensor._fraction_changed.addInterest("spin",this),this.set_activeViewpoint__()},set_activeViewpoint__:function(){if(this.getStraightenHorizon()){const t=this.getActiveViewpoint();t&&(t._orientationOffset=this.getOrientationOffset(an.Identity,t._orientationOffset.getValue(),!1))}this.disconnect()},mousedown:function(t){if(this.button>=0)return;this.pressTime=Date.now();const[e,n]=this.getPointer(t);if(this.isPointerInRectangle(e,n))switch(this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,af(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),af(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),af(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),af(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.trackballProjectToSphere(e,n,this.fromVector),this.rotation.assign(an.Identity),this.motionTime=0,this._isActive=!0;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,af(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),af(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),af(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),af(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(e,n,this.fromPoint),this._isActive=!0}},mouseup:function(t){if(t.button===this.button)switch(this.button=-1,af(document).off(".ExamineViewer"+this.getId()),this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),Math.abs(this.rotation.angle)>.003&&Date.now()-this.motionTime<40&&this.addSpinning(this.rotation),this._isActive=!1;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1}},dblclick:function(t){t.preventDefault(),t.stopImmediatePropagation();const[e,n]=this.getPointer(t);this.disconnect(),this.lookAtBBox(e,n,this.getStraightenHorizon())},mousemove:function(){const t=new Se(0,0,0);return function(e){const[n,i]=this.getPointer(e);switch(this.getButton(this.button)){case 0:{e.preventDefault(),e.stopImmediatePropagation();const t=this.trackballProjectToSphere(n,i,this.toVector);if(this.rotation.setFromToVec(t,this.fromVector),Math.abs(this.rotation.angle)<.003&&Date.now()-this.pressTime<50)return;this.addRotate(this.rotation),this.fromVector.assign(t),this.motionTime=Date.now();break}case 1:{e.preventDefault(),e.stopImmediatePropagation();const o=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(n,i,this.toPoint),s=o.getUserOrientation().multVecRot(t.assign(this.fromPoint).subtract(r));this.addMove(s,s),this.fromPoint.assign(r);break}}}}(),mousewheel:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n){const[i,o]=this.getPointer(n);if(!this.isPointerInRectangle(i,o))return;n.preventDefault(),n.stopImmediatePropagation();const r=this.getBrowser(),s=this.getActiveViewpoint();r.prepareEvents().removeInterest("spin",this),s.transitionStop(),this.getDistanceToCenter(t).multiply(n.zoomFactor||cf),s.getUserOrientation().multVecRot(e.set(0,0,t.magnitude())),n.deltaY>0?this.addMove(e.negate(),Se.Zero):n.deltaY<0&&this.addMove(e,Se.Zero)}}(),touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY);break;case 2:this.touchend(t),t.button=1,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY),this.touch2.set(e[1].pageX,e[1].pageY);break;case 3:this.touchend(t)}},touchend:function(t){switch(this.button){case 0:t.button=0,t.pageX=this.touch1.x,t.pageY=this.touch1.y,this.mouseup(t),this.tapedTwice?this.dblclick(t):(this.tapedTwice=!0,setTimeout((()=>this.tapedTwice=!1),300));break;case 1:this.touchMode=0,t.button=1,this.mouseup(t)}},touchmove:function(){const t=new ge(0,0),e=new ge(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:n.pageX=i[0].pageX,n.pageY=i[0].pageY,this.mousemove(n);break;case 2:{t.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),e.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const o=t.dot(e)>.7,r=t.dot(e)<-.7;switch(this.touchMode||(o?1:r?2:0)){case 1:this.touchMode=1,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);break;case 2:{this.touchMode=2;const t=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const e=this.touch1.distance(this.touch2)-t;n.deltaY=e,n.zoomFactor=Math.abs(e)/af(window).width(),n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousewheel(n);break}}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),set_positionOffset__:function(t){this.getActiveViewpoint()._positionOffset=t},set_centerOfRotationOffset__:function(t){this.getActiveViewpoint()._centerOfRotationOffset=t},set_rotation__:function(t){const e=this.getActiveViewpoint();e._orientationOffset=this.getOrientationOffset(t.getValue(),this.initialOrientationOffset,!1),e._positionOffset=this.getPositionOffset(this.initialPositionOffset,this.initialOrientationOffset,e._orientationOffset.getValue())},addRotate:function(){const t=new an;return function(e){const n=this.getActiveViewpoint();if(this.rotationChaser._isActive.getValue()&&this.rotationChaser._value_changed.hasInterest("set_rotation__",this))try{t.assign(this.rotationChaser._set_destination.getValue()).multLeft(e),this.getOrientationOffset(t,this.initialOrientationOffset,!0),this.rotationChaser._set_destination=t}catch(n){e=this.getHorizonRotation(e),t.assign(this.rotationChaser._set_destination.getValue()).multLeft(e),this.rotationChaser._set_destination=t}else try{this.initialOrientationOffset.assign(n._orientationOffset.getValue()),this.initialPositionOffset.assign(n._positionOffset.getValue()),this.getOrientationOffset(e,this.initialOrientationOffset,!0),this.rotationChaser._set_value=an.Identity,this.rotationChaser._set_destination=e}catch(t){this.rotationChaser._set_value=an.Identity,this.rotationChaser._set_destination=this.getHorizonRotation(e)}this.disconnect(),this.rotationChaser._value_changed.addInterest("set_rotation__",this)}}(),addSpinning:function(t){if(this.disconnect(),this.getStraightenHorizon()){const e=this.getActiveViewpoint(),n=e.getUserPosition(),i=e.getUserCenterOfRotation(),o=n.copy().subtract(i),r=this.getHorizonRotation(t),s=e.getUpVector(!0);this.axis.assign(s),r.getAxis(new Se(0,0,0)).dot(Se.yAxis)<0!=r.angle<0&&this.axis.negate(),this.timeSensor._cycleInterval=Math.PI/(.4*t.angle*30),this.timeSensor._startTime=this.getBrowser().getCurrentTime();const a=e.getLookAtRotation(n,i);this.direction.assign(o),this.orientationOffset.assign(e.getUserOrientation()).multRight(a.inverse())}else this.getBrowser().prepareEvents().addInterest("spin",this),this.rotation.assign(t)},spin:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new an,i=new an;return function(){const o=this.getActiveViewpoint();if(this.getStraightenHorizon()){const i=o.getUserCenterOfRotation(),r=this.timeSensor._fraction_changed.getValue(),s=new an(this.axis,2*Math.PI*r).multVecRot(t.assign(this.direction)).add(i),a=o.getLookAtRotation(s,o.getUserCenterOfRotation());e.assign(s).subtract(o.getPosition()),n.assign(o.getOrientation()).inverse().multRight(this.orientationOffset).multRight(a),o._positionOffset=e,o._orientationOffset=n}else i.assign(an.Identity).slerp(this.rotation,24/this.getBrowser().getCurrentFrameRate()),this.orientationOffset.assign(o._orientationOffset.getValue()),o._orientationOffset=this.getOrientationOffset(i,this.orientationOffset),o._positionOffset=this.getPositionOffset(o._positionOffset.getValue(),this.orientationOffset,o._orientationOffset.getValue())}}(),addMove:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i){const o=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(t.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=t):(t.assign(o._positionOffset.getValue()).add(n),this.positionChaser._set_value=o._positionOffset,this.positionChaser._set_destination=t),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(e.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=e):(e.assign(o._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=o._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=e),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),getPositionOffset:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new an;return function(i,o,r){return this.getDistanceToCenter(t,i),n.assign(o).inverse().multRight(r).multVecRot(e.assign(t)).subtract(t).add(i)}}(),getOrientationOffset:function(){const t=new an,e=new an,n=new Se(0,0,0);return function(i,o,r){const s=this.getActiveViewpoint(),a=this.getStraightenHorizon();t.assign(i).multRight(s.getOrientation()).multRight(o),a&&s.straightenHorizon(t);const u=e.assign(s.getOrientation()).inverse().multRight(t);if(a){if(!r)return u;const e=t.multVecRot(n.assign(Se.zAxis));if(Math.abs(s.getUpVector(!0).dot(e))<.97)return u;throw new Error("Critical angle")}return u}}(),getHorizonRotation:function(){const t=new Se(0,0,0);return function(e){const n=e.multVecRot(t.assign(Se.zAxis)),i=Se.yAxis.copy().cross(n).copy().cross(Se.yAxis);return new an(Se.zAxis,i)}}(),disconnect:function(){const t=this.getBrowser();this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this),this.rotationChaser._value_changed.removeInterest("set_rotation__",this),this.timeSensor._stopTime=t.getCurrentTime(),t.prepareEvents().removeInterest("spin",this)},dispose:function(){const t=this.getBrowser();this.disconnect(),this.getNavigationInfo()._transitionStart.removeInterest("disconnect",this),t.getBrowserOptions()._StraightenHorizon.removeInterest("disconnect",this),t._activeViewpoint.removeInterest("set_activeViewpoint__",this),t.getSurface().off(".ExamineViewer"),af(document).off(".ExamineViewer"+this.getId())}});const hf=lf;n.set("x_ite/Browser/Navigation/ExamineViewer",hf);const df=hf;i(292);var pf=i(532);const ff=/Mac OS X/i.test(navigator.userAgent),gf=.007,mf=ff?Math.PI/512:Math.PI/32;function _f(t,e){Hp.call(this,t,e);const n=this.getBrowser().getContext();this.button=-1,this.fromVector=new Se(0,0,0),this.toVector=new Se(0,0,0),this.direction=new Se(0,0,0),this.startTime=0,this.event=null,this.lookAround=!1,this.orientationChaser=new sf(t),this.lineCount=2,this.lineArray=new Float32Array(4*this.lineCount).fill(1),this.lineBuffer=n.createBuffer(),this.lineArrayObject=new Vu(n),this.geometryContext=new Gu({geometryType:1})}_f.prototype=Object.assign(Object.create(Hp.prototype),{constructor:_f,initialize:function(){Hp.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getSurface();e.on("mousedown.X3DFlyViewer",this.mousedown.bind(this)),e.on("mouseup.X3DFlyViewer",this.mouseup.bind(this)),e.on("mousewheel.X3DFlyViewer",this.mousewheel.bind(this)),e.on("touchstart.X3DFlyViewer",this.touchstart.bind(this)),e.on("touchend.X3DFlyViewer",this.touchend.bind(this)),t._controlKey.addInterest("set_controlKey__",this),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},addCollision:function(){},removeCollision:function(){},set_controlKey__:function(){this.event&&0===this.event.button&&(this.button=-1,this.mousedown(this.event))},mousedown:function(t){if(this.button>=0)return;this.event=t;const[e,n]=this.getPointer(t);if(this.isPointerInRectangle(e,n))switch(this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,pf(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),pf(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),pf(document).on("touchend.X3DFlyViewer"+this.getId(),this.touchend.bind(this)),pf(document).on("touchmove.X3DFlyViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.getBrowser().getControlKey()||this.lookAround?this.trackballProjectToSphere(e,n,this.fromVector):(this.fromVector.set(e,0,-n),this.toVector.assign(this.fromVector),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.addFly(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finishedEvents().addInterest("display",this,0)),this._isActive=!0;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,pf(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),pf(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.fromVector.set(e,n,0),this.toVector.assign(this.fromVector),this.direction.set(0,0,0),this.addPan(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finishedEvents().addInterest("display",this,1),this._isActive=!0}},mouseup:function(t){t.preventDefault(),t.button===this.button&&(this.event=null,this.button=-1,pf(document).off(".X3DFlyViewer"+this.getId()),this.disconnect(),this.getBrowser().setCursor("DEFAULT"),this.removeCollision(),this._isActive=!1)},mousemove:function(t){const e=this.getBrowser();e.addBrowserEvent(),this.event=t;const[n,i]=this.getPointer(t);switch(this.getButton(this.button)){case 0:if(e.getControlKey()||this.lookAround){t.preventDefault(),t.stopImmediatePropagation();const e=this.trackballProjectToSphere(n,i,this.toVector);this.addRotation(this.fromVector,e),this.fromVector.assign(e);break}this.toVector.set(n,0,-i),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.direction.divide(e.getRenderingProperty("ContentScale"));break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.toVector.set(n,i,0),this.direction.assign(this.toVector).subtract(this.fromVector),this.direction.divide(e.getRenderingProperty("ContentScale"))}},mousewheel:function(t){const[e,n]=this.getPointer(t);if(!this.isPointerInRectangle(e,n))return;t.preventDefault(),t.stopImmediatePropagation();this.getActiveViewpoint().transitionStop(),t.deltaY>0?this.addRoll(-mf):t.deltaY<0&&this.addRoll(mf)},touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t);break;case 2:this.touchend(t),this.lookAround=!0,t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t);break;case 3:this.touchend(t)}},touchend:function(t){if(0===this.button)this.lookAround=!1,t.button=0,this.mouseup(t)},touchmove:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousemove(t);break;case 2:t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousemove(t)}},fly:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new an,o=new an,r=new an;return function(){const s=this.getNavigationInfo(),a=this.getActiveViewpoint(),u=Date.now(),c=(u-this.startTime)/1e3;t.assign(a.getUpVector()),this.direction.z>0?r.setFromToVec(this.direction,n.set(0,0,1)):r.setFromToVec(n.set(0,0,-1),this.direction);const l=this.direction.magnitude();let h=1-r.angle/(Math.PI/2);h*=s._speed.getValue(),h*=a.getSpeedFactor(),h*=this.getBrowser().getShiftKey()?.028:gf,h*=c;const d=this.getTranslationOffset(e.assign(this.direction).multiply(h));this.getActiveLayer().constrainTranslation(d,!0),a._positionOffset=d.add(a._positionOffset.getValue());const p=1.4*c*Math.pow(l/(l+40),2);i.assign(an.Identity).slerp(r,p).multRight(a.getUserOrientation()),this.getStraightenHorizon()&&a.straightenHorizon(i),o.assign(a.getOrientation()).inverse().multRight(i),a._orientationOffset=o,this.startTime=u}}(),pan:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(){const n=this.getNavigationInfo(),i=this.getActiveViewpoint(),o=Date.now(),r=(o-this.startTime)/1e3,s=i.getUpVector();this.constrainPanDirection(t.assign(this.direction));let a=1;a*=n._speed.getValue(),a*=i.getSpeedFactor(),a*=this.getBrowser().getShiftKey()?.0098:.007,a*=r;const u=i.getUserOrientation().multRight(new an(i.getUserOrientation().multVecRot(e.assign(Se.yAxis)),s)).multVecRot(t.multiply(a));this.getActiveLayer().constrainTranslation(u,!0),i._positionOffset=u.add(i._positionOffset.getValue()),this.startTime=o}}(),set_orientationOffset__:function(t){this.getActiveViewpoint()._orientationOffset=t},addFly:function(){this.startTime||(this.getBrowser().prepareEvents().addInterest("fly",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addPan:function(){this.startTime||(this.disconnect(),this.getBrowser().prepareEvents().addInterest("pan",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addRoll:function(){const t=new an,e=new an;return function(n){const i=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.assign(i.getOrientation()).inverse().multRight(e.set(1,0,0,n)).multRight(i.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.orientationChaser._set_destination=t):(t.assign(i.getOrientation()).inverse().multRight(e.set(1,0,0,n)).multRight(i.getUserOrientation()),this.orientationChaser._set_value=i._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),addRotation:function(){const t=new an,e=new an;return function(n,i){const o=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.setFromToVec(i,n).multRight(o.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.getStraightenHorizon()&&o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_destination=e):(t.setFromToVec(i,n).multRight(o.getUserOrientation()),this.getStraightenHorizon()&&o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_value=o._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),display:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new dn,i=new Float32Array(dn.Identity),o=new Float32Array(dn.Identity),r=[];return function(s){const a=this.getBrowser(),u=a.getContext(),c=a.getViewport(),l=c[2],h=c[3];switch(i.set(Ka.ortho(0,l,0,h,-1,1,n)),s){case 0:t.set(this.fromVector.x,-this.fromVector.z,0),e.set(this.toVector.x,-this.toVector.z,0);break;case 1:t.set(this.fromVector.x,this.fromVector.y,0),e.set(this.toVector.x,this.toVector.y,0)}this.lineArray.set(t,0),this.lineArray.set(e,4),u.bindBuffer(u.ARRAY_BUFFER,this.lineBuffer),u.bufferData(u.ARRAY_BUFFER,this.lineArray,u.DYNAMIC_DRAW);const d=a.getDefaultMaterial().getShader(this.geometryContext);d.enable(u),d.setClipPlanes(u,r),u.uniformMatrix4fv(d.x3d_ProjectionMatrix,!1,i),u.uniformMatrix4fv(d.x3d_ModelViewMatrix,!1,o),this.lineArrayObject.enable(d)&&d.enableVertexAttribute(u,this.lineBuffer,0,0),u.disable(u.DEPTH_TEST),u.uniform3f(d.x3d_EmissiveColor,0,0,0),u.uniform1f(d.x3d_Transparency,0),u.drawArrays(u.LINES,0,this.lineCount),u.uniform3f(d.x3d_EmissiveColor,1,1,1),u.drawArrays(u.LINES,0,this.lineCount)}}(),disconnect:function(){const t=this.getBrowser();t.addBrowserEvent(),t.prepareEvents().removeInterest("fly",this),t.prepareEvents().removeInterest("pan",this),t.finishedEvents().removeInterest("display",this),this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.startTime=0},dispose:function(){const t=this.getBrowser().getContext();t.deleteBuffer(this.lineBuffer),this.lineArrayObject.delete(t),this.disconnect(),this.getBrowser()._controlKey.removeInterest("set_controlKey__",this),this.getBrowser().getSurface().off(".X3DFlyViewer"),pf(document).off(".X3DFlyViewer"+this.getId())}});const xf=_f;n.set("x_ite/Browser/Navigation/X3DFlyViewer",xf);const yf=xf;function wf(t,e){yf.call(this,t,e)}wf.prototype=Object.assign(Object.create(yf.prototype),{constructor:wf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.outputOnly,"isActive",new ji.SFBool)]),initialize:function(){yf.prototype.initialize.call(this),this.getBrowser().addCollision(this)},getStraightenHorizon:function(){return!0},getFlyDirection:function(t,e,n){return n.assign(e).subtract(t)},getTranslationOffset:function(){const t=new Se(0,0,0),e=new an,n=new an;return function(i){const o=this.getActiveViewpoint(),r=o.getUpVector();e.assign(o.getUserOrientation()),e.multVecRot(t.assign(Se.yAxis)),n.setFromToVec(t,r);return e.multRight(n).multVecRot(i)}}(),constrainPanDirection:function(t){return t.y<0&&(t.y=0),t},dispose:function(){this.getBrowser().removeCollision(this),yf.prototype.dispose.call(this)}});const Sf=wf;n.set("x_ite/Browser/Navigation/WalkViewer",Sf);const Tf=Sf;function bf(t,e){yf.call(this,t,e)}bf.prototype=Object.assign(Object.create(yf.prototype),{constructor:bf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.outputOnly,"isActive",new ji.SFBool)]),addCollision:function(){this.getBrowser().addCollision(this)},removeCollision:function(){this.getBrowser().removeCollision(this)},getFlyDirection:function(t,e,n){return n.assign(e).subtract(t)},getTranslationOffset:function(t){return this.getActiveViewpoint().getUserOrientation().multVecRot(t)},constrainPanDirection:function(t){return t}});const vf=bf;n.set("x_ite/Browser/Navigation/FlyViewer",vf);const Ef=vf;i(292);var Cf=i(532);const Of=/Mac OS X/i.test(navigator.userAgent)?1/160:.05,Nf=new Se(0,0,0),Ff=new Se(0,0,0),If=new Se(0,0,0);function Mf(t,e){Hp.call(this,t,e),this.button=-1,this.fromPoint=new Se(0,0,0),this.toPoint=new Se(0,0,0)}Mf.prototype=Object.assign(Object.create(Hp.prototype),{constructor:Mf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.outputOnly,"isActive",new ji.SFBool)]),initialize:function(){Hp.prototype.initialize.call(this);const t=this.getBrowser().getSurface();t.on("mousedown.PlaneViewer",this.mousedown.bind(this)),t.on("mouseup.PlaneViewer",this.mouseup.bind(this)),t.on("mousemove.PlaneViewer",this.mousemove.bind(this)),t.on("mousewheel.PlaneViewer",this.mousewheel.bind(this))},mousedown:function(t){if(this.button>=0)return;const[e,n]=this.getPointer(t);if(this.isPointerInRectangle(e,n)&&1===this.getButton(t.button))t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,this.getBrowser().getSurface().off("mousemove.PlaneViewer"),Cf(document).on("mouseup.PlaneViewer"+this.getId(),this.mouseup.bind(this)),Cf(document).on("mousemove.PlaneViewer"+this.getId(),this.mousemove.bind(this)),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(e,n,this.fromPoint),this._isActive=!0},mouseup:function(t){t.preventDefault(),t.stopImmediatePropagation(),t.button===this.button&&(this.button=-1,Cf(document).off(".PlaneViewer"+this.getId()),this.getBrowser().getSurface().on("mousemove.PlaneViewer",this.mousemove.bind(this)),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1)},mousemove:function(t){const[e,n]=this.getPointer(t);switch(this.getButton(this.button)){case 1:{t.preventDefault(),t.stopImmediatePropagation();const i=this.getActiveViewpoint(),o=this.getPointOnCenterPlane(e,n,this.toPoint),r=i.getUserOrientation().multVecRot(this.fromPoint.subtract(o));i._positionOffset=Ff.assign(i._positionOffset.getValue()).add(r),i._centerOfRotationOffset=If.assign(i._centerOfRotationOffset.getValue()).add(r),this.fromPoint.assign(o);break}}},mousewheel:function(t){const[e,n]=this.getPointer(t);if(!this.isPointerInRectangle(e,n))return;t.preventDefault(),t.stopImmediatePropagation();const i=this.getActiveViewpoint(),o=this.getPointOnCenterPlane(e,n,this.fromPoint);i.transitionStop(),t.deltaY>0?i._fieldOfViewScale=Math.max(1e-5,i._fieldOfViewScale.getValue()*(1-Of)):t.deltaY<0&&(i._fieldOfViewScale=i._fieldOfViewScale.getValue()*(1+Of),this.constrainFieldOfViewScale());const r=this.getPointOnCenterPlane(e,n,this.toPoint),s=i.getUserOrientation().multVecRot(Nf.assign(o).subtract(r));i._positionOffset=Ff.assign(i._positionOffset.getValue()).add(s),i._centerOfRotationOffset=If.assign(i._centerOfRotationOffset.getValue()).add(s)},constrainFieldOfViewScale:function(){const t=this.getActiveViewpoint();t.getTypeName().match(/^(?:Viewpoint|GeoViewpoint)$/)&&t._fieldOfView.getValue()*t._fieldOfViewScale.getValue()>=Math.PI&&(t._fieldOfViewScale=(Math.PI-.001)/t._fieldOfView.getValue())},dispose:function(){this.getBrowser().getSurface().off(".PlaneViewer"),Cf(document).off(".PlaneViewer"+this.getId())}});const Df=Mf;n.set("x_ite/Browser/Navigation/PlaneViewer",Df);const Rf=Df;function Vf(t,e){Hp.call(this,t,e)}Vf.prototype=Object.assign(Object.create(Hp.prototype),{constructor:Vf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.outputOnly,"isActive",new ji.SFBool)])});const Af=Vf;n.set("x_ite/Browser/Navigation/NoneViewer",Af);const Pf=Af;i(292);var Lf=i(532);const Bf=/Mac OS X/i.test(navigator.userAgent)?1/120:.05;function Xf(t,e){Hp.call(this,t,e),this.button=-1,this.fromVector=new Se(0,0,0),this.toVector=new Se(0,0,0),this.touch1=new ge(0,0),this.touch2=new ge(0,0),this.tapStart=0,this.dblTapInterval=.4,this.positionChaser=new tf(t),this.centerOfRotationChaser=new tf(t),this.orientationChaser=new sf(t)}Xf.prototype=Object.assign(Object.create(Hp.prototype),{constructor:Xf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.outputOnly,"isActive",new ji.SFBool)]),initialize:function(){Hp.prototype.initialize.call(this);const t=this.getBrowser().getSurface();t.on("mousedown.LookAtViewer",this.mousedown.bind(this)),t.on("mouseup.LookAtViewer",this.mouseup.bind(this)),t.on("dblclick.LookAtViewer",this.dblclick.bind(this)),t.on("mousewheel.LookAtViewer",this.mousewheel.bind(this)),t.on("touchstart.LookAtViewer",this.touchstart.bind(this)),t.on("touchend.LookAtViewer",this.touchend.bind(this)),this.positionChaser._duration=.3,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.3,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},mousedown:function(t){if(this.button>=0)return;const[e,n]=this.getPointer(t);if(this.isPointerInRectangle(e,n)&&0===t.button)t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,Lf(document).on("mouseup.LookAtViewer"+this.getId(),this.mouseup.bind(this)),Lf(document).on("mousemove.LookAtViewer"+this.getId(),this.mousemove.bind(this)),Lf(document).on("touchend.LookAtViewer"+this.getId(),this.mouseup.bind(this)),Lf(document).on("touchmove.LookAtViewer"+this.getId(),this.touchmove.bind(this)),this.getActiveViewpoint().transitionStop(),this.trackballProjectToSphere(e,n,this.fromVector),this._isActive=!0},mouseup:function(t){if(t.button===this.button&&(this.button=-1,Lf(document).off(".LookAtViewer"+this.getId()),0===t.button))t.preventDefault(),t.stopImmediatePropagation(),this._isActive=!1},dblclick:function(t){t.preventDefault(),t.stopImmediatePropagation();const[e,n]=this.getPointer(t);this.disconnect(),this.lookAtPoint(e,n,this.getStraightenHorizon())},mousemove:function(t){this.getBrowser().addBrowserEvent(),this.event=t;const[e,n]=this.getPointer(t);switch(this.button){case 0:{t.preventDefault(),t.stopImmediatePropagation();const i=this.trackballProjectToSphere(e,n,this.toVector);this.addRotation(this.fromVector,i),this.fromVector.assign(i);break}}},mousewheel:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n){const[i,o]=this.getPointer(n);if(!this.isPointerInRectangle(i,o))return;n.preventDefault(),n.stopImmediatePropagation();const r=this.getActiveViewpoint();r.transitionStop(),this.getDistanceToCenter(t).multiply(n.zoomFactor||Bf),r.getUserOrientation().multVecRot(e.set(0,0,t.magnitude())),n.deltaY>0?this.addMove(e.negate(),Se.Zero):n.deltaY<0&&this.addMove(e,Se.Zero)}}(),touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:this.touch1.set(e[0].pageX,e[0].pageY);break;case 2:this.touchend(t),t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY),this.touch2.set(e[1].pageX,e[1].pageY);break;case 3:this.touchend(t)}},touchend:function(t){if(0===this.button)this.mouseup(t);this.getBrowser().getCurrentTime()-this.tapStart<this.dblTapInterval&&(t.button=1,t.pageX=this.touch1.x,t.pageY=this.touch1.y,this.dblclick(t)),this.tapStart=this.getBrowser().getCurrentTime()},touchmove:function(){const t=new ge(0,0),e=new ge(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:break;case 2:{t.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),e.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const o=t.dot(e)>.7,r=t.dot(e)<-.7;if(o)n.button=0,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);else if(r){const t=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const e=this.touch1.distance(this.touch2)-t;n.deltaY=e,n.zoomFactor=Math.abs(e)/Lf(window).width(),n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousewheel(n)}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),set_positionOffset__:function(t){this.getActiveViewpoint()._positionOffset=t},set_centerOfRotationOffset__:function(t){this.getActiveViewpoint()._centerOfRotationOffset=t},set_orientationOffset__:function(t){this.getActiveViewpoint()._orientationOffset=t},addMove:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i){const o=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(t.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=t):(t.assign(o._positionOffset.getValue()).add(n),this.positionChaser._set_value=o._positionOffset,this.positionChaser._set_destination=t),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(e.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=e):(e.assign(o._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=o._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=e),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),addRotation:function(){const t=new an,e=new an;return function(n,i){const o=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.setFromToVec(i,n).multRight(o.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_destination=e):(t.setFromToVec(i,n).multRight(o.getUserOrientation()),o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_value=o._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),disconnect:function(){this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this)},dispose:function(){this.getBrowser().getSurface().off(".LookAtViewer"),Lf(document).off(".LookAtViewer"+this.getId())}});const Uf=Xf;n.set("x_ite/Browser/Navigation/LookAtViewer",Uf);const kf=Uf;function zf(t){fu.call(this,t),this.addType(c.X3DLightNode)}zf.prototype=Object.assign(Object.create(fu.prototype),{constructor:zf,initialize:function(){fu.prototype.initialize.call(this),this._on.addInterest("set_on__",this),this._intensity.addInterest("set_on__",this),this.set_on__()},set_on__:function(){this._on.getValue()&&this.getIntensity()>0?(delete this.push,delete this.pop):(this.push=Function.prototype,this.pop=Function.prototype)},getGlobal:function(){return this._global.getValue()},getColor:function(){return this._color.getValue()},getIntensity:function(){return Math.max(this._intensity.getValue(),0)},getAmbientIntensity:function(){return d.clamp(this._ambientIntensity.getValue(),0,1)},getDirection:function(){return this._direction.getValue()},getShadows:function(){return this._shadows.getValue()},getShadowColor:function(){return this._shadowColor.getValue()},getShadowIntensity:function(){return this.getShadows()?d.clamp(this._shadowIntensity.getValue(),0,1):0},getShadowBias:function(){return d.clamp(this._shadowBias.getValue(),0,1)},getShadowMapSize:function(){return Math.min(this._shadowMapSize.getValue(),this.getBrowser().getMaxTextureSize())},getBiasMatrix:function(){const t=new dn(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return t}}(),push:function(t,e){if(t.isIndependent()){const n=this.getLights().pop();this._global.getValue()?(n.set(this,t.getLayer().getGroup(),t.getModelViewMatrix().get()),t.getGlobalObjects().push(n),t.getLights().push(n),t.pushGlobalShadows(!!this.getShadowIntensity())):(n.set(this,e,t.getModelViewMatrix().get()),t.getLocalObjects().push(n),t.getLights().push(n),t.pushLocalShadows(!!this.getShadowIntensity()),++t.getLocalObjectsCount()[1])}else{const e=t.getLightContainer();e.modelViewMatrix.pushMatrix(t.getModelViewMatrix().get()),this._global.getValue()?(t.getGlobalObjects().push(e),t.getLights().push(e),t.pushGlobalShadows(!!this.getShadowIntensity())):(t.getLocalObjects().push(e),t.getLights().push(e),t.pushLocalShadows(!!this.getShadowIntensity()),++t.getLocalObjectsCount()[1])}},pop:function(t){if(this._global.getValue())return;const e=t.getLocalObjects().pop();t.isIndependent()&&this.getBrowser().getLocalObjects().push(e),t.popLocalShadows(),--t.getLocalObjectsCount()[1]}});const jf=zf;n.set("x_ite/Components/Lighting/X3DLightNode",jf);const Gf=jf,Hf=bu(qf);function qf(){this.direction=new Se(0,0,0),this.shadowBuffer=null,this.bbox=new Qa,this.viewVolume=new La,this.viewport=new ze(0,0,0,0),this.projectionMatrix=new dn,this.modelViewMatrix=new oa(dn),this.modelMatrix=new dn,this.invLightSpaceMatrix=new dn,this.invLightSpaceProjectionMatrix=new dn,this.shadowMatrix=new dn,this.shadowMatrixArray=new Float32Array(16),this.rotation=new an,this.textureUnit=void 0}function Yf(t){Gf.call(this,t),this.addType(c.DirectionalLight),"2.0"===t.getSpecificationVersion()&&(this._global=!0)}qf.prototype={constructor:qf,set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.global=t.getGlobal(),this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(this.global?i:dn.Identity);o.rotate(this.rotation.setFromToVec(Se.zAxis,this.direction.assign(e.getDirection()).negate())),o.inverse();const r=this.groupNode.getSubBBox(this.bbox,!0).multRight(o),s=e.getShadowMapSize(),a=this.viewport.set(0,0,s,s),u=Ka.orthoBox(r,this.projectionMatrix);this.shadowBuffer.bind(),t.getViewVolumes().push(this.viewVolume.set(u,a,a)),t.getProjectionMatrix().pushMatrix(u),t.getModelViewMatrix().pushMatrix(o),t.render(ja.SHADOW,rl.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop(),this.shadowBuffer.unbind(),this.global||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o).multRight(u).multRight(e.getBiasMatrix())},setGlobalVariables:function(t){this.modelViewMatrix.get().multDirMatrix(this.direction.assign(this.lightNode.getDirection())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.global?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=this.direction;if(t.uniform1i(e.x3d_LightType[n],1),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightDirection[n],r.x,r.y,r.z),this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}else t.uniform1f(e.x3d_ShadowIntensity[n],0)},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Hf.push(this)}},Yf.prototype=Object.assign(Object.create(Gf.prototype),{constructor:Yf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"global",new ji.SFBool),new k(c.inputOutput,"on",new ji.SFBool(!0)),new k(c.inputOutput,"color",new ji.SFColor(1,1,1)),new k(c.inputOutput,"intensity",new ji.SFFloat(1)),new k(c.inputOutput,"ambientIntensity",new ji.SFFloat),new k(c.inputOutput,"direction",new ji.SFVec3f(0,0,-1)),new k(c.inputOutput,"shadows",new ji.SFBool),new k(c.inputOutput,"shadowColor",new ji.SFColor),new k(c.inputOutput,"shadowIntensity",new ji.SFFloat(1)),new k(c.inputOutput,"shadowBias",new ji.SFFloat(.005)),new k(c.initializeOnly,"shadowMapSize",new ji.SFInt32(1024))]),getTypeName:function(){return"DirectionalLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},getLights:function(){return Hf}});const Wf=Yf;n.set("x_ite/Components/Lighting/DirectionalLight",Wf);const Kf=Wf,Jf=Symbol(),Zf=Symbol(),Qf=Symbol();function $f(){this.addChildObjects("activeLayer",new ji.SFNode,"activeNavigationInfo",new ji.SFNode,"activeViewpoint",new ji.SFNode,"availableViewers",new ji.MFString,"viewer",new ji.SFString("EXAMINE")),this[Jf]=new Set,this[Zf]=new Pf(this.getPrivateScene())}$f.prototype={initialize:function(){this._viewer.addInterest("set_viewer__",this),this.initialized().addInterest("set_world__",this),this.shutdown().addInterest("remove_world__",this),this[Qf]=function(t){const e=new Kf(t.getPrivateScene());e.setup();const n=e.getLights().pop();return n.set(e,null,dn.Identity),n.dispose=Function.prototype,n}(this),this[Zf].setup()},getHeadlight:function(){return this[Qf]},getActiveLayer:function(){return this._activeLayer.getValue()},getActiveNavigationInfo:function(){return this._activeNavigationInfo.getValue()},getActiveViewpoint:function(){return this._activeViewpoint.getValue()},getCurrentViewer:function(){return this._viewer.getValue()},getViewer:function(){return this[Zf]},addCollision:function(t){this[Jf].add(t)},removeCollision:function(t){this[Jf].delete(t)},getCollisionCount:function(){return this[Jf].size},remove_world__:function(){this.getWorld()._activeLayer.removeInterest("set_activeLayer__",this)},set_world__:function(){this.getWorld()._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__()},set_activeLayer__:function(){this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().removeInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().removeInterest("set_activeViewpoint__",this)),this._activeLayer=this.getWorld().getActiveLayer(),this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().addInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().addInterest("set_activeViewpoint__",this)),this.set_activeNavigationInfo__(),this.set_activeViewpoint__()},set_activeNavigationInfo__:function(){this._activeNavigationInfo.getValue()?._viewer.removeFieldInterest(this._viewer),this._activeLayer.getValue()?(this._activeNavigationInfo=this._activeLayer.getValue().getNavigationInfo(),this._activeNavigationInfo.getValue()._viewer.addFieldInterest(this._viewer),this._viewer=this._activeNavigationInfo.getValue()._viewer):(this._activeNavigationInfo=null,this._viewer="NONE")},set_activeViewpoint__:function(){this._activeLayer.getValue()?this._activeViewpoint=this._activeLayer.getValue().getViewpoint():this._activeViewpoint=null},set_viewer__:function(t){const e=this._activeNavigationInfo.getValue();switch(e?this._availableViewers=e._availableViewers:this._availableViewers.length=0,this[Zf]?.dispose(),t.getValue()){case"EXAMINE":default:this[Zf]=new df(this.getPrivateScene(),e);break;case"WALK":this[Zf]=new Tf(this.getPrivateScene(),e);break;case"FLY":this[Zf]=new Ef(this.getPrivateScene(),e);break;case"PLANE":case"PLANE_create3000.github.io":case"PLANE_create3000.de":this[Zf]=new Rf(this.getPrivateScene(),e);break;case"NONE":this[Zf]=new Pf(this.getPrivateScene(),e);break;case"LOOKAT":this[Zf]=new kf(this.getPrivateScene(),e)}this[Zf].setup()},dispose:function(){this[Zf]?.dispose()}};const tg=$f;n.set("x_ite/Browser/Navigation/X3DNavigationContext",tg);const eg=tg,ng=Symbol(),ig=Symbol(),og=Symbol(),rg=Symbol(),sg=Symbol(),ag=Symbol(),ug=Symbol();function cg(t){let e=t.prop("baseURI");return e.startsWith("about:")&&(e=document.baseURI),e}function lg(){this.addChildObjects("loadCount",new ji.SFInt32),this[ng]=0,this[ig]=0,this[og]=new Set,this[rg]=!1,this[sg]=cg(this.getElement())}lg.prototype={initialize:function(){this._loadCount.addInterest(ug,this)},getProviderUrl:function(){return cr.getProviderUrl()},getBaseURL:function(){return this[sg]},setBaseURL:function(t){const e=cg(this.getElement()),n=new URL(t,e);this[sg]="data:"===n.protocol?e:n.href},getDefaultScene:function(){return this[ag]=this.createScene(),this[ag].setPrivate(!0),this[ag].setLive(!0),this.getDefaultScene=function(){return this[ag]},Object.defineProperty(this,"getDefaultScene",{enumerable:!1}),this[ag]},getBrowserLoading:function(){return this[rg]},setBrowserLoading:function(t){this[rg]=t,t?(this[og].has(this)||this.resetLoadCount(),this.getShadow().find(".x_ite-private-world-info").remove(),this.getBrowserOption("SplashScreen")&&(this.getContextMenu().hide(),this.getCanvas().hide(),this.getSplashScreen().stop(!0,!0).show())):this.getBrowserOption("SplashScreen")&&(this.getCanvas().show(),this.getSplashScreen().stop(!0,!0).show().fadeOut(2e3))},getLoadingObjects:function(){return this[og]},addLoadingObject:function(t){this[og].has(t)||(++this[ig],this[og].add(t),this.setLoadCount(this[og].size),this.setCursor("DEFAULT"))},removeLoadingObject:function(t){this[og].has(t)&&(this[og].delete(t),this.setLoadCount(this[og].size),this.setCursor(this.getCursor()))},getDisplayLoadCount:function(){return[...this[og]].reduce(((t,e)=>t+!(e.isPrivate?.()??1)),0)},setLoadCount:function(t){this._loadCount=t},resetLoadCount:function(){this._loadCount=0,this[ng]=0,this[ig]=0,this[og].clear();for(const t of this.getPrivateScene().getLoadingObjects())this.addLoadingObject(t)},[ug]:function(){const t=this.getDisplayLoadCount();if(this._loadCount.getValue()||this[rg])var e=Co(1===(t||1)?"Loading %1 file":"Loading %1 files").replace("%1",t||1);else{e=Co("Loading done");this.setCursor("DEFAULT")}this[rg]?(this.getSplashScreen().find(".x_ite-private-spinner-text").text(e),this.getSplashScreen().find(".x_ite-private-progressbar div").css("width",100-100*this._loadCount.getValue()/this[ig]+"%")):t!==this[ng]&&(this.getNotification()._string=e),this[ng]=t}};const hg=lg;n.set("x_ite/Browser/Networking/X3DNetworkingContext",hg);const dg=hg,pg=Symbol(),fg=Symbol(),gg=Symbol(),mg=Symbol(),_g=Symbol();function xg(){this[pg]=new Set,this[fg]=[new Set],this[gg]=[],this[mg]=[!1],this[_g]=new xo}xg.prototype={addTransformSensor:function(t){this[pg].add(t),this.enablePicking()},removeTransformSensor:function(t){this[pg].delete(t),this.enablePicking()},addPickSensor:function(t){this[fg][0].add(t),this.enablePicking()},removePickSensor:function(t){this[fg][0].delete(t),this.enablePicking()},getPickSensors:function(){return this[fg]},getPickingHierarchy:function(){return this[gg]},getPickable:function(){return this[mg]},enablePicking:function(){this[pg].size||this[fg][0].size?this._sensorEvents.addInterest("picking",this):this._sensorEvents.removeInterest("picking",this)},picking:function(){this[_g].start(),this.getWorld().traverse(ja.PICKING);for(const t of this[pg])t.process();for(const t of this[fg][0])t.process();this[_g].stop()},getPickingTime:function(){return this[_g]}};const yg=xg;n.set("x_ite/Browser/Picking/X3DPickingContext",yg);const wg=yg;i(292);var Sg=i(532);function Tg(t){uo.call(this,t),this.cursor="DEFAULT",this.isOver=!1,this.motionTime=0}Tg.prototype=Object.assign(Object.create(uo.prototype),{constructor:Tg,getTypeName:function(){return"PointingDevice"},initialize:function(){const t=this.getBrowser().getSurface();t.on("mousedown.PointingDevice"+this.getId(),this.mousedown.bind(this)),t.on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),t.on("dblclick.PointingDevice"+this.getId(),this.dblclick.bind(this)),t.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),t.on("mouseout.PointingDevice"+this.getId(),this.onmouseout.bind(this)),t.on("touchstart.PointingDevice"+this.getId(),this.touchstart.bind(this)),t.on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this))},getPointer:function(t){const e=this.getBrowser(),n=e.getRenderingProperty("ContentScale"),i=e.getSurface().offset();return[(t.pageX-i.left)*n,e.getViewport()[3]-(t.pageY-i.top)*n]},mousewheel:function(t){},mousedown:function(t){const e=this.getBrowser(),n=e.getSurface();if(e.getElement().focus(),!(e.getShiftKey()&&e.getControlKey()||0!==t.button)){const[i,o]=this.getPointer(t);n.off("mousemove.PointingDevice"+this.getId()),Sg(document).on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),Sg(document).on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),Sg(document).on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this)),Sg(document).on("touchmove.PointingDevice"+this.getId(),this.touchmove.bind(this)),e.buttonPressEvent(i,o)&&(t.preventDefault(),t.stopImmediatePropagation(),e.setCursor("HAND"),e.finishedEvents().addInterest("onverifymotion",this,i,o))}},mouseup:function(t){if(t.preventDefault(),0===t.button){const e=this.getBrowser(),n=e.getSurface(),[i,o]=this.getPointer(t);Sg(document).off(".PointingDevice"+this.getId()),n.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),e.buttonReleaseEvent(),e.setCursor(this.isOver?"HAND":"DEFAULT"),e.finishedEvents().addInterest("onverifymotion",this,i,o),e.addBrowserEvent(),this.cursor="DEFAULT"}},dblclick:function(t){this.isOver&&t.stopImmediatePropagation()},mousemove:function(t){t.preventDefault();const e=this.getBrowser();if(this.motionTime===e.getCurrentTime())return;this.motionTime=e.getCurrentTime();const[n,i]=this.getPointer(t);this.onmotion(n,i)},touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:{t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t);const n=this.getBrowser().getHit();0!==n.id&&0!==n.sensors.length||(this.touchX=t.pageX,this.touchY=t.pageY,this.touchTimeout=setTimeout(this.showContextMenu.bind(this,t),1200));break}case 2:this.touchend(t)}},touchend:function(t){t.button=0,this.mouseup(t),clearTimeout(this.touchTimeout)},touchmove:function(t){const e=t.originalEvent.touches;if(1===e.length)t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousemove(t),Math.hypot(this.touchX-t.pageX,this.touchY-t.pageY)>7&&clearTimeout(this.touchTimeout)},onmotion:function(t,e){const n=this.getBrowser();n.motionNotifyEvent(t,e)?this.isOver||(this.isOver=!0,this.cursor=n.getCursor(),n.setCursor("HAND")):this.isOver&&(this.isOver=!1,n.setCursor(this.cursor))},onmouseout:function(t){this.getBrowser().leaveNotifyEvent()},onverifymotion:function(t,e){this.getBrowser().finishedEvents().removeInterest("onverifymotion",this),this.onmotion(t,e)},showContextMenu:function(t){this.getBrowser().getContextMenu().show(t)}});const bg=Tg;n.set("x_ite/Browser/PointingDeviceSensor/PointingDevice",bg);const vg=bg;function Eg(t){const e=t.getContext();this.browser=t,this.array=new Float32Array(4),this.lastBuffer=e.getParameter(e.FRAMEBUFFER_BINDING),this.frameBuffer=e.createFramebuffer(),this.colorBuffers=[],this.frameBuffers=[];for(let t=0;t<3;++t)this.colorBuffers[t]=e.createRenderbuffer(),this.frameBuffers[t]=e.createFramebuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.colorBuffers[t]),e.renderbufferStorage(e.RENDERBUFFER,e.RGBA32F,1,1),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,this.colorBuffers[t]),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffers[t]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,this.colorBuffers[t]);if(e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1,e.COLOR_ATTACHMENT2]),e.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.depthTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);const t=e.getVersion()>=2?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT;e.texImage2D(e.TEXTURE_2D,0,t,1,1,0,e.DEPTH_COMPONENT,e.UNSIGNED_INT,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,1,1),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer);const n=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;if(e.bindFramebuffer(e.FRAMEBUFFER,this.lastBuffer),!n)throw new Error("Couldn't create frame buffer.")}Eg.prototype={constructor:Eg,bind:function(){const t=this.browser.getContext();this.lastBuffer=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},unbind:function(){const t=this.browser.getContext();t.bindFramebuffer(t.FRAMEBUFFER,this.lastBuffer)},getHit:function(t){const e=this.browser.getContext(),n=this.array;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffers[0]),e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,n),t.id=n[3],t.point.set(n[0],n[1],n[2]),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffers[1]),e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,n),t.normal.set(n[0],n[1],n[2]),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffers[2]),e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,n),t.texCoord.set(n[0],n[1],n[2],n[3]),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer)},dispose:function(){const t=this.browser.getContext();t.deleteFramebuffer(this.frameBuffer);for(const e of this.frameBuffers)t.deleteFramebuffer(e);for(const e of this.colorBuffers)t.deleteRenderbuffer(e);t.deleteRenderbuffer(this.depthBuffer),t.deleteTexture(this.depthTexture)}};const Cg=Eg;n.set("x_ite/Rendering/PointingBuffer",Cg);const Og=Cg,Ng=Symbol(),Fg=Symbol(),Ig=Symbol(),Mg=Symbol(),Dg=Symbol(),Rg=Symbol(),Vg=Symbol(),Ag=Symbol(),Pg=Symbol(),Lg=Symbol(),Bg=Symbol(),Xg=Symbol(),Ug=Symbol();function kg(){this[Ng]=new vg(this.getPrivateScene()),this[Fg]=new Set,this[Mg]=new ge(0,0),this[Rg]=[],this[Vg]=[],this[Ag]=null,this[Pg]=new xo,this[Lg]=new Og(this),this[Bg]=new Map,this[Ug]=[],this[Dg]={id:0,pointer:this[Mg],hitRay:null,sensors:[],modelViewMatrix:new dn,point:new Se(0,0,0),normal:new Se(0,0,0),texCoord:new ze(0,0,0,0),layerNode:null,shapeNode:null}}kg.prototype={initialize:function(){this.setCursor("DEFAULT"),this[Ng].setup()},getPointingTime:function(){return this[Pg]},addPointingDeviceSensor:function(t){this[Fg].add(t)},removePointingDeviceSensor:function(t){this[Fg].delete(t)},setCursor:function(t){const e=this.getSurface();switch(this[Ig]=t,t){case"HAND":e.css("cursor","pointer");break;case"MOVE":e.css("cursor","move");break;case"CROSSHAIR":e.css("cursor","crosshair");break;default:this.getDisplayLoadCount()?e.css("cursor","wait"):this[Ng]?.isOver?e.css("cursor","pointer"):e.css("cursor","default")}},getCursor:function(){return this[Ig]},getPointer:function(){return this[Mg]},isPointerInRectangle:function(t,e=this[Mg]){return e.x>=t.x&&e.x<=t.x+t.z&&e.y>=t.y&&e.y<=t.y+t.w},getPointingLayer:function(){return this[Ag]},getHit:function(){return this[Dg]},addPointingShape:function(t){const e=++this[Xg];return this[Ug][e]=t,e},buttonPressEvent:function(t,e){if(!this[Fg].size)return!1;if(!this.touch(t,e))return!1;const n=this[Dg];this[Vg]=n.sensors,this[Ag]=n.layerNode;for(const t of this[Vg])t.set_active__(!0,n);return!!n.sensors.length},buttonReleaseEvent:function(){if(this[Fg].size){for(const t of this[Vg])t.set_active__(!1,null);this[Vg]=Array.prototype,this[Ag]=null}},motionNotifyEvent:function(t,e){return!!this[Fg].size&&(this.touch(t,e),this.motion(),!!this[Dg].sensors.length)},leaveNotifyEvent:function(){},touch:function(t,e){if(this[Pg].start(),this.getViewer()._isActive.getValue())return this[Pg].reset(),!1;const n=this[Dg];if(this[Xg]=0,this[Mg].set(t,e),this[Lg].bind(),this.getWorld().traverse(ja.POINTER),this[Lg].getHit(n),this[Lg].unbind(),Number.isInteger(n.id)&&n.id>0&&n.id<=this[Xg]){const t=this[Ug][n.id],e=t.shapeNode,i=e.getAppearance(),o=e.getGeometryContext();n.hitRay=t.renderObject.getHitRay(),n.sensors=t.sensors.slice(),n.layerNode=t.renderObject,n.shapeNode=e,n.modelViewMatrix.assign(t.modelViewMatrix),o.hasNormals?n.modelViewMatrix.submatrix.inverse().transpose().multVecMatrix(n.normal).normalize():n.normal.assign(Se.zAxis),i.getTextureTransform().transformPoint(n.texCoord)}else n.id=0,n.hitRay=this[Ag]?this[Ag].getHitRay():null,n.sensors=Array.prototype,n.layerNode=this[Ag],n.shapeNode=null,n.modelViewMatrix.assign(dn.Identity);return this.addBrowserEvent(),this[Pg].stop(),!!n.id},motion:function(){const t=this[Dg];if(t.id)var e=this[Rg].filter((e=>!t.sensors.find((t=>e.node===t.node))));else e=this[Rg];for(const n of e)n.set_over__(!1,t);if(t.id){this[Rg]=t.sensors;for(const e of this[Rg])e.set_over__(!0,t)}else this[Rg]=Array.prototype;for(const e of this[Vg])e.set_motion__(t)},getPointingShader:function(t,e){const n=e.getGeometryContext();let i="";if(i+=t,i+=".",i+=e.getShapeKey(),i+=n.geometryType,n.geometryType>=2)i+="0.0.0";else{const t=e.getAppearance();i+=t.getStyleProperties(n.geometryType)?1:0,i+=".",i+=t.getTextureBits().toString(4),i+=".",i+=t.getMaterial().getTextureBits().toString(4)}return this[Bg].get(i)||this.createPointingShader(i,t,e)},createPointingShader:function(t,e,n){const i=n.getAppearance(),o=n.getGeometryContext(),r=[];e&&(r.push("X3D_CLIP_PLANES"),r.push("X3D_NUM_CLIP_PLANES "+e)),n.getShapeKey()>0&&r.push("X3D_PARTICLE_SYSTEM"),r.push(`X3D_GEOMETRY_${o.geometryType}D`),i.getStyleProperties(o.geometryType)&&r.push("X3D_STYLE_PROPERTIES"),(+i.getTextureBits()||+i.getMaterial().getTextureBits())&&r.push("X3D_TEXTURE","X3D_NUM_TEXTURE_COORDINATES 1");const s=this.createShader("PointingShader","Pointing","Pointing",r);return this[Bg].set(t,s),s}};const zg=kg;n.set("x_ite/Browser/PointingDeviceSensor/X3DPointingDeviceSensorContext",zg);const jg=zg;function Gg(t,e,n,i){const o=t.getContext();if(1===o.getVersion()||0===e||0===n)return Hg;this.browser=t,this.width=e,this.height=n,this.samples=Math.min(i,o.getParameter(o.MAX_SAMPLES)),this.lastBuffer=o.getParameter(o.FRAMEBUFFER_BINDING),this.frameBuffer=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,this.frameBuffer),this.colorBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,this.colorBuffer),o.renderbufferStorageMultisample(o.RENDERBUFFER,this.samples,o.RGBA8,e,n),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,this.colorBuffer),this.depthBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,this.depthBuffer),o.renderbufferStorageMultisample(o.RENDERBUFFER,this.samples,o.DEPTH_COMPONENT24,e,n),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this.depthBuffer);const r=o.checkFramebufferStatus(o.FRAMEBUFFER)===o.FRAMEBUFFER_COMPLETE;if(o.bindFramebuffer(o.FRAMEBUFFER,this.lastBuffer),!r)throw new Error("Couldn't create frame buffer.")}Gg.prototype={constructor:Gg,getWidth:function(){return this.width},getHeight:function(){return this.height},getSamples:function(){return this.samples},bind:function(){const t=this.browser.getContext();this.lastBuffer=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer)},unbind:function(){const t=this.browser.getContext();t.bindFramebuffer(t.FRAMEBUFFER,this.lastBuffer)},blit:function(){const t=this.browser.getContext();t.viewport(0,0,this.width,this.height),t.scissor(0,0,this.width,this.height),t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)},dispose:function(){const t=this.browser.getContext();t.deleteFramebuffer(this.frameBuffer),t.deleteRenderbuffer(this.colorBuffer),t.deleteRenderbuffer(this.depthBuffer)}};const Hg={getWidth:Function.prototype,getHeight:Function.prototype,getSamples:Function.prototype,bind:Function.prototype,unbind:Function.prototype,blit:Function.prototype,dispose:Function.prototype},qg=Gg;n.set("x_ite/Rendering/MultiSampleFrameBuffer",qg);const Yg=qg;var Wg=i(532),Kg=i(131);const Jg=Symbol(),Zg=Symbol(),Qg=Symbol(),$g=Symbol(),tm=Symbol();function em(){this[Jg]=new ze(0,0,300,150),this[Zg]=new Yg(this,300,150,4),this[$g]=[],this[tm]=new Map}em.prototype={initialize:function(){const t=this.getContext();t.enable(t.SCISSOR_TEST),t.depthFunc(t.LEQUAL),t.clearDepth(1),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),Wg(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",this.onfullscreen.bind(this)),this[Qg]=new Kg(this.getSurface(),this.reshape.bind(this)),this.getSurface().css("position",""),this.reshape()},getRenderer:function(){const t=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const e=t.getExtension("WEBGL_debug_renderer_info");if(e)return t.getParameter(e.UNMASKED_RENDERER_WEBGL)}return t.getParameter(t.RENDERER)},getVendor:function(){const t=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const e=t.getExtension("WEBGL_debug_renderer_info");if(e)return t.getParameter(e.UNMASKED_VENDOR_WEBGL)}return t.getParameter(t.VENDOR)},getWebGLVersion:function(){const t=this.getContext();return t.getParameter(t.VERSION)},getAntialiased:function(){const t=this.getContext();return t.getParameter(t.SAMPLES)>0||t.getVersion()>1&&this.getRenderingProperty("Multisampling")>0},getMaxSamples:function(){const t=this.getContext();return t.getVersion()>1?t.getParameter(t.MAX_SAMPLES):0},getMaxClipPlanes:function(){return 6},getDepthSize:function(){const t=this.getContext();return t.getParameter(t.DEPTH_BITS)},getColorDepth:function(){const t=this.getContext();return t.getParameter(t.RED_BITS)+t.getParameter(t.BLUE_BITS)+t.getParameter(t.GREEN_BITS)+t.getParameter(t.ALPHA_BITS)},getViewport:function(){return this[Jg]},getLocalObjects:function(){return this[$g]},getFrameBuffer:function(){return this[Zg]},getDepthShader:function(t,e){const n=e.getGeometryContext();let i="";if(i+=t,i+=".",i+=e.getShapeKey(),i+=n.geometryType,n.geometryType>=2)i+="0.0.0";else{const t=e.getAppearance();i+=t.getStyleProperties(n.geometryType)?1:0,i+=".",i+=t.getTextureBits().toString(4),i+=".",i+=t.getMaterial().getTextureBits().toString(4)}return this[tm].get(i)||this.createDepthShader(i,t,e)},createDepthShader:function(t,e,n){const i=n.getAppearance(),o=n.getGeometryContext(),r=[];e&&(r.push("X3D_CLIP_PLANES"),r.push("X3D_NUM_CLIP_PLANES "+e)),n.getShapeKey()>0&&r.push("X3D_PARTICLE_SYSTEM"),r.push(`X3D_GEOMETRY_${o.geometryType}D`),i.getStyleProperties(o.geometryType)&&r.push("X3D_STYLE_PROPERTIES"),(+i.getTextureBits()||+i.getMaterial().getTextureBits())&&r.push("X3D_TEXTURE","X3D_NUM_TEXTURE_COORDINATES 1");const s=this.createShader("DepthShader","Depth","Depth",r);return this[tm].set(t,s),s},reshape:function(){const t=this.getCanvas(),e=this.getRenderingProperty("ContentScale"),n=this.getRenderingProperty("Multisampling"),i=t.width()*e,o=t.height()*e,r=t[0];r.width=i,r.height=o,this[Jg][2]=i,this[Jg][3]=o,i===this[Zg].getWidth()&&o===this[Zg].getHeight()&&n===this[Zg].getSamples()||(this[Zg].dispose(),this[Zg]=new Yg(this,i,o,n)),this.addBrowserEvent()},onfullscreen:function(){const t=this.getElement();t.fullScreen()?t.addClass("x_ite-fullscreen"):t.removeClass("x_ite-fullscreen")}};const nm=em;n.set("x_ite/Browser/Rendering/X3DRenderingContext",nm);const im=nm,om=Symbol();function rm(){this[om]=[this]}rm.prototype={isExternal:function(){return 1===this[om].length},getScriptStack:function(){return this[om]}};const sm=rm;n.set("x_ite/Browser/Scripting/X3DScriptingContext",sm);const am=sm,um="\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/ClipPlanes.glsl",um);const cm=um,lm="\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\n#if defined (MANUAL_SRGB)\nvec4\nGamma (const in vec4 color)\n{\n   return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n}\n#else\n#define Gamma(color) (color)\n#endif\n";n.set("assets/shaders/webgl1/include/Colors.glsl",lm);const hm=lm,dm="\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Fog.glsl",dm);const pm=dm,fm='\n#if defined (X3D_NORMAL_TEXTURE)\n   #extension GL_OES_standard_derivatives : enable\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   #extension GL_EXT_frag_depth : enable\n#endif\n\n#if defined (X3D_ALPHA_MODE_MASK)\n   uniform float x3d_AlphaCutoff;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         varying vec4 texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         varying vec4 texCoord3;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         vec4 texCoord2 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         vec4 texCoord3 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   varying float depth;\n#endif\n\n#pragma X3D include "Texture.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n\nvec4\ngetMaterialColor ();\n\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      setPointTexCoords ();\n   #endif\n\n   vec4 finalColor = getMaterialColor ();\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getPointColor (finalColor);\n   #endif\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   #if defined (X3D_ALPHA_MODE_OPAQUE)\n      finalColor .a = 1.0;\n   #endif\n\n   #if defined (X3D_ALPHA_MODE_MASK)\n      if (finalColor .a < x3d_AlphaCutoff)\n         discard;\n\n      finalColor .a = 1.0;\n   #endif\n\n   gl_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //https://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepthEXT = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n';n.set("assets/shaders/webgl1/include/Fragment.glsl",fm);const gm=fm,mm="\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture2D (x3d_FillProperties .texture, gl_FragCoord .xy / (32.0 * x3d_FillProperties .scale));\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Hatch.glsl",mm);const _m=mm,xm='\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0 && light .shadowIntensity > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n';n.set("assets/shaders/webgl1/include/Material.glsl",xm);const ym=xm,wm="\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE) && ! defined (X3D_NORMAL_TEXTURE_3D)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture2D (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = textureCube (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n";n.set("assets/shaders/webgl1/include/Normal.glsl",wm);const Sm=wm,Tm="\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n";n.set("assets/shaders/webgl1/include/Perlin.glsl",Tm);const bm=Tm,vm="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetPointTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoord0 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoord1 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 2\n      texCoord2 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 3\n      texCoord3 = texCoord;\n   #endif\n}\n\n#define getPointColor(color) (color)\n\n#else\n\n#define setPointTexCoords()\n\nvarying float pointSize;\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n#endif\n#endif\n";n.set("assets/shaders/webgl1/include/Point.glsl",vm);const Em=vm,Cm="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nvarying float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue = x3d_PointProperties .pointSizeMaxValue;\n   vec3  attenuation       = x3d_PointProperties .attenuation;\n   float dL                = length (vertex);\n   float pointSize         = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (attenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/PointSize.glsl",Cm);const Om=Cm,Nm="\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   #if X3D_NUM_LIGHTS > 0\n   if (index == 0)\n      return texture2D (x3d_ShadowMap [0], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 1\n   if (index == 1)\n      return texture2D (x3d_ShadowMap [1], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 2\n   if (index == 2)\n      return texture2D (x3d_ShadowMap [2], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 3\n   if (index == 3)\n      return texture2D (x3d_ShadowMap [3], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 4\n   if (index == 4)\n      return texture2D (x3d_ShadowMap [4], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 5\n   if (index == 5)\n      return texture2D (x3d_ShadowMap [5], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 6\n   if (index == 6)\n      return texture2D (x3d_ShadowMap [6], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 7\n   if (index == 7)\n      return texture2D (x3d_ShadowMap [7], shadowCoord) .r;\n   #endif\n\n   return 0.0;\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         vec2 d0 = - texelSize;\n         vec2 d1 =   texelSize;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + d0,                  shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0,   d0 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d1 .x, d0 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d0 .x, 0.0),   shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy, shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d1 .x, 0.0),   shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d0 .x, d1 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0,   d1 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + d1,                  shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         vec2 d0 = - texelSize;\n         vec2 d1 =   texelSize;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + d0,                  shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0,   d0 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d1 .x, d0 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d0 .x, 0.0),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy, shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d1 .x, 0.0),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d0 .x, d1 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, d1 .y),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + d1,                  shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Shadow.glsl",Nm);const Fm=Nm,Im="\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n";n.set("assets/shaders/webgl1/include/SpotFactor.glsl",Im);const Mm=Im,Dm='\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nmat4\ngetTextureMatrix (const in int i)\n{\n   #if X3D_NUM_TEXTURE_TRANSFORMS > 1\n      mat4 textureMatrix = mat4 (0.0);\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 0\n      if (i == 0)\n         textureMatrix = x3d_TextureMatrix [0];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 1\n      else if (i == 1)\n         textureMatrix = x3d_TextureMatrix [1];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 2\n      else if (i == 2)\n         textureMatrix = x3d_TextureMatrix [2];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 3\n      else if (i == 3)\n         textureMatrix = x3d_TextureMatrix [3];\n      #endif\n\n      return textureMatrix;\n   #else\n      return x3d_TextureMatrix [0];\n   #endif\n}\n\nvec4\ngetTexCoord (const in int i)\n{\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      vec4 texCoord = vec4 (0.0);\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n      if (i == 0)\n         texCoord = texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n      else if (i == 1)\n         texCoord = texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n      else if (i == 2)\n         texCoord = texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n      else if (i == 3)\n         texCoord = texCoord3;\n      #endif\n\n      return texCoord;\n   #else\n      return texCoord0;\n   #endif\n}\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   if (mode == x3d_None)\n   {\n      return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n   }\n   else if (mode == x3d_Sphere)\n   {\n      vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceNormal)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (N, 1.0);\n   }\n   else if (mode == x3d_CameraSpacePosition)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceReflectionVector)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (reflect (normalize (vertex), -N), 1.0);\n   }\n   else if (mode == x3d_SphereLocal)\n   {\n      vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_Coord)\n   {\n      return vec4 (localVertex, 1.0);\n   }\n   else if (mode == x3d_CoordEye)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_Noise)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (localVertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_NoiseEye)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (vertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_SphereReflect)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n      float eta = textureCoordinateGenerator .parameter [0];\n\n      return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n   }\n   else if (mode == x3d_SphereReflectLocal)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n      float eta = textureCoordinateGenerator .parameter [0];\n      vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n      return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n   }\n\n   return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord;\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n   if (textureCoordinateMapping == 0)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [0], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n   else if (textureCoordinateMapping == 1)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [1], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 2\n   else if (textureCoordinateMapping == 2)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [2], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 3\n   else if (textureCoordinateMapping == 3)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [3], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   vec4 textureColor = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURES > 0\n   if (i == 0)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   #if X3D_NUM_TEXTURES > 1\n   else if (i == 1)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [1], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [1], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   return textureColor;\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nint\nminI (const in int a, const in int b)\n{\n   return a < b ? a : b;\n}\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (minI (i, X3D_NUM_TEXTURE_TRANSFORMS - 1), minI (i, X3D_NUM_TEXTURE_COORDINATES - 1));\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         if (source == x3d_Diffuse)\n         {\n            arg1 = diffuseColor;\n         }\n         else if (source == x3d_Specular)\n         {\n            arg1 = specularColor;\n         }\n         else if (source == x3d_Factor)\n         {\n            arg1 = x3d_MultiTextureColor;\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         if (function == x3d_Complement)\n         {\n            arg1 = 1.0 - arg1;\n         }\n         else if (function == x3d_AlphaReplicate)\n         {\n            arg1 .a = arg2 .a;\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         if (mode == x3d_Replace)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_Modulate)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .rgb;\n         }\n         else if (mode == x3d_Modulate2X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n         }\n         else if (mode == x3d_Modulate4X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n         }\n         else if (mode == x3d_Add)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb;\n         }\n         else if (mode == x3d_AddSigned)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n         }\n         else if (mode == x3d_AddSigned2X)\n         {\n            currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n         }\n         else if (mode == x3d_AddSmooth)\n         {\n            currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n         }\n         else if (mode == x3d_Subtract)\n         {\n            currentColor .rgb = arg1 .rgb - arg2 .rgb;\n         }\n         else if (mode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n         }\n         else if (mode == x3d_BlendTextureAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n         }\n         else if (mode == x3d_BlendFactorAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (mode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n         }\n         else if (mode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n         }\n         else if (mode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n         }\n         else if (mode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n         }\n         else if (mode == x3d_DotProduct3)\n         {\n            currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n         }\n         else if (mode == x3d_SelectArg1)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_SelectArg2)\n         {\n            currentColor .rgb = arg2 .rgb;\n         }\n         else if (mode == x3d_Off)\n            ;\n\n         // Alpha\n\n         if (alphaMode == x3d_Replace)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_Modulate)\n         {\n            currentColor .a = arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_Modulate2X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n         }\n         else if (alphaMode == x3d_Modulate4X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n         }\n         else if (alphaMode == x3d_Add)\n         {\n            currentColor .a = arg1 .a + arg2 .a;\n         }\n         else if (alphaMode == x3d_AddSigned)\n         {\n            currentColor .a = arg1 .a + arg2 .a - 0.5;\n         }\n         else if (alphaMode == x3d_AddSigned2X)\n         {\n            currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n         }\n         else if (alphaMode == x3d_AddSmooth)\n         {\n            currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n         }\n         else if (alphaMode == x3d_Subtract)\n         {\n            currentColor .a = arg1 .a - arg2 .a;\n         }\n         else if (alphaMode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n         }\n         else if (alphaMode == x3d_BlendTextureAlpha)\n         {\n            currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n         }\n         else if (alphaMode == x3d_BlendFactorAlpha)\n         {\n            currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (alphaMode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n         }\n         else if (alphaMode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_DotProduct3)\n         {\n            currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n         }\n         else if (alphaMode == x3d_SelectArg1)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_SelectArg2)\n         {\n            currentColor .a = arg2 .a;\n         }\n         else if (alphaMode == x3d_Off)\n            ;\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #else\n         vec4 textureColor = vec4 (0.0);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   vec4 color = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 0\n   if (i == 0)\n      color = texture2D (x3d_ProjectiveTexture [0], texCoord);\n   #endif\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 1\n   else if (i == 1)\n      color = texture2D (x3d_ProjectiveTexture [1], texCoord);\n   #endif\n\n   return color;\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalize p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n';n.set("assets/shaders/webgl1/include/Texture.glsl",Dm);const Rm=Dm,Vm='\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   attribute float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   attribute vec4 x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         attribute vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         attribute vec4 x3d_TexCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         attribute vec4 x3d_TexCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         attribute vec4 x3d_TexCoord3;\n      #endif\n   #endif\n#endif\n\nattribute vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         varying vec4 texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         varying vec4 texCoord3;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   attribute vec3 x3d_Normal;\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   varying float depth;\n#endif\n\n// Main\n\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = x3d_TexCoord0;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = x3d_TexCoord1;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 2\n            texCoord2 = x3d_TexCoord2;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 3\n            texCoord3 = x3d_TexCoord3;\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal      = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n';n.set("assets/shaders/webgl1/include/Vertex.glsl",Vm);const Am=Vm,Pm="\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/ClipPlanes.glsl",Pm);const Lm=Pm,Bm="\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\n#if defined (MANUAL_SRGB)\nvec4\nGamma (const in vec4 color)\n{\n   return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n}\n#else\n#define Gamma(color) (color)\n#endif\n";n.set("assets/shaders/webgl2/include/Colors.glsl",Bm);const Xm=Bm,Um="\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Fog.glsl",Um);const km=Um,zm='\n#if defined (X3D_ALPHA_MODE_MASK)\n   uniform float x3d_AlphaCutoff;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         in vec4 texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         in vec4 texCoord3;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         vec4 texCoord2 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         vec4 texCoord3 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   in vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      in vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nin vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   in vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   in float depth;\n#endif\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "Texture.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Stipple.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n\nvec4\ngetMaterialColor ();\n\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      stipple ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      setPointTexCoords ();\n   #elif defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      setTexCoords ();\n   #endif\n\n   vec4 finalColor = getMaterialColor ();\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getPointColor (finalColor);\n   #endif\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   #if defined (X3D_ALPHA_MODE_OPAQUE)\n      finalColor .a = 1.0;\n   #endif\n\n   #if defined (X3D_ALPHA_MODE_MASK)\n      if (finalColor .a < x3d_AlphaCutoff)\n         discard;\n\n      finalColor .a = 1.0;\n   #endif\n\n   x3d_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //https://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepth = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n';n.set("assets/shaders/webgl2/include/Fragment.glsl",zm);const jm=zm,Gm="\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture (x3d_FillProperties .texture, gl_FragCoord .xy / (32.0 * x3d_FillProperties .scale));\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Hatch.glsl",Gm);const Hm=Gm,qm="\nstruct Line2\n{\n   vec2 point;\n   vec2 direction;\n};\n\nLine2\nline2 (const in vec2 point1, const in vec2 point2)\n{\n   return Line2 (point1, normalize (point2 - point1));\n}\n\nvec2\nclosest_point (const in Line2 line, const in vec2 point)\n{\n   vec2  r = point - line .point;\n   float d = dot (r, line .direction);\n\n   return line .direction * d + line .point;\n}\n";n.set("assets/shaders/webgl2/include/Line2.glsl",qm);const Ym=qm,Wm='\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0 && light .shadowIntensity > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n';n.set("assets/shaders/webgl2/include/Material.glsl",Wm);const Km=Wm,Jm="\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_3D)\n         vec3 n = texture (x3d_NormalTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = texture (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n";n.set("assets/shaders/webgl2/include/Normal.glsl",Jm);const Zm=Jm,Qm="\n#if defined (X3D_PARTICLE_SYSTEM)\n#if defined (X3D_TEX_COORD_RAMP)\n\nuniform sampler2D x3d_TexCoordRamp;\n\nin vec4 x3d_Particle;\n\nvec4\ntexelFetch (const in sampler2D sampler, const in int index, const in int lod)\n{\n   int   x = textureSize (sampler, lod) .x;\n   ivec2 p = ivec2 (index % x, index / x);\n   vec4  t = texelFetch (sampler, p, lod);\n\n   return t;\n}\n\nvec4\ngetTexCoord (const in vec4 texCoord)\n{\n   const int map [6] = int [6] (0, 1, 2, 0, 2, 3);\n\n   int index0 = int (x3d_Particle [3]);\n\n   return texelFetch (x3d_TexCoordRamp, index0 + map [gl_VertexID % 6], 0);\n}\n#else\n   #define getTexCoord(texCoord) (texCoord)\n#endif\n\nin mat4 x3d_ParticleMatrix;\n\nvec4\ngetVertex (const in vec4 vertex)\n{\n   return x3d_ParticleMatrix * vertex;\n}\n\n#else\n   #define getVertex(vertex) (vertex)\n   #define getTexCoord(texCoord) (texCoord)\n#endif\n";n.set("assets/shaders/webgl2/include/Particle.glsl",Qm);const $m=Qm,t_="\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n";n.set("assets/shaders/webgl2/include/Perlin.glsl",t_);const e_=t_,n_="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetPointTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoords [0] = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoords [1] = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 2\n      texCoords [2] = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 3\n      texCoords [3] = texCoord;\n   #endif\n}\n\n#define getPointColor(color) (color)\n\n#else\n\n#define setPointTexCoords()\n\nin float pointSize;\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n#endif\n#endif\n";n.set("assets/shaders/webgl2/include/Point.glsl",n_);const i_=n_,o_="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nout float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue = x3d_PointProperties .pointSizeMaxValue;\n   vec3  attenuation       = x3d_PointProperties .attenuation;\n   float dL                = length (vertex);\n   float pointSize         = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (attenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/PointSize.glsl",o_);const r_=o_,s_="\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   switch (index)\n   {\n      #if X3D_NUM_LIGHTS > 0\n      case 0:\n      {\n         return texture (x3d_ShadowMap [0], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 1\n      case 1:\n      {\n         return texture (x3d_ShadowMap [1], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 2\n      case 2:\n      {\n         return texture (x3d_ShadowMap [2], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 3\n      case 3:\n      {\n         return texture (x3d_ShadowMap [3], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 4\n      case 4:\n      {\n         return texture (x3d_ShadowMap [4], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 5\n      case 5:\n      {\n         return texture (x3d_ShadowMap [5], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 6\n      case 6:\n      {\n         return texture (x3d_ShadowMap [6], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 7\n      case 7:\n      {\n         return texture (x3d_ShadowMap [7], shadowCoord) .r;\n      }\n      #endif\n      default:\n      {\n         return 0.0;\n      }\n   }\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         vec2 d0 = - texelSize;\n         vec2 d1 =   texelSize;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + d0,                  shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0,   d0 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d1 .x, d0 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d0 .x, 0.0),   shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy,                       shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d1 .x, 0.0),   shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d0 .x, d1 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0,   d1 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + d1,                  shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         vec2 d0 = - texelSize;\n         vec2 d1 =   texelSize;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + d0,                  shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0,   d0 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d1 .x, d0 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d0 .x, 0.0),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy,                       shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d1 .x, 0.0),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d0 .x, d1 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0,   d1 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + d1,                  shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Shadow.glsl",s_);const a_=s_,u_='\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n\n#pragma X3D include "Line2.glsl"\n\nuniform x3d_LinePropertiesParameters x3d_LineProperties;\n\nflat in float lengthSoFar; // in px\nflat in vec2  startPoint;  // in px\nin vec2       midPoint;    // in px\n\nvoid\nstipple ()\n{\n   vec2  point = closest_point (line2 (startPoint, midPoint), gl_FragCoord .xy);\n   float s     = (lengthSoFar + length (point - startPoint)) * x3d_LineProperties .lineStippleScale;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         texCoord0 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         texCoord1 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n\n   if (x3d_LineProperties .linetype != 16)\n   {\n      int   linetype = x3d_LineProperties .linetype;\n      int   height   = textureSize (x3d_LineProperties .texture, 0) .y;\n      float t        = 1.0 - float (linetype * 2 + 1) / float (height * 2);\n      float alpha    = texture (x3d_LineProperties .texture, vec2 (s, t)) .a;\n\n      if (alpha != 1.0)\n         discard;\n   }\n}\n\n#endif\n';n.set("assets/shaders/webgl2/include/Stipple.glsl",u_);const c_=u_,l_="\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n";n.set("assets/shaders/webgl2/include/SpotFactor.glsl",l_);const h_=l_,d_='\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nvec4 texCoords [X3D_NUM_TEXTURE_COORDINATES];\n\nvoid\nsetTexCoords ()\n{\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n   texCoords [0] = texCoord0;\n   #endif\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n   texCoords [1] = texCoord1;\n   #endif\n   #if X3D_NUM_TEXTURE_COORDINATES > 2\n   texCoords [2] = texCoord2;\n   #endif\n   #if X3D_NUM_TEXTURE_COORDINATES > 3\n   texCoords [3] = texCoord3;\n   #endif\n}\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   switch (mode)\n   {\n      case x3d_None:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * texCoords [textureCoordinateMapping];\n      }\n      case x3d_Sphere:\n      {\n         vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_CameraSpaceNormal:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (N, 1.0);\n      }\n      case x3d_CameraSpacePosition:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_CameraSpaceReflectionVector:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (reflect (normalize (vertex), -N), 1.0);\n      }\n      case x3d_SphereLocal:\n      {\n         vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_Coord:\n      {\n         return vec4 (localVertex, 1.0);\n      }\n      case x3d_CoordEye:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_Noise:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (localVertex * scale + translation), 1.0);\n      }\n      case x3d_NoiseEye:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (vertex * scale + translation), 1.0);\n      }\n      case x3d_SphereReflect:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n         float eta = textureCoordinateGenerator .parameter [0];\n\n         return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n      }\n      case x3d_SphereReflectLocal:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n         float eta = textureCoordinateGenerator .parameter [0];\n         vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n         return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n      }\n      default:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * texCoords [textureCoordinateMapping];\n      }\n   }\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord = getTexCoord (x3d_TextureCoordinateGenerator [textureCoordinateMapping], textureTransformMapping, textureCoordinateMapping);\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform int         x3d_TextureType [X3D_NUM_TEXTURES];\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform sampler3D   x3d_Texture3D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURES > 0\n      case 0:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [0], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [0], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [0], texCoord .stp);\n         #endif\n      #endif\n      #if X3D_NUM_TEXTURES > 1\n      case 1:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [1], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [1], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [1], texCoord .stp);\n         #endif\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (min (i, X3D_NUM_TEXTURE_TRANSFORMS - 1), min (i, X3D_NUM_TEXTURE_COORDINATES - 1));\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         switch (source)\n         {\n            case x3d_Diffuse:\n            {\n               arg1 = diffuseColor;\n               break;\n            }\n            case x3d_Specular:\n            {\n               arg1 = specularColor;\n               break;\n            }\n            case x3d_Factor:\n            {\n               arg1 = x3d_MultiTextureColor;\n               break;\n            }\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         switch (function)\n         {\n            case x3d_Complement:\n            {\n               arg1 = 1.0 - arg1;\n               break;\n            }\n            case x3d_AlphaReplicate:\n            {\n               arg1 .a = arg2 .a;\n               break;\n            }\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         switch (mode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .rgb;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .rgb = arg1 .rgb - arg2 .rgb;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .rgb = arg2 .rgb;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n\n         // Alpha\n\n         switch (alphaMode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .a = arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .a = arg1 .a + arg2 .a;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .a = arg1 .a + arg2 .a - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .a = arg1 .a - arg2 .a;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .a = arg2 .a;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_3D)\n         vec4 textureColor = texture (x3d_Texture3D [0], texCoord .stp);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = texture (x3d_TextureCube [0], texCoord .stp);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif // X3D_TEXTURE\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURE_PROJECTORS > 0\n      case 0:\n         return texture (x3d_ProjectiveTexture [0], texCoord);\n      #endif\n      #if X3D_NUM_TEXTURE_PROJECTORS > 1\n      case 1:\n         return texture (x3d_ProjectiveTexture [1], texCoord);\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalize p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n';n.set("assets/shaders/webgl2/include/Texture.glsl",d_);const p_=d_,f_='\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   in vec3 x3d_LineStipple;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4  x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 x3d_TexCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         in vec4 x3d_TexCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         in vec4 x3d_TexCoord3;\n      #endif\n   #endif\n#endif\n\nin vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   out float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   out vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         out vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         out vec4 texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         out vec4 texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         out vec4 texCoord3;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   in  vec3 x3d_Normal;\n   out vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      out vec3 localNormal;\n   #endif\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   flat out float lengthSoFar;\n   flat out vec2  startPoint;\n   out vec2       midPoint;\n#endif\n\nout vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   out vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   out float depth;\n#endif\n\n// Main\n\n#pragma X3D include "Particle.glsl"\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      lengthSoFar = x3d_LineStipple .z;\n      startPoint  = x3d_LineStipple .xy;\n      midPoint    = x3d_LineStipple .xy;\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = getTexCoord (x3d_TexCoord0);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = getTexCoord (x3d_TexCoord1);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 2\n            texCoord2 = getTexCoord (x3d_TexCoord2);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 3\n            texCoord3 = getTexCoord (x3d_TexCoord3);\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n';n.set("assets/shaders/webgl2/include/Vertex.glsl",f_);const g_=f_,m_='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n';n.set("assets/shaders/webgl1/Default.vs",m_);const __=m_,x_='\nprecision highp float;\nprecision highp int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nattribute vec4 x3d_Vertex;\nattribute vec3 x3d_Normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   attribute vec4 x3d_TexCoord0;\n#endif\n\nvarying vec3 vertex;\nvarying vec3 normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 texCoord0;\n#endif\n\n#pragma X3D include "include/PointSize.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = max (pointSize = getPointSize (vertex), 2.0);\n      #else\n         gl_PointSize = 2.0;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n   normal = x3d_Normal;\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      texCoord0 = x3d_TexCoord0;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl1/Pointing.vs",x_);const y_=x_,w_='\nprecision highp float;\nprecision highp int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nattribute vec4 x3d_Vertex;\n\nvarying vec3 vertex;\n\n#pragma X3D include "include/PointSize.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = max (pointSize = getPointSize (vertex), 2.0);\n      #else\n         gl_PointSize = 2.0;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl1/Depth.vs",w_);const S_=w_,T_='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n';n.set("assets/shaders/webgl1/Gouraud.vs",T_);const b_=T_,v_='\n#extension GL_EXT_draw_buffers : enable\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nvarying vec3 vertex;\nvarying vec3 normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 texCoord0;\n#else\n   vec4 texCoord0 = vec4 (0.0, 0.0, 0.0, 1.0);\n#endif\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Point.glsl"\n\nuniform float x3d_Id;\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      if (getPointColor (vec4 (1.0)) .a < 0.5)\n         discard;\n\n      setPointTexCoords ();\n   #endif\n\n   gl_FragData [0] = vec4 (vertex, x3d_Id);\n   gl_FragData [1] = vec4 (normal, 0.0);\n   gl_FragData [2] = texCoord0;\n}\n';n.set("assets/shaders/webgl1/Pointing.fs",v_);const E_=v_,C_='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nvarying vec3 vertex;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Point.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      if (getPointColor (vec4 (1.0)) .a < 0.5)\n         discard;\n   #endif\n\n   gl_FragColor = vec4 (gl_FragCoord .z);\n}\n';n.set("assets/shaders/webgl1/Depth.fs",C_);const O_=C_,N_='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Gouraud.fs",N_);const F_=N_,I_='\n\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\n#extension GL_EXT_shader_texture_lod: enable\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture2D (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (textureCube (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture2D (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (textureCube (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture2D (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = textureCube (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture2D (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001 && light .shadowIntensity > 0.0)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/PBR.fs",I_);const M_=I_,D_='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture2D (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * textureCube (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture2D (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * textureCube (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture2D (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * textureCube (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture2D (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * textureCube (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Phong.fs",D_);const R_=D_,V_='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Unlit.fs",V_);const A_=V_,P_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n';n.set("assets/shaders/webgl2/Default.vs",P_);const L_=P_,B_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nin vec4 x3d_Vertex;\nin vec3 x3d_Normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 x3d_TexCoord0;\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   in vec3 x3d_LineStipple;\n#endif\n\nout vec3 vertex;\nout vec3 normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   out vec4 texCoord0;\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   flat out float lengthSoFar;\n   flat out vec2  startPoint;\n   out vec2       midPoint;\n#endif\n\n#pragma X3D include "include/Particle.glsl"\n#pragma X3D include "include/PointSize.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = max (pointSize = getPointSize (vertex), 2.0);\n      #else\n         gl_PointSize = 2.0;\n      #endif\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      lengthSoFar = x3d_LineStipple .z;\n      startPoint  = x3d_LineStipple .xy;\n      midPoint    = x3d_LineStipple .xy;\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n   normal = x3d_Normal;\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      texCoord0 = x3d_TexCoord0;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl2/Pointing.vs",B_);const X_=B_,U_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nin vec4 x3d_Vertex;\n\nout vec3 vertex;\n\n#pragma X3D include "include/Particle.glsl"\n#pragma X3D include "include/PointSize.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = max (pointSize = getPointSize (vertex), 2.0);\n      #else\n         gl_PointSize = 2.0;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl2/Depth.vs",U_);const k_=U_,z_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nout vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   out vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n';n.set("assets/shaders/webgl2/Gouraud.vs",z_);const j_=z_,G_="#version 300 es\n\nprecision highp float;\n\nuniform vec4  viewport;\nuniform mat4  modelViewProjectionMatrix;\nuniform mat4  invModelViewProjectionMatrix;\nuniform float scale;\n\nin vec3 x3d_LineStipple0; in float x3d_FogDepth0; in vec4 x3d_Color0; in vec3 x3d_Normal0; in vec4 x3d_Vertex0;\nin vec3 x3d_LineStipple1; in float x3d_FogDepth1; in vec4 x3d_Color1; in vec3 x3d_Normal1; in vec4 x3d_Vertex1;\n\nout vec3 lineStipple0; out float fogDepth0; out vec4 color0; out vec3 normal0; out vec4 vertex0;\nout vec3 lineStipple1; out float fogDepth1; out vec4 color1; out vec3 normal1; out vec4 vertex1;\nout vec3 lineStipple2; out float fogDepth2; out vec4 color2; out vec3 normal2; out vec4 vertex2;\n\nvec3\nprojectPoint (const in vec4 point, const in mat4 modelViewProjectionMatrix, const in vec4 viewport)\n{\n   vec4 vin = modelViewProjectionMatrix * point;\n\n   vin .xyz = vin .xyz / (2.0 * vin .w) + 0.5;\n\n   return vec3 (vin .xy * viewport .zw + viewport .xy, vin .z);\n}\n\nvec4\nunProjectPoint (const in vec3 win, const in mat4 invModelViewProjection, const in vec4 viewport)\n{\n   vec4 vin = vec4 ((win .xy - viewport .xy) / viewport .zw * 2.0 - 1.0, 2.0 * win .z - 1.0, 1.0);\n\n   vin = invModelViewProjection * vin;\n\n   return vec4 (vin .xyz / vin .w, 1.0);\n}\n\nvoid\nmain ()\n{\n   vec3 projected0 = projectPoint (x3d_Vertex0, modelViewProjectionMatrix, viewport);\n   vec3 projected1 = projectPoint (x3d_Vertex1, modelViewProjectionMatrix, viewport);\n   vec2 direction  = normalize (projected1 .xy - projected0 .xy);\n   vec2 offset     = vec2 (-direction .y, direction .x) * scale;\n\n   // 0 - 3\n   // |  |\n   // 1 - 2\n\n   if (gl_InstanceID == 0)\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq1 = projected0 .xy - offset;\n      vec2 pq2 = projected1 .xy - offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p1 = unProjectPoint (vec3 (pq1 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; normal0 = x3d_Normal0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple0; fogDepth1 = x3d_FogDepth0; color1 = x3d_Color0; normal1 = x3d_Normal0; vertex1 = p1;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; normal2 = x3d_Normal1; vertex2 = p2;\n   }\n   else\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq2 = projected1 .xy - offset;\n      vec2 pq3 = projected1 .xy + offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p3 = unProjectPoint (vec3 (pq3 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; normal0 = x3d_Normal0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple1; fogDepth1 = x3d_FogDepth1; color1 = x3d_Color1; normal1 = x3d_Normal1; vertex1 = p2;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; normal2 = x3d_Normal1; vertex2 = p3;\n   }\n}\n";n.set("assets/shaders/webgl2/LineTransform.vs",G_);const H_=G_,q_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nin vec3 vertex;\nin vec3 normal;\nin vec4 texCoord;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 texCoord0;\n#else\n   vec4 texCoord0 = vec4 (0.0, 0.0, 0.0, 1.0);\n#endif\n\nlayout(location = 0) out vec4 x3d_FragData0;\nlayout(location = 1) out vec4 x3d_FragData1;\nlayout(location = 2) out vec4 x3d_FragData2;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Point.glsl"\n#pragma X3D include "Stipple.glsl"\n\nuniform float x3d_Id;\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      if (getPointColor (vec4 (1.0)) .a < 0.5)\n         discard;\n\n      setPointTexCoords ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      stipple ();\n   #endif\n\n   x3d_FragData0 = vec4 (vertex, x3d_Id);\n   x3d_FragData1 = vec4 (normal, 0.0);\n   x3d_FragData2 = texCoord0;\n}\n';n.set("assets/shaders/webgl2/Pointing.fs",q_);const Y_=q_,W_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nin vec3 vertex;\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Point.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      if (getPointColor (vec4 (1.0)) .a < 0.5)\n         discard;\n   #endif\n\n   x3d_FragColor = vec4 (gl_FragCoord .z);\n}\n';n.set("assets/shaders/webgl2/Depth.fs",W_);const K_=W_,J_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nin vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Gouraud.fs",J_);const Z_=J_,Q_="#version 300 es\n\nprecision highp float;\n\nvoid\nmain () { }\n";n.set("assets/shaders/webgl2/LineTransform.fs",Q_);const $_=Q_,tx='#version 300 es\n\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_3D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture3D, texCoord));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture3D, texCoord)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture3D, texCoord);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001 && light .shadowIntensity > 0.0)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/PBR.fs",tx);const ex=tx,nx='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_3D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * texture (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_3D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture3D, texCoord);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * texture (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_3D)\n         return specularParameter * texture (x3d_SpecularTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * texture (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_3D)\n         return shininess * texture (x3d_ShininessTexture .texture3D, texCoord) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * texture (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Phong.fs",nx);const ix=nx,ox='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Unlit.fs",ox);const rx={includes:{1:{ClipPlanes:cm,Colors:hm,Fog:pm,Fragment:gm,Hatch:_m,Material:ym,Normal:Sm,Perlin:bm,Point:Em,PointSize:Om,Shadow:Fm,SpotFactor:Mm,Texture:Rm,Vertex:Am},2:{ClipPlanes:Lm,Colors:Xm,Fog:km,Fragment:jm,Hatch:Hm,Line2:Ym,Material:Km,Normal:Zm,Particle:$m,Perlin:e_,Point:i_,PointSize:r_,Shadow:a_,Stipple:c_,SpotFactor:h_,Texture:p_,Vertex:g_}},vertex:{1:{Default:__,Pointing:y_,Depth:S_,Gouraud:b_},2:{Default:L_,Pointing:X_,Depth:k_,Gouraud:j_,LineTransform:H_}},fragment:{1:{Pointing:E_,Depth:O_,Gouraud:F_,PBR:M_,Phong:R_,Unlit:A_},2:{Pointing:Y_,Depth:K_,Gouraud:Z_,LineTransform:$_,PBR:ex,Phong:ix,Unlit:ox}}};n.set("x_ite/Browser/Shaders/Shaders",rx);const sx=rx;function ax(t){tc.call(this,t),this.addType(c.X3DShaderNode),this.valid=!1,this.selected=0}ax.prototype=Object.assign(Object.create(tc.prototype),{constructor:ax,setValid:function(t){this._isValid=this.valid=t},isValid:function(){return this.valid},select:function(){++this.selected,this._isSelected.getValue()||(this._isSelected=!0)},deselect:function(){--this.selected,0===this.selected&&this._isSelected.getValue()&&(this._isSelected=!1)}});const ux=ax;n.set("x_ite/Components/Shaders/X3DShaderNode",ux);const cx=ux;var lx=i(532);const hx=Symbol.for("X_ITE.X3DField.uniformLocation");function dx(t){this.addType(c.X3DProgrammableShaderObject),this.uniformNames=[],this.x3d_ClipPlane=[],this.x3d_LightType=[],this.x3d_LightOn=[],this.x3d_LightColor=[],this.x3d_LightIntensity=[],this.x3d_LightAmbientIntensity=[],this.x3d_LightAttenuation=[],this.x3d_LightLocation=[],this.x3d_LightDirection=[],this.x3d_LightBeamWidth=[],this.x3d_LightCutOffAngle=[],this.x3d_LightRadius=[],this.x3d_LightMatrix=[],this.x3d_ShadowIntensity=[],this.x3d_ShadowColor=[],this.x3d_ShadowBias=[],this.x3d_ShadowMatrix=[],this.x3d_ShadowMapSize=[],this.x3d_ShadowMap=[],this.x3d_Texture=[],this.x3d_MultiTextureMode=[],this.x3d_MultiTextureAlphaMode=[],this.x3d_MultiTextureSource=[],this.x3d_MultiTextureFunction=[],this.x3d_TextureCoordinateGeneratorMode=[],this.x3d_TextureCoordinateGeneratorParameter=[],this.x3d_ProjectiveTexture=[],this.x3d_ProjectiveTextureMatrix=[],this.x3d_ProjectiveTextureLocation=[],this.x3d_TexCoord=[],this.x3d_TextureMatrix=[],this.numClipPlanes=0,this.fogNode=null,this.numLights=0,this.numGlobalLights=0,this.lightNodes=[],this.numProjectiveTextures=0,this.numGlobalProjectiveTextures=0,this.projectiveTextureNodes=[],this.textures=new Set}dx.prototype={constructor:dx,initialize:function(){this.getBrowser().getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__:function(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},canUserDefinedFields:function(){return!0},getUniformNames:function(){return this.uniformNames},setUniformNames:function(t){this.uniformNames=t},getDefaultUniformsAndAttributes:function(){const t=this.getProgram(),e=this.getBrowser(),n=e.getContext(),i=e.getMaxClipPlanes(),o=e.getMaxLights(),r=e.getMaxTextures(),s=e.getMaxTextureTransforms(),a=e.getMaxTexCoords();n.useProgram(t);for(const e of this.uniformNames)this[e]=n.getUniformLocation(t,e);this.x3d_Id=n.getUniformLocation(t,"x3d_Id"),this.x3d_LogarithmicFarFactor1_2=n.getUniformLocation(t,"x3d_LogarithmicFarFactor1_2");for(let e=0;e<i;++e)this.x3d_ClipPlane[e]=n.getUniformLocation(t,"x3d_ClipPlane["+e+"]");this.x3d_FogColor=this.getUniformLocation(n,t,"x3d_Fog.color","x3d_FogColor"),this.x3d_FogVisibilityRange=this.getUniformLocation(n,t,"x3d_Fog.visibilityRange","x3d_FogVisibilityRange"),this.x3d_FogMatrix=this.getUniformLocation(n,t,"x3d_Fog.matrix","x3d_FogMatrix"),this.x3d_AlphaCutoff=n.getUniformLocation(t,"x3d_AlphaCutoff"),this.x3d_PointPropertiesPointSizeScaleFactor=n.getUniformLocation(t,"x3d_PointProperties.pointSizeScaleFactor"),this.x3d_PointPropertiesPointSizeMinValue=n.getUniformLocation(t,"x3d_PointProperties.pointSizeMinValue"),this.x3d_PointPropertiesPointSizeMaxValue=n.getUniformLocation(t,"x3d_PointProperties.pointSizeMaxValue"),this.x3d_PointPropertiesAttenuation=n.getUniformLocation(t,"x3d_PointProperties.attenuation"),this.x3d_LinePropertiesLinetype=n.getUniformLocation(t,"x3d_LineProperties.linetype"),this.x3d_LineStippleScale=n.getUniformLocation(t,"x3d_LineProperties.lineStippleScale"),this.x3d_LinePropertiesTexture=n.getUniformLocation(t,"x3d_LineProperties.texture"),this.x3d_FillPropertiesFilled=n.getUniformLocation(t,"x3d_FillProperties.filled"),this.x3d_FillPropertiesHatched=n.getUniformLocation(t,"x3d_FillProperties.hatched"),this.x3d_FillPropertiesHatchColor=n.getUniformLocation(t,"x3d_FillProperties.hatchColor"),this.x3d_FillPropertiesTexture=n.getUniformLocation(t,"x3d_FillProperties.texture"),this.x3d_FillPropertiesScale=n.getUniformLocation(t,"x3d_FillProperties.scale");for(let e=0;e<o;++e)this.x3d_LightType[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].type","x3d_LightType["+e+"]"),this.x3d_LightColor[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].color","x3d_LightColor["+e+"]"),this.x3d_LightAmbientIntensity[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].ambientIntensity","x3d_LightAmbientIntensity["+e+"]"),this.x3d_LightIntensity[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].intensity","x3d_LightIntensity["+e+"]"),this.x3d_LightAttenuation[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].attenuation","x3d_LightAttenuation["+e+"]"),this.x3d_LightLocation[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].location","x3d_LightLocation["+e+"]"),this.x3d_LightDirection[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].direction","x3d_LightDirection["+e+"]"),this.x3d_LightBeamWidth[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].beamWidth","x3d_LightBeamWidth["+e+"]"),this.x3d_LightCutOffAngle[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].cutOffAngle","x3d_LightCutOffAngle["+e+"]"),this.x3d_LightRadius[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].radius","x3d_LightRadius["+e+"]"),this.x3d_LightMatrix[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].matrix","x3d_LightMatrix["+e+"]"),this.x3d_ShadowIntensity[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowIntensity"),this.x3d_ShadowColor[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowColor"),this.x3d_ShadowBias[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowBias"),this.x3d_ShadowMatrix[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowMatrix"),this.x3d_ShadowMapSize[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowMapSize"),this.x3d_ShadowMap[e]=n.getUniformLocation(t,"x3d_ShadowMap["+e+"]");this.x3d_AmbientIntensity=this.getUniformLocation(n,t,"x3d_Material.ambientIntensity","x3d_FrontMaterial.ambientIntensity"),this.x3d_DiffuseColor=this.getUniformLocation(n,t,"x3d_Material.diffuseColor","x3d_FrontMaterial.diffuseColor"),this.x3d_SpecularColor=this.getUniformLocation(n,t,"x3d_Material.specularColor","x3d_FrontMaterial.specularColor"),this.x3d_EmissiveColor=this.getUniformLocation(n,t,"x3d_Material.emissiveColor","x3d_FrontMaterial.emissiveColor"),this.x3d_Shininess=this.getUniformLocation(n,t,"x3d_Material.shininess","x3d_FrontMaterial.shininess"),this.x3d_BaseColor=n.getUniformLocation(t,"x3d_Material.baseColor"),this.x3d_Metallic=n.getUniformLocation(t,"x3d_Material.metallic"),this.x3d_Roughness=n.getUniformLocation(t,"x3d_Material.roughness"),this.x3d_OcclusionStrength=n.getUniformLocation(t,"x3d_Material.occlusionStrength"),this.x3d_NormalScale=n.getUniformLocation(t,"x3d_Material.normalScale"),this.x3d_Transparency=this.getUniformLocation(n,t,"x3d_Material.transparency","x3d_FrontMaterial.transparency");const u=["x3d_AmbientTexture","x3d_DiffuseTexture","x3d_SpecularTexture","x3d_EmissiveTexture","x3d_ShininessTexture","x3d_BaseTexture","x3d_MetallicRoughnessTexture","x3d_OcclusionTexture","x3d_NormalTexture"];for(const e of u)this[e]={textureTransformMapping:n.getUniformLocation(t,e+".textureTransformMapping"),textureCoordinateMapping:n.getUniformLocation(t,e+".textureCoordinateMapping"),texture2D:n.getUniformLocation(t,e+".texture2D"),texture3D:n.getUniformLocation(t,e+".texture3D"),textureCube:n.getUniformLocation(t,e+".textureCube")};this.x3d_MultiTextureColor=n.getUniformLocation(t,"x3d_MultiTextureColor"),this.x3d_TexCoord.length=0;for(let e=0;e<r;++e)this.x3d_TextureCoordinateGeneratorMode[e]=n.getUniformLocation(t,"x3d_TextureCoordinateGenerator["+e+"].mode"),this.x3d_TextureCoordinateGeneratorParameter[e]=n.getUniformLocation(t,"x3d_TextureCoordinateGenerator["+e+"].parameter"),this.x3d_Texture[e]={texture2D:n.getUniformLocation(t,"x3d_Texture2D["+e+"]"),texture3D:n.getUniformLocation(t,"x3d_Texture3D["+e+"]"),textureCube:this.getUniformLocation(n,t,"x3d_TextureCube["+e+"]","x3d_CubeMapTexture["+e+"]")},this.x3d_MultiTextureMode[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].mode"),this.x3d_MultiTextureAlphaMode[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].alphaMode"),this.x3d_MultiTextureSource[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].source"),this.x3d_MultiTextureFunction[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].function"),this.x3d_ProjectiveTexture[e]=n.getUniformLocation(t,"x3d_ProjectiveTexture["+e+"]"),this.x3d_ProjectiveTextureMatrix[e]=n.getUniformLocation(t,"x3d_ProjectiveTextureMatrix["+e+"]"),this.x3d_ProjectiveTextureLocation[e]=n.getUniformLocation(t,"x3d_ProjectiveTextureLocation["+e+"]");for(let e=0;e<s;++e){const i=n.getUniformLocation(t,"x3d_TextureMatrix["+e+"]");null!==i&&(this.x3d_TextureMatrix[e]=i)}for(let e=0;e<a;++e){const i=this.getAttribLocation(n,t,"x3d_TexCoord"+e,e?"":"x3d_TexCoord");-1!==i&&this.x3d_TexCoord.push([e,i])}this.x3d_TexCoordRamp=n.getUniformLocation(t,"x3d_TexCoordRamp"),this.x3d_Viewport=n.getUniformLocation(t,"x3d_Viewport"),this.x3d_ProjectionMatrix=n.getUniformLocation(t,"x3d_ProjectionMatrix"),this.x3d_ModelViewMatrix=n.getUniformLocation(t,"x3d_ModelViewMatrix"),this.x3d_NormalMatrix=n.getUniformLocation(t,"x3d_NormalMatrix"),this.x3d_CameraSpaceMatrix=n.getUniformLocation(t,"x3d_CameraSpaceMatrix");const c=["LineStipple","FogDepth","Color","Normal","Vertex","Particle","ParticleMatrix"];for(const e of c){const i=n.getAttribLocation(t,`x3d_${e}`);this[`x3d_${e}`]=i,i<0?(this[`enable${e}Attribute`]=Function.prototype,this[`${lx.toLowerCaseFirst(e)}AttributeDivisor`]=Function.prototype):(delete this[`enable${e}Attribute`],delete this[`${lx.toLowerCaseFirst(e)}AttributeDivisor`])}0===this.x3d_TexCoord.length?(this.enableTexCoordAttribute=Function.prototype,this.texCoordAttributeDivisor=Function.prototype):(delete this.enableTexCoordAttribute,delete this.texCoordAttributeDivisor),n.uniform1i(this.x3d_LinePropertiesTexture,e.getDefaultTexture2DUnit()),n.uniform1i(this.x3d_FillPropertiesTexture,e.getDefaultTexture2DUnit());for(const t of u)n.uniform1i(this[t].texture2D,e.getDefaultTexture2DUnit()),n.uniform1i(this[t].texture3D,e.getDefaultTexture3DUnit()),n.uniform1i(this[t].textureCube,e.getDefaultTextureCubeUnit());for(const t of this.x3d_Texture)n.uniform1i(t.texture2D,e.getDefaultTexture2DUnit()),n.getVersion()>=2&&n.uniform1i(t.texture3D,e.getDefaultTexture3DUnit()),n.uniform1i(t.textureCube,e.getDefaultTextureCubeUnit());for(const t of this.x3d_ShadowMap)n.uniform1i(t,e.getDefaultTexture2DUnit());for(const t of this.x3d_ProjectiveTexture)n.uniform1i(t,e.getDefaultTexture2DUnit());n.uniform1i(this.x3d_TexCoordRamp,e.getDefaultTexture2DUnit())},getUniformLocation:function(t,e,n,i){let o=t.getUniformLocation(e,n);return o||(i?(o=t.getUniformLocation(e,i),o&&console.warn(this.getTypeName(),this.getName(),"Using uniform location name '"+i+"' is depreciated, use '"+n+"'. See https://create3000.github.io/x_ite/custom-shaders."),o):0)},getAttribLocation:function(t,e,n,i){let o=t.getAttribLocation(e,n);return o>=0?o:i?(o=t.getAttribLocation(e,i),o>=0&&console.warn(this.getTypeName(),this.getName(),"Using attribute location name '"+i+"' is depreciated, use '"+n+"'. See https://create3000.github.io/x_ite/custom-shaders."),o):-1},addShaderFields:function(){const t=this.getProgram(),e=this.getBrowser().getContext();e.useProgram(t),this.textures.clear();for(const n of this.getUserDefinedFields()){const i=e.getUniformLocation(t,n.getName());if(i){switch(n.getType()){case c.SFImage:i.array=new Int32Array(3+n.array.length);break;case c.SFMatrix3d:case c.SFMatrix3f:case c.SFRotation:i.array=new Float32Array(9);break;case c.SFMatrix4d:case c.SFMatrix4f:i.array=new Float32Array(16);break;case c.SFNode:break;case c.MFBool:case c.MFInt32:i.array=new Int32Array(this.getLocationLength(e,t,n));break;case c.MFFloat:case c.MFDouble:case c.MFTime:i.array=new Float32Array(this.getLocationLength(e,t,n));break;case c.MFImage:i.array=new Int32Array(this.getImagesLength(n));break;case c.MFMatrix3d:case c.MFMatrix3f:case c.MFRotation:i.array=new Float32Array(9*this.getLocationLength(e,t,n));break;case c.MFMatrix4d:case c.MFMatrix4f:i.array=new Float32Array(16*this.getLocationLength(e,t,n));break;case c.MFNode:{const o=i.locations=[];for(let i=0;;++i){const r=e.getUniformLocation(t,n.getName()+"["+i+"]");if(!r)break;o.push(r)}break}case c.MFVec2d:case c.MFVec2f:i.array=new Float32Array(2*this.getLocationLength(e,t,n));break;case c.MFVec3d:case c.MFVec3f:case c.MFColor:i.array=new Float32Array(3*this.getLocationLength(e,t,n));break;case c.MFVec4d:case c.MFVec4f:case c.MFColorRGBA:i.array=new Float32Array(4*this.getLocationLength(e,t,n))}i.array?n[hx]=i.array.length?i:null:n[hx]=i,n.addInterest("set_field__",this),this.set_field__(n)}}},removeShaderFields:function(){for(const t of this.getUserDefinedFields())t.removeInterest("set_field__",this)},set_field__:function(){const t=new Float32Array(9);return function(e){const n=this.getProgram(),i=this.getBrowser().getContext(),o=e[hx];if(i.useProgram(n),o)switch(e.getType()){case c.SFBool:case c.SFInt32:return void i.uniform1i(o,e.getValue());case c.SFColor:{const t=e.getValue();return void i.uniform3f(o,t.r,t.g,t.b)}case c.SFColorRGBA:{const t=e.getValue();return void i.uniform4f(o,t.r,t.g,t.b,t.a)}case c.SFDouble:case c.SFFloat:case c.SFTime:return void i.uniform1f(o,e.getValue());case c.SFImage:{let t=o.array;const n=e.array,r=3+n.length;r!==t.length&&(t=o.array=new Int32Array(r)),t[0]=e.width,t[1]=e.height,t[2]=e.comp;for(let e=3,i=0,o=n.length;i<o;++i,++e)t[e]=n[i];return void i.uniform1iv(o,t)}case c.SFMatrix3d:case c.SFMatrix3f:return o.array.set(e.getValue()),void i.uniformMatrix3fv(o,!1,o.array);case c.SFMatrix4d:case c.SFMatrix4f:return o.array.set(e.getValue()),void i.uniformMatrix4fv(o,!1,o.array);case c.SFNode:{const t=rc(c.X3DTextureNode,e);return void(t?(o.name=e.getName(),o.texture=t,this.textures.add(o)):this.textures.delete(o))}case c.SFRotation:return e.getValue().getMatrix(o.array),void i.uniformMatrix3fv(o,!1,o.array);case c.SFString:return;case c.SFVec2d:case c.SFVec2f:{const t=e.getValue();return void i.uniform2f(o,t.x,t.y)}case c.SFVec3d:case c.SFVec3f:{const t=e.getValue();return void i.uniform3f(o,t.x,t.y,t.z)}case c.SFVec4d:case c.SFVec4f:{const t=e.getValue();return void i.uniform4f(o,t.x,t.y,t.z,t.w)}case c.MFBool:case c.MFInt32:{const t=o.array;for(var r=0,s=e.length;r<s;++r)t[r]=e[r];for(let e=t.length;r<e;++r)t[r]=0;return void i.uniform1iv(o,t)}case c.MFColor:{const t=o.array;r=0;var a=0;for(s=e.length;r<s;++r){const n=e[r];t[a++]=n.r,t[a++]=n.g,t[a++]=n.b}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform3fv(o,t)}case c.MFColorRGBA:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];t[a++]=n.r,t[a++]=n.g,t[a++]=n.b,t[a++]=n.a}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform4fv(o,t)}case c.MFDouble:case c.MFFloat:case c.MFTime:{const t=o.array;for(r=0,s=e.length;r<s;++r)t[r]=e[r];for(let e=t.length;r<e;++r)t[r]=0;return void i.uniform1fv(o,t)}case c.MFImage:{const t=o.array;for(let n=0,i=0,o=e.length;n<o;++n){const o=e[n],r=o.array;t[i++]=o.width,t[i++]=o.height,t[i++]=o.comp;for(let e=0,n=r.length;e<n;++e)t[i++]=r[e]}return void i.uniform1iv(o,t)}case c.MFMatrix3d:case c.MFMatrix3f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];for(let e=0;e<9;++e)t[a++]=n[e]}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniformMatrix3fv(o,!1,t)}case c.MFMatrix4d:case c.MFMatrix4f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];for(let e=0;e<16;++e)t[a++]=n[e]}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniformMatrix4fv(o,!1,t)}case c.MFNode:{const t=o.locations;for(let n=0,i=e.length;n<i;++n){const i=rc(c.X3DTextureNode,e[n]);i?(t[n].name=e.getName(),t[n].texture=i,this.textures.add(t[n])):this.textures.delete(t[n])}return}case c.MFRotation:{const n=o.array;for(r=0,a=0,s=e.length;r<s;++r)e[r].getValue().getMatrix(t),n[a++]=t[0],n[a++]=t[1],n[a++]=t[2],n[a++]=t[3],n[a++]=t[4],n[a++]=t[5],n[a++]=t[6],n[a++]=t[7],n[a++]=t[8];for(let t=n.length;a<t;++a)n[a]=0;return void i.uniformMatrix3fv(o,!1,n)}case c.MFString:return;case c.MFVec2d:case c.MFVec2f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];t[a++]=n.x,t[a++]=n.y}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform2fv(o,t)}case c.MFVec3d:case c.MFVec3f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];t[a++]=n.x,t[a++]=n.y,t[a++]=n.z}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform3fv(o,t)}case c.MFVec4d:case c.MFVec4f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];t[a++]=n.x,t[a++]=n.y,t[a++]=n.z,t[a++]=n.w}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform4fv(o,t)}}}}(),getImagesLength:function(t){const e=t.getValue();let n=3*e.length;for(const t of e)n+=t.array.length;return n},getLocationLength:function(t,e,n){const i=n.getName();for(let n=0;;++n){if(!t.getUniformLocation(e,i+"["+n+"]"))return n}},hasFog:function(t){return this.fogNode===t||(this.fogNode=t,!1)},hasLight:function(t,e){return this.lightNodes[t]===e||(this.lightNodes[t]=e,!1)},hasTextureProjector:function(t,e){return this.projectiveTextureNodes[t]===e||(this.projectiveTextureNodes[t]=e,!1)},setClipPlanes:function(t,e){this.numClipPlanes=0;for(const n of e)n.setShaderUniforms(t,this)},setUniforms:function(){const t=new Float32Array(9);return function(e,n,i,o=!0){const r=i.renderObject,s=i.fogNode,a=i.appearanceNode,u=a.getStyleProperties(n.geometryType),c=o?a.getMaterial():a.getBackMaterial(),l=i.textureNode||a.getTexture(),h=i.modelViewMatrix;if(this.renderTime!==r.getRenderTime()){this.renderTime=r.getRenderTime(),e.uniform4iv(this.x3d_Viewport,r.getViewportArray()),e.uniformMatrix4fv(this.x3d_ProjectionMatrix,!1,r.getProjectionMatrixArray()),e.uniformMatrix4fv(this.x3d_CameraSpaceMatrix,!1,r.getCameraSpaceMatrixArray()),this.fogNode=null,this.numLights=0,this.numProjectiveTextures=0,this.lightNodes.length=0,this.projectiveTextureNodes.length=0;const t=r.getGlobalObjects();for(const n of t)n.setShaderUniforms(e,this,r);this.numGlobalLights=this.numLights,this.numGlobalProjectiveTextures=this.numProjectiveTextures;const n=r.getViewpoint();if(this.logarithmicDepthBuffer||n.getLogarithmicDepthBuffer()){const t=r.getNavigationInfo();e.uniform1f(this.x3d_LogarithmicFarFactor1_2,1/Math.log2(t.getFarValue(n)+1))}}e.uniformMatrix4fv(this.x3d_ModelViewMatrix,!1,h),n.hasNormals&&(t[0]=h[0],t[3]=h[1],t[6]=h[2],t[1]=h[4],t[4]=h[5],t[7]=h[6],t[2]=h[8],t[5]=h[9],t[8]=h[10],Re.prototype.inverse.call(t),e.uniformMatrix3fv(this.x3d_NormalMatrix,!1,t)),s?.setShaderUniforms(e,this),this.numClipPlanes=0,this.numLights=this.numGlobalLights,this.numProjectiveTextures=this.numGlobalProjectiveTextures;for(const t of i.localObjects)t.setShaderUniforms(e,this,r);e.uniform1f(this.x3d_AlphaCutoff,a.getAlphaCutoff()),u?.setShaderUniforms(e,this),c.setShaderUniforms(e,this,r,a.getTextureTransformMapping(),n.getTextureCoordinateMapping(),o),l?.setShaderUniforms(e,this,r),a.getTextureTransform().setShaderUniforms(e,this),n.getTextureCoordinate().setShaderUniforms(e,this)}}(),enable:function(t){t.useProgram(this.getProgram());for(const e of this.textures){const n=e.texture,i=this.getBrowser().getTextureUnit(n.getTextureType());if(void 0===i)return void console.warn("Not enough combined texture units for uniform variable '"+e.name+"' available.");t.activeTexture(t.TEXTURE0+i),t.bindTexture(n.getTarget(),n.getTexture()),t.uniform1i(e,i)}},enableFloatAttrib:function(t,e,n,i,o,r){const s=t.getAttribLocation(this.getProgram(),e);-1!==s&&(t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,i,t.FLOAT,!1,o,r))},enableMatrix3Attrib:function(t,e,n,i,o){const r=t.getAttribLocation(this.getProgram(),e);if(-1!==r){i=i||36,t.bindBuffer(t.ARRAY_BUFFER,n);for(let e=0;e<3;++e){const n=r+e;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,3,t.FLOAT,!1,i,o+12*e)}}},enableMatrix4Attrib:function(t,e,n,i,o){const r=t.getAttribLocation(this.getProgram(),e);if(-1!==r){i=i||64,t.bindBuffer(t.ARRAY_BUFFER,n);for(let e=0;e<4;++e){const n=r+e;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,!1,i,o+16*e)}}},enableLineStippleAttribute:function(t,e,n,i){const o=this.x3d_LineStipple;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,3,t.FLOAT,!1,n,i)},enableFogDepthAttribute:function(t,e,n,i){const o=this.x3d_FogDepth;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,1,t.FLOAT,!1,n,i)},enableColorAttribute:function(t,e,n,i){const o=this.x3d_Color;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,n,i)},colorAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Color,e)},enableTexCoordAttribute:function(t,e,n,i){for(const[o,r]of this.x3d_TexCoord)t.bindBuffer(t.ARRAY_BUFFER,e[o]),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,n,i)},texCoordAttributeDivisor:function(t,e){for(const[n,i]of this.x3d_TexCoord)t.vertexAttribDivisor(i,e)},enableNormalAttribute:function(t,e,n,i){const o=this.x3d_Normal;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,3,t.FLOAT,!1,n,i)},normalAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Normal,e)},enableVertexAttribute:function(t,e,n,i){const o=this.x3d_Vertex;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,n,i)},vertexAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Vertex,e)},enableParticleAttribute:function(t,e,n,i,o){const r=this.x3d_Particle;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,n,i),t.vertexAttribDivisor(r,o)},enableParticleMatrixAttribute:function(t,e,n,i,o){const r=this.x3d_ParticleMatrix;n=n||64,t.bindBuffer(t.ARRAY_BUFFER,e);for(let e=0;e<4;++e){const s=r+e;t.enableVertexAttribArray(s),t.vertexAttribPointer(s,4,t.FLOAT,!1,n,i+16*e),t.vertexAttribDivisor(s,o)}},getProgramInfo:function(){function t(t,e){return t<e?-1:t>e?1:0}const e=this.getProgram(),n=this.getBrowser().getContext(),i={attributes:[],uniforms:[],attributeCount:0,uniformCount:0},o=n.getProgramParameter(e,n.ACTIVE_UNIFORMS),r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES),s={35664:"vec2",35665:"vec3",35666:"vec4",35667:"ivec2",35668:"ivec3",35669:"ivec4",35670:"bool",35671:"bvec2",35672:"bvec3",35673:"bvec4",35674:"mat2",35675:"mat3",35676:"mat4",35678:"sampler2D",35680:"samplerCube",5120:"byte",5121:"ubyte",5122:"short",5123:"ushort",5124:"int",5125:"uint",5126:"float"};for(let t=0;t<o;++t){const o=n.getActiveUniform(e,t);o.typeName=s[o.type],i.uniforms.push(Object.assign({},o)),i.uniformCount+=o.size}for(let t=0;t<r;++t){const o=n.getActiveAttrib(e,t);o.typeName=s[o.type],i.attributes.push(Object.assign({},o)),i.attributeCount+=o.size}return i.uniforms.sort((function(e,n){return t(e.name,n.name)})),i.attributes.sort((function(e,n){return t(e.name,n.name)})),i},printProgramInfo:function(){const t=this.getProgramInfo();console.log(this.getName()),console.table(t.attributes),console.log(this.getName(),"attributeCount",t.attributeCount),console.log(this.getName()),console.table(t.uniforms),console.log(this.getName(),"uniformCount",t.uniformCount)},dispose:function(){}};const px=dx;n.set("x_ite/Components/Shaders/X3DProgrammableShaderObject",px);const fx=px;function gx(t){Ec.call(this,t),this.addType(c.X3DNetworkSensorNode)}gx.prototype=Object.assign(Object.create(Ec.prototype),{constructor:gx});const mx=gx;n.set("x_ite/Components/Networking/X3DNetworkSensorNode",mx);const _x=mx;function xx(t){_x.call(this,t),this.addType(c.LoadSensor),t.getSpecificationVersion()<4&&this.addAlias("watchList",this._children),this.urlObjects=[],this.aborted=!1,this.timeOutId=void 0}xx.prototype=Object.assign(Object.create(_x.prototype),{constructor:xx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"timeOut",new ji.SFTime),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"isLoaded",new ji.SFBool),new k(c.outputOnly,"progress",new ji.SFFloat),new k(c.outputOnly,"loadTime",new ji.SFTime),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"LoadSensor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){_x.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._timeOut.addInterest("set_timeOut__",this),this._children.addInterest("set_children__",this),this.set_children__()},set_enabled__:function(){this._enabled.getValue()?this.reset():(this.abort(),this.remove())},set_timeOut__:function(){this._isActive.getValue()&&(this.clearTimeout(),this.aborted=!1,this._timeOut.getValue()>0&&(this.timeOutId=setTimeout(this.abort.bind(this),1e3*this._timeOut.getValue())))},set_children__:function(){this.reset()},set_loadState__:function(t){switch(t.checkLoadState()){case c.NOT_STARTED_STATE:break;case c.IN_PROGRESS_STATE:case c.COMPLETE_STATE:case c.FAILED_STATE:this.count()}},count:function(){const t=this.urlObjects;if(t.length){let e=0,n=0;for(const i of t)e+=i.checkLoadState()==c.COMPLETE_STATE,n+=i.checkLoadState()==c.FAILED_STATE;const i=e===t.length,o=e/t.length;this.aborted||n||i?(this.clearTimeout(),this._isActive=!1,this._isLoaded=i,this._progress=o,i&&(this._loadTime=this.getBrowser().getCurrentTime())):this._isActive.getValue()?this._progress=o:(this._isActive=!0,this._progress=o,this.set_timeOut__())}else this._isActive=!1,this._isLoaded=!1,this._progress=0},abort:function(){this.clearTimeout(),this.aborted=!0,this._enabled.getValue()&&this.count()},reset:function(){if(this.remove(),!this._enabled.getValue())return;const t=this.urlObjects;for(const e of this._children){const n=rc(c.X3DUrlObject,e);n&&(t.push(n),n._loadState.addInterest("set_loadState__",this,n))}this.count()},remove:function(){this.clearTimeout();const t=this.urlObjects;for(const e of t)e._loadState.removeInterest("set_loadState__",this);t.length=0},clearTimeout:function(){clearTimeout(this.timeOutId),this.timeOutId=void 0}});const yx=xx;n.set("x_ite/Components/Networking/LoadSensor",yx);const wx=yx;function Sx(t){cx.call(this,t),fx.call(this,t),this.addType(c.ComposedShader),this.loadSensor=new wx(t),this.transformFeedbackVaryings=[]}Sx.prototype=Object.assign(Object.create(cx.prototype),fx.prototype,{constructor:Sx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"activate",new ji.SFBool),new k(c.outputOnly,"isSelected",new ji.SFBool),new k(c.outputOnly,"isValid",new ji.SFBool),new k(c.initializeOnly,"language",new ji.SFString),new k(c.inputOutput,"parts",new ji.MFNode)]),wireframe:!1,getTypeName:function(){return"ComposedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){cx.prototype.initialize.call(this),fx.prototype.initialize.call(this),this._activate.addInterest("set_activate__",this),this._parts.addFieldInterest(this.loadSensor._children),this.loadSensor._isLoaded.addInterest("connectLoaded",this),this.loadSensor._children=this._parts,this.loadSensor.setPrivate(!0),this.loadSensor.setup(),this.loadSensor._isLoaded.getValue()?this.set_loaded__():this.connectLoaded()},connectLoaded:function(){this.loadSensor._isLoaded.removeInterest("connectLoaded",this),this.loadSensor._isLoaded.addInterest("set_loaded__",this)},addUserDefinedField:function(t,e,n){const i=this.isInitialized()&&this.isValid();i&&this.removeShaderFields(),cx.prototype.addUserDefinedField.call(this,t,e,n),i&&this.addShaderFields()},removeUserDefinedField:function(t){const e=this.isInitialized()&&this.isValid();e&&this.removeShaderFields(),cx.prototype.removeUserDefinedField.call(this,t),e&&this.addShaderFields()},setTransformFeedbackVaryings:function(t){this.transformFeedbackVaryings=t},getProgram:function(){return this.program},set_activate__:function(){this._activate.getValue()&&this.set_loaded__()},set_loaded__:function(){if(this.loadSensor._isLoaded.getValue()&&"GLSL"===this._language.getValue()){const t=this.getBrowser().getContext(),e=t.createProgram();this.isValid()&&this.removeShaderFields(),t.deleteProgram(this.program),this.program=e;for(const n of this._parts){const i=rc(c.ShaderPart,n);i?.getShader()&&t.attachShader(e,i.getShader())}this.transformFeedbackVaryings.length&&t.transformFeedbackVaryings(e,this.transformFeedbackVaryings,t.INTERLEAVED_ATTRIBS),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?(this.setValid(!0),this.getDefaultUniformsAndAttributes(),this.addShaderFields()):(this.setValid(!1),this._parts.length&&console.warn("Couldn't initialize "+this.getTypeName()+" '"+this.getName()+"': "+t.getProgramInfoLog(e)))}else this.setValid(!1)},dispose:function(){fx.prototype.dispose.call(this),cx.prototype.dispose.call(this)}});const Tx=Sx;n.set("x_ite/Components/Shaders/ComposedShader",Tx);const bx=Tx,vx="\n#if defined (X3D_FOG)\nstruct x3d_FogParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float visibilityRange;\n   mediump mat3  matrix;\n};\n#endif\n\n//uniform x3d_FogParameters x3d_Fog;\n\n#if defined (X3D_LIGHTING)\nstruct x3d_LightSourceParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float intensity;\n   mediump float ambientIntensity;\n   mediump vec3  attenuation;\n   mediump vec3  location;\n   mediump vec3  direction;\n   mediump float radius;\n   mediump float beamWidth;\n   mediump float cutOffAngle;\n   mediump mat3  matrix;\n   #if defined (X3D_SHADOWS)\n   mediump vec3  shadowColor;\n   mediump float shadowIntensity;\n   mediump float shadowBias;\n   mediump mat4  shadowMatrix;\n   mediump int   shadowMapSize;\n   #endif\n};\n#endif\n\n//uniform x3d_LightSourceParameters x3d_LightSource [x3d_MaxLights];\n\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_PointPropertiesParameters\n{\n   mediump float pointSizeScaleFactor;\n   mediump float pointSizeMinValue;\n   mediump float pointSizeMaxValue;\n   mediump vec3  attenuation;\n};\n#endif\n\n//uniform x3d_PointPropertiesParameters x3d_PointProperties;\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_LinePropertiesParameters\n{\n   mediump int   linetype;\n   mediump float lineStippleScale;\n   sampler2D     texture;\n};\n#endif\n\n//uniform x3d_LinePropertiesParameters x3d_LineProperties;\n\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_FillPropertiesParameters\n{\n   bool          filled;\n   bool          hatched;\n   mediump vec3  hatchColor;\n   sampler2D     texture;\n   mediump float scale;\n};\n#endif\n\n//uniform x3d_FillPropertiesParameters x3d_FillProperties;\n\n#if defined (X3D_UNLIT_MATERIAL)\nstruct x3d_UnlitMaterialParameters\n{\n   mediump vec3  emissiveColor;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_MATERIAL)\nstruct x3d_MaterialParameters\n{\n   mediump float ambientIntensity;\n   mediump vec3  diffuseColor;\n   mediump vec3  specularColor;\n   mediump vec3  emissiveColor;\n   mediump float shininess;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_PHYSICAL_MATERIAL)\nstruct x3d_PhysicalMaterialParameters\n{\n   mediump vec3  baseColor;\n   mediump vec3  emissiveColor;\n   mediump float metallic;\n   mediump float roughness;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (X3D_AMBIENT_TEXTURE)\nstruct x3d_AmbientTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_AMBIENT_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nstruct x3d_DiffuseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_DIFFUSE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n\n#if defined (X3D_SPECULAR_TEXTURE)\nstruct x3d_SpecularTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SPECULAR_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nstruct x3d_EmissiveTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_EMISSIVE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n\n#if defined (X3D_SHININESS_TEXTURE)\nstruct x3d_ShininessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SHININESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n\n#if defined (X3D_BASE_TEXTURE)\nstruct x3d_BaseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_BASE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_BaseTextureParameters x3d_BaseTexture;\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nstruct x3d_MetallicRoughnessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nstruct x3d_OcclusionTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_OCCLUSION_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n\n#if defined (X3D_NORMAL_TEXTURE)\nstruct x3d_NormalTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_NORMAL_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_NormalTextureParameters x3d_NormalTexture;\n\n#if defined (X3D_MULTI_TEXTURING)\nstruct x3d_MultiTextureParameters\n{\n   mediump int mode;\n   mediump int alphaMode;\n   mediump int source;\n   mediump int function;\n};\n#endif\n\n//uniform x3d_MultiTextureParameters x3d_MultiTexture [x3d_MaxTextures];\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nstruct x3d_TextureCoordinateGeneratorParameters\n{\n   mediump int   mode;\n   mediump float parameter [6];\n};\n#endif\n\n//uniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [x3d_MaxTextures];\n";n.set("assets/shaders/Types.glsl",vx);const Ex=vx;let Cx=0;const Ox={REPLACE:Cx++,MODULATE:Cx++,MODULATE2X:Cx++,MODULATE4X:Cx++,ADD:Cx++,ADDSIGNED:Cx++,ADDSIGNED2X:Cx++,ADDSMOOTH:Cx++,SUBTRACT:Cx++,BLENDDIFFUSEALPHA:Cx++,BLENDTEXTUREALPHA:Cx++,BLENDFACTORALPHA:Cx++,BLENDCURRENTALPHA:Cx++,MODULATEALPHA_ADDCOLOR:Cx++,MODULATEINVALPHA_ADDCOLOR:Cx++,MODULATEINVCOLOR_ADDALPHA:Cx++,DOTPRODUCT3:Cx++,SELECTARG1:Cx++,SELECTARG2:Cx++,OFF:Cx++};n.set("x_ite/Browser/Texturing/ModeType",Ox);const Nx=Ox;let Fx=0;const Ix={DEFAULT:Fx++,DIFFUSE:Fx++,SPECULAR:Fx++,FACTOR:Fx++};n.set("x_ite/Browser/Texturing/SourceType",Ix);const Mx=Ix;let Dx=0;const Rx={DEFAULT:Dx++,COMPLEMENT:Dx++,ALPHAREPLICATE:Dx++};n.set("x_ite/Browser/Texturing/FunctionType",Rx);const Vx=Rx;let Ax=0;const Px={NONE:Ax++,SPHERE:Ax++,CAMERASPACENORMAL:Ax++,CAMERASPACEPOSITION:Ax++,CAMERASPACEREFLECTIONVECTOR:Ax++,SPHERE_LOCAL:Ax++,COORD:Ax++,COORD_EYE:Ax++,NOISE:Ax++,NOISE_EYE:Ax++,SPHERE_REFLECT:Ax++,SPHERE_REFLECT_LOCAL:Ax++};n.set("x_ite/Browser/Texturing/TextureCoordinateGeneratorModeType",Px);const Lx=Px;const Bx={getSource:function(t,e,n,i){const o="\\s+|/\\*[\\s\\S]*?\\*/|//.*?\\n",r="#line\\s+.*?\\n|#if\\s+.*?\\n|#elif\\s+.*?\\n|#ifdef\\s+.*?\\n|#ifndef\\s+.*?\\n|#else.*?\\n|#endif.*?\\n|#define\\s+(?:[^\\n\\\\]|\\\\[^\\r\\n]|\\\\\\r?\\n)*\\n|#undef\\s+.*?\\n|#pragma\\s+.*?\\n",s=new RegExp("^((?:"+o+"|"+r+")*(?:#version\\s+.*?\\n)?(?:"+o+"|"+r+"|#extension\\s+.*?\\n)*)([\\s\\S]*)$"),a=n.match(s);if(!a)return n;let u="";u+="#define X_ITE\n",t.HAS_FEATURE_DEPTH_TEXTURE&&(u+="#define X3D_DEPTH_TEXTURE\n");for(const t of i)u+="#define "+t+"\n";let c="";c+="#define x3d_None 0\n",c+="#define x3d_Points      0\n",c+="#define x3d_Lines       1\n",c+="#define x3d_Geometry2D  2\n",c+="#define x3d_Geometry3D  3\n",c+="#define x3d_MaxClipPlanes  "+e.getMaxClipPlanes()+"\n",c+="#define x3d_LinearFog        1\n",c+="#define x3d_ExponentialFog   2\n",c+="#define x3d_Exponential2Fog  3\n",c+="#define x3d_MaxLights         "+e.getMaxLights()+"\n",c+="#define x3d_DirectionalLight  1\n",c+="#define x3d_PointLight        2\n",c+="#define x3d_SpotLight         3\n",c+="#define x3d_MaxTextures      "+e.getMaxTextures()+"\n",c+="#define x3d_TextureType2D    2\n",c+="#define x3d_TextureType3D    3\n",c+="#define x3d_TextureTypeCube  4\n",c+="#define x3d_Replace                   "+Nx.REPLACE+"\n",c+="#define x3d_Modulate                  "+Nx.MODULATE+"\n",c+="#define x3d_Modulate2X                "+Nx.MODULATE2X+"\n",c+="#define x3d_Modulate4X                "+Nx.MODULATE4X+"\n",c+="#define x3d_Add                       "+Nx.ADD+"\n",c+="#define x3d_AddSigned                 "+Nx.ADDSIGNED+"\n",c+="#define x3d_AddSigned2X               "+Nx.ADDSIGNED2X+"\n",c+="#define x3d_AddSmooth                 "+Nx.ADDSMOOTH+"\n",c+="#define x3d_Subtract                  "+Nx.SUBTRACT+"\n",c+="#define x3d_BlendDiffuseAlpha         "+Nx.BLENDDIFFUSEALPHA+"\n",c+="#define x3d_BlendTextureAlpha         "+Nx.BLENDTEXTUREALPHA+"\n",c+="#define x3d_BlendFactorAlpha          "+Nx.BLENDFACTORALPHA+"\n",c+="#define x3d_BlendCurrentAlpha         "+Nx.BLENDCURRENTALPHA+"\n",c+="#define x3d_ModulateAlphaAddColor     "+Nx.MODULATEALPHA_ADDCOLOR+"\n",c+="#define x3d_ModulateInvAlphaAddColor  "+Nx.MODULATEINVALPHA_ADDCOLOR+"\n",c+="#define x3d_ModulateInvColorAddAlpha  "+Nx.MODULATEINVCOLOR_ADDALPHA+"\n",c+="#define x3d_DotProduct3               "+Nx.DOTPRODUCT3+"\n",c+="#define x3d_SelectArg1                "+Nx.SELECTARG1+"\n",c+="#define x3d_SelectArg2                "+Nx.SELECTARG2+"\n",c+="#define x3d_Off                       "+Nx.OFF+"\n",c+="#define x3d_Diffuse  "+Mx.DIFFUSE+"\n",c+="#define x3d_Specular "+Mx.SPECULAR+"\n",c+="#define x3d_Factor   "+Mx.FACTOR+"\n",c+="#define x3d_Complement     "+Vx.COMPLEMENT+"\n",c+="#define x3d_AlphaReplicate "+Vx.ALPHAREPLICATE+"\n",c+="#define x3d_Sphere                      "+Lx.SPHERE+"\n",c+="#define x3d_CameraSpaceNormal           "+Lx.CAMERASPACENORMAL+"\n",c+="#define x3d_CameraSpacePosition         "+Lx.CAMERASPACEPOSITION+"\n",c+="#define x3d_CameraSpaceReflectionVector "+Lx.CAMERASPACEREFLECTIONVECTOR+"\n",c+="#define x3d_SphereLocal                 "+Lx.SPHERE_LOCAL+"\n",c+="#define x3d_Coord                       "+Lx.COORD+"\n",c+="#define x3d_CoordEye                    "+Lx.COORD_EYE+"\n",c+="#define x3d_Noise                       "+Lx.NOISE+"\n",c+="#define x3d_NoiseEye                    "+Lx.NOISE_EYE+"\n",c+="#define x3d_SphereReflect               "+Lx.SPHERE_REFLECT+"\n",c+="#define x3d_SphereReflectLocal          "+Lx.SPHERE_REFLECT_LOCAL+"\n",c+="#define x3d_GeometryPoints  0\n",c+="#define x3d_GeometryLines   1\n",c+="#define x3d_NoneClipPlane   vec4 (88.0, 51.0, 68.0, 33.0)\n",c+="#define x3d_NoneFog         0\n",c+="#define x3d_NoneLight       0\n",c+="#define x3d_NoneTexture     0\n";const l=n.match(/\s*precision\s+(lowp|mediump|highp)\s+float\s*;/),h=n.match(/\s*precision\s+(lowp|mediump|highp)\s+int\s*;/),d=l?l[1]:"mediump",p=h?h[1]:"mediump",f=Ex.replace(/mediump\s+(float|vec2|vec3|mat3|mat4)/g,d+" $1").replace(/mediump\s+(int)/g,p+" $1"),g=(a[1].match(/\n/g)||[]).length+1;return a[1]+u+c+f+"#line "+(g+1)+" -1\n"+a[2]}};n.set("x_ite/Browser/Shaders/ShaderSource",Bx);const Xx=Bx,Ux=/^\s*#pragma\s+X3D\s+include\s+".*?([^\/]+)\.glsl"\s*$/;function kx(t){this.includes=sx.includes[t.getVersion()],this.sourceFileNumbers={};for(const[t,e]of Object.getOwnPropertyNames(this.includes).entries())this.sourceFileNumbers[e]=t+1}kx.prototype={getSourceFileName:function(t){return Object.getOwnPropertyNames(this.includes)[t-1]},process:function(t,e=0){const n=t.split("\n");t="";for(let i=0,o=n.length;i<o;++i){const o=n[i],r=o.match(Ux);r?(t+="#line 1 "+this.sourceFileNumbers[r[1]]+"\n",t+=this.process(this.includes[r[1]],this.sourceFileNumbers[r[1]]),t+="\n",t+="#line "+(i+2)+" "+e+"\n"):(t+=o,t+="\n")}return t}};const zx=kx;n.set("x_ite/Browser/Shaders/ShaderCompiler",zx);const jx=zx;var Gx=i(532);const Hx=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D","X3D_FOG","X3D_STYLE_PROPERTIES","X3D_UNLIT_MATERIAL","X3D_MATERIAL","X3D_LIGHTING","X3D_TEXTURE","X3D_MULTI_TEXTURING"];function qx(t){dr.call(this,t),es.call(this,t),this.addType(c.ShaderPart),this.options=[]}qx.prototype=Object.assign(Object.create(dr.prototype),es.prototype,{constructor:qx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.initializeOnly,"type",new ji.SFString("VERTEX")),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600))]),getTypeName:function(){return"ShaderPart"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"parts"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){dr.prototype.initialize.call(this),es.prototype.initialize.call(this),this.isPrivate()||(this.options=Hx.slice()),this._type.addInterest("set_type__",this),this.requestImmediateLoad().catch(Function.prototype)},set_type__:function(){this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad().catch(Function.prototype)},getSourceText:function(){return this._url},getOptions:function(){return this.options},setOptions:function(t){this.options=t},getShader:function(){return this.shader},getShaderType:function(){const t=new Map([["VERTEX","VERTEX_SHADER"],["TESS_CONTROL","TESS_CONTROL_SHADER"],["TESS_EVALUATION","TESS_EVALUATION_SHADER"],["GEOMETRY","GEOMETRY_SHADER"],["FRAGMENT","FRAGMENT_SHADER"],["COMPUTE","COMPUTE_SHADER"]]);return function(){return t.get(this._type.getValue())||"VERTEX_SHADER"}}(),unloadData:function(){this.valid=!1},loadData:function(){new Cl(this).loadDocument(this._url,function(t,e){if(null===t)this.setLoadState(c.FAILED_STATE);else{const n=this.getBrowser(),i=n.getContext(),o=this.getShaderType(),r=["X3D_"+o].concat(this.options),s=new jx(i),a=Xx.getSource(i,n,s.process(Gx.decodeText(t)),r),u=i.createShader(i[o]);if(i.deleteShader(this.shader),this.shader=u,i.shaderSource(u,a),i.compileShader(u),!i.getShaderParameter(u,i.COMPILE_STATUS)){const t=this.getTypeName(),n=this.getName(),o=i.getShaderInfoLog(u),r=o.match(/(\d+):(\d+)/);if(r){const i=s.getSourceFileName(r[1])||e||this.getExecutionContext().getWorldURL();throw new Error("Error in "+t+" '"+n+"' in URL '"+i+"', line "+r[2]+", "+o)}{const i=e||this.getExecutionContext().getWorldURL();throw new Error("Error in "+t+" '"+n+"' in URL '"+i+"', "+o)}}this.setLoadState(c.COMPLETE_STATE)}}.bind(this))},dispose:function(){es.prototype.dispose.call(this),dr.prototype.dispose.call(this)}});const Yx=qx;n.set("x_ite/Components/Shaders/ShaderPart",Yx);const Wx=Yx,Kx=Symbol(),Jx=Symbol(),Zx=Symbol();function Qx(){this[Kx]=!1,this[Jx]=new Map,this[Zx]=new Map}Qx.prototype={initialize:function(){this.setShading(this.getBrowserOptions().getShading())},getShadingLanguageVersion:function(){const t=this.getContext();return t.getParameter(t.SHADING_LANGUAGE_VERSION)},getMaxVertexUniformVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)},getMaxFragmentUniformVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS)},getMaxVertexAttribs:function(){const t=this.getContext();return t.getParameter(t.MAX_VERTEX_ATTRIBS)},getMaxVaryingVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_VARYING_VECTORS)},getWireframe:function(){return this[Kx]},getPrimitiveMode:function(t){return this[Jx].get(t)},getShaders:function(){return this[Zx]},setShading:function(t){const e=this.getContext();switch(t){case Lo.POINT:this[Kx]=!1,this[Jx].set(e.POINTS,e.POINTS),this[Jx].set(e.LINES,e.POINTS),this[Jx].set(e.TRIANGLES,e.POINTS);break;case Lo.WIREFRAME:this[Kx]=!0,this[Jx].set(e.POINTS,e.POINTS),this[Jx].set(e.LINES,e.LINES),this[Jx].set(e.TRIANGLES,e.LINE_LOOP);break;default:this[Kx]=!1,this[Jx].set(e.POINTS,e.POINTS),this[Jx].set(e.LINES,e.LINES),this[Jx].set(e.TRIANGLES,e.TRIANGLES)}},createShader:function(t,e,n=e,i=[],o=[],r=[]){this.getBrowserOption("Debug")&&console.info("Initializing "+t);const s=this.getContext().getVersion(),a=new Wx(this.getPrivateScene());a._url.push(encodeURI(e.startsWith("data:")?e:"data:x-shader/x-vertex,"+sx.vertex[s][e])),a.setPrivate(!0),a.setName(t+"Vertex"),a.setOptions(i),a.setup();const u=new Wx(this.getPrivateScene());u._type="FRAGMENT",u._url.push(encodeURI(n.startsWith("data:")?n:"data:x-shader/x-fragment,"+sx.fragment[s][n])),u.setPrivate(!0),u.setName(t+"Fragment"),u.setOptions(i),u.setup();const c=new bx(this.getPrivateScene());return c._language="GLSL",c._parts.push(a),c._parts.push(u),c.setPrivate(!0),c.setName(t),c.setUniformNames(o),c.setTransformFeedbackVaryings(r),c.setup(),c}};const $x=Qx;n.set("x_ite/Browser/Shaders/X3DShadersContext",$x);const ty=$x;function ey(t){dr.call(this,t),this.addType(c.X3DAppearanceNode),this.addChildObjects("transparent",new ji.SFBool),this._transparent.setAccessType(c.outputOnly)}ey.prototype=Object.assign(Object.create(dr.prototype),{constructor:ey,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},isTransparent:function(){return this._transparent.getValue()}});const ny=ey;n.set("x_ite/Components/Shape/X3DAppearanceNode",ny);const iy=ny;function oy(t){iy.call(this,t),this.addType(c.Appearance),this.stylePropertiesNode=[],this.textureTransformMapping=new Map,this.textureBits=new Yu,this.shaderNodes=[]}oy.prototype=Object.assign(Object.create(iy.prototype),{constructor:oy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"alphaMode",new ji.SFString("AUTO")),new k(c.inputOutput,"alphaCutoff",new ji.SFFloat(.5)),new k(c.inputOutput,"pointProperties",new ji.SFNode),new k(c.inputOutput,"lineProperties",new ji.SFNode),new k(c.inputOutput,"fillProperties",new ji.SFNode),new k(c.inputOutput,"material",new ji.SFNode),new k(c.inputOutput,"backMaterial",new ji.SFNode),new k(c.inputOutput,"texture",new ji.SFNode),new k(c.inputOutput,"textureTransform",new ji.SFNode),new k(c.inputOutput,"shaders",new ji.MFNode),new k(c.inputOutput,"blendMode",new ji.SFNode),new k(c.inputOutput,"acousticProperties",new ji.SFNode)]),getTypeName:function(){return"Appearance"},getComponentName:function(){return"Shape"},getContainerField:function(){return"appearance"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){iy.prototype.initialize.call(this);this.getBrowser().getRenderingProperties()._ContentScale.addInterest("set_contentScale__",this),this._alphaMode.addInterest("set_alphaMode__",this),this._alphaCutoff.addInterest("set_alphaCutoff__",this),this._pointProperties.addInterest("set_pointProperties__",this),this._lineProperties.addInterest("set_lineProperties__",this),this._fillProperties.addInterest("set_fillProperties__",this),this._material.addInterest("set_material__",this),this._backMaterial.addInterest("set_backMaterial__",this),this._texture.addInterest("set_texture__",this),this._textureTransform.addInterest("set_textureTransform__",this),this._shaders.addInterest("set_shaders__",this),this._blendMode.addInterest("set_blendMode__",this),this._alphaMode.addInterest("set_transparent__",this),this._fillProperties.addInterest("set_transparent__",this),this._material.addInterest("set_transparent__",this),this._texture.addInterest("set_transparent__",this),this._blendMode.addInterest("set_transparent__",this),this.set_alphaMode__(),this.set_pointProperties__(),this.set_lineProperties__(),this.set_fillProperties__(),this.set_material__(),this.set_backMaterial__(),this.set_texture__(),this.set_textureTransform__(),this.set_shaders__(),this.set_blendMode__(),this.set_transparent__()},getAlphaMode:function(){return this.alphaMode},getNormalizedAlphaMode:function(t){return this.alphaMode||(t?ku.BLEND:ku.OPAQUE)},getAlphaCutoff:function(){return this.alphaCutoff},getStyleProperties:function(t){return this.stylePropertiesNode[t]},getPointProperties:function(){return this.stylePropertiesNode[0]},getLineProperties:function(){return this.stylePropertiesNode[1]},getFillProperties:function(){return this.stylePropertiesNode[2]},getMaterial:function(){return this.materialNode},getBackMaterial:function(){return this.backMaterialNode},getTexture:function(){return this.textureNode},getTextureBits:function(){return this.textureBits},updateTextureBits:function(){this.textureBits.clear(),this.textureNode.updateTextureBits(this.textureBits)},getTextureTransform:function(){return this.textureTransformNode},getTextureTransformMapping:function(){return this.textureTransformMapping},getShader:function(t,e){return this.materialNode.getShader(t,e)},getBackShader:function(t,e){return this.backMaterialNode.getShader(t,e)},getBlendMode:function(){return this.blendModeNode},set_contentScale__:function(){this.set_pointProperties__(),this.set_applied__()},set_alphaMode__:function(){this.alphaMode=this.getEnum(ku,this._alphaMode.getValue(),ku.AUTO),this.set_alphaCutoff__()},set_alphaCutoff__:function(){this.alphaCutoff=this.alphaMode===ku.MASK?this._alphaCutoff.getValue():0},set_pointProperties__:function(){if(this.stylePropertiesNode[0]=rc(c.PointProperties,this._pointProperties),!this.stylePropertiesNode[0]){const t=this.getBrowser();1!==t.getRenderingProperty("ContentScale")&&(this.stylePropertiesNode[0]=t.getDefaultPointProperties())}},set_lineProperties__:function(){this.linePropertiesNode&&this.linePropertiesNode._applied.removeInterest("set_applied__",this),this.linePropertiesNode=rc(c.LineProperties,this._lineProperties),this.linePropertiesNode&&this.linePropertiesNode._applied.addInterest("set_applied__",this),this.set_applied__()},set_applied__:function(){if(this.linePropertiesNode&&this.linePropertiesNode._applied.getValue())this.stylePropertiesNode[1]=this.linePropertiesNode;else{const t=this.getBrowser();1!==t.getRenderingProperty("ContentScale")?this.stylePropertiesNode[1]=t.getDefaultLineProperties():this.stylePropertiesNode[1]=null}},set_fillProperties__:function(){this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.removeInterest("set_transparent__",this),this.stylePropertiesNode[2]=rc(c.FillProperties,this._fillProperties),this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.addInterest("set_transparent__",this),this.stylePropertiesNode[3]=this.stylePropertiesNode[2]},set_material__:function(){this.materialNode&&this.materialNode._transparent.removeInterest("set_transparent__",this),this.materialNode=rc(c.X3DMaterialNode,this._material),this.materialNode||(this.materialNode=this.getBrowser().getDefaultMaterial()),this.materialNode&&this.materialNode._transparent.addInterest("set_transparent__",this),rc(c.TwoSidedMaterial,this.materialNode)&&this.set_backMaterial__()},set_backMaterial__:function(){this.backMaterialNode&&this.backMaterialNode._transparent.removeInterest("set_transparent__",this),this.backMaterialNode=rc(c.X3DOneSidedMaterialNode,this._backMaterial),this.backMaterialNode&&this.backMaterialNode._transparent.addInterest("set_transparent__",this),!this.backMaterialNode&&rc(c.TwoSidedMaterial,this.materialNode)&&(this.backMaterialNode=this.materialNode)},set_texture__:function(){this.textureNode&&(this.textureNode.removeInterest("updateTextureBits",this),this.textureNode._transparent.removeInterest("set_transparent__",this)),this.textureNode=rc(c.X3DTextureNode,this._texture),this.textureNode?(this.textureNode.addInterest("updateTextureBits",this),this.textureNode._transparent.addInterest("set_transparent__",this),this.updateTextureBits()):this.textureBits.clear()},set_textureTransform__:function(){this.textureTransformNode&&this.textureTransformNode.removeInterest("updateTextureTransformMapping",this),this.textureTransformNode=rc(c.X3DTextureTransformNode,this._textureTransform),this.textureTransformNode||(this.textureTransformNode=this.getBrowser().getDefaultTextureTransform()),this.textureTransformNode.addInterest("updateTextureTransformMapping",this),this.updateTextureTransformMapping()},updateTextureTransformMapping:function(){this.textureTransformMapping.clear(),this.textureTransformNode.getTextureTransformMapping(this.textureTransformMapping)},set_shaders__:function(){const t=this.shaderNodes;for(const e of t)e._isValid.removeInterest("set_shader__",this);t.length=0;for(const e of this._shaders){const n=rc(c.X3DShaderNode,e);n&&t.push(n)}for(const e of t)e._isValid.addInterest("set_shader__",this);this.set_shader__()},set_shader__:function(){function t(){return this.shaderNode}return function(){const e=this.shaderNodes;this.shaderNode&&this.shaderNode.deselect(),this.shaderNode=null;for(const t of e)if(t._isValid.getValue()){this.shaderNode=t;break}this.shaderNode?(this.shaderNode.select(),this.getShader=t,this.getBackShader=t):(delete this.getShader,delete this.getBackShader)}}(),set_blendMode__:function(){this.blendModeNode=rc(c.BlendMode,this._blendMode)},set_transparent__:function(){switch(this.alphaMode){case ku.AUTO:this.setTransparent(!!(this.stylePropertiesNode[3]?.isTransparent()||this.materialNode?.isTransparent()||this.backMaterialNode?.isTransparent()||this.textureNode?.isTransparent()||this.blendModeNode));break;case ku.OPAQUE:case ku.MASK:this.setTransparent(!1);break;case ku.BLEND:this.setTransparent(!0)}},traverse:function(t,e){this.textureNode&&this.textureNode.traverse(t,e)}});const ry=oy;n.set("x_ite/Components/Shape/Appearance",ry);const sy=ry;function ay(t){tc.call(this,t),this.addType(c.PointProperties),this.attenuation=new Float32Array(3)}ay.prototype=Object.assign(Object.create(tc.prototype),{constructor:ay,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"pointSizeScaleFactor",new ji.SFFloat(1)),new k(c.inputOutput,"pointSizeMinValue",new ji.SFFloat(1)),new k(c.inputOutput,"pointSizeMaxValue",new ji.SFFloat(1)),new k(c.inputOutput,"attenuation",new ji.MFFloat(1,0,0))]),getTypeName:function(){return"PointProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"pointProperties"},getSpecificationRange:function(){return["4.0","Infinity"]},initialize:function(){tc.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getContext();this.pointSizeRange=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),t.getRenderingProperties()._ContentScale.addInterest("set_contentScale__",this),this._pointSizeScaleFactor.addInterest("set_pointSizeScaleFactor__",this),this._pointSizeMinValue.addInterest("set_pointSizeMinValue__",this),this._pointSizeMaxValue.addInterest("set_pointSizeMaxValue__",this),this._attenuation.addInterest("set_attenuation__",this),this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__(),this.set_attenuation__()},set_contentScale__:function(){this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__()},set_pointSizeScaleFactor__:function(){const t=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeScaleFactor=Math.max(this._pointSizeScaleFactor.getValue(),0)*t},set_pointSizeMinValue__:function(){const t=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeMinValue=d.clamp(this._pointSizeMinValue.getValue(),0,this.pointSizeRange[1])*t},set_pointSizeMaxValue__:function(){const t=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeMaxValue=d.clamp(this._pointSizeMaxValue.getValue(),0,this.pointSizeRange[1])*t},set_attenuation__:function(){const t=this._attenuation.length;this.attenuation[0]=t>0?Math.max(0,this._attenuation[0]):1,this.attenuation[1]=t>1?Math.max(0,this._attenuation[1]):0,this.attenuation[2]=t>2?Math.max(0,this._attenuation[2]):0},setShaderUniforms:function(t,e){t.uniform1f(e.x3d_PointPropertiesPointSizeScaleFactor,this.pointSizeScaleFactor),t.uniform1f(e.x3d_PointPropertiesPointSizeMinValue,this.pointSizeMinValue),t.uniform1f(e.x3d_PointPropertiesPointSizeMaxValue,this.pointSizeMaxValue),t.uniform3fv(e.x3d_PointPropertiesAttenuation,this.attenuation)}});const uy=ay;n.set("x_ite/Components/Shape/PointProperties",uy);const cy=uy;function ly(t){tc.call(this,t),this.addType(c.LineProperties)}ly.prototype=Object.assign(Object.create(tc.prototype),{constructor:ly,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"applied",new ji.SFBool(!0)),new k(c.inputOutput,"linetype",new ji.SFInt32(1)),new k(c.inputOutput,"linewidthScaleFactor",new ji.SFFloat)]),getTypeName:function(){return"LineProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"lineProperties"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){tc.prototype.initialize.call(this);this.getBrowser().getRenderingProperties()._ContentScale.addInterest("set_linewidthScaleFactor__",this),this._applied.addInterest("set_applied__",this),this._linetype.addInterest("set_linetype__",this),this._linewidthScaleFactor.addInterest("set_linewidthScaleFactor__",this),this.set_applied__(),this.set_linetype__(),this.set_linewidthScaleFactor__(),this.getBrowser().getLinetypeTexture()},getApplied:function(){return this.applied},getLinetype:function(){return this.linetype},getLinewidthScaleFactor:function(){return this.linewidthScaleFactor},getTransformLines:function(){return this.transformLines},set_applied__:function(){this.applied=this._applied.getValue()},set_linetype__:function(){let t=this._linetype.getValue();(t<1||t>16)&&(t=1),this.linetype=t},set_linewidthScaleFactor__:function(){const t=this.getBrowser(),e=t.getContext(),n=t.getRenderingProperty("ContentScale");this.linewidthScaleFactor=Math.max(1,this._linewidthScaleFactor.getValue())*n,this.transformLines=e.HAS_FEATURE_TRANSFORMED_LINES&&this.linewidthScaleFactor>1},setShaderUniforms:function(t,e){const n=this.getBrowser();if(this.applied){const i=n.getTexture2DUnit();t.lineWidth(this.linewidthScaleFactor),t.uniform1i(e.x3d_LinePropertiesLinetype,this.linetype),t.uniform1f(e.x3d_LineStippleScale,n.getLineStippleScale()),t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,n.getLinetypeTexture().getTexture()),t.uniform1i(e.x3d_LinePropertiesTexture,i)}else t.lineWidth(n.getRenderingProperty("ContentScale")),t.uniform1i(e.x3d_LinePropertiesLinetype,16),t.uniform1f(e.x3d_LineStippleScale,1)}});const hy=ly;n.set("x_ite/Components/Shape/LineProperties",hy);const dy=hy;function py(t){tc.call(this,t),this.addType(c.X3DMaterialNode),this.addChildObjects("transparent",new ji.SFBool),this._transparent.setAccessType(c.outputOnly),this.textureBits=new Yu,this.shaderNodes=this.getBrowser().getShaders()}py.prototype=Object.assign(Object.create(tc.prototype),{constructor:py,initialize:function(){tc.prototype.initialize.call(this),this.getBrowser().getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__:function(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},isTransparent:function(){return this._transparent.getValue()},getBaseTexture:function(){return null},setTexture:function(t,e){const n=e?e.getTextureType()-1:0;this.textureBits.set(2*t+0,1&n),this.textureBits.set(2*t+1,2&n)},getTextureBits:function(){return this.textureBits},getShader:function(t,e){let n="";if(n+=this.textureBits.toString(4),n+=".",n+=t.geometryKey,e){const{renderObject:i,transparent:o,shadows:r,fogNode:s,shapeNode:a,appearanceNode:u,textureNode:c,objectsCount:l}=e;n+=this.logarithmicDepthBuffer||i.getViewpoint().getLogarithmicDepthBuffer()?1:0,n+=u.getNormalizedAlphaMode(o),n+=this.getMaterialKey(r),n+=r?1:0,n+=s?.getFogType()??0,n+=a.getShapeKey(),n+=u.getStyleProperties(t.geometryType)?1:0,n+=u.getTextureTransformMapping().size||1,n+=t.textureCoordinateMapping.size||1,n+=".",n+=l[0],n+=".",n+=l[1],n+=".",n+=l[2],n+=".",n+=c?1:u.getTextureBits().toString(4)}else{const{textureNode:e,objectsCount:i}=t;n+=this.logarithmicDepthBuffer?1:0,n+=t.alphaMode,n+=this.getMaterialKey(!1),n+="000011",n+=".",n+=i[0],n+=".",n+=i[1],n+=".",n+=i[2],n+=".",n+=e?1:0}return this.shaderNodes.get(n)??this.createShader(n,t,e)},getShaderOptions:function(t,e){const n=this.getBrowser(),i=[];if(i.push(`X3D_GEOMETRY_${t.geometryType}D`),t.hasFogCoords&&i.push("X3D_FOG_COORDS"),t.colorMaterial&&i.push("X3D_COLOR_MATERIAL"),t.hasNormals&&i.push("X3D_NORMALS"),e){const{renderObject:o,shapeNode:r,appearanceNode:s,objectsCount:a}=e;switch((this.logarithmicDepthBuffer||o.getViewpoint().getLogarithmicDepthBuffer())&&i.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),s.getNormalizedAlphaMode(e.transparent)){case ku.OPAQUE:i.push("X3D_ALPHA_MODE_OPAQUE");break;case ku.MASK:i.push("X3D_ALPHA_MODE_MASK");break;case ku.BLEND:i.push("X3D_ALPHA_MODE_BLEND")}if(e.shadows&&i.push("X3D_SHADOWS","X3D_PCF_FILTERING"),e.fogNode)switch(i.push("X3D_FOG"),e.fogNode.getFogType()){case 1:i.push("X3D_FOG_LINEAR");break;case 2:i.push("X3D_FOG_EXPONENTIAL")}if(a[0]&&(i.push("X3D_CLIP_PLANES"),i.push("X3D_NUM_CLIP_PLANES "+Math.min(a[0],n.getMaxClipPlanes()))),a[1]&&(i.push("X3D_LIGHTING"),i.push("X3D_NUM_LIGHTS "+Math.min(a[1],n.getMaxLights()))),a[2]&&(i.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),i.push("X3D_NUM_TEXTURE_PROJECTORS "+Math.min(a[2],n.getMaxTextures()))),s.getStyleProperties(t.geometryType)&&i.push("X3D_STYLE_PROPERTIES"),+this.textureBits&&i.push("X3D_MATERIAL_TEXTURES"),e.textureNode)i.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D");else{if(+s.getTextureBits()&&!this.getBaseTexture()){const t=s.getTexture();i.push("X3D_TEXTURE"),i.push("X3D_NUM_TEXTURES "+t.getCount()),t.getType().includes(c.MultiTexture)&&i.push("X3D_MULTI_TEXTURING"),t.getShaderOptions(i)}i.push("X3D_NUM_TEXTURE_TRANSFORMS "+(s.getTextureTransformMapping().size||1)),i.push("X3D_NUM_TEXTURE_COORDINATES "+(t.textureCoordinateMapping.size||1))}switch(r.getShapeKey()){case 1:i.push("X3D_PARTICLE_SYSTEM");break;case 2:i.push("X3D_PARTICLE_SYSTEM","X3D_TEX_COORD_RAMP")}}else{const{textureNode:e,objectsCount:o}=t;this.logarithmicDepthBuffer&&i.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),o[0]&&(i.push("X3D_CLIP_PLANES"),i.push("X3D_NUM_CLIP_PLANES "+Math.min(o[0],n.getMaxClipPlanes()))),o[1]&&(i.push("X3D_LIGHTING"),i.push("X3D_NUM_LIGHTS "+Math.min(o[1],n.getMaxLights()))),o[2]&&(i.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),i.push("X3D_NUM_TEXTURE_PROJECTORS "+Math.min(o[2],n.getMaxTextures()))),e&&i.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D")}return i}});const fy=py;n.set("x_ite/Components/Shape/X3DMaterialNode",fy);const gy=fy;function my(t){gy.call(this,t),this.addType(c.X3DOneSidedMaterialNode),this.addChildObjects("textures",new ji.SFTime),this.emissiveColor=new Float32Array(3)}my.prototype=Object.assign(Object.create(gy.prototype),{constructor:my,initialize:function(){gy.prototype.initialize.call(this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._emissiveTexture.addInterest("set_emissiveTexture__",this),this._normalTexture.addInterest("set_normalTexture__",this),this._transparency.addInterest("set_transparency__",this),this._transparency.addInterest("set_transparent__",this),this.set_emissiveColor__(),this.set_emissiveTexture__(),this.set_normalTexture__(),this.set_transparency__()},set_emissiveColor__:function(){const t=this.emissiveColor,e=this._emissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_emissiveTexture__:function(){this.emissiveTextureNode=rc(c.X3DSingleTextureNode,this._emissiveTexture),this.setTexture(this.getTextureIndices().EMISSIVE_TEXTURE,this.emissiveTextureNode)},set_normalTexture__:function(){this.normalTextureNode=rc(c.X3DSingleTextureNode,this._normalTexture),this.setTexture(this.getTextureIndices().NORMAL_TEXTURE,this.normalTextureNode)},set_transparency__:function(){this.transparency=d.clamp(this._transparency.getValue(),0,1)},set_transparent__:function(){this.setTransparent(!!this.transparency)},getBaseTexture:function(){return this.getEmissiveTexture()},getEmissiveTexture:function(){return this.emissiveTextureNode},getNormalTexture:function(){return this.normalTextureNode},getTransparency:function(){return this.transparency},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++};return function(){return e}}(),getShaderOptions:function(t,e){const n=gy.prototype.getShaderOptions.call(this,t,e);return+this.getTextureBits()&&(this.getEmissiveTexture()&&n.push("X3D_EMISSIVE_TEXTURE","X3D_EMISSIVE_TEXTURE_"+this.getEmissiveTexture().getTextureTypeString()),this.getNormalTexture()&&n.push("X3D_NORMAL_TEXTURE","X3D_NORMAL_TEXTURE_"+this.getNormalTexture().getTextureTypeString())),n},setShaderUniforms:function(t,e,n,i,o){if(t.uniform3fv(e.x3d_EmissiveColor,this.emissiveColor),t.uniform1f(e.x3d_Transparency,this.transparency),+this.getTextureBits()){if(this.emissiveTextureNode){const r=this._emissiveTextureMapping.getValue(),s=e.x3d_EmissiveTexture;this.emissiveTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}if(this.normalTextureNode){const r=this._normalTextureMapping.getValue(),s=e.x3d_NormalTexture;t.uniform1f(e.x3d_NormalScale,Math.max(this._normalScale.getValue(),0)),this.normalTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}}}});const _y=my;n.set("x_ite/Components/Shape/X3DOneSidedMaterialNode",_y);const xy=_y;function yy(t){xy.call(this,t),this.addType(c.UnlitMaterial)}yy.prototype=Object.assign(Object.create(xy.prototype),{constructor:yy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"emissiveColor",new ji.SFColor(1,1,1)),new k(c.inputOutput,"emissiveTextureMapping",new ji.SFString),new k(c.inputOutput,"emissiveTexture",new ji.SFNode),new k(c.inputOutput,"normalScale",new ji.SFFloat(1)),new k(c.inputOutput,"normalTextureMapping",new ji.SFString),new k(c.inputOutput,"normalTexture",new ji.SFNode),new k(c.inputOutput,"transparency",new ji.SFFloat)]),getTypeName:function(){return"UnlitMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},getSpecificationRange:function(){return["4.0","Infinity"]},initialize:function(){xy.prototype.initialize.call(this),this.set_transparent__()},set_emissiveTexture__:function(){this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.removeInterest("set_transparent__",this),xy.prototype.set_emissiveTexture__.call(this),this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.addInterest("set_transparent__",this)},set_transparent__:function(){this.setTransparent(!(!this.getTransparency()&&!this.getEmissiveTexture()?.isTransparent()))},getMaterialKey:function(){return"0"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);o.push("X3D_UNLIT_MATERIAL");const r=i.createShader("UnlitShader","Default","Unlit",o);return i.getShaders().set(t,r),r}});const wy=yy;n.set("x_ite/Components/Shape/UnlitMaterial",wy);const Sy=wy,Ty=Symbol(),by=Symbol(),vy=Symbol(),Ey=Symbol(),Cy=Symbol(),Oy=Symbol(),Ny=Symbol(),Fy=Symbol(),Iy=Symbol();function My(){this[by]=[]}My.prototype={getDefaultAppearance:function(){return this[vy]=new sy(this.getPrivateScene()),this[vy].setPrivate(!0),this[vy].setup(),this.getDefaultAppearance=function(){return this[vy]},Object.defineProperty(this,"getDefaultAppearance",{enumerable:!1}),this[vy]},getLineStippleScale:function(){return 1/(32*this.getPixelPerPoint())},getDefaultPointProperties:function(){return this[Ey]=new cy(this.getPrivateScene()),this[Ey].setPrivate(!0),this[Ey].setup(),this.getDefaultPointProperties=function(){return this[Ey]},Object.defineProperty(this,"getDefaultPointProperties",{enumerable:!1}),this[Ey]},getDefaultLineProperties:function(){return this[Cy]=new dy(this.getPrivateScene()),this[Cy]._applied=!1,this[Cy].setPrivate(!0),this[Cy].setup(),this.getDefaultLineProperties=function(){return this[Cy]},Object.defineProperty(this,"getDefaultLineProperties",{enumerable:!1}),this[Cy]},getDefaultMaterial:function(){return this[Oy]=new Sy(this.getPrivateScene()),this[Oy].setPrivate(!0),this[Oy].setup(),this.getDefaultMaterial=function(){return this[Oy]},Object.defineProperty(this,"getDefaultMaterial",{enumerable:!1}),this[Oy]},getLinetypeTexture:function(){return this[Ty]=new mc(this.getPrivateScene()),this[Ty]._url[0]=cr.getLinetypeUrl(),this[Ty]._textureProperties=this.getLineFillTextureProperties(),this[Ty].setPrivate(!0),this[Ty].setup(),this.getLinetypeTexture=function(){return this[Ty]},Object.defineProperty(this,"getLinetypeTexture",{enumerable:!1}),this[Ty]},getHatchStyleTexture:function(t){let e=this[by][t];return e||(e=this[by][t]=new mc(this.getPrivateScene()),e._url[0]=cr.getHatchingUrl(t),e._textureProperties=this.getLineFillTextureProperties(),e.setPrivate(!0),e.setup(),e)},getLineFillTextureProperties:function(){return this[Ny]=new _d(this.getPrivateScene()),this[Ny]._minificationFilter="NEAREST_PIXEL",this[Ny]._magnificationFilter="NEAREST_PIXEL",this[Ny]._textureCompression="DEFAULT",this[Ny].setPrivate(!0),this[Ny].setup(),this.getLineFillTextureProperties=function(){return this[Ny]},Object.defineProperty(this,"getLineFillTextureProperties",{enumerable:!1}),this[Ny]},getLineTransformShader:function(){return this[Fy]=this.createShader("LineTransformShader","LineTransform","LineTransform",[],["viewport","modelViewProjectionMatrix","invModelViewProjectionMatrix","scale"],["lineStipple0","fogDepth0","color0","normal0","vertex0","lineStipple1","fogDepth1","color1","normal1","vertex1","lineStipple2","fogDepth2","color2","normal2","vertex2"]),this.getLineTransformShader=function(){return this[Fy]},Object.defineProperty(this,"getLineTransformShader",{enumerable:!1}),this[Fy]},getLineTransformFeedback:function(){const t=this.getContext();return this[Iy]=t.createTransformFeedback(),this.getLineTransformFeedback=function(){return this[Iy]},Object.defineProperty(this,"getLineTransformFeedback",{enumerable:!1}),this[Iy]}};const Dy=My;n.set("x_ite/Browser/Shape/X3DShapeContext",Dy);const Ry=Dy;function Vy(){this.addChildObjects("volume",new ji.SFFloat(1),"mute",new ji.SFBool)}Vy.prototype={};const Ay=Vy;n.set("x_ite/Browser/Sound/X3DSoundContext",Ay);const Py=Ay;function Ly(t){tc.call(this,t),this.addType(c.X3DTextureTransformNode)}Ly.prototype=Object.assign(Object.create(tc.prototype),{constructor:Ly});const By=Ly;n.set("x_ite/Components/Texturing/X3DTextureTransformNode",By);const Xy=By;function Uy(t){Xy.call(this,t),this.addType(c.X3DSingleTextureTransformNode),this.matrixArray=new Float32Array(dn.Identity)}Uy.prototype=Object.assign(Object.create(Xy.prototype),{constructor:Uy,getCount:function(){return 1},setMatrix:function(t){this.matrixArray.set(t)},getTextureTransformMapping:function(t,e=0){t.set(this._mapping.getValue()||e,e)},setShaderUniforms:function(t,e,n=0){t.uniformMatrix4fv(e.x3d_TextureMatrix[n],!1,this.matrixArray)},transformPoint:function(t){return dn.prototype.multVecMatrix.call(this.matrixArray,t)}});const ky=Uy;n.set("x_ite/Components/Texturing/X3DSingleTextureTransformNode",ky);const zy=ky;function jy(t){zy.call(this,t),this.addType(c.TextureTransform),this._rotation.setUnit("angle"),this.matrix=new dn}jy.prototype=Object.assign(Object.create(zy.prototype),{constructor:jy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"mapping",new ji.SFString),new k(c.inputOutput,"translation",new ji.SFVec2f),new k(c.inputOutput,"rotation",new ji.SFFloat),new k(c.inputOutput,"scale",new ji.SFVec2f(1,1)),new k(c.inputOutput,"center",new ji.SFVec2f)]),getTypeName:function(){return"TextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){zy.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},getMatrix:function(){return this.matrix},eventsProcessed:function(){const t=new ge(0,0),e=new Re;return function(){const n=this._translation.getValue(),i=this._rotation.getValue(),o=this._scale.getValue(),r=this._center.getValue(),s=this.matrix;e.identity(),r.equals(ge.Zero)||e.translate(t.assign(r).negate()),o.equals(ge.One)||e.scale(o),0!==i&&e.rotate(i),r.equals(ge.Zero)||e.translate(r),n.equals(ge.Zero)||e.translate(n),s[0]=e[0],s[1]=e[1],s[4]=e[3],s[5]=e[4],s[12]=e[6],s[13]=e[7],this.setMatrix(s)}}()});const Gy=jy;n.set("x_ite/Components/Texturing/TextureTransform",Gy);const Hy=Gy,qy=Symbol(),Yy=Symbol(),Wy=Symbol(),Ky=Symbol(),Jy=Symbol(),Zy=Symbol(),Qy=Symbol(),$y=Symbol(),tw=Symbol(),ew=Symbol(),nw=Symbol(),iw=Symbol(),ow=Symbol(),rw=Symbol();function sw(){const t=this.getContext(),e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this[qy]=e>8?2:1}sw.prototype={initialize:function(){const t=this.getContext();t.pixelStorei(t.UNPACK_ALIGNMENT,1);const e=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this[Yy]=[...Array(e).keys()],this[Wy]=[this[Yy].pop()],this[Ky]=[this[Yy].pop()],this[Jy]=[this[Yy].pop()];const n=new Uint8Array([255,255,255,255]);this[tw]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[Wy][0]),t.bindTexture(t.TEXTURE_2D,this[tw]),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n),t.getVersion()>=2&&(this[ew]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[Ky][0]),t.bindTexture(t.TEXTURE_3D,this[ew]),t.texImage3D(t.TEXTURE_3D,0,t.RGBA,1,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n)),this[nw]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[Jy][0]),t.bindTexture(t.TEXTURE_CUBE_MAP,this[nw]),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n),this.resetTextureUnits(),this.setTextureQuality(this.getBrowserOptions().getTextureQuality())},getMaxTextures:function(){return this[qy]},getMaxTextureTransforms:function(){return 4},getMaxTexCoords:function(){return 4},getMinTextureSize:function(){return 16},getMaxTextureSize:function(){const t=this.getContext();return t.getParameter(t.MAX_TEXTURE_SIZE)},getMaxCombinedTextureUnits:function(){const t=this.getContext();return t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},popTexture2DUnit:function(){return this[Zy]>0?(--this[Zy],this[Wy].pop()):this[Yy].pop()},pushTexture2DUnit:function(t){void 0!==t&&(++this[Zy],this[Wy].push(t))},getTexture2DUnit:function(){if(this[Zy]>0)return this[Wy][--this[Zy]];const t=this[Yy].pop();return void 0!==t&&this[Wy].push(t),t},getTexture3DUnit:function(){if(this[Qy]>0)return this[Ky][--this[Qy]];const t=this[Yy].pop();return void 0!==t&&this[Ky].push(t),t},getTextureCubeUnit:function(){if(this[$y]>0)return this[Jy][--this[$y]];const t=this[Yy].pop();return void 0!==t&&this[Jy].push(t),t},getTextureUnit:function(t){switch(t){case 2:return this.getTexture2DUnit();case 3:return this.getTexture3DUnit();case 4:return this.getTextureCubeUnit()}},resetTextureUnits:function(){this[Zy]=this[Wy].length,this[Qy]=this[Ky].length,this[$y]=this[Jy].length},getDefaultTexture2DUnit:function(){return this[Wy][0]},getDefaultTexture3DUnit:function(){return this[Ky][0]},getDefaultTextureCubeUnit:function(){return this[Jy][0]},getTextureMemory:function(){return NaN},getDefaultTextureProperties:function(){return this[iw]=new _d(this.getPrivateScene()),this[iw]._magnificationFilter="NICEST",this[iw]._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",this[iw]._generateMipMaps=!0,this[iw]._textureCompression="NICEST",this[iw].setup(),this.getDefaultTextureProperties=function(){return this[iw]},Object.defineProperty(this,"getDefaultTextureProperties",{enumerable:!1}),this[iw]},getDefaultTextureTransform:function(){return this[ow]=new Hy(this.getPrivateScene()),this[ow].setPrivate(!0),this[ow].setup(),this.getDefaultTextureTransform=function(){return this[ow]},Object.defineProperty(this,"getDefaultTextureTransform",{enumerable:!1}),this[ow]},getDefaultTextureCoordinate:function(){return this[rw]=new Hd(this.getPrivateScene()),this[rw].setPrivate(!0),this[rw].setup(),this.getDefaultTextureCoordinate=function(){return this[rw]},Object.defineProperty(this,"getDefaultTextureCoordinate",{enumerable:!1}),this[rw]},setTextureQuality:function(t){const e=this.getDefaultTextureProperties();switch(t){case Uo.LOW:e._magnificationFilter="AVG_PIXEL",e._minificationFilter="AVG_PIXEL",e._textureCompression="FASTEST",e._generateMipMaps=!0;break;case Uo.MEDIUM:e._magnificationFilter="NICEST",e._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",e._textureCompression="NICEST",e._generateMipMaps=!0;break;case Uo.HIGH:e._magnificationFilter="NICEST",e._minificationFilter="NICEST",e._textureCompression="NICEST",e._generateMipMaps=!0}}};const aw=sw;n.set("x_ite/Browser/Texturing/X3DTexturingContext",aw);const uw=aw,cw=Symbol(),lw=Symbol(),hw=Symbol(),dw=Symbol();function pw(){this[cw]=Date.now()/1e3,this[lw]=60,this[hw]=new Se(0,0,0),this[dw]=0}pw.prototype={getCurrentTime:function(){return this[cw]},getCurrentFrameRate:function(){return this[lw]},getCurrentSpeed:function(){return this[dw]},advanceTime:function(){const t=new Se(0,0,0);return function(){const e=Date.now()/1e3,n=e-this[cw];if(this[cw]=e,this[lw]=n?1/n:60,this.getWorld()&&this.getActiveLayer()){const e=this.getActiveLayer().getViewpoint().getCameraSpaceMatrix();t.assign(this[hw]),this[hw].set(e[12],e[13],e[14]),this[dw]=t.subtract(this[hw]).magnitude()*this[lw]}else this[dw]=0}}()};const fw=pw;n.set("x_ite/Browser/Time/X3DTimeContext",fw);const gw=fw,mw=Symbol(),_w=Symbol(),xw=Symbol(),yw=Symbol();function ww(){this[mw]=[],this[_w]=[],this[xw]=[],this[yw]=[]}ww.prototype={constructor:ww,initialize:function(){},addTaintedField:function(t,e){this[mw].push(t,e)},addTaintedNode:function(t){this[xw].push(t)},[Symbol.for("X_ITE.X3DRoutingContext.processEvents")]:function(){do{do{const t=this[mw];this[mw]=this[_w],this[mw].length=0;for(let e=0,n=t.length;e<n;e+=2)t[e].processEvent(t[e+1]);this[_w]=t}while(this[mw].length);do{const t=this[xw];this[xw]=this[yw],this[xw].length=0;for(const e of t)e.processEvents();this[yw]=t}while(!this[mw].length&&this[xw].length)}while(this[mw].length)},dispose:function(){}};const Sw=ww;n.set("x_ite/Routing/X3DRoutingContext",Sw);const Tw=Sw,bw=Symbol(),vw=Symbol(),Ew=Symbol(),Cw=Symbol(),Ow=Symbol(),Nw=Symbol(),Fw=Symbol(),Iw=Symbol(),Mw=Symbol(),Dw=Symbol(),Rw=Symbol(),Vw=Symbol.for("X_ITE.X3DRoutingContext.processEvents"),Aw=new Set,Pw=[];function Lw(t){uo.call(this,this),Tw.call(this),am.call(this),fd.call(this,t),dg.call(this),uw.call(this),ty.call(this),im.call(this),Ry.call(this),bp.call(this),ap.call(this),jg.call(this),eg.call(this),Vp.call(this),Sd.call(this),Xp.call(this),wg.call(this),Py.call(this),gw.call(this),Aw.add(this);for(const t of Pw)t.call(this);this.addChildObjects("initialized",new zn,"shutdown",new zn,"prepareEvents",new zn,"timeEvents",new zn,"sensorEvents",new zn,"displayEvents",new zn,"finishedEvents",new zn),this[vw]=0,this[Nw]=0,this[Ow]=this[Cw].bind(this),this[Fw]=new xo,this[Iw]=new xo,this[Mw]=new xo,this[Dw]=new xo,this[Rw]=new xo}Lw.prototype=Object.assign(Object.create(uo.prototype),fd.prototype,Sd.prototype,ap.prototype,bp.prototype,Vp.prototype,Xp.prototype,eg.prototype,dg.prototype,wg.prototype,jg.prototype,im.prototype,Tw.prototype,am.prototype,ty.prototype,Ry.prototype,Py.prototype,uw.prototype,gw.prototype,{constructor:Lw,initialize:function(){uo.prototype.initialize?.call(this),Tw.prototype.initialize?.call(this),am.prototype.initialize?.call(this),fd.prototype.initialize?.call(this),dg.prototype.initialize?.call(this),uw.prototype.initialize?.call(this),ty.prototype.initialize?.call(this),im.prototype.initialize?.call(this),Ry.prototype.initialize?.call(this),bp.prototype.initialize?.call(this),ap.prototype.initialize?.call(this),jg.prototype.initialize?.call(this),eg.prototype.initialize?.call(this),Vp.prototype.initialize?.call(this),Sd.prototype.initialize?.call(this),Xp.prototype.initialize?.call(this),wg.prototype.initialize?.call(this),Py.prototype.initialize?.call(this),gw.prototype.initialize?.call(this);for(const t of Pw)t.prototype.initialize?.call(this)},initialized:function(){return this._initialized},shutdown:function(){return this._shutdown},prepareEvents:function(){return this._prepareEvents},timeEvents:function(){return this._timeEvents},sensorEvents:function(){return this._sensorEvents},displayEvents:function(){return this._displayEvents},finishedEvents:function(){return this._finishedEvents},getBrowser:function(){return this},getWorld:function(){return this[bw]},getExecutionContext:function(){return this[bw].getExecutionContext()},setExecutionContext:function(t){this[bw]=new _l(t),this[bw].setup()},addBrowserEvent:function(){this[vw]!==this.getCurrentTime()&&(this[vw]=this.getCurrentTime(),requestAnimationFrame(this[Ow]))},[Ew]:function(t){return t===this[Nw]?(requestAnimationFrame(this[Ow]),!0):(this[Nw]=t,!1)},[Cw]:function(t){if(this[Ew](t))return;this[Fw].stop(),this[Iw].start(),this.advanceTime(),this.addTaintedField(this._prepareEvents),this[Vw](),this.addTaintedField(this._timeEvents),this[Vw](),this[Mw].start(),this[bw].traverse(ja.CAMERA),this[Mw].stop(),this[Dw].start(),this.getCollisionCount()&&this[bw].traverse(ja.COLLISION),this[Dw].stop(),this.addTaintedField(this._sensorEvents),this[Vw](),this[Rw].start(),this.addTaintedField(this._displayEvents),this[Vw]();const e=this.getContext();this.getFrameBuffer().bind(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),this[bw].traverse(ja.DISPLAY),this.getFrameBuffer().blit(),this[Rw].stop(),this.addTaintedField(this._finishedEvents),this[Vw](),this[Iw].stop(),this[Fw].start()},getSystemTime:function(){return this[Fw]},getBrowserTime:function(){return this[Iw]},getCameraTime:function(){return this[Mw]},getCollisionTime:function(){return this[Dw]},getDisplayTime:function(){return this[Rw]},dispose:function(){Aw.delete(this);for(const t of Pw)t.prototype.dispose?.call(this);gw.prototype.dispose?.call(this),Py.prototype.dispose?.call(this),wg.prototype.dispose?.call(this),Xp.prototype.dispose?.call(this),Sd.prototype.dispose?.call(this),Vp.prototype.dispose?.call(this),eg.prototype.dispose?.call(this),jg.prototype.dispose?.call(this),ap.prototype.dispose?.call(this),bp.prototype.dispose?.call(this),Ry.prototype.dispose?.call(this),im.prototype.dispose?.call(this),ty.prototype.dispose?.call(this),uw.prototype.dispose?.call(this),dg.prototype.dispose?.call(this),fd.prototype.dispose?.call(this),am.prototype.dispose?.call(this),Tw.prototype.dispose?.call(this),uo.prototype.dispose?.call(this)}});for(const t of Reflect.ownKeys(Lw.prototype))Object.defineProperty(Lw.prototype,t,{enumerable:!1});Object.assign(Lw,{addBrowserContext:function(t){Pw.push(t);const e=Object.keys(t.prototype).filter((t=>!t.match(/^(initialize|dispose)$/))).concat(Object.getOwnPropertySymbols(t.prototype));for(const n of e)Object.defineProperty(Lw.prototype,n,{value:t.prototype[n],writable:!0});for(const e of Aw)t.call(e),t.prototype.initialize?.call(e),e[Vw]()}});const Bw=Lw;n.set("x_ite/Browser/X3DBrowserContext",Bw);const Xw=Bw;function Uw(t){this.addType(c.X3DMetadataObject)}Uw.prototype={constructor:Uw,initialize:function(){},dispose:function(){}};const kw=Uw;n.set("x_ite/Components/Core/X3DMetadataObject",kw);const zw=kw;function jw(t){dr.call(this,t),zw.call(this,t),this.addType(c.MetadataBoolean)}jw.prototype=Object.assign(Object.create(dr.prototype),zw.prototype,{constructor:jw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"name",new ji.SFString),new k(c.inputOutput,"reference",new ji.SFString),new k(c.inputOutput,"value",new ji.MFBool)]),getTypeName:function(){return"MetadataBoolean"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},getSpecificationRange:function(){return["3.3","Infinity"]},initialize:function(){dr.prototype.initialize.call(this),zw.prototype.initialize.call(this)},dispose:function(){zw.prototype.dispose.call(this),dr.prototype.dispose.call(this)}});const Gw=jw;n.set("x_ite/Components/Core/MetadataBoolean",Gw);const Hw=Gw;function qw(t){dr.call(this,t),zw.call(this,t),this.addType(c.MetadataDouble)}qw.prototype=Object.assign(Object.create(dr.prototype),zw.prototype,{constructor:qw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"name",new ji.SFString),new k(c.inputOutput,"reference",new ji.SFString),new k(c.inputOutput,"value",new ji.MFDouble)]),getTypeName:function(){return"MetadataDouble"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){dr.prototype.initialize.call(this),zw.prototype.initialize.call(this)},dispose:function(){zw.prototype.dispose.call(this),dr.prototype.dispose.call(this)}});const Yw=qw;n.set("x_ite/Components/Core/MetadataDouble",Yw);const Ww=Yw;function Kw(t){dr.call(this,t),zw.call(this,t),this.addType(c.MetadataFloat)}Kw.prototype=Object.assign(Object.create(dr.prototype),zw.prototype,{constructor:Kw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"name",new ji.SFString),new k(c.inputOutput,"reference",new ji.SFString),new k(c.inputOutput,"value",new ji.MFFloat)]),getTypeName:function(){return"MetadataFloat"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){dr.prototype.initialize.call(this),zw.prototype.initialize.call(this)},dispose:function(){zw.prototype.dispose.call(this),dr.prototype.dispose.call(this)}});const Jw=Kw;n.set("x_ite/Components/Core/MetadataFloat",Jw);const Zw=Jw;function Qw(t){dr.call(this,t),zw.call(this,t),this.addType(c.MetadataInteger)}Qw.prototype=Object.assign(Object.create(dr.prototype),zw.prototype,{constructor:Qw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"name",new ji.SFString),new k(c.inputOutput,"reference",new ji.SFString),new k(c.inputOutput,"value",new ji.MFInt32)]),getTypeName:function(){return"MetadataInteger"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){dr.prototype.initialize.call(this),zw.prototype.initialize.call(this)},dispose:function(){zw.prototype.dispose.call(this),dr.prototype.dispose.call(this)}});const $w=Qw;n.set("x_ite/Components/Core/MetadataInteger",$w);const tS=$w;function eS(t){dr.call(this,t),zw.call(this,t),this.addType(c.MetadataSet)}eS.prototype=Object.assign(Object.create(dr.prototype),zw.prototype,{constructor:eS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"name",new ji.SFString),new k(c.inputOutput,"reference",new ji.SFString),new k(c.inputOutput,"value",new ji.MFNode)]),getTypeName:function(){return"MetadataSet"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){dr.prototype.initialize.call(this),zw.prototype.initialize.call(this)},dispose:function(){zw.prototype.dispose.call(this),dr.prototype.dispose.call(this)}});const nS=eS;n.set("x_ite/Components/Core/MetadataSet",nS);const iS=nS;function oS(t){dr.call(this,t),zw.call(this,t),this.addType(c.MetadataString)}oS.prototype=Object.assign(Object.create(dr.prototype),zw.prototype,{constructor:oS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"name",new ji.SFString),new k(c.inputOutput,"reference",new ji.SFString),new k(c.inputOutput,"value",new ji.MFString)]),getTypeName:function(){return"MetadataString"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){dr.prototype.initialize.call(this),zw.prototype.initialize.call(this)},dispose:function(){zw.prototype.dispose.call(this),dr.prototype.dispose.call(this)}});const rS=oS;n.set("x_ite/Components/Core/MetadataString",rS);const sS=rS;function aS(t){fu.call(this,t),this.addType(c.X3DInfoNode)}aS.prototype=Object.assign(Object.create(fu.prototype),{constructor:aS});const uS=aS;n.set("x_ite/Components/Core/X3DInfoNode",uS);const cS=uS;function lS(t){cS.call(this,t),this.addType(c.WorldInfo)}lS.prototype=Object.assign(Object.create(cS.prototype),{constructor:lS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"title",new ji.SFString),new k(c.initializeOnly,"info",new ji.MFString)]),getTypeName:function(){return"WorldInfo"},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){cS.prototype.initialize.call(this),this.getExecutionContext().addWorldInfo(this)},dispose:function(){this.getExecutionContext().removeWorldInfo(this),cS.prototype.dispose.call(this)}});const hS=lS;n.set("x_ite/Components/Core/WorldInfo",hS);const dS={MetadataBoolean:Hw,MetadataDouble:Ww,MetadataFloat:Zw,MetadataInteger:tS,MetadataSet:iS,MetadataString:sS,WorldInfo:hS},pS={X3DBindableNode:_u,X3DChildNode:fu,X3DInfoNode:cS,X3DMetadataObject:zw,X3DNode:dr,X3DPrototypeInstance:kr,X3DSensorNode:Ec};for(const t in dS)Sr.addNodeType(t,dS[t]);for(const t in pS)Sr.addAbstractNodeType(t,pS[t]);const fS=void 0;n.set("x_ite/Components/Core",fS);function gS(t){Id.call(this,t),this.addType(c.FogCoordinate),this._depth.setUnit("length")}gS.prototype=Object.assign(Object.create(Id.prototype),{constructor:gS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"depth",new ji.MFFloat)]),getTypeName:function(){return"FogCoordinate"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"fogCoord"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){Id.prototype.initialize.call(this),this._depth.addInterest("set_depth__",this),this.set_depth__()},set_depth__:function(){this.depth=this._depth.getValue(),this.length=this._depth.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},addDepth:function(t,e){t<this.length?e.push(this.depth[t]):this.length?e.push(this.depth[this.length-1]):e.push(0)},addDepths:function(t,e){const n=this.length;if(n){const i=this.depth;for(let e=0;e<n;++e)t.push(i[e]);const o=i[n-1];for(let i=n;i<e;++i)t.push(o)}else for(let n=0;n<e;++n)t.push(0)}});const mS=gS;n.set("x_ite/Components/EnvironmentalEffects/FogCoordinate",mS);const _S=mS;function xS(t){fu.call(this,t),Nu.call(this,t),this.addType(c.LocalFog)}xS.prototype=Object.assign(Object.create(fu.prototype),Nu.prototype,{constructor:xS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"fogType",new ji.SFString("LINEAR")),new k(c.inputOutput,"color",new ji.SFColor(1,1,1)),new k(c.inputOutput,"visibilityRange",new ji.SFFloat)]),getTypeName:function(){return"LocalFog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){fu.prototype.initialize.call(this),Nu.prototype.initialize.call(this)},push:function(t){if(this._enabled.getValue()&&this.getFogType()){const e=this.getFogs().pop();e.set(this,t.getModelViewMatrix().get()),t.getLocalFogs().push(e)}},pop:function(t){this._enabled.getValue()&&this.getFogType()&&this.getBrowser().getLocalObjects().push(t.getLocalFogs().pop())},dispose:function(){Nu.prototype.dispose.call(this),fu.prototype.dispose.call(this)}});const yS=xS;n.set("x_ite/Components/EnvironmentalEffects/LocalFog",yS);const wS=yS;function SS(t){Zu.call(this,t),this.addType(c.TextureBackground)}SS.prototype=Object.assign(Object.create(Zu.prototype),{constructor:SS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_bind",new ji.SFBool),new k(c.inputOutput,"skyAngle",new ji.MFFloat),new k(c.inputOutput,"skyColor",new ji.MFColor(new ji.SFColor)),new k(c.inputOutput,"groundAngle",new ji.MFFloat),new k(c.inputOutput,"groundColor",new ji.MFColor),new k(c.inputOutput,"transparency",new ji.SFFloat),new k(c.outputOnly,"isBound",new ji.SFBool),new k(c.outputOnly,"bindTime",new ji.SFTime),new k(c.inputOutput,"frontTexture",new ji.SFNode),new k(c.inputOutput,"backTexture",new ji.SFNode),new k(c.inputOutput,"leftTexture",new ji.SFNode),new k(c.inputOutput,"rightTexture",new ji.SFNode),new k(c.inputOutput,"topTexture",new ji.SFNode),new k(c.inputOutput,"bottomTexture",new ji.SFNode)]),getTypeName:function(){return"TextureBackground"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){Zu.prototype.initialize.call(this),this._frontTexture.addInterest("set_texture__",this,0),this._backTexture.addInterest("set_texture__",this,1),this._leftTexture.addInterest("set_texture__",this,2),this._rightTexture.addInterest("set_texture__",this,3),this._topTexture.addInterest("set_texture__",this,4),this._bottomTexture.addInterest("set_texture__",this,5),this.set_texture__(0,this._frontTexture),this.set_texture__(1,this._backTexture),this.set_texture__(2,this._leftTexture),this.set_texture__(3,this._rightTexture),this.set_texture__(4,this._topTexture),this.set_texture__(5,this._bottomTexture)},set_texture__:function(t,e){Zu.prototype.set_texture__.call(this,rc(c.X3DTextureNode,e),t)}});const TS=SS;n.set("x_ite/Components/EnvironmentalEffects/TextureBackground",TS);const bS={Background:yc,Fog:Mu,FogCoordinate:_S,LocalFog:wS,TextureBackground:TS},vS={X3DBackgroundNode:Zu,X3DFogObject:Nu};for(const t in bS)Sr.addNodeType(t,bS[t]);for(const t in vS)Sr.addAbstractNodeType(t,vS[t]);const ES=void 0;n.set("x_ite/Components/EnvironmentalEffects",ES);function CS(t){Ec.call(this,t),this.addType(c.X3DEnvironmentalSensorNode),this.addChildObjects("traversed",new ji.SFBool(!0)),this._size.setUnit("length"),this._center.setUnit("length"),this.zeroTest=!1,this.currentTraversed=!0}CS.prototype=Object.assign(Object.create(Ec.prototype),{constructor:CS,initialize:function(){Ec.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._size.addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this.set_live__()},set_live__:function(){!(this._traversed.getValue()&&this.getLive().getValue()&&this._enabled.getValue())||this.zeroTest&&this._size.getValue().equals(Se.Zero)?(this.getBrowser().sensorEvents().removeInterest("update",this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime())):this.getBrowser().sensorEvents().addInterest("update",this)},setZeroTest:function(t){this.zeroTest=t},getZeroTest:function(){return this.zeroTest},setTraversed:function(t){t?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=t},getTraversed:function(){return this.currentTraversed},update:function(){}});const OS=CS;n.set("x_ite/Components/EnvironmentalSensor/X3DEnvironmentalSensorNode",OS);const NS=OS;function FS(t){NS.call(this,t),this.addType(c.ProximitySensor),this.setCameraObject(!0),this._centerOfRotation_changed.setUnit("length"),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new Se(0,0,0),this.max=new Se(0,0,0),this.layerNode=null,this.modelMatrix=new dn,this.inside=!1}FS.prototype=Object.assign(Object.create(NS.prototype),{constructor:FS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"size",new ji.SFVec3f),new k(c.inputOutput,"center",new ji.SFVec3f),new k(c.outputOnly,"enterTime",new ji.SFTime),new k(c.outputOnly,"exitTime",new ji.SFTime),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"position_changed",new ji.SFVec3f),new k(c.outputOnly,"orientation_changed",new ji.SFRotation),new k(c.outputOnly,"centerOfRotation_changed",new ji.SFVec3f)]),getTypeName:function(){return"ProximitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){NS.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._traversed.addFieldInterest(this._isCameraObject),this.set_enabled__(),this.set_extents__()},set_enabled__:function(){this.setCameraObject(this._enabled.getValue()),this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},set_extents__:function(){const t=this._size.getValue(),e=this._center.getValue(),n=t.x/2,i=t.y/2,o=t.z/2,r=e.x,s=e.y,a=e.z;this.min.set(r-n,s-i,a-o),this.max.set(r+n,s+i,a+o)},update:function(){const t=new dn,e=new dn,n=new Se(0,0,0),i=new an,o=new Se(0,0,0);return function(){if(this.inside&&this.getTraversed()){if(this.layerNode){const r=this.layerNode.getViewpoint(),s=this.modelMatrix;e.assign(r.getModelMatrix()),e.translate(r.getUserCenterOfRotation()),e.multRight(t.assign(s).inverse()),s.multRight(r.getViewMatrix()),s.get(null,i),s.inverse(),n.set(s[12],s[13],s[14]),i.inverse(),o.set(e[12],e[13],e[14]),this._isActive.getValue()?(this._position_changed.getValue().equals(n)||(this._position_changed=n),this._orientation_changed.getValue().equals(i)||(this._orientation_changed=i),this._centerOfRotation_changed.getValue().equals(o)||(this._centerOfRotation_changed=o)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=n,this._orientation_changed=i,this._centerOfRotation_changed=o)}}else this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());this.inside=!1,this.layerNode=null,this.setTraversed(!1)}}(),traverse:function(){const t=new dn,e=new Se(-1,-1,-1);return function(n,i){switch(n){case ja.CAMERA:return this.layerNode=i.getLayer(),void this.modelMatrix.assign(i.getModelViewMatrix().get());case ja.DISPLAY:if(this.setTraversed(!0),this.inside)return;return void(this._size.getValue().equals(e)?this.inside=!0:(t.assign(i.getModelViewMatrix().get()).inverse(),this.inside=this.containsPoint(t.origin)))}}}(),containsPoint:function(t){const e=this.min,n=this.max;return e.x<=t.x&&n.x>=t.x&&e.y<=t.y&&n.y>=t.y&&e.z<=t.z&&n.z>=t.z}});const IS=FS;n.set("x_ite/Components/EnvironmentalSensor/ProximitySensor",IS);const MS=IS,DS=bu(dn),RS=bu(dn);function VS(t){NS.call(this,t),this.addType(c.TransformSensor),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new Se,this.max=new Se,this.targetObjectNode=null,this.modelMatrices=[],this.targetMatrices=[]}VS.prototype=Object.assign(Object.create(NS.prototype),{constructor:VS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"size",new ji.SFVec3f),new k(c.inputOutput,"center",new ji.SFVec3f),new k(c.outputOnly,"enterTime",new ji.SFTime),new k(c.outputOnly,"exitTime",new ji.SFTime),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"position_changed",new ji.SFVec3f),new k(c.outputOnly,"orientation_changed",new ji.SFRotation),new k(c.inputOutput,"targetObject",new ji.SFNode)]),getTypeName:function(){return"TransformSensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){NS.prototype.initialize.call(this),this.getLive().addInterest("set_enabled__",this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._targetObject.addInterest("set_targetObject__",this),this.set_extents__(),this.set_targetObject__()},set_live__:function(){},set_enabled__:function(){this.getLive().getValue()&&this.targetObjectNode&&this._enabled.getValue()&&!this._size.getValue().equals(Se.Zero)?(this.setPickableObject(!0),this.getBrowser().addTransformSensor(this),this.targetObjectNode.addTransformSensor(this)):(this.setPickableObject(!1),this.getBrowser().removeTransformSensor(this),this.targetObjectNode&&this.targetObjectNode.removeTransformSensor(this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()))},set_extents__:function(){const t=this._size.getValue(),e=this._center.getValue(),n=t.x/2,i=t.y/2,o=t.z/2,r=e.x,s=e.y,a=e.z;this.min.set(r-n,s-i,a-o),this.max.set(r+n,s+i,a+o)},set_targetObject__:function(){this.targetObjectNode=null;try{const t=this._targetObject.getValue().getInnerNode(),e=t.getType();for(let n=e.length-1;n>=0;--n){switch(e[n]){case c.X3DGroupingNode:case c.X3DShapeNode:this.targetObjectNode=t;break;default:continue}break}}catch(t){}this.set_enabled__()},traverse:function(t,e){t===ja.PICKING&&this.isPickableObject()&&this.modelMatrices.push(DS.pop().assign(e.getModelViewMatrix().get()))},collect:function(t){this.targetMatrices.push(RS.pop().assign(t))},process:function(){const t=new Se(0,0,0),e=new an;return function(){const n=this.modelMatrices,i=this.targetMatrices,o=this.intersects();o?(o.get(t,e),this._isActive.getValue()?(this._position_changed.getValue().equals(t)||(this._position_changed=t),this._orientation_changed.getValue().equals(e)||(this._orientation_changed=e)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=t,this._orientation_changed=e)):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());for(const t of n)DS.push(t);for(const t of i)RS.push(t);n.length=0,i.length=0}}(),intersects:function(){const t=new Se(-1,-1,-1);return function(){const e=this.modelMatrices,n=this.targetMatrices,i=this._size.getValue().equals(t);for(const t of e){const e=t.inverse();for(const t of n){const n=t.multRight(e);if(i||this.containsPoint(n.origin))return n}}return null}}(),containsPoint:function(t){const e=this.min,n=this.max;return e.x<=t.x&&n.x>=t.x&&e.y<=t.y&&n.y>=t.y&&e.z<=t.z&&n.z>=t.z}});const AS=VS;n.set("x_ite/Components/EnvironmentalSensor/TransformSensor",AS);const PS=AS;function LS(t){NS.call(this,t),this.addType(c.VisibilitySensor),this.setZeroTest(!1),this.visible=!1}LS.prototype=Object.assign(Object.create(NS.prototype),{constructor:LS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"size",new ji.SFVec3f),new k(c.inputOutput,"center",new ji.SFVec3f),new k(c.outputOnly,"enterTime",new ji.SFTime),new k(c.outputOnly,"exitTime",new ji.SFTime),new k(c.outputOnly,"isActive",new ji.SFBool)]),getTypeName:function(){return"VisibilitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){NS.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__:function(){this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},update:function(){this.visible&&this.getTraversed()?(this._isActive.getValue()||(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime()),this.visible=!1):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()),this.setTraversed(!1)},traverse:function(){const t=new Qa,e=new Se(-1,-1,-1);return function(n,i){n===ja.DISPLAY&&(this.setTraversed(!0),this.visible||(this._size.getValue().equals(e)?this.visible=!0:(t.set(this._size.getValue(),this._center.getValue()).multRight(i.getModelViewMatrix().get()),this.visible=i.getViewVolume().intersectsBox(t))))}}()});const BS=LS;n.set("x_ite/Components/EnvironmentalSensor/VisibilitySensor",BS);const XS={ProximitySensor:MS,TransformSensor:PS,VisibilitySensor:BS},US={X3DEnvironmentalSensorNode:NS};for(const t in XS)Sr.addNodeType(t,XS[t]);for(const t in US)Sr.addAbstractNodeType(t,US[t]);const kS=void 0;n.set("x_ite/Components/EnvironmentalSensor",kS);var zS=new Se(0,0,0),jS=new Se(0,0,0),GS=new Se(0,0,0),HS=new Se(0,0,0);function qS(t){Zp.call(this,t),this.addType(c.ColorChaser)}qS.prototype=Object.assign(Object.create(Zp.prototype),{constructor:qS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFColor),new k(c.inputOnly,"set_destination",new ji.SFColor),new k(c.initializeOnly,"initialValue",new ji.SFColor(.8,.8,.8)),new k(c.initializeOnly,"initialDestination",new ji.SFColor(.8,.8,.8)),new k(c.initializeOnly,"duration",new ji.SFTime(1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFColor)]),getTypeName:function(){return"ColorChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.3","Infinity"]},getVector:function(){return new Se(0,0,0)},getValue:function(){return this._set_value.getValue().getHSV(HS)},getDestination:function(){return this._set_destination.getValue().getHSV(HS)},getInitialValue:function(){return this._initialValue.getValue().getHSV(zS)},getInitialDestination:function(){return this._initialDestination.getValue().getHSV(jS)},setValue:function(t){this._value_changed.setHSV(t.x,t.y,t.z)},interpolate:function(t,e,n){return Nt.lerp(t,e,n,HS)},step:function(t,e,n){GS.assign(this.output).add(t).subtract(e),Nt.lerp(this.output,GS,n,this.output)}});const YS=qS;n.set("x_ite/Components/Followers/ColorChaser",YS);const WS=YS;function KS(t){Wp.call(this,t),this.addType(c.X3DDamperNode)}KS.prototype=Object.assign(Object.create(Wp.prototype),{constructor:KS,initialize:function(){Wp.prototype.initialize.call(this),this._order.addInterest("set_order__",this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this);var t=this.getBuffer(),e=this.getInitialValue(),n=this.getInitialDestination();t[0]=this.duplicate(n);for(var i=1,o=this.getOrder()+1;i<o;++i)t[i]=this.duplicate(e);this.equals(n,e,this.getTolerance())?this.setValue(n):this.set_active(!0)},getOrder:function(){return d.clamp(this._order.getValue(),0,5)},getTolerance:function(){return this._tolerance.getValue()<0?1e-4:this._tolerance.getValue()},prepareEvents:function(){var t=this.getBuffer(),e=t.length-1;if(this._tau.getValue()){for(var n=1/this.getBrowser().currentFrameRate,i=Math.exp(-n/this._tau.getValue()),o=0;o<e;++o)this.assign(t,o+1,this.interpolate(t[o],t[o+1],i));if(this.setValue(t[e]),!this.equals(t[e],t[0],this.getTolerance()))return}else this.setValue(t[0]),e=0;o=1;for(var r=t.length;o<r;++o)this.assign(t,o,t[e]);this.set_active(!1)},set_value__:function(){for(var t=this.getBuffer(),e=this.getValue(),n=1,i=t.length;n<i;++n)this.assign(t,n,e);this.setValue(e),this.set_active(!0)},set_destination__:function(){this.assign(this.getBuffer(),0,this.getDestination()),this.set_active(!0)},set_order__:function(){for(var t=this.getBuffer(),e=t[t.length-1],n=t.length,i=this.getOrder()+1;n<i;++n)t[n]=this.duplicate(e);t.length=i}});const JS=KS;n.set("x_ite/Components/Followers/X3DDamperNode",JS);const ZS=JS;var QS=new Se(0,0,0),$S=new Se(0,0,0),tT=new Se(0,0,0),eT=new Se(0,0,0);function nT(t){ZS.call(this,t),this.addType(c.ColorDamper)}nT.prototype=Object.assign(Object.create(ZS.prototype),{constructor:nT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFColor),new k(c.inputOnly,"set_destination",new ji.SFColor),new k(c.initializeOnly,"initialValue",new ji.SFColor(.8,.8,.8)),new k(c.initializeOnly,"initialDestination",new ji.SFColor(.8,.8,.8)),new k(c.initializeOnly,"order",new ji.SFInt32(3)),new k(c.inputOutput,"tau",new ji.SFTime(.3)),new k(c.inputOutput,"tolerance",new ji.SFFloat(-1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFColor)]),getTypeName:function(){return"ColorDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new Se(0,0,0)},getValue:function(){return this._set_value.getValue().getHSV(eT)},getDestination:function(){return this._set_destination.getValue().getHSV(eT)},getInitialValue:function(){return this._initialValue.getValue().getHSV($S)},getInitialDestination:function(){return this._initialDestination.getValue().getHSV(tT)},setValue:function(t){this._value_changed.setHSV(t.x,t.y,t.z)},equals:function(t,e,n){return QS.assign(t).subtract(e).magnitude()<n},interpolate:function(t,e,n){return Nt.lerp(t,e,n,eT)}});const iT=nT;n.set("x_ite/Components/Followers/ColorDamper",iT);const oT=iT;const rT=function(t){function e(){this.array=this.getArray(),this.zero=this.getVector()}return e.prototype={getArray:function(){const t=[];return t.assign=function(t){if(Array.isArray(t)){for(var e=0,n=Math.min(this.length,t.length);e<n;++e)this[e].assign(t[e]);for(e=n,n=t.length;e<n;++e)this[e]=t[e].copy();this.length=n}else{for(e=0,n=Math.min(this.length,t.length);e<n;++e)this[e].assign(t[e].getValue());for(e=n,n=t.length;e<n;++e)this[e]=t[e].getValue().copy();this.length=n}},t},getValue:function(){return this._set_value},getDestination:function(){return this._set_destination},getInitialValue:function(){return this._initialValue},getInitialDestination:function(){return this._initialDestination},setValue:function(t){if(Array.isArray(t)){const i=this._value_changed;for(var e=0,n=t.length;e<n;++e)i[e]=t[e];i.length=n}else this._value_changed=t},duplicate:function(t){const e=this.getArray();return e.assign(t),e},equals:function(t,e,n){if(t.length!==e.length)return!1;const i=this.a;let o=0;for(let n=0,r=t.length;n<r;++n)o=Math.max(i.assign(t[n]).subtract(e[n]).magnitude());return o<n},interpolate:function(t,e,n){const i=this.array;i.assign(t);for(let t=0,o=i.length;t<o;++t)i[t].lerp(e[t]||this.zero,n);return i},set_destination__:function(){const e=this.getBuffer(),n=this._set_destination.length;for(let t=0,i=e.length;t<i;++t){const i=e[t];for(let t=i.length;t<n;++t)i[t]=this.getVector();i.length=n}t.prototype.set_destination__.call(this)}},e};n.set("x_ite/Browser/Followers/X3DArrayFollowerTemplate",rT);const sT=rT;const aT=function(t){const e=sT(t);function n(){e.call(this),this.array=this.getArray()}return Object.assign(n.prototype,e.prototype,{step:function(t,e,n){const i=this.output,o=this.deltaOut;for(let r=0,s=i.length;r<s;++r)i[r].add(o.assign(t[r]||this.zero).subtract(e[r]||this.zero).multiply(n))}}),n};n.set("x_ite/Browser/Followers/X3DArrayChaserTemplate",aT);const uT=aT;var cT=uT(Zp);function lT(t){Zp.call(this,t),cT.call(this,t),this.addType(c.CoordinateChaser)}lT.prototype=Object.assign(Object.create(Zp.prototype),cT.prototype,{constructor:lT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.MFVec3f),new k(c.inputOnly,"set_destination",new ji.MFVec3f),new k(c.initializeOnly,"initialValue",new ji.MFVec3f(new Se(0,0,0))),new k(c.initializeOnly,"initialDestination",new ji.MFVec3f(new Se(0,0,0))),new k(c.initializeOnly,"duration",new ji.SFTime(1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.MFVec3f)]),getTypeName:function(){return"CoordinateChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.3","Infinity"]},getVector:function(){return new Se(0,0,0)}});const hT=lT;n.set("x_ite/Components/Followers/CoordinateChaser",hT);const dT=hT;var pT=sT(ZS);function fT(t){ZS.call(this,t),pT.call(this,t),this.addType(c.CoordinateDamper)}fT.prototype=Object.assign(Object.create(ZS.prototype),pT.prototype,{constructor:fT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.MFVec3f),new k(c.inputOnly,"set_destination",new ji.MFVec3f),new k(c.initializeOnly,"initialValue",new ji.MFVec3f(new Se(0,0,0))),new k(c.initializeOnly,"initialDestination",new ji.MFVec3f(new Se(0,0,0))),new k(c.initializeOnly,"order",new ji.SFInt32(3)),new k(c.inputOutput,"tau",new ji.SFTime(.3)),new k(c.inputOutput,"tolerance",new ji.SFFloat(-1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.MFVec3f)]),getTypeName:function(){return"CoordinateDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new Se(0,0,0)}});const gT=fT;n.set("x_ite/Components/Followers/CoordinateDamper",gT);const mT=gT;var _T=new an,xT=new an;function yT(t){ZS.call(this,t),this.addType(c.OrientationDamper),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}yT.prototype=Object.assign(Object.create(ZS.prototype),{constructor:yT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFRotation),new k(c.inputOnly,"set_destination",new ji.SFRotation),new k(c.initializeOnly,"initialValue",new ji.SFRotation),new k(c.initializeOnly,"initialDestination",new ji.SFRotation),new k(c.initializeOnly,"order",new ji.SFInt32(3)),new k(c.inputOutput,"tau",new ji.SFTime(.3)),new k(c.inputOutput,"tolerance",new ji.SFFloat(-1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFRotation)]),getTypeName:function(){return"OrientationDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new an},equals:function(t,e,n){return _T.assign(t).inverse().multRight(e),Math.abs(_T.angle)<n},interpolate:function(t,e,n){return xT.assign(t).slerp(e,n)}});const wT=yT;n.set("x_ite/Components/Followers/OrientationDamper",wT);const ST=wT;function TT(t){Zp.call(this,t),this.addType(c.PositionChaser2D)}TT.prototype=Object.assign(Object.create(Zp.prototype),{constructor:TT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFVec2f),new k(c.inputOnly,"set_destination",new ji.SFVec2f),new k(c.initializeOnly,"initialValue",new ji.SFVec2f),new k(c.initializeOnly,"initialDestination",new ji.SFVec2f),new k(c.initializeOnly,"duration",new ji.SFTime(1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFVec2f)]),getTypeName:function(){return"PositionChaser2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new ge(0,0)}});const bT=TT;n.set("x_ite/Components/Followers/PositionChaser2D",bT);const vT=bT;function ET(t){ZS.call(this,t),this.addType(c.PositionDamper)}ET.prototype=Object.assign(Object.create(ZS.prototype),{constructor:ET,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFVec3f),new k(c.inputOnly,"set_destination",new ji.SFVec3f),new k(c.initializeOnly,"initialValue",new ji.SFVec3f),new k(c.initializeOnly,"initialDestination",new ji.SFVec3f),new k(c.initializeOnly,"order",new ji.SFInt32(3)),new k(c.inputOutput,"tolerance",new ji.SFFloat(-1)),new k(c.inputOutput,"tau",new ji.SFTime(.3)),new k(c.outputOnly,"value_changed",new ji.SFVec3f),new k(c.outputOnly,"isActive",new ji.SFBool)]),getTypeName:function(){return"PositionDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new Se(0,0,0)}});const CT=ET;n.set("x_ite/Components/Followers/PositionDamper",CT);const OT=CT;function NT(t){ZS.call(this,t),this.addType(c.PositionDamper2D)}NT.prototype=Object.assign(Object.create(ZS.prototype),{constructor:NT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFVec2f),new k(c.inputOnly,"set_destination",new ji.SFVec2f),new k(c.initializeOnly,"initialValue",new ji.SFVec2f),new k(c.initializeOnly,"initialDestination",new ji.SFVec2f),new k(c.initializeOnly,"order",new ji.SFInt32(3)),new k(c.inputOutput,"tau",new ji.SFTime(.3)),new k(c.inputOutput,"tolerance",new ji.SFFloat(-1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFVec2f)]),getTypeName:function(){return"PositionDamper2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new ge(0,0)}});const FT=NT;n.set("x_ite/Components/Followers/PositionDamper2D",FT);const IT=FT;function MT(t){Zp.call(this,t),this.addType(c.ScalarChaser)}MT.prototype=Object.assign(Object.create(Zp.prototype),{constructor:MT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFFloat),new k(c.inputOnly,"set_destination",new ji.SFFloat),new k(c.initializeOnly,"initialValue",new ji.SFFloat),new k(c.initializeOnly,"initialDestination",new ji.SFFloat),new k(c.initializeOnly,"duration",new ji.SFTime(1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFFloat)]),getTypeName:function(){return"ScalarChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return 0},setPreviousValue:function(t){this.previousValue=t},setDestination:function(t){this.destination=t},duplicate:function(t){return t},assign:function(t,e,n){t[e]=n},equals:function(t,e,n){return Math.abs(t-e)<n},interpolate:function(t,e,n){return d.lerp(t,e,n)},step:function(t,e,n){this.output+=(t-e)*n}});const DT=MT;n.set("x_ite/Components/Followers/ScalarChaser",DT);const RT=DT;function VT(t){ZS.call(this,t),this.addType(c.ScalarDamper)}VT.prototype=Object.assign(Object.create(ZS.prototype),{constructor:VT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.SFFloat),new k(c.inputOnly,"set_destination",new ji.SFFloat),new k(c.initializeOnly,"initialValue",new ji.SFFloat),new k(c.initializeOnly,"initialDestination",new ji.SFFloat),new k(c.initializeOnly,"order",new ji.SFInt32(3)),new k(c.inputOutput,"tau",new ji.SFTime(.3)),new k(c.inputOutput,"tolerance",new ji.SFFloat(-1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFFloat)]),getTypeName:function(){return"ScalarDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.3","Infinity"]},getVector:function(){return 0},duplicate:function(t){return t},assign:function(t,e,n){t[e]=n},equals:function(t,e,n){return Math.abs(t-e)<n},interpolate:function(t,e,n){return d.lerp(t,e,n)}});const AT=VT;n.set("x_ite/Components/Followers/ScalarDamper",AT);const PT=AT;var LT=uT(Zp);function BT(t){Zp.call(this,t),LT.call(this,t),this.addType(c.TexCoordChaser2D)}BT.prototype=Object.assign(Object.create(Zp.prototype),LT.prototype,{constructor:BT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.MFVec2f),new k(c.inputOnly,"set_destination",new ji.MFVec2f),new k(c.initializeOnly,"initialValue",new ji.MFVec2f),new k(c.initializeOnly,"initialDestination",new ji.MFVec2f),new k(c.initializeOnly,"duration",new ji.SFTime(1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.MFVec2f)]),getTypeName:function(){return"TexCoordChaser2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.3","Infinity"]},getVector:function(){return new ge(0,0)}});const XT=BT;n.set("x_ite/Components/Followers/TexCoordChaser2D",XT);const UT=XT;var kT=sT(ZS);function zT(t){ZS.call(this,t),kT.call(this,t),this.addType(c.TexCoordDamper2D)}zT.prototype=Object.assign(Object.create(ZS.prototype),kT.prototype,{constructor:zT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_value",new ji.MFVec2f),new k(c.inputOnly,"set_destination",new ji.MFVec2f),new k(c.initializeOnly,"initialValue",new ji.MFVec2f),new k(c.initializeOnly,"initialDestination",new ji.MFVec2f),new k(c.initializeOnly,"order",new ji.SFInt32(3)),new k(c.inputOutput,"tau",new ji.SFTime(.3)),new k(c.inputOutput,"tolerance",new ji.SFFloat(-1)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.MFVec2f)]),getTypeName:function(){return"TexCoordDamper2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},getVector:function(){return new ge(0,0,0)}});const jT=zT;n.set("x_ite/Components/Followers/TexCoordDamper2D",jT);const GT={ColorChaser:WS,ColorDamper:oT,CoordinateChaser:dT,CoordinateDamper:mT,OrientationChaser:sf,OrientationDamper:ST,PositionChaser:tf,PositionChaser2D:vT,PositionDamper:OT,PositionDamper2D:IT,ScalarChaser:RT,ScalarDamper:PT,TexCoordChaser2D:UT,TexCoordDamper2D:jT},HT={X3DChaserNode:Zp,X3DDamperNode:ZS,X3DFollowerNode:Wp};for(const t in GT)Sr.addNodeType(t,GT[t]);for(const t in HT)Sr.addAbstractNodeType(t,HT[t]);const qT=void 0;n.set("x_ite/Components/Followers",qT);function YT(t){Bu.call(this,t),this.addType(c.Box),this._size.setUnit("length")}YT.prototype=Object.assign(Object.create(Bu.prototype),{constructor:YT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"size",new ji.SFVec3f(2,2,2)),new k(c.initializeOnly,"solid",new ji.SFBool(!0))]),getTypeName:function(){return"Box"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},build:function(){const t=new Se(2,2,2);return function(){const e=this.getBrowser().getBoxOptions().getGeometry(),n=this._size.getValue();if(this.setMultiTexCoords(e.getMultiTexCoords()),this.setNormals(e.getNormals()),n.equals(t))this.setVertices(e.getVertices()),this.getMin().assign(e.getMin()),this.getMax().assign(e.getMax());else{const t=Math.abs(n.x/2),i=Math.abs(n.y/2),o=Math.abs(n.z/2),r=e.getVertices().getValue(),s=this.getVertices();for(let e=0,n=r.length;e<n;e+=4)s.push(t*r[e],i*r[e+1],o*r[e+2],1);this.getMin().set(-t,-i,-o),this.getMax().set(t,i,o)}this.setSolid(this._solid.getValue())}}()});const WT=YT;n.set("x_ite/Components/Geometry3D/Box",WT);const KT=WT;function JT(t){Bu.call(this,t),this.addType(c.Cone),this._height.setUnit("length"),this._bottomRadius.setUnit("length")}JT.prototype=Object.assign(Object.create(Bu.prototype),{constructor:JT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"side",new ji.SFBool(!0)),new k(c.inputOutput,"bottom",new ji.SFBool(!0)),new k(c.initializeOnly,"height",new ji.SFFloat(2)),new k(c.initializeOnly,"bottomRadius",new ji.SFFloat(1)),new k(c.initializeOnly,"solid",new ji.SFBool(!0))]),getTypeName:function(){return"Cone"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},set_live__:function(){Bu.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getConeOptions().addInterest("requestRebuild",this):this.getBrowser().getConeOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getConeOptions()._xDimension.getValue(),e=this._height.getValue(),n=this._bottomRadius.getValue(),i=this.getTexCoords(),o=this.getNormals(),r=this.getVertices();this.getMultiTexCoords().push(i);const s=e/2,a=-s,u=Ks.Polar(1,-Math.PI/2+Math.atan(n/e));if(this._side.getValue())for(let e=0;e<t;++e){const c=(e+.5)/t,l=2*Math.PI*c,h=Ks.Polar(u.imag,l),d=e/t,p=2*Math.PI*d,f=Ks.Polar(-n,p),g=Ks.Polar(u.imag,p),m=(e+1)/t,_=2*Math.PI*m,x=Ks.Polar(-n,_),y=Ks.Polar(u.imag,_);i.push(c,1,0,1),o.push(h.imag,u.real,h.real),r.push(0,s,0,1),i.push(d,0,0,1),o.push(g.imag,u.real,g.real),r.push(f.imag,a,f.real,1),i.push(m,0,0,1),o.push(y.imag,u.real,y.real),r.push(x.imag,a,x.real,1)}if(this._bottom.getValue()){const e=[],s=[];for(let i=t-1;i>-1;--i){const o=i/t,r=2*Math.PI*o,u=Ks.Polar(-1,r),c=u.copy().multiply(n);e.push(new ge((u.imag+1)/2,(u.real+1)/2)),s.push(new Se(c.imag,a,c.real))}const u=e[0],c=s[0];for(let t=1,n=s.length-1;t<n;++t){const n=e[t],a=e[t+1],l=s[t],h=s[t+1];i.push(u.x,u.y,0,1),o.push(0,-1,0),r.push(c.x,c.y,c.z,1),i.push(n.x,n.y,0,1),o.push(0,-1,0),r.push(l.x,l.y,l.z,1),i.push(a.x,a.y,0,1),o.push(0,-1,0),r.push(h.x,h.y,h.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents:function(){const t=this._bottomRadius.getValue(),e=this._height.getValue()/2,n=-e;this._side.getValue()||this._bottom.getValue()?this._side.getValue()?(this.getMin().set(-t,n,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,n,-t),this.getMax().set(t,n,t)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}});const ZT=JT;n.set("x_ite/Components/Geometry3D/Cone",ZT);const QT=ZT;function $T(t){Bu.call(this,t),this.addType(c.Cylinder),this._height.setUnit("length"),this._radius.setUnit("length")}$T.prototype=Object.assign(Object.create(Bu.prototype),{constructor:$T,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"top",new ji.SFBool(!0)),new k(c.inputOutput,"side",new ji.SFBool(!0)),new k(c.inputOutput,"bottom",new ji.SFBool(!0)),new k(c.initializeOnly,"height",new ji.SFFloat(2)),new k(c.initializeOnly,"radius",new ji.SFFloat(1)),new k(c.initializeOnly,"solid",new ji.SFBool(!0))]),getTypeName:function(){return"Cylinder"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},set_live__:function(){Bu.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getCylinderOptions().addInterest("requestRebuild",this):this.getBrowser().getCylinderOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getCylinderOptions()._xDimension.getValue(),e=this.getTexCoords(),n=this.getNormals(),i=this.getVertices();this.getMultiTexCoords().push(e);const o=this._radius.getValue(),r=this._height.getValue()/2,s=-r;if(this._side.getValue())for(let a=0;a<t;++a){const u=a/t,c=2*Math.PI*u,l=Ks.Polar(-1,c),h=l.copy().multiply(o),d=(a+1)/t,p=2*Math.PI*d,f=Ks.Polar(-1,p),g=f.copy().multiply(o);e.push(u,1,0,1),n.push(l.imag,0,l.real),i.push(h.imag,r,h.real,1),e.push(u,0,0,1),n.push(l.imag,0,l.real),i.push(h.imag,s,h.real,1),e.push(d,0,0,1),n.push(f.imag,0,f.real),i.push(g.imag,s,g.real,1),e.push(u,1,0,1),n.push(l.imag,0,l.real),i.push(h.imag,r,h.real,1),e.push(d,0,0,1),n.push(f.imag,0,f.real),i.push(g.imag,s,g.real,1),e.push(d,1,0,1),n.push(f.imag,0,f.real),i.push(g.imag,r,g.real,1)}if(this._top.getValue()){const s=[],a=[];for(let e=0;e<t;++e){const n=e/t,i=2*Math.PI*n,u=Ks.Polar(-1,i);s.push(new ge((u.imag+1)/2,-(u.real-1)/2)),a.push(new Se(u.imag*o,r,u.real*o))}const u=s[0],c=a[0];for(let t=1,o=a.length-1;t<o;++t){const o=s[t],r=s[t+1],l=a[t],h=a[t+1];e.push(u.x,u.y,0,1),n.push(0,1,0),i.push(c.x,c.y,c.z,1),e.push(o.x,o.y,0,1),n.push(0,1,0),i.push(l.x,l.y,l.z,1),e.push(r.x,r.y,0,1),n.push(0,1,0),i.push(h.x,h.y,h.z,1)}}if(this._bottom.getValue()){const r=[],a=[];for(let e=t-1;e>-1;--e){const n=e/t,i=2*Math.PI*n,u=Ks.Polar(-1,i);r.push(new ge((u.imag+1)/2,(u.real+1)/2)),a.push(new Se(u.imag*o,s,u.real*o))}const u=r[0],c=a[0];for(let t=1,o=a.length-1;t<o;++t){const o=r[t],s=r[t+1],l=a[t],h=a[t+1];e.push(u.x,u.y,0,1),n.push(0,-1,0),i.push(c.x,c.y,c.z,1),e.push(o.x,o.y,0,1),n.push(0,-1,0),i.push(l.x,l.y,l.z,1),e.push(s.x,s.y,0,1),n.push(0,-1,0),i.push(h.x,h.y,h.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents:function(){const t=this._radius.getValue(),e=this._height.getValue()/2,n=-e;this._top.getValue()||this._side.getValue()||this._bottom.getValue()?this._top.getValue()||this._side.getValue()?this._bottom.getValue()||this._side.getValue()?(this.getMin().set(-t,n,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,e,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,n,-t),this.getMax().set(t,n,t)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}});const tb=$T;n.set("x_ite/Components/Geometry3D/Cylinder",tb);const eb=tb;function nb(t){Bu.call(this,t),this.addType(c.ElevationGrid),this._xSpacing.setUnit("length"),this._zSpacing.setUnit("length"),this._creaseAngle.setUnit("angle"),this._height.setUnit("length"),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}nb.prototype=Object.assign(Object.create(Bu.prototype),{constructor:nb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_height",new ji.MFFloat),new k(c.initializeOnly,"xDimension",new ji.SFInt32),new k(c.initializeOnly,"zDimension",new ji.SFInt32),new k(c.initializeOnly,"xSpacing",new ji.SFFloat(1)),new k(c.initializeOnly,"zSpacing",new ji.SFFloat(1)),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"creaseAngle",new ji.SFFloat),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"normalPerVertex",new ji.SFBool(!0)),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.initializeOnly,"height",new ji.MFFloat)]),getTypeName:function(){return"ElevationGrid"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Bu.prototype.initialize.call(this),this._set_height.addFieldInterest(this._height),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=rc(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=rc(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=rc(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_texCoord__:function(){this.texCoordNode?.removeInterest("requestRebuild",this),this.texCoordNode=rc(c.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode?.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__:function(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=rc(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getHeight:function(t){return t<this._height.length?this._height[t]:0},createTexCoords:function(){const t=[],e=this._xDimension.getValue(),n=this._zDimension.getValue(),i=e-1,o=n-1;for(let r=0;r<n;++r)for(let n=0;n<e;++n)t.push(new ge(n/i,r/o));return t},createNormals:function(t,e,n){const i=!this._ccw.getValue(),o=[],r=[];for(let e=0,n=t.length;e<n;++e)o[e]=[];for(let n=0,s=e.length;n<s;n+=3){const s=e[n],a=e[n+1],u=e[n+2];o[s].push(r.length),o[a].push(r.length+1),o[u].push(r.length+2);const c=Oa.normal(t[s],t[a],t[u],new Se(0,0,0));i&&c.negate(),r.push(c),r.push(c),r.push(c)}return this.refineNormals(o,r,this._creaseAngle.getValue())},createCoordIndex:function(){const t=[],e=this._xDimension.getValue(),n=e-1,i=this._zDimension.getValue()-1;for(let o=0;o<i;++o)for(let i=0;i<n;++i){const n=o*e+i,r=(o+1)*e+i,s=(o+1)*e+(i+1),a=o*e+(i+1);t.push(n),t.push(r),t.push(s),t.push(n),t.push(s),t.push(a)}return t},createPoints:function(){const t=[],e=this._xDimension.getValue(),n=this._zDimension.getValue(),i=this._xSpacing.getValue(),o=this._zSpacing.getValue();for(let r=0;r<n;++r)for(let n=0;n<e;++n)t.push(new Se(i*n,this.getHeight(n+r*e),o*r));return t},build:function(){if(this._xDimension.getValue()<2||this._zDimension.getValue()<2)return;const t=this._colorPerVertex.getValue(),e=this._normalPerVertex.getValue(),n=this.createCoordIndex(),i=this.getAttrib(),o=i.length,r=this.getAttribs(),s=this.fogCoordNode,a=this.getColor(),u=this.getTexCoord(),c=this.getNormal(),l=this.createPoints(),h=this.getFogDepths(),d=this.getColors(),p=this.getMultiTexCoords(),f=this.getNormals(),g=this.getVertices();let m=0;if(u)u.init(p);else{var _=this.createTexCoords(),x=this.getTexCoords();p.push(x)}for(let y=0,w=n.length;y<w;++m)for(let w=0;w<6;++w,++y){const w=n[y],S=l[w];for(let t=0;t<o;++t)i[t].addValue(w,r[t]);if(s?.addDepth(w,h),a&&(t?a.addColor(w,d):a.addColor(m,d)),u)u.addPoint(w,p);else{const t=_[w];x.push(t.x,t.y,0,1)}c&&(e?c.addVector(w,f):c.addVector(m,f)),g.push(S.x,S.y,S.z,1)}if(!c){const t=this.createNormals(l,n);for(const e of t)f.push(e.x,e.y,e.z)}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}});const ib=nb;n.set("x_ite/Components/Geometry3D/ElevationGrid",ib);const ob=ib;function rb(t){Bu.call(this,t),this.addType(c.Extrusion),this._creaseAngle.setUnit("angle"),this._crossSection.setUnit("length"),this._spine.setUnit("length")}rb.prototype=Object.assign(Object.create(Bu.prototype),{constructor:rb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_crossSection",new ji.MFVec2f),new k(c.inputOnly,"set_orientation",new ji.MFRotation),new k(c.inputOnly,"set_scale",new ji.MFVec2f),new k(c.inputOnly,"set_spine",new ji.MFVec3f),new k(c.initializeOnly,"beginCap",new ji.SFBool(!0)),new k(c.initializeOnly,"endCap",new ji.SFBool(!0)),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"convex",new ji.SFBool(!0)),new k(c.initializeOnly,"creaseAngle",new ji.SFFloat),new k(c.initializeOnly,"crossSection",new ji.MFVec2f(new ge(1,1),new ge(1,-1),new ge(-1,-1),new ge(-1,1),new ge(1,1))),new k(c.initializeOnly,"orientation",new ji.MFRotation(new an)),new k(c.initializeOnly,"scale",new ji.MFVec2f(new ge(1,1))),new k(c.initializeOnly,"spine",new ji.MFVec3f(new Se(0,0,0),new Se(0,1,0)))]),getTypeName:function(){return"Extrusion"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Bu.prototype.initialize.call(this),this._set_crossSection.addFieldInterest(this._crossSection),this._set_orientation.addFieldInterest(this._orientation),this._set_scale.addFieldInterest(this._scale),this._set_spine.addFieldInterest(this._spine)},getClosedOrientation:function(){const t=this._orientation;if(t.length){const e=t[0].getValue(),n=t[t.length-1].getValue();return e.equals(n)}return!0},createPoints:function(){const t=new Se(1,1,1);return function(){const e=this._crossSection,n=this._orientation,i=this._scale,o=this._spine,r=[],s=this.createRotations();for(let a=0,u=o.length;a<u;++a){const o=s[a];if(n.length&&o.rotate(n[Math.min(a,n.length-1)].getValue()),i.length){const e=i[Math.min(a,i.length-1)].getValue();o.scale(t.set(e.x,1,e.y))}for(let t=0,n=e.length;t<n;++t){const n=e[t].getValue();r.push(o.multVecMatrix(new Se(n.x,0,n.y)))}}return r}}(),createRotations:function(){const t=[],e=new Se(0,0,0),n=new Se(0,0,0),i=new Se(0,0,0),o=new Se(0,0,0),r=new Se(0,0,0),s=new Se(0,0,0),a=new an;return function(){const u=this._spine,c=u.length,l=u[0].getValue(),h=u[u.length-1].getValue(),d=l.equals(h)&&this.getClosedOrientation();for(let e=t.length;e<c;++e)t[e]=new dn;if(t.length=c,e.set(0,0,0),n.set(0,0,0),i.set(0,0,0),d){const t=l;for(let e=1,i=c-2;e<i&&(n.assign(u[e].getValue()).subtract(t).normalize().subtract(s.assign(u[i].getValue()).subtract(t).normalize()).normalize(),n.equals(Se.Zero));++e);for(let t=0,e=c-2;t<e&&(i.assign(u[t+1].getValue()).subtract(u[t].getValue()).cross(s.assign(u[e].getValue()).subtract(u[t].getValue())).normalize(),i.equals(Se.Zero));++t);}else{for(let t=0,e=c-1;t<e&&(n.assign(u[t+1].getValue()).subtract(u[t].getValue()).normalize(),n.equals(Se.Zero));++t);for(let t=1,e=c-1;t<e&&(i.assign(u[t+1].getValue()).subtract(u[t].getValue()).cross(s.assign(u[t-1].getValue()).subtract(u[t].getValue())).normalize(),i.equals(Se.Zero));++t);}n.equals(Se.Zero)&&n.set(0,1,0),i.equals(Se.Zero)&&a.setFromToVec(Se.yAxis,n).multVecRot(i.assign(Se.zAxis)),e.assign(n).cross(i);const p=l;t[0].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,p.x,p.y,p.z,1),o.assign(n),r.assign(i);for(let a=1,l=c-1;a<l;++a){const c=u[a].getValue();n.assign(u[a+1].getValue()).subtract(c).normalize().subtract(s.assign(u[a-1].getValue()).subtract(c).normalize()).normalize(),i.assign(u[a+1].getValue()).subtract(c).cross(s.assign(u[a-1].getValue()).subtract(c)).normalize(),r.dot(i)<0&&i.negate(),n.equals(Se.Zero)?n.assign(o):o.assign(n),i.equals(Se.Zero)?i.assign(r):r.assign(i),e.assign(n).cross(i),t[a].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,c.x,c.y,c.z,1)}if(d)t[c-1].assign(t[0]);else{const a=h;n.assign(a).subtract(u[c-2].getValue()).normalize(),c>2&&i.assign(a).subtract(u[c-2].getValue()).cross(s.assign(u[c-3].getValue()).subtract(u[c-2].getValue())).normalize(),r.dot(i)<0&&i.negate(),n.equals(Se.Zero)&&n.assign(o),i.equals(Se.Zero)&&i.assign(r),e.assign(n).cross(i),t[c-1].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,a.x,a.y,a.z,1)}return t}}(),build:function(){const t=new ge(0,0,0),e=new ge(0,0,0),n=new ge(0,0,0);return function(){const i=!this._ccw.getValue(),o=this._crossSection,r=this._spine,s=r.length,a=this.getTexCoords();if(s<2||o.length<2)return;this.getMultiTexCoords().push(a);const u=o.length;function c(t,e){return t*u+e}const l=r[0].getValue(),h=r[s-1].getValue(),d=l.equals(h)&&this.getClosedOrientation(),p=o[0].getValue(),f=o[o.length-1].getValue(),g=p.equals(f);t.assign(o[0].getValue()),e.assign(o[0].getValue());for(let n=1,i=o.length;n<i;++n)t.min(o[n].getValue()),e.max(o[n].getValue());const m=n.assign(e).subtract(t),_=Math.max(m.x,m.y),x=g?o.length-1:o.length,y=[],w=[],S=this.createPoints();for(let t=0,e=S.length;t<e;++t)y[t]=[];const T=this.getNormals(),b=this.getVertices(),v=o.length-1,E=s-1;let C=c(0,0),O=c(0,g?0:v);for(let t=0;t<E;++t)for(let e=0;e<v;++e){const n=d&&t===s-2?0:t+1,r=g&&e===o.length-2?0:e+1;let u=c(t,e),l=c(t,r),h=c(n,r),p=c(n,e),f=S[u],m=S[l],_=S[h],x=S[p],T=m.distance(_)>=1e-7,I=x.distance(f)>=1e-7;if(i)var N=Oa.normal(_,m,f,new Se(0,0,0)),F=Oa.normal(x,_,f,new Se(0,0,0));else N=Oa.normal(f,m,_,new Se(0,0,0)),F=Oa.normal(f,_,x,new Se(0,0,0));if(0==e&&(I?C=u:(u=C,f=S[u])),e==o.length-2&&(T?O=l:(h=O,_=S[h])),T){if(I)a.push(e/v,t/E,0,1);else{const n=(t/E+(t+1)/E)/2;a.push(e/v,n,0,1)}y[u].push(w.length),w.push(N),b.push(f.x,f.y,f.z,1),a.push((e+1)/v,t/E,0,1),y[l].push(w.length),w.push(N),b.push(m.x,m.y,m.z,1),a.push((e+1)/v,(t+1)/E,0,1),y[h].push(w.length),w.push(N),b.push(_.x,_.y,_.z,1)}if(I){if(a.push(e/v,t/E,0,1),y[u].push(w.length),w.push(F),b.push(f.x,f.y,f.z,1),T)a.push((e+1)/v,(t+1)/E,0,1);else{const n=((t+1)/E+t/E)/2;a.push((e+1)/v,n,0,1)}y[h].push(w.length),w.push(F),b.push(_.x,_.y,_.z,1),a.push(e/v,(t+1)/E,0,1),y[p].push(w.length),w.push(F),b.push(x.x,x.y,x.z,1)}}const I=this.refineNormals(y,w,this._creaseAngle.getValue());for(const t of I)T.push(t.x,t.y,t.z);if(_&&x>2){if(this._beginCap.getValue()){const e=0,n=this._convex.getValue(),r={},s=[],u=[];for(let i=0;i<x;++i){const a=c(e,x-1-i),u=S[a].copy();u.index=a,r[a]=o[x-1-i].getValue().copy().subtract(t).divide(_),s.push(n?a:u)}if(n?Oa.triangulateConvexPolygon(s,u):Oa.triangulatePolygon(s,u),u.length>=3){const t=Oa.normal(S[u[0]],S[u[1]],S[u[2]],new Se(0,0,0));i&&t.negate(),this.addCap(a,r,t,S,u)}}if(this._endCap.getValue()){const e=s-1,n=this._convex.getValue(),r={},u=[],l=[];for(let i=0;i<x;++i){const s=c(e,i),a=S[s].copy();a.index=s,r[s]=o[i].getValue().copy().subtract(t).divide(_),u.push(n?s:a)}if(n?Oa.triangulateConvexPolygon(u,l):Oa.triangulatePolygon(u,l),l.length>=3){const t=Oa.normal(S[l[0]],S[l[1]],S[l[2]],new Se(0,0,0));i&&t.negate(),this.addCap(a,r,t,S,l)}}}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}(),addCap:function(t,e,n,i,o){const r=this.getNormals(),s=this.getVertices();for(let a=0,u=o.length;a<u;a+=3){const u=i[o[a]],c=i[o[a+1]],l=i[o[a+2]],h=e[o[a]],d=e[o[a+1]],p=e[o[a+2]];t.push(h.x,h.y,0,1),t.push(d.x,d.y,0,1),t.push(p.x,p.y,0,1),r.push(n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z),s.push(u.x,u.y,u.z,1,c.x,c.y,c.z,1,l.x,l.y,l.z,1)}}});const sb=rb;n.set("x_ite/Components/Geometry3D/Extrusion",sb);const ab=sb;function ub(t){Bu.call(this,t),this.addType(c.Sphere),this._radius.setUnit("length")}ub.prototype=Object.assign(Object.create(Bu.prototype),{constructor:ub,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"radius",new ji.SFFloat(1)),new k(c.initializeOnly,"solid",new ji.SFBool(!0))]),getTypeName:function(){return"Sphere"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},set_live__:function(){Bu.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getSphereOptions().addInterest("requestRebuild",this):this.getBrowser().getSphereOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getSphereOptions().getGeometry(),e=Math.abs(this._radius.getValue());if(this.setMultiTexCoords(t.getMultiTexCoords()),this.setNormals(t.getNormals()),1===e)this.setVertices(t.getVertices()),this.getMin().assign(t.getMin()),this.getMax().assign(t.getMax());else{const n=t.getVertices().getValue(),i=this.getVertices();for(let t=0,o=n.length;t<o;t+=4)i.push(e*n[t],e*n[t+1],e*n[t+2],1);this.getMin().set(-e,-e,-e),this.getMax().set(e,e,e)}this.setSolid(this._solid.getValue())}});const cb=ub;n.set("x_ite/Components/Geometry3D/Sphere",cb);const lb={Box:KT,Cone:QT,Cylinder:eb,ElevationGrid:ob,Extrusion:ab,IndexedFaceSet:Od,Sphere:cb},hb={};for(const t in lb)Sr.addNodeType(t,lb[t]);for(const t in hb)Sr.addAbstractNodeType(t,hb[t]);const db=void 0;n.set("x_ite/Components/Geometry3D",db);const pb=Symbol(),fb=Symbol(),gb=Symbol(),mb=Symbol(),_b=Symbol();function xb(t){fu.call(this,t),el.call(this,t),this.addType(c.StaticGroup),this.groupNode=new ul(this.getExecutionContext()),this.bbox=new Qa,this.shadowBBox=new Qa}function yb(t,e){this.groupNode.traverse(t,e)}xb.prototype=Object.assign(Object.create(fu.prototype),el.prototype,{constructor:xb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.initializeOnly,"children",new ji.MFNode)]),getTypeName:function(){return"StaticGroup"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){fu.prototype.initialize.call(this),el.prototype.initialize.call(this),this.getBrowser().getBrowserOptions()._OptimizeStaticGroup.addInterest("set_optimize__",this),this._bboxSize.addFieldInterest(this.groupNode._bboxSize),this._bboxCenter.addFieldInterest(this.groupNode._bboxCenter),this._children.addFieldInterest(this.groupNode._children),this.groupNode._bboxSize=this._bboxSize,this.groupNode._bboxCenter=this._bboxCenter,this.groupNode._children=this._children,this.groupNode.setPrivate(!0),this.groupNode.setup(),this.groupNode._isCameraObject.addFieldInterest(this._isCameraObject),this.groupNode._isPickableObject.addFieldInterest(this._isPickableObject),this.groupNode._children.addInterest("set_children__",this),this.setCameraObject(this.groupNode.isCameraObject()),this.setPickableObject(this.groupNode.isPickableObject()),this.set_optimize__(),this.set_children__()},getBBox:function(t,e){return t.assign(e?this.shadowBBox:this.bbox)},set_optimize__:function(){this.getBrowser().getBrowserOption("OptimizeStaticGroup")?delete this.traverse:this.traverse=yb},set_children__:function(){this.groupNode.getBBox(this.bbox),this.groupNode.getBBox(this.shadowBBox,!0),this[pb]=null,this[fb]=null,this[gb]=null,this[mb]=null,this[_b]=null},traverse:function(t,e){switch(t){case ja.CAMERA:return;case ja.POINTER:return void this.traverseObjects(pb,"Pointing",t,e);case ja.COLLISION:return void this.traverseObjects(fb,"Collision",t,e);case ja.SHADOW:return void this.traverseObjects(gb,"Shadow",t,e);case ja.DISPLAY:return this.traverseObjects(mb,"Opaque",t,e),void this.traverseObjects(_b,"Transparent",t,e)}},traverseObjects:function(){const t=new La;return t.intersectsSphere=function(){return!0},function(e,n,i,o){if(!this[e]){const r=o.getViewVolumes(),s=o.getViewport(),a=o.getProjectionMatrix(),u=o.getModelViewMatrix(),c=o[`getNum${n}Shapes`]();r.push(t.set(a,s,s)),u.push(),u.identity(),this.groupNode.traverse(i,o),u.pop(),r.pop();const l=o[`getNum${n}Shapes`]();this[e]=o[`get${n}Shapes`]().splice(c,l-c),o[`setNum${n}Shapes`](c)}const r=o.getModelViewMatrix();for(const{modelViewMatrix:t,shapeNode:n}of this[e])r.push(),r.multLeft(t),n.traverse(i,o),r.pop()}}(),dispose:function(){el.prototype.dispose.call(this),fu.prototype.dispose.call(this)}});const wb=xb;n.set("x_ite/Components/Grouping/StaticGroup",wb);const Sb=wb;function Tb(t){rl.call(this,t),this.addType(c.Switch),"2.0"===t.getSpecificationVersion()&&this.addAlias("choice",this._children),this.childNode=null,this.visibleNode=null,this.boundedObject=null}Tb.prototype=Object.assign(Object.create(rl.prototype),{constructor:Tb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"whichChoice",new ji.SFInt32(-1)),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Switch"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){rl.prototype.initialize.call(this),this._whichChoice.addInterest("set_child__",this),this._children.addInterest("set_child__",this),this.set_child__()},getSubBBox:function(t,e){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=rc(c.X3DBoundedObject,this.visibleNode);return n?.getBBox(t,e)??t.set()}return t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear:function(){},add:function(){},remove:function(){},set_child__:function(){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),rc(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this));const t=this._whichChoice.getValue();t>=0&&t<this._children.length?(this.childNode=rc(c.X3DChildNode,this._children[t]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),rc(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)),delete this.traverse)):(this.childNode=null,this.traverse=Function.prototype),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.setCameraObject(!!this.visibleNode?.isCameraObject())},set_transformSensors__:function(){this.setPickableObject(!(!this.getTransformSensors().size&&!this.visibleNode?.isPickableObject()))},set_visible__:function(){rc(c.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__(),this.set_transformSensors__()},set_bboxDisplay__:function(){rc(c.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},traverse:function(t,e){switch(t){case ja.POINTER:case ja.CAMERA:case ja.SHADOW:return void this.visibleNode?.traverse(t,e);case ja.PICKING:{if(this.getTransformSensors().size){const t=e.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}const n=this.visibleNode;if(n){const i=this.getBrowser().getPickingHierarchy();i.push(this),n.traverse(t,e),i.pop()}return}case ja.COLLISION:return void this.visibleNode?.traverse(t,e);case ja.DISPLAY:return this.visibleNode?.traverse(t,e),void this.boundedObject?.displayBBox(t,e)}}});const bb=Tb;n.set("x_ite/Components/Grouping/Switch",bb);const vb=bb;function Eb(t){rl.call(this,t),this.addType(c.X3DTransformMatrix3DNode),this.matrix=new dn}Eb.prototype=Object.assign(Object.create(rl.prototype),{constructor:Eb,setMatrix:function(t){t.equals(dn.Identity)?(this.matrix.identity(),this.getBBox=this.getSubBBox,this.traverse=this.groupTraverse):(this.matrix.assign(t),delete this.getBBox,delete this.traverse)},getMatrix:function(){return this.matrix},setTransform:function(t,e,n,i,o){t.equals(Se.Zero)&&e.equals(an.Identity)&&n.equals(Se.One)?(this.matrix.identity(),this.getBBox=this.getSubBBox,this.traverse=this.groupTraverse):(this.matrix.set(t,e,n,i,o),delete this.getBBox,delete this.traverse)},getBBox:function(t,e){return this.getSubBBox(t,e).multRight(this.matrix)},traverse:function(t,e){const n=e.getModelViewMatrix();n.push(),n.multLeft(this.matrix),rl.prototype.traverse.call(this,t,e),n.pop()},groupTraverse:rl.prototype.traverse});const Cb=Eb;n.set("x_ite/Components/Grouping/X3DTransformMatrix3DNode",Cb);const Ob=Cb;function Nb(t){Ob.call(this,t),this.addType(c.X3DTransformNode),this._translation.setUnit("length"),this._center.setUnit("length")}Nb.prototype=Object.assign(Object.create(Ob.prototype),{constructor:Nb,initialize:function(){Ob.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed:function(){this.setTransform(this._translation.getValue(),this._rotation.getValue(),this._scale.getValue(),this._scaleOrientation.getValue(),this._center.getValue())}});const Fb=Nb;n.set("x_ite/Components/Grouping/X3DTransformNode",Fb);const Ib=Fb;function Mb(t){Ib.call(this,t),this.addType(c.Transform)}Mb.prototype=Object.assign(Object.create(Ib.prototype),{constructor:Mb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"translation",new ji.SFVec3f),new k(c.inputOutput,"rotation",new ji.SFRotation),new k(c.inputOutput,"scale",new ji.SFVec3f(1,1,1)),new k(c.inputOutput,"scaleOrientation",new ji.SFRotation),new k(c.inputOutput,"center",new ji.SFVec3f),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Transform"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]}});const Db=Mb;n.set("x_ite/Components/Grouping/Transform",Db);const Rb={Group:ul,StaticGroup:Sb,Switch:vb,Transform:Db},Vb={X3DBoundedObject:el,X3DGroupingNode:rl,X3DTransformMatrix3DNode:Ob,X3DTransformNode:Ib};for(const t in Rb)Sr.addNodeType(t,Rb[t]);for(const t in Vb)Sr.addAbstractNodeType(t,Vb[t]);const Ab=void 0;n.set("x_ite/Components/Grouping",Ab);function Pb(t){Vc.call(this,t),this.addType(c.ColorInterpolator),this.hsv=[]}Pb.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Pb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFColor),new k(c.outputOnly,"value_changed",new ji.SFColor)]),getTypeName:function(){return"ColorInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._keyValue;t.length<this._key.length&&this._keyValue.resize(this._key.length,t.length?t[this._keyValue.length-1]:new ji.SFColor),this.hsv.length=0;for(const e of t)this.hsv.push(e.getHSV())},interpolate:function(){const t=[];return function(e,n,i){Nt.lerp(this.hsv[e],this.hsv[n],i,t),this._value_changed.setHSV(t[0],t[1],t[2])}}()});const Lb=Pb;n.set("x_ite/Components/Interpolation/ColorInterpolator",Lb);const Bb=Lb;function Xb(t){Vc.call(this,t),this.addType(c.CoordinateInterpolator)}Xb.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Xb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFVec3f),new k(c.outputOnly,"value_changed",new ji.MFVec3f)]),getTypeName:function(){return"CoordinateInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},set_keyValue__:function(){},interpolate:function(t,e,n){const i=this._keyValue.getValue();let o=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const r=this._value_changed.getValue();e=(t*=o)+(this._key.length>1?o:0),t*=3,e*=3,o*=3;for(let s=0;s<o;s+=3){const o=s+1,a=s+2;r[s]=d.lerp(i[t+s],i[e+s],n),r[o]=d.lerp(i[t+o],i[e+o],n),r[a]=d.lerp(i[t+a],i[e+a],n)}this._value_changed.addEvent()}});const Ub=Xb;n.set("x_ite/Components/Interpolation/CoordinateInterpolator",Ub);const kb=Ub;function zb(t){Vc.call(this,t),this.addType(c.CoordinateInterpolator2D)}zb.prototype=Object.assign(Object.create(Vc.prototype),{constructor:zb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFVec2f),new k(c.outputOnly,"value_changed",new ji.MFVec2f)]),getTypeName:function(){return"CoordinateInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.0","Infinity"]},set_keyValue__:function(){},interpolate:function(t,e,n){const i=this._keyValue.getValue();let o=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const r=this._value_changed.getValue();e=(t*=o)+(this._key.length>1?o:0),t*=2,e*=2,o*=2;for(let s=0;s<o;s+=2){const o=s+1;r[s]=d.lerp(i[t+s],i[e+s],n),r[o]=d.lerp(i[t+o],i[e+o],n)}this._value_changed.addEvent()}});const jb=zb;n.set("x_ite/Components/Interpolation/CoordinateInterpolator2D",jb);const Gb=jb;function Hb(t){Vc.call(this,t),this.addType(c.NormalInterpolator)}Hb.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Hb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFVec3f),new k(c.outputOnly,"value_changed",new ji.MFVec3f)]),getTypeName:function(){return"NormalInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){},interpolate:function(){const t=new Se(0,0,0),e=new Se(0,0,0);return function(n,i,o){const r=this._keyValue.getValue();let s=this._key.length>1?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=s;const a=this._value_changed.getValue();i=(n*=s)+s,n*=3,i*=3,s*=3;for(let u=0;u<s;u+=3)try{const s=u+1,c=u+2;t.set(r[n+u],r[n+s],r[n+c]),e.set(r[i+u],r[i+s],r[i+c]);const l=d.simpleSlerp(t,e,o);a[u]=l[0],a[s]=l[1],a[c]=l[2]}catch(t){}this._value_changed.addEvent()}}()});const qb=Hb;n.set("x_ite/Components/Interpolation/NormalInterpolator",qb);const Yb=qb;function Wb(t){Vc.call(this,t),this.addType(c.PositionInterpolator2D)}Wb.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Wb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFVec2f),new k(c.outputOnly,"value_changed",new ji.SFVec2f)]),getTypeName:function(){return"PositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new ji.SFVec2f)},interpolate:function(){const t=new ge(0,0);return function(e,n,i){this._value_changed=t.assign(this._keyValue[e].getValue()).lerp(this._keyValue[n].getValue(),i)}}()});const Kb=Wb;n.set("x_ite/Components/Interpolation/PositionInterpolator2D",Kb);const Jb=Kb;function Zb(){this.T0=[],this.T1=[]}Zb.prototype={constructor:Zb,generate:function(){const t=[],e=[],n=[];return function(i,o,r,s,a){const u=this.T0,c=this.T1;if(u.length=0,c.length=0,t.length=0,e.length=0,n.length=0,o.length>1){if(0===s.length){i?t.push(this.divide(this.subtract(r[1],r[r.length-2]),2)):t.push(this.create());for(let e=1,n=r.length-1;e<n;++e)t.push(this.divide(this.subtract(r[e+1],r[e-1]),2));t.push(this.copy(t[0]))}else{for(let e=0,n=s.length;e<n;++e)t.push(this.copy(s[e]));if(a){let e=0;for(let t=0,n=r.length-1;t<n;++t)e+=this.magnitude(this.subtract(r[t],r[t+1]));for(let n=0,i=t.length-1;n<i;++n){const i=this.magnitude(t[n]);i&&(t[n]=this.multiply(t[n],e/i))}}}if(i){const t=o.length-1,i=o.length-2,r=o[1]-o[0]+o[t]-o[i];n.push(2*(o[1]-o[0])/r),e.push(2*(o[t]-o[i])/r)}else n.push(1),e.push(1);for(let t=1,i=o.length-1;t<i;++t){const i=o[t+1]-o[t-1];n.push(2*(o[t+1]-o[t])/i),e.push(2*(o[t]-o[t-1])/i)}n.push(n[0]),e.push(e[0]);for(let i=0,o=t.length;i<o;++i)u.push(this.multiply(t[i],e[i])),c.push(this.multiply(t[i],n[i]))}else u.push(this.create()),c.push(this.create())}}(),interpolate:function(){const t=new ze(0,0,0,0),e=new dn(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0);return function(n,i,o,r){return t.set(Math.pow(o,3),Math.pow(o,2),o,1),this.dot(e.multVecMatrix(t),r[n],r[i],this.T0[n],this.T1[i])}}()};const Qb=Zb;n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator",Qb);const $b=Qb;const tv=function(t){function e(){this.T0=[],this.T1=[]}return e.prototype=Object.assign(Object.create($b.prototype),{constructor:e,create:function(){return t.Zero.copy()},copy:function(t){return t.copy()},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},divide:function(t,e){return t.copy().divide(e)},magnitude:function(t){return t.magnitude()},dot:function(){const e=new t(0,0,0,0),n=new t(0,0,0,0),i=new t(0,0,0,0),o=new t(0,0,0,0);return function(t,r,s,a,u){return e.assign(r).multiply(t[0]),n.assign(s).multiply(t[1]),i.assign(a).multiply(t[2]),o.assign(u).multiply(t[3]),e.add(n).add(i).add(o)}}()}),e};n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolatorTemplate",tv);const ev=tv,nv=ev(Se);n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator3",nv);const iv=nv;function ov(t){Vc.call(this,t),this.addType(c.SplinePositionInterpolator),this.spline=new iv}ov.prototype=Object.assign(Object.create(Vc.prototype),{constructor:ov,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"closed",new ji.SFBool),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFVec3f),new k(c.inputOutput,"keyVelocity",new ji.MFVec3f),new k(c.inputOutput,"normalizeVelocity",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFVec3f)]),getTypeName:function(){return"SplinePositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new ji.SFVec3f),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new ji.SFVec3f),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const rv=ov;n.set("x_ite/Components/Interpolation/SplinePositionInterpolator",rv);const sv=rv,av=ev(ge);n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator2",av);const uv=av;function cv(t){Vc.call(this,t),this.addType(c.SplinePositionInterpolator2D),this.spline=new uv}cv.prototype=Object.assign(Object.create(Vc.prototype),{constructor:cv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"closed",new ji.SFBool),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFVec2f),new k(c.inputOutput,"keyVelocity",new ji.MFVec2f),new k(c.inputOutput,"normalizeVelocity",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFVec2f)]),getTypeName:function(){return"SplinePositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new ji.SFVec2f),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new ji.SFVec2f),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const lv=cv;n.set("x_ite/Components/Interpolation/SplinePositionInterpolator2D",lv);const hv=lv;function dv(){$b.call(this)}dv.prototype=Object.assign(Object.create($b.prototype),{constructor:dv,create:function(){return 0},copy:function(t){return t},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e},magnitude:function(t){return Math.abs(t)},dot:function(t,e,n,i,o){return e*t[0]+n*t[1]+i*t[2]+o*t[3]}});const pv=dv;n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator1",pv);const fv=pv;function gv(t){Vc.call(this,t),this.addType(c.SplineScalarInterpolator),this.spline=new fv}gv.prototype=Object.assign(Object.create(Vc.prototype),{constructor:gv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"closed",new ji.SFBool),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFFloat),new k(c.inputOutput,"keyVelocity",new ji.MFFloat),new k(c.inputOutput,"normalizeVelocity",new ji.SFBool),new k(c.outputOnly,"value_changed",new ji.SFFloat)]),getTypeName:function(){return"SplineScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new ji.SFFloat),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new ji.SFFloat),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const mv=gv;n.set("x_ite/Components/Interpolation/SplineScalarInterpolator",mv);const _v=mv;function xv(){this.s=[]}xv.prototype={constructor:xv,generate:function(t,e,n){const i=this.s;if(i.length=0,e.length>1){t?i.push(an.spline(n[e.length-2].getValue(),n[0].getValue(),n[1].getValue())):i.push(n[0].getValue());for(let t=1,o=e.length-1;t<o;++t)i.push(an.spline(n[t-1].getValue(),n[t].getValue(),n[t+1].getValue()));t?i.push(an.spline(n[e.length-2].getValue(),n[e.length-1].getValue(),n[1].getValue())):i.push(n[e.length-1].getValue())}else e.length>0&&i.push(n[0].getValue().copy())},interpolate:function(){const t=new an;return function(e,n,i,o){return t.assign(o[e].getValue()).squad(this.s[e],this.s[n],o[n].getValue(),i)}}()};const yv=xv;n.set("x_ite/Browser/Interpolation/SquatInterpolator",yv);const wv=yv;function Sv(t){Vc.call(this,t),this.addType(c.SquadOrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle"),this.squad=new wv}Sv.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Sv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_fraction",new ji.SFFloat),new k(c.inputOutput,"closed",new ji.SFBool),new k(c.inputOutput,"key",new ji.MFFloat),new k(c.inputOutput,"keyValue",new ji.MFRotation),new k(c.outputOnly,"value_changed",new ji.SFRotation)]),getTypeName:function(){return"SquadOrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){Vc.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new ji.SFRotation),this.squad.generate(this._closed.getValue(),this._key,this._keyValue)},interpolate:function(t,e,n){try{this._value_changed=this.squad.interpolate(t,e,n,this._keyValue)}catch(t){console.error(t)}}});const Tv=Sv;n.set("x_ite/Components/Interpolation/SquadOrientationInterpolator",Tv);const bv={ColorInterpolator:Bb,CoordinateInterpolator:kb,CoordinateInterpolator2D:Gb,EaseInEaseOut:Lc,NormalInterpolator:Yb,OrientationInterpolator:jc,PositionInterpolator:Uc,PositionInterpolator2D:Jb,ScalarInterpolator:qc,SplinePositionInterpolator:sv,SplinePositionInterpolator2D:hv,SplineScalarInterpolator:_v,SquadOrientationInterpolator:Tv},vv={X3DInterpolatorNode:Vc};for(const t in bv)Sr.addNodeType(t,bv[t]);for(const t in vv)Sr.addAbstractNodeType(t,vv[t]);const Ev=void 0;n.set("x_ite/Components/Interpolation",Ev);const Cv={Layer:hl,LayerSet:fl,Viewport:Ip},Ov={X3DLayerNode:Tc,X3DViewportNode:Cp};for(const t in Cv)Sr.addNodeType(t,Cv[t]);for(const t in Ov)Sr.addAbstractNodeType(t,Ov[t]);const Nv=void 0;n.set("x_ite/Components/Layering",Nv);const Fv=bu(Iv);function Iv(){this.modelViewMatrix=new oa(dn)}function Mv(t){Gf.call(this,t),this.addType(c.EnvironmentLight)}Iv.prototype={constructor:Iv,set:function(t,e,n){},setGroup:function(t){this.groupNode=t},getModelViewMatrix:function(){return this.modelViewMatrix},renderShadowMap:function(t){},setGlobalVariables:function(t){},setShaderUniforms:function(t,e){},dispose:function(){Fv.push(this)}},Mv.prototype=Object.assign(Object.create(Gf.prototype),{constructor:Mv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"global",new ji.SFBool),new k(c.inputOutput,"on",new ji.SFBool(!0)),new k(c.inputOutput,"rotation",new ji.SFRotation),new k(c.inputOutput,"color",new ji.SFColor(1,1,1)),new k(c.inputOutput,"intensity",new ji.SFFloat(1)),new k(c.inputOutput,"ambientIntensity",new ji.SFFloat),new k(c.inputOutput,"diffuseCoefficients",new ji.MFFloat),new k(c.inputOutput,"diffuse",new ji.SFNode),new k(c.inputOutput,"diffuseTexture",new ji.SFNode),new k(c.inputOutput,"specularTexture",new ji.SFNode),new k(c.inputOutput,"shadows",new ji.SFBool),new k(c.inputOutput,"shadowColor",new ji.SFColor),new k(c.inputOutput,"shadowIntensity",new ji.SFFloat(1)),new k(c.inputOutput,"shadowBias",new ji.SFFloat(.005)),new k(c.initializeOnly,"shadowMapSize",new ji.SFInt32(1024))]),getTypeName:function(){return"EnvironmentLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]},getLights:function(){return Fv}});const Dv=Mv;n.set("x_ite/Components/Lighting/EnvironmentLight",Dv);const Rv=Dv,Vv=[(new dn).setRotation(new an(new Se(1,0,0),Se.zAxis)),(new dn).setRotation(new an(new Se(-1,0,0),Se.zAxis)),(new dn).setRotation(new an(new Se(0,0,-1),Se.zAxis)),(new dn).setRotation(new an(new Se(0,0,1),Se.zAxis)),(new dn).setRotation(new an(new Se(0,1,0),Se.zAxis)),(new dn).setRotation(new an(new Se(0,-1,0),Se.zAxis))],Av=[new ze(0,.5,.25,.5),new ze(.5,.5,.25,.5),new ze(.75,.5,.25,.5),new ze(.25,.5,.25,.5),new ze(0,0,.5,.5),new ze(.5,0,.5,.5)],Pv=bu(Lv);function Lv(){this.location=new Se(0,0,0),this.matrixArray=new Float32Array(9),this.shadowBuffer=null,this.viewVolume=new La,this.viewport=new ze(0,0,0,0),this.projectionMatrix=new dn,this.modelViewMatrix=new oa(dn),this.modelMatrix=new dn,this.invLightSpaceMatrix=new dn,this.invLightSpaceProjectionMatrix=new dn,this.shadowMatrix=new dn,this.shadowMatrixArray=new Float32Array(16),this.rotation=new an,this.rotationMatrix=new dn,this.textureUnit=void 0}function Bv(t){Gf.call(this,t),this.addType(c.PointLight),this._location.setUnit("length"),this._radius.setUnit("length")}Lv.prototype={constructor:Lv,set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.global=t.getGlobal(),this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(this.global?i:dn.Identity);o.translate(e.getLocation()),o.inverse();const r=e.getShadowMapSize();this.shadowBuffer.bind();for(let e=0;e<6;++e){const n=Av[e],i=this.viewport.set(n[0]*r,n[1]*r,n[2]*r,n[3]*r),s=Ka.perspective2(d.radians(90),.125,1e4,i[2],i[3],this.projectionMatrix);t.getViewVolumes().push(this.viewVolume.set(s,i,i)),t.getProjectionMatrix().pushMatrix(this.projectionMatrix),t.getModelViewMatrix().pushMatrix(Vv[e]),t.getModelViewMatrix().multLeft(o),t.render(ja.SHADOW,rl.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop()}this.shadowBuffer.unbind(),this.global||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o)},setGlobalVariables:function(t){this.modelViewMatrix.get().multVecMatrix(this.location.assign(this.lightNode._location.getValue())),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.global?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=i.getAttenuation(),s=this.location;if(t.uniform1i(e.x3d_LightType[n],2),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),t.uniform3f(e.x3d_LightLocation[n],s.x,s.y,s.z),t.uniform1f(e.x3d_LightRadius[n],i.getRadius()),t.uniformMatrix3fv(e.x3d_LightMatrix[n],!1,this.matrixArray),this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}else t.uniform1f(e.x3d_ShadowIntensity[n],0)},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Pv.push(this)}},Bv.prototype=Object.assign(Object.create(Gf.prototype),{constructor:Bv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"global",new ji.SFBool(!0)),new k(c.inputOutput,"on",new ji.SFBool(!0)),new k(c.inputOutput,"color",new ji.SFColor(1,1,1)),new k(c.inputOutput,"intensity",new ji.SFFloat(1)),new k(c.inputOutput,"ambientIntensity",new ji.SFFloat),new k(c.inputOutput,"attenuation",new ji.SFVec3f(1,0,0)),new k(c.inputOutput,"location",new ji.SFVec3f),new k(c.inputOutput,"radius",new ji.SFFloat(100)),new k(c.inputOutput,"shadows",new ji.SFBool),new k(c.inputOutput,"shadowColor",new ji.SFColor),new k(c.inputOutput,"shadowIntensity",new ji.SFFloat(1)),new k(c.inputOutput,"shadowBias",new ji.SFFloat(.005)),new k(c.initializeOnly,"shadowMapSize",new ji.SFInt32(1024))]),getTypeName:function(){return"PointLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},getAttenuation:function(){return this._attenuation.getValue()},getLocation:function(){return this._location.getValue()},getRadius:function(){return Math.max(0,this._radius.getValue())},getLights:function(){return Pv}});const Xv=Bv;n.set("x_ite/Components/Lighting/PointLight",Xv);const Uv=Xv,kv=bu(zv);function zv(){this.location=new Se(0,0,0),this.direction=new Se(0,0,0),this.matrixArray=new Float32Array(9),this.renderShadow=!0,this.shadowBuffer=null,this.bbox=new Qa,this.viewVolume=new La,this.viewport=new ze(0,0,0,0),this.projectionMatrix=new dn,this.modelViewMatrix=new oa(dn),this.modelMatrix=new dn,this.invLightSpaceMatrix=new dn,this.invLightSpaceProjectionMatrix=new dn,this.shadowMatrix=new dn,this.shadowMatrixArray=new Float32Array(16),this.rotation=new an,this.lightBBoxMin=new Se(0,0,0),this.lightBBoxMax=new Se(0,0,0),this.textureUnit=void 0}function jv(t){Gf.call(this,t),this.addType(c.SpotLight),t.getSpecificationVersion()<=3.2&&(this._beamWidth=1.5708,this._cutOffAngle=.785398),this._location.setUnit("length"),this._radius.setUnit("length"),this._beamWidth.setUnit("angle"),this._cutOffAngle.setUnit("angle")}zv.prototype={constructor:zv,set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.global=t.getGlobal(),this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(this.global?i:dn.Identity);o.translate(e.getLocation()),o.rotate(this.rotation.setFromToVec(Se.zAxis,this.direction.assign(e.getDirection()).negate())),o.inverse();this.groupNode.getSubBBox(this.bbox,!0).multRight(o).getExtents(this.lightBBoxMin,this.lightBBoxMax);const r=e.getShadowMapSize(),s=Math.min(e.getRadius(),-this.lightBBoxMin.z),a=this.viewport.set(0,0,r,r),u=Ka.perspective(2*e.getCutOffAngle(),.125,Math.max(1e4,s),r,r,this.projectionMatrix);this.renderShadow=s>0,this.shadowBuffer.bind(),t.getViewVolumes().push(this.viewVolume.set(u,a,a)),t.getProjectionMatrix().pushMatrix(u),t.getModelViewMatrix().pushMatrix(o),t.render(ja.SHADOW,rl.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop(),this.shadowBuffer.unbind(),this.global||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o).multRight(u).multRight(e.getBiasMatrix())},setGlobalVariables:function(t){const e=this.lightNode,n=this.modelViewMatrix.get();n.multVecMatrix(this.location.assign(e._location.getValue())),n.multDirMatrix(this.direction.assign(e._direction.getValue())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.global?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=i.getAttenuation(),s=this.location,a=this.direction;if(t.uniform1i(e.x3d_LightType[n],3),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),t.uniform3f(e.x3d_LightLocation[n],s.x,s.y,s.z),t.uniform3f(e.x3d_LightDirection[n],a.x,a.y,a.z),t.uniform1f(e.x3d_LightRadius[n],i.getRadius()),t.uniform1f(e.x3d_LightBeamWidth[n],i.getBeamWidth()),t.uniform1f(e.x3d_LightCutOffAngle[n],i.getCutOffAngle()),t.uniformMatrix3fv(e.x3d_LightMatrix[n],!1,this.matrixArray),this.renderShadow&&this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}else t.uniform1f(e.x3d_ShadowIntensity[n],0)},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,kv.push(this)}},jv.prototype=Object.assign(Object.create(Gf.prototype),{constructor:jv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"global",new ji.SFBool(!0)),new k(c.inputOutput,"on",new ji.SFBool(!0)),new k(c.inputOutput,"color",new ji.SFColor(1,1,1)),new k(c.inputOutput,"intensity",new ji.SFFloat(1)),new k(c.inputOutput,"ambientIntensity",new ji.SFFloat),new k(c.inputOutput,"attenuation",new ji.SFVec3f(1,0,0)),new k(c.inputOutput,"location",new ji.SFVec3f),new k(c.inputOutput,"direction",new ji.SFVec3f(0,0,-1)),new k(c.inputOutput,"radius",new ji.SFFloat(100)),new k(c.inputOutput,"beamWidth",new ji.SFFloat(.785398)),new k(c.inputOutput,"cutOffAngle",new ji.SFFloat(1.5708)),new k(c.inputOutput,"shadows",new ji.SFBool),new k(c.inputOutput,"shadowColor",new ji.SFColor),new k(c.inputOutput,"shadowIntensity",new ji.SFFloat(1)),new k(c.inputOutput,"shadowBias",new ji.SFFloat(.005)),new k(c.initializeOnly,"shadowMapSize",new ji.SFInt32(1024))]),getTypeName:function(){return"SpotLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},getAttenuation:function(){return this._attenuation.getValue()},getLocation:function(){return this._location.getValue()},getRadius:function(){return Math.max(0,this._radius.getValue())},getBeamWidth:function(){const t=this._beamWidth.getValue(),e=this.getCutOffAngle();return t>e?e:d.clamp(t,0,Math.PI/2)},getCutOffAngle:function(){return d.clamp(this._cutOffAngle.getValue(),0,Math.PI/2)},getLights:function(){return kv}});const Gv=jv;n.set("x_ite/Components/Lighting/SpotLight",Gv);const Hv={DirectionalLight:Kf,EnvironmentLight:Rv,PointLight:Uv,SpotLight:Gv},qv={X3DLightNode:Gf};for(const t in Hv)Sr.addNodeType(t,Hv[t]);for(const t in qv)Sr.addAbstractNodeType(t,qv[t]);const Yv=void 0;n.set("x_ite/Components/Lighting",Yv);function Wv(t){rl.call(this,t),this.addType(c.Billboard),this.matrix=new dn}Wv.prototype=Object.assign(Object.create(rl.prototype),{constructor:Wv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"axisOfRotation",new ji.SFVec3f(0,1,0)),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Billboard"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},getBBox:function(t,e){return rl.prototype.getBBox.call(this,t,e).multRight(this.matrix)},getMatrix:function(){return this.matrix},rotate:function(){const t=new dn,e=new Se(0,0,0),n=new Se(0,0,0),i=new Se(0,0,0),o=new Se(0,0,0),r=new an;return function(s){t.assign(s).inverse();const a=t.origin.normalize();if(this._axisOfRotation.getValue().equals(Se.Zero)){t.multDirMatrix(e.assign(Se.yAxis)).normalize();const i=e.cross(a);n.assign(a).cross(i);const o=a;i.normalize(),n.normalize(),this.matrix.set(i.x,i.y,i.z,0,n.x,n.y,n.z,0,o.x,o.y,o.z,0,0,0,0,1)}else i.assign(this._axisOfRotation.getValue()).cross(a),o.assign(this._axisOfRotation.getValue()).cross(Se.zAxis),this.matrix.setRotation(r.setFromToVec(o,i));return this.matrix}}(),traverse:function(t,e){const n=e.getModelViewMatrix();switch(n.push(),t){case ja.CAMERA:case ja.PICKING:case ja.SHADOW:n.multLeft(this.matrix);break;default:n.multLeft(this.rotate(n.get()))}rl.prototype.traverse.call(this,t,e),n.pop()}});const Kv=Wv;n.set("x_ite/Components/Navigation/Billboard",Kv);const Jv=Kv;function Zv(t){rl.call(this,t),Ec.call(this,t),this.addType(c.Collision),"2.0"===t.getSpecificationVersion()&&this.addAlias("collide",this._enabled)}Zv.prototype=Object.assign(Object.create(rl.prototype),Ec.prototype,{constructor:Zv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"collideTime",new ji.SFTime),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.initializeOnly,"proxy",new ji.SFNode),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Collision"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){rl.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._proxy.addInterest("set_proxy__",this),this.set_live__(),this.set_proxy__()},set_live__:function(){this.getLive().getValue()&&this._enabled.getValue()?this.getBrowser().addCollision(this):this.getBrowser().removeCollision(this)},set_active:function(t){this._isActive.getValue()!==t&&(this._isActive=t,t&&(this._collideTime=this.getBrowser().getCurrentTime()))},set_proxy__:function(){this.proxyNode=rc(c.X3DChildNode,this._proxy)},traverse:function(t,e){if(t!==ja.COLLISION)rl.prototype.traverse.call(this,t,e);else if(this._enabled.getValue()){const n=e.getCollisions();n.push(this),this.proxyNode?this.proxyNode.traverse(t,e):rl.prototype.traverse.call(this,t,e),n.pop()}},dispose:function(){rl.prototype.dispose.call(this)}});const Qv=Zv;n.set("x_ite/Components/Navigation/Collision",Qv);const $v=Qv;function tE(t){rl.call(this,t),this.addType(c.LOD),"2.0"===t.getSpecificationVersion()&&this.addAlias("level",this._children),this._center.setUnit("length"),this._range.setUnit("length"),this.frameRate=60,this.keepCurrentLevel=!1,this.childNode=null,this.visibleNode=null,this.boundedObject=null}tE.prototype=Object.assign(Object.create(rl.prototype),{constructor:tE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"forceTransitions",new ji.SFBool),new k(c.initializeOnly,"center",new ji.SFVec3f),new k(c.initializeOnly,"range",new ji.MFFloat),new k(c.outputOnly,"level_changed",new ji.SFInt32(-1)),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"LOD"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){rl.prototype.initialize.call(this),this._children.addInterest("set_child__",this)},getSubBBox:function(t,e){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=rc(c.X3DBoundedObject,this.visibleNode);return n?.getBBox(t,e)??t.set()}return t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear:function(){},add:function(){},remove:function(){},set_child__:function(){this.set_level__(Math.min(this._level_changed.getValue(),this._children.length-1))},set_level__:function(t){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),rc(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this)),t>=0&&t<this._children.length?(this.childNode=rc(c.X3DChildNode,this._children[t]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),rc(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)))):this.childNode=null,this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.setCameraObject(!!this.visibleNode?.isCameraObject())},set_transformSensors__:function(){this.setPickableObject(!(!this.getTransformSensors().size&&!this.visibleNode?.isPickableObject()))},set_visible__:function(){rc(c.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__(),this.set_transformSensors__()},set_bboxDisplay__:function(){rc(c.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},getLevel:function(t,e){if(0===this._range.length){this.frameRate=(179*this.frameRate+t.currentFrameRate)/180;const e=this._children.length;switch(e){case 0:return-1;case 1:return 0;case 2:return+(this.frameRate>55);default:{const t=1-d.clamp((this.frameRate-20)/35,0,1);return Math.min(Math.floor(t*e),e-1)}}}const n=e.translate(this._center.getValue()).origin.magnitude();return d.upperBound(this._range,0,this._range.length,n)},traverse:function(){const t=new dn;return function(e,n){switch(e){case ja.POINTER:case ja.CAMERA:case ja.SHADOW:return void this.visibleNode?.traverse(e,n);case ja.PICKING:{if(this.getTransformSensors().size){const t=n.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}const t=this.visibleNode;if(t){const i=this.getBrowser().getPickingHierarchy();i.push(this),t.traverse(e,n),i.pop()}return}case ja.COLLISION:return void this.visibleNode?.traverse(e,n);case ja.DISPLAY:if(!this.keepCurrentLevel){let e=this.getLevel(this.getBrowser(),t.assign(n.getModelViewMatrix().get())),i=this._level_changed.getValue();this._forceTransitions.getValue()&&(e>i?e=i+1:e<i&&(e=i-1)),e!==i&&(this._level_changed=e,this.set_level__(Math.min(e,this._children.length-1)))}return this.visibleNode?.traverse(e,n),void this.boundedObject?.displayBBox(e,n)}}}()});const eE=tE;n.set("x_ite/Components/Navigation/LOD",eE);const nE=eE;function iE(t){fu.call(this,t),this.addType(c.ViewpointGroup),this._size.setUnit("length"),this._center.setUnit("length"),this.proximitySensor=new MS(t),this.cameraObjects=[],this.viewpointGroups=[]}function oE(t,e){switch(t){case ja.CAMERA:if(this.proximitySensor.traverse(t,e),this.proximitySensor._isActive.getValue())for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(t,e);return;case ja.DISPLAY:if(this.proximitySensor.traverse(t,e),this.proximitySensor._isActive.getValue())for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(t,e);return}}function rE(t,e){switch(t){case ja.CAMERA:for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(t,e);return;case ja.DISPLAY:for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(t,e);return}}iE.prototype=Object.assign(Object.create(fu.prototype),{constructor:iE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"displayed",new ji.SFBool(!0)),new k(c.inputOutput,"retainUserOffsets",new ji.SFBool),new k(c.inputOutput,"size",new ji.SFVec3f),new k(c.inputOutput,"center",new ji.SFVec3f),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"ViewpointGroup"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){fu.prototype.initialize.call(this),this.proximitySensor.setup(),this._size.addFieldInterest(this.proximitySensor._size),this._center.addFieldInterest(this.proximitySensor._center),this.proximitySensor._size=this._size,this.proximitySensor._center=this._center,this._displayed.addInterest("set_displayed__",this),this._size.addInterest("set_displayed__",this),this._children.addInterest("set_children__",this),this.set_displayed__(),this.set_children__()},isActive:function(){return this.proximitySensor._isActive.getValue()},set_displayed__:function(){var t=!this._size.getValue().equals(Se.Zero),e=this._displayed.getValue();this.proximitySensor._enabled=e&&t,e&&t?(this.proximitySensor._isCameraObject.addFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.addFieldInterest(this._isPickableObject),this.setCameraObject(this.proximitySensor.isCameraObject()),this.setPickableObject(this.proximitySensor.isPickableObject()),this.traverse=oE):(this.proximitySensor._isCameraObject.removeFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.removeFieldInterest(this._isPickableObject),this.setCameraObject(e),this.setPickableObject(!1),e?this.traverse=rE:delete this.traverse)},set_children__:function(){this.cameraObjects.length=0,this.viewpointGroups.length=0;for(var t=this._children,e=0,n=t.length;e<n;++e)try{for(var i=t[e].getValue().getInnerNode(),o=i.getType(),r=o.length-1;r>=0;--r)switch(o[r]){case c.X3DViewpointNode:this.cameraObjects.push(i);break;case c.ViewpointGroup:this.cameraObjects.push(i),this.viewpointGroups.push(i)}}catch(t){}},traverse:function(){}});const sE=iE;n.set("x_ite/Components/Navigation/ViewpointGroup",sE);const aE={Billboard:Jv,Collision:$v,LOD:nE,NavigationInfo:Su,OrthoViewpoint:zp,Viewpoint:Qc,ViewpointGroup:sE},uE={X3DViewpointNode:Kc};for(const t in aE)Sr.addNodeType(t,aE[t]);for(const t in uE)Sr.addAbstractNodeType(t,uE[t]);const cE=void 0;n.set("x_ite/Components/Navigation",cE);function lE(t,e,n,i){this.node=null,this.modelViewMatrix=new dn,this.projectionMatrix=new dn,this.viewport=new ze(0,0,0,0),this.set(t,e,n,i)}lE.prototype={set:function(t,e,n,i){this.node=t,this.modelViewMatrix.assign(e),this.projectionMatrix.assign(n),this.viewport.assign(i)},set_over__:function(t,e){this.node.set_over__(t,e,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_active__:function(t,e){this.node.set_active__(t,e,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_motion__:function(t){this.node.set_motion__(t,this.modelViewMatrix,this.projectionMatrix,this.viewport)}};const hE=lE;n.set("x_ite/Browser/PointingDeviceSensor/PointingDeviceSensorContainer",hE);const dE=hE;function pE(t){Ec.call(this,t),this.addType(c.X3DPointingDeviceSensorNode)}pE.prototype=Object.assign(Object.create(Ec.prototype),{constructor:pE,initialize:function(){Ec.prototype.initialize.call(this),this.getBrowser().getBrowserOptions()._PrivateSensors.addInterest("set_live__",this),this.getScene().getPrivate().addInterest("set_live__",this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this.set_live__()},set_live__:function(){(this.getLive().getValue()&&!this.getBrowser().getBrowserOption("PrivateSensors")||this.getScene().isPrivate()&&this.getBrowser().getBrowserOption("PrivateSensors"))&&this._enabled.getValue()?(this.getBrowser().addPointingDeviceSensor(this),delete this.push):(this.getBrowser().removePointingDeviceSensor(this),this._isActive.getValue()&&(this._isActive=!1),this._isOver.getValue()&&(this._isOver=!1),this.push=Function.prototype)},set_over__:function(t,e){t!==this._isOver.getValue()&&(this._isOver=t,t&&(this.getBrowser().getNotification()._string=this._description))},set_active__:function(t,e){t!==this._isActive.getValue()&&(this._isActive=t)},set_motion__:function(t){},push:function(t,e){e.push(new dE(this,t.getModelViewMatrix().get(),t.getProjectionMatrix().get(),t.getViewVolume().getViewport()))}});const fE=pE;n.set("x_ite/Components/PointingDeviceSensor/X3DPointingDeviceSensorNode",fE);const gE=fE;function mE(t){gE.call(this,t),this.addType(c.X3DTouchSensorNode)}mE.prototype=Object.assign(Object.create(gE.prototype),{constructor:mE,set_active__:function(t,e){gE.prototype.set_active__.call(this,t,e),this._enabled.getValue()&&this._isOver.getValue()&&!t&&(this._touchTime=this.getBrowser().getCurrentTime())},set_over__:function(){const t=new dn,e=new ge(0,0);return function(n,i,o,r,s){gE.prototype.set_over__.call(this,n,i,o,r,s),this._isOver.getValue()&&(e.set(i.texCoord.x,i.texCoord.y).divide(i.texCoord.w),t.assign(o).inverse(),this._hitTexCoord_changed=e,this._hitNormal_changed=o.multMatrixDir(i.normal.copy()).normalize(),this._hitPoint_changed=t.multVecMatrix(i.point.copy()))}}()});const _E=mE;n.set("x_ite/Components/PointingDeviceSensor/X3DTouchSensorNode",_E);const xE=_E;function yE(t){xE.call(this,t),this.addType(c.TouchSensor),this._hitPoint_changed.setUnit("length")}yE.prototype=Object.assign(Object.create(xE.prototype),{constructor:yE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.outputOnly,"hitTexCoord_changed",new ji.SFVec2f),new k(c.outputOnly,"hitNormal_changed",new ji.SFVec3f),new k(c.outputOnly,"hitPoint_changed",new ji.SFVec3f),new k(c.outputOnly,"isOver",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"touchTime",new ji.SFTime)]),getTypeName:function(){return"TouchSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]}});const wE=yE;n.set("x_ite/Components/PointingDeviceSensor/TouchSensor",wE);const SE=wE;function TE(t){rl.call(this,t),es.call(this,t),this.addType(c.Anchor),this.touchSensorNode=new SE(t),this.anchorSensors=[]}TE.prototype=Object.assign(Object.create(rl.prototype),es.prototype,{constructor:TE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"parameter",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600)),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f),new k(c.inputOnly,"addChildren",new ji.MFNode),new k(c.inputOnly,"removeChildren",new ji.MFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Anchor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){rl.prototype.initialize.call(this),es.prototype.initialize.call(this),this._description.addFieldInterest(this.touchSensorNode._description),this._load.addFieldInterest(this.touchSensorNode._enabled),this.touchSensorNode._description=this._description,this.touchSensorNode._enabled=this._load,this.touchSensorNode.setup(),this.touchSensorNode.set_active__=(t,e)=>{SE.prototype.set_active__.call(this.touchSensorNode,t,e),this.touchSensorNode._isOver.getValue()&&!t&&this.requestImmediateLoad().catch(Function.prototype)}},set_load__:function(){},set_url__:function(){},requestImmediateLoad:function(t=!0){return this.setCache(t),this.setLoadState(c.IN_PROGRESS_STATE,!1),new Promise(((t,e)=>{new Cl(this).createX3DFromURL(this._url,this._parameter,(n=>{n?(this.getBrowser().replaceWorld(n),this.setLoadState(c.COMPLETE_STATE,!1),t()):(this.setLoadState(c.FAILED_STATE,!1),e())}),(e=>{this.getBrowser().changeViewpoint(e),this.setLoadState(c.COMPLETE_STATE,!1),t()}),((e,n)=>{n?window.open(e,n):location=e,this.setLoadState(c.COMPLETE_STATE,!1),t()}))}))},requestUnload(){},traverse:function(t,e){if(t===ja.POINTER){const n=this.anchorSensors;n.length=0,this.touchSensorNode.push(e,n),n.length?(e.getSensors().push(n),rl.prototype.traverse.call(this,t,e),e.getSensors().pop()):rl.prototype.traverse.call(this,t,e)}else rl.prototype.traverse.call(this,t,e)},dispose:function(){es.prototype.dispose.call(this),rl.prototype.dispose.call(this)}});const bE=TE;n.set("x_ite/Components/Networking/Anchor",bE);const vE=bE;function EE(t){fu.call(this,t),es.call(this,t),el.call(this,t),this.addType(c.Inline),t.getSpecificationVersion()<4&&(this._global=!0),this.scene=this.getBrowser().getDefaultScene(),this.groupNode=new ul(t),this.localObjects=[],this.localShadows=!1}EE.prototype=Object.assign(Object.create(fu.prototype),es.prototype,el.prototype,{constructor:EE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"global",new ji.SFBool),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600)),new k(c.inputOutput,"visible",new ji.SFBool(!0)),new k(c.inputOutput,"bboxDisplay",new ji.SFBool),new k(c.initializeOnly,"bboxSize",new ji.SFVec3f(-1,-1,-1)),new k(c.initializeOnly,"bboxCenter",new ji.SFVec3f)]),getTypeName:function(){return"Inline"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){fu.prototype.initialize.call(this),es.prototype.initialize.call(this),el.prototype.initialize.call(this),this.groupNode.setPrivate(!0),this.groupNode.setup(),this.groupNode._isCameraObject.addFieldInterest(this._isCameraObject),this.groupNode._isPickableObject.addFieldInterest(this._isPickableObject),this.requestImmediateLoad().catch(Function.prototype)},getBBox:function(t,e){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.groupNode.getBBox(t,e):t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},set_live__:function(){es.prototype.set_live__.call(this),this.isPrivate()||this.scene.setLive(this.getLive().getValue())},unloadData:function(){this.abortLoading(),this.setInternalScene(this.getBrowser().getDefaultScene())},loadData:function(){this.abortLoading(),this.fileLoader=new Cl(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},abortLoading:function(){this.scene._loadCount.removeInterest("checkLoadCount",this),this.fileLoader&&this.fileLoader.abort()},setInternalSceneAsync:function(t){t?(t._loadCount.addInterest("checkLoadCount",this),this.setInternalScene(t),this.checkLoadCount(t._loadCount)):(this.setInternalScene(this.getBrowser().getDefaultScene()),this.setLoadState(c.FAILED_STATE))},checkLoadCount:function(t){t.getValue()||(t.removeInterest("checkLoadCount",this),this.setLoadState(c.COMPLETE_STATE))},setInternalScene:function(t){this.scene.setLive(!1),this.scene.rootNodes.removeFieldInterest(this.groupNode._children),this.scene=t,this.scene.setExecutionContext(this.getExecutionContext()),this.scene.setPrivate(this.getExecutionContext().isPrivate()),this.scene.rootNodes.addFieldInterest(this.groupNode._children),this.groupNode._children=this.scene.rootNodes,this.set_live__(),this.getBrowser().addBrowserEvent()},getInternalScene:function(){return this.scene},traverse:function(t,e){switch(t){case ja.PICKING:{const n=this.getBrowser().getPickingHierarchy();return n.push(this),this.groupNode.traverse(t,e),void n.pop()}case ja.DISPLAY:if(this._global.getValue())this.groupNode.traverse(t,e);else{const n=e.getGlobalObjects(),i=e.getGlobalShadows(),o=n.length,r=i.length,s=this.localObjects,a=s.length,u=s.reduce(((t,e)=>t+!!e.lightNode),0),c=s.reduce(((t,e)=>t+!!e.textureProjectorNode),0);if(a&&(e.getLocalObjects().push(...s),e.pushLocalShadows(this.localShadows),e.getLocalObjectsCount()[1]+=u,e.getLocalObjectsCount()[2]+=c),this.groupNode.traverse(t,e),a){if(e.isIndependent()){const t=this.getBrowser();for(let n=0;n<a;++n)t.getLocalObjects().push(e.getLocalObjects().pop())}else for(let t=0;t<a;++t)e.getLocalObjects().pop();e.popLocalShadows(),e.getLocalObjectsCount()[1]-=u,e.getLocalObjectsCount()[2]-=c}const l=n.length-o;for(let t=0;t<l;++t){const e=n[o+t];e.groupNode=this.groupNode,e.global=!1,s[t]=e}s.length=l,this.localShadows=i.at(-1),n.length=o,i.length=r}return;default:return void this.groupNode.traverse(t,e)}},dispose:function(){el.prototype.dispose.call(this),es.prototype.dispose.call(this),fu.prototype.dispose.call(this)}});const CE=EE;n.set("x_ite/Components/Networking/Inline",CE);const OE={Anchor:vE,Inline:CE,LoadSensor:wx},NE={X3DNetworkSensorNode:_x,X3DUrlObject:es};for(const t in OE)Sr.addNodeType(t,OE[t]);for(const t in NE)Sr.addAbstractNodeType(t,NE[t]);const FE=void 0;n.set("x_ite/Components/Networking",FE);function IE(t){gE.call(this,t),this.addType(c.X3DDragSensorNode),this._trackPoint_changed.setUnit("length")}IE.prototype=Object.assign(Object.create(gE.prototype),{constructor:IE});const ME=IE;n.set("x_ite/Components/PointingDeviceSensor/X3DDragSensorNode",ME);const DE=ME;function RE(t,e){this.axis=t.copy(),this.radius=e}RE.prototype={constructor:RE,intersectsLine:function(t,e,n){const i=new an(this.axis.direction,new Se(0,1,0)),o=dn.Rotation(i),r=1/this.radius,s=new dn;s.scale(new Se(r,r,r)),s.multLeft(o);const a=t.point.copy().subtract(this.axis.point),u=new eu(a,t.direction).multLineMatrix(s),c=this.unitCylinderIntersectsLine(u,e,n);if(c){const t=s.inverse();t.multVecMatrix(e),e.add(this.axis.point),t.multVecMatrix(n),n.add(this.axis.point)}return c},unitCylinderIntersectsLine:function(t,e,n){let i,o;const r=t.point,s=t.direction,a=s[0]*s[0]+s[2]*s[2],u=2*(r[0]*s[0]+r[2]*s[2]),c=r[0]*r[0]+r[2]*r[2]-1,l=u*u-4*a*c;if(l<0)return!1;const h=Math.sqrt(l);return u>0?(i=-2*c/(h+u),o=-(h+u)/(2*a)):(i=2*c/(h-u),o=(h-u)/(2*a)),e.assign(s).multiply(i).add(r),n.assign(s).multiply(o).add(r),!0},toString:function(){return this.axis.toString()+" "+this.radius}};const VE=RE;n.set("standard/Math/Geometry/Cylinder3",VE);const AE=VE;function PE(t){DE.call(this,t),this.addType(c.CylinderSensor),this._diskAngle.setUnit("angle"),this._minAngle.setUnit("angle"),this._maxAngle.setUnit("angle"),this._offset.setUnit("angle")}PE.prototype=Object.assign(Object.create(DE.prototype),{constructor:PE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"axisRotation",new ji.SFRotation),new k(c.inputOutput,"diskAngle",new ji.SFFloat(.261792)),new k(c.inputOutput,"minAngle",new ji.SFFloat),new k(c.inputOutput,"maxAngle",new ji.SFFloat(-1)),new k(c.inputOutput,"offset",new ji.SFFloat),new k(c.inputOutput,"autoOffset",new ji.SFBool(!0)),new k(c.outputOnly,"trackPoint_changed",new ji.SFVec3f),new k(c.outputOnly,"rotation_changed",new ji.SFRotation),new k(c.outputOnly,"isOver",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool)]),getTypeName:function(){return"CylinderSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){DE.prototype.initialize.call(this),this.modelViewMatrix=new dn,this.invModelViewMatrix=new dn,this.cylinder=new AE(new eu(new Se(0,0,0),new Se(0,0,0)),0),this.disk=!1,this.yPlane=null,this.zPlane=null,this.sxPlane=null,this.szNormal=null,this.behind=!1,this.fromVector=new Se(0,0,0),this.startOffset=new an},isBehind:function(t,e){const n=new Se(0,0,0),i=new Se(0,0,0);return this.cylinder.intersectsLine(t,n,i),e.distance(n)>e.distance(i)},getTrackPoint:function(t,e){const n=new Se(0,0,0);this.zPlane.intersectsLine(t,n);const i=n.copy().add(this.cylinder.axis.getPerpendicularVectorToPoint(n,new Se(0,0,0))),o=this.sxPlane.getDistanceToPoint(n)/this.cylinder.radius,r=Math.floor((o+1)/2),s=d.interval(o,-1,1),a=(0===r?Math.asin(s):s*Math.PI/2)+r*Math.PI;new an(this.cylinder.axis.direction,a).multVecRot(e.assign(this.szNormal).multiply(this.cylinder.radius)),e.add(i)},getAngle:function(t){return t.getAxis(new Se(0,0,0)).dot(this.cylinder.axis.direction)>0?t.angle:-t.angle},set_active__:function(t,e,n,i,o){if(DE.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=this.invModelViewMatrix.multVecMatrix(e.point.copy()),o=this._axisRotation.getValue().multVecRot(new Se(0,1,0)),r=this.invModelViewMatrix.multDirMatrix(new Se(0,0,1)).normalize(),s=new eu(new Se(0,0,0),o),a=s.getPerpendicularVectorToPoint(i,new Se(0,0,0)).magnitude();this.cylinder=new AE(s,a),this.disk=Math.abs(r.dot(o))>Math.cos(this._diskAngle.getValue()),this.behind=this.isBehind(t,i),this.yPlane=new ba(i,o),this.zPlane=new ba(i,r);const u=this.invModelViewMatrix.origin,c=o.copy().cross(u).normalize();this.sxPlane=new ba(new Se(0,0,0),c),this.szNormal=c.copy().cross(o).normalize();const l=new Se(0,0,0);this.disk?this.yPlane.intersectsLine(t,l):this.getTrackPoint(t,l),this.fromVector=this.cylinder.axis.getPerpendicularVectorToPoint(l,new Se(0,0,0)).negate(),this.startOffset=new an(o,this._offset.getValue()),this._trackPoint_changed=l,this._rotation_changed=this.startOffset,this.angle=this._offset.getValue(),this.startVector=this._rotation_changed.getValue().multVecRot(this._axisRotation.getValue().multVecRot(new Se(0,0,1)))}else this._autoOffset.getValue()&&(this._offset=this.getAngle(this._rotation_changed.getValue()))},set_motion__:function(t){const e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new Se(0,0,0);this.disk?this.yPlane.intersectsLine(e,n):this.getTrackPoint(e,n),this._trackPoint_changed=n;const i=this.cylinder.axis.getPerpendicularVectorToPoint(n,new Se(0,0,0)).negate(),o=new an(this.fromVector,i);if(this.disk){this.modelViewMatrix.multVecMatrix(n.copy()).z>0&&o.multRight(new an(this.yPlane.normal,Math.PI))}else this.behind&&o.inverse();if(o.multLeft(this.startOffset),this._minAngle.getValue()>this._maxAngle.getValue())this._rotation_changed=o;else{const t=o.multVecRot(this._axisRotation.getValue().multVecRot(new Se(0,0,1))),e=new an(this.startVector,t),n=this._axisRotation.getValue().multVecRot(new Se(0,1,0)).dot(e.getAxis(new Se(0,0,0)))>0?1:-1,i=this._minAngle.getValue(),r=this._maxAngle.getValue();this.angle+=n*e.angle,this.startVector.assign(t),this.angle<i?o.setAxisAngle(this.cylinder.axis.direction,i):this.angle>r?o.setAxisAngle(this.cylinder.axis.direction,r):o.setAxisAngle(this.cylinder.axis.direction,this.angle),this._rotation_changed.getValue().equals(o)||(this._rotation_changed=o)}}});const LE=PE;n.set("x_ite/Components/PointingDeviceSensor/CylinderSensor",LE);const BE=LE;function XE(t,e){this.point=t.copy(),this.direction=e.copy()}XE.prototype={constructor:XE,copy:function(){const t=Object.create(XE.prototype);return t.point=this.point.copy(),t.direction=this.direction.copy(),t},assign:function(t){return this.point.assign(t.point),this.direction.assign(t.direction),this},set:function(t,e){return this.point.assign(t),this.direction.assign(e),this},setPoints:function(t,e){return this.point.assign(t),this.direction.assign(e).subtract(t).normalize(),this},multMatrixLine:function(t){return t.multMatrixVec(this.point),t.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(t){return t.multVecMatrix(this.point),t.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(t,e){const n=e.assign(t).subtract(this.point).dot(this.direction);return e.assign(this.direction).multiply(n).add(this.point)},getPerpendicularVectorToPoint:function(){const t=new ge(0,0);return function(e,n){return n.assign(this.point).subtract(e),n.subtract(t.assign(this.direction).multiply(n.dot(this.direction)))}}(),intersectsLine:function(){const t=new ge(0,0);return function(e,n){const{point:i,direction:o}=this,{point:r,direction:s}=e,a=o.dot(s);if(Math.abs(a)>=1)return!1;t.assign(r).subtract(i);const u=(t.dot(o)-a*t.dot(s))/(1-a*a);return n.assign(o).multiply(u).add(i),!0}}(),toString:function(){return this.point+", "+this.direction}},XE.Points=function(t,e){const n=Object.create(XE.prototype);return n.point=t.copy(),n.direction=e.copy().subtract(t).normalize(),n};const UE=XE;n.set("standard/Math/Geometry/Line2",UE);const kE=new UE(ge.Zero,ge.Zero),zE=new ge(0,0,0),jE=new eu(Se.Zero,Se.Zero);function GE(t){DE.call(this,t),this.addType(c.PlaneSensor),this._offset.setUnit("length"),this._minPosition.setUnit("length"),this._maxPosition.setUnit("length"),this._translation_changed.setUnit("length")}GE.prototype=Object.assign(Object.create(DE.prototype),{constructor:GE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"axisRotation",new ji.SFRotation),new k(c.inputOutput,"autoOffset",new ji.SFBool(!0)),new k(c.inputOutput,"offset",new ji.SFVec3f),new k(c.inputOutput,"minPosition",new ji.SFVec2f),new k(c.inputOutput,"maxPosition",new ji.SFVec2f(-1,-1)),new k(c.outputOnly,"trackPoint_changed",new ji.SFVec3f),new k(c.outputOnly,"translation_changed",new ji.SFVec3f),new k(c.outputOnly,"isOver",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool)]),getTypeName:function(){return"PlaneSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){DE.prototype.initialize.call(this),this.modelViewMatrix=new dn,this.invModelViewMatrix=new dn,this.projectionMatrix=new dn,this.viewport=new ze,this.planeSensor=!0,this.plane=null,this.line=null,this.startOffset=new Se(0,0,0),this.startPoint=new Se(0,0,0)},getLineTrackPoint:function(t,e,n){return La.projectLine(e,this.modelViewMatrix,this.projectionMatrix,this.viewport,kE),kE.getClosestPointToPoint(t.pointer,zE),La.unProjectRay(zE.x,zE.y,this.modelViewMatrix,this.projectionMatrix,this.viewport,jE),e.getClosestPointToLine(jE,n)},set_active__:function(t,e,n,i,o){if(DE.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.projectionMatrix.assign(i),this.viewport.assign(o),this.invModelViewMatrix.assign(n).inverse();const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),r=this.invModelViewMatrix.multVecMatrix(e.point.copy()),s=this._axisRotation.getValue();if(this._minPosition.x===this._maxPosition.x){this.planeSensor=!1;const t=s.multVecRot(new Se(0,Math.abs(this._maxPosition.y-this._minPosition.y),0));this.line=new eu(r,t.normalize())}else if(this._minPosition.y===this._maxPosition.y){this.planeSensor=!1;const t=s.multVecRot(new Se(Math.abs(this._maxPosition.x-this._minPosition.x),0,0));this.line=new eu(r,t.normalize())}else this.planeSensor=!0,this.plane=new ba(r,s.multVecRot(new Se(0,0,1)));if(this.planeSensor)this.plane.intersectsLine(t,this.startPoint)&&this.trackStart(this.startPoint);else if(this.getLineTrackPoint(e,this.line,this.startPoint)){const t=new Se(0,0,0);try{this.getLineTrackPoint(e,new eu(this.line.direction,this.line.direction),t)}catch(e){t.assign(this.startPoint)}this.trackStart(t)}}else this._autoOffset.getValue()&&(this._offset=this._translation_changed)},trackStart:function(t){this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=t,this._translation_changed=this._offset.getValue()},set_motion__:function(t){try{if(this.planeSensor){const e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new Se(0,0,0);if(!this.plane.intersectsLine(e,n))throw new Error("Plane and line are parallel.");this.track(n,n.copy())}else{const e=new Se(0,0,0),n=new Se(0,0,0);if(!this.getLineTrackPoint(t,this.line,e))throw new Error("Lines are parallel.");try{this.getLineTrackPoint(t,new eu(Se.Zero,this.line.direction),n)}catch(t){n.assign(e)}this.track(e,n)}}catch(t){this._trackPoint_changed.addEvent(),this._translation_changed.addEvent()}},track:function(t,e){const n=this._axisRotation.getValue(),i=n.copy().inverse().multVecRot(t.add(this.startOffset).subtract(this.startPoint));this._minPosition.x>this._maxPosition.x||(i.x=d.clamp(i.x,this._minPosition.x,this._maxPosition.x)),this._minPosition.y>this._maxPosition.y||(i.y=d.clamp(i.y,this._minPosition.y,this._maxPosition.y)),n.multVecRot(i),this._trackPoint_changed.getValue().equals(e)||(this._trackPoint_changed=e),this._translation_changed.getValue().equals(i)||(this._translation_changed=i)}});const HE=GE;n.set("x_ite/Components/PointingDeviceSensor/PlaneSensor",HE);const qE=HE;function YE(t,e){this.radius=t,this.center=e.copy()}YE.prototype={constructor:YE,set:function(t,e){this.radius=t,this.center.assign(e)},intersectsLine:function(t,e,n){const{point:i,direction:o}=t,{center:r,radius:s}=this,a=2*(i.dot(o)-r.dot(o)),u=a*a-4*(i.x*i.x+i.y*i.y+i.z*i.z+(r.x*r.x+r.y*r.y+r.z*r.z)-2*i.dot(r)-s*s);if(u>=0){let t=(-a+Math.sqrt(u))/2,r=(-a-Math.sqrt(u))/2;if(t>r){const e=t;t=r,r=e}return e.assign(o).multiply(t).add(i),n.assign(o).multiply(r).add(i),!0}return!1},intersectsTriangle:function(){const t=new Se(0,0,0),e=new Se(0,0,0),n=new Se(0,0,0),i=new Se(0,0,0),o=new Se(0,0,0),r=new Se(0,0,0),s=new Se(0,0,0);return function(a,u,c){const l=this.center,h=this.radius;a.subtract(l),u.subtract(l),c.subtract(l),t.assign(u).subtract(a),e.assign(c).subtract(a);const d=h*h,p=t.cross(e),f=a.dot(p);if(f*f>d*p.dot(p))return!1;const g=a.dot(a),m=a.dot(u),_=a.dot(c),x=u.dot(u),y=u.dot(c),w=c.dot(c);if(g>d&&m>g&&_>g||x>d&&m>x&&y>x||w>d&&_>w&&y>w)return!1;t.assign(u).subtract(a),n.assign(c).subtract(u),i.assign(a).subtract(c);const S=m-g,T=y-x,b=_-w,v=t.dot(t),E=n.dot(n),C=i.dot(i);o.assign(a).multiply(v).subtract(t.multiply(S)),r.assign(u).multiply(E).subtract(n.multiply(T)),s.assign(c).multiply(C).subtract(i.multiply(b));const O=c.multiply(v).subtract(o),N=a.multiply(E).subtract(r),F=u.multiply(C).subtract(s),I=o.dot(o)>d*v*v&&o.dot(O)>0,M=r.dot(r)>d*E*E&&r.dot(N)>0,D=s.dot(s)>d*C*C&&s.dot(F)>0;return!(I||M||D)}}(),toString:function(){return this.radius+" "+this.center.toString()}};const WE=YE;n.set("standard/Math/Geometry/Sphere3",WE);const KE=WE;function JE(t){DE.call(this,t),this.addType(c.SphereSensor)}JE.prototype=Object.assign(Object.create(DE.prototype),{constructor:JE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"autoOffset",new ji.SFBool(!0)),new k(c.inputOutput,"offset",new ji.SFRotation),new k(c.outputOnly,"trackPoint_changed",new ji.SFVec3f),new k(c.outputOnly,"rotation_changed",new ji.SFRotation),new k(c.outputOnly,"isOver",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool)]),getTypeName:function(){return"SphereSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){DE.prototype.initialize.call(this),this.modelViewMatrix=new dn,this.invModelViewMatrix=new dn,this.sphere=null,this.zPlane=null,this.behind=!1,this.fromVector=new Se(0,0,0),this.startPoint=new Se(0,0,0),this.startOffset=new an},getTrackPoint:function(t,e,n){const i=new Se(0,0,0);return!!this.sphere.intersectsLine(t,e,i)&&((t.point.distance(i)<t.point.distance(e))-n&&e.assign(i),!0)},set_active__:function(t,e,n,i,o){if(DE.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();const t=this.invModelViewMatrix.multVecMatrix(e.point.copy()),i=new Se(0,0,0);this.zPlane=new ba(i,this.invModelViewMatrix.multDirMatrix(new Se(0,0,1)).normalize()),this.sphere=new KE(t.magnitude(),i),this.behind=this.zPlane.getDistanceToPoint(t)<0,this.fromVector.assign(t),this.startPoint.assign(t),this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=t,this._rotation_changed=this._offset.getValue()}else this._autoOffset.getValue()&&(this._offset=this._rotation_changed)},set_motion__:function(t){const e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new Se(0,0,0);if(this.getTrackPoint(e,n,this.behind)){const t=this.invModelViewMatrix.multDirMatrix(new Se(0,0,1)).normalize();this.zPlane=new ba(n,t)}else{const t=new Se(0,0,0);this.zPlane.intersectsLine(e,t),e.set(t,this.sphere.center.copy().subtract(t).normalize()),this.getTrackPoint(e,n,!1);const i=Oa.normal(this.sphere.center,n,this.startPoint,new Se(0,0,0)),o=n.copy().subtract(this.sphere.center).normalize(),r=i.copy().cross(o).normalize(),s=n.copy().subtract(r.multiply(t.copy().subtract(n).magnitude()));e.set(s,this.sphere.center.copy().subtract(s).normalize()),this.getTrackPoint(e,n,!1)}this._trackPoint_changed=n;const i=n.copy().subtract(this.sphere.center),o=new an(this.fromVector,i);this.behind&&o.inverse(),this._rotation_changed=this.startOffset.copy().multRight(o)}});const ZE=JE;n.set("x_ite/Components/PointingDeviceSensor/SphereSensor",ZE);const QE={CylinderSensor:BE,PlaneSensor:qE,SphereSensor:ZE,TouchSensor:SE},$E={X3DDragSensorNode:DE,X3DPointingDeviceSensorNode:gE,X3DTouchSensorNode:xE};for(const t in QE)Sr.addNodeType(t,QE[t]);for(const t in $E)Sr.addAbstractNodeType(t,$E[t]);const tC=void 0;n.set("x_ite/Components/PointingDeviceSensor",tC);const eC=bu(nC);function nC(){this.plane=new ba(Se.Zero,Se.Zero)}function iC(t){fu.call(this,t),this.addType(c.ClipPlane),this.enabled=!1,this.plane=new ze(0,0,0,0)}nC.prototype={constructor:nC,isClipped:function(t){return this.plane.getDistanceToPoint(t)<0},set:function(t,e){const n=this.plane,i=t.plane;n.normal.assign(i),n.distanceFromOrigin=-i.w,n.multRight(e)},setShaderUniforms:function(t,e){const n=this.plane,i=n.normal;t.uniform4f(e.x3d_ClipPlane[e.numClipPlanes++],i.x,i.y,i.z,n.distanceFromOrigin)},dispose:function(){eC.push(this)}},iC.prototype=Object.assign(Object.create(fu.prototype),{constructor:iC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"plane",new ji.SFVec4f(0,1,0,0))]),getTypeName:function(){return"ClipPlane"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){fu.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._plane.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__:function(){this.plane.assign(this._plane.getValue()),this.enabled=this._enabled.getValue()&&!this.plane.equals(ze.Zero)},push:function(t){if(this.enabled){const e=eC.pop();e.set(this,t.getModelViewMatrix().get()),t.getLocalObjects().push(e),++t.getLocalObjectsCount()[0]}},pop:function(t){this.enabled&&(this.getBrowser().getLocalObjects().push(t.getLocalObjects().pop()),--t.getLocalObjectsCount()[0])}});const oC=iC;n.set("x_ite/Components/Rendering/ClipPlane",oC);const rC=oC;function sC(t){Id.call(this,t),this.addType(c.X3DColorNode),this.addChildObjects("transparent",new ji.SFBool),this._transparent.setAccessType(c.outputOnly)}sC.prototype=Object.assign(Object.create(Id.prototype),{constructor:sC,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},isTransparent:function(){return this._transparent.getValue()}});const aC=sC;n.set("x_ite/Components/Rendering/X3DColorNode",aC);const uC=aC;function cC(t){uC.call(this,t),this.addType(c.Color)}cC.prototype=Object.assign(Object.create(uC.prototype),{constructor:cC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"color",new ji.MFColor)]),getTypeName:function(){return"Color"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){uC.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__:function(){this.color=this._color.getValue(),this.length=this._color.length},addColor:function(t,e){if(t>=0&&t<this.length){const n=this.color;t*=3,e.push(n[t],n[t+1],n[t+2],1)}else if(this.length){const n=this.color;t=3*(this.length-1),e.push(n[t],n[t+1],n[t+2],1)}else e.push(1,1,1,1)},addColors:function(t,e){if(this.length){const o=this.color;for(var n=0,i=3*Math.min(e,this.length);n<i;n+=3)t.push(o[n],o[n+1],o[n+2],1);if(this.length<e){const r=o[n=3*(this.length-1)],s=o[n+1],a=o[n+2];for(n=i,i=3*e;n<i;n+=3)t.push(r,s,a,1)}}else for(let n=0;n<e;++n)t.push(1,1,1,1);return t}});const lC=cC;n.set("x_ite/Components/Rendering/Color",lC);const hC=lC;function dC(t){uC.call(this,t),this.addType(c.ColorRGBA),this.setTransparent(!0)}dC.prototype=Object.assign(Object.create(uC.prototype),{constructor:dC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"color",new ji.MFColorRGBA)]),getTypeName:function(){return"ColorRGBA"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){uC.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__:function(){this.color=this._color.getValue(),this.length=this._color.length},addColor:function(t,e){if(t>=0&&t<this.length){const n=this.color;t*=4,e.push(n[t],n[t+1],n[t+2],n[t+3])}else if(this.length){const n=this.color;t=4*(this.length-1),e.push(n[t],n[t+1],n[t+2],n[t+3])}else e.push(1,1,1,1)},addColors:function(t,e){if(this.length){const o=this.color;for(var n=0,i=4*Math.min(e,this.length);n<i;n+=4)t.push(o[n],o[n+1],o[n+2],o[n+3]);if(this.length<e){const r=o[n=4*(this.length-1)],s=o[n+1],a=o[n+2],u=o[n+2];for(n=i,i=4*e;n<i;n+=4)t.push(r,s,a,u)}}else for(let n=0;n<e;++n)t.push(1,1,1,1);return t}});const pC=dC;n.set("x_ite/Components/Rendering/ColorRGBA",pC);const fC=pC;function gC(t){vd.call(this,t),this.addType(c.IndexedTriangleFanSet),this.triangleIndex=[]}gC.prototype=Object.assign(Object.create(vd.prototype),{constructor:gC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_index",new ji.MFInt32),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"normalPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"index",new ji.MFInt32),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"IndexedTriangleFanSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){vd.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__:function(){const t=this._index,e=this.triangleIndex;e.length=0;for(let n=0,i=t.length;n<i;++n){const o=t[n];if(!(o<0)&&++n<i){let r=t[n];if(r<0)continue;for(++n;n<i;++n){const i=t[n];if(i<0)break;e.push(o,r,i),r=i}}}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){vd.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const mC=gC;n.set("x_ite/Components/Rendering/IndexedTriangleFanSet",mC);const _C=mC;function xC(t){vd.call(this,t),this.addType(c.IndexedTriangleSet)}xC.prototype=Object.assign(Object.create(vd.prototype),{constructor:xC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_index",new ji.MFInt32),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"normalPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"index",new ji.MFInt32),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"IndexedTriangleSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["3.0","Infinity"]},getPolygonIndex:function(t){return this._index[t]},initialize:function(){vd.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index)},build:function(){vd.prototype.build.call(this,3,this._index.length,3,this._index.length)}});const yC=xC;n.set("x_ite/Components/Rendering/IndexedTriangleSet",yC);const wC=yC;function SC(t){vd.call(this,t),this.addType(c.IndexedTriangleStripSet),this.triangleIndex=[]}SC.prototype=Object.assign(Object.create(vd.prototype),{constructor:SC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"set_index",new ji.MFInt32),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"normalPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"index",new ji.MFInt32),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"IndexedTriangleStripSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){vd.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__:function(){const t=this._index,e=this.triangleIndex;e.length=0;for(let n=0,i=t.length;n<i;++n){let o=t[n];if(!(o<0)&&++n<i){let r=t[n];if(r<0)continue;++n;for(let s=0;n<i;++n,++s){const i=t[n];if(i<0)break;e.push(o,r,i),1&s?r=i:o=i}}}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){vd.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const TC=SC;n.set("x_ite/Components/Rendering/IndexedTriangleStripSet",TC);const bC=TC;function vC(t){mp.call(this,t),this.addType(c.LineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}vC.prototype=Object.assign(Object.create(mp.prototype),{constructor:vC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"vertexCount",new ji.MFInt32),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"LineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){mp.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=rc(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=rc(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=rc(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_normal__:function(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=rc(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=rc(c.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this._vertexCount,e=this.getAttrib(),n=e.length,i=this.getAttribs(),o=this.fogCoordNode,r=this.colorNode,s=this.normalNode,a=this.coordNode,u=this.getFogDepths(),c=this.getColors(),l=this.getNormals(),h=this.getVertices(),d=a.getSize();let p=0;for(let f of t){if(p+f>d)break;if(f>1){f=2*f-2;for(let t=0;t<f;++t,p+=1&t){for(let t=0;t<n;++t)e[t].addValue(p,i[t]);o?.addDepth(p,u),r?.addColor(p,c),s?.addVector(p,l),a.addPoint(p,h)}++p}else p+=f}}});const EC=vC;n.set("x_ite/Components/Rendering/LineSet",EC);const CC=EC;function OC(t){Id.call(this,t),this.addType(c.X3DNormalNode)}OC.prototype=Object.assign(Object.create(Id.prototype),{constructor:OC});const NC=OC;n.set("x_ite/Components/Rendering/X3DNormalNode",NC);const FC=NC;function IC(t){FC.call(this,t),this.addType(c.Normal)}IC.prototype=Object.assign(Object.create(FC.prototype),{constructor:IC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"vector",new ji.MFVec3f)]),getTypeName:function(){return"Normal"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"normal"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){FC.prototype.initialize.call(this),this._vector.addInterest("set_vector__",this),this.set_vector__()},set_vector__:function(){this.vector=this._vector.getValue(),this.length=this._vector.length},set1Vector:function(t,e){this._vector[t]=e},get1Vector:function(t,e){if(t>=0&&t<this.length){const n=this.vector;return t*=3,e.set(n[t],n[t+1],n[t+2])}if(t>=0&&this.length){const n=this.vector;return t%=this.length,t*=3,e.set(n[t],n[t+1],n[t+2])}return e.set(0,0,0)},addVector:function(t,e){if(t>=0&&t<this.length){const n=this.vector;t*=3,e.push(n[t],n[t+1],n[t+2])}else{if(!(t>=0&&this.length))return e.push(0,0,0);{const n=this.vector;t%=this.length,t*=3,e.push(n[t],n[t+1],n[t+2])}}},addNormals:function(t,e){if(this.length){const o=this.vector;for(var n=0,i=3*Math.min(e,this.length);n<i;n+=3)t.push(o[n],o[n+1],o[n+2]);if(this.length<e){const r=o[n=3*(this.length-1)],s=o[n+1],a=o[n+2];for(n=i,i=3*e;n<i;n+=3)t.push(r,s,a)}}else for(let n=0;n<e;++n)t.push(0,0,0);return t}});const MC=IC;n.set("x_ite/Components/Rendering/Normal",MC);const DC=MC;function RC(t){Bu.call(this,t);const e=this.getBrowser();this.setGeometryType(0),this.setPrimitiveMode(e.getContext().POINTS),this.setSolid(!1),this.setTransparent(!0)}RC.prototype=Object.assign(Object.create(Bu.prototype),{constructor:RC,intersectsLine:function(){return!1},intersectsBox:function(){return!1},buildTexCoords:function(){},display:function(t,e){const n=e.appearanceNode,i=n.getShader(this,e),o=n.getBlendMode(),r=this.getAttrib(),s=this.getAttribBuffers();if(o?.enable(t),i.enable(t),i.setUniforms(t,this,e),this.vertexArrayObject.enable(i)){for(let e=0,n=r.length;e<n;++e)r[e].enable(t,i,s[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),this.hasNormals&&i.enableNormalAttribute(t,this.normalBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0)}t.drawArrays(this.primitiveMode,0,this.vertexCount),o?.disable(t)},displayParticles:function(t,e,n){const i=e.appearanceNode,o=i.getShader(this,e),r=i.getBlendMode(),s=this.getAttrib(),a=this.getAttribBuffers();r?.enable(t),o.enable(t),o.setUniforms(t,this,e);const u=n.outputParticles;if(u.vertexArrayObject.update(this.updateParticles).enable(o)){const e=n.particleStride;o.enableParticleAttribute(t,u,e,n.particleOffset,1),o.enableParticleMatrixAttribute(t,u,e,n.matrixOffset,1);for(let e=0,n=s.length;e<n;++e)s[e].enable(t,o,a[e]);this.hasFogCoords&&o.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&o.enableColorAttribute(t,this.colorBuffer,0,0),this.hasNormals&&o.enableNormalAttribute(t,this.normalBuffer,0,0),o.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}t.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,n.numParticles),r?.disable(t)}});const VC=RC;n.set("x_ite/Components/Rendering/X3DPointGeometryNode",VC);const AC=VC;function PC(t){AC.call(this,t),this.addType(c.PointSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}PC.prototype=Object.assign(Object.create(AC.prototype),{constructor:PC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"PointSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){AC.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},getCoord:function(){return this.coordNode},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=rc(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=rc(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=rc(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this)},set_normal__:function(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=rc(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=rc(c.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this.getAttrib(),e=t.length,n=this.getAttribs(),i=this.fogCoordNode,o=this.getFogDepths(),r=this.colorNode,s=this.getColors(),a=this.coordNode,u=this.getNormals(),c=this.normalNode,l=this.getVertices(),h=a._point.length;for(let i=0;i<e;++i)for(let e=0;e<h;++e)t[i].addValue(e,n[i]);i?.addDepths(o,h),r?.addColors(s,h),c?.addNormals(u,h),a.addPoints(l,h)}});const LC=PC;n.set("x_ite/Components/Rendering/PointSet",LC);const BC=LC;function XC(t){vd.call(this,t),this.addType(c.TriangleFanSet),this.triangleIndex=[]}XC.prototype=Object.assign(Object.create(vd.prototype),{constructor:XC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"normalPerVertex",new ji.SFBool(!0)),new k(c.inputOutput,"fanCount",new ji.MFInt32),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"TriangleFanSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){vd.prototype.initialize.call(this),this._fanCount.addInterest("set_fanCount__",this),this.set_fanCount__()},set_fanCount__:function(){const t=this._fanCount,e=this.triangleIndex;e.length=0;let n=0;for(const i of t){for(let t=1,o=i-1;t<o;++t)e.push(n,n+t,n+t+1);n+=i}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){vd.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const UC=XC;n.set("x_ite/Components/Rendering/TriangleFanSet",UC);const kC=UC;function zC(t){vd.call(this,t),this.addType(c.TriangleSet)}zC.prototype=Object.assign(Object.create(vd.prototype),{constructor:zC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"normalPerVertex",new ji.SFBool(!0)),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"TriangleSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["3.0","Infinity"]},build:function(){this.getCoord()&&vd.prototype.build.call(this,3,this.getCoord().getSize(),3,this.getCoord().getSize())},createNormals:function(t,e){return this.createFaceNormals(t,e)}});const jC=zC;n.set("x_ite/Components/Rendering/TriangleSet",jC);const GC=jC;function HC(t){vd.call(this,t),this.addType(c.TriangleStripSet),this.triangleIndex=[]}HC.prototype=Object.assign(Object.create(vd.prototype),{constructor:HC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"solid",new ji.SFBool(!0)),new k(c.initializeOnly,"ccw",new ji.SFBool(!0)),new k(c.initializeOnly,"colorPerVertex",new ji.SFBool(!0)),new k(c.initializeOnly,"normalPerVertex",new ji.SFBool(!0)),new k(c.inputOutput,"stripCount",new ji.MFInt32),new k(c.inputOutput,"attrib",new ji.MFNode),new k(c.inputOutput,"fogCoord",new ji.SFNode),new k(c.inputOutput,"color",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.SFNode),new k(c.inputOutput,"normal",new ji.SFNode),new k(c.inputOutput,"coord",new ji.SFNode)]),getTypeName:function(){return"TriangleStripSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){vd.prototype.initialize.call(this),this._stripCount.addInterest("set_stripCount__",this),this.set_stripCount__()},set_stripCount__:function(){const t=this._stripCount,e=this.triangleIndex;e.length=0;let n=0;for(const i of t){for(let t=0,o=i-2;t<o;++t){const i=1&t;e.push(n+(i?t+1:t),n+(i?t:t+1),n+(t+2))}n+=i}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){vd.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const qC=HC;n.set("x_ite/Components/Rendering/TriangleStripSet",qC);const YC={ClipPlane:rC,Color:hC,ColorRGBA:fC,Coordinate:Pd,IndexedLineSet:yp,IndexedTriangleFanSet:_C,IndexedTriangleSet:wC,IndexedTriangleStripSet:bC,LineSet:CC,Normal:DC,PointSet:BC,TriangleFanSet:kC,TriangleSet:GC,TriangleStripSet:qC},WC={X3DColorNode:uC,X3DComposedGeometryNode:vd,X3DCoordinateNode:Rd,X3DGeometricPropertyNode:Id,X3DGeometryNode:Bu,X3DLineGeometryNode:mp,X3DNormalNode:FC};for(const t in YC)Sr.addNodeType(t,YC[t]);for(const t in WC)Sr.addAbstractNodeType(t,WC[t]);const KC=void 0;n.set("x_ite/Components/Rendering",KC);function JC(t){Id.call(this,t),this.addType(c.X3DVertexAttributeNode),this.addChildObjects("attribute_changed",new ji.SFTime)}JC.prototype=Object.assign(Object.create(Id.prototype),{constructor:JC,initialize:function(){Id.prototype.initialize.call(this),this._name.addInterest("set_attribute__",this)},set_attribute__:function(){this._attribute_changed=this.getBrowser().getCurrentTime()}});const ZC=JC;n.set("x_ite/Components/Shaders/X3DVertexAttributeNode",ZC);const QC=ZC;function $C(t){QC.call(this,t),this.addType(c.FloatVertexAttribute)}$C.prototype=Object.assign(Object.create(QC.prototype),{constructor:$C,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"name",new ji.SFString),new k(c.initializeOnly,"numComponents",new ji.SFInt32(4)),new k(c.inputOutput,"value",new ji.MFFloat)]),getTypeName:function(){return"FloatVertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){QC.prototype.initialize.call(this),this._numComponents.addInterest("set_numComponents__",this),this._numComponents.addInterest("set_attribute__",this),this._value.addInterest("set_value__",this),this.set_numComponents__(),this.set_value__()},set_numComponents__:function(){this.numComponents=d.clamp(this._numComponents.getValue(),1,4)},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){const n=this.value;let i=t*this.numComponents,o=i+this.numComponents;if(o<=this.length)for(;i<o;++i)e.push(n[i]);else if(this.numComponents<=this.length)for(o=n.length,i=o-this.numComponents;i<o;++i)e.push(n[i]);else for(;i<o;++i)e.push(0)},enable:function(t,e,n){e.enableFloatAttrib(t,this._name.getValue(),n,this.numComponents,0,0)}});const tO=$C;n.set("x_ite/Components/Shaders/FloatVertexAttribute",tO);const eO=tO;function nO(t){QC.call(this,t),this.addType(c.Matrix3VertexAttribute)}nO.prototype=Object.assign(Object.create(QC.prototype),{constructor:nO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"name",new ji.SFString),new k(c.inputOutput,"value",new ji.MFMatrix3f)]),getTypeName:function(){return"Matrix3VertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){QC.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){if(t<this.length){const n=this.value;for(let i=9*t,o=i+9;i<o;++i)e.push(n[i])}else if(this.length){const n=this.value;for(let i=9*(t=this.length-1),o=i+9;i<o;++i)e.push(n[i])}else{const t=Re.Identity;for(let n=0;n<9;++n)e.push(t[n])}},enable:function(t,e,n){e.enableMatrix3Attrib(t,this._name.getValue(),n,0,0)}});const iO=nO;n.set("x_ite/Components/Shaders/Matrix3VertexAttribute",iO);const oO=iO;function rO(t){QC.call(this,t),this.addType(c.Matrix4VertexAttribute)}rO.prototype=Object.assign(Object.create(QC.prototype),{constructor:rO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.initializeOnly,"name",new ji.SFString),new k(c.inputOutput,"value",new ji.MFMatrix4f)]),getTypeName:function(){return"Matrix4VertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){QC.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){if(t<this.length){const n=this.value;for(let i=16*t,o=i+16;i<o;++i)e.push(n[i])}else if(this.length){const n=this.value;for(let i=16*(t=this.length-1),o=i+16;i<o;++i)e.push(n[i])}else{const t=Matrix4.Identity;for(let n=0;n<16;++n)e.push(t[n])}},enable:function(t,e,n){e.enableMatrix4Attrib(t,this._name.getValue(),n,0,0)}});const sO=rO;n.set("x_ite/Components/Shaders/Matrix4VertexAttribute",sO);const aO=sO;function uO(t){cx.call(this,t),es.call(this,t),fx.call(this,t),this.addType(c.PackagedShader)}uO.prototype=Object.assign(Object.create(cx.prototype),es.prototype,fx.prototype,{constructor:uO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOnly,"activate",new ji.SFBool),new k(c.outputOnly,"isSelected",new ji.SFBool),new k(c.outputOnly,"isValid",new ji.SFBool),new k(c.initializeOnly,"language",new ji.SFString),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600))]),getTypeName:function(){return"PackagedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},getSpecificationRange:function(){return["3.0","Infinity"]},getSourceText:function(){return this._url},requestImmediateLoad:function(t=!0){},initialize:function(){cx.prototype.initialize.call(this),es.prototype.initialize.call(this),fx.prototype.initialize.call(this)},dispose:function(){fx.prototype.dispose.call(this),es.prototype.dispose.call(this),cx.prototype.dispose.call(this)}});const cO=uO;n.set("x_ite/Components/Shaders/PackagedShader",cO);const lO=cO;function hO(t){cx.call(this,t),this.addType(c.ProgramShader)}hO.prototype=Object.assign(Object.create(cx.prototype),{constructor:hO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOnly,"activate",new ji.SFBool),new k(c.outputOnly,"isSelected",new ji.SFBool),new k(c.outputOnly,"isValid",new ji.SFBool),new k(c.initializeOnly,"language",new ji.SFString),new k(c.inputOutput,"programs",new ji.MFNode)]),getTypeName:function(){return"ProgramShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},getSpecificationRange:function(){return["3.0","Infinity"]}});const dO=hO;n.set("x_ite/Components/Shaders/ProgramShader",dO);const pO=dO;function fO(t){dr.call(this,t),es.call(this,t),fx.call(this,t),this.addType(c.ShaderProgram)}fO.prototype=Object.assign(Object.create(dr.prototype),es.prototype,fx.prototype,{constructor:fO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.initializeOnly,"type",new ji.SFString("VERTEX")),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600))]),getTypeName:function(){return"ShaderProgram"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"programs"},getSpecificationRange:function(){return["3.0","Infinity"]},getSourceText:function(){return this._url},requestImmediateLoad:function(t=!0){},initialize:function(){dr.prototype.initialize.call(this),es.prototype.initialize.call(this),fx.prototype.initialize.call(this)},dispose:function(){fx.prototype.dispose.call(this),es.prototype.dispose.call(this),dr.prototype.dispose.call(this)}});const gO=fO;n.set("x_ite/Components/Shaders/ShaderProgram",gO);const mO={ComposedShader:bx,FloatVertexAttribute:eO,Matrix3VertexAttribute:oO,Matrix4VertexAttribute:aO,PackagedShader:lO,ProgramShader:pO,ShaderPart:Wx,ShaderProgram:gO},_O={X3DProgrammableShaderObject:fx,X3DShaderNode:cx,X3DVertexAttributeNode:QC};for(const t in mO)Sr.addNodeType(t,mO[t]);for(const t in _O)Sr.addAbstractNodeType(t,_O[t]);const xO=void 0;n.set("x_ite/Components/Shaders",xO);function yO(t){tc.call(this,t),this.addType(c.AcousticProperties)}yO.prototype=Object.assign(Object.create(tc.prototype),{constructor:yO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"absorption",new ji.SFFloat),new k(c.inputOutput,"refraction",new ji.SFFloat),new k(c.inputOutput,"diffuse",new ji.SFFloat),new k(c.inputOutput,"specular",new ji.SFFloat)]),getTypeName:function(){return"AcousticProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"AcousticProperties"},getSpecificationRange:function(){return["4.0","Infinity"]}});const wO=yO;n.set("x_ite/Components/Shape/AcousticProperties",wO);const SO=wO;function TO(t){tc.call(this,t),this.addType(c.FillProperties),this.addChildObjects("transparent",new ji.SFBool),this._transparent.setAccessType(c.outputOnly),this.hatchColor=new Float32Array(3)}TO.prototype=Object.assign(Object.create(tc.prototype),{constructor:TO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"filled",new ji.SFBool(!0)),new k(c.inputOutput,"hatched",new ji.SFBool(!0)),new k(c.inputOutput,"hatchColor",new ji.SFColor(1,1,1)),new k(c.inputOutput,"hatchStyle",new ji.SFInt32(1))]),getTypeName:function(){return"FillProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"fillProperties"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){tc.prototype.initialize.call(this),this._filled.addInterest("set_filled__",this),this._hatched.addInterest("set_hatched__",this),this._hatchColor.addInterest("set_hatchColor__",this),this._hatchStyle.addInterest("set_hatchStyle__",this),this.set_filled__(),this.set_hatched__(),this.set_hatchColor__(),this.set_hatchStyle__(),this.getBrowser().getHatchStyleTexture(this.hatchStyle)},set_filled__:function(){this.filled=this._filled.getValue(),this.setTransparent(!this.filled)},set_hatched__:function(){this.hatched=this._hatched.getValue()},set_hatchColor__:function(){this.hatchColor[0]=this._hatchColor[0],this.hatchColor[1]=this._hatchColor[1],this.hatchColor[2]=this._hatchColor[2]},set_hatchStyle__:function(){let t=this._hatchStyle.getValue();(t<1||t>19)&&(t=1),this.hatchStyle=t},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},isTransparent:function(){return this._transparent.getValue()},setShaderUniforms:function(t,e){const n=this.hatched;if(t.uniform1i(e.x3d_FillPropertiesFilled,this.filled),t.uniform1i(e.x3d_FillPropertiesHatched,n),n){const n=this.getBrowser(),i=n.getHatchStyleTexture(this.hatchStyle),o=n.getTexture2DUnit();t.uniform3fv(e.x3d_FillPropertiesHatchColor,this.hatchColor),t.uniform1f(e.x3d_FillPropertiesScale,n.getRenderingProperty("ContentScale")),t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,i.getTexture()),t.uniform1i(e.x3d_FillPropertiesTexture,o)}}});const bO=TO;n.set("x_ite/Components/Shape/FillProperties",bO);const vO=bO;function EO(t){xy.call(this,t),this.addType(c.Material),t.getSpecificationVersion()<4&&(this.getMaterialKey=CO),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3)}function CO(t){return t||+this.getTextureBits()||this.getBrowser().getBrowserOptions().getShading()===Lo.PHONG?"2":"1"}EO.prototype=Object.assign(Object.create(xy.prototype),{constructor:EO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"ambientIntensity",new ji.SFFloat(.2)),new k(c.inputOutput,"ambientTextureMapping",new ji.SFString),new k(c.inputOutput,"ambientTexture",new ji.SFNode),new k(c.inputOutput,"diffuseColor",new ji.SFColor(.8,.8,.8)),new k(c.inputOutput,"diffuseTextureMapping",new ji.SFString),new k(c.inputOutput,"diffuseTexture",new ji.SFNode),new k(c.inputOutput,"specularColor",new ji.SFColor),new k(c.inputOutput,"specularTextureMapping",new ji.SFString),new k(c.inputOutput,"specularTexture",new ji.SFNode),new k(c.inputOutput,"emissiveColor",new ji.SFColor),new k(c.inputOutput,"emissiveTextureMapping",new ji.SFString),new k(c.inputOutput,"emissiveTexture",new ji.SFNode),new k(c.inputOutput,"shininess",new ji.SFFloat(.2)),new k(c.inputOutput,"shininessTextureMapping",new ji.SFString),new k(c.inputOutput,"shininessTexture",new ji.SFNode),new k(c.inputOutput,"occlusionStrength",new ji.SFFloat(1)),new k(c.inputOutput,"occlusionTextureMapping",new ji.SFString),new k(c.inputOutput,"occlusionTexture",new ji.SFNode),new k(c.inputOutput,"normalScale",new ji.SFFloat(1)),new k(c.inputOutput,"normalTextureMapping",new ji.SFString),new k(c.inputOutput,"normalTexture",new ji.SFNode),new k(c.inputOutput,"transparency",new ji.SFFloat)]),getTypeName:function(){return"Material"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){xy.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._ambientTexture.addInterest("set_ambientTexture__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._diffuseTexture.addInterest("set_diffuseTexture__",this),this._specularColor.addInterest("set_specularColor__",this),this._specularTexture.addInterest("set_specularTexture__",this),this._shininess.addInterest("set_shininess__",this),this._shininessTexture.addInterest("set_shininessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_ambientIntensity__(),this.set_ambientTexture__(),this.set_diffuseColor__(),this.set_diffuseTexture__(),this.set_specularColor__(),this.set_specularTexture__(),this.set_shininess__(),this.set_shininessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_ambientIntensity__:function(){this.ambientIntensity=d.clamp(this._ambientIntensity.getValue(),0,1)},set_ambientTexture__:function(){this.ambientTextureNode=rc(c.X3DSingleTextureNode,this._ambientTexture),this.setTexture(this.getTextureIndices().AMBIENT_TEXTURE,this.ambientTextureNode)},set_diffuseColor__:function(){const t=this.diffuseColor,e=this._diffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_diffuseTexture__:function(){this.diffuseTextureNode&&this.diffuseTextureNode._transparent.removeInterest("set_transparent__",this),this.diffuseTextureNode=rc(c.X3DSingleTextureNode,this._diffuseTexture),this.diffuseTextureNode&&this.diffuseTextureNode._transparent.addInterest("set_transparent__",this),this.setTexture(this.getTextureIndices().DIFFUSE_TEXTURE,this.diffuseTextureNode)},set_specularColor__:function(){const t=this.specularColor,e=this._specularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_specularTexture__:function(){this.specularTextureNode=rc(c.X3DSingleTextureNode,this._specularTexture),this.setTexture(this.getTextureIndices().SPECULAR_TEXTURE,this.specularTextureNode)},set_shininess__:function(){this.shininess=d.clamp(this._shininess.getValue(),0,1)},set_shininessTexture__:function(){this.shininessTextureNode=rc(c.X3DSingleTextureNode,this._shininessTexture),this.setTexture(this.getTextureIndices().SHININESS_TEXTURE,this.shininessTextureNode)},set_occlusionStrength__:function(){this.occlusionStrength=d.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__:function(){this.occlusionTextureNode=rc(c.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__:function(){this.setTransparent(!(!this.getTransparency()&&!this.diffuseTextureNode?.isTransparent()))},getBaseTexture:function(){return this.diffuseTexture},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++,AMBIENT_TEXTURE:t++,DIFFUSE_TEXTURE:t++,SPECULAR_TEXTURE:t++,SHININESS_TEXTURE:t++,OCCLUSION_TEXTURE:t++};return function(){return e}}(),getMaterialKey:function(){return"2"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);if(e.hasNormals)switch(o.push("X3D_MATERIAL"),+this.getTextureBits()&&(this.ambientTextureNode&&o.push("X3D_AMBIENT_TEXTURE","X3D_AMBIENT_TEXTURE_"+this.ambientTextureNode.getTextureTypeString()),this.diffuseTextureNode&&o.push("X3D_DIFFUSE_TEXTURE","X3D_DIFFUSE_TEXTURE_"+this.diffuseTextureNode.getTextureTypeString()),this.specularTextureNode&&o.push("X3D_SPECULAR_TEXTURE","X3D_SPECULAR_TEXTURE_"+this.specularTextureNode.getTextureTypeString()),this.shininessTextureNode&&o.push("X3D_SHININESS_TEXTURE","X3D_SHININESS_TEXTURE_"+this.shininessTextureNode.getTextureTypeString()),this.occlusionTextureNode&&o.push("X3D_OCCLUSION_TEXTURE","X3D_OCCLUSION_TEXTURE_"+this.occlusionTextureNode.getTextureTypeString())),this.getMaterialKey(n&&n.shadows)){case"1":var r=i.createShader("GouraudShader","Gouraud","Gouraud",o);break;case"2":r=i.createShader("PhongShader","Default","Phong",o)}else{o.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",o);i.getShaders().set(t.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(t,r),r},setShaderUniforms:function(t,e,n,i,o){if(xy.prototype.setShaderUniforms.call(this,t,e,n,i,o),t.uniform1f(e.x3d_AmbientIntensity,this.ambientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.diffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.specularColor),t.uniform1f(e.x3d_Shininess,this.shininess),+this.getTextureBits()){if(this.ambientTextureNode){const r=this._ambientTextureMapping.getValue(),s=e.x3d_AmbientTexture;this.ambientTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}if(this.diffuseTextureNode){const r=this._diffuseTextureMapping.getValue(),s=e.x3d_DiffuseTexture;this.diffuseTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}if(this.specularTextureNode){const r=this._specularTextureMapping.getValue(),s=e.x3d_SpecularTexture;this.specularTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}if(this.shininessTextureNode){const r=this._shininessTextureMapping.getValue(),s=e.x3d_ShininessTexture;this.shininessTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}if(this.occlusionTextureNode){const r=this._occlusionTextureMapping.getValue(),s=e.x3d_OcclusionTexture;t.uniform1f(e.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}}}});const OO=EO;n.set("x_ite/Components/Shape/Material",OO);const NO=OO;function FO(t){xy.call(this,t),this.addType(c.PhysicalMaterial),this.baseColor=new Float32Array(3)}FO.prototype=Object.assign(Object.create(xy.prototype),{constructor:FO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"baseColor",new ji.SFColor(1,1,1)),new k(c.inputOutput,"baseTextureMapping",new ji.SFString),new k(c.inputOutput,"baseTexture",new ji.SFNode),new k(c.inputOutput,"emissiveColor",new ji.SFColor(0,0,0)),new k(c.inputOutput,"emissiveTextureMapping",new ji.SFString),new k(c.inputOutput,"emissiveTexture",new ji.SFNode),new k(c.inputOutput,"metallic",new ji.SFFloat(1)),new k(c.inputOutput,"roughness",new ji.SFFloat(1)),new k(c.inputOutput,"metallicRoughnessTextureMapping",new ji.SFString),new k(c.inputOutput,"metallicRoughnessTexture",new ji.SFNode),new k(c.inputOutput,"occlusionStrength",new ji.SFFloat(1)),new k(c.inputOutput,"occlusionTextureMapping",new ji.SFString),new k(c.inputOutput,"occlusionTexture",new ji.SFNode),new k(c.inputOutput,"normalScale",new ji.SFFloat(1)),new k(c.inputOutput,"normalTextureMapping",new ji.SFString),new k(c.inputOutput,"normalTexture",new ji.SFNode),new k(c.inputOutput,"transparency",new ji.SFFloat)]),getTypeName:function(){return"PhysicalMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},getSpecificationRange:function(){return["4.0","Infinity"]},initialize:function(){xy.prototype.initialize.call(this),this._baseColor.addInterest("set_baseColor__",this),this._baseTexture.addInterest("set_baseTexture__",this),this._metallic.addInterest("set_metallic__",this),this._roughness.addInterest("set_roughness__",this),this._metallicRoughnessTexture.addInterest("set_metallicRoughnessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_baseColor__(),this.set_baseTexture__(),this.set_metallic__(),this.set_roughness__(),this.set_metallicRoughnessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_baseColor__:function(){const t=this.baseColor,e=this._baseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_baseTexture__:function(){this.baseTextureNode&&this.baseTextureNode._transparent.removeInterest("set_transparent__",this),this.baseTextureNode=rc(c.X3DSingleTextureNode,this._baseTexture),this.setTexture(this.getTextureIndices().BASE_TEXTURE,this.baseTextureNode),this.baseTextureNode&&this.baseTextureNode._transparent.addInterest("set_transparent__",this)},set_metallic__:function(){this.metallic=d.clamp(this._metallic.getValue(),0,1)},set_roughness__:function(){this.roughness=d.clamp(this._roughness.getValue(),0,1)},set_metallicRoughnessTexture__:function(){this.metallicRoughnessTextureNode=rc(c.X3DSingleTextureNode,this._metallicRoughnessTexture),this.setTexture(this.getTextureIndices().METALLIC_ROUGHNESS_TEXTURE,this.metallicRoughnessTextureNode)},set_occlusionStrength__:function(){this.occlusionStrength=d.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__:function(){this.occlusionTextureNode=rc(c.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__:function(){this.setTransparent(!(!this.getTransparency()&&!this.baseTextureNode?.isTransparent()))},getBaseTexture:function(){return this.baseTextureNode},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++,BASE_TEXTURE:t++,METALLIC_ROUGHNESS_TEXTURE:t++,OCCLUSION_TEXTURE:t++};return function(){return e}}(),getMaterialKey:function(){return"3"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);if(e.hasNormals){o.push("X3D_PHYSICAL_MATERIAL","MANUAL_SRGB"),+this.getTextureBits()&&(this.baseTextureNode&&o.push("X3D_BASE_TEXTURE","X3D_BASE_TEXTURE_"+this.baseTextureNode.getTextureTypeString()),this.metallicRoughnessTextureNode&&o.push("X3D_METALLIC_ROUGHNESS_TEXTURE","X3D_METALLIC_ROUGHNESS_TEXTURE_"+this.metallicRoughnessTextureNode.getTextureTypeString()),this.occlusionTextureNode&&o.push("X3D_OCCLUSION_TEXTURE","X3D_OCCLUSION_TEXTURE_"+this.occlusionTextureNode.getTextureTypeString()));var r=i.createShader("PhysicalMaterialShader","Default","PBR",o)}else{o.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",o);i.getShaders().set(t.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(t,r),r},setShaderUniforms:function(t,e,n,i,o){if(xy.prototype.setShaderUniforms.call(this,t,e,n,i,o),t.uniform3fv(e.x3d_BaseColor,this.baseColor),t.uniform1f(e.x3d_Metallic,this.metallic),t.uniform1f(e.x3d_Roughness,this.roughness),+this.getTextureBits()){if(this.baseTextureNode){const r=this._baseTextureMapping.getValue(),s=e.x3d_BaseTexture;this.baseTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}if(this.metallicRoughnessTextureNode){const r=this._metallicRoughnessTextureMapping.getValue(),s=e.x3d_MetallicRoughnessTexture;this.metallicRoughnessTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}if(this.occlusionTextureNode){const r=this._occlusionTextureMapping.getValue(),s=e.x3d_OcclusionTexture;t.uniform1f(e.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(t,e,n,s),t.uniform1i(s.textureTransformMapping,i.get(r)??0),t.uniform1i(s.textureCoordinateMapping,o.get(r)??0)}}}});const IO=FO;n.set("x_ite/Components/Shape/PhysicalMaterial",IO);const MO=IO;function DO(t){console.warn("TwoSidedMaterial is depreciated, please use Appearance backMaterial field."),gy.call(this,t),this.addType(c.TwoSidedMaterial),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3),this.emissiveColor=new Float32Array(3),this.backDiffuseColor=new Float32Array(3),this.backSpecularColor=new Float32Array(3),this.backEmissiveColor=new Float32Array(3)}DO.prototype=Object.assign(Object.create(gy.prototype),{constructor:DO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"separateBackColor",new ji.SFBool),new k(c.inputOutput,"ambientIntensity",new ji.SFFloat(.2)),new k(c.inputOutput,"diffuseColor",new ji.SFColor(.8,.8,.8)),new k(c.inputOutput,"specularColor",new ji.SFColor),new k(c.inputOutput,"emissiveColor",new ji.SFColor),new k(c.inputOutput,"shininess",new ji.SFFloat(.2)),new k(c.inputOutput,"transparency",new ji.SFFloat),new k(c.inputOutput,"backAmbientIntensity",new ji.SFFloat(.2)),new k(c.inputOutput,"backDiffuseColor",new ji.SFColor(.8,.8,.8)),new k(c.inputOutput,"backSpecularColor",new ji.SFColor),new k(c.inputOutput,"backEmissiveColor",new ji.SFColor),new k(c.inputOutput,"backShininess",new ji.SFFloat(.2)),new k(c.inputOutput,"backTransparency",new ji.SFFloat)]),getTypeName:function(){return"TwoSidedMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},getSpecificationRange:function(){return["3.2","Infinity"]},initialize:function(){gy.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._specularColor.addInterest("set_specularColor__",this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._shininess.addInterest("set_shininess__",this),this._transparency.addInterest("set_transparency__",this),this._backAmbientIntensity.addInterest("set_backAmbientIntensity__",this),this._backDiffuseColor.addInterest("set_backDiffuseColor__",this),this._backSpecularColor.addInterest("set_backSpecularColor__",this),this._backEmissiveColor.addInterest("set_backEmissiveColor__",this),this._backShininess.addInterest("set_backShininess__",this),this._backTransparency.addInterest("set_backTransparency__",this),this._separateBackColor.addInterest("set_transparent__",this),this._transparency.addInterest("set_transparent__",this),this._backTransparency.addInterest("set_transparent__",this),this.set_ambientIntensity__(),this.set_diffuseColor__(),this.set_specularColor__(),this.set_emissiveColor__(),this.set_shininess__(),this.set_transparency__(),this.set_backAmbientIntensity__(),this.set_backDiffuseColor__(),this.set_backSpecularColor__(),this.set_backEmissiveColor__(),this.set_backShininess__(),this.set_backTransparency__(),this.set_transparent__()},set_ambientIntensity__:function(){this.ambientIntensity=Math.max(this._ambientIntensity.getValue(),0)},set_diffuseColor__:function(){const t=this.diffuseColor,e=this._diffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_specularColor__:function(){const t=this.specularColor,e=this._specularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_emissiveColor__:function(){const t=this.emissiveColor,e=this._emissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_shininess__:function(){this.shininess=d.clamp(this._shininess.getValue(),0,1)},set_transparency__:function(){this.transparency=d.clamp(this._transparency.getValue(),0,1)},set_backAmbientIntensity__:function(){this.backAmbientIntensity=Math.max(this._backAmbientIntensity.getValue(),0)},set_backDiffuseColor__:function(){const t=this.backDiffuseColor,e=this._backDiffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backSpecularColor__:function(){const t=this.backSpecularColor,e=this._backSpecularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backEmissiveColor__:function(){const t=this.backEmissiveColor,e=this._backEmissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backShininess__:function(){this.backShininess=d.clamp(this._backShininess.getValue(),0,1)},set_backTransparency__:function(){this.backTransparency=d.clamp(this._backTransparency.getValue(),0,1)},set_transparent__:function(){this.setTransparent(!!(this._transparency.getValue()||this._separateBackColor.getValue()&&this._backTransparency.getValue()))},getBaseTexture:NO.prototype.getBaseTexture,getMaterialKey:NO.prototype.getMaterialKey,createShader:NO.prototype.createShader,setShaderUniforms:function(t,e,n,i,o,r){!r&&this._separateBackColor.getValue()?(t.uniform1f(e.x3d_AmbientIntensity,this.backAmbientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.backDiffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.backSpecularColor),t.uniform3fv(e.x3d_EmissiveColor,this.backEmissiveColor),t.uniform1f(e.x3d_Shininess,this.backShininess),t.uniform1f(e.x3d_Transparency,this.backTransparency)):(t.uniform1f(e.x3d_AmbientIntensity,this.ambientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.diffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.specularColor),t.uniform3fv(e.x3d_EmissiveColor,this.emissiveColor),t.uniform1f(e.x3d_Shininess,this.shininess),t.uniform1f(e.x3d_Transparency,this.transparency))}});const RO=DO;n.set("x_ite/Components/Shape/TwoSidedMaterial",RO);const VO={AcousticProperties:SO,Appearance:sy,FillProperties:vO,LineProperties:dy,Material:NO,PhysicalMaterial:MO,PointProperties:cy,Shape:pp,TwoSidedMaterial:RO,UnlitMaterial:Sy},AO={X3DAppearanceChildNode:tc,X3DAppearanceNode:iy,X3DMaterialNode:gy,X3DOneSidedMaterialNode:xy,X3DShapeNode:lp};for(const t in VO)Sr.addNodeType(t,VO[t]);for(const t in AO)Sr.addAbstractNodeType(t,AO[t]);const PO=void 0;n.set("x_ite/Components/Shape",PO);function LO(t){fu.call(this,t),Nc.call(this,t),this.addType(c.X3DSoundProcessingNode),this.addChildObjects("loop",new ji.SFBool)}LO.prototype=Object.assign(Object.create(fu.prototype),Nc.prototype,{constructor:LO,initialize:function(){fu.prototype.initialize.call(this),Nc.prototype.initialize.call(this)},dispose:function(){Nc.prototype.dispose.call(this),fu.prototype.dispose.call(this)}});const BO=LO;n.set("x_ite/Components/Sound/X3DSoundProcessingNode",BO);const XO=BO;function UO(t){XO.call(this,t),this.addType(c.Analyser)}UO.prototype=Object.assign(Object.create(XO.prototype),{constructor:UO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"fftSize",new ji.SFInt32(2048)),new k(c.inputOutput,"frequencyBinCount",new ji.SFInt32(1024)),new k(c.inputOutput,"minDecibels",new ji.SFFloat(-100)),new k(c.inputOutput,"maxDecibels",new ji.SFFloat(-30)),new k(c.inputOutput,"smoothingTimeConstant",new ji.SFFloat(.8)),new k(c.inputOutput,"tailTime",new ji.SFTime),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Analyser"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const kO=UO;n.set("x_ite/Components/Sound/Analyser",kO);const zO=kO;function jO(t){fu.call(this,t),Nc.call(this,t),this.addType(c.X3DSoundSourceNode),this.volume=0,this.media=null}jO.prototype=Object.assign(Object.create(fu.prototype),Nc.prototype,{constructor:jO,initialize:function(){fu.prototype.initialize.call(this),Nc.prototype.initialize.call(this)},set_live__:function(){Nc.prototype.set_live__.call(this),this.getDisabled()?(this.getBrowser()._volume.removeInterest("set_volume__",this),this.getBrowser()._mute.removeInterest("set_volume__",this)):(this.getBrowser()._volume.addInterest("set_volume__",this),this.getBrowser()._mute.addInterest("set_volume__",this),this.set_volume__())},setMedia:function(t){this.media&&(this.media.muted=!0,this.media.pause()),this.media=t,t&&(this.media.muted=!0,this.media.volume=0,this.media.loop=this._loop.getValue(),this.setVolume(0),this._duration_changed=this.media.duration,this.resetElapsedTime(),this._isActive.getValue()?this._isPaused.getValue()?this.set_pause():this.getLiveState()?this.set_start():this.set_pause():this.set_stop())},setVolume:function(t){this.volume=d.clamp(t,0,1),this.set_volume__()},set_loop:function(){this.media&&(this.media.loop=this._loop.getValue())},set_volume__:function(){if(!this.media)return;const t=!this.getBrowser()._mute.getValue()*d.clamp(this.getBrowser()._volume.getValue(),0,1)*this.volume;this.media.muted=0===t,this.media.volume=t},set_speed:function(){},set_pitch:function(){},set_start:function(){this.media&&this._speed.getValue()&&(this.media.currentTime=0,this.media.play().catch(Function.prototype))},set_pause:function(){this.media&&this.media.pause()},set_resume:function(){this.media&&this._speed.getValue()&&this.media.play().catch(Function.prototype)},set_stop:function(){this.media&&this.media.pause()},set_end:function(){this._loop.getValue()||this.stop()},set_time:function(){this.media&&(this._elapsedTime=this.getElapsedTime(),this.media.currentTime<this.media.duration||this.set_end())},dispose:function(){Nc.prototype.dispose.call(this),fu.prototype.dispose.call(this)}});const GO=jO;n.set("x_ite/Components/Sound/X3DSoundSourceNode",GO);const HO=GO;var qO=i(532);function YO(t){HO.call(this,t),es.call(this,t),this.addType(c.AudioClip),this.addChildObjects("speed",new ji.SFFloat(1)),this.audio=qO("<audio></audio>"),this.urlStack=new ji.MFString}YO.prototype=Object.assign(Object.create(HO.prototype),es.prototype,{constructor:YO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"pitch",new ji.SFFloat(1)),new k(c.inputOutput,"loop",new ji.SFBool),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.outputOnly,"duration_changed",new ji.SFTime(-1))]),getTypeName:function(){return"AudioClip"},getComponentName:function(){return"Sound"},getContainerField:function(){return"source"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){HO.prototype.initialize.call(this),es.prototype.initialize.call(this),this.audio.on("abort error",this.setError.bind(this)),this.audio.on("suspend stalled",this.setTimeout.bind(this)),this.audio.prop("crossOrigin","Anonymous"),this.audio.prop("preload","auto"),this.audio.prop("muted",!0),this.requestImmediateLoad().catch(Function.prototype)},getElement:function(){return this.audio[0]},set_live__:function(){HO.prototype.set_live__.call(this),es.prototype.set_live__.call(this)},unloadData:function(){this.setMedia(null)},loadData:function(){this.setMedia(null),this.urlStack.setValue(this._url),this.audio.on("canplaythrough",this.setAudio.bind(this)),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.audio.off("canplaythrough"),this._duration_changed=-1,void this.setLoadState(c.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.audio.attr("src",this.URL.href),this.audio.get(0).load()},setTimeout:function(t){setTimeout((()=>{this.checkLoadState()===c.IN_PROGRESS_STATE&&this.setError(t)}),3e3)},setError:function(t){"data:"!==this.URL.protocol&&console.warn(`Error loading audio '${decodeURI(this.URL.href)}'`,t.type),this.loadNext()},setAudio:function(){this.audio.unbind("canplaythrough"),this.setMedia(this.audio[0]),this.setLoadState(c.COMPLETE_STATE)},dispose:function(){es.prototype.dispose.call(this),HO.prototype.dispose.call(this)}});const WO=YO;n.set("x_ite/Components/Sound/AudioClip",WO);const KO=WO;function JO(t){fu.call(this,t),this.addType(c.X3DSoundNode)}JO.prototype=Object.assign(Object.create(fu.prototype),{constructor:JO});const ZO=JO;n.set("x_ite/Components/Sound/X3DSoundNode",ZO);const QO=ZO;function $O(t){QO.call(this,t),this.addType(c.X3DSoundDestinationNode)}$O.prototype=Object.assign(Object.create(QO.prototype),{constructor:$O});const tN=$O;n.set("x_ite/Components/Sound/X3DSoundDestinationNode",tN);const eN=tN;function nN(t){eN.call(this,t),this.addType(c.AudioDestination)}nN.prototype=Object.assign(Object.create(eN.prototype),{constructor:nN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"maxChannelCount",new ji.SFInt32(2)),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.outputOnly,"mediaDeviceID",new ji.SFString),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"AudioDestination"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const iN=nN;n.set("x_ite/Components/Sound/AudioDestination",iN);const oN=iN;function rN(t){XO.call(this,t),this.addType(c.BiquadFilter)}rN.prototype=Object.assign(Object.create(XO.prototype),{constructor:rN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"detune",new ji.SFFloat(0)),new k(c.inputOutput,"frequency",new ji.SFFloat(350)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"qualityFactor",new ji.SFFloat(1)),new k(c.inputOutput,"tailTime",new ji.SFTime),new k(c.inputOutput,"type",new ji.SFString("lowpass")),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"BiquadFilter"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const sN=rN;n.set("x_ite/Components/Sound/BiquadFilter",sN);const aN=sN;function uN(t){HO.call(this,t),es.call(this,t),this.addType(c.BufferAudioSource),this.addChildObjects("speed",new ji.SFFloat(1))}uN.prototype=Object.assign(Object.create(HO.prototype),es.prototype,{constructor:uN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"buffer",new ji.MFFloat),new k(c.inputOutput,"detune",new ji.SFFloat(0)),new k(c.inputOutput,"bufferDuration",new ji.SFTime),new k(c.inputOutput,"loopStart",new ji.SFTime),new k(c.inputOutput,"loopEnd",new ji.SFTime),new k(c.inputOutput,"numberOfChannels",new ji.SFInt32),new k(c.inputOutput,"playbackRate",new ji.SFFloat(1)),new k(c.inputOutput,"sampleRate",new ji.SFFloat(0)),new k(c.outputOnly,"bufferLength",new ji.SFInt32),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"loop",new ji.SFBool),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime)]),getTypeName:function(){return"BufferAudioSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]},initialize:function(){HO.prototype.initialize.call(this),es.prototype.initialize.call(this)},dispose:function(){es.prototype.dispose.call(this),HO.prototype.dispose.call(this)}});const cN=uN;n.set("x_ite/Components/Sound/BufferAudioSource",cN);const lN=cN;function hN(t){QO.call(this,t),this.addType(c.X3DSoundChannelNode)}hN.prototype=Object.assign(Object.create(QO.prototype),{constructor:hN});const dN=hN;n.set("x_ite/Components/Sound/X3DSoundChannelNode",dN);const pN=dN;function fN(t){pN.call(this,t),this.addType(c.ChannelMerger)}fN.prototype=Object.assign(Object.create(pN.prototype),{constructor:fN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"ChannelMerger"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const gN=fN;n.set("x_ite/Components/Sound/ChannelMerger",gN);const mN=gN;function _N(t){pN.call(this,t),this.addType(c.ChannelSelector)}_N.prototype=Object.assign(Object.create(pN.prototype),{constructor:_N,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"channelSelection",new ji.SFInt32(0)),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"ChannelSelector"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const xN=_N;n.set("x_ite/Components/Sound/ChannelSelector",xN);const yN=xN;function wN(t){pN.call(this,t),this.addType(c.ChannelSplitter)}wN.prototype=Object.assign(Object.create(pN.prototype),{constructor:wN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"children",new ji.MFNode),new k(c.inputOutput,"outputs",new ji.MFNode)]),getTypeName:function(){return"ChannelSplitter"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const SN=wN;n.set("x_ite/Components/Sound/ChannelSplitter",SN);const TN=SN;function bN(t){XO.call(this,t),this.addType(c.Convolver)}bN.prototype=Object.assign(Object.create(XO.prototype),{constructor:bN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"buffer",new ji.MFFloat),new k(c.inputOutput,"normalize",new ji.SFBool),new k(c.inputOutput,"tailTime",new ji.SFTime),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Convolver"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const vN=bN;n.set("x_ite/Components/Sound/Convolver",vN);const EN=vN;function CN(t){XO.call(this,t),this.addType(c.Delay)}CN.prototype=Object.assign(Object.create(XO.prototype),{constructor:CN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"delayTime",new ji.SFTime),new k(c.inputOutput,"maxDelayTime",new ji.SFTime(1)),new k(c.inputOutput,"tailTime",new ji.SFTime),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Delay"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const ON=CN;n.set("x_ite/Components/Sound/Delay",ON);const NN=ON;function FN(t){XO.call(this,t),this.addType(c.DynamicsCompressor)}FN.prototype=Object.assign(Object.create(XO.prototype),{constructor:FN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"attack",new ji.SFFloat(.003)),new k(c.inputOutput,"knee",new ji.SFFloat(30)),new k(c.inputOutput,"ratio",new ji.SFFloat(12)),new k(c.inputOutput,"reduction",new ji.SFFloat),new k(c.inputOutput,"release",new ji.SFTime(.25)),new k(c.inputOutput,"threshold",new ji.SFFloat(-24)),new k(c.inputOutput,"tailTime",new ji.SFTime),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"DynamicsCompressor"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const IN=FN;n.set("x_ite/Components/Sound/DynamicsCompressor",IN);const MN=IN;function DN(t){XO.call(this,t),this.addType(c.Gain)}DN.prototype=Object.assign(Object.create(XO.prototype),{constructor:DN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"tailTime",new ji.SFTime),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Gain"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const RN=DN;n.set("x_ite/Components/Sound/Gain",RN);const VN=RN;function AN(t){HO.call(this,t),this.addType(c.ListenerPointSource),this.addChildObjects("loop",new ji.SFBool,"speed",new ji.SFFloat(1)),this._position.setUnit("length")}AN.prototype=Object.assign(Object.create(HO.prototype),{constructor:AN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"position",new ji.SFVec3f),new k(c.inputOutput,"orientation",new ji.SFRotation),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"dopplerEnabled",new ji.SFBool),new k(c.inputOutput,"interauralDistance",new ji.SFFloat),new k(c.inputOutput,"trackCurrentView",new ji.SFBool),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime)]),getTypeName:function(){return"ListenerPointSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const PN=AN;n.set("x_ite/Components/Sound/ListenerPointSource",PN);const LN=PN;function BN(t){HO.call(this,t),this.addType(c.MicrophoneSource),this.addChildObjects("loop",new ji.SFBool,"speed",new ji.SFFloat(1))}BN.prototype=Object.assign(Object.create(HO.prototype),{constructor:BN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"mediaDeviceID",new ji.SFString),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime)]),getTypeName:function(){return"MicrophoneSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const XN=BN;n.set("x_ite/Components/Sound/MicrophoneSource",XN);const UN=XN;function kN(t){HO.call(this,t),this.addType(c.OscillatorSource),this.addChildObjects("loop",new ji.SFBool,"speed",new ji.SFFloat(1))}kN.prototype=Object.assign(Object.create(HO.prototype),{constructor:kN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"detune",new ji.SFFloat),new k(c.inputOutput,"frequency",new ji.SFFloat),new k(c.inputOutput,"periodicWave",new ji.SFNode),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime)]),getTypeName:function(){return"OscillatorSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const zN=kN;n.set("x_ite/Components/Sound/OscillatorSource",zN);const jN=zN;function GN(t){QO.call(this,t),this.addType(c.PeriodicWave)}GN.prototype=Object.assign(Object.create(QO.prototype),{constructor:GN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"optionsReal",new ji.MFFloat),new k(c.inputOutput,"optionsImag",new ji.MFFloat),new k(c.inputOutput,"type",new ji.SFString("square"))]),getTypeName:function(){return"PeriodicWave"},getComponentName:function(){return"Sound"},getContainerField:function(){return"periodicWave"},getSpecificationRange:function(){return["4.0","Infinity"]}});const HN=GN;n.set("x_ite/Components/Sound/PeriodicWave",HN);const qN=HN;function YN(t){QO.call(this,t),this.addType(c.Sound),this.addChildObjects("traversed",new ji.SFBool(!0)),this._location.setUnit("length"),this._minBack.setUnit("length"),this._minFront.setUnit("length"),this._maxBack.setUnit("length"),this._maxFront.setUnit("length"),this.currentTraversed=!0}YN.prototype=Object.assign(Object.create(QO.prototype),{constructor:YN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.initializeOnly,"spatialize",new ji.SFBool(!0)),new k(c.inputOutput,"intensity",new ji.SFFloat(1)),new k(c.inputOutput,"location",new ji.SFVec3f),new k(c.inputOutput,"direction",new ji.SFVec3f(0,0,1)),new k(c.inputOutput,"minBack",new ji.SFFloat(1)),new k(c.inputOutput,"minFront",new ji.SFFloat(1)),new k(c.inputOutput,"maxBack",new ji.SFFloat(10)),new k(c.inputOutput,"maxFront",new ji.SFFloat(10)),new k(c.inputOutput,"priority",new ji.SFFloat),new k(c.inputOutput,"source",new ji.SFNode),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"Sound"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){QO.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this._source.addInterest("set_source__",this),this.set_live__(),this.set_source__()},setTraversed:function(t){t?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=t},getTraversed:function(){return this.currentTraversed},set_live__:function(){this.getLive().getValue()&&this._traversed.getValue()?this.getBrowser().sensorEvents().addInterest("update",this):this.getBrowser().sensorEvents().removeInterest("update",this)},set_source__:function(){this.sourceNode&&this.sourceNode.setVolume(0),this.sourceNode=rc(c.X3DSoundSourceNode,this._source)},update:function(){this.getTraversed()||this.sourceNode&&this.sourceNode.setVolume(0),this.setTraversed(!1)},traverse:function(){const t={distance:0,intersection:new Se(0,0,0)},e={distance:0,intersection:new Se(0,0,0)};return function(n,i){if(n!==ja.DISPLAY)return;if(!this.sourceNode)return;if(!this.sourceNode._isActive.getValue()||this.sourceNode._isPaused.getValue())return;this.setTraversed(!0);const o=i.getModelViewMatrix().get();if(this.getEllipsoidParameter(o,Math.max(this._maxBack.getValue(),0),Math.max(this._maxFront.getValue(),0),e),e.distance<1)if(this.getEllipsoidParameter(o,Math.max(this._minBack.getValue(),0),Math.max(this._minFront.getValue(),0),t),t.distance<1)this.sourceNode.setVolume(this._intensity.getValue());else{const n=e.intersection.magnitude(),i=e.intersection.distance(t.intersection),o=Math.min(n/i,1),r=d.clamp(this._intensity.getValue(),0,1)*o;this.sourceNode.setVolume(r)}else this.sourceNode.setVolume(0)}}(),getEllipsoidParameter:function(){const t=new Se(0,0,0),e=new dn,n=new dn,i=new an,o=new Se(1,1,1),r=new KE(1,Se.Zero),s=new Se(0,0,0),a=new eu(Se.Zero,Se.zAxis),u=new Se(0,0,0),c=new Se(0,0,0);return function(l,h,d,p){if(0==h||0==d)return e.multVecMatrix(p.intersection.assign(this._location.getValue())),void(p.distance=1);const f=(h+d)/2,g=f-h,m=Math.sqrt(f*f-g*g);t.set(0,0,g),o.set(m,m,f),i.setFromToVec(Se.zAxis,this._direction.getValue()),e.assign(l).translate(this._location.getValue()).rotate(i).translate(t).scale(o),n.assign(e).inverse();const _=n.origin;t.negate().divVec(o),s.assign(t).subtract(_).normalize(),a.set(_,s),r.intersectsLine(a,u,c),p.intersection.assign(e.multVecMatrix(u)),p.distance=_.magnitude()}}()});const WN=YN;n.set("x_ite/Components/Sound/Sound",WN);const KN=WN;function JN(t){QO.call(this,t),this.addType(c.SpatialSound),this._location.setUnit("length")}JN.prototype=Object.assign(Object.create(QO.prototype),{constructor:JN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.initializeOnly,"spatialize",new ji.SFBool(!0)),new k(c.inputOutput,"coneInnerAngle",new ji.SFFloat(6.2832)),new k(c.inputOutput,"coneOuterAngle",new ji.SFFloat(6.2832)),new k(c.inputOutput,"coneOuterGain",new ji.SFFloat(0)),new k(c.inputOutput,"direction",new ji.SFVec3f(0,0,1)),new k(c.inputOutput,"distanceModel",new ji.SFString("INVERSE")),new k(c.inputOutput,"dopplerEnabled",new ji.SFBool),new k(c.inputOutput,"enableHRTF",new ji.SFBool),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"intensity",new ji.SFFloat(1)),new k(c.inputOutput,"location",new ji.SFVec3f),new k(c.inputOutput,"maxDistance",new ji.SFFloat(1e4)),new k(c.inputOutput,"priority",new ji.SFFloat),new k(c.inputOutput,"referenceDistance",new ji.SFFloat(1)),new k(c.inputOutput,"rolloffFactor",new ji.SFFloat(1)),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"SpatialSound"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const ZN=JN;n.set("x_ite/Components/Sound/SpatialSound",ZN);const QN=ZN;function $N(t){eN.call(this,t),this.addType(c.StreamAudioDestination)}$N.prototype=Object.assign(Object.create(eN.prototype),{constructor:$N,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"streamIdentifier",new ji.MFString),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.outputOnly,"mediaDeviceID",new ji.SFString),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"StreamAudioDestination"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const tF=$N;n.set("x_ite/Components/Sound/StreamAudioDestination",tF);const eF=tF;function nF(t){HO.call(this,t),this.addType(c.StreamAudioSource),this.addChildObjects("loop",new ji.SFBool,"speed",new ji.SFFloat(1))}nF.prototype=Object.assign(Object.create(HO.prototype),{constructor:nF,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"streamIdentifier",new ji.MFString),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime)]),getTypeName:function(){return"StreamAudioSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const iF=nF;n.set("x_ite/Components/Sound/StreamAudioSource",iF);const oF=iF;function rF(t){XO.call(this,t),this.addType(c.WaveShaper)}rF.prototype=Object.assign(Object.create(XO.prototype),{constructor:rF,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"curve",new ji.MFFloat),new k(c.inputOutput,"oversample",new ji.SFString("none")),new k(c.inputOutput,"tailTime",new ji.SFTime),new k(c.outputOnly,"channelCount",new ji.SFInt32),new k(c.inputOutput,"channelCountMode",new ji.SFString("max")),new k(c.inputOutput,"channelInterpretation",new ji.SFString("speakers")),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.inputOutput,"children",new ji.MFNode)]),getTypeName:function(){return"WaveShaper"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},getSpecificationRange:function(){return["4.0","Infinity"]}});const sF=rF;n.set("x_ite/Components/Sound/WaveShaper",sF);const aF={Analyser:zO,AudioClip:KO,AudioDestination:oN,BiquadFilter:aN,BufferAudioSource:lN,ChannelMerger:mN,ChannelSelector:yN,ChannelSplitter:TN,Convolver:EN,Delay:NN,DynamicsCompressor:MN,Gain:VN,ListenerPointSource:LN,MicrophoneSource:UN,OscillatorSource:jN,PeriodicWave:qN,Sound:KN,SpatialSound:QN,StreamAudioDestination:eF,StreamAudioSource:oF,WaveShaper:sF},uF={X3DSoundChannelNode:pN,X3DSoundDestinationNode:eN,X3DSoundNode:QO,X3DSoundProcessingNode:XO,X3DSoundSourceNode:HO};for(const t in aF)Sr.addNodeType(t,aF[t]);for(const t in uF)Sr.addAbstractNodeType(t,uF[t]);const cF=void 0;n.set("x_ite/Components/Sound",cF);const lF=function(t,e){let n=0,i=!1;Object.defineProperties(t,{currentTime:{get:function(){return!i&&n<this.cycle?this.duration:e._elapsedTime%this.duration},set:Function.prototype},duration:{get:function(){return this.get_duration_ms()/1e3}},loop:{get:function(){return i},set:function(t){n=this.cycle,i=t}},cycle:{get:function(){return Math.floor(e._elapsedTime/this.duration)}},currentFrame:{get:function(){const t=this.get_length();return this.get_frames()[Math.max(Math.ceil(this.currentTime/this.duration*t)-1,0)]}},play:{value:function(){return n=this.cycle,Promise.resolve()}}})};n.set("x_ite/Browser/Texturing/GIFMedia",lF);const hF=lF;var dF=i(532),pF=i(558);function fF(t){dc.call(this,t),HO.call(this,t),es.call(this,t),this.addType(c.MovieTexture),this.video=dF("<video></video>"),this.urlStack=new ji.MFString}fF.prototype=Object.assign(Object.create(dc.prototype),HO.prototype,es.prototype,{constructor:fF,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"enabled",new ji.SFBool(!0)),new k(c.inputOutput,"load",new ji.SFBool(!0)),new k(c.inputOutput,"url",new ji.MFString),new k(c.inputOutput,"autoRefresh",new ji.SFTime),new k(c.inputOutput,"autoRefreshTimeLimit",new ji.SFTime(3600)),new k(c.inputOutput,"gain",new ji.SFFloat(1)),new k(c.inputOutput,"speed",new ji.SFFloat(1)),new k(c.inputOutput,"pitch",new ji.SFFloat(1)),new k(c.inputOutput,"loop",new ji.SFBool),new k(c.inputOutput,"startTime",new ji.SFTime),new k(c.inputOutput,"resumeTime",new ji.SFTime),new k(c.inputOutput,"pauseTime",new ji.SFTime),new k(c.inputOutput,"stopTime",new ji.SFTime),new k(c.outputOnly,"isPaused",new ji.SFBool),new k(c.outputOnly,"isActive",new ji.SFBool),new k(c.outputOnly,"elapsedTime",new ji.SFTime),new k(c.outputOnly,"duration_changed",new ji.SFTime(-1)),new k(c.initializeOnly,"repeatS",new ji.SFBool(!0)),new k(c.initializeOnly,"repeatT",new ji.SFBool(!0)),new k(c.initializeOnly,"textureProperties",new ji.SFNode)]),getTypeName:function(){return"MovieTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){dc.prototype.initialize.call(this),HO.prototype.initialize.call(this),es.prototype.initialize.call(this),this.video.on("abort error",this.setError.bind(this)),this.video.on("suspend stalled",this.setTimeout.bind(this)),this.video.prop("crossOrigin","Anonymous"),this.video.prop("preload","auto"),this.video.prop("muted",!0),this.requestImmediateLoad().catch(Function.prototype)},getElement:function(){return this.video[0]},set_live__:function(){HO.prototype.set_live__.call(this),es.prototype.set_live__.call(this)},unloadData:function(){this.clearTexture()},loadData:function(){delete this.gif,this.setMedia(null),this.urlStack.setValue(this._url),this.video.on("canplaythrough",this.setVideo.bind(this)),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.video.off("canplaythrough"),this._duration_changed=-1,this.clearTexture(),void this.setLoadState(c.FAILED_STATE);if(this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.URL.pathname.endsWith(".gif")){const t=dF("<img></img>").appendTo(dF("<div></div>")),e=new pF({gif:t[0],on_error:t=>this.setError({type:t})});e.load_url(this.URL,this.setGif.bind(this,e)),this.setTimeout({type:"timeout"})}else this.video.attr("src",this.URL.href),this.video.get(0).load()},setTimeout:function(t){setTimeout((()=>{this.checkLoadState()===c.IN_PROGRESS_STATE&&this.setError(t)}),3e3)},setError:function(t){"data:"!==this.URL.protocol&&console.warn(`Error loading movie '${decodeURI(this.URL.href)}'`,t.type),this.loadNext()},setVideo:function(){try{this.video.unbind("canplaythrough");const t=this.video[0],e=t.videoWidth,n=t.videoHeight;if(!d.isPowerOfTwo(e)||!d.isPowerOfTwo(n))throw new Error("The movie texture is a non power-of-two texture.");this.setMedia(this.video[0]),this.setTexture(e,n,!1,t,!0),this.setLoadState(c.COMPLETE_STATE)}catch(t){this.setError({type:t.message})}},setGif:function(t){try{this.gif=t,hF(t,this),t.pause(),this.setMedia(t),this.setTexture(t.get_canvas().width,t.get_canvas().height,!1,t.get_frames()[0].data,!0),this.setLoadState(c.COMPLETE_STATE)}catch(t){this.setError({type:t.message})}},set_time:function(){HO.prototype.set_time.call(this),this.checkLoadState()===c.COMPLETE_STATE&&(this.gif?this.updateTexture(this.gif.currentFrame.data,!0):this.updateTexture(this.video[0],!0))},traverse:dc.prototype.traverse,dispose:function(){es.prototype.dispose.call(this),HO.prototype.dispose.call(this),dc.prototype.dispose.call(this)}});const gF=fF;n.set("x_ite/Components/Texturing/MovieTexture",gF);const mF=gF;function _F(t){ic.call(this,t),this.addType(c.MultiTexture),this.addChildObjects("loadState",new ji.SFInt32(c.NOT_STARTED_STATE));const e=this.getBrowser();this.maxTextures=e.getMaxTextures(),this.color=new Float32Array(4),this.modes=[],this.alphaModes=[],this.sources=[],this.functions=[],this.textureNodes=[]}_F.prototype=Object.assign(Object.create(ic.prototype),{constructor:_F,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"color",new ji.SFColor(1,1,1)),new k(c.inputOutput,"alpha",new ji.SFFloat(1)),new k(c.inputOutput,"mode",new ji.MFString),new k(c.inputOutput,"source",new ji.MFString),new k(c.inputOutput,"function",new ji.MFString),new k(c.inputOutput,"texture",new ji.MFNode)]),getTypeName:function(){return"MultiTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){ic.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this._alpha.addInterest("set_alpha__",this),this._mode.addInterest("set_mode__",this),this._source.addInterest("set_source__",this),this._function.addInterest("set_function__",this),this._texture.addInterest("set_texture__",this),this.set_color__(),this.set_alpha__(),this.set_mode__(),this.set_source__(),this.set_function__(),this.set_texture__(),this._loadState=c.COMPLETE_STATE},getCount:function(){return Math.min(this.maxTextures,this.textureNodes.length)},getMode:function(t){return t<this.modes.length?this.modes[t]:Nx.MODULATE},getAlphaMode:function(t){return t<this.alphaModes.length?this.alphaModes[t]:Nx.MODULATE},getSource:function(t){return t<this.sources.length?this.sources[t]:Mx.DEFAULT},getFunction:function(t){return t<this.functions.length?this.functions[t]:Vx.DEFAULT},set_color__:function(){this.color[0]=this._color.r,this.color[1]=this._color.g,this.color[2]=this._color.b},set_alpha__:function(){this.color[3]=this._alpha},set_mode__:function(){const t=new Map([["REPLACE",Nx.REPLACE],["MODULATE",Nx.MODULATE],["MODULATE2X",Nx.MODULATE2X],["MODULATE4X",Nx.MODULATE4X],["ADD",Nx.ADD],["ADDSIGNED",Nx.ADDSIGNED],["ADDSIGNED2X",Nx.ADDSIGNED2X],["ADDSMOOTH",Nx.ADDSMOOTH],["SUBTRACT",Nx.SUBTRACT],["BLENDDIFFUSEALPHA",Nx.BLENDDIFFUSEALPHA],["BLENDTEXTUREALPHA",Nx.BLENDTEXTUREALPHA],["BLENDFACTORALPHA",Nx.BLENDFACTORALPHA],["BLENDCURRENTALPHA",Nx.BLENDCURRENTALPHA],["MODULATEALPHA_ADDCOLOR",Nx.MODULATEALPHA_ADDCOLOR],["MODULATEINVALPHA_ADDCOLOR",Nx.MODULATEINVALPHA_ADDCOLOR],["MODULATEINVCOLOR_ADDALPHA",Nx.MODULATEINVCOLOR_ADDALPHA],["DOTPRODUCT3",Nx.DOTPRODUCT3],["SELECTARG1",Nx.SELECTARG1],["SELECTARG2",Nx.SELECTARG2],["OFF",Nx.OFF]]);return function(){this.modes.length=0,this.alphaModes.length=0;for(const e of this._mode){const n=e.split(",");for(let t=0,e=n.length;t<e;++t)n[t]=n[t].trim();0===n.length&&n.push("MODULATE"),n.length<2&&n.push(n[0]);const i=t.get(n[0]);void 0!==i?this.modes.push(i):this.modes.push(Nx.MODULATE);const o=t.get(n[1]);void 0!==o?this.alphaModes.push(o):this.alphaModes.push(Nx.MODULATE)}}}(),set_source__:function(){const t=new Map([["DIFFUSE",Mx.DIFFUSE],["SPECULAR",Mx.SPECULAR],["FACTOR",Mx.FACTOR]]);return function(){this.sources.length=0;for(const e of this._source){const n=t.get(e);void 0!==n?this.sources.push(n):this.sources.push(Mx.DEFAULT)}}}(),set_function__:function(){const t=new Map([["COMPLEMENT",Vx.COMPLEMENT],["ALPHAREPLICATE",Vx.ALPHAREPLICATE]]);return function(){this.functions.length=0;for(const e of this._function){const n=t.get(e);void 0!==n?this.functions.push(n):this.functions.push(Vx.DEFAULT)}}}(),set_texture__:function(){this.textureNodes.length=0;for(const t of this._texture){const e=rc(c.X3DSingleTextureNode,t);e&&this.textureNodes.push(e)}},updateTextureBits:function(t){const e=this.maxTextures,n=this.textureNodes,i=Math.min(e,n.length);for(let e=0;e<i;++e)n[e].updateTextureBits(t,e);t.set(2*e,1)},getShaderOptions:function(t){const e=this.textureNodes,n=Math.min(this.maxTextures,e.length);for(let i=0;i<n;++i)e[i].getShaderOptions(t,i)},traverse:function(t,e){for(const n of this.textureNodes)n.traverse(t,e)},setShaderUniforms:function(t,e,n){const i=this.textureNodes,o=Math.min(this.maxTextures,i.length);t.uniform4fv(e.x3d_MultiTextureColor,this.color);for(let r=0;r<o;++r)i[r].setShaderUniforms(t,e,n,e.x3d_Texture[r]),t.uniform1i(e.x3d_MultiTextureMode[r],this.getMode(r)),t.uniform1i(e.x3d_MultiTextureAlphaMode[r],this.getAlphaMode(r)),t.uniform1i(e.x3d_MultiTextureSource[r],this.getSource(r)),t.uniform1i(e.x3d_MultiTextureFunction[r],this.getFunction(r))}});const xF=_F;n.set("x_ite/Components/Texturing/MultiTexture",xF);const yF=xF;function wF(t){Xd.call(this,t),this.addType(c.MultiTextureCoordinate);const e=this.getBrowser();this.maxTexCoords=e.getMaxTexCoords(),this.textureCoordinateNodes=[]}wF.prototype=Object.assign(Object.create(Xd.prototype),{constructor:wF,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"texCoord",new ji.MFNode)]),getTypeName:function(){return"MultiTextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){Xd.prototype.initialize.call(this),this._texCoord.addInterest("set_texCoord__",this),this.set_texCoord__()},set_texCoord__:function(){const t=this.textureCoordinateNodes;for(const e of t)e.removeInterest("addNodeEvent",this);t.length=0;for(const e of this._texCoord){const n=rc(c.X3DSingleTextureCoordinateNode,e);n&&t.push(n)}for(const e of t)e.addInterest("addNodeEvent",this)},getCount:function(){return Math.min(this.maxTexCoords,this.textureCoordinateNodes.length)},isEmpty:function(){return!0},getSize:function(){return 0},get1Point:function(t,e){for(const n of this.textureCoordinateNodes)return n.get1Point(t,e);return e.set(0,0,0,1)},getPoints:function(t){for(const e of this.textureCoordinateNodes)return e.getPoints(t);return t},init:function(t){const e=this.textureCoordinateNodes,n=Math.min(this.maxTexCoords,e.length);for(let i=0;i<n;++i)e[i].init(t)},addPoint:function(t,e){const n=this.textureCoordinateNodes,i=Math.min(this.maxTexCoords,n.length);for(let o=0;o<i;++o)n[o].addPointToChannel(t,e[o])},getTextureCoordinateMapping:function(t){const e=this.textureCoordinateNodes,n=Math.min(this.maxTexCoords,e.length);for(let i=0;i<n;++i)e[i].getTextureCoordinateMapping(t,i)},setShaderUniforms:function(t,e){const n=this.textureCoordinateNodes,i=Math.min(this.maxTexCoords,n.length);if(i)for(let o=0;o<i;++o)n[o].setShaderUniforms(t,e,o);else this.getBrowser().getDefaultTextureCoordinate().setShaderUniforms(t,e,0)}});const SF=wF;n.set("x_ite/Components/Texturing/MultiTextureCoordinate",SF);const TF=SF;function bF(t){Xy.call(this,t),this.addType(c.MultiTextureTransform);const e=this.getBrowser();this.maxTextureTransforms=e.getMaxTextureTransforms(),this.textureTransformNodes=[]}bF.prototype=Object.assign(Object.create(Xy.prototype),{constructor:bF,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"textureTransform",new ji.MFNode)]),getTypeName:function(){return"MultiTextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){Xy.prototype.initialize.call(this),this._textureTransform.addInterest("set_textureTransform__",this),this.set_textureTransform__()},set_textureTransform__:function(){const t=this.textureTransformNodes;t.length=0;for(const e of this._textureTransform){const n=rc(c.X3DSingleTextureTransformNode,e);n&&t.push(n)}t.length||t.push(this.getBrowser().getDefaultTextureTransform())},getCount:function(){return Math.min(this.maxTextureTransforms,this.textureTransformNodes.length)},getTextureTransformMapping:function(t){const e=this.textureTransformNodes,n=Math.min(this.maxTextureTransforms,e.length);for(let i=0;i<n;++i)e[i].getTextureTransformMapping(t,i)},setShaderUniforms:function(t,e){const n=this.textureTransformNodes,i=Math.min(this.maxTextureTransforms,n.length);for(let o=0;o<i;++o)n[o].setShaderUniforms(t,e,o)},transformPoint:function(t){return this.textureTransformNodes[0].transformPoint(t)}});const vF=bF;n.set("x_ite/Components/Texturing/MultiTextureTransform",vF);const EF=vF;var CF=i(532);function OF(t){dc.call(this,t),this.addType(c.PixelTexture),this.addChildObjects("loadState",new ji.SFInt32(c.NOT_STARTED_STATE))}OF.prototype=Object.assign(Object.create(dc.prototype),{constructor:OF,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"description",new ji.SFString),new k(c.inputOutput,"image",new ji.SFImage(0,0,0,new ji.MFInt32)),new k(c.initializeOnly,"repeatS",new ji.SFBool(!0)),new k(c.initializeOnly,"repeatT",new ji.SFBool(!0)),new k(c.initializeOnly,"textureProperties",new ji.SFNode)]),getTypeName:function(){return"PixelTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},getSpecificationRange:function(){return["2.0","Infinity"]},initialize:function(){dc.prototype.initialize.call(this),this._image.addInterest("set_image__",this),this.canvas1=CF("<canvas></canvas>"),this.canvas2=CF("<canvas></canvas>"),this.set_image__()},checkLoadState:function(){return this._loadState.getValue()},convert:function(t,e,n,i){switch(e){case 1:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=t[o+1]=t[o+2]=255&i,t[o+3]=255}break;case 2:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=t[o+1]=t[o+2]=i>>>8&255,t[o+3]=255&i}break;case 3:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=i>>>16&255,t[o+1]=i>>>8&255,t[o+2]=255&i,t[o+3]=255}break;case 4:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=i>>>24,t[o+1]=i>>>16&255,t[o+2]=i>>>8&255,t[o+3]=255&i}}},resize:function(t,e,n,i,o){const r=new Uint8Array(i*o*4),s=i/e,a=o/n;for(let n=0;n<o;++n){const o=Math.floor(n/a)*e,u=n*i;for(let e=0;e<i;++e){const n=4*(o+Math.floor(e/s)),i=4*(u+e);r[i]=t[n],r[i+1]=t[n+1],r[i+2]=t[n+2],r[i+3]=t[n+3]}}return r},set_image__:function(){const t=this.getBrowser().getContext(),e=this._image.comp,n=this._image.array,i=!(e%2);let o=this._image.width,r=this._image.height,s=null;if(o>0&&r>0&&e>0&&e<5){if(t.getVersion()>=2||d.isPowerOfTwo(o)&&d.isPowerOfTwo(r))s=new Uint8Array(o*r*4),this.convert(s,e,n.getValue(),n.length);else if(Math.max(o,r)<this.getBrowser().getMinTextureSize()&&!this._textureProperties.getValue()){s=new Uint8Array(o*r*4),this.convert(s,e,n.getValue(),n.length);const t=o,i=r;o=8*d.nextPowerOfTwo(t),r=8*d.nextPowerOfTwo(i),s=this.resize(s,t,i,o,r)}else{const t=this.canvas1[0],i=this.canvas2[0],a=t.getContext("2d",{willReadFrequently:!0}),u=i.getContext("2d",{willReadFrequently:!0}),c=a.createImageData(o,r);t.width=o,t.height=r,this.convert(c.data,e,n,n.length),a.putImageData(c,0,0),o=d.nextPowerOfTwo(o),r=d.nextPowerOfTwo(r),i.width=o,i.height=r,u.clearRect(0,0,o,r),u.drawImage(t,0,0,t.width,t.height,0,0,o,r),s=u.getImageData(0,0,o,r).data}this.setTexture(o,r,i,new Uint8Array(s.buffer),!1),this._loadState=c.COMPLETE_STATE}else this.clearTexture(),this._loadState=c.FAILED_STATE}});const NF=OF;n.set("x_ite/Components/Texturing/PixelTexture",NF);const FF=NF;function IF(t){zd.call(this,t),this.addType(c.TextureCoordinateGenerator),this.mode=Lx.SPHERE,this.parameter=new Float32Array(6)}IF.prototype=Object.assign(Object.create(zd.prototype),{constructor:IF,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new J([new k(c.inputOutput,"metadata",new ji.SFNode),new k(c.inputOutput,"mapping",new ji.SFString),new k(c.inputOutput,"mode",new ji.SFString("SPHERE")),new k(c.inputOutput,"parameter",new ji.MFFloat)]),getTypeName:function(){return"TextureCoordinateGenerator"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},getSpecificationRange:function(){return["3.0","Infinity"]},initialize:function(){zd.prototype.initialize.call(this),this._mode.addInterest("set_mode__",this),this._parameter.addInterest("set_parameter__",this),this.set_mode__(),this.set_parameter__()},set_mode__:function(){const t=new Map([["SPHERE",Lx.SPHERE],["CAMERASPACENORMAL",Lx.CAMERASPACENORMAL],["CAMERASPACEPOSITION",Lx.CAMERASPACEPOSITION],["CAMERASPACEREFLECTIONVECTOR",Lx.CAMERASPACEREFLECTIONVECTOR],["SPHERE-LOCAL",Lx.SPHERE_LOCAL],["COORD",Lx.COORD],["COORD-EYE",Lx.COORD_EYE],["NOISE",Lx.NOISE],["NOISE-EYE",Lx.NOISE_EYE],["SPHERE-REFLECT",Lx.SPHERE_REFLECT],["SPHERE-REFLECT-LOCAL",Lx.SPHERE_REFLECT_LOCAL]]);return function(){this.mode=t.get(this._mode.getValue()),void 0===this.mode&&(this.mode=Lx.SPHERE)}}(),set_parameter__:function(){const t=Math.min(this.parameter.length,this._parameter.length);for(let e=0;e<t;++e)this.parameter[e]=this._parameter[e];this.parameter.fill(0,t)},get1Point:function(t,e){return e},getPoints:function(t){return t},addPointToChannel:function(t,e){e.push(0,0,0,1)},setShaderUniforms:function(t,e,n=0){t.uniform1i(e.x3d_TextureCoordinateGeneratorMode[n],this.mode),t.uniform1fv(e.x3d_TextureCoordinateGeneratorParameter[n],this.parameter)}});const MF=IF;n.set("x_ite/Components/Texturing/TextureCoordinateGenerator",MF);const DF={ImageTexture:mc,MovieTexture:mF,MultiTexture:yF,MultiTextureCoordinate:TF,MultiTextureTransform:EF,PixelTexture:FF,TextureCoordinate:Hd,TextureCoordinateGenerator:MF,TextureProperties:_d,TextureTransform:Hy},RF={X3DSingleTextureCoordinateNode:zd,X3DSingleTextureNode:uc,X3DSingleTextureTransformNode:zy,X3DTexture2DNode:dc,X3DTextureCoordinateNode:Xd,X3DTextureNode:ic,X3DTextureTransformNode:Xy};for(const t in DF)Sr.addNodeType(t,DF[t]);for(const t in RF)Sr.addAbstractNodeType(t,RF[t]);const VF=void 0;n.set("x_ite/Components/Texturing",VF);const AF={TimeSensor:Mc},PF={X3DTimeDependentNode:Nc};for(const t in AF)Sr.addNodeType(t,AF[t]);for(const t in PF)Sr.addAbstractNodeType(t,PF[t]);const LF=void 0;n.set("x_ite/Components/Time",LF);const BF=class{static addComponent({name:t,types:e,abstractTypes:n,browserContext:i}){if(e)for(const[t,n]of Object.entries(e))Sr.addNodeType(t,n);if(n)for(const[t,e]of Object.entries(n))Sr.addAbstractNodeType(t,e);i&&Xw.addBrowserContext(i)}};n.set("x_ite/Components",BF);var XF=i(532);const UF=class{constructor(t){this.browser=t,this.rootElement=void 0,this.canvasObserver=new MutationObserver((()=>this.processCanvasMutation(t))),this.canvasObserver.observe(t.getElement()[0],{childList:!0}),this.processCanvasMutation(t)}processCanvasMutation(t){this.processRootElement(t,t.getElement().children("X3D").get(-1))}async processRootElement(t,e){try{if(e===this.rootElement)return;if(this.rootElement=e,e){t.setBrowserLoading(!0),t.addLoadingObject(this);const n=t.createScene();this.parser=new ys(n),this.parser.setInput(e),await new Promise(this.parser.parseIntoScene.bind(this.parser)),t.replaceWorld(n),this.observer=new MutationObserver((t=>{for(const e of t)this.processMutation(e)})),this.observer.observe(e,{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeOldValue:!0}),this.processInlineElements(e),this.addEventDispatchersAll(e),t.removeLoadingObject(this)}else t.replaceWorld(null)}catch(t){console.error("Error importing document:",t)}}processMutation(t){switch(t.type){case"attributes":this.processAttribute(t,t.target);break;case"childList":for(const e of t.addedNodes)this.processAddedNode(e);for(const e of t.removedNodes)this.processRemovedNode(e)}}processAttribute(t,e){const n=this.parser;if(XF.data(e,"node")){const i=t.attributeName,o=e.attributes.getNamedItem(i);n.nodeAttribute(o,XF.data(e,"node"))}else{const t=e.parentNode,i=XF.data(t,"node");n.pushExecutionContext(i.getExecutionContext()),n.pushParent(i),n.childElement(e),n.popParent(),n.popExecutionContext()}}processAddedNode(t){if(t.nodeType!==Node.ELEMENT_NODE)return;if("X3D"===t.nodeName)return;if(XF.data(t,"node"))return;const e=t.parentNode,n=this.parser;if(e.nodeName.match(/^(?:Scene|SCENE)$/)){const i=XF.data(e,"node");n.pushExecutionContext(i),n.childElement(t),n.popExecutionContext()}else if(XF.data(e,"node")){const i=XF.data(e,"node"),o=i.getExecutionContext();n.pushExecutionContext(o),n.pushParent(i),n.childElement(t),n.popParent(),n.popExecutionContext()}else{const e=this.browser.currentScene;n.pushExecutionContext(e),n.childElement(t),n.popExecutionContext()}this.processInlineElements(t),this.addEventDispatchers(t),this.addEventDispatchersAll(t)}processRemovedNode(t){const e=XF.data(t,"node");e&&(e.dispose(),XF.data(t,"node",null))}processInlineElements(t){t.nodeName.match(/^(?:Inline|INLINE)$/)&&this.processInlineElement(t);for(const e of t.querySelectorAll("Inline"))this.processInlineElement(e)}processInlineElement(t){const e=XF.data(t,"node");e&&(e._loadState.addInterest("appendInlineChildElement",this,t),this.appendInlineChildElement(t))}appendInlineChildElement(t){const e=XF.data(t,"node");switch(e.checkLoadState()){case c.NOT_STARTED_STATE:case c.FAILED_STATE:for(;t.firstChild;)t.removeChild(t.lastChild);break;case c.COMPLETE_STATE:{for(;t.firstChild;)t.removeChild(t.lastChild);const n=XF.data(e.getInternalScene(),"X3D");n&&t.appendChild(n),this.processInlineElements(n),this.addEventDispatchersAll(n);break}}switch(e.checkLoadState()){case c.COMPLETE_STATE:{const n=new CustomEvent("load",{detail:{node:wn.get(e)}});t.dispatchEvent(n);break}case c.FAILED_STATE:{const n=new CustomEvent("error",{detail:{node:wn.get(e)}});t.dispatchEvent(n);break}}}addEventDispatchersAll(t){const e=t.querySelectorAll("*");for(const t of e)this.addEventDispatchers(t)}addEventDispatchers(t){if("ROUTE"===t.nodeName)return;const e=XF.data(t,"node");if(e)for(const n of e.getFields())this.bindFieldCallback(n,t)}bindFieldCallback(t,e){t.isOutput()&&(t.addInterest("fieldCallback",this,e),this.trace&&t.addInterest("fieldTraceCallback",this,e))}fieldCallback(t,e){const n=XF.data(t,"node");if(!n)return;const i=new CustomEvent(e.getName(),{detail:{node:wn.get(n),value:e.valueOf()}});t.dispatchEvent(i)}fieldTraceCallback(t,e){const n=Date.now(),i=r.getBrowser().getCurrentTime(),o=n-1e3*i,r=XF.data(t,"node");console.log("%f: at %f dt of %s ms %s '%s' %s: %s",n,i,o.toFixed(3),r.getTypeName(),r.getName(),e.getName(),e.valueOf())}};n.set("x_ite/Browser/DOMIntegration",UF);const kF=UF;const zF=function(){const t=this.getElement();"X3DCANVAS"===t.prop("nodeName").toUpperCase()&&(t.attr("src")?this.attributeChangedCallback("src",void 0,t.attr("src")):t.attr("url")&&this.attributeChangedCallback("url",void 0,t.attr("url")),t.attr("tabindex",t.attr("tabindex")??0))};n.set("x_ite/Browser/Legacy",zF);const jF=zF;function GF(t,e,n,i){Object.defineProperties(this,{name:{value:t,enumerable:!0},title:{value:e,enumerable:!0},providerUrl:{value:n,enumerable:!0},components:{value:i,enumerable:!0}})}GF.prototype=Object.assign(Object.create(E.prototype),{constructor:GF,getTypeName:function(){return"ProfileInfo"},toVRMLStream:function(t){t.string+=t.Indent(),t.string+="PROFILE",t.string+=t.Space(),t.string+=this.name},toXMLStream:function(t){t.string+=this.name},toJSONStream:function(t){t.string+=this.name}});for(const t of Reflect.ownKeys(GF.prototype))Object.defineProperty(GF.prototype,t,{enumerable:!1});const HF=GF;n.set("x_ite/Configuration/ProfileInfo",HF);const qF=HF;function YF(t){return Y.call(this,t,Y)}YF.prototype=Object.assign(Object.create(Y.prototype),{constructor:YF,getTypeName:function(){return"ProfileInfoArray"},addProfile:function(t){this.add(t.name,new qF(t.name,t.title,t.providerUrl,new ch(t.components)))}});for(const t of Reflect.ownKeys(YF.prototype))Object.defineProperty(YF.prototype,t,{enumerable:!1});const WF=YF;n.set("x_ite/Configuration/ProfileInfoArray",WF);const KF=WF,JF=new ch([]);JF.addComponent({title:"Annotation",name:"Annotation",level:2,external:!0}),JF.addComponent({title:"CAD geometry",name:"CADGeometry",level:2,external:!0}),JF.addComponent({title:"Core",name:"Core",level:2}),JF.addComponent({title:"Cube map environmental texturing",name:"CubeMapTexturing",level:3,external:!0}),JF.addComponent({title:"Distributed interactive simulation",name:"DIS",level:2,external:!0}),JF.addComponent({title:"Environmental effects",name:"EnvironmentalEffects",level:4}),JF.addComponent({title:"Environmental sensor",name:"EnvironmentalSensor",level:3}),JF.addComponent({title:"Event utilities",name:"EventUtilities",level:1,external:!0}),JF.addComponent({title:"Followers",name:"Followers",level:1}),JF.addComponent({title:"Geometry2D",name:"Geometry2D",level:2,external:!0}),JF.addComponent({title:"Geometry3D",name:"Geometry3D",level:4}),JF.addComponent({title:"Geospatial",name:"Geospatial",level:2,external:!0}),JF.addComponent({title:"Grouping",name:"Grouping",level:3}),JF.addComponent({title:"Humanoid animation (HAnim)",name:"HAnim",level:3,external:!0}),JF.addAlias("H-Anim","HAnim"),JF.addComponent({title:"Interpolation",name:"Interpolation",level:5}),JF.addComponent({title:"Key device sensor",name:"KeyDeviceSensor",level:2,external:!0}),JF.addComponent({title:"Layering",name:"Layering",level:1}),JF.addComponent({title:"Layout",name:"Layout",level:2,external:!0,dependencies:["Text"]}),JF.addComponent({title:"Lighting",name:"Lighting",level:3}),JF.addComponent({title:"Navigation",name:"Navigation",level:3}),JF.addComponent({title:"Networking",name:"Networking",level:4}),JF.addComponent({title:"NURBS",name:"NURBS",level:4,external:!0}),JF.addComponent({title:"Particle systems",name:"ParticleSystems",level:3,external:!0}),JF.addComponent({title:"Picking",name:"Picking",level:3,external:!0,dependencies:["RigidBodyPhysics"]}),JF.addComponent({title:"Pointing device sensor",name:"PointingDeviceSensor",level:1}),JF.addComponent({title:"Programmable shaders",name:"Shaders",level:1}),JF.addComponent({title:"Texture Projector",name:"TextureProjector",level:2,external:!0}),JF.addAlias("ProjectiveTextureMapping","TextureProjector"),JF.addComponent({title:"Rendering",name:"Rendering",level:5}),JF.addComponent({title:"Rigid body physics",name:"RigidBodyPhysics",level:2,external:!0}),JF.addComponent({title:"Scripting",name:"Scripting",level:1,external:!0}),JF.addComponent({title:"Shape",name:"Shape",level:4}),JF.addComponent({title:"Sound",name:"Sound",level:3}),JF.addComponent({title:"Text",name:"Text",level:1,external:!0}),JF.addComponent({title:"Texturing",name:"Texturing",level:4}),JF.addComponent({title:"Texturing3D",name:"Texturing3D",level:2,external:!0}),JF.addComponent({title:"Time",name:"Time",level:2}),JF.addComponent({title:"Volume rendering",name:"VolumeRendering",level:4,external:!0,dependencies:["CADGeometry","Texturing3D"]}),JF.addComponent({title:"X_ITE",name:"X_ITE",level:1,external:!0});const ZF=JF;n.set("x_ite/Configuration/SupportedComponents",ZF);const QF=ZF,$F=new KF;$F.addProfile({title:"Computer-Aided Design (CAD) interchange",name:"CADInterchange",providerUrl:cr.getProviderUrl(),components:[QF.get("CADGeometry"),QF.get("Core"),QF.get("Grouping"),QF.get("Lighting"),QF.get("Navigation"),QF.get("Networking"),QF.get("Rendering"),QF.get("Shaders"),QF.get("Shape"),QF.get("Texturing")]}),$F.addProfile({title:"Core",name:"Core",providerUrl:cr.getProviderUrl(),components:[QF.get("Core")]}),$F.addProfile({title:"Full",name:"Full",providerUrl:cr.getProviderUrl(),components:[QF.get("CADGeometry"),QF.get("Core"),QF.get("CubeMapTexturing"),QF.get("DIS"),QF.get("EnvironmentalEffects"),QF.get("EnvironmentalSensor"),QF.get("EventUtilities"),QF.get("Followers"),QF.get("Geometry2D"),QF.get("Geometry3D"),QF.get("Geospatial"),QF.get("Grouping"),QF.get("HAnim"),QF.get("Interpolation"),QF.get("KeyDeviceSensor"),QF.get("Layering"),QF.get("Layout"),QF.get("Lighting"),QF.get("Navigation"),QF.get("Networking"),QF.get("NURBS"),QF.get("ParticleSystems"),QF.get("Picking"),QF.get("PointingDeviceSensor"),QF.get("TextureProjector"),QF.get("Rendering"),QF.get("RigidBodyPhysics"),QF.get("Scripting"),QF.get("Shaders"),QF.get("Shape"),QF.get("Sound"),QF.get("Text"),QF.get("Texturing"),QF.get("Texturing3D"),QF.get("Time"),QF.get("VolumeRendering")]}),$F.addProfile({title:"Immersive",name:"Immersive",providerUrl:cr.getProviderUrl(),components:[QF.get("Core"),QF.get("EnvironmentalEffects"),QF.get("EnvironmentalSensor"),QF.get("EventUtilities"),QF.get("Geometry2D"),QF.get("Geometry3D"),QF.get("Grouping"),QF.get("Interpolation"),QF.get("KeyDeviceSensor"),QF.get("Lighting"),QF.get("Navigation"),QF.get("Networking"),QF.get("PointingDeviceSensor"),QF.get("Rendering"),QF.get("Scripting"),QF.get("Shape"),QF.get("Sound"),QF.get("Text"),QF.get("Texturing"),QF.get("Time")]}),$F.addProfile({title:"Interactive",name:"Interactive",providerUrl:cr.getProviderUrl(),components:[QF.get("Core"),QF.get("EnvironmentalEffects"),QF.get("EnvironmentalSensor"),QF.get("EventUtilities"),QF.get("Geometry3D"),QF.get("Grouping"),QF.get("Interpolation"),QF.get("KeyDeviceSensor"),QF.get("Lighting"),QF.get("Navigation"),QF.get("Networking"),QF.get("PointingDeviceSensor"),QF.get("Rendering"),QF.get("Shape"),QF.get("Texturing"),QF.get("Time")]}),$F.addProfile({title:"Interchange",name:"Interchange",providerUrl:cr.getProviderUrl(),components:[QF.get("Core"),QF.get("EnvironmentalEffects"),QF.get("Geometry3D"),QF.get("Grouping"),QF.get("Interpolation"),QF.get("Lighting"),QF.get("Navigation"),QF.get("Networking"),QF.get("Rendering"),QF.get("Shape"),QF.get("Texturing"),QF.get("Time")]}),$F.addProfile({title:"Medical interchange",name:"MedicalInterchange",providerUrl:cr.getProviderUrl(),components:[QF.get("Core"),QF.get("EnvironmentalEffects"),QF.get("EventUtilities"),QF.get("Geometry2D"),QF.get("Geometry3D"),QF.get("Grouping"),QF.get("Interpolation"),QF.get("Lighting"),QF.get("Navigation"),QF.get("Networking"),QF.get("Rendering"),QF.get("Shape"),QF.get("Text"),QF.get("Texturing"),QF.get("Texturing3D"),QF.get("Time"),QF.get("VolumeRendering")]}),$F.addProfile({title:"MPEG-4 interactive",name:"MPEG-4",providerUrl:cr.getProviderUrl(),components:[QF.get("Core"),QF.get("EnvironmentalEffects"),QF.get("EnvironmentalSensor"),QF.get("Geometry3D"),QF.get("Grouping"),QF.get("Interpolation"),QF.get("Lighting"),QF.get("Navigation"),QF.get("Networking"),QF.get("PointingDeviceSensor"),QF.get("Rendering"),QF.get("Shape"),QF.get("Texturing"),QF.get("Time")]});const tI=$F;n.set("x_ite/Configuration/SupportedProfiles",tI);const eI=tI;var nI=i(532);const iI=Symbol(),oI=Symbol(),rI=Symbol(),sI=Symbol(),aI=Symbol(),uI=Symbol.for("X_ITE.X3DRoutingContext.processEvents");function cI(t){if((t=nI(t)).prop("browser"))throw new Error("Couldn't create browser, element has already a browser.");Xw.call(this,t),this[sI]=new Map,this[aI]=document.getElementsByClassName("x_ite-console"),this.setup()}cI.prototype=Object.assign(Object.create(Xw.prototype),{constructor:cI,getTypeName:function(){return"X3DBrowser"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browser"},initialize:function(){Xw.prototype.initialize.call(this),this.replaceWorld(this.createScene()).catch(Function.prototype),this[iI]=new kF(this),jF.call(this),this[uI].call(this),this.getInstanceId()>1||this.getBrowserOption("Debug")&&this.printWelcomeMessage()},printWelcomeMessage:function(){this.print("Welcome to "+this.name+" X3D Browser v"+this.version+":\n   Current Graphics Renderer\n      Name: "+this.getVendor()+" "+this.getRenderer()+"\n      WebGL version: "+this.getWebGLVersion()+"\n      Shading language: "+this.getShadingLanguageVersion()+"\n   Rendering Properties\n      Antialiased: "+this.getAntialiased()+"\n      Max samples: "+this.getMaxSamples()+"\n      Depth size: "+this.getDepthSize()+" bits\n      Color depth: "+this.getColorDepth()+" bits\n      Max clip planes per shape: "+this.getMaxClipPlanes()+"\n      Max lights per shape: "+this.getMaxLights()+"\n      Max multi textures per shape: "+this.getMaxTextures()+"\n      Texture units: "+this.getMaxCombinedTextureUnits()+"\n      Max texture size: "+this.getMaxTextureSize()+" × "+this.getMaxTextureSize()+" pixels\n      Texture memory: "+this.getTextureMemory()+"\n      Max vertex uniform vectors: "+this.getMaxVertexUniformVectors()+"\n      Max fragment uniform vectors: "+this.getMaxFragmentUniformVectors()+"\n      Max vertex attribs: "+this.getMaxVertexAttribs()+"\n      Max varying vectors: "+this.getMaxVaryingVectors()+"\n")},getName:function(){return"X_ITE"},getVersion:function(){return lo},getDescription:function(){return this.getNotification()._string.getValue()},setDescription:function(t){this.getNotification()._string=t},getWorldURL:function(){return this.currentScene.worldURL},getProfile:function(t){t=String(t);const e=eI.get(t);if(e)return e;throw Error("Profile '"+t+"' is not supported.")},getSupportedProfiles:function(){return eI},getComponent:function(t,e=0){t=String(t),e|=0;const n=QF.get(t);if(n)return new sh({name:t,level:d.clamp(e||n.level,1,n.level),title:n.title,providerUrl:n.providerUrl,external:n.external,dependencies:n.dependencies});throw Error("Component '"+t+"' at level '"+e+"' is not supported.")},getSupportedComponents:function(){return QF},loadComponents:function(){function t(e,n,o){return Promise.all(n.map((n=>async function(e,n,o){if(o.has(n))return;o.add(n);const r=e.getSupportedComponents().get(n);if(await t(e,r.dependencies,o),!r.external)return;ar.NODE_ENV?i.g.require(i.g.require("url").fileURLToPath(r.providerUrl)):await import(r.providerUrl)}(e,n,o))))}return function(e){return e instanceof qF?this.loadComponents(e.components):e instanceof ch?this.loadComponents([...e].map((({name:t})=>t))):e instanceof sh?this.loadComponents([e.name]):t(this,[...e],new Set)}}(),getSupportedNode:function(t){return Sr.getNodeTypes().get(String(t))},getSupportedNodes:function(){return Sr.getNodeTypes()},getAbstractNode:function(t){return Sr.getAbstractNodeTypes().get(String(t))},getAbstractNodes:function(){return Sr.getAbstractNodeTypes()},createScene:function(t,e){const n=new Lh(this);if(arguments.length){if(!(t instanceof qF))throw new Error("Couldn't create scene: profile must be of type ProfileInfo.");n.setProfile(t);for(let t=1,e=arguments.length;t<e;++t){const e=arguments[t];if(!(e instanceof sh))throw new Error("Couldn't create scene: component must be of type ComponentInfo.");n.addComponent(e)}}return n.setup(),n},replaceWorld:function(t){return new Promise(((e,n)=>{if(this[rI]?.abort(),this[oI]?.("Replacing world aborted."),this[oI]=n,this.initialized().getValue()&&(this.getExecutionContext().setLive(!1),this.shutdown().processInterests(),this.callBrowserCallbacks(c.SHUTDOWN_EVENT),this.callBrowserEventHandler("shutdown")),t instanceof ji.MFNode){const e=t;t=this.createScene();for(const n of e.filter((t=>t)))t.getLive().addInterest("setLive",n.getValue().getExecutionContext());t.setRootNodes(e)}t instanceof Lh||(t=this.createScene()),t.getExecutionContext().getLive().removeInterest("setLive",t),t.setExecutionContext(t),this.setDescription(""),this.getBrowserOptions().configure(),this.setBrowserLoading(!0),this._loadCount.addInterest("checkLoadCount",this,e);for(const e of t.getLoadingObjects())this.addLoadingObject(e);this.setExecutionContext(t),this.getWorld().bindBindables(),t.setLive(this.isLive())}))},checkLoadCount:function(t,e){e.getValue()||(e.removeInterest("checkLoadCount",this),this.setBrowserLoading(!1),this.initialized().set(this.getCurrentTime()),this.initialized().processInterests(),this.callBrowserCallbacks(c.INITIALIZED_EVENT),this.callBrowserEventHandler("initialized load"),t())},createVrmlFromString:function(t){t=String(t);const e=this.currentScene,n=this.isExternal(),i=new Cl(this.getWorld()).createX3DFromString(e.getWorldURL(),t);return n||(e.getLive().addInterest("setLive",i),i.setExecutionContext(e),i.setLive(e.isLive())),i.rootNodes},createX3DFromString:async function(t){t=String(t);const e=this.currentScene,n=this.isExternal(),i=new Cl(this.getWorld()),o=await new Promise(((n,o)=>{i.createX3DFromString(e.getWorldURL(),t,n,o)}));return n||(e.getLive().addInterest("setLive",o),o.setExecutionContext(e),o.setLive(e.isLive())),o},createVrmlFromURL:function(t,e,n){if(e=rc(c.X3DNode,e,!1),n=String(n),!(t instanceof ji.MFString))throw new Error("Browser.createVrmlFromURL: url must be of type MFString.");if(!e)throw new Error("Browser.createVrmlFromURL: node must be of type X3DNode.");const i=e.getField(n);if(!i.isInput())throw new Error("Browser.createVrmlFromURL: event named '"+n+"' must be a input field.");if(i.getType()!==c.MFNode)throw new Error("Browser.createVrmlFromURL: event named '"+n+"' must be of type MFNode.");const o=this.currentScene,r=this.isExternal(),s=new Cl(this.getWorld());this.addLoadingObject(s),s.createX3DFromURL(t,null,(t=>{this.removeLoadingObject(s),t&&(r||(o.getLive().addInterest("setLive",t),t.setExecutionContext(o),t.setLive(o.isLive())),i.setValue(t.rootNodes))}))},createX3DFromURL:function(t,e,n){if(3===arguments.length)return this.createVrmlFromURL(t,e,n);if(!(t instanceof ji.MFString))throw new Error("Browser.createX3DFromURL: url must be of type MFString.");return new Promise(((e,n)=>{const i=this.currentScene,o=this.isExternal(),r=new Cl(this.getWorld());this.addLoadingObject(r),r.createX3DFromURL(t,null,(t=>{this.removeLoadingObject(r),t?(o||(i.getLive().addInterest("setLive",t),t.setExecutionContext(i),t.setLive(i.isLive())),e(t)):n(new Error("Couldn't load X3D file."))}))}))},loadURL:function(t,e=new ji.MFString){return new Promise(((n,i)=>{if(!(t instanceof ji.MFString))throw new Error("Browser.loadURL: url must be of type MFString.");if(!(e instanceof ji.MFString))throw new Error("Browser.loadURL: parameter must be of type MFString.");const o=new Cl(this.getWorld());o.createX3DFromURL(t,e,(t=>{this[rI]!==o?i(new Error("Loading of X3D file aborted.")):(this.getBrowserOption("SplashScreen")||this.getCanvas().show(),t?(this.addLoadingObject(this),this.replaceWorld(t).then(n).catch(i),this.removeLoadingObject(this),this.removeLoadingObject(o)):(this.callBrowserCallbacks(c.CONNECTION_ERROR),this.callBrowserEventHandler("error"),setTimeout((()=>{this.getSplashScreen().find(".x_ite-private-spinner-text").text(Co("Failed loading world."))})),i(new Error("Couldn't load X3D file."))))}),(t=>{o.ready=!0,this.changeViewpoint(t),this.removeLoadingObject(o),n()}),((t,e)=>{o.ready=!0,e?window.open(t,e):location=t,this.removeLoadingObject(o),n()})),o.ready||(this[rI]?.abort(),this.setBrowserLoading(!0),this.addLoadingObject(this[rI]=o))}))},addBrowserListener:function(t,e){},removeBrowserListener:function(t){},addBrowserCallback:function(t,e){this[sI].set(t,e)},removeBrowserCallback:function(t){this[sI].delete(t)},getBrowserCallbacks:function(){return this[sI]},callBrowserCallbacks:function(){const t=[];return function(e){if(this[sI].size)for(const n of x.values(t,this[sI]))n(e)}}(),importDocument:function(t){const e=this.currentScene,n=this.createScene();this.isExternal()||(e.getLive().addInterest("setLive",n),n.setExecutionContext(e),n.setLive(e.isLive()));const i=new ys(n);return i.setInput(t),new Promise(i.parseIntoScene.bind(i))},importJS:function(t){const e=this.currentScene,n=this.createScene();this.isExternal()||(e.getLive().addInterest("setLive",n),n.setExecutionContext(e),n.setLive(e.isLive()));const i=new Ts(n);return i.setInput(t),new Promise(i.parseIntoScene.bind(i))},getBrowserProperty:function(t){return this.getBrowserProperties().getField(t).getValue()},setBrowserOption:function(t,e){this.getBrowserOptions().getField(t).setValue(e)},getBrowserOption:function(t){return this.getBrowserOptions().getField(t).getValue()},getRenderingProperty:function(t){return this.getRenderingProperties().getField(t).getValue()},viewAll:function(t){(t=rc(c.X3DLayerNode,t)??this.getActiveLayer())&&t.viewAll(1,this.getBrowserOption("StraightenHorizon"))},firstViewpoint:function(t){const e=(t=rc(c.X3DLayerNode,t)??this.getActiveLayer()).getUserViewpoints();e.length&&this.bindViewpoint(t,e[0])},previousViewpoint:function(t){if(!(t=rc(c.X3DLayerNode,t)??this.getActiveLayer()))return;const e=t.getUserViewpoints();if(0!==e.length){for(var n=0,i=e.length;n<i&&!e[n]._isBound.getValue();++n);n<e.length?0===n?this.bindViewpoint(t,e.at(-1)):this.bindViewpoint(t,e[n-1]):this.bindViewpoint(t,e.at(-1))}},nextViewpoint:function(t){if(!(t=rc(c.X3DLayerNode,t)??this.getActiveLayer()))return;const e=t.getUserViewpoints();if(0!==e.length){for(var n=0,i=e.length;n<i&&!e[n]._isBound.getValue();++n);n<e.length?n===e.length-1?this.bindViewpoint(t,e[0]):this.bindViewpoint(t,e[n+1]):this.bindViewpoint(t,e[0])}},lastViewpoint:function(t){if(!(t=rc(c.X3DLayerNode,t)??this.getActiveLayer()))return;const e=t.getUserViewpoints();e.length&&this.bindViewpoint(t,e.at(-1))},changeViewpoint:function(t,e){if(1===arguments.length&&(e=String(t),t=this.getActiveLayer()),t=rc(c.X3DLayerNode,t)??this.getActiveLayer())for(const n of t.getViewpoints().get())if(n.getName()===e){this.bindViewpoint(t,n);break}},bindViewpoint:function(t,e){if(t=rc(c.X3DLayerNode,t),e=rc(c.X3DViewpointNode,e),!t)throw new Error("Browser.bindViewpoint: layerNode must be of type X3DLayerNode.");if(!e)throw new Error("Browser.bindViewpoint: viewpointNode must be of type X3DViewpointNode.");e.setVRMLTransition(!0),e._set_bind=!0},addRoute:function(t,e,n,i){this.currentScene.addRoute(t,e,n,i)},deleteRoute:function(t,e,n,i){try{const o=this.currentScene.getRoute(t,e,n,i);o&&this.currentScene.deleteRoute(o)}catch(t){console.error(t)}},beginUpdate:function(){this.setLive(!0),this.getExecutionContext().setLive(!0),this.advanceTime(),this.addBrowserEvent()},endUpdate:function(){this.setLive(!1),this.getExecutionContext().setLive(!1)},print:function(...t){const e=t.join("");console.log(e);for(const t of this[aI])t.append(document.createTextNode(e))},println:function(...t){const e=t.join("");console.log(e);for(const t of this[aI])t.append(document.createTextNode(e+"\n"))},toVRMLStream:function(t){this.currentScene.toVRMLStream(t)},toXMLStream:function(t){this.currentScene.toXMLStream(t)},toJSONStream:function(t){this.currentScene.toJSONStream(t)}});for(const t of Reflect.ownKeys(cI.prototype))Object.defineProperty(cI.prototype,t,{enumerable:!1});Object.defineProperties(cI.prototype,{name:{get:cI.prototype.getName,enumerable:!0},version:{get:cI.prototype.getVersion,enumerable:!0},providerUrl:{get:cI.prototype.getProviderUrl,enumerable:!0},currentFrameRate:{get:cI.prototype.getCurrentFrameRate,enumerable:!0},currentSpeed:{get:cI.prototype.getCurrentSpeed,enumerable:!0},description:{get:cI.prototype.getDescription,set:cI.prototype.setDescription,enumerable:!0},baseURL:{get:cI.prototype.getBaseURL,set:cI.prototype.setBaseURL,enumerable:!0},currentScene:{get:function(){return this.getScriptStack().at(-1).getExecutionContext()},enumerable:!0},supportedProfiles:{get:function(){return eI},enumerable:!0},supportedComponents:{get:function(){return QF},enumerable:!0}});const lI=cI;n.set("x_ite/Browser/X3DBrowser",lI);const hI=lI;var dI=i(532);const pI={error:function(t,e){dI(function(){const n=dI("x3d-canvas, X3DCanvas");this.show(n,t);for(const i of e)"function"==typeof i&&i(n,t)}.bind(this))},show:function(t,e){console.error(e),t.children(".x_ite-private-browser").hide(),t.children(":not(.x_ite-private-browser)").show(),t.each((function(t,e){e.shadowRoot&&e.shadowRoot.appendChild(document.createElement("slot"))}))}},fI=pI;n.set("x_ite/Fallback",fI);const gI=fI;function mI(t){let e=0,n=0;return function(){const i=t.call(this);return i>n?(e=0,n=i,i):n=i+ ++e/1e3}}for(const t of[performance,Date])Object.defineProperty(t,"now",{value:mI(t.now),configurable:!0,writable:!0});const _I=void 0;n.set("standard/Time/MicroTime",_I);var xI=i(532),yI=i(310);xI.decodeText=function(t){return"string"==typeof t?t:(new TextDecoder).decode(t)},xI.ungzip=function(t){try{return yI.ungzip(t,{to:"raw"}).buffer}catch(e){return t}},xI.toLowerCaseFirst=function(t){return t[0].toLowerCase()+t.slice(1)},xI.fn.isInViewport=function(){const t=xI(this),e=xI(window),n=t.offset().top,i=n+t.outerHeight(),o=e.scrollTop(),r=o+e.height();return i>o&&n<r};const wI=xI;n.set("lib/jquery",wI);const SI=i(513);n.set("lib/libtess",SI);var TI=i(532);const bI=TI.Deferred(),vI=TI.Deferred();let EI=!1;function CI(t,e){return new Promise((function(n,i){"function"==typeof t&&bI.done(t),"function"==typeof e&&vI.done(e),bI.done(n),vI.done(i),EI||(EI=!0,TI((function(){try{const t=TI("X3DCanvas");t.length&&(console.warn("Use of <X3DCanvas> element is depreciated, please use <x3d-canvas> element instead. See https://create3000.github.io/x_ite/#embedding-x_ite-within-a-web-page."),TI.map(t,(t=>new hI(t)))),bI.resolve()}catch(t){gI.show(TI("x3d-canvas, X3DCanvas"),t),vI.resolve(t)}})))}))}Object.assign(CI,{require:function(t){if(!n.has(t))throw new Error("Unknown module '"+t+"'.");return n.get(t)},noConflict:function(){const t=window.hasOwnProperty("X3D"),e=window.X3D;return function(){return window.X3D===CI&&(t?window.X3D=e:delete window.X3D),CI}}(),getBrowser:function(t){return TI(t||"x3d-canvas, X3DCanvas").prop("browser")},createBrowser:function(t,e){const n=document.createElement("x3d-canvas");return arguments.length&&n.browser.loadURL(t,e),n}}),Object.assign(CI,{X3DConstants:c,X3DBrowser:hI,X3DExecutionContext:ih,X3DScene:Lh,ComponentInfo:sh,ComponentInfoArray:ch,ProfileInfo:qF,ProfileInfoArray:KF,UnitInfo:dh,UnitInfoArray:gh,ExternProtoDeclarationArray:Vl,ProtoDeclarationArray:Ll,X3DExternProtoDeclaration:Ml,X3DProtoDeclaration:Wr,RouteArray:Wl,X3DRoute:Hl,X3DBaseNode:uo,X3DExportedNode:wh,X3DImportedNode:Mr,X3DProtoDeclarationNode:Gr,X3DFieldDefinition:k,FieldDefinitionArray:J,X3DField:lt,X3DArrayField:Wn,SFColor:ji.SFColor,SFColorRGBA:ji.SFColorRGBA,SFImage:ji.SFImage,SFMatrix3d:ji.SFMatrix3d,SFMatrix3f:ji.SFMatrix3f,SFMatrix4d:ji.SFMatrix4d,SFMatrix4f:ji.SFMatrix4f,SFNode:ji.SFNode,SFRotation:ji.SFRotation,SFVec2d:ji.SFVec2d,SFVec2f:ji.SFVec2f,SFVec3d:ji.SFVec3d,SFVec3f:ji.SFVec3f,SFVec4d:ji.SFVec4d,SFVec4f:ji.SFVec4f,VrmlMatrix:ji.VrmlMatrix,MFBool:ji.MFBool,MFColor:ji.MFColor,MFColorRGBA:ji.MFColorRGBA,MFDouble:ji.MFDouble,MFFloat:ji.MFFloat,MFImage:ji.MFImage,MFInt32:ji.MFInt32,MFMatrix3d:ji.MFMatrix3d,MFMatrix3f:ji.MFMatrix3f,MFMatrix4d:ji.MFMatrix4d,MFMatrix4f:ji.MFMatrix4f,MFNode:ji.MFNode,MFRotation:ji.MFRotation,MFString:ji.MFString,MFTime:ji.MFTime,MFVec2d:ji.MFVec2d,MFVec2f:ji.MFVec2f,MFVec3d:ji.MFVec3d,MFVec3f:ji.MFVec3f,MFVec4d:ji.MFVec4d,MFVec4f:ji.MFVec4f});const OI=CI;n.set("x_ite/X3D",OI);const NI=OI;class FI extends HTMLElement{constructor(){super(),new hI(this)}connectedCallback(){this.browser.connectedCallback()}static get observedAttributes(){return["antialiased","baseURL","baseurl","cache","contentScale","contentscale","contextMenu","contextmenu","debug","multisampling","notifications","oninitialized","onshutdown","splashScreen","splashscreen","src","timings","update","url"]}attributeChangedCallback(t,e,n){this.browser.attributeChangedCallback(t,e,n)}captureStream(...t){return this.browser.getCanvas()[0].captureStream(...t)}toBlob(...t){return this.browser.getCanvas()[0].toBlob(...t)}toDataURL(...t){return this.browser.getCanvas()[0].toDataURL(...t)}}document.createElement("X3DCanvas");const II=FI;n.set("x_ite/X3DCanvasElement",II);const MI=II;!function(){function t(t){if((t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this[t]}const e=Reflect.getPrototypeOf(Int8Array);for(const n of[Array,String,e])void 0===n.prototype.at&&Object.defineProperty(n.prototype,"at",{value:t,writable:!0,enumerable:!1,configurable:!0})}();const DI=void 0;n.set("shim",DI);window[Symbol.for("X_ITE.X3D-8.7.9")]=NI,customElements.define("x3d-canvas",MI),NI();const RI=NI;n.set("x_ite",RI);const VI=RI})(),o=o.default})()));
=======
/* X_ITE v8.7.8 */!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.X3D=t():e.X3D=t()}(self,(()=>(()=>{var t={5:function(e,t,n){"use strict";var i,s,r=n(666);"undefined"!=typeof window&&window,void 0===(s="function"==typeof(i=function(){if("undefined"==typeof window)return null;var e="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||function(t){return e.setTimeout(t,20)},n=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||function(t){e.clearTimeout(t)};function i(e,t){var n=Object.prototype.toString.call(e),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||void 0!==r&&e instanceof r||"undefined"!=typeof Elements&&e instanceof Elements,s=0,o=e.length;if(i)for(;s<o;s++)t(e[s]);else t(e)}function s(e){if(!e.getBoundingClientRect)return{width:e.offsetWidth,height:e.offsetHeight};var t=e.getBoundingClientRect();return{width:Math.round(t.width),height:Math.round(t.height)}}function o(e,t){Object.keys(t).forEach((function(n){e.style[n]=t[n]}))}var a=function(e,r){var l=0;function u(){var e,t,n=[];this.add=function(e){n.push(e)},this.call=function(i){for(e=0,t=n.length;e<t;e++)n[e].call(this,i)},this.remove=function(i){var s=[];for(e=0,t=n.length;e<t;e++)n[e]!==i&&s.push(n[e]);n=s},this.length=function(){return n.length}}function h(e,n){if(e)if(e.resizedAttached)e.resizedAttached.add(n);else{e.resizedAttached=new u,e.resizedAttached.add(n),e.resizeSensor=document.createElement("div"),e.resizeSensor.dir="ltr",e.resizeSensor.className="resize-sensor";var i={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},r={position:"absolute",left:"0px",top:"0px",transition:"0s"};o(e.resizeSensor,i);var a=document.createElement("div");a.className="resize-sensor-expand",o(a,i);var h=document.createElement("div");o(h,r),a.appendChild(h);var c=document.createElement("div");c.className="resize-sensor-shrink",o(c,i);var d=document.createElement("div");o(d,r),o(d,{width:"200%",height:"200%"}),c.appendChild(d),e.resizeSensor.appendChild(a),e.resizeSensor.appendChild(c),e.appendChild(e.resizeSensor);var p=window.getComputedStyle(e),g=p?p.getPropertyValue("position"):null;"absolute"!==g&&"relative"!==g&&"fixed"!==g&&"sticky"!==g&&(e.style.position="relative");var f=!1,m=0,_=s(e),x=0,y=0,w=!0;l=0;var b=function(){var t=e.offsetWidth,n=e.offsetHeight;h.style.width=t+10+"px",h.style.height=n+10+"px",a.scrollLeft=t+10,a.scrollTop=n+10,c.scrollLeft=t+10,c.scrollTop=n+10},S=function(){if(w){if(0===e.offsetWidth&&0===e.offsetHeight)return void(l||(l=t((function(){l=0,S()}))));w=!1}b()};e.resizeSensor.resetSensor=S;var v=function(){m=0,f&&(x=_.width,y=_.height,e.resizedAttached&&e.resizedAttached.call(_))},T=function(){_=s(e),(f=_.width!==x||_.height!==y)&&!m&&(m=t(v)),S()},O=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};O(a,"scroll",T),O(c,"scroll",T),l=t((function(){l=0,S()}))}}i(e,(function(e){h(e,r)})),this.detach=function(t){l||(n(l),l=0),a.detach(e,t)},this.reset=function(){e.resizeSensor.resetSensor()}};if(a.reset=function(e){i(e,(function(e){e.resizeSensor.resetSensor()}))},a.detach=function(e,t){i(e,(function(e){e&&(e.resizedAttached&&"function"==typeof t&&(e.resizedAttached.remove(t),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached))}))},"undefined"!=typeof MutationObserver){var l=new MutationObserver((function(e){for(var t in e)if(e.hasOwnProperty(t))for(var n=e[t].addedNodes,i=0;i<n.length;i++)n[i].resizeSensor&&a.reset(n[i])}));document.addEventListener("DOMContentLoaded",(function(e){l.observe(document.body,{childList:!0,subtree:!0})}))}return a})?i.call(t,n,t,e):i)||(e.exports=s)},31:(e,t,n)=>{!function(e){function t(e){var t,i,s;return this.length?((t=this[0]).ownerDocument?s=t.ownerDocument:t=(s=t).documentElement,null==e?s.exitFullscreen||s.webkitExitFullscreen||s.webkitCancelFullScreen||s.msExitFullscreen||s.mozCancelFullScreen?(e=n(s))&&(s.fullscreenElement||s.webkitFullscreenElement||s.webkitCurrentFullScreenElement||s.msFullscreenElement||s.mozFullScreenElement)||e:null:e?((i=t.requestFullscreen||t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.msRequestFullscreen||t.mozRequestFullScreen)&&i.call(t),this):((i=s.exitFullscreen||s.webkitExitFullscreen||s.webkitCancelFullScreen||s.msExitFullscreen||s.mozCancelFullScreen)&&n(s)&&i.call(s),this)):this}function n(e){return!!(e.fullscreenElement||e.msFullscreenElement||e.webkitIsFullScreen||e.mozFullScreen)}function i(t){e(document).trigger(new e.Event("fullscreenchange"))}function s(t){e(document).trigger(new e.Event("fullscreenerror"))}e.fn.fullScreen=t,e.fn.toggleFullScreen=function(){return t.call(this,!t.call(this))},function(){var t,n,r;(t=document).webkitCancelFullScreen?(n="webkitfullscreenchange",r="webkitfullscreenerror"):t.msExitFullscreen?(n="MSFullscreenChange",r="MSFullscreenError"):t.mozCancelFullScreen?(n="mozfullscreenchange",r="mozfullscreenerror"):(n="fullscreenchange",r="fullscreenerror"),e(document).bind(n,i),e(document).bind(r,s)}()}(n(666))},906:(e,t,n)=>{var i,s,r;s=[n(666)],void 0===(r="function"==typeof(i=function(e){var t,n,i=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],r=Array.prototype.slice;if(e.event.fixHooks)for(var o=i.length;o;)e.event.fixHooks[i[--o]]=e.event.mouseHooks;var a=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=s.length;t;)this.addEventListener(s[--t],l,!1);else this.onmousewheel=l;e.data(this,"mousewheel-line-height",a.getLineHeight(this)),e.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=s.length;t;)this.removeEventListener(s[--t],l,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t),i=n["offsetParent"in e.fn?"offsetParent":"parent"]();return i.length||(i=e("body")),parseInt(i.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function l(i){var s=i||window.event,o=r.call(arguments,1),l=0,c=0,d=0,p=0,g=0,f=0;if((i=e.event.fix(s)).type="mousewheel","detail"in s&&(d=-1*s.detail),"wheelDelta"in s&&(d=s.wheelDelta),"wheelDeltaY"in s&&(d=s.wheelDeltaY),"wheelDeltaX"in s&&(c=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(c=-1*d,d=0),l=0===d?c:d,"deltaY"in s&&(l=d=-1*s.deltaY),"deltaX"in s&&(c=s.deltaX,0===d&&(l=-1*c)),0!==d||0!==c){if(1===s.deltaMode){var m=e.data(this,"mousewheel-line-height");l*=m,d*=m,c*=m}else if(2===s.deltaMode){var _=e.data(this,"mousewheel-page-height");l*=_,d*=_,c*=_}if(p=Math.max(Math.abs(d),Math.abs(c)),(!n||p<n)&&(n=p,h(s,p)&&(n/=40)),h(s,p)&&(l/=40,c/=40,d/=40),l=Math[l>=1?"floor":"ceil"](l/n),c=Math[c>=1?"floor":"ceil"](c/n),d=Math[d>=1?"floor":"ceil"](d/n),a.settings.normalizeOffset&&this.getBoundingClientRect){var x=this.getBoundingClientRect();g=i.clientX-x.left,f=i.clientY-x.top}return i.deltaX=c,i.deltaY=d,i.deltaFactor=n,i.offsetX=g,i.offsetY=f,i.deltaMode=0,o.unshift(i,l,c,d),t&&clearTimeout(t),t=setTimeout(u,200),(e.event.dispatch||e.event.handle).apply(this,o)}}function u(){n=null}function h(e,t){return a.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})?i.apply(t,s):i)||(e.exports=r)},666:function(e,t){var n;!function(t,n){"use strict";"object"==typeof e.exports?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(t)}("undefined"!=typeof window?window:this,(function(i,s){"use strict";var r=[],o=Object.getPrototypeOf,a=r.slice,l=r.flat?function(e){return r.flat.call(e)}:function(e){return r.concat.apply([],e)},u=r.push,h=r.indexOf,c={},d=c.toString,p=c.hasOwnProperty,g=p.toString,f=g.call(Object),m={},_=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},y=i.document,w={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var i,s,r=(n=n||y).createElement("script");if(r.text=e,t)for(i in w)(s=t[i]||t.getAttribute&&t.getAttribute(i))&&r.setAttribute(i,s);n.head.appendChild(r).parentNode.removeChild(r)}function S(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[d.call(e)]||"object":typeof e}var v="3.7.0",T=/HTML$/i,O=function(e,t){return new O.fn.init(e,t)};function E(e){var t=!!e&&"length"in e&&e.length,n=S(e);return!_(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function C(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}O.fn=O.prototype={jquery:v,constructor:O,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=O.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return O.each(this,e)},map:function(e){return this.pushStack(O.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(O.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(O.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:r.sort,splice:r.splice},O.extend=O.fn.extend=function(){var e,t,n,i,s,r,o=arguments[0]||{},a=1,l=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[a]||{},a++),"object"==typeof o||_(o)||(o={}),a===l&&(o=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)i=e[t],"__proto__"!==t&&o!==i&&(u&&i&&(O.isPlainObject(i)||(s=Array.isArray(i)))?(n=o[t],r=s&&!Array.isArray(n)?[]:s||O.isPlainObject(n)?n:{},s=!1,o[t]=O.extend(u,r,i)):void 0!==i&&(o[t]=i));return o},O.extend({expando:"jQuery"+(v+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==d.call(e))&&(!(t=o(e))||"function"==typeof(n=p.call(t,"constructor")&&t.constructor)&&g.call(n)===f)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,i=0;if(E(e))for(n=e.length;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},text:function(e){var t,n="",i=0,s=e.nodeType;if(s){if(1===s||9===s||11===s)return e.textContent;if(3===s||4===s)return e.nodeValue}else for(;t=e[i++];)n+=O.text(t);return n},makeArray:function(e,t){var n=t||[];return null!=e&&(E(Object(e))?O.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:h.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!T.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,i=0,s=e.length;i<n;i++)e[s++]=t[i];return e.length=s,e},grep:function(e,t,n){for(var i=[],s=0,r=e.length,o=!n;s<r;s++)!t(e[s],s)!==o&&i.push(e[s]);return i},map:function(e,t,n){var i,s,r=0,o=[];if(E(e))for(i=e.length;r<i;r++)null!=(s=t(e[r],r,n))&&o.push(s);else for(r in e)null!=(s=t(e[r],r,n))&&o.push(s);return l(o)},guid:1,support:m}),"function"==typeof Symbol&&(O.fn[Symbol.iterator]=r[Symbol.iterator]),O.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){c["[object "+t+"]"]=t.toLowerCase()}));var N=r.pop,F=r.sort,I=r.splice,M="[\\x20\\t\\r\\n\\f]",P=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g");O.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var D=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function R(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}O.escapeSelector=function(e){return(e+"").replace(D,R)};var A=y,V=u;!function(){var e,t,n,s,o,l,u,c,d,g,f=V,_=O.expando,x=0,y=0,w=ee(),b=ee(),S=ee(),v=ee(),T=function(e,t){return e===t&&(o=!0),0},E="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",D="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",R="\\["+M+"*("+D+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+D+"))|)"+M+"*\\]",L=":("+D+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),U=new RegExp("^"+M+"*,"+M+"*"),X=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),j=new RegExp(M+"|>"),k=new RegExp(L),z=new RegExp("^"+D+"$"),G={ID:new RegExp("^#("+D+")"),CLASS:new RegExp("^\\.("+D+")"),TAG:new RegExp("^("+D+"|[*])"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+L),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+E+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},H=/^(?:input|select|textarea|button)$/i,q=/^h\d$/i,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,W=/[+~]/,$=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),K=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},J=function(){le()},Z=de((function(e){return!0===e.disabled&&C(e,"fieldset")}),{dir:"parentNode",next:"legend"});try{f.apply(r=a.call(A.childNodes),A.childNodes),r[A.childNodes.length].nodeType}catch(e){f={apply:function(e,t){V.apply(e,a.call(t))},call:function(e){V.apply(e,a.call(arguments,1))}}}function Q(e,t,n,i){var s,r,o,a,u,h,p,g=t&&t.ownerDocument,x=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==x&&9!==x&&11!==x)return n;if(!i&&(le(t),t=t||l,c)){if(11!==x&&(u=Y.exec(e)))if(s=u[1]){if(9===x){if(!(o=t.getElementById(s)))return n;if(o.id===s)return f.call(n,o),n}else if(g&&(o=g.getElementById(s))&&Q.contains(t,o)&&o.id===s)return f.call(n,o),n}else{if(u[2])return f.apply(n,t.getElementsByTagName(e)),n;if((s=u[3])&&t.getElementsByClassName)return f.apply(n,t.getElementsByClassName(s)),n}if(!(v[e+" "]||d&&d.test(e))){if(p=e,g=t,1===x&&(j.test(e)||X.test(e))){for((g=W.test(e)&&ae(t.parentNode)||t)==t&&m.scope||((a=t.getAttribute("id"))?a=O.escapeSelector(a):t.setAttribute("id",a=_)),r=(h=he(e)).length;r--;)h[r]=(a?"#"+a:":scope")+" "+ce(h[r]);p=h.join(",")}try{return f.apply(n,g.querySelectorAll(p)),n}catch(t){v(e,!0)}finally{a===_&&t.removeAttribute("id")}}}return xe(e.replace(P,"$1"),t,n,i)}function ee(){var e=[];return function n(i,s){return e.push(i+" ")>t.cacheLength&&delete n[e.shift()],n[i+" "]=s}}function te(e){return e[_]=!0,e}function ne(e){var t=l.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ie(e){return function(t){return C(t,"input")&&t.type===e}}function se(e){return function(t){return(C(t,"input")||C(t,"button"))&&t.type===e}}function re(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Z(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function oe(e){return te((function(t){return t=+t,te((function(n,i){for(var s,r=e([],n.length,t),o=r.length;o--;)n[s=r[o]]&&(n[s]=!(i[s]=n[s]))}))}))}function ae(e){return e&&void 0!==e.getElementsByTagName&&e}function le(e){var n,i=e?e.ownerDocument||e:A;return i!=l&&9===i.nodeType&&i.documentElement?(u=(l=i).documentElement,c=!O.isXMLDoc(l),g=u.matches||u.webkitMatchesSelector||u.msMatchesSelector,A!=l&&(n=l.defaultView)&&n.top!==n&&n.addEventListener("unload",J),m.getById=ne((function(e){return u.appendChild(e).id=O.expando,!l.getElementsByName||!l.getElementsByName(O.expando).length})),m.disconnectedMatch=ne((function(e){return g.call(e,"*")})),m.scope=ne((function(){return l.querySelectorAll(":scope")})),m.cssHas=ne((function(){try{return l.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),m.getById?(t.filter.ID=function(e){var t=e.replace($,K);return function(e){return e.getAttribute("id")===t}},t.find.ID=function(e,t){if(void 0!==t.getElementById&&c){var n=t.getElementById(e);return n?[n]:[]}}):(t.filter.ID=function(e){var t=e.replace($,K);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},t.find.ID=function(e,t){if(void 0!==t.getElementById&&c){var n,i,s,r=t.getElementById(e);if(r){if((n=r.getAttributeNode("id"))&&n.value===e)return[r];for(s=t.getElementsByName(e),i=0;r=s[i++];)if((n=r.getAttributeNode("id"))&&n.value===e)return[r]}return[]}}),t.find.TAG=function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},t.find.CLASS=function(e,t){if(void 0!==t.getElementsByClassName&&c)return t.getElementsByClassName(e)},d=[],ne((function(e){var t;u.appendChild(e).innerHTML="<a id='"+_+"' href='' disabled='disabled'></a><select id='"+_+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+M+"*(?:value|"+E+")"),e.querySelectorAll("[id~="+_+"-]").length||d.push("~="),e.querySelectorAll("a#"+_+"+*").length||d.push(".#.+[+~]"),e.querySelectorAll(":checked").length||d.push(":checked"),(t=l.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),u.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(t=l.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||d.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")")})),m.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),T=function(e,t){if(e===t)return o=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!m.sortDetached&&t.compareDocumentPosition(e)===n?e===l||e.ownerDocument==A&&Q.contains(A,e)?-1:t===l||t.ownerDocument==A&&Q.contains(A,t)?1:s?h.call(s,e)-h.call(s,t):0:4&n?-1:1)},l):l}for(e in Q.matches=function(e,t){return Q(e,null,null,t)},Q.matchesSelector=function(e,t){if(le(e),c&&!v[t+" "]&&(!d||!d.test(t)))try{var n=g.call(e,t);if(n||m.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){v(t,!0)}return Q(t,l,null,[e]).length>0},Q.contains=function(e,t){return(e.ownerDocument||e)!=l&&le(e),O.contains(e,t)},Q.attr=function(e,n){(e.ownerDocument||e)!=l&&le(e);var i=t.attrHandle[n.toLowerCase()],s=i&&p.call(t.attrHandle,n.toLowerCase())?i(e,n,!c):void 0;return void 0!==s?s:e.getAttribute(n)},Q.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},O.uniqueSort=function(e){var t,n=[],i=0,r=0;if(o=!m.sortStable,s=!m.sortStable&&a.call(e,0),F.call(e,T),o){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)I.call(e,n[i],1)}return s=null,e},O.fn.uniqueSort=function(){return this.pushStack(O.uniqueSort(a.apply(this)))},t=O.expr={cacheLength:50,createPseudo:te,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,K),e[3]=(e[3]||e[4]||e[5]||"").replace($,K),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||Q.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&Q.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&k.test(n)&&(t=he(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace($,K).toLowerCase();return"*"===e?function(){return!0}:function(e){return C(e,t)}},CLASS:function(e){var t=w[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&w(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(i){var s=Q.attr(i,e);return null==s?"!="===t:!t||(s+="","="===t?s===n:"!="===t?s!==n:"^="===t?n&&0===s.indexOf(n):"*="===t?n&&s.indexOf(n)>-1:"$="===t?n&&s.slice(-n.length)===n:"~="===t?(" "+s.replace(B," ")+" ").indexOf(n)>-1:"|="===t&&(s===n||s.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,s){var r="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===i&&0===s?function(e){return!!e.parentNode}:function(t,n,l){var u,h,c,d,p,g=r!==o?"nextSibling":"previousSibling",f=t.parentNode,m=a&&t.nodeName.toLowerCase(),y=!l&&!a,w=!1;if(f){if(r){for(;g;){for(c=t;c=c[g];)if(a?C(c,m):1===c.nodeType)return!1;p=g="only"===e&&!p&&"nextSibling"}return!0}if(p=[o?f.firstChild:f.lastChild],o&&y){for(w=(d=(u=(h=f[_]||(f[_]={}))[e]||[])[0]===x&&u[1])&&u[2],c=d&&f.childNodes[d];c=++d&&c&&c[g]||(w=d=0)||p.pop();)if(1===c.nodeType&&++w&&c===t){h[e]=[x,d,w];break}}else if(y&&(w=d=(u=(h=t[_]||(t[_]={}))[e]||[])[0]===x&&u[1]),!1===w)for(;(c=++d&&c&&c[g]||(w=d=0)||p.pop())&&(!(a?C(c,m):1===c.nodeType)||!++w||(y&&((h=c[_]||(c[_]={}))[e]=[x,w]),c!==t)););return(w-=s)===i||w%i==0&&w/i>=0}}},PSEUDO:function(e,n){var i,s=t.pseudos[e]||t.setFilters[e.toLowerCase()]||Q.error("unsupported pseudo: "+e);return s[_]?s(n):s.length>1?(i=[e,e,"",n],t.setFilters.hasOwnProperty(e.toLowerCase())?te((function(e,t){for(var i,r=s(e,n),o=r.length;o--;)e[i=h.call(e,r[o])]=!(t[i]=r[o])})):function(e){return s(e,0,i)}):s}},pseudos:{not:te((function(e){var t=[],n=[],i=_e(e.replace(P,"$1"));return i[_]?te((function(e,t,n,s){for(var r,o=i(e,null,s,[]),a=e.length;a--;)(r=o[a])&&(e[a]=!(t[a]=r))})):function(e,s,r){return t[0]=e,i(t,null,r,n),t[0]=null,!n.pop()}})),has:te((function(e){return function(t){return Q(e,t).length>0}})),contains:te((function(e){return e=e.replace($,K),function(t){return(t.textContent||O.text(t)).indexOf(e)>-1}})),lang:te((function(e){return z.test(e||"")||Q.error("unsupported lang: "+e),e=e.replace($,K).toLowerCase(),function(t){var n;do{if(n=c?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===u},focus:function(e){return e===function(){try{return l.activeElement}catch(e){}}()&&l.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:re(!1),disabled:re(!0),checked:function(e){return C(e,"input")&&!!e.checked||C(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!t.pseudos.empty(e)},header:function(e){return q.test(e.nodeName)},input:function(e){return H.test(e.nodeName)},button:function(e){return C(e,"input")&&"button"===e.type||C(e,"button")},text:function(e){var t;return C(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:oe((function(){return[0]})),last:oe((function(e,t){return[t-1]})),eq:oe((function(e,t,n){return[n<0?n+t:n]})),even:oe((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:oe((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:oe((function(e,t,n){var i;for(i=n<0?n+t:n>t?t:n;--i>=0;)e.push(i);return e})),gt:oe((function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e}))}},t.pseudos.nth=t.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})t.pseudos[e]=ie(e);for(e in{submit:!0,reset:!0})t.pseudos[e]=se(e);function ue(){}function he(e,n){var i,s,r,o,a,l,u,h=b[e+" "];if(h)return n?0:h.slice(0);for(a=e,l=[],u=t.preFilter;a;){for(o in i&&!(s=U.exec(a))||(s&&(a=a.slice(s[0].length)||a),l.push(r=[])),i=!1,(s=X.exec(a))&&(i=s.shift(),r.push({value:i,type:s[0].replace(P," ")}),a=a.slice(i.length)),t.filter)!(s=G[o].exec(a))||u[o]&&!(s=u[o](s))||(i=s.shift(),r.push({value:i,type:o,matches:s}),a=a.slice(i.length));if(!i)break}return n?a.length:a?Q.error(e):b(e,l).slice(0)}function ce(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function de(e,t,n){var i=t.dir,s=t.next,r=s||i,o=n&&"parentNode"===r,a=y++;return t.first?function(t,n,s){for(;t=t[i];)if(1===t.nodeType||o)return e(t,n,s);return!1}:function(t,n,l){var u,h,c=[x,a];if(l){for(;t=t[i];)if((1===t.nodeType||o)&&e(t,n,l))return!0}else for(;t=t[i];)if(1===t.nodeType||o)if(h=t[_]||(t[_]={}),s&&C(t,s))t=t[i]||t;else{if((u=h[r])&&u[0]===x&&u[1]===a)return c[2]=u[2];if(h[r]=c,c[2]=e(t,n,l))return!0}return!1}}function pe(e){return e.length>1?function(t,n,i){for(var s=e.length;s--;)if(!e[s](t,n,i))return!1;return!0}:e[0]}function ge(e,t,n,i,s){for(var r,o=[],a=0,l=e.length,u=null!=t;a<l;a++)(r=e[a])&&(n&&!n(r,i,s)||(o.push(r),u&&t.push(a)));return o}function fe(e,t,n,i,s,r){return i&&!i[_]&&(i=fe(i)),s&&!s[_]&&(s=fe(s,r)),te((function(r,o,a,l){var u,c,d,p,g=[],m=[],_=o.length,x=r||function(e,t,n){for(var i=0,s=t.length;i<s;i++)Q(e,t[i],n);return n}(t||"*",a.nodeType?[a]:a,[]),y=!e||!r&&t?x:ge(x,g,e,a,l);if(n?n(y,p=s||(r?e:_||i)?[]:o,a,l):p=y,i)for(u=ge(p,m),i(u,[],a,l),c=u.length;c--;)(d=u[c])&&(p[m[c]]=!(y[m[c]]=d));if(r){if(s||e){if(s){for(u=[],c=p.length;c--;)(d=p[c])&&u.push(y[c]=d);s(null,p=[],u,l)}for(c=p.length;c--;)(d=p[c])&&(u=s?h.call(r,d):g[c])>-1&&(r[u]=!(o[u]=d))}}else p=ge(p===o?p.splice(_,p.length):p),s?s(null,o,p,l):f.apply(o,p)}))}function me(e){for(var i,s,r,o=e.length,a=t.relative[e[0].type],l=a||t.relative[" "],u=a?1:0,c=de((function(e){return e===i}),l,!0),d=de((function(e){return h.call(i,e)>-1}),l,!0),p=[function(e,t,s){var r=!a&&(s||t!=n)||((i=t).nodeType?c(e,t,s):d(e,t,s));return i=null,r}];u<o;u++)if(s=t.relative[e[u].type])p=[de(pe(p),s)];else{if((s=t.filter[e[u].type].apply(null,e[u].matches))[_]){for(r=++u;r<o&&!t.relative[e[r].type];r++);return fe(u>1&&pe(p),u>1&&ce(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(P,"$1"),s,u<r&&me(e.slice(u,r)),r<o&&me(e=e.slice(r)),r<o&&ce(e))}p.push(s)}return pe(p)}function _e(e,i){var s,r=[],o=[],a=S[e+" "];if(!a){for(i||(i=he(e)),s=i.length;s--;)(a=me(i[s]))[_]?r.push(a):o.push(a);a=S(e,function(e,i){var s=i.length>0,r=e.length>0,o=function(o,a,u,h,d){var p,g,m,_=0,y="0",w=o&&[],b=[],S=n,v=o||r&&t.find.TAG("*",d),T=x+=null==S?1:Math.random()||.1,E=v.length;for(d&&(n=a==l||a||d);y!==E&&null!=(p=v[y]);y++){if(r&&p){for(g=0,a||p.ownerDocument==l||(le(p),u=!c);m=e[g++];)if(m(p,a||l,u)){f.call(h,p);break}d&&(x=T)}s&&((p=!m&&p)&&_--,o&&w.push(p))}if(_+=y,s&&y!==_){for(g=0;m=i[g++];)m(w,b,a,u);if(o){if(_>0)for(;y--;)w[y]||b[y]||(b[y]=N.call(h));b=ge(b)}f.apply(h,b),d&&!o&&b.length>0&&_+i.length>1&&O.uniqueSort(h)}return d&&(x=T,n=S),w};return s?te(o):o}(o,r)),a.selector=e}return a}function xe(e,n,i,s){var r,o,a,l,u,h="function"==typeof e&&e,d=!s&&he(e=h.selector||e);if(i=i||[],1===d.length){if((o=d[0]=d[0].slice(0)).length>2&&"ID"===(a=o[0]).type&&9===n.nodeType&&c&&t.relative[o[1].type]){if(!(n=(t.find.ID(a.matches[0].replace($,K),n)||[])[0]))return i;h&&(n=n.parentNode),e=e.slice(o.shift().value.length)}for(r=G.needsContext.test(e)?0:o.length;r--&&(a=o[r],!t.relative[l=a.type]);)if((u=t.find[l])&&(s=u(a.matches[0].replace($,K),W.test(o[0].type)&&ae(n.parentNode)||n))){if(o.splice(r,1),!(e=s.length&&ce(o)))return f.apply(i,s),i;break}}return(h||_e(e,d))(s,n,!c,i,!n||W.test(e)&&ae(n.parentNode)||n),i}ue.prototype=t.filters=t.pseudos,t.setFilters=new ue,m.sortStable=_.split("").sort(T).join("")===_,le(),m.sortDetached=ne((function(e){return 1&e.compareDocumentPosition(l.createElement("fieldset"))})),O.find=Q,O.expr[":"]=O.expr.pseudos,O.unique=O.uniqueSort,Q.compile=_e,Q.select=xe,Q.setDocument=le,Q.escape=O.escapeSelector,Q.getText=O.text,Q.isXML=O.isXMLDoc,Q.selectors=O.expr,Q.support=O.support,Q.uniqueSort=O.uniqueSort}();var L=function(e,t,n){for(var i=[],s=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(s&&O(e).is(n))break;i.push(e)}return i},B=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},U=O.expr.match.needsContext,X=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,t,n){return _(t)?O.grep(e,(function(e,i){return!!t.call(e,i,e)!==n})):t.nodeType?O.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?O.grep(e,(function(e){return h.call(t,e)>-1!==n})):O.filter(t,e,n)}O.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?O.find.matchesSelector(i,e)?[i]:[]:O.find.matches(e,O.grep(t,(function(e){return 1===e.nodeType})))},O.fn.extend({find:function(e){var t,n,i=this.length,s=this;if("string"!=typeof e)return this.pushStack(O(e).filter((function(){for(t=0;t<i;t++)if(O.contains(s[t],this))return!0})));for(n=this.pushStack([]),t=0;t<i;t++)O.find(e,s[t],n);return i>1?O.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&U.test(e)?O(e):e||[],!1).length}});var k,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(O.fn.init=function(e,t,n){var i,s;if(!e)return this;if(n=n||k,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:z.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof O?t[0]:t,O.merge(this,O.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:y,!0)),X.test(i[1])&&O.isPlainObject(t))for(i in t)_(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(s=y.getElementById(i[2]))&&(this[0]=s,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):_(e)?void 0!==n.ready?n.ready(e):e(O):O.makeArray(e,this)}).prototype=O.fn,k=O(y);var G=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function q(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}O.fn.extend({has:function(e){var t=O(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(O.contains(this,t[e]))return!0}))},closest:function(e,t){var n,i=0,s=this.length,r=[],o="string"!=typeof e&&O(e);if(!U.test(e))for(;i<s;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&O.find.matchesSelector(n,e))){r.push(n);break}return this.pushStack(r.length>1?O.uniqueSort(r):r)},index:function(e){return e?"string"==typeof e?h.call(O(e),this[0]):h.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(O.uniqueSort(O.merge(this.get(),O(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),O.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return L(e,"parentNode")},parentsUntil:function(e,t,n){return L(e,"parentNode",n)},next:function(e){return q(e,"nextSibling")},prev:function(e){return q(e,"previousSibling")},nextAll:function(e){return L(e,"nextSibling")},prevAll:function(e){return L(e,"previousSibling")},nextUntil:function(e,t,n){return L(e,"nextSibling",n)},prevUntil:function(e,t,n){return L(e,"previousSibling",n)},siblings:function(e){return B((e.parentNode||{}).firstChild,e)},children:function(e){return B(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(C(e,"template")&&(e=e.content||e),O.merge([],e.childNodes))}},(function(e,t){O.fn[e]=function(n,i){var s=O.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(s=O.filter(i,s)),this.length>1&&(H[e]||O.uniqueSort(s),G.test(e)&&s.reverse()),this.pushStack(s)}}));var Y=/[^\x20\t\r\n\f]+/g;function W(e){return e}function $(e){throw e}function K(e,t,n,i){var s;try{e&&_(s=e.promise)?s.call(e).done(t).fail(n):e&&_(s=e.then)?s.call(e,t,n):t.apply(void 0,[e].slice(i))}catch(e){n.apply(void 0,[e])}}O.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return O.each(e.match(Y)||[],(function(e,n){t[n]=!0})),t}(e):O.extend({},e);var t,n,i,s,r=[],o=[],a=-1,l=function(){for(s=s||e.once,i=t=!0;o.length;a=-1)for(n=o.shift();++a<r.length;)!1===r[a].apply(n[0],n[1])&&e.stopOnFalse&&(a=r.length,n=!1);e.memory||(n=!1),t=!1,s&&(r=n?[]:"")},u={add:function(){return r&&(n&&!t&&(a=r.length-1,o.push(n)),function t(n){O.each(n,(function(n,i){_(i)?e.unique&&u.has(i)||r.push(i):i&&i.length&&"string"!==S(i)&&t(i)}))}(arguments),n&&!t&&l()),this},remove:function(){return O.each(arguments,(function(e,t){for(var n;(n=O.inArray(t,r,n))>-1;)r.splice(n,1),n<=a&&a--})),this},has:function(e){return e?O.inArray(e,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return s=o=[],r=n="",this},disabled:function(){return!r},lock:function(){return s=o=[],n||t||(r=n=""),this},locked:function(){return!!s},fireWith:function(e,n){return s||(n=[e,(n=n||[]).slice?n.slice():n],o.push(n),t||l()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!i}};return u},O.extend({Deferred:function(e){var t=[["notify","progress",O.Callbacks("memory"),O.Callbacks("memory"),2],["resolve","done",O.Callbacks("once memory"),O.Callbacks("once memory"),0,"resolved"],["reject","fail",O.Callbacks("once memory"),O.Callbacks("once memory"),1,"rejected"]],n="pending",s={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},catch:function(e){return s.then(null,e)},pipe:function(){var e=arguments;return O.Deferred((function(n){O.each(t,(function(t,i){var s=_(e[i[4]])&&e[i[4]];r[i[1]]((function(){var e=s&&s.apply(this,arguments);e&&_(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this,s?[e]:arguments)}))})),e=null})).promise()},then:function(e,n,s){var r=0;function o(e,t,n,s){return function(){var a=this,l=arguments,u=function(){var i,u;if(!(e<r)){if((i=n.apply(a,l))===t.promise())throw new TypeError("Thenable self-resolution");u=i&&("object"==typeof i||"function"==typeof i)&&i.then,_(u)?s?u.call(i,o(r,t,W,s),o(r,t,$,s)):(r++,u.call(i,o(r,t,W,s),o(r,t,$,s),o(r,t,W,t.notifyWith))):(n!==W&&(a=void 0,l=[i]),(s||t.resolveWith)(a,l))}},h=s?u:function(){try{u()}catch(i){O.Deferred.exceptionHook&&O.Deferred.exceptionHook(i,h.error),e+1>=r&&(n!==$&&(a=void 0,l=[i]),t.rejectWith(a,l))}};e?h():(O.Deferred.getErrorHook?h.error=O.Deferred.getErrorHook():O.Deferred.getStackHook&&(h.error=O.Deferred.getStackHook()),i.setTimeout(h))}}return O.Deferred((function(i){t[0][3].add(o(0,i,_(s)?s:W,i.notifyWith)),t[1][3].add(o(0,i,_(e)?e:W)),t[2][3].add(o(0,i,_(n)?n:$))})).promise()},promise:function(e){return null!=e?O.extend(e,s):s}},r={};return O.each(t,(function(e,i){var o=i[2],a=i[5];s[i[1]]=o.add,a&&o.add((function(){n=a}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(i[3].fire),r[i[0]]=function(){return r[i[0]+"With"](this===r?void 0:this,arguments),this},r[i[0]+"With"]=o.fireWith})),s.promise(r),e&&e.call(r,r),r},when:function(e){var t=arguments.length,n=t,i=Array(n),s=a.call(arguments),r=O.Deferred(),o=function(e){return function(n){i[e]=this,s[e]=arguments.length>1?a.call(arguments):n,--t||r.resolveWith(i,s)}};if(t<=1&&(K(e,r.done(o(n)).resolve,r.reject,!t),"pending"===r.state()||_(s[n]&&s[n].then)))return r.then();for(;n--;)K(s[n],o(n),r.reject);return r.promise()}});var J=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;O.Deferred.exceptionHook=function(e,t){i.console&&i.console.warn&&e&&J.test(e.name)&&i.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},O.readyException=function(e){i.setTimeout((function(){throw e}))};var Z=O.Deferred();function Q(){y.removeEventListener("DOMContentLoaded",Q),i.removeEventListener("load",Q),O.ready()}O.fn.ready=function(e){return Z.then(e).catch((function(e){O.readyException(e)})),this},O.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--O.readyWait:O.isReady)||(O.isReady=!0,!0!==e&&--O.readyWait>0||Z.resolveWith(y,[O]))}}),O.ready.then=Z.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?i.setTimeout(O.ready):(y.addEventListener("DOMContentLoaded",Q),i.addEventListener("load",Q));var ee=function(e,t,n,i,s,r,o){var a=0,l=e.length,u=null==n;if("object"===S(n))for(a in s=!0,n)ee(e,t,a,n[a],!0,r,o);else if(void 0!==i&&(s=!0,_(i)||(o=!0),u&&(o?(t.call(e,i),t=null):(u=t,t=function(e,t,n){return u.call(O(e),n)})),t))for(;a<l;a++)t(e[a],n,o?i:i.call(e[a],a,t(e[a],n)));return s?e:u?t.call(e):l?t(e[0],n):r},te=/^-ms-/,ne=/-([a-z])/g;function ie(e,t){return t.toUpperCase()}function se(e){return e.replace(te,"ms-").replace(ne,ie)}var re=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function oe(){this.expando=O.expando+oe.uid++}oe.uid=1,oe.prototype={cache:function(e){var t=e[this.expando];return t||(t={},re(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var i,s=this.cache(e);if("string"==typeof t)s[se(t)]=n;else for(i in t)s[se(i)]=t[i];return s},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][se(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i=e[this.expando];if(void 0!==i){if(void 0!==t){n=(t=Array.isArray(t)?t.map(se):(t=se(t))in i?[t]:t.match(Y)||[]).length;for(;n--;)delete i[t[n]]}(void 0===t||O.isEmptyObject(i))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!O.isEmptyObject(t)}};var ae=new oe,le=new oe,ue=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,he=/[A-Z]/g;function ce(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(he,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(i))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ue.test(e)?JSON.parse(e):e)}(n)}catch(e){}le.set(e,t,n)}else n=void 0;return n}O.extend({hasData:function(e){return le.hasData(e)||ae.hasData(e)},data:function(e,t,n){return le.access(e,t,n)},removeData:function(e,t){le.remove(e,t)},_data:function(e,t,n){return ae.access(e,t,n)},_removeData:function(e,t){ae.remove(e,t)}}),O.fn.extend({data:function(e,t){var n,i,s,r=this[0],o=r&&r.attributes;if(void 0===e){if(this.length&&(s=le.get(r),1===r.nodeType&&!ae.get(r,"hasDataAttrs"))){for(n=o.length;n--;)o[n]&&0===(i=o[n].name).indexOf("data-")&&(i=se(i.slice(5)),ce(r,i,s[i]));ae.set(r,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each((function(){le.set(this,e)})):ee(this,(function(t){var n;if(r&&void 0===t)return void 0!==(n=le.get(r,e))||void 0!==(n=ce(r,e))?n:void 0;this.each((function(){le.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){le.remove(this,e)}))}}),O.extend({queue:function(e,t,n){var i;if(e)return t=(t||"fx")+"queue",i=ae.get(e,t),n&&(!i||Array.isArray(n)?i=ae.access(e,t,O.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=O.queue(e,t),i=n.length,s=n.shift(),r=O._queueHooks(e,t);"inprogress"===s&&(s=n.shift(),i--),s&&("fx"===t&&n.unshift("inprogress"),delete r.stop,s.call(e,(function(){O.dequeue(e,t)}),r)),!i&&r&&r.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ae.get(e,n)||ae.access(e,n,{empty:O.Callbacks("once memory").add((function(){ae.remove(e,[t+"queue",n])}))})}}),O.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?O.queue(this[0],e):void 0===t?this:this.each((function(){var n=O.queue(this,e,t);O._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&O.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){O.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,s=O.Deferred(),r=this,o=this.length,a=function(){--i||s.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(n=ae.get(r[o],e+"queueHooks"))&&n.empty&&(i++,n.empty.add(a));return a(),s.promise(t)}});var de=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pe=new RegExp("^(?:([+-])=|)("+de+")([a-z%]*)$","i"),ge=["Top","Right","Bottom","Left"],fe=y.documentElement,me=function(e){return O.contains(e.ownerDocument,e)},_e={composed:!0};fe.getRootNode&&(me=function(e){return O.contains(e.ownerDocument,e)||e.getRootNode(_e)===e.ownerDocument});var xe=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&me(e)&&"none"===O.css(e,"display")};function ye(e,t,n,i){var s,r,o=20,a=i?function(){return i.cur()}:function(){return O.css(e,t,"")},l=a(),u=n&&n[3]||(O.cssNumber[t]?"":"px"),h=e.nodeType&&(O.cssNumber[t]||"px"!==u&&+l)&&pe.exec(O.css(e,t));if(h&&h[3]!==u){for(l/=2,u=u||h[3],h=+l||1;o--;)O.style(e,t,h+u),(1-r)*(1-(r=a()/l||.5))<=0&&(o=0),h/=r;h*=2,O.style(e,t,h+u),n=n||[]}return n&&(h=+h||+l||0,s=n[1]?h+(n[1]+1)*n[2]:+n[2],i&&(i.unit=u,i.start=h,i.end=s)),s}var we={};function be(e){var t,n=e.ownerDocument,i=e.nodeName,s=we[i];return s||(t=n.body.appendChild(n.createElement(i)),s=O.css(t,"display"),t.parentNode.removeChild(t),"none"===s&&(s="block"),we[i]=s,s)}function Se(e,t){for(var n,i,s=[],r=0,o=e.length;r<o;r++)(i=e[r]).style&&(n=i.style.display,t?("none"===n&&(s[r]=ae.get(i,"display")||null,s[r]||(i.style.display="")),""===i.style.display&&xe(i)&&(s[r]=be(i))):"none"!==n&&(s[r]="none",ae.set(i,"display",n)));for(r=0;r<o;r++)null!=s[r]&&(e[r].style.display=s[r]);return e}O.fn.extend({show:function(){return Se(this,!0)},hide:function(){return Se(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){xe(this)?O(this).show():O(this).hide()}))}});var ve,Te,Oe=/^(?:checkbox|radio)$/i,Ee=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ce=/^$|^module$|\/(?:java|ecma)script/i;ve=y.createDocumentFragment().appendChild(y.createElement("div")),(Te=y.createElement("input")).setAttribute("type","radio"),Te.setAttribute("checked","checked"),Te.setAttribute("name","t"),ve.appendChild(Te),m.checkClone=ve.cloneNode(!0).cloneNode(!0).lastChild.checked,ve.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!ve.cloneNode(!0).lastChild.defaultValue,ve.innerHTML="<option></option>",m.option=!!ve.lastChild;var Ne={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Fe(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&C(e,t)?O.merge([e],n):n}function Ie(e,t){for(var n=0,i=e.length;n<i;n++)ae.set(e[n],"globalEval",!t||ae.get(t[n],"globalEval"))}Ne.tbody=Ne.tfoot=Ne.colgroup=Ne.caption=Ne.thead,Ne.th=Ne.td,m.option||(Ne.optgroup=Ne.option=[1,"<select multiple='multiple'>","</select>"]);var Me=/<|&#?\w+;/;function Pe(e,t,n,i,s){for(var r,o,a,l,u,h,c=t.createDocumentFragment(),d=[],p=0,g=e.length;p<g;p++)if((r=e[p])||0===r)if("object"===S(r))O.merge(d,r.nodeType?[r]:r);else if(Me.test(r)){for(o=o||c.appendChild(t.createElement("div")),a=(Ee.exec(r)||["",""])[1].toLowerCase(),l=Ne[a]||Ne._default,o.innerHTML=l[1]+O.htmlPrefilter(r)+l[2],h=l[0];h--;)o=o.lastChild;O.merge(d,o.childNodes),(o=c.firstChild).textContent=""}else d.push(t.createTextNode(r));for(c.textContent="",p=0;r=d[p++];)if(i&&O.inArray(r,i)>-1)s&&s.push(r);else if(u=me(r),o=Fe(c.appendChild(r),"script"),u&&Ie(o),n)for(h=0;r=o[h++];)Ce.test(r.type||"")&&n.push(r);return c}var De=/^([^.]*)(?:\.(.+)|)/;function Re(){return!0}function Ae(){return!1}function Ve(e,t,n,i,s,r){var o,a;if("object"==typeof t){for(a in"string"!=typeof n&&(i=i||n,n=void 0),t)Ve(e,a,n,i,t[a],r);return e}if(null==i&&null==s?(s=n,i=n=void 0):null==s&&("string"==typeof n?(s=i,i=void 0):(s=i,i=n,n=void 0)),!1===s)s=Ae;else if(!s)return e;return 1===r&&(o=s,s=function(e){return O().off(e),o.apply(this,arguments)},s.guid=o.guid||(o.guid=O.guid++)),e.each((function(){O.event.add(this,t,s,i,n)}))}function Le(e,t,n){n?(ae.set(e,t,!1),O.event.add(e,t,{namespace:!1,handler:function(e){var n,i=ae.get(this,t);if(1&e.isTrigger&&this[t]){if(i)(O.event.special[t]||{}).delegateType&&e.stopPropagation();else if(i=a.call(arguments),ae.set(this,t,i),this[t](),n=ae.get(this,t),ae.set(this,t,!1),i!==n)return e.stopImmediatePropagation(),e.preventDefault(),n}else i&&(ae.set(this,t,O.event.trigger(i[0],i.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Re)}})):void 0===ae.get(e,t)&&O.event.add(e,t,Re)}O.event={global:{},add:function(e,t,n,i,s){var r,o,a,l,u,h,c,d,p,g,f,m=ae.get(e);if(re(e))for(n.handler&&(n=(r=n).handler,s=r.selector),s&&O.find.matchesSelector(fe,s),n.guid||(n.guid=O.guid++),(l=m.events)||(l=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==O&&O.event.triggered!==t.type?O.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(Y)||[""]).length;u--;)p=f=(a=De.exec(t[u])||[])[1],g=(a[2]||"").split(".").sort(),p&&(c=O.event.special[p]||{},p=(s?c.delegateType:c.bindType)||p,c=O.event.special[p]||{},h=O.extend({type:p,origType:f,data:i,handler:n,guid:n.guid,selector:s,needsContext:s&&O.expr.match.needsContext.test(s),namespace:g.join(".")},r),(d=l[p])||((d=l[p]=[]).delegateCount=0,c.setup&&!1!==c.setup.call(e,i,g,o)||e.addEventListener&&e.addEventListener(p,o)),c.add&&(c.add.call(e,h),h.handler.guid||(h.handler.guid=n.guid)),s?d.splice(d.delegateCount++,0,h):d.push(h),O.event.global[p]=!0)},remove:function(e,t,n,i,s){var r,o,a,l,u,h,c,d,p,g,f,m=ae.hasData(e)&&ae.get(e);if(m&&(l=m.events)){for(u=(t=(t||"").match(Y)||[""]).length;u--;)if(p=f=(a=De.exec(t[u])||[])[1],g=(a[2]||"").split(".").sort(),p){for(c=O.event.special[p]||{},d=l[p=(i?c.delegateType:c.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=r=d.length;r--;)h=d[r],!s&&f!==h.origType||n&&n.guid!==h.guid||a&&!a.test(h.namespace)||i&&i!==h.selector&&("**"!==i||!h.selector)||(d.splice(r,1),h.selector&&d.delegateCount--,c.remove&&c.remove.call(e,h));o&&!d.length&&(c.teardown&&!1!==c.teardown.call(e,g,m.handle)||O.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)O.event.remove(e,p+t[u],n,i,!0);O.isEmptyObject(l)&&ae.remove(e,"handle events")}},dispatch:function(e){var t,n,i,s,r,o,a=new Array(arguments.length),l=O.event.fix(e),u=(ae.get(this,"events")||Object.create(null))[l.type]||[],h=O.event.special[l.type]||{};for(a[0]=l,t=1;t<arguments.length;t++)a[t]=arguments[t];if(l.delegateTarget=this,!h.preDispatch||!1!==h.preDispatch.call(this,l)){for(o=O.event.handlers.call(this,l,u),t=0;(s=o[t++])&&!l.isPropagationStopped();)for(l.currentTarget=s.elem,n=0;(r=s.handlers[n++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==r.namespace&&!l.rnamespace.test(r.namespace)||(l.handleObj=r,l.data=r.data,void 0!==(i=((O.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,a))&&!1===(l.result=i)&&(l.preventDefault(),l.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,l),l.result}},handlers:function(e,t){var n,i,s,r,o,a=[],l=t.delegateCount,u=e.target;if(l&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(r=[],o={},n=0;n<l;n++)void 0===o[s=(i=t[n]).selector+" "]&&(o[s]=i.needsContext?O(s,this).index(u)>-1:O.find(s,this,null,[u]).length),o[s]&&r.push(i);r.length&&a.push({elem:u,handlers:r})}return u=this,l<t.length&&a.push({elem:u,handlers:t.slice(l)}),a},addProp:function(e,t){Object.defineProperty(O.Event.prototype,e,{enumerable:!0,configurable:!0,get:_(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[O.expando]?e:new O.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return Oe.test(t.type)&&t.click&&C(t,"input")&&Le(t,"click",!0),!1},trigger:function(e){var t=this||e;return Oe.test(t.type)&&t.click&&C(t,"input")&&Le(t,"click"),!0},_default:function(e){var t=e.target;return Oe.test(t.type)&&t.click&&C(t,"input")&&ae.get(t,"click")||C(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},O.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},O.Event=function(e,t){if(!(this instanceof O.Event))return new O.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Re:Ae,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&O.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[O.expando]=!0},O.Event.prototype={constructor:O.Event,isDefaultPrevented:Ae,isPropagationStopped:Ae,isImmediatePropagationStopped:Ae,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Re,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Re,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Re,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},O.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},O.event.addProp),O.each({focus:"focusin",blur:"focusout"},(function(e,t){function n(e){if(y.documentMode){var n=ae.get(this,"handle"),i=O.event.fix(e);i.type="focusin"===e.type?"focus":"blur",i.isSimulated=!0,n(e),i.target===i.currentTarget&&n(i)}else O.event.simulate(t,e.target,O.event.fix(e))}O.event.special[e]={setup:function(){var i;if(Le(this,e,!0),!y.documentMode)return!1;(i=ae.get(this,t))||this.addEventListener(t,n),ae.set(this,t,(i||0)+1)},trigger:function(){return Le(this,e),!0},teardown:function(){var e;if(!y.documentMode)return!1;(e=ae.get(this,t)-1)?ae.set(this,t,e):(this.removeEventListener(t,n),ae.remove(this,t))},_default:function(t){return ae.get(t.target,e)},delegateType:t},O.event.special[t]={setup:function(){var i=this.ownerDocument||this.document||this,s=y.documentMode?this:i,r=ae.get(s,t);r||(y.documentMode?this.addEventListener(t,n):i.addEventListener(e,n,!0)),ae.set(s,t,(r||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,s=y.documentMode?this:i,r=ae.get(s,t)-1;r?ae.set(s,t,r):(y.documentMode?this.removeEventListener(t,n):i.removeEventListener(e,n,!0),ae.remove(s,t))}}})),O.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){O.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=e.relatedTarget,s=e.handleObj;return i&&(i===this||O.contains(this,i))||(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}})),O.fn.extend({on:function(e,t,n,i){return Ve(this,e,t,n,i)},one:function(e,t,n,i){return Ve(this,e,t,n,i,1)},off:function(e,t,n){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,O(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,t,e[s]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Ae),this.each((function(){O.event.remove(this,e,n,t)}))}});var Be=/<script|<style|<link/i,Ue=/checked\s*(?:[^=]|=\s*.checked.)/i,Xe=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function je(e,t){return C(e,"table")&&C(11!==t.nodeType?t:t.firstChild,"tr")&&O(e).children("tbody")[0]||e}function ke(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function ze(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ge(e,t){var n,i,s,r,o,a;if(1===t.nodeType){if(ae.hasData(e)&&(a=ae.get(e).events))for(s in ae.remove(t,"handle events"),a)for(n=0,i=a[s].length;n<i;n++)O.event.add(t,s,a[s][n]);le.hasData(e)&&(r=le.access(e),o=O.extend({},r),le.set(t,o))}}function He(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Oe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function qe(e,t,n,i){t=l(t);var s,r,o,a,u,h,c=0,d=e.length,p=d-1,g=t[0],f=_(g);if(f||d>1&&"string"==typeof g&&!m.checkClone&&Ue.test(g))return e.each((function(s){var r=e.eq(s);f&&(t[0]=g.call(this,s,r.html())),qe(r,t,n,i)}));if(d&&(r=(s=Pe(t,e[0].ownerDocument,!1,e,i)).firstChild,1===s.childNodes.length&&(s=r),r||i)){for(a=(o=O.map(Fe(s,"script"),ke)).length;c<d;c++)u=s,c!==p&&(u=O.clone(u,!0,!0),a&&O.merge(o,Fe(u,"script"))),n.call(e[c],u,c);if(a)for(h=o[o.length-1].ownerDocument,O.map(o,ze),c=0;c<a;c++)u=o[c],Ce.test(u.type||"")&&!ae.access(u,"globalEval")&&O.contains(h,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?O._evalUrl&&!u.noModule&&O._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},h):b(u.textContent.replace(Xe,""),u,h))}return e}function Ye(e,t,n){for(var i,s=t?O.filter(t,e):e,r=0;null!=(i=s[r]);r++)n||1!==i.nodeType||O.cleanData(Fe(i)),i.parentNode&&(n&&me(i)&&Ie(Fe(i,"script")),i.parentNode.removeChild(i));return e}O.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var i,s,r,o,a=e.cloneNode(!0),l=me(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||O.isXMLDoc(e)))for(o=Fe(a),i=0,s=(r=Fe(e)).length;i<s;i++)He(r[i],o[i]);if(t)if(n)for(r=r||Fe(e),o=o||Fe(a),i=0,s=r.length;i<s;i++)Ge(r[i],o[i]);else Ge(e,a);return(o=Fe(a,"script")).length>0&&Ie(o,!l&&Fe(e,"script")),a},cleanData:function(e){for(var t,n,i,s=O.event.special,r=0;void 0!==(n=e[r]);r++)if(re(n)){if(t=n[ae.expando]){if(t.events)for(i in t.events)s[i]?O.event.remove(n,i):O.removeEvent(n,i,t.handle);n[ae.expando]=void 0}n[le.expando]&&(n[le.expando]=void 0)}}}),O.fn.extend({detach:function(e){return Ye(this,e,!0)},remove:function(e){return Ye(this,e)},text:function(e){return ee(this,(function(e){return void 0===e?O.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return qe(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)}))},prepend:function(){return qe(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return qe(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return qe(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(O.cleanData(Fe(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return O.clone(this,e,t)}))},html:function(e){return ee(this,(function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Be.test(e)&&!Ne[(Ee.exec(e)||["",""])[1].toLowerCase()]){e=O.htmlPrefilter(e);try{for(;n<i;n++)1===(t=this[n]||{}).nodeType&&(O.cleanData(Fe(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return qe(this,arguments,(function(t){var n=this.parentNode;O.inArray(this,e)<0&&(O.cleanData(Fe(this)),n&&n.replaceChild(t,this))}),e)}}),O.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){O.fn[e]=function(e){for(var n,i=[],s=O(e),r=s.length-1,o=0;o<=r;o++)n=o===r?this:this.clone(!0),O(s[o])[t](n),u.apply(i,n.get());return this.pushStack(i)}}));var We=new RegExp("^("+de+")(?!px)[a-z%]+$","i"),$e=/^--/,Ke=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=i),t.getComputedStyle(e)},Je=function(e,t,n){var i,s,r={};for(s in t)r[s]=e.style[s],e.style[s]=t[s];for(s in i=n.call(e),t)e.style[s]=r[s];return i},Ze=new RegExp(ge.join("|"),"i");function Qe(e,t,n){var i,s,r,o,a=$e.test(t),l=e.style;return(n=n||Ke(e))&&(o=n.getPropertyValue(t)||n[t],a&&o&&(o=o.replace(P,"$1")||void 0),""!==o||me(e)||(o=O.style(e,t)),!m.pixelBoxStyles()&&We.test(o)&&Ze.test(t)&&(i=l.width,s=l.minWidth,r=l.maxWidth,l.minWidth=l.maxWidth=l.width=o,o=n.width,l.width=i,l.minWidth=s,l.maxWidth=r)),void 0!==o?o+"":o}function et(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(h){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",h.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",fe.appendChild(u).appendChild(h);var e=i.getComputedStyle(h);n="1%"!==e.top,l=12===t(e.marginLeft),h.style.right="60%",o=36===t(e.right),s=36===t(e.width),h.style.position="absolute",r=12===t(h.offsetWidth/3),fe.removeChild(u),h=null}}function t(e){return Math.round(parseFloat(e))}var n,s,r,o,a,l,u=y.createElement("div"),h=y.createElement("div");h.style&&(h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===h.style.backgroundClip,O.extend(m,{boxSizingReliable:function(){return e(),s},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),r},reliableTrDimensions:function(){var e,t,n,s;return null==a&&(e=y.createElement("table"),t=y.createElement("tr"),n=y.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",fe.appendChild(e).appendChild(t).appendChild(n),s=i.getComputedStyle(t),a=parseInt(s.height,10)+parseInt(s.borderTopWidth,10)+parseInt(s.borderBottomWidth,10)===t.offsetHeight,fe.removeChild(e)),a}}))}();var tt=["Webkit","Moz","ms"],nt=y.createElement("div").style,it={};function st(e){var t=O.cssProps[e]||it[e];return t||(e in nt?e:it[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=tt.length;n--;)if((e=tt[n]+t)in nt)return e}(e)||e)}var rt=/^(none|table(?!-c[ea]).+)/,ot={position:"absolute",visibility:"hidden",display:"block"},at={letterSpacing:"0",fontWeight:"400"};function lt(e,t,n){var i=pe.exec(t);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):t}function ut(e,t,n,i,s,r){var o="width"===t?1:0,a=0,l=0,u=0;if(n===(i?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(u+=O.css(e,n+ge[o],!0,s)),i?("content"===n&&(l-=O.css(e,"padding"+ge[o],!0,s)),"margin"!==n&&(l-=O.css(e,"border"+ge[o]+"Width",!0,s))):(l+=O.css(e,"padding"+ge[o],!0,s),"padding"!==n?l+=O.css(e,"border"+ge[o]+"Width",!0,s):a+=O.css(e,"border"+ge[o]+"Width",!0,s));return!i&&r>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-r-l-a-.5))||0),l+u}function ht(e,t,n){var i=Ke(e),s=(!m.boxSizingReliable()||n)&&"border-box"===O.css(e,"boxSizing",!1,i),r=s,o=Qe(e,t,i),a="offset"+t[0].toUpperCase()+t.slice(1);if(We.test(o)){if(!n)return o;o="auto"}return(!m.boxSizingReliable()&&s||!m.reliableTrDimensions()&&C(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===O.css(e,"display",!1,i))&&e.getClientRects().length&&(s="border-box"===O.css(e,"boxSizing",!1,i),(r=a in e)&&(o=e[a])),(o=parseFloat(o)||0)+ut(e,t,n||(s?"border":"content"),r,i,o)+"px"}function ct(e,t,n,i,s){return new ct.prototype.init(e,t,n,i,s)}O.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Qe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,r,o,a=se(t),l=$e.test(t),u=e.style;if(l||(t=st(a)),o=O.cssHooks[t]||O.cssHooks[a],void 0===n)return o&&"get"in o&&void 0!==(s=o.get(e,!1,i))?s:u[t];"string"===(r=typeof n)&&(s=pe.exec(n))&&s[1]&&(n=ye(e,t,s),r="number"),null!=n&&n==n&&("number"!==r||l||(n+=s&&s[3]||(O.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),o&&"set"in o&&void 0===(n=o.set(e,n,i))||(l?u.setProperty(t,n):u[t]=n))}},css:function(e,t,n,i){var s,r,o,a=se(t);return $e.test(t)||(t=st(a)),(o=O.cssHooks[t]||O.cssHooks[a])&&"get"in o&&(s=o.get(e,!0,n)),void 0===s&&(s=Qe(e,t,i)),"normal"===s&&t in at&&(s=at[t]),""===n||n?(r=parseFloat(s),!0===n||isFinite(r)?r||0:s):s}}),O.each(["height","width"],(function(e,t){O.cssHooks[t]={get:function(e,n,i){if(n)return!rt.test(O.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ht(e,t,i):Je(e,ot,(function(){return ht(e,t,i)}))},set:function(e,n,i){var s,r=Ke(e),o=!m.scrollboxSize()&&"absolute"===r.position,a=(o||i)&&"border-box"===O.css(e,"boxSizing",!1,r),l=i?ut(e,t,i,a,r):0;return a&&o&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(r[t])-ut(e,t,"border",!1,r)-.5)),l&&(s=pe.exec(n))&&"px"!==(s[3]||"px")&&(e.style[t]=n,n=O.css(e,t)),lt(0,n,l)}}})),O.cssHooks.marginLeft=et(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Qe(e,"marginLeft"))||e.getBoundingClientRect().left-Je(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),O.each({margin:"",padding:"",border:"Width"},(function(e,t){O.cssHooks[e+t]={expand:function(n){for(var i=0,s={},r="string"==typeof n?n.split(" "):[n];i<4;i++)s[e+ge[i]+t]=r[i]||r[i-2]||r[0];return s}},"margin"!==e&&(O.cssHooks[e+t].set=lt)})),O.fn.extend({css:function(e,t){return ee(this,(function(e,t,n){var i,s,r={},o=0;if(Array.isArray(t)){for(i=Ke(e),s=t.length;o<s;o++)r[t[o]]=O.css(e,t[o],!1,i);return r}return void 0!==n?O.style(e,t,n):O.css(e,t)}),e,t,arguments.length>1)}}),O.Tween=ct,ct.prototype={constructor:ct,init:function(e,t,n,i,s,r){this.elem=e,this.prop=n,this.easing=s||O.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=r||(O.cssNumber[n]?"":"px")},cur:function(){var e=ct.propHooks[this.prop];return e&&e.get?e.get(this):ct.propHooks._default.get(this)},run:function(e){var t,n=ct.propHooks[this.prop];return this.options.duration?this.pos=t=O.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ct.propHooks._default.set(this),this}},ct.prototype.init.prototype=ct.prototype,ct.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=O.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){O.fx.step[e.prop]?O.fx.step[e.prop](e):1!==e.elem.nodeType||!O.cssHooks[e.prop]&&null==e.elem.style[st(e.prop)]?e.elem[e.prop]=e.now:O.style(e.elem,e.prop,e.now+e.unit)}}},ct.propHooks.scrollTop=ct.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},O.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},O.fx=ct.prototype.init,O.fx.step={};var dt,pt,gt=/^(?:toggle|show|hide)$/,ft=/queueHooks$/;function mt(){pt&&(!1===y.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(mt):i.setTimeout(mt,O.fx.interval),O.fx.tick())}function _t(){return i.setTimeout((function(){dt=void 0})),dt=Date.now()}function xt(e,t){var n,i=0,s={height:e};for(t=t?1:0;i<4;i+=2-t)s["margin"+(n=ge[i])]=s["padding"+n]=e;return t&&(s.opacity=s.width=e),s}function yt(e,t,n){for(var i,s=(wt.tweeners[t]||[]).concat(wt.tweeners["*"]),r=0,o=s.length;r<o;r++)if(i=s[r].call(n,t,e))return i}function wt(e,t,n){var i,s,r=0,o=wt.prefilters.length,a=O.Deferred().always((function(){delete l.elem})),l=function(){if(s)return!1;for(var t=dt||_t(),n=Math.max(0,u.startTime+u.duration-t),i=1-(n/u.duration||0),r=0,o=u.tweens.length;r<o;r++)u.tweens[r].run(i);return a.notifyWith(e,[u,i,n]),i<1&&o?n:(o||a.notifyWith(e,[u,1,0]),a.resolveWith(e,[u]),!1)},u=a.promise({elem:e,props:O.extend({},t),opts:O.extend(!0,{specialEasing:{},easing:O.easing._default},n),originalProperties:t,originalOptions:n,startTime:dt||_t(),duration:n.duration,tweens:[],createTween:function(t,n){var i=O.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(i),i},stop:function(t){var n=0,i=t?u.tweens.length:0;if(s)return this;for(s=!0;n<i;n++)u.tweens[n].run(1);return t?(a.notifyWith(e,[u,1,0]),a.resolveWith(e,[u,t])):a.rejectWith(e,[u,t]),this}}),h=u.props;for(!function(e,t){var n,i,s,r,o;for(n in e)if(s=t[i=se(n)],r=e[n],Array.isArray(r)&&(s=r[1],r=e[n]=r[0]),n!==i&&(e[i]=r,delete e[n]),(o=O.cssHooks[i])&&"expand"in o)for(n in r=o.expand(r),delete e[i],r)n in e||(e[n]=r[n],t[n]=s);else t[i]=s}(h,u.opts.specialEasing);r<o;r++)if(i=wt.prefilters[r].call(u,e,h,u.opts))return _(i.stop)&&(O._queueHooks(u.elem,u.opts.queue).stop=i.stop.bind(i)),i;return O.map(h,yt,u),_(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),O.fx.timer(O.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u}O.Animation=O.extend(wt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ye(n.elem,e,pe.exec(t),n),n}]},tweener:function(e,t){_(e)?(t=e,e=["*"]):e=e.match(Y);for(var n,i=0,s=e.length;i<s;i++)n=e[i],wt.tweeners[n]=wt.tweeners[n]||[],wt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var i,s,r,o,a,l,u,h,c="width"in t||"height"in t,d=this,p={},g=e.style,f=e.nodeType&&xe(e),m=ae.get(e,"fxshow");for(i in n.queue||(null==(o=O._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,d.always((function(){d.always((function(){o.unqueued--,O.queue(e,"fx").length||o.empty.fire()}))}))),t)if(s=t[i],gt.test(s)){if(delete t[i],r=r||"toggle"===s,s===(f?"hide":"show")){if("show"!==s||!m||void 0===m[i])continue;f=!0}p[i]=m&&m[i]||O.style(e,i)}if((l=!O.isEmptyObject(t))||!O.isEmptyObject(p))for(i in c&&1===e.nodeType&&(n.overflow=[g.overflow,g.overflowX,g.overflowY],null==(u=m&&m.display)&&(u=ae.get(e,"display")),"none"===(h=O.css(e,"display"))&&(u?h=u:(Se([e],!0),u=e.style.display||u,h=O.css(e,"display"),Se([e]))),("inline"===h||"inline-block"===h&&null!=u)&&"none"===O.css(e,"float")&&(l||(d.done((function(){g.display=u})),null==u&&(h=g.display,u="none"===h?"":h)),g.display="inline-block")),n.overflow&&(g.overflow="hidden",d.always((function(){g.overflow=n.overflow[0],g.overflowX=n.overflow[1],g.overflowY=n.overflow[2]}))),l=!1,p)l||(m?"hidden"in m&&(f=m.hidden):m=ae.access(e,"fxshow",{display:u}),r&&(m.hidden=!f),f&&Se([e],!0),d.done((function(){for(i in f||Se([e]),ae.remove(e,"fxshow"),p)O.style(e,i,p[i])}))),l=yt(f?m[i]:0,i,d),i in m||(m[i]=l.start,f&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?wt.prefilters.unshift(e):wt.prefilters.push(e)}}),O.speed=function(e,t,n){var i=e&&"object"==typeof e?O.extend({},e):{complete:n||!n&&t||_(e)&&e,duration:e,easing:n&&t||t&&!_(t)&&t};return O.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in O.fx.speeds?i.duration=O.fx.speeds[i.duration]:i.duration=O.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){_(i.old)&&i.old.call(this),i.queue&&O.dequeue(this,i.queue)},i},O.fn.extend({fadeTo:function(e,t,n,i){return this.filter(xe).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var s=O.isEmptyObject(e),r=O.speed(t,n,i),o=function(){var t=wt(this,O.extend({},e),r);(s||ae.get(this,"finish"))&&t.stop(!0)};return o.finish=o,s||!1===r.queue?this.each(o):this.queue(r.queue,o)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,s=null!=e&&e+"queueHooks",r=O.timers,o=ae.get(this);if(s)o[s]&&o[s].stop&&i(o[s]);else for(s in o)o[s]&&o[s].stop&&ft.test(s)&&i(o[s]);for(s=r.length;s--;)r[s].elem!==this||null!=e&&r[s].queue!==e||(r[s].anim.stop(n),t=!1,r.splice(s,1));!t&&n||O.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=ae.get(this),i=n[e+"queue"],s=n[e+"queueHooks"],r=O.timers,o=i?i.length:0;for(n.finish=!0,O.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<o;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish}))}}),O.each(["toggle","show","hide"],(function(e,t){var n=O.fn[t];O.fn[t]=function(e,i,s){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(xt(t,!0),e,i,s)}})),O.each({slideDown:xt("show"),slideUp:xt("hide"),slideToggle:xt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){O.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}})),O.timers=[],O.fx.tick=function(){var e,t=0,n=O.timers;for(dt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||O.fx.stop(),dt=void 0},O.fx.timer=function(e){O.timers.push(e),O.fx.start()},O.fx.interval=13,O.fx.start=function(){pt||(pt=!0,mt())},O.fx.stop=function(){pt=null},O.fx.speeds={slow:600,fast:200,_default:400},O.fn.delay=function(e,t){return e=O.fx&&O.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,n){var s=i.setTimeout(t,e);n.stop=function(){i.clearTimeout(s)}}))},function(){var e=y.createElement("input"),t=y.createElement("select").appendChild(y.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=y.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var bt,St=O.expr.attrHandle;O.fn.extend({attr:function(e,t){return ee(this,O.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){O.removeAttr(this,e)}))}}),O.extend({attr:function(e,t,n){var i,s,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===e.getAttribute?O.prop(e,t,n):(1===r&&O.isXMLDoc(e)||(s=O.attrHooks[t.toLowerCase()]||(O.expr.match.bool.test(t)?bt:void 0)),void 0!==n?null===n?void O.removeAttr(e,t):s&&"set"in s&&void 0!==(i=s.set(e,n,t))?i:(e.setAttribute(t,n+""),n):s&&"get"in s&&null!==(i=s.get(e,t))?i:null==(i=O.find.attr(e,t))?void 0:i)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&C(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,i=0,s=t&&t.match(Y);if(s&&1===e.nodeType)for(;n=s[i++];)e.removeAttribute(n)}}),bt={set:function(e,t,n){return!1===t?O.removeAttr(e,n):e.setAttribute(n,n),n}},O.each(O.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=St[t]||O.find.attr;St[t]=function(e,t,i){var s,r,o=t.toLowerCase();return i||(r=St[o],St[o]=s,s=null!=n(e,t,i)?o:null,St[o]=r),s}}));var vt=/^(?:input|select|textarea|button)$/i,Tt=/^(?:a|area)$/i;function Ot(e){return(e.match(Y)||[]).join(" ")}function Et(e){return e.getAttribute&&e.getAttribute("class")||""}function Ct(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(Y)||[]}O.fn.extend({prop:function(e,t){return ee(this,O.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[O.propFix[e]||e]}))}}),O.extend({prop:function(e,t,n){var i,s,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&O.isXMLDoc(e)||(t=O.propFix[t]||t,s=O.propHooks[t]),void 0!==n?s&&"set"in s&&void 0!==(i=s.set(e,n,t))?i:e[t]=n:s&&"get"in s&&null!==(i=s.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=O.find.attr(e,"tabindex");return t?parseInt(t,10):vt.test(e.nodeName)||Tt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(O.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),O.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){O.propFix[this.toLowerCase()]=this})),O.fn.extend({addClass:function(e){var t,n,i,s,r,o;return _(e)?this.each((function(t){O(this).addClass(e.call(this,t,Et(this)))})):(t=Ct(e)).length?this.each((function(){if(i=Et(this),n=1===this.nodeType&&" "+Ot(i)+" "){for(r=0;r<t.length;r++)s=t[r],n.indexOf(" "+s+" ")<0&&(n+=s+" ");o=Ot(n),i!==o&&this.setAttribute("class",o)}})):this},removeClass:function(e){var t,n,i,s,r,o;return _(e)?this.each((function(t){O(this).removeClass(e.call(this,t,Et(this)))})):arguments.length?(t=Ct(e)).length?this.each((function(){if(i=Et(this),n=1===this.nodeType&&" "+Ot(i)+" "){for(r=0;r<t.length;r++)for(s=t[r];n.indexOf(" "+s+" ")>-1;)n=n.replace(" "+s+" "," ");o=Ot(n),i!==o&&this.setAttribute("class",o)}})):this:this.attr("class","")},toggleClass:function(e,t){var n,i,s,r,o=typeof e,a="string"===o||Array.isArray(e);return _(e)?this.each((function(n){O(this).toggleClass(e.call(this,n,Et(this),t),t)})):"boolean"==typeof t&&a?t?this.addClass(e):this.removeClass(e):(n=Ct(e),this.each((function(){if(a)for(r=O(this),s=0;s<n.length;s++)i=n[s],r.hasClass(i)?r.removeClass(i):r.addClass(i);else void 0!==e&&"boolean"!==o||((i=Et(this))&&ae.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",i||!1===e?"":ae.get(this,"__className__")||""))})))},hasClass:function(e){var t,n,i=0;for(t=" "+e+" ";n=this[i++];)if(1===n.nodeType&&(" "+Ot(Et(n))+" ").indexOf(t)>-1)return!0;return!1}});var Nt=/\r/g;O.fn.extend({val:function(e){var t,n,i,s=this[0];return arguments.length?(i=_(e),this.each((function(n){var s;1===this.nodeType&&(null==(s=i?e.call(this,n,O(this).val()):e)?s="":"number"==typeof s?s+="":Array.isArray(s)&&(s=O.map(s,(function(e){return null==e?"":e+""}))),(t=O.valHooks[this.type]||O.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s))}))):s?(t=O.valHooks[s.type]||O.valHooks[s.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(s,"value"))?n:"string"==typeof(n=s.value)?n.replace(Nt,""):null==n?"":n:void 0}}),O.extend({valHooks:{option:{get:function(e){var t=O.find.attr(e,"value");return null!=t?t:Ot(O.text(e))}},select:{get:function(e){var t,n,i,s=e.options,r=e.selectedIndex,o="select-one"===e.type,a=o?null:[],l=o?r+1:s.length;for(i=r<0?l:o?r:0;i<l;i++)if(((n=s[i]).selected||i===r)&&!n.disabled&&(!n.parentNode.disabled||!C(n.parentNode,"optgroup"))){if(t=O(n).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var n,i,s=e.options,r=O.makeArray(t),o=s.length;o--;)((i=s[o]).selected=O.inArray(O.valHooks.option.get(i),r)>-1)&&(n=!0);return n||(e.selectedIndex=-1),r}}}}),O.each(["radio","checkbox"],(function(){O.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=O.inArray(O(e).val(),t)>-1}},m.checkOn||(O.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}));var Ft=i.location,It={guid:Date.now()},Mt=/\?/;O.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new i.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||O.error("Invalid XML: "+(n?O.map(n.childNodes,(function(e){return e.textContent})).join("\n"):e)),t};var Pt=/^(?:focusinfocus|focusoutblur)$/,Dt=function(e){e.stopPropagation()};O.extend(O.event,{trigger:function(e,t,n,s){var r,o,a,l,u,h,c,d,g=[n||y],f=p.call(e,"type")?e.type:e,m=p.call(e,"namespace")?e.namespace.split("."):[];if(o=d=a=n=n||y,3!==n.nodeType&&8!==n.nodeType&&!Pt.test(f+O.event.triggered)&&(f.indexOf(".")>-1&&(m=f.split("."),f=m.shift(),m.sort()),u=f.indexOf(":")<0&&"on"+f,(e=e[O.expando]?e:new O.Event(f,"object"==typeof e&&e)).isTrigger=s?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:O.makeArray(t,[e]),c=O.event.special[f]||{},s||!c.trigger||!1!==c.trigger.apply(n,t))){if(!s&&!c.noBubble&&!x(n)){for(l=c.delegateType||f,Pt.test(l+f)||(o=o.parentNode);o;o=o.parentNode)g.push(o),a=o;a===(n.ownerDocument||y)&&g.push(a.defaultView||a.parentWindow||i)}for(r=0;(o=g[r++])&&!e.isPropagationStopped();)d=o,e.type=r>1?l:c.bindType||f,(h=(ae.get(o,"events")||Object.create(null))[e.type]&&ae.get(o,"handle"))&&h.apply(o,t),(h=u&&o[u])&&h.apply&&re(o)&&(e.result=h.apply(o,t),!1===e.result&&e.preventDefault());return e.type=f,s||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(g.pop(),t)||!re(n)||u&&_(n[f])&&!x(n)&&((a=n[u])&&(n[u]=null),O.event.triggered=f,e.isPropagationStopped()&&d.addEventListener(f,Dt),n[f](),e.isPropagationStopped()&&d.removeEventListener(f,Dt),O.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var i=O.extend(new O.Event,n,{type:e,isSimulated:!0});O.event.trigger(i,null,t)}}),O.fn.extend({trigger:function(e,t){return this.each((function(){O.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return O.event.trigger(e,t,n,!0)}});var Rt=/\[\]$/,At=/\r?\n/g,Vt=/^(?:submit|button|image|reset|file)$/i,Lt=/^(?:input|select|textarea|keygen)/i;function Bt(e,t,n,i){var s;if(Array.isArray(t))O.each(t,(function(t,s){n||Rt.test(e)?i(e,s):Bt(e+"["+("object"==typeof s&&null!=s?t:"")+"]",s,n,i)}));else if(n||"object"!==S(t))i(e,t);else for(s in t)Bt(e+"["+s+"]",t[s],n,i)}O.param=function(e,t){var n,i=[],s=function(e,t){var n=_(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!O.isPlainObject(e))O.each(e,(function(){s(this.name,this.value)}));else for(n in e)Bt(n,e[n],t,s);return i.join("&")},O.fn.extend({serialize:function(){return O.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=O.prop(this,"elements");return e?O.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!O(this).is(":disabled")&&Lt.test(this.nodeName)&&!Vt.test(e)&&(this.checked||!Oe.test(e))})).map((function(e,t){var n=O(this).val();return null==n?null:Array.isArray(n)?O.map(n,(function(e){return{name:t.name,value:e.replace(At,"\r\n")}})):{name:t.name,value:n.replace(At,"\r\n")}})).get()}});var Ut=/%20/g,Xt=/#.*$/,jt=/([?&])_=[^&]*/,kt=/^(.*?):[ \t]*([^\r\n]*)$/gm,zt=/^(?:GET|HEAD)$/,Gt=/^\/\//,Ht={},qt={},Yt="*/".concat("*"),Wt=y.createElement("a");function $t(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,s=0,r=t.toLowerCase().match(Y)||[];if(_(n))for(;i=r[s++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function Kt(e,t,n,i){var s={},r=e===qt;function o(a){var l;return s[a]=!0,O.each(e[a]||[],(function(e,a){var u=a(t,n,i);return"string"!=typeof u||r||s[u]?r?!(l=u):void 0:(t.dataTypes.unshift(u),o(u),!1)})),l}return o(t.dataTypes[0])||!s["*"]&&o("*")}function Jt(e,t){var n,i,s=O.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((s[n]?e:i||(i={}))[n]=t[n]);return i&&O.extend(!0,e,i),e}Wt.href=Ft.href,O.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ft.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ft.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Yt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":O.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Jt(Jt(e,O.ajaxSettings),t):Jt(O.ajaxSettings,e)},ajaxPrefilter:$t(Ht),ajaxTransport:$t(qt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,s,r,o,a,l,u,h,c,d,p=O.ajaxSetup({},t),g=p.context||p,f=p.context&&(g.nodeType||g.jquery)?O(g):O.event,m=O.Deferred(),_=O.Callbacks("once memory"),x=p.statusCode||{},w={},b={},S="canceled",v={readyState:0,getResponseHeader:function(e){var t;if(u){if(!o)for(o={};t=kt.exec(r);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?r:null},setRequestHeader:function(e,t){return null==u&&(e=b[e.toLowerCase()]=b[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==u&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)v.always(e[v.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||S;return n&&n.abort(t),T(0,t),this}};if(m.promise(v),p.url=((e||p.url||Ft.href)+"").replace(Gt,Ft.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(Y)||[""],null==p.crossDomain){l=y.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Wt.protocol+"//"+Wt.host!=l.protocol+"//"+l.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=O.param(p.data,p.traditional)),Kt(Ht,p,t,v),u)return v;for(c in(h=O.event&&p.global)&&0==O.active++&&O.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!zt.test(p.type),s=p.url.replace(Xt,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Ut,"+")):(d=p.url.slice(s.length),p.data&&(p.processData||"string"==typeof p.data)&&(s+=(Mt.test(s)?"&":"?")+p.data,delete p.data),!1===p.cache&&(s=s.replace(jt,"$1"),d=(Mt.test(s)?"&":"?")+"_="+It.guid+++d),p.url=s+d),p.ifModified&&(O.lastModified[s]&&v.setRequestHeader("If-Modified-Since",O.lastModified[s]),O.etag[s]&&v.setRequestHeader("If-None-Match",O.etag[s])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&v.setRequestHeader("Content-Type",p.contentType),v.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Yt+"; q=0.01":""):p.accepts["*"]),p.headers)v.setRequestHeader(c,p.headers[c]);if(p.beforeSend&&(!1===p.beforeSend.call(g,v,p)||u))return v.abort();if(S="abort",_.add(p.complete),v.done(p.success),v.fail(p.error),n=Kt(qt,p,t,v)){if(v.readyState=1,h&&f.trigger("ajaxSend",[v,p]),u)return v;p.async&&p.timeout>0&&(a=i.setTimeout((function(){v.abort("timeout")}),p.timeout));try{u=!1,n.send(w,T)}catch(e){if(u)throw e;T(-1,e)}}else T(-1,"No Transport");function T(e,t,o,l){var c,d,y,w,b,S=t;u||(u=!0,a&&i.clearTimeout(a),n=void 0,r=l||"",v.readyState=e>0?4:0,c=e>=200&&e<300||304===e,o&&(w=function(e,t,n){for(var i,s,r,o,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){l.unshift(s);break}if(l[0]in n)r=l[0];else{for(s in n){if(!l[0]||e.converters[s+" "+l[0]]){r=s;break}o||(o=s)}r=r||o}if(r)return r!==l[0]&&l.unshift(r),n[r]}(p,v,o)),!c&&O.inArray("script",p.dataTypes)>-1&&O.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),w=function(e,t,n,i){var s,r,o,a,l,u={},h=e.dataTypes.slice();if(h[1])for(o in e.converters)u[o.toLowerCase()]=e.converters[o];for(r=h.shift();r;)if(e.responseFields[r]&&(n[e.responseFields[r]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=r,r=h.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(!(o=u[l+" "+r]||u["* "+r]))for(s in u)if((a=s.split(" "))[1]===r&&(o=u[l+" "+a[0]]||u["* "+a[0]])){!0===o?o=u[s]:!0!==u[s]&&(r=a[0],h.unshift(a[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+l+" to "+r}}}return{state:"success",data:t}}(p,w,v,c),c?(p.ifModified&&((b=v.getResponseHeader("Last-Modified"))&&(O.lastModified[s]=b),(b=v.getResponseHeader("etag"))&&(O.etag[s]=b)),204===e||"HEAD"===p.type?S="nocontent":304===e?S="notmodified":(S=w.state,d=w.data,c=!(y=w.error))):(y=S,!e&&S||(S="error",e<0&&(e=0))),v.status=e,v.statusText=(t||S)+"",c?m.resolveWith(g,[d,S,v]):m.rejectWith(g,[v,S,y]),v.statusCode(x),x=void 0,h&&f.trigger(c?"ajaxSuccess":"ajaxError",[v,p,c?d:y]),_.fireWith(g,[v,S]),h&&(f.trigger("ajaxComplete",[v,p]),--O.active||O.event.trigger("ajaxStop")))}return v},getJSON:function(e,t,n){return O.get(e,t,n,"json")},getScript:function(e,t){return O.get(e,void 0,t,"script")}}),O.each(["get","post"],(function(e,t){O[t]=function(e,n,i,s){return _(n)&&(s=s||i,i=n,n=void 0),O.ajax(O.extend({url:e,type:t,dataType:s,data:n,success:i},O.isPlainObject(e)&&e))}})),O.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),O._evalUrl=function(e,t,n){return O.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){O.globalEval(e,t,n)}})},O.fn.extend({wrapAll:function(e){var t;return this[0]&&(_(e)&&(e=e.call(this[0])),t=O(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return _(e)?this.each((function(t){O(this).wrapInner(e.call(this,t))})):this.each((function(){var t=O(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=_(e);return this.each((function(n){O(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){O(this).replaceWith(this.childNodes)})),this}}),O.expr.pseudos.hidden=function(e){return!O.expr.pseudos.visible(e)},O.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},O.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(e){}};var Zt={0:200,1223:204},Qt=O.ajaxSettings.xhr();m.cors=!!Qt&&"withCredentials"in Qt,m.ajax=Qt=!!Qt,O.ajaxTransport((function(e){var t,n;if(m.cors||Qt&&!e.crossDomain)return{send:function(s,r){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];for(o in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest"),s)a.setRequestHeader(o,s[o]);t=function(e){return function(){t&&(t=n=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?r(0,"error"):r(a.status,a.statusText):r(Zt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),n=a.onerror=a.ontimeout=t("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){t&&n()}))},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),O.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),O.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return O.globalEval(e),e}}}),O.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),O.ajaxTransport("script",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(i,s){t=O("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&s("error"===e.type?404:200,e.type)}),y.head.appendChild(t[0])},abort:function(){n&&n()}}}));var en,tn=[],nn=/(=)\?(?=&|$)|\?\?/;O.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tn.pop()||O.expando+"_"+It.guid++;return this[e]=!0,e}}),O.ajaxPrefilter("json jsonp",(function(e,t,n){var s,r,o,a=!1!==e.jsonp&&(nn.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&nn.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return s=e.jsonpCallback=_(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(nn,"$1"+s):!1!==e.jsonp&&(e.url+=(Mt.test(e.url)?"&":"?")+e.jsonp+"="+s),e.converters["script json"]=function(){return o||O.error(s+" was not called"),o[0]},e.dataTypes[0]="json",r=i[s],i[s]=function(){o=arguments},n.always((function(){void 0===r?O(i).removeProp(s):i[s]=r,e[s]&&(e.jsonpCallback=t.jsonpCallback,tn.push(s)),o&&_(r)&&r(o[0]),o=r=void 0})),"script"})),m.createHTMLDocument=((en=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===en.childNodes.length),O.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(m.createHTMLDocument?((i=(t=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,t.head.appendChild(i)):t=y),r=!n&&[],(s=X.exec(e))?[t.createElement(s[1])]:(s=Pe([e],t,r),r&&r.length&&O(r).remove(),O.merge([],s.childNodes)));var i,s,r},O.fn.load=function(e,t,n){var i,s,r,o=this,a=e.indexOf(" ");return a>-1&&(i=Ot(e.slice(a)),e=e.slice(0,a)),_(t)?(n=t,t=void 0):t&&"object"==typeof t&&(s="POST"),o.length>0&&O.ajax({url:e,type:s||"GET",dataType:"html",data:t}).done((function(e){r=arguments,o.html(i?O("<div>").append(O.parseHTML(e)).find(i):e)})).always(n&&function(e,t){o.each((function(){n.apply(this,r||[e.responseText,t,e])}))}),this},O.expr.pseudos.animated=function(e){return O.grep(O.timers,(function(t){return e===t.elem})).length},O.offset={setOffset:function(e,t,n){var i,s,r,o,a,l,u=O.css(e,"position"),h=O(e),c={};"static"===u&&(e.style.position="relative"),a=h.offset(),r=O.css(e,"top"),l=O.css(e,"left"),("absolute"===u||"fixed"===u)&&(r+l).indexOf("auto")>-1?(o=(i=h.position()).top,s=i.left):(o=parseFloat(r)||0,s=parseFloat(l)||0),_(t)&&(t=t.call(e,n,O.extend({},a))),null!=t.top&&(c.top=t.top-a.top+o),null!=t.left&&(c.left=t.left-a.left+s),"using"in t?t.using.call(e,c):h.css(c)}},O.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){O.offset.setOffset(this,e,t)}));var t,n,i=this[0];return i?i.getClientRects().length?(t=i.getBoundingClientRect(),n=i.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,i=this[0],s={top:0,left:0};if("fixed"===O.css(i,"position"))t=i.getBoundingClientRect();else{for(t=this.offset(),n=i.ownerDocument,e=i.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===O.css(e,"position");)e=e.parentNode;e&&e!==i&&1===e.nodeType&&((s=O(e).offset()).top+=O.css(e,"borderTopWidth",!0),s.left+=O.css(e,"borderLeftWidth",!0))}return{top:t.top-s.top-O.css(i,"marginTop",!0),left:t.left-s.left-O.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===O.css(e,"position");)e=e.offsetParent;return e||fe}))}}),O.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;O.fn[e]=function(i){return ee(this,(function(e,i,s){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===s)return r?r[t]:e[i];r?r.scrollTo(n?r.pageXOffset:s,n?s:r.pageYOffset):e[i]=s}),e,i,arguments.length)}})),O.each(["top","left"],(function(e,t){O.cssHooks[t]=et(m.pixelPosition,(function(e,n){if(n)return n=Qe(e,t),We.test(n)?O(e).position()[t]+"px":n}))})),O.each({Height:"height",Width:"width"},(function(e,t){O.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,i){O.fn[i]=function(s,r){var o=arguments.length&&(n||"boolean"!=typeof s),a=n||(!0===s||!0===r?"margin":"border");return ee(this,(function(t,n,s){var r;return x(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===s?O.css(t,n,a):O.style(t,n,s,a)}),t,o?s:void 0,o)}}))})),O.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){O.fn[t]=function(e){return this.on(t,e)}})),O.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),O.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){O.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var sn=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;O.proxy=function(e,t){var n,i,s;if("string"==typeof t&&(n=e[t],t=e,e=n),_(e))return i=a.call(arguments,2),s=function(){return e.apply(t||this,i.concat(a.call(arguments)))},s.guid=e.guid=e.guid||O.guid++,s},O.holdReady=function(e){e?O.readyWait++:O.ready(!0)},O.isArray=Array.isArray,O.parseJSON=JSON.parse,O.nodeName=C,O.isFunction=_,O.isWindow=x,O.camelCase=se,O.type=S,O.now=Date.now,O.isNumeric=function(e){var t=O.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},O.trim=function(e){return null==e?"":(e+"").replace(sn,"$1")},void 0===(n=function(){return O}.apply(t,[]))||(e.exports=n);var rn=i.jQuery,on=i.$;return O.noConflict=function(e){return i.$===O&&(i.$=on),e&&i.jQuery===O&&(i.jQuery=rn),O},void 0===s&&(i.jQuery=i.$=O),O}))},132:e=>{var t={DEBUG:!1,assert:function(e,n){if(t.DEBUG&&!e)throw new Error("Assertion failed"+(n?": "+n:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901}};t.PQHandle,t.geom={},t.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},t.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},t.geom.edgeEval=function(e,t,n){var i=t.s-e.s,s=n.s-t.s;return i+s>0?i<s?t.t-e.t+(e.t-n.t)*(i/(i+s)):t.t-n.t+(n.t-e.t)*(s/(i+s)):0},t.geom.edgeSign=function(e,t,n){var i=t.s-e.s,s=n.s-t.s;return i+s>0?(t.t-n.t)*i+(t.t-e.t)*s:0},t.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},t.geom.transEval=function(e,t,n){var i=t.t-e.t,s=n.t-t.t;return i+s>0?i<s?t.s-e.s+(e.s-n.s)*(i/(i+s)):t.s-n.s+(n.s-e.s)*(s/(i+s)):0},t.geom.transSign=function(e,t,n){var i=t.t-e.t,s=n.t-t.t;return i+s>0?(t.s-n.s)*i+(t.s-e.s)*s:0},t.geom.edgeGoesLeft=function(e){return t.geom.vertLeq(e.dst(),e.org)},t.geom.edgeGoesRight=function(e){return t.geom.vertLeq(e.org,e.dst())},t.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},t.geom.vertCCW=function(e,t,n){return e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)>=0},t.geom.interpolate_=function(e,t,n,i){return(e=e<0?0:e)<=(n=n<0?0:n)?0===n?(t+i)/2:t+e/(e+n)*(i-t):i+n/(e+n)*(t-i)},t.geom.edgeIntersect=function(e,n,i,s,r){var o,a,l;t.geom.vertLeq(e,n)||(l=e,e=n,n=l),t.geom.vertLeq(i,s)||(l=i,i=s,s=l),t.geom.vertLeq(e,i)||(l=e,e=i,i=l,l=n,n=s,s=l),t.geom.vertLeq(i,n)?t.geom.vertLeq(n,s)?((o=t.geom.edgeEval(e,i,n))+(a=t.geom.edgeEval(i,n,s))<0&&(o=-o,a=-a),r.s=t.geom.interpolate_(o,i.s,a,n.s)):((o=t.geom.edgeSign(e,i,n))+(a=-t.geom.edgeSign(e,s,n))<0&&(o=-o,a=-a),r.s=t.geom.interpolate_(o,i.s,a,s.s)):r.s=(i.s+n.s)/2,t.geom.transLeq(e,n)||(l=e,e=n,n=l),t.geom.transLeq(i,s)||(l=i,i=s,s=l),t.geom.transLeq(e,i)||(l=e,e=i,i=l,l=n,n=s,s=l),t.geom.transLeq(i,n)?t.geom.transLeq(n,s)?((o=t.geom.transEval(e,i,n))+(a=t.geom.transEval(i,n,s))<0&&(o=-o,a=-a),r.t=t.geom.interpolate_(o,i.t,a,n.t)):((o=t.geom.transSign(e,i,n))+(a=-t.geom.transSign(e,s,n))<0&&(o=-o,a=-a),r.t=t.geom.interpolate_(o,i.t,a,s.t)):r.t=(i.t+n.t)/2},t.mesh={},t.mesh.makeEdge=function(e){var n=t.mesh.makeEdgePair_(e.eHead);return t.mesh.makeVertex_(n,e.vHead),t.mesh.makeVertex_(n.sym,e.vHead),t.mesh.makeFace_(n,e.fHead),n},t.mesh.meshSplice=function(e,n){var i=!1,s=!1;e!==n&&(n.org!==e.org&&(s=!0,t.mesh.killVertex_(n.org,e.org)),n.lFace!==e.lFace&&(i=!0,t.mesh.killFace_(n.lFace,e.lFace)),t.mesh.splice_(n,e),s||(t.mesh.makeVertex_(n,e.org),e.org.anEdge=e),i||(t.mesh.makeFace_(n,e.lFace),e.lFace.anEdge=e))},t.mesh.deleteEdge=function(e){var n=e.sym,i=!1;e.lFace!==e.rFace()&&(i=!0,t.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?t.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,t.mesh.splice_(e,e.oPrev()),i||t.mesh.makeFace_(e,e.lFace)),n.oNext===n?(t.mesh.killVertex_(n.org,null),t.mesh.killFace_(n.lFace,null)):(e.lFace.anEdge=n.oPrev(),n.org.anEdge=n.oNext,t.mesh.splice_(n,n.oPrev())),t.mesh.killEdge_(e)},t.mesh.addEdgeVertex=function(e){var n=t.mesh.makeEdgePair_(e),i=n.sym;return t.mesh.splice_(n,e.lNext),n.org=e.dst(),t.mesh.makeVertex_(i,n.org),n.lFace=i.lFace=e.lFace,n},t.mesh.splitEdge=function(e){var n=t.mesh.addEdgeVertex(e).sym;return t.mesh.splice_(e.sym,e.sym.oPrev()),t.mesh.splice_(e.sym,n),e.sym.org=n.org,n.dst().anEdge=n.sym,n.sym.lFace=e.rFace(),n.winding=e.winding,n.sym.winding=e.sym.winding,n},t.mesh.connect=function(e,n){var i=!1,s=t.mesh.makeEdgePair_(e),r=s.sym;return n.lFace!==e.lFace&&(i=!0,t.mesh.killFace_(n.lFace,e.lFace)),t.mesh.splice_(s,e.lNext),t.mesh.splice_(r,n),s.org=e.dst(),r.org=n.org,s.lFace=r.lFace=e.lFace,e.lFace.anEdge=r,i||t.mesh.makeFace_(s,e.lFace),s},t.mesh.zapFace=function(e){var n,i=e.anEdge,s=i.lNext;do{if(s=(n=s).lNext,n.lFace=null,null===n.rFace()){n.oNext===n?t.mesh.killVertex_(n.org,null):(n.org.anEdge=n.oNext,t.mesh.splice_(n,n.oPrev()));var r=n.sym;r.oNext===r?t.mesh.killVertex_(r.org,null):(r.org.anEdge=r.oNext,t.mesh.splice_(r,r.oPrev())),t.mesh.killEdge_(n)}}while(n!==i);var o=e.prev,a=e.next;a.prev=o,o.next=a},t.mesh.meshUnion=function(e,t){var n=e.fHead,i=e.vHead,s=e.eHead,r=t.fHead,o=t.vHead,a=t.eHead;return r.next!==r&&(n.prev.next=r.next,r.next.prev=n.prev,r.prev.next=n,n.prev=r.prev),o.next!==o&&(i.prev.next=o.next,o.next.prev=i.prev,o.prev.next=i,i.prev=o.prev),a.next!==a&&(s.sym.next.sym.next=a.next,a.next.sym.next=s.sym.next,a.sym.next.sym.next=s,s.sym.next=a.sym.next),e},t.mesh.deleteMesh=function(e){},t.mesh.makeEdgePair_=function(e){var n=new t.GluHalfEdge,i=new t.GluHalfEdge,s=e.sym.next;return i.next=s,s.sym.next=n,n.next=e,e.sym.next=i,n.sym=i,n.oNext=n,n.lNext=i,i.sym=n,i.oNext=i,i.lNext=n,n},t.mesh.splice_=function(e,t){var n=e.oNext,i=t.oNext;n.sym.lNext=t,i.sym.lNext=e,e.oNext=i,t.oNext=n},t.mesh.makeVertex_=function(e,n){var i=n.prev,s=new t.GluVertex(n,i);i.next=s,n.prev=s,s.anEdge=e;var r=e;do{r.org=s,r=r.oNext}while(r!==e)},t.mesh.makeFace_=function(e,n){var i=n.prev,s=new t.GluFace(n,i);i.next=s,n.prev=s,s.anEdge=e,s.inside=n.inside;var r=e;do{r.lFace=s,r=r.lNext}while(r!==e)},t.mesh.killEdge_=function(e){var t=e.next,n=e.sym.next;t.sym.next=n,n.sym.next=t},t.mesh.killVertex_=function(e,t){var n=e.anEdge,i=n;do{i.org=t,i=i.oNext}while(i!==n);var s=e.prev,r=e.next;r.prev=s,s.next=r},t.mesh.killFace_=function(e,t){var n=e.anEdge,i=n;do{i.lFace=t,i=i.lNext}while(i!==n);var s=e.prev,r=e.next;r.prev=s,s.next=r},t.normal={},t.normal.S_UNIT_X_=1,t.normal.S_UNIT_Y_=0,t.normal.projectPolygon=function(e,n,i,s){var r=!1,o=[n,i,s];0===n&&0===i&&0===s&&(t.normal.computeNormal_(e,o),r=!0);var a,l=t.normal.longAxis_(o),u=e.mesh.vHead;if(t.TRUE_PROJECT){t.normal.normalize_(o);var h=[0,0,0],c=[0,0,0];h[l]=0,h[(l+1)%3]=t.normal.S_UNIT_X_,h[(l+2)%3]=t.normal.S_UNIT_Y_;var d=t.normal.dot_(h,o);for(h[0]-=d*o[0],h[1]-=d*o[1],h[2]-=d*o[2],t.normal.normalize_(h),c[0]=o[1]*h[2]-o[2]*h[1],c[1]=o[2]*h[0]-o[0]*h[2],c[2]=o[0]*h[1]-o[1]*h[0],t.normal.normalize_(c),a=u.next;a!==u;a=a.next)a.s=t.normal.dot_(a.coords,h),a.t=t.normal.dot_(a.coords,c)}else{var p=(l+1)%3,g=(l+2)%3,f=o[l]>0?1:-1;for(a=u.next;a!==u;a=a.next)a.s=a.coords[p],a.t=f*a.coords[g]}r&&t.normal.checkOrientation_(e)},t.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},t.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},t.normal.computeNormal_=function(e,n){var i,s=[-2*t.GLU_TESS_MAX_COORD,-2*t.GLU_TESS_MAX_COORD,-2*t.GLU_TESS_MAX_COORD],r=[2*t.GLU_TESS_MAX_COORD,2*t.GLU_TESS_MAX_COORD,2*t.GLU_TESS_MAX_COORD],o=[],a=[],l=e.mesh.vHead;for(i=l.next;i!==l;i=i.next)for(var u=0;u<3;++u){var h=i.coords[u];h<r[u]&&(r[u]=h,a[u]=i),h>s[u]&&(s[u]=h,o[u]=i)}var c=0;if(s[1]-r[1]>s[0]-r[0]&&(c=1),s[2]-r[2]>s[c]-r[c]&&(c=2),r[c]>=s[c])return n[0]=0,n[1]=0,void(n[2]=1);var d=0,p=a[c],g=o[c],f=[0,0,0],m=[p.coords[0]-g.coords[0],p.coords[1]-g.coords[1],p.coords[2]-g.coords[2]],_=[0,0,0];for(i=l.next;i!==l;i=i.next){_[0]=i.coords[0]-g.coords[0],_[1]=i.coords[1]-g.coords[1],_[2]=i.coords[2]-g.coords[2],f[0]=m[1]*_[2]-m[2]*_[1],f[1]=m[2]*_[0]-m[0]*_[2],f[2]=m[0]*_[1]-m[1]*_[0];var x=f[0]*f[0]+f[1]*f[1]+f[2]*f[2];x>d&&(d=x,n[0]=f[0],n[1]=f[1],n[2]=f[2])}d<=0&&(n[0]=n[1]=n[2]=0,n[t.normal.longAxis_(m)]=1)},t.normal.checkOrientation_=function(e){for(var t=0,n=e.mesh.fHead,i=n.next;i!==n;i=i.next){var s=i.anEdge;if(!(s.winding<=0))do{t+=(s.org.s-s.dst().s)*(s.org.t+s.dst().t),s=s.lNext}while(s!==i.anEdge)}if(t<0)for(var r=e.mesh.vHead,o=r.next;o!==r;o=o.next)o.t=-o.t},t.render={},t.render.renderMesh=function(e,n,i){for(var s=!1,r=-1,o=n.fHead.prev;o!==n.fHead;o=o.prev)if(o.inside){s||(e.callBeginCallback(t.primitiveType.GL_TRIANGLES),s=!0);var a=o.anEdge;do{if(i){var l=a.rFace().inside?0:1;r!==l&&(r=l,e.callEdgeFlagCallback(!!r))}e.callVertexCallback(a.org.data),a=a.lNext}while(a!==o.anEdge)}s&&e.callEndCallback()},t.render.renderBoundary=function(e,n){for(var i=n.fHead.next;i!==n.fHead;i=i.next)if(i.inside){e.callBeginCallback(t.primitiveType.GL_LINE_LOOP);var s=i.anEdge;do{e.callVertexCallback(s.org.data),s=s.lNext}while(s!==i.anEdge);e.callEndCallback()}},t.sweep={},t.sweep.SENTINEL_COORD_=4*t.GLU_TESS_MAX_COORD,t.sweep.TOLERANCE_NONZERO_=!1,t.sweep.computeInterior=function(e){var n;for(e.fatalError=!1,t.sweep.removeDegenerateEdges_(e),t.sweep.initPriorityQ_(e),t.sweep.initEdgeDict_(e);null!==(n=e.pq.extractMin());){for(;;){var i=e.pq.minimum();if(null===i||!t.geom.vertEq(i,n))break;i=e.pq.extractMin(),t.sweep.spliceMergeVertices_(e,n.anEdge,i.anEdge)}t.sweep.sweepEvent_(e,n)}var s=e.dict.getMin().getKey();e.event=s.eUp.org,t.sweep.doneEdgeDict_(e),t.sweep.donePriorityQ_(e),t.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},t.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},t.sweep.edgeLeq_=function(e,n,i){var s=e.event,r=n.eUp,o=i.eUp;return r.dst()===s?o.dst()===s?t.geom.vertLeq(r.org,o.org)?t.geom.edgeSign(o.dst(),r.org,o.org)<=0:t.geom.edgeSign(r.dst(),o.org,r.org)>=0:t.geom.edgeSign(o.dst(),s,o.org)<=0:o.dst()===s?t.geom.edgeSign(r.dst(),s,r.org)>=0:t.geom.edgeEval(r.dst(),s,r.org)>=t.geom.edgeEval(o.dst(),s,o.org)},t.sweep.deleteRegion_=function(e,t){t.fixUpperEdge,t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},t.sweep.fixUpperEdge_=function(e,n){t.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,e.eUp=n,n.activeRegion=e},t.sweep.topLeftRegion_=function(e){var n=e.eUp.org;do{e=e.regionAbove()}while(e.eUp.org===n);if(e.fixUpperEdge){var i=t.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext);t.sweep.fixUpperEdge_(e,i),e=e.regionAbove()}return e},t.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},t.sweep.addRegionBelow_=function(e,n,i){var s=new t.ActiveRegion;return s.eUp=i,s.nodeUp=e.dict.insertBefore(n.nodeUp,s),i.activeRegion=s,s},t.sweep.isWindingInside_=function(e,n){switch(e.windingRule){case t.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&n);case t.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==n;case t.windingRule.GLU_TESS_WINDING_POSITIVE:return n>0;case t.windingRule.GLU_TESS_WINDING_NEGATIVE:return n<0;case t.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return n>=2||n<=-2}return!1},t.sweep.computeWinding_=function(e,n){n.windingNumber=n.regionAbove().windingNumber+n.eUp.winding,n.inside=t.sweep.isWindingInside_(e,n.windingNumber)},t.sweep.finishRegion_=function(e,n){var i=n.eUp,s=i.lFace;s.inside=n.inside,s.anEdge=i,t.sweep.deleteRegion_(e,n)},t.sweep.finishLeftRegions_=function(e,n,i){for(var s=n,r=n.eUp;s!==i;){s.fixUpperEdge=!1;var o=s.regionBelow(),a=o.eUp;if(a.org!==r.org){if(!o.fixUpperEdge){t.sweep.finishRegion_(e,s);break}a=t.mesh.connect(r.lPrev(),a.sym),t.sweep.fixUpperEdge_(o,a)}r.oNext!==a&&(t.mesh.meshSplice(a.oPrev(),a),t.mesh.meshSplice(r,a)),t.sweep.finishRegion_(e,s),r=o.eUp,s=o}return r},t.sweep.addRightEdges_=function(e,n,i,s,r,o){var a=!0,l=i;do{t.sweep.addRegionBelow_(e,n,l.sym),l=l.oNext}while(l!==s);null===r&&(r=n.regionBelow().eUp.rPrev());for(var u,h=n,c=r;(l=(u=h.regionBelow()).eUp.sym).org===c.org;)l.oNext!==c&&(t.mesh.meshSplice(l.oPrev(),l),t.mesh.meshSplice(c.oPrev(),l)),u.windingNumber=h.windingNumber-l.winding,u.inside=t.sweep.isWindingInside_(e,u.windingNumber),h.dirty=!0,!a&&t.sweep.checkForRightSplice_(e,h)&&(t.sweep.addWinding_(l,c),t.sweep.deleteRegion_(e,h),t.mesh.deleteEdge(c)),a=!1,h=u,c=l;h.dirty=!0,o&&t.sweep.walkDirtyRegions_(e,h)},t.sweep.callCombine_=function(e,n,i,s,r){var o=[n.coords[0],n.coords[1],n.coords[2]];n.data=null,n.data=e.callCombineCallback(o,i,s),null===n.data&&(r?e.fatalError||(e.callErrorCallback(t.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):n.data=i[0])},t.sweep.spliceMergeVertices_=function(e,n,i){var s=[null,null,null,null];s[0]=n.org.data,s[1]=i.org.data,t.sweep.callCombine_(e,n.org,s,[.5,.5,0,0],!1),t.mesh.meshSplice(n,i)},t.sweep.vertexWeights_=function(e,n,i,s,r){var o=t.geom.vertL1dist(n,e),a=t.geom.vertL1dist(i,e),l=r,u=r+1;s[l]=.5*a/(o+a),s[u]=.5*o/(o+a),e.coords[0]+=s[l]*n.coords[0]+s[u]*i.coords[0],e.coords[1]+=s[l]*n.coords[1]+s[u]*i.coords[1],e.coords[2]+=s[l]*n.coords[2]+s[u]*i.coords[2]},t.sweep.getIntersectData_=function(e,n,i,s,r,o){var a=[0,0,0,0],l=[i.data,s.data,r.data,o.data];n.coords[0]=n.coords[1]=n.coords[2]=0,t.sweep.vertexWeights_(n,i,s,a,0),t.sweep.vertexWeights_(n,r,o,a,2),t.sweep.callCombine_(e,n,l,a,!0)},t.sweep.checkForRightSplice_=function(e,n){var i=n.regionBelow(),s=n.eUp,r=i.eUp;if(t.geom.vertLeq(s.org,r.org)){if(t.geom.edgeSign(r.dst(),s.org,r.org)>0)return!1;t.geom.vertEq(s.org,r.org)?s.org!==r.org&&(e.pq.remove(s.org.pqHandle),t.sweep.spliceMergeVertices_(e,r.oPrev(),s)):(t.mesh.splitEdge(r.sym),t.mesh.meshSplice(s,r.oPrev()),n.dirty=i.dirty=!0)}else{if(t.geom.edgeSign(s.dst(),r.org,s.org)<0)return!1;n.regionAbove().dirty=n.dirty=!0,t.mesh.splitEdge(s.sym),t.mesh.meshSplice(r.oPrev(),s)}return!0},t.sweep.checkForLeftSplice_=function(e,n){var i,s=n.regionBelow(),r=n.eUp,o=s.eUp;if(t.geom.vertLeq(r.dst(),o.dst())){if(t.geom.edgeSign(r.dst(),o.dst(),r.org)<0)return!1;n.regionAbove().dirty=n.dirty=!0,i=t.mesh.splitEdge(r),t.mesh.meshSplice(o.sym,i),i.lFace.inside=n.inside}else{if(t.geom.edgeSign(o.dst(),r.dst(),o.org)>0)return!1;n.dirty=s.dirty=!0,i=t.mesh.splitEdge(o),t.mesh.meshSplice(r.lNext,o.sym),i.rFace().inside=n.inside}return!0},t.sweep.checkForIntersect_=function(e,n){var i=n.regionBelow(),s=n.eUp,r=i.eUp,o=s.org,a=r.org,l=s.dst(),u=r.dst(),h=new t.GluVertex;if(o===a)return!1;if(Math.min(o.t,l.t)>Math.max(a.t,u.t))return!1;if(t.geom.vertLeq(o,a)){if(t.geom.edgeSign(u,o,a)>0)return!1}else if(t.geom.edgeSign(l,a,o)<0)return!1;t.geom.edgeIntersect(l,o,u,a,h),t.geom.vertLeq(h,e.event)&&(h.s=e.event.s,h.t=e.event.t);var c=t.geom.vertLeq(o,a)?o:a;if(t.geom.vertLeq(c,h)&&(h.s=c.s,h.t=c.t),t.geom.vertEq(h,o)||t.geom.vertEq(h,a))return t.sweep.checkForRightSplice_(e,n),!1;if(!t.geom.vertEq(l,e.event)&&t.geom.edgeSign(l,e.event,h)>=0||!t.geom.vertEq(u,e.event)&&t.geom.edgeSign(u,e.event,h)<=0){if(u===e.event)return t.mesh.splitEdge(s.sym),t.mesh.meshSplice(r.sym,s),s=(n=t.sweep.topLeftRegion_(n)).regionBelow().eUp,t.sweep.finishLeftRegions_(e,n.regionBelow(),i),t.sweep.addRightEdges_(e,n,s.oPrev(),s,s,!0),!0;if(l===e.event){t.mesh.splitEdge(r.sym),t.mesh.meshSplice(s.lNext,r.oPrev()),i=n;var d=(n=t.sweep.topRightRegion_(n)).regionBelow().eUp.rPrev();return i.eUp=r.oPrev(),r=t.sweep.finishLeftRegions_(e,i,null),t.sweep.addRightEdges_(e,n,r.oNext,s.rPrev(),d,!0),!0}return t.geom.edgeSign(l,e.event,h)>=0&&(n.regionAbove().dirty=n.dirty=!0,t.mesh.splitEdge(s.sym),s.org.s=e.event.s,s.org.t=e.event.t),t.geom.edgeSign(u,e.event,h)<=0&&(n.dirty=i.dirty=!0,t.mesh.splitEdge(r.sym),r.org.s=e.event.s,r.org.t=e.event.t),!1}return t.mesh.splitEdge(s.sym),t.mesh.splitEdge(r.sym),t.mesh.meshSplice(r.oPrev(),s),s.org.s=h.s,s.org.t=h.t,s.org.pqHandle=e.pq.insert(s.org),t.sweep.getIntersectData_(e,s.org,o,l,a,u),n.regionAbove().dirty=n.dirty=i.dirty=!0,!1},t.sweep.walkDirtyRegions_=function(e,n){for(var i=n.regionBelow();;){for(;i.dirty;)n=i,i=i.regionBelow();if(!n.dirty&&(i=n,null===(n=n.regionAbove())||!n.dirty))return;n.dirty=!1;var s=n.eUp,r=i.eUp;if(s.dst()!==r.dst()&&t.sweep.checkForLeftSplice_(e,n)&&(i.fixUpperEdge?(t.sweep.deleteRegion_(e,i),t.mesh.deleteEdge(r),r=(i=n.regionBelow()).eUp):n.fixUpperEdge&&(t.sweep.deleteRegion_(e,n),t.mesh.deleteEdge(s),s=(n=i.regionAbove()).eUp)),s.org!==r.org)if(s.dst()===r.dst()||n.fixUpperEdge||i.fixUpperEdge||s.dst()!==e.event&&r.dst()!==e.event)t.sweep.checkForRightSplice_(e,n);else if(t.sweep.checkForIntersect_(e,n))return;s.org===r.org&&s.dst()===r.dst()&&(t.sweep.addWinding_(r,s),t.sweep.deleteRegion_(e,n),t.mesh.deleteEdge(s),n=i.regionAbove())}},t.sweep.connectRightVertex_=function(e,n,i){var s,r=i.oNext,o=n.regionBelow(),a=n.eUp,l=o.eUp,u=!1;(a.dst()!==l.dst()&&t.sweep.checkForIntersect_(e,n),t.geom.vertEq(a.org,e.event)&&(t.mesh.meshSplice(r.oPrev(),a),r=(n=t.sweep.topLeftRegion_(n)).regionBelow().eUp,t.sweep.finishLeftRegions_(e,n.regionBelow(),o),u=!0),t.geom.vertEq(l.org,e.event)&&(t.mesh.meshSplice(i,l.oPrev()),i=t.sweep.finishLeftRegions_(e,o,null),u=!0),u)?t.sweep.addRightEdges_(e,n,i.oNext,r,r,!0):(s=t.geom.vertLeq(l.org,a.org)?l.oPrev():a,s=t.mesh.connect(i.lPrev(),s),t.sweep.addRightEdges_(e,n,s,s.oNext,s.oNext,!1),s.sym.activeRegion.fixUpperEdge=!0,t.sweep.walkDirtyRegions_(e,n))},t.sweep.connectLeftDegenerate_=function(e,n,i){var s=n.eUp;if(t.geom.vertEq(s.org,i))t.sweep.TOLERANCE_NONZERO_&&t.sweep.spliceMergeVertices_(e,s,i.anEdge);else{if(!t.geom.vertEq(s.dst(),i))return t.mesh.splitEdge(s.sym),n.fixUpperEdge&&(t.mesh.deleteEdge(s.oNext),n.fixUpperEdge=!1),t.mesh.meshSplice(i.anEdge,s),void t.sweep.sweepEvent_(e,i);if(t.sweep.TOLERANCE_NONZERO_){var r=(n=t.sweep.topRightRegion_(n)).regionBelow(),o=r.eUp.sym,a=o.oNext,l=a;r.fixUpperEdge&&(t.sweep.deleteRegion_(e,r),t.mesh.deleteEdge(o),o=a.oPrev()),t.mesh.meshSplice(i.anEdge,o),t.geom.edgeGoesLeft(a)||(a=null),t.sweep.addRightEdges_(e,n,o.oNext,l,a,!0)}}},t.sweep.connectLeftVertex_=function(e,n){var i=new t.ActiveRegion;i.eUp=n.anEdge.sym;var s=e.dict.search(i).getKey(),r=s.regionBelow(),o=s.eUp,a=r.eUp;if(0!==t.geom.edgeSign(o.dst(),n,o.org)){var l,u=t.geom.vertLeq(a.dst(),o.dst())?s:r;if(s.inside||u.fixUpperEdge){if(u===s)l=t.mesh.connect(n.anEdge.sym,o.lNext);else l=t.mesh.connect(a.dNext(),n.anEdge).sym;u.fixUpperEdge?t.sweep.fixUpperEdge_(u,l):t.sweep.computeWinding_(e,t.sweep.addRegionBelow_(e,s,l)),t.sweep.sweepEvent_(e,n)}else t.sweep.addRightEdges_(e,s,n.anEdge,n.anEdge,null,!0)}else t.sweep.connectLeftDegenerate_(e,s,n)},t.sweep.sweepEvent_=function(e,n){e.event=n;for(var i=n.anEdge;null===i.activeRegion;)if((i=i.oNext)===n.anEdge)return void t.sweep.connectLeftVertex_(e,n);var s=t.sweep.topLeftRegion_(i.activeRegion),r=s.regionBelow(),o=r.eUp,a=t.sweep.finishLeftRegions_(e,r,null);a.oNext===o?t.sweep.connectRightVertex_(e,s,a):t.sweep.addRightEdges_(e,s,a.oNext,o,o,!0)},t.sweep.addSentinel_=function(e,n){var i=new t.ActiveRegion,s=t.mesh.makeEdge(e.mesh);s.org.s=t.sweep.SENTINEL_COORD_,s.org.t=n,s.dst().s=-t.sweep.SENTINEL_COORD_,s.dst().t=n,e.event=s.dst(),i.eUp=s,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=e.dict.insert(i)},t.sweep.initEdgeDict_=function(e){e.dict=new t.Dict(e,t.sweep.edgeLeq_),t.sweep.addSentinel_(e,-t.sweep.SENTINEL_COORD_),t.sweep.addSentinel_(e,t.sweep.SENTINEL_COORD_)},t.sweep.doneEdgeDict_=function(e){for(var n;null!==(n=e.dict.getMin().getKey());)n.sentinel,t.sweep.deleteRegion_(e,n);e.dict=null},t.sweep.removeDegenerateEdges_=function(e){for(var n,i=e.mesh.eHead,s=i.next;s!==i;s=n){n=s.next;var r=s.lNext;t.geom.vertEq(s.org,s.dst())&&s.lNext.lNext!==s&&(t.sweep.spliceMergeVertices_(e,r,s),t.mesh.deleteEdge(s),r=(s=r).lNext),r.lNext===s&&(r!==s&&(r!==n&&r!==n.sym||(n=n.next),t.mesh.deleteEdge(r)),s!==n&&s!==n.sym||(n=n.next),t.mesh.deleteEdge(s))}},t.sweep.initPriorityQ_=function(e){var n=new t.PriorityQ;e.pq=n;var i,s=e.mesh.vHead;for(i=s.next;i!==s;i=i.next)i.pqHandle=n.insert(i);n.init()},t.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},t.sweep.removeDegenerateFaces_=function(e){for(var n,i=e.fHead.next;i!==e.fHead;i=n){n=i.next;var s=i.anEdge;s.lNext.lNext===s&&(t.sweep.addWinding_(s.oNext,s),t.mesh.deleteEdge(s))}},t.tessmono={},t.tessmono.tessellateMonoRegion_=function(e){for(var n=e.anEdge;t.geom.vertLeq(n.dst(),n.org);n=n.lPrev());for(;t.geom.vertLeq(n.org,n.dst());n=n.lNext);for(var i,s=n.lPrev();n.lNext!==s;)if(t.geom.vertLeq(n.dst(),s.org)){for(;s.lNext!==n&&(t.geom.edgeGoesLeft(s.lNext)||t.geom.edgeSign(s.org,s.dst(),s.lNext.dst())<=0);)s=(i=t.mesh.connect(s.lNext,s)).sym;s=s.lPrev()}else{for(;s.lNext!==n&&(t.geom.edgeGoesRight(n.lPrev())||t.geom.edgeSign(n.dst(),n.org,n.lPrev().org)>=0);)i=t.mesh.connect(n,n.lPrev()),n=i.sym;n=n.lNext}for(;s.lNext.lNext!==n;)s=(i=t.mesh.connect(s.lNext,s)).sym},t.tessmono.tessellateInterior=function(e){for(var n,i=e.fHead.next;i!==e.fHead;i=n)n=i.next,i.inside&&t.tessmono.tessellateMonoRegion_(i)},t.tessmono.discardExterior=function(e){for(var n,i=e.fHead.next;i!==e.fHead;i=n)n=i.next,i.inside||t.mesh.zapFace(i)},t.tessmono.setWindingNumber=function(e,n,i){for(var s,r=e.eHead.next;r!==e.eHead;r=s)s=r.next,r.rFace().inside!==r.lFace.inside?r.winding=r.lFace.inside?n:-n:i?t.mesh.deleteEdge(r):r.winding=0},t.Dict=function(e,n){this.head_=new t.DictNode,this.frame_=e,this.leq_=n},t.Dict.prototype.deleteDict_=function(){},t.Dict.prototype.insertBefore=function(e,n){do{e=e.prev}while(null!==e.key&&!this.leq_(this.frame_,e.key,n));var i=new t.DictNode(n,e.next,e);return e.next.prev=i,e.next=i,i},t.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},t.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},t.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},t.Dict.prototype.getMin=function(){return this.head_.next},t.Dict.prototype.getMax=function(){return this.head_.prev},t.DictNode=function(e,t,n){this.key=e||null,this.next=t||this,this.prev=n||this},t.DictNode.prototype.getKey=function(){return this.key},t.DictNode.prototype.getSuccessor=function(){return this.next},t.DictNode.prototype.getPredecessor=function(){return this.prev},t.GluTesselator=function(){this.state_=t.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=t.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},t.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},t.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(t.GluTesselator.tessState_.T_DORMANT)},t.GluTesselator.prototype.gluTessProperty=function(e,n){switch(e){case t.gluEnum.GLU_TESS_TOLERANCE:return;case t.gluEnum.GLU_TESS_WINDING_RULE:var i=n;switch(i){case t.windingRule.GLU_TESS_WINDING_ODD:case t.windingRule.GLU_TESS_WINDING_NONZERO:case t.windingRule.GLU_TESS_WINDING_POSITIVE:case t.windingRule.GLU_TESS_WINDING_NEGATIVE:case t.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case t.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!n);default:return void this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(t.gluEnum.GLU_INVALID_VALUE)},t.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case t.gluEnum.GLU_TESS_TOLERANCE:return 0;case t.gluEnum.GLU_TESS_WINDING_RULE:return this.windingRule;case t.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly_;default:this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}return!1},t.GluTesselator.prototype.gluTessNormal=function(e,t,n){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=n},t.GluTesselator.prototype.gluTessCallback=function(e,n){var i=n||null;switch(e){case t.gluEnum.GLU_TESS_BEGIN:case t.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=i);case t.gluEnum.GLU_TESS_EDGE_FLAG:case t.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=i);case t.gluEnum.GLU_TESS_VERTEX:case t.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=i);case t.gluEnum.GLU_TESS_END:case t.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=i);case t.gluEnum.GLU_TESS_ERROR:case t.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=i);case t.gluEnum.GLU_TESS_COMBINE:case t.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=i);case t.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=i);default:return void this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}},t.GluTesselator.prototype.gluTessVertex=function(e,n){var i=!1,s=[0,0,0];this.requireState_(t.GluTesselator.tessState_.T_IN_CONTOUR);for(var r=0;r<3;++r){var o=e[r];o<-t.GLU_TESS_MAX_COORD&&(o=-t.GLU_TESS_MAX_COORD,i=!0),o>t.GLU_TESS_MAX_COORD&&(o=t.GLU_TESS_MAX_COORD,i=!0),s[r]=o}i&&this.callErrorCallback(t.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(s,n)},t.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(t.GluTesselator.tessState_.T_DORMANT),this.state_=t.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new t.GluMesh,this.polygonData_=e},t.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(t.GluTesselator.tessState_.T_IN_POLYGON),this.state_=t.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},t.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(t.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=t.GluTesselator.tessState_.T_IN_POLYGON},t.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(t.GluTesselator.tessState_.T_IN_POLYGON),this.state_=t.GluTesselator.tessState_.T_DORMANT,t.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),t.sweep.computeInterior(this),!this.fatalError){var e=this.mesh;if(this.boundaryOnly_?t.tessmono.setWindingNumber(e,1,!0):t.tessmono.tessellateInterior(e),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)t.render.renderBoundary(this,this.mesh);else{var n=!!this.edgeFlagCallback_;t.render.renderMesh(this,this.mesh,n)}if(this.meshCallback_)return t.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}t.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},t.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},t.GluTesselator.prototype.gotoState_=function(e){for(;this.state_!==e;)if(this.state_<e)switch(this.state_){case t.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case t.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case t.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case t.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},t.GluTesselator.prototype.addVertex_=function(e,n){var i=this.lastEdge_;null===i?(i=t.mesh.makeEdge(this.mesh),t.mesh.meshSplice(i,i.sym)):(t.mesh.splitEdge(i),i=i.lNext),i.org.data=n,i.org.coords[0]=e[0],i.org.coords[1]=e[1],i.org.coords[2]=e[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},t.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},t.GluTesselator.prototype.callCombineCallback=function(e,t,n){return this.combineCallback_&&this.combineCallback_(e,t,n,this.polygonData_)||null},t.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},t.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.inside=!1},t.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},t.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},t.GluHalfEdge.prototype.dst=function(){return this.sym.org},t.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},t.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},t.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},t.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},t.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},t.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},t.GluMesh=function(){this.vHead=new t.GluVertex,this.fHead=new t.GluFace,this.eHead=new t.GluHalfEdge,this.eHeadSym=new t.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},t.GluMesh.prototype.checkMesh=function(){if(t.DEBUG){var e,n,i,s=this.fHead,r=this.vHead,o=this.eHead,a=s;for(a=s;(n=a.next)!==s;a=n){e=n.anEdge;do{e=e.lNext}while(e!==n.anEdge)}var l=r;for(l=r;(i=l.next)!==r;l=i){e=i.anEdge;do{e=e.oNext}while(e!==i.anEdge)}var u=o;for(u=o;(e=u.next)!==o;u=e);}},t.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},t.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new t.PriorityQHeap},t.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},t.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var n,i=(n=this.verts_,function(e,i){return t.geom.vertLeq(n[e],n[i])?1:-1});if(this.order_.sort(i),this.initialized_=!0,this.heap_.init(),t.DEBUG){var s=0+this.size_-1;for(e=0;e<s;++e);}},t.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},t.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var e=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var n=this.heap_.minimum();if(t.geom.vertLeq(n,e))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return e},t.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var e=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var n=this.heap_.minimum();if(t.geom.vertLeq(n,e))return n}return e},t.PriorityQ.prototype.remove=function(e){if(e>=0)this.heap_.remove(e);else for(e=-(e+1),this.verts_[e]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},t.PriorityQHeap=function(){this.heap_=t.PriorityQHeap.reallocNumeric_([0],t.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=t.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},t.PriorityQHeap.INIT_SIZE_=32,t.PriorityQHeap.reallocNumeric_=function(e,t){for(var n=new Array(t),i=0;i<e.length;i++)n[i]=e[i];for(;i<t;i++)n[i]=0;return n},t.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},t.PriorityQHeap.prototype.insert=function(e){var n,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.handles_=t.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?n=i:(n=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[n]=e,this.handles_[n]=i,this.heap_[i]=n,this.initialized_&&this.floatUp_(i),n},t.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},t.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},t.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,n=this.handles_,i=e[1],s=t[i];return this.size_>0&&(e[1]=e[this.size_],n[e[1]]=1,t[i]=null,n[i]=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),s},t.PriorityQHeap.prototype.remove=function(e){var n=this.heap_,i=this.verts_,s=this.handles_,r=s[e];if(n[r]=n[this.size_],s[n[r]]=r,r<=--this.size_)if(r<=1)this.floatDown_(r);else{var o=i[n[r]],a=i[n[r>>1]];t.geom.vertLeq(a,o)?this.floatDown_(r):this.floatUp_(r)}i[e]=null,s[e]=this.freeList_,this.freeList_=e},t.PriorityQHeap.prototype.floatDown_=function(e){for(var n=this.heap_,i=this.verts_,s=this.handles_,r=e,o=n[r];;){var a=r<<1;a<this.size_&&t.geom.vertLeq(i[n[a+1]],i[n[a]])&&(a+=1);var l=n[a];if(a>this.size_||t.geom.vertLeq(i[o],i[l]))return n[r]=o,void(s[o]=r);n[r]=l,s[l]=r,r=a}},t.PriorityQHeap.prototype.floatUp_=function(e){for(var n=this.heap_,i=this.verts_,s=this.handles_,r=e,o=n[r];;){var a=r>>1,l=n[a];if(0===a||t.geom.vertLeq(i[l],i[o]))return n[r]=o,void(s[o]=r);n[r]=l,s[l]=r,r=a}},t.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},t.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},t.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},e.exports=t},76:function(e,t){!function(e){"use strict";var t=(e,t,n,i)=>{let s=65535&e|0,r=e>>>16&65535|0,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{s=s+t[i++]|0,r=r+s|0}while(--o);s%=65521,r%=65521}return s|r<<16|0};const n=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var i=(e,t,i,s)=>{const r=n,o=s+i;e^=-1;for(let n=s;n<o;n++)e=e>>>8^r[255&(e^t[n])];return-1^e};const s=16209,r=16191;var o=function(e,t){let n,i,o,a,l,u,h,c,d,p,g,f,m,_,x,y,w,b,S,v,T,O,E,C;const N=e.state;n=e.next_in,E=e.input,i=n+(e.avail_in-5),o=e.next_out,C=e.output,a=o-(t-e.avail_out),l=o+(e.avail_out-257),u=N.dmax,h=N.wsize,c=N.whave,d=N.wnext,p=N.window,g=N.hold,f=N.bits,m=N.lencode,_=N.distcode,x=(1<<N.lenbits)-1,y=(1<<N.distbits)-1;e:do{f<15&&(g+=E[n++]<<f,f+=8,g+=E[n++]<<f,f+=8),w=m[g&x];t:for(;;){if(b=w>>>24,g>>>=b,f-=b,b=w>>>16&255,0===b)C[o++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=m[(65535&w)+(g&(1<<b)-1)];continue t}if(32&b){N.mode=r;break e}e.msg="invalid literal/length code",N.mode=s;break e}S=65535&w,b&=15,b&&(f<b&&(g+=E[n++]<<f,f+=8),S+=g&(1<<b)-1,g>>>=b,f-=b),f<15&&(g+=E[n++]<<f,f+=8,g+=E[n++]<<f,f+=8),w=_[g&y];n:for(;;){if(b=w>>>24,g>>>=b,f-=b,b=w>>>16&255,!(16&b)){if(0==(64&b)){w=_[(65535&w)+(g&(1<<b)-1)];continue n}e.msg="invalid distance code",N.mode=s;break e}if(v=65535&w,b&=15,f<b&&(g+=E[n++]<<f,f+=8,f<b&&(g+=E[n++]<<f,f+=8)),v+=g&(1<<b)-1,v>u){e.msg="invalid distance too far back",N.mode=s;break e}if(g>>>=b,f-=b,b=o-a,v>b){if(b=v-b,b>c&&N.sane){e.msg="invalid distance too far back",N.mode=s;break e}if(T=0,O=p,0===d){if(T+=h-b,b<S){S-=b;do{C[o++]=p[T++]}while(--b);T=o-v,O=C}}else if(d<b){if(T+=h+d-b,b-=d,b<S){S-=b;do{C[o++]=p[T++]}while(--b);if(T=0,d<S){b=d,S-=b;do{C[o++]=p[T++]}while(--b);T=o-v,O=C}}}else if(T+=d-b,b<S){S-=b;do{C[o++]=p[T++]}while(--b);T=o-v,O=C}for(;S>2;)C[o++]=O[T++],C[o++]=O[T++],C[o++]=O[T++],S-=3;S&&(C[o++]=O[T++],S>1&&(C[o++]=O[T++]))}else{T=o-v;do{C[o++]=C[T++],C[o++]=C[T++],C[o++]=C[T++],S-=3}while(S>2);S&&(C[o++]=C[T++],S>1&&(C[o++]=C[T++]))}break}}break}}while(n<i&&o<l);S=f>>3,n-=S,f-=S<<3,g&=(1<<f)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<l?l-o+257:257-(o-l),N.hold=g,N.bits=f};const a=15,l=852,u=592,h=0,c=1,d=2,p=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),g=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),f=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),m=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _=(e,t,n,i,s,r,o,_)=>{const x=_.bits;let y,w,b,S,v,T,O=0,E=0,C=0,N=0,F=0,I=0,M=0,P=0,D=0,R=0,A=null;const V=new Uint16Array(a+1),L=new Uint16Array(a+1);let B,U,X,j=null;for(O=0;O<=a;O++)V[O]=0;for(E=0;E<i;E++)V[t[n+E]]++;for(F=x,N=a;N>=1&&0===V[N];N--);if(F>N&&(F=N),0===N)return s[r++]=20971520,s[r++]=20971520,_.bits=1,0;for(C=1;C<N&&0===V[C];C++);for(F<C&&(F=C),P=1,O=1;O<=a;O++)if(P<<=1,P-=V[O],P<0)return-1;if(P>0&&(e===h||1!==N))return-1;for(L[1]=0,O=1;O<a;O++)L[O+1]=L[O]+V[O];for(E=0;E<i;E++)0!==t[n+E]&&(o[L[t[n+E]]++]=E);if(e===h?(A=j=o,T=20):e===c?(A=p,j=g,T=257):(A=f,j=m,T=0),R=0,E=0,O=C,v=r,I=F,M=0,b=-1,D=1<<F,S=D-1,e===c&&D>l||e===d&&D>u)return 1;for(;;){B=O-M,o[E]+1<T?(U=0,X=o[E]):o[E]>=T?(U=j[o[E]-T],X=A[o[E]-T]):(U=96,X=0),y=1<<O-M,w=1<<I,C=w;do{w-=y,s[v+(R>>M)+w]=B<<24|U<<16|X|0}while(0!==w);for(y=1<<O-1;R&y;)y>>=1;if(0!==y?(R&=y-1,R+=y):R=0,E++,0==--V[O]){if(O===N)break;O=t[n+o[E]]}if(O>F&&(R&S)!==b){for(0===M&&(M=F),v+=C,I=O-M,P=1<<I;I+M<N&&(P-=V[I+M],!(P<=0));)I++,P<<=1;if(D+=1<<I,e===c&&D>l||e===d&&D>u)return 1;b=R&S,s[b]=F<<24|I<<16|v-r|0}}return 0!==R&&(s[v+R]=O-M<<24|64<<16|0),_.bits=F,0},x={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const y=0,w=1,b=2,{Z_FINISH:S,Z_BLOCK:v,Z_TREES:T,Z_OK:O,Z_STREAM_END:E,Z_NEED_DICT:C,Z_STREAM_ERROR:N,Z_DATA_ERROR:F,Z_MEM_ERROR:I,Z_BUF_ERROR:M,Z_DEFLATED:P}=x,D=16180,R=16181,A=16182,V=16183,L=16184,B=16185,U=16186,X=16187,j=16188,k=16189,z=16190,G=16191,H=16192,q=16193,Y=16194,W=16195,$=16196,K=16197,J=16198,Z=16199,Q=16200,ee=16201,te=16202,ne=16203,ie=16204,se=16205,re=16206,oe=16207,ae=16208,le=16209,ue=16210,he=16211,ce=852,de=592,pe=15,ge=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function fe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const me=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<D||t.mode>he?1:0},_e=e=>{if(me(e))return N;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ce),t.distcode=t.distdyn=new Int32Array(de),t.sane=1,t.back=-1,O},xe=e=>{if(me(e))return N;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,_e(e)},ye=(e,t)=>{let n;if(me(e))return N;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?N:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,xe(e))},we=(e,t)=>{if(!e)return N;const n=new fe;e.state=n,n.strm=e,n.window=null,n.mode=D;const i=ye(e,t);return i!==O&&(e.state=null),i};let be,Se,ve=!0;const Te=e=>{if(ve){be=new Int32Array(512),Se=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(_(w,e.lens,0,288,be,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;_(b,e.lens,0,32,Se,0,e.work,{bits:5}),ve=!1}e.lencode=be,e.lenbits=9,e.distcode=Se,e.distbits=5},Oe=(e,t,n,i)=>{let s;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(t.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>i&&(s=i),r.window.set(t.subarray(n-i,n-i+s),r.wnext),(i-=s)?(r.window.set(t.subarray(n-i,n),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var Ee={inflateReset:xe,inflateReset2:ye,inflateResetKeep:_e,inflateInit:e=>we(e,pe),inflateInit2:we,inflate:(e,n)=>{let s,r,a,l,u,h,c,d,p,g,f,m,x,he,ce,de,pe,fe,_e,xe,ye,we,be=0;const Se=new Uint8Array(4);let ve,Ee;const Ce=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(me(e)||!e.output||!e.input&&0!==e.avail_in)return N;s=e.state,s.mode===G&&(s.mode=H),u=e.next_out,a=e.output,c=e.avail_out,l=e.next_in,r=e.input,h=e.avail_in,d=s.hold,p=s.bits,g=h,f=c,we=O;e:for(;;)switch(s.mode){case D:if(0===s.wrap){s.mode=H;break}for(;p<16;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(2&s.wrap&&35615===d){0===s.wbits&&(s.wbits=15),s.check=0,Se[0]=255&d,Se[1]=d>>>8&255,s.check=i(s.check,Se,2,0),d=0,p=0,s.mode=R;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",s.mode=le;break}if((15&d)!==P){e.msg="unknown compression method",s.mode=le;break}if(d>>>=4,p-=4,ye=8+(15&d),0===s.wbits&&(s.wbits=ye),ye>15||ye>s.wbits){e.msg="invalid window size",s.mode=le;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&d?k:G,d=0,p=0;break;case R:for(;p<16;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(s.flags=d,(255&s.flags)!==P){e.msg="unknown compression method",s.mode=le;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=le;break}s.head&&(s.head.text=d>>8&1),512&s.flags&&4&s.wrap&&(Se[0]=255&d,Se[1]=d>>>8&255,s.check=i(s.check,Se,2,0)),d=0,p=0,s.mode=A;case A:for(;p<32;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}s.head&&(s.head.time=d),512&s.flags&&4&s.wrap&&(Se[0]=255&d,Se[1]=d>>>8&255,Se[2]=d>>>16&255,Se[3]=d>>>24&255,s.check=i(s.check,Se,4,0)),d=0,p=0,s.mode=V;case V:for(;p<16;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}s.head&&(s.head.xflags=255&d,s.head.os=d>>8),512&s.flags&&4&s.wrap&&(Se[0]=255&d,Se[1]=d>>>8&255,s.check=i(s.check,Se,2,0)),d=0,p=0,s.mode=L;case L:if(1024&s.flags){for(;p<16;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}s.length=d,s.head&&(s.head.extra_len=d),512&s.flags&&4&s.wrap&&(Se[0]=255&d,Se[1]=d>>>8&255,s.check=i(s.check,Se,2,0)),d=0,p=0}else s.head&&(s.head.extra=null);s.mode=B;case B:if(1024&s.flags&&(m=s.length,m>h&&(m=h),m&&(s.head&&(ye=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(r.subarray(l,l+m),ye)),512&s.flags&&4&s.wrap&&(s.check=i(s.check,r,m,l)),h-=m,l+=m,s.length-=m),s.length))break e;s.length=0,s.mode=U;case U:if(2048&s.flags){if(0===h)break e;m=0;do{ye=r[l+m++],s.head&&ye&&s.length<65536&&(s.head.name+=String.fromCharCode(ye))}while(ye&&m<h);if(512&s.flags&&4&s.wrap&&(s.check=i(s.check,r,m,l)),h-=m,l+=m,ye)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=X;case X:if(4096&s.flags){if(0===h)break e;m=0;do{ye=r[l+m++],s.head&&ye&&s.length<65536&&(s.head.comment+=String.fromCharCode(ye))}while(ye&&m<h);if(512&s.flags&&4&s.wrap&&(s.check=i(s.check,r,m,l)),h-=m,l+=m,ye)break e}else s.head&&(s.head.comment=null);s.mode=j;case j:if(512&s.flags){for(;p<16;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(4&s.wrap&&d!==(65535&s.check)){e.msg="header crc mismatch",s.mode=le;break}d=0,p=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=G;break;case k:for(;p<32;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}e.adler=s.check=ge(d),d=0,p=0,s.mode=z;case z:if(0===s.havedict)return e.next_out=u,e.avail_out=c,e.next_in=l,e.avail_in=h,s.hold=d,s.bits=p,C;e.adler=s.check=1,s.mode=G;case G:if(n===v||n===T)break e;case H:if(s.last){d>>>=7&p,p-=7&p,s.mode=re;break}for(;p<3;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}switch(s.last=1&d,d>>>=1,p-=1,3&d){case 0:s.mode=q;break;case 1:if(Te(s),s.mode=Z,n===T){d>>>=2,p-=2;break e}break;case 2:s.mode=$;break;case 3:e.msg="invalid block type",s.mode=le}d>>>=2,p-=2;break;case q:for(d>>>=7&p,p-=7&p;p<32;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",s.mode=le;break}if(s.length=65535&d,d=0,p=0,s.mode=Y,n===T)break e;case Y:s.mode=W;case W:if(m=s.length,m){if(m>h&&(m=h),m>c&&(m=c),0===m)break e;a.set(r.subarray(l,l+m),u),h-=m,l+=m,c-=m,u+=m,s.length-=m;break}s.mode=G;break;case $:for(;p<14;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(s.nlen=257+(31&d),d>>>=5,p-=5,s.ndist=1+(31&d),d>>>=5,p-=5,s.ncode=4+(15&d),d>>>=4,p-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=le;break}s.have=0,s.mode=K;case K:for(;s.have<s.ncode;){for(;p<3;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}s.lens[Ce[s.have++]]=7&d,d>>>=3,p-=3}for(;s.have<19;)s.lens[Ce[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,ve={bits:s.lenbits},we=_(y,s.lens,0,19,s.lencode,0,s.work,ve),s.lenbits=ve.bits,we){e.msg="invalid code lengths set",s.mode=le;break}s.have=0,s.mode=J;case J:for(;s.have<s.nlen+s.ndist;){for(;be=s.lencode[d&(1<<s.lenbits)-1],ce=be>>>24,de=be>>>16&255,pe=65535&be,!(ce<=p);){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(pe<16)d>>>=ce,p-=ce,s.lens[s.have++]=pe;else{if(16===pe){for(Ee=ce+2;p<Ee;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(d>>>=ce,p-=ce,0===s.have){e.msg="invalid bit length repeat",s.mode=le;break}ye=s.lens[s.have-1],m=3+(3&d),d>>>=2,p-=2}else if(17===pe){for(Ee=ce+3;p<Ee;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}d>>>=ce,p-=ce,ye=0,m=3+(7&d),d>>>=3,p-=3}else{for(Ee=ce+7;p<Ee;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}d>>>=ce,p-=ce,ye=0,m=11+(127&d),d>>>=7,p-=7}if(s.have+m>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=le;break}for(;m--;)s.lens[s.have++]=ye}}if(s.mode===le)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=le;break}if(s.lenbits=9,ve={bits:s.lenbits},we=_(w,s.lens,0,s.nlen,s.lencode,0,s.work,ve),s.lenbits=ve.bits,we){e.msg="invalid literal/lengths set",s.mode=le;break}if(s.distbits=6,s.distcode=s.distdyn,ve={bits:s.distbits},we=_(b,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,ve),s.distbits=ve.bits,we){e.msg="invalid distances set",s.mode=le;break}if(s.mode=Z,n===T)break e;case Z:s.mode=Q;case Q:if(h>=6&&c>=258){e.next_out=u,e.avail_out=c,e.next_in=l,e.avail_in=h,s.hold=d,s.bits=p,o(e,f),u=e.next_out,a=e.output,c=e.avail_out,l=e.next_in,r=e.input,h=e.avail_in,d=s.hold,p=s.bits,s.mode===G&&(s.back=-1);break}for(s.back=0;be=s.lencode[d&(1<<s.lenbits)-1],ce=be>>>24,de=be>>>16&255,pe=65535&be,!(ce<=p);){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(de&&0==(240&de)){for(fe=ce,_e=de,xe=pe;be=s.lencode[xe+((d&(1<<fe+_e)-1)>>fe)],ce=be>>>24,de=be>>>16&255,pe=65535&be,!(fe+ce<=p);){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}d>>>=fe,p-=fe,s.back+=fe}if(d>>>=ce,p-=ce,s.back+=ce,s.length=pe,0===de){s.mode=se;break}if(32&de){s.back=-1,s.mode=G;break}if(64&de){e.msg="invalid literal/length code",s.mode=le;break}s.extra=15&de,s.mode=ee;case ee:if(s.extra){for(Ee=s.extra;p<Ee;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}s.length+=d&(1<<s.extra)-1,d>>>=s.extra,p-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=te;case te:for(;be=s.distcode[d&(1<<s.distbits)-1],ce=be>>>24,de=be>>>16&255,pe=65535&be,!(ce<=p);){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(0==(240&de)){for(fe=ce,_e=de,xe=pe;be=s.distcode[xe+((d&(1<<fe+_e)-1)>>fe)],ce=be>>>24,de=be>>>16&255,pe=65535&be,!(fe+ce<=p);){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}d>>>=fe,p-=fe,s.back+=fe}if(d>>>=ce,p-=ce,s.back+=ce,64&de){e.msg="invalid distance code",s.mode=le;break}s.offset=pe,s.extra=15&de,s.mode=ne;case ne:if(s.extra){for(Ee=s.extra;p<Ee;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}s.offset+=d&(1<<s.extra)-1,d>>>=s.extra,p-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=le;break}s.mode=ie;case ie:if(0===c)break e;if(m=f-c,s.offset>m){if(m=s.offset-m,m>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=le;break}m>s.wnext?(m-=s.wnext,x=s.wsize-m):x=s.wnext-m,m>s.length&&(m=s.length),he=s.window}else he=a,x=u-s.offset,m=s.length;m>c&&(m=c),c-=m,s.length-=m;do{a[u++]=he[x++]}while(--m);0===s.length&&(s.mode=Q);break;case se:if(0===c)break e;a[u++]=s.length,c--,s.mode=Q;break;case re:if(s.wrap){for(;p<32;){if(0===h)break e;h--,d|=r[l++]<<p,p+=8}if(f-=c,e.total_out+=f,s.total+=f,4&s.wrap&&f&&(e.adler=s.check=s.flags?i(s.check,a,f,u-f):t(s.check,a,f,u-f)),f=c,4&s.wrap&&(s.flags?d:ge(d))!==s.check){e.msg="incorrect data check",s.mode=le;break}d=0,p=0}s.mode=oe;case oe:if(s.wrap&&s.flags){for(;p<32;){if(0===h)break e;h--,d+=r[l++]<<p,p+=8}if(4&s.wrap&&d!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=le;break}d=0,p=0}s.mode=ae;case ae:we=E;break e;case le:we=F;break e;case ue:return I;default:return N}return e.next_out=u,e.avail_out=c,e.next_in=l,e.avail_in=h,s.hold=d,s.bits=p,(s.wsize||f!==e.avail_out&&s.mode<le&&(s.mode<re||n!==S))&&Oe(e,e.output,e.next_out,f-e.avail_out),g-=e.avail_in,f-=e.avail_out,e.total_in+=g,e.total_out+=f,s.total+=f,4&s.wrap&&f&&(e.adler=s.check=s.flags?i(s.check,a,f,e.next_out-f):t(s.check,a,f,e.next_out-f)),e.data_type=s.bits+(s.last?64:0)+(s.mode===G?128:0)+(s.mode===Z||s.mode===Y?256:0),(0===g&&0===f||n===S)&&we===O&&(we=M),we},inflateEnd:e=>{if(me(e))return N;let t=e.state;return t.window&&(t.window=null),e.state=null,O},inflateGetHeader:(e,t)=>{if(me(e))return N;const n=e.state;return 0==(2&n.wrap)?N:(n.head=t,t.done=!1,O)},inflateSetDictionary:(e,n)=>{const i=n.length;let s,r,o;return me(e)?N:(s=e.state,0!==s.wrap&&s.mode!==z?N:s.mode===z&&(r=1,r=t(r,n,i,0),r!==s.check)?F:(o=Oe(e,n,i,i),o?(s.mode=ue,I):(s.havedict=1,O)))},inflateInfo:"pako inflate (from Nodeca project)"};const Ce=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ne=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Ce(n,t)&&(e[t]=n[t])}}return e},Fe={assign:Ne,flattenChunks:e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,i=0,s=e.length;t<s;t++){let s=e[t];n.set(s,i),i+=s.length}return n}};let Ie=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ie=!1}const Me=new Uint8Array(256);for(let e=0;e<256;e++)Me[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Me[254]=Me[254]=1;const Pe=(e,t)=>{if(t<65534&&e.subarray&&Ie)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n};var De={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,i,s,r,o=e.length,a=0;for(s=0;s<o;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<o&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),s++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),r=0,s=0;r<a;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<o&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,s;const r=new Array(2*n);for(s=0,i=0;i<n;){let t=e[i++];if(t<128){r[s++]=t;continue}let o=Me[t];if(o>4)r[s++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<n;)t=t<<6|63&e[i++],o--;o>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return Pe(r,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Me[e[n]]>t?n:t}},Re={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Ae(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ve=Ae;function Le(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Be=Le;const Ue=Object.prototype.toString,{Z_NO_FLUSH:Xe,Z_FINISH:je,Z_OK:ke,Z_STREAM_END:ze,Z_NEED_DICT:Ge,Z_STREAM_ERROR:He,Z_DATA_ERROR:qe,Z_MEM_ERROR:Ye}=x;function We(e){this.options=Fe.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ve,this.strm.avail_out=0;let n=Ee.inflateInit2(this.strm,t.windowBits);if(n!==ke)throw new Error(Re[n]);if(this.header=new Be,Ee.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=De.string2buf(t.dictionary):"[object ArrayBuffer]"===Ue.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ee.inflateSetDictionary(this.strm,t.dictionary),n!==ke)))throw new Error(Re[n])}function $e(e,t){const n=new We(t);if(n.push(e),n.err)throw n.msg||Re[n.err];return n.result}function Ke(e,t){return(t=t||{}).raw=!0,$e(e,t)}We.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let r,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?je:Xe,"[object ArrayBuffer]"===Ue.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),r=Ee.inflate(n,o),r===Ge&&s&&(r=Ee.inflateSetDictionary(n,s),r===ke?r=Ee.inflate(n,o):r===qe&&(r=Ge));n.avail_in>0&&r===ze&&n.state.wrap>0&&0!==e[n.next_in];)Ee.inflateReset(n),r=Ee.inflate(n,o);switch(r){case He:case qe:case Ge:case Ye:return this.onEnd(r),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||r===ze))if("string"===this.options.to){let e=De.utf8border(n.output,n.next_out),t=n.next_out-e,s=De.buf2string(n.output,e);n.next_out=t,n.avail_out=i-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==ke||0!==a){if(r===ze)return r=Ee.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},We.prototype.onData=function(e){this.chunks.push(e)},We.prototype.onEnd=function(e){e===ke&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Fe.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Je=We,Ze=$e,Qe=Ke,et=$e,tt=x,nt={Inflate:Je,inflate:Ze,inflateRaw:Qe,ungzip:et,constants:tt};e.Inflate=Je,e.constants=tt,e.default=nt,e.inflate=Ze,e.inflateRaw=Qe,e.ungzip=et,Object.defineProperty(e,"__esModule",{value:!0})}(t)},546:function(e,t){var n,i,s;i=[],void 0===(s="function"==typeof(n=function(){var e=function(e){return e.reduce((function(e,t){return 2*e+t}),0)},t=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},n=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],n=0;n<e;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},i=function(e,t){for(var n,i,s=0,r=function(e){for(var n=0,i=0;i<e;i++)t.charCodeAt(s>>3)&1<<(7&s)&&(n|=1<<i),s++;return n},o=[],a=1<<e,l=a+1,u=e+1,h=[],c=function(){h=[],u=e+1;for(var t=0;t<a;t++)h[t]=[t];h[a]=[],h[l]=null};;)if(i=n,(n=r(u))!==a){if(n===l)break;if(n<h.length)i!==a&&h.push(h[i].concat(h[n][0]));else{if(n!==h.length)throw new Error("Invalid LZW code.");h.push(h[i].concat(h[i][0]))}o.push.apply(o,h[n]),h.length===1<<u&&u<12&&u++}else c();return o},s=function(n,s){s||(s={});var r=function(e){for(var t=[],i=0;i<e;i++)t.push(n.readBytes(3));return t},o=function(){var e,t;t="";do{e=n.readByte(),t+=n.read(e)}while(0!==e);return t},a=function(){var i={};if(i.sig=n.read(3),i.ver=n.read(3),"GIF"!==i.sig)throw new Error("Not a GIF file.");i.width=n.readUnsigned(),i.height=n.readUnsigned();var o=t(n.readByte());i.gctFlag=o.shift(),i.colorRes=e(o.splice(0,3)),i.sorted=o.shift(),i.gctSize=e(o.splice(0,3)),i.bgColor=n.readByte(),i.pixelAspectRatio=n.readByte(),i.gctFlag&&(i.gct=r(1<<i.gctSize+1)),s.hdr&&s.hdr(i)},l=function(i){var r=function(i){n.readByte();var r=t(n.readByte());i.reserved=r.splice(0,3),i.disposalMethod=e(r.splice(0,3)),i.userInput=r.shift(),i.transparencyGiven=r.shift(),i.delayTime=n.readUnsigned(),i.transparencyIndex=n.readByte(),i.terminator=n.readByte(),s.gce&&s.gce(i)},a=function(e){e.comment=o(),s.com&&s.com(e)},l=function(e){n.readByte(),e.ptHeader=n.readBytes(12),e.ptData=o(),s.pte&&s.pte(e)},u=function(e){var t=function(e){n.readByte(),e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),s.app&&s.app.NETSCAPE&&s.app.NETSCAPE(e)},i=function(e){e.appData=o(),s.app&&s.app[e.identifier]&&s.app[e.identifier](e)};n.readByte(),e.identifier=n.read(8),e.authCode=n.read(3),"NETSCAPE"===e.identifier?t(e):i(e)},h=function(e){e.data=o(),s.unknown&&s.unknown(e)};switch(i.label=n.readByte(),i.label){case 249:i.extType="gce",r(i);break;case 254:i.extType="com",a(i);break;case 1:i.extType="pte",l(i);break;case 255:i.extType="app",u(i);break;default:i.extType="unknown",h(i)}},u=function(a){var l=function(e,t){for(var n=new Array(e.length),i=e.length/t,s=function(i,s){var r=e.slice(s*t,(s+1)*t);n.splice.apply(n,[i*t,t].concat(r))},r=[0,4,2,1],o=[8,8,4,2],a=0,l=0;l<4;l++)for(var u=r[l];u<i;u+=o[l])s(u,a),a++;return n};a.leftPos=n.readUnsigned(),a.topPos=n.readUnsigned(),a.width=n.readUnsigned(),a.height=n.readUnsigned();var u=t(n.readByte());a.lctFlag=u.shift(),a.interlaced=u.shift(),a.sorted=u.shift(),a.reserved=u.splice(0,2),a.lctSize=e(u.splice(0,3)),a.lctFlag&&(a.lct=r(1<<a.lctSize+1)),a.lzwMinCodeSize=n.readByte();var h=o();a.pixels=i(a.lzwMinCodeSize,h),a.interlaced&&(a.pixels=l(a.pixels,a.width)),s.img&&s.img(a)},h=function(){var e={};switch(e.sentinel=n.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",l(e);break;case",":e.type="img",u(e);break;case";":e.type="eof",s.eof&&s.eof(e);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(h,0)};a(),setTimeout(h,0)};return function(e){var t,i,r={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var o in e)r[o]=e[o];r.vp_w&&r.vp_h&&(r.is_vp=!0);var a=null,l=!1,u=null,h=null,c=null,d=null,p=null,g=null,f=null,m=!0,_=!0,x=!1,y=[],w=[],b=r.gif;void 0===r.auto_play&&(r.auto_play=!b.getAttribute("rel:auto_play")||"1"==b.getAttribute("rel:auto_play"));var S,v,T,O,E=r.hasOwnProperty("on_end")?r.on_end:null,C=r.hasOwnProperty("on_error")?r.on_error:null,N=r.hasOwnProperty("loop_delay")?r.loop_delay:0,F=r.hasOwnProperty("loop_mode")?r.loop_mode:"auto",I=!r.hasOwnProperty("draw_while_loading")||r.draw_while_loading,M=!!I&&(!r.hasOwnProperty("show_progress_bar")||r.show_progress_bar),P=r.hasOwnProperty("progressbar_height")?r.progressbar_height:25,D=r.hasOwnProperty("progressbar_background_color")?r.progressbar_background_color:"rgba(255,255,255,0.4)",R=r.hasOwnProperty("progressbar_foreground_color")?r.progressbar_foreground_color:"rgba(255,0,22,.8)",A=function(){u=null,h=null,p=c,c=null,g=null},V=function(){try{s(t,$)}catch(e){X("parse")}},L=function(e,t){S.width=e*J(),S.height=t*J(),T.style.minWidth=e*J()+"px",O.width=e,O.height=t,O.style.width=e+"px",O.style.height=t+"px",O.getContext("2d").setTransform(1,0,0,1,0,0)},B=function(e,t){w[e]?(void 0!==t.x&&(w[e].x=t.x),void 0!==t.y&&(w[e].y=t.y)):w[e]=t},U=function(e,t,n){if(n&&M){var i,s,o,a=P;r.is_vp?x?(s=(r.vp_t+r.vp_h-a)/J(),a/=J(),i=r.vp_l/J()+e/t*(r.vp_w/J()),o=S.width/J()):(s=r.vp_t+r.vp_h-a,i=r.vp_l+e/t*r.vp_w,o=S.width):(s=(S.height-a)/(x?J():1),i=e/t*S.width/(x?J():1),o=S.width/(x?J():1),a/=x?J():1),v.fillStyle=D,v.fillRect(i,s,o-i,a),v.fillStyle=R,v.fillRect(0,s,i,a)}},X=function(e){var t=function(){v.fillStyle="black",v.fillRect(0,0,r.c_w?r.c_w:i.width,r.c_h?r.c_h:i.height),v.strokeStyle="red",v.lineWidth=3,v.moveTo(0,0),v.lineTo(r.c_w?r.c_w:i.width,r.c_h?r.c_h:i.height),v.moveTo(0,r.c_h?r.c_h:i.height),v.lineTo(r.c_w?r.c_w:i.width,0),v.stroke()};a=e,i={width:b.width,height:b.height},y=[],t(),e&&C(e)},j=function(e){L((i=e).width,i.height)},k=function(e){z(),A(),u=e.transparencyGiven?e.transparencyIndex:null,h=e.delayTime,c=e.disposalMethod},z=function(){g&&(y.push({data:g.getImageData(0,0,i.width,i.height),delay:h}),w.push({x:0,y:0}))},G=function(e){g||(g=O.getContext("2d"));var t=y.length,n=e.lctFlag?e.lct:i.gct;t>0&&(3===p?null!==d?g.putImageData(y[d].data,0,0):g.clearRect(f.leftPos,f.topPos,f.width,f.height):d=t-1,2===p&&g.clearRect(f.leftPos,f.topPos,f.width,f.height));var s=g.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach((function(e,t){e!==u&&(s.data[4*t+0]=n[e][0],s.data[4*t+1]=n[e][1],s.data[4*t+2]=n[e][2],s.data[4*t+3]=255)})),g.putImageData(s,e.leftPos,e.topPos),x||(v.scale(J(),J()),x=!0),I&&(v.drawImage(O,0,0),I=r.auto_play),f=e},H=function(){var e,t,n,i=-1,s=0,o=function(){return(i+(_?1:-1)+y.length)%y.length},l=function(e){i+=e,h()},u=(e=!1,t=function(){null!==E&&E(b),s++,!1!==F||s<0?n():(e=!1,m=!1)},n=function(){if(e=m){l(1);var s=10*y[i].delay;s||(s=100),0===o()?(s+=N,setTimeout(t,s)):setTimeout(n,s)}},function(){e||setTimeout(n,0)}),h=function(){var e;(i=parseInt(i,10))>y.length-1&&(i=0),i<0&&(i=0),e=w[i],O.getContext("2d").putImageData(y[i].data,e.x,e.y),v.globalCompositeOperation="copy",v.drawImage(O,0,0)},c=function(){m=!0,u()};return{init:function(){a||(r.c_w&&r.c_h||v.scale(J(),J()),r.auto_play?u():(i=0,h()))},step:u,play:c,pause:function(){m=!1},playing:m,move_relative:l,current_frame:function(){return i},length:function(){return y.length},move_to:function(e){i=e,h()}}}(),q=function(e){U(t.pos,t.data.length,e)},Y=function(){},W=function(e,t){return function(n){e(n),q(t)}},$={hdr:W(j),gce:W(k),com:W(Y),app:{NETSCAPE:W(Y)},img:W(G,!0),eof:function(e){z(),q(!1),r.c_w&&r.c_h||(S.width=i.width*J(),S.height=i.height*J()),H.init(),l=!1,Q&&Q(b)}},K=function(){var e=b.parentNode,t=document.createElement("div");S=document.createElement("canvas"),v=S.getContext("2d"),T=document.createElement("div"),O=document.createElement("canvas"),t.width=S.width=b.width,t.height=S.height=b.height,T.style.minWidth=b.width+"px",t.className="jsgif",T.className="jsgif_toolbar",t.appendChild(S),t.appendChild(T),e.insertBefore(t,b),e.removeChild(b),r.c_w&&r.c_h&&L(r.c_w,r.c_h),Z=!0},J=function(){return r.max_width&&i&&i.width>r.max_width?r.max_width/i.width:1},Z=!1,Q=!1,ee=function(e){return!l&&(Q=e||!1,l=!0,y=[],A(),d=null,p=null,g=null,f=null,!0)},te=function(){return y.reduce((function(e,t){return e+t.delay}),0)};return{play:H.play,pause:H.pause,move_relative:H.move_relative,move_to:H.move_to,get_playing:function(){return m},get_canvas:function(){return S},get_canvas_scale:function(){return J()},get_loading:function(){return l},get_auto_play:function(){return r.auto_play},get_length:function(){return H.length()},get_frames:function(){return y},get_duration:function(){return te()},get_duration_ms:function(){return 10*te()},get_current_frame:function(){return H.current_frame()},load_url:function(e,i){if(ee(i)){var s=new XMLHttpRequest;s.open("GET",e,!0),"overrideMimeType"in s?s.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in s?s.responseType="arraybuffer":s.setRequestHeader("Accept-Charset","x-user-defined"),s.onloadstart=function(){Z||K()},s.onload=function(e){200!=this.status&&X("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var i=this.response;i.toString().indexOf("ArrayBuffer")>0&&(i=new Uint8Array(i)),t=new n(i),setTimeout(V,0)},s.onprogress=function(e){e.lengthComputable&&U(e.loaded,e.total,!0)},s.onerror=function(){X("xhr")},s.send()}},load:function(e){this.load_url(b.getAttribute("rel:animated_src")||b.src,e)},load_raw:function(e,i){ee(i)&&(Z||K(),t=new n(e),setTimeout(V,0))},set_frame_offset:B}}})?n.apply(t,i):n)||(e.exports=s)}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};return(()=>{"use strict";i.d(s,{default:()=>MI});const t=new Map;t.set("x_ite/Namespace",t);const n=t;let r=0,o=0,a=0,l=0;const u={CONNECTION_ERROR:r++,BROWSER_EVENT:r++,INITIALIZED_EVENT:r++,SHUTDOWN_EVENT:r++,INITIALIZED_ERROR:r++,NOT_STARTED_STATE:o++,IN_PROGRESS_STATE:o++,COMPLETE_STATE:o++,FAILED_STATE:o++,initializeOnly:1,inputOnly:2,outputOnly:4,inputOutput:7,SFBool:a++,SFColor:a++,SFColorRGBA:a++,SFDouble:a++,SFFloat:a++,SFImage:a++,SFInt32:a++,SFMatrix3d:a++,SFMatrix3f:a++,SFMatrix4d:a++,SFMatrix4f:a++,SFNode:a++,SFRotation:a++,SFString:a++,SFTime:a++,SFVec2d:a++,SFVec2f:a++,SFVec3d:a++,SFVec3f:a++,SFVec4d:a++,SFVec4f:a++,VrmlMatrix:a++,MFBool:a++,MFColor:a++,MFColorRGBA:a++,MFDouble:a++,MFFloat:a++,MFImage:a++,MFInt32:a++,MFMatrix3d:a++,MFMatrix3f:a++,MFMatrix4d:a++,MFMatrix4f:a++,MFNode:a++,MFRotation:a++,MFString:a++,MFTime:a++,MFVec2d:a++,MFVec2f:a++,MFVec3d:a++,MFVec3f:a++,MFVec4d:a++,MFVec4f:a++,X3DBaseNode:l,[Symbol.toStringTag]:"X3DConstants"};Object.defineProperty(u,"addNode",{value({typeName:e}){this[e]||(this[e]=++l)}});const h=u;n.set("x_ite/Base/X3DConstants",h);const c=h,d=function(e,t="",n=!1){t=String(t).replace(/_\d+$/,"");let i=n?`${t}_1`:t,s=1,r=1;for(;e.has(i)||0===i.length;)s=r,r<<=1,i=`${t}_${s}`;if(s>>>=1,r>>>=1,s&&r){for(;s<r;){const n=s+r>>>1;e.has(`${t}_${n}`)?s=n+1:r=n}i=`${t}_${s}`}return i},p={radians:e=>e*(Math.PI/180),degrees:e=>e*(180/Math.PI),random:(e,t)=>e+Math.random()*(t-e),fract:e=>e%1,clamp:(e,t,n)=>Math.min(Math.max(e,t),n),interval:(e,t,n)=>e>=n?(e-t)%(n-t)+t:e<t?(e-n)%(n-t)+n:e,lerp:(e,t,n)=>e+n*(t-e),slerp(e,t,n){let i=e.dot(t);if(i>=1)return e;i<0&&(i=-i,t.negate());const s=Math.acos(i),r=Math.sin(s),o=Math.sin((1-n)*s)/r,a=Math.sin(n*s)/r;return e.x=e.x*o+t.x*a,e.y=e.y*o+t.y*a,e.z=e.z*o+t.z*a,e.w=e.w*o+t.w*a,e},simpleSlerp(e,t,n){const i=e.dot(t);if(i>=1)return e;const s=Math.acos(i),r=Math.sin(s),o=Math.sin((1-n)*s)/r,a=Math.sin(n*s)/r;return e.x=e.x*o+t.x*a,e.y=e.y*o+t.y*a,e.z=e.z*o+t.z*a,e.w=e.w*o+t.w*a,e},isPowerOfTwo:e=>0==(e-1&e),nextPowerOfTwo:e=>p.isPowerOfTwo(e)?e:1<<32-Math.clz32(e),bitCount:e=>16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24,cmp:(e,t)=>e>t?1:e<t?-1:0,less:(e,t)=>e<t,greater:(e,t)=>e>t,lowerBound(e,t,n,i,s=p.less){let r=0,o=0,a=n-t;for(;a>0;)o=a>>>1,r=t+o,s(e[r],i)?(t=++r,a-=o+1):a=o;return t},upperBound(e,t,n,i,s=p.less){let r=0,o=0,a=n-t;for(;a>0;)o=a>>>1,r=t+o,s(i,e[r])?a=o:(t=++r,a-=o+1);return t}},g=p;n.set("standard/Math/Algorithm",g);const f=g;function m({style:e="TIDY",indent:t="",precision:n=7,doublePrecision:i=15,html:s=!1,closingTags:r=!1}){this.string="",this.indent=t,this.listIndent=t,this.precision=f.clamp(n,1,21),this.doublePrecision=f.clamp(i,1,21),this.html=s,this.closingTags=s||r,this.floatFormat=new Intl.NumberFormat("en",{notation:"standard",maximumSignificantDigits:this.precision,useGrouping:!1}).format,this.floatExponentialFormat=new Intl.NumberFormat("en",{notation:"scientific",maximumSignificantDigits:this.precision,useGrouping:!1}).format,this.doubleFormat=new Intl.NumberFormat("en",{notation:"standard",maximumSignificantDigits:this.doublePrecision,useGrouping:!1}).format,this.doubleExponentialFormat=new Intl.NumberFormat("en",{notation:"scientific",maximumSignificantDigits:this.doublePrecision,useGrouping:!1}).format,this.Style(e),this.executionContextStack=[null],this.importedNodesIndex=new Map,this.exportedNodesIndex=new Map,this.nodes=new Set,this.names=new Map,this.namesByNode=new Map,this.importedNames=new Map,this.routeNodes=new Set,this.level=0,this.containerFields=[],this.units=!0,this.unitCategories=[],this.names.set(null,Object.assign(new Set,{index:0}))}Object.assign(m.prototype,{Style(e){switch(e){case"CLEAN":this.listIndent="",this.comma=" ",this.break=" ",this.tidyBreak="",this.tidySpace="",this.indentChar="",this.listEnclosure="",this.listBreak="",this.listIndentChar="",this.attribBreak=" ";break;case"SMALL":this.listIndent="",this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace="",this.indentChar="",this.listEnclosure="",this.listBreak="",this.listIndentChar="",this.attribBreak=" ";break;case"COMPACT":this.listIndent="",this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace=" ",this.indentChar="  ",this.listEnclosure=" ",this.listBreak=" ",this.listIndentChar="",this.attribBreak=" ";break;default:this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace=" ",this.indentChar="  ",this.listEnclosure="\n",this.listBreak="\n",this.listIndentChar="  ",this.attribBreak="\n"}},Comma(){return this.comma},Break(){return this.break},TidyBreak(){return this.tidyBreak},ForceBreak:()=>"\n",Space:()=>" ",TidySpace(){return this.tidySpace},ListStart(){return this.listEnclosure},ListEnd(){return this.listEnclosure},ListBreak(){return this.listBreak},AttribBreak(){return this.attribBreak},Indent(){return this.indent},ListIndent(){return this.listIndent},IncIndent(){return this.indent+=this.indentChar,this.listIndent+=this.listIndentChar,""},DecIndent(){return this.indent=this.indent.slice(0,this.indent.length-this.indentChar.length),this.listIndent=this.listIndent.slice(0,this.listIndent.length-this.listIndentChar.length),""},FloatFormat(e){if(Number.isFinite(e)){const t=Math.log10(Math.abs(e));return this.precision>t&&t>=-4||0===e?this.floatFormat(e):this.floatExponentialFormat(e).toLowerCase()}return String(e)},DoubleFormat(e){if(Number.isFinite(e)){const t=Math.log10(Math.abs(e));return this.doublePrecision>t&&t>=-4||0===e?this.doubleFormat(e):this.doubleExponentialFormat(e).toLowerCase()}return String(e)},PushExecutionContext(e){this.executionContextStack.push(e),this.names.has(e)||this.names.set(e,Object.assign(new Set,{index:0})),this.importedNodesIndex.has(e)||this.importedNodesIndex.set(e,new Set),this.exportedNodesIndex.has(e)||this.exportedNodesIndex.set(e,new Set)},PopExecutionContext(){this.executionContextStack.pop(),this.ExecutionContext()||(this.importedNodesIndex.clear(),this.exportedNodesIndex.clear())},ExecutionContext(){return this.executionContextStack.at(-1)},EnterScope(){++this.level},LeaveScope(){--this.level,0===this.level&&(this.nodes.clear(),this.namesByNode.clear(),this.importedNames.clear())},ExportedNodes(e){const t=this.exportedNodesIndex.get(this.ExecutionContext());e.forEach((function(e){try{t.add(e.getLocalNode())}catch{}}))},ImportedNodes(e){const t=this.importedNodesIndex.get(this.ExecutionContext());e.forEach((function(e){try{t.add(e.getInlineNode())}catch{}}))},AddImportedNode(e,t){this.importedNames.set(e,t)},AddRouteNode(e){this.routeNodes.add(e)},ExistsRouteNode(e){return this.routeNodes.has(e)},IsSharedNode(e){return this.ExecutionContext()!==e.getExecutionContext()},AddNode(e){this.nodes.add(e),this.AddRouteNode(e)},ExistsNode(e){return this.nodes.has(e)},Name(e){const t=this.namesByNode.get(e);if(void 0!==t)return t;{const t=e.getName(),i=t.match(/^(.*?)(_\d+)?$/),s=this.names.get(this.ExecutionContext());if(i[1])var n=d(s,t,!!i[2]);else{if(!this.NeedsName(e))return"";n="_"+ ++s.index}return s.add(n),this.namesByNode.set(e,n),n}},NeedsName(e){if(e.getCloneCount()>1)return!0;if(e.hasRoutes())return!0;const t=e.getExecutionContext(),n=this.importedNodesIndex.get(t);if(!n){const n=this.exportedNodesIndex.get(t);return!(!n||!n.has(e))}return!!n.has(e)||void 0},LocalName(e){const t=this.importedNames.get(e);if(void 0!==t)return t;if(this.ExistsNode(e))return this.Name(e);throw new Error(`Couldn't get local name for node '${e.getTypeName()}'.`)},PushContainerField(e){this.containerFields.push(e)},PopContainerField(){this.containerFields.pop()},ContainerField(){return this.containerFields.length?this.containerFields[this.containerFields.length-1]:null},AccessType(e){switch(e){case c.initializeOnly:return"initializeOnly";case c.inputOnly:return"inputOnly";case c.outputOnly:return"outputOnly";case c.inputOutput:return"inputOutput"}},SetUnits(e){this.units=e},GetUnits(){return this.units},PushUnitCategory(e){this.unitCategories.push(e)},PopUnitCategory(){this.unitCategories.pop()},Unit(e){return 0==this.unitCategories.length?e:this.unitCategories.at(-1)},ToUnit(e,t){if(this.units){const n=this.ExecutionContext();if(n)return n.toUnit(e,t)}return t},XMLEncode:function(){const e={"\\":"\\\\","\r":"&#xD;","\n":"&#xA;","\t":"&#x9;",'"':'\\"',"'":"&apos;","<":"&lt;",">":"&gt;","&":"&amp;"},t=/([\\\r\n\t"'<>&])/g;return function(n){return n.replace(t,(t=>e[t]))}}(),XMLEncodeSourceText:function(){const e={"\\":"\\\\",'"':'\\"',"'":"&apos;","<":"&lt;",">":"&gt;","&":"&amp;"},t=/([\\"'<>&])/g;return function(n){return n.replace(t,(t=>e[t]))}}(),JSONEncode:function(){const e={"\\":"\\\\","\r":"\\r","\n":"\\n","\t":"\\t",'"':'\\"'},t=/([\\\t\n\r"])/g;return function(n){return n.replace(t,(t=>e[t]))}}(),JSONNumber(e){switch(e){case"NaN":case"Infinity":case"-Infinity":return'"'+e+'"';default:return e}},JSONRemoveComma(){this.string=this.string.trimEnd(),this.string.endsWith(",")&&(this.string=this.string.slice(0,-1)),this.string+=this.TidyBreak()}});for(const e of Reflect.ownKeys(m.prototype))Object.defineProperty(m.prototype,e,{enumerable:!1});const _=m;n.set("x_ite/InputOutput/Generator",_);const x=_,y={assign:function(){function e(e,t){this.set(t,e)}return function(t,n){return t.clear(),n.forEach(e,t),t}}(),values:function(){function e(e){this.push(e)}return function(t,n){return t.length=0,n.forEach(e,t),t}}()},w=y;n.set("standard/Utility/MapUtilities",w);const b=w;n.set("x_ite/DEVELOPMENT",false);const S=false,v=Symbol(),T=Symbol(),O=Symbol(),E=Symbol();function C(){}Object.assign(C.prototype,{[v]:"",[T]:new Map,[O]:[],[E]:new Map,getId(){return C.getId(this)},getTypeName(){return this.constructor.typeName},setName(e){this[v]=e},getName(){return this[v]},getDisplayName(){return this[v]},hasInterest(e,t){return this[T].has(C.getInterestId(e,t))},addInterest(e,t,...n){this[T]===C.prototype[T]&&(this[T]=new Map,this[O]=[]);const i=C.getInterestId(e,t),s=t[e];this[T].set(i,s.bind(t,...n,this))},removeInterest(e,t){this[T].delete(C.getInterestId(e,t))},getInterests(){return this[T]},processInterests(){if(this[T].size)for(const e of b.values(this[O],this[T]))e()},getUserData(e){return this[E].get(e)},setUserData(e,t){this[E]===C.prototype[E]&&(this[E]=new Map),this[E].set(e,t)},removeUserData(e){this[E].delete(e)},toString(e=Object.prototype){const t=new x(e);return e.scene&&t.PushExecutionContext(e.scene),this.toStream(t),t.string},toVRMLString(e=Object.prototype){const t=new x(e);return e.scene&&t.PushExecutionContext(e.scene),this.toVRMLStream(t),t.string},toXMLString(e=Object.prototype){const t=new x(e);return e.scene&&t.PushExecutionContext(e.scene),this.toXMLStream(t),t.string},toJSONString(e=Object.prototype){const t=new x(e);return e.scene&&t.PushExecutionContext(e.scene),this.toJSONStream(t),t.string},toStream(e){e.string=Object.prototype.toString.call(this)},dispose(){this[T].clear(),this[E].clear()}});for(const e of Reflect.ownKeys(C.prototype))Object.defineProperty(C.prototype,e,{enumerable:!1});Object.defineProperties(C.prototype,{[Symbol.toStringTag]:{get(){return this.getTypeName()}}}),Object.assign(C,{getId:function(){const e=new WeakMap;let t=0;return function(n){const i=e.get(n);return void 0!==i?i:(e.set(n,++t),t)}}(),getInterestId(e,t){return`${this.getId(t)}.${this.getId(t[e])}`}});const N=C;n.set("x_ite/Base/X3DObject",N);const F=N,I=Symbol(),M=Symbol(),P=Symbol();Symbol();function D(){F.call(this)}Object.assign(Object.setPrototypeOf(D.prototype,F.prototype),{[I]:0,[M]:!1,[P]:new Set,isInitializable:()=>!0,isInput:()=>!1,isOutput:()=>!1,setModificationTime(e){this[I]=e},getModificationTime(){return this[I]},setTainted(e){this[M]=e},isTainted(){return this[M]},addEvent(){this.setModificationTime(Date.now());for(const e of this[P])e.addEvent(this)},addEventObject(e,t){this.setModificationTime(Date.now());for(const e of this[P])e.addEventObject(this,t)},addParent(e){this[P]===D.prototype[P]&&(this[P]=new Set),this[P].add(e)},removeParent(e){this[P].delete(e)},getParents(){return this[P]},processEvent(){this.setTainted(!1),this.processInterests()},dispose(){this[P].clear(),F.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(D.prototype))Object.defineProperty(D.prototype,e,{enumerable:!1});const R=D;n.set("x_ite/Base/X3DChildObject",R);const A=R,V=Object.assign([],{create(e){if(this.length){const t=this.pop();return t.field=e,t.clear(),t}const t=new Set;return t.field=e,t},copy(e){if(this.length){const t=this.pop();t.field=e.field,t.clear();for(const n of e)t.add(n);return t}const t=new Set(e);return t.field=e.field,t},clear(){this.length=0}});for(const e of Reflect.ownKeys(V))Object.defineProperty(V,e,{enumerable:!1});const L=V;n.set("x_ite/Base/Events",L);const B=L,U=Symbol.for("X_ITE.X3DEventObject.browser");function X(e){A.call(this),this[U]=e}Object.assign(Object.setPrototypeOf(X.prototype,A.prototype),{getBrowser(){return this[U]},getExtendedEventHandling:()=>!0,addEvent(e){e.isTainted()||(e.setTainted(!0),this.addEventObject(e,B.create(e)))},addEventObject(e,t){const n=this.getBrowser();n.addTaintedField(e,t),n.addBrowserEvent(),this.isTainted()||(e.isInput()||this.getExtendedEventHandling()&&e.isInitializable())&&this.addNodeEvent()},addNodeEvent(){if(this.isTainted())return;const e=this.getBrowser();this.setTainted(!0),e.addTaintedNode(this),e.addBrowserEvent()}});for(const e of Reflect.ownKeys(X.prototype))Object.defineProperty(X.prototype,e,{enumerable:!1});const j=X;n.set("x_ite/Base/X3DEventObject",j);const k=j;function z(e,t,n){Object.defineProperties(this,{accessType:{value:e,enumerable:!0},dataType:{value:n.getType(),enumerable:!0},name:{value:t,enumerable:!0},value:{value:n}})}Object.setPrototypeOf(z.prototype,F.prototype);for(const e of Reflect.ownKeys(z.prototype))Object.defineProperty(z.prototype,e,{enumerable:!1});Object.defineProperties(z,{typeName:{value:"X3DFieldDefinition",enumerable:!0}});const G=z;n.set("x_ite/Base/X3DFieldDefinition",G);const H=G,q=Symbol(),Y=Symbol(),W=Symbol(),$={get(e,t){const n=e[t];if(void 0!==n)return n;if("string"==typeof t){const n=+t;return Number.isInteger(n)?e[q][n]:void 0}},set:(e,t,n)=>void 0!==e[t]&&(e[t]=n,!0),has:(e,t)=>Number.isInteger(+t)?t<e[q].length:t in e,ownKeys:e=>Object.keys(e[q]),getOwnPropertyDescriptor(e,t){if("string"!=typeof t)return;const n=+t;if(Number.isInteger(n)&&n<e[q].length){const n=Object.getOwnPropertyDescriptor(e[q],t);return n&&(n.writable=!1),n}}};function K(e,t){const n=new Proxy(this,$);A.call(this),this[q]=[],this[Y]=new Map,this[W]=t;for(const[t,n]of e)this.add(t,n);return n}Object.assign(Object.setPrototypeOf(K.prototype,A.prototype),{*[Symbol.iterator](){yield*this[q]},copy(){const e=new this.constructor;return e.assign(this),e},assign(e){if(!(e instanceof this.constructor))throw new Error("Couldn't assign info array, wrong type.");this[q]=Array.from(e[q]),this[Y]=new Map(e[Y]),this.addEvent()},equals(e){const t=this[q],n=e[q],i=t.length;if(t===n)return!0;if(i!==n.length)return!1;for(let e=0;e<i;++e)if(t[e]!==n[e])return!1;return!0},has(e){return this[Y].has(e)},get(e){return this[Y].get(e)},add(e,t){if(this[Y].has(e))throw new Error(`Couldn't add value to ${this.getTypeName()}, key '${e}' already exists.`);if(!(t instanceof this[W]))throw new Error(`Couldn't add value to ${this.getTypeName()}, value for key '${e}' has wrong type.`);this[q].push(t),this[Y].set(e,t),this.addEvent()},alias(e,t){this[Y].set(e,this[Y].get(t)),this.addEvent()},update(e,t,n){if(!(n instanceof this[W]))throw new Error(`Couldn't update value of ${this.getTypeName()}, value for key '${key}' has wrong type.`);const i=this[Y].get(e);if(e!==t&&this.remove(t),this[Y].delete(e),this[Y].set(t,n),void 0!==i){const e=this[q].indexOf(i);e>-1&&(this[q][e]=n)}else this[q].push(n);this.addEvent()},remove(e){const t=this[Y].get(e);if(void 0===t)return;const n=this[q].indexOf(t);this[Y].delete(e),n>-1&&this[q].splice(n,1),this.addEvent()},at:Array.prototype.at,entries:Array.prototype.entries,every:Array.prototype.every,filter(e,t){return new this.constructor(Array.prototype.filter.call(this,e,t))},find:Array.prototype.find,findIndex:Array.prototype.findIndex,findLast:Array.prototype.findLast,findLastIndex:Array.prototype.findLastIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:Array.prototype.keys,lastIndexOf:Array.prototype.lastIndexOf,map(e,t){return new this.constructor(Array.prototype.map.call(this,e,t))},reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice(e,t){return new this.constructor(Array.prototype.slice.call(this,e,t))},some:Array.prototype.some,toReversed(){return new this.constructor([...this].reverse())},toSorted(e){return new this.constructor([...this].sort(e))},toSpliced(e,t,...n){const i=[...this];return i.splice(e,t,...n),new this.constructor(i)},values:Array.prototype.values,with(e,t){const n=[...this];return n[e]=t,new this.constructor(n)},toVRMLStream(e){for(const t of this[q])try{t.toVRMLStream(e),e.string+=e.Break(),this.getTypeName().match(/Proto/)&&(e.string+=e.TidyBreak())}catch(e){}},toXMLStream(e){for(const t of this[q])try{t.toXMLStream(e),e.string+=e.TidyBreak()}catch(e){}},toJSONStream(e,t){let n=!1;for(const t of this[q])try{t.toJSONStream(e,!0),e.string+=",",e.string+=e.TidyBreak(),n=!0}catch(e){}return n&&!t&&e.JSONRemoveComma(),n}});for(const e of Reflect.ownKeys(K.prototype))Object.defineProperty(K.prototype,e,{enumerable:!1});Object.defineProperties(K.prototype,{length:{get(){return this[q].length}}});const J=K;n.set("x_ite/Base/X3DInfoArray",J);const Z=J;function Q(e=[]){return Z.call(this,Array.from(e,(e=>[e.name,e])),H)}Object.setPrototypeOf(Q.prototype,Z.prototype);for(const e of Reflect.ownKeys(Q.prototype))Object.defineProperty(Q.prototype,e,{enumerable:!1});Object.defineProperties(Q,{typeName:{value:"FieldDefinitionArray",enumerable:!0}});const ee=Q;n.set("x_ite/Base/FieldDefinitionArray",ee);const te=ee,ne=Symbol(),ie=Symbol(),se=Symbol(),re=Symbol(),oe=Symbol(),ae=Symbol(),le=Symbol(),ue=Symbol(),he=Symbol(),ce=Symbol(),de=Symbol.for("X_ITE.X3DField.uniformLocation");function pe(e){A.call(this),this[ne]=e}Object.assign(Object.setPrototypeOf(pe.prototype,A.prototype),{[ne]:null,[ie]:c.initializeOnly,[se]:null,[re]:new Set,[oe]:new Map,[ae]:new Set,[le]:new Map,[ue]:new Set,[he]:new Set,[ce]:new Map,[de]:null,create(){return new this.constructor},equals(e){return this[ne]===e.valueOf()},assign(e){this.set(e.getValue()),this.addEvent()},set(e){this[ne]=e},setValue(e){this.set(e instanceof this.constructor?e.getValue():e),this.addEvent()},getValue(){return this[ne]},getType(){return c[this.constructor.typeName]},setAccessType(e){this[ie]=e},getAccessType(){return this[ie]},isInitializable(){return!!(this[ie]&c.initializeOnly)},isInput(){return!!(this[ie]&c.inputOnly)},isOutput(){return!!(this[ie]&c.outputOnly)},isReadable(){return this[ie]!==c.inputOnly},isWritable(){return this[ie]!==c.outputOnly},setUnit(e){this[se]=e},getUnit(){return this[se]},hasReferences(){return 0!==this[re].size},isReference(e){return e===this[ie]||e===c.inputOutput},addReference(e){const t=this.getReferences();if(!t.has(e)){switch(t.add(e),this.getAccessType()&e.getAccessType()){case c.initializeOnly:e.addFieldInterest(this),this.assign(e);break;case c.inputOnly:e.addFieldInterest(this);break;case c.outputOnly:this.addFieldInterest(e);break;case c.inputOutput:e.addFieldInterest(this),this.addFieldInterest(e),this.assign(e)}this.processReferencesCallbacks()}},removeReference(e){switch(this.getReferences().delete(e),this.getAccessType()&e.getAccessType()){case c.initializeOnly:case c.inputOnly:e.removeFieldInterest(this);break;case c.outputOnly:this.removeFieldInterest(e);break;case c.inputOutput:e.removeFieldInterest(this),this.removeFieldInterest(e)}this.processReferencesCallbacks()},getReferences(){return this[re]===pe.prototype[re]&&(this[re]=new Set),this[re]},addReferencesCallback(e,t){this[oe]===pe.prototype[oe]&&(this[oe]=new Map),this[oe].set(e,t)},removeReferencesCallback(e){this[oe].delete(e)},getReferencesCallbacks(){return this[oe]},processReferencesCallbacks:function(){const e=[];return function(){if(this[oe].size)for(const t of b.values(e,this[oe]))t()}}(),addFieldInterest(e){this[ae]===pe.prototype[ae]&&(this[ae]=new Set),this[ae].add(e)},removeFieldInterest(e){this[ae].delete(e)},getFieldInterests(){return this[ae]},addFieldCallback(e,t){this[le]===pe.prototype[le]&&(this[le]=new Map),this[le].set(e,t)},removeFieldCallback(e){this[le].delete(e)},getFieldCallbacks(){return this[le]},addInputRoute(e){this[ue]===pe.prototype[ue]&&(this[ue]=new Set),this[ue].add(e),this.processRouteCallbacks()},removeInputRoute(e){this[ue].delete(e),this.processRouteCallbacks()},getInputRoutes(){return this[ue]},addOutputRoute(e){this[he]===pe.prototype[he]&&(this[he]=new Set),this[he].add(e),this.processRouteCallbacks()},removeOutputRoute(e){this[he].delete(e),this.processRouteCallbacks()},getOutputRoutes(){return this[he]},addRouteCallback(e,t){this[ce]===pe.prototype[ce]&&(this[ce]=new Map),this[ce].set(e,t)},removeRouteCallback(e){this[ce].delete(e)},getRouteCallbacks(){return this[ce]},processRouteCallbacks:function(){const e=[];return function(){if(this[ce].size)for(const t of b.values(e,this[ce]))t()}}(),processEvent:function(){const e=[];return function(t=B.create(this)){if(t.has(this))return;t.add(this),this.setTainted(!1);const n=t.field;n!==this&&this.set(n.getValue(),n.length),this.processInterests();let i=!0;for(const e of this[ae])i?(i=!1,e.addEventObject(this,t)):e.addEventObject(this,B.copy(t));if(i&&B.push(t),this[le].size)for(const t of b.values(e,this[le]))t(this.valueOf())}}(),addCloneCount:Function.prototype,removeCloneCount:Function.prototype,fromString(e,t){},dispose(){this[re].clear(),this[oe].clear(),this[ae].clear(),this[le].clear(),this[ce].clear();for(const e of new Set(this[ue]))e.dispose();for(const e of new Set(this[he]))e.dispose();A.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(pe.prototype))Object.defineProperty(pe.prototype,e,{enumerable:!1});const ge=pe;n.set("x_ite/Base/X3DField",ge);const fe=ge;function me(e=[]){return Z.call(this,Array.from(e,(e=>[e.getName(),e])),fe)}Object.setPrototypeOf(me.prototype,Z.prototype);for(const e of Reflect.ownKeys(me.prototype))Object.defineProperty(me.prototype,e,{enumerable:!1});Object.defineProperties(me,{typeName:{value:"FieldArray",enumerable:!0}});const _e=me;n.set("x_ite/Base/FieldArray",_e);const xe=_e;function ye(e){fe.call(this,!!e)}Object.assign(Object.setPrototypeOf(ye.prototype,fe.prototype),{copy(){return new ye(this.getValue())},isDefaultValue(){return!1===this.getValue()},set(e){fe.prototype.set.call(this,!!e)},valueOf:fe.prototype.getValue,toStream(e){e.string+=this.getValue()?"TRUE":"FALSE"},toVRMLStream(e){this.toStream(e)},toXMLStream(e){e.string+=this.getValue()?"true":"false"},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){e.string+=this.getValue()?"true":"false"}});for(const e of Reflect.ownKeys(ye.prototype))Object.defineProperty(ye.prototype,e,{enumerable:!1});Object.defineProperties(ye,{typeName:{value:"SFBool",enumerable:!0}});const we=ye;n.set("x_ite/Fields/SFBool",we);const be=we,{clamp:Se,interval:ve,degrees:Te}=f,Oe=Symbol.for("X_ITE.Color3.r"),Ee=Symbol.for("X_ITE.Color3.g"),Ce=Symbol.for("X_ITE.Color3.b");function Ne(e,t,n){this[Oe]=Se(e,0,1),this[Ee]=Se(t,0,1),this[Ce]=Se(n,0,1)}Object.assign(Ne.prototype,{*[Symbol.iterator](){yield this[Oe],yield this[Ee],yield this[Ce]},copy(){const e=Object.create(Ne.prototype);return e[Oe]=this[Oe],e[Ee]=this[Ee],e[Ce]=this[Ce],e},assign(e){return this[Oe]=e[Oe],this[Ee]=e[Ee],this[Ce]=e[Ce],this},set(e,t,n){return this[Oe]=Se(e,0,1),this[Ee]=Se(t,0,1),this[Ce]=Se(n,0,1),this},equals(e){return this[Oe]===e[Oe]&&this[Ee]===e[Ee]&&this[Ce]===e[Ce]},getHSV(e){let t,n,i;const s=Math.min(this[Oe],this[Ee],this[Ce]),r=Math.max(this[Oe],this[Ee],this[Ce]);i=r;const o=r-s;return 0!==r&&0!==o?(n=o/r,t=this[Oe]===r?(this[Ee]-this[Ce])/o:this[Ee]===r?2+(this[Ce]-this[Oe])/o:4+(this[Oe]-this[Ee])/o,t*=Math.PI/3,t<0&&(t+=2*Math.PI)):n=t=0,e[0]=t,e[1]=n,e[2]=i,e},setHSV(e,t,n){if(t=Se(t,0,1),n=Se(n,0,1),0===t)this[Oe]=this[Ee]=this[Ce]=n;else{const i=Te(ve(e,0,2*Math.PI))/60,s=Math.floor(i),r=i-s,o=n*(1-t),a=n*(1-t*r),l=n*(1-t*(1-r));switch(s%6){case 0:this[Oe]=n,this[Ee]=l,this[Ce]=o;break;case 1:this[Oe]=a,this[Ee]=n,this[Ce]=o;break;case 2:this[Oe]=o,this[Ee]=n,this[Ce]=l;break;case 3:this[Oe]=o,this[Ee]=a,this[Ce]=n;break;case 4:this[Oe]=l,this[Ee]=o,this[Ce]=n;break;default:this[Oe]=n,this[Ee]=o,this[Ce]=a}}return this},toString(){return this[Oe]+" "+this[Ee]+" "+this[Ce]}});const Fe={get(){return this[Oe]},set(e){this[Oe]=Se(e,0,1)}},Ie={get(){return this[Ee]},set(e){this[Ee]=Se(e,0,1)}},Me={get(){return this[Ce]},set(e){this[Ce]=Se(e,0,1)}};Object.defineProperties(Ne.prototype,{length:{value:3},0:Fe,1:Ie,2:Me,r:Object.assign({enumerable:!0},Fe),g:Object.assign({enumerable:!0},Ie),b:Object.assign({enumerable:!0},Me)}),Object.assign(Ne,{Black:new Ne(0,0,0),White:new Ne(1,1,1),HSV(e,t,n){const i=Object.create(this.prototype);return i.setHSV(e,t,n),i},lerp(e,t,n,i){let[s,r,o]=e,[a,l,u]=t;0===r&&(s=a),0===l&&(a=s);const h=Math.abs(a-s);if(h<=Math.PI)return i[0]=s+n*(a-s),i[1]=r+n*(l-r),i[2]=o+n*(u-o),i;const c=2*Math.PI,d=(c-h)*n;let p=s<a?s-d:s+d;return p<0?p+=c:p>c&&(p-=c),i[0]=p,i[1]=r+n*(l-r),i[2]=o+n*(u-o),i}});const Pe=Ne;n.set("standard/Math/Numbers/Color3",Pe);const De=Pe;function Re(e,t,n){switch(arguments.length){case 0:fe.call(this,new De(0,0,0));break;case 1:fe.call(this,arguments[0]);break;case 3:fe.call(this,new De(+e,+t,+n));break;default:throw new Error("Invalid arguments.")}}Object.assign(Object.setPrototypeOf(Re.prototype,fe.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new Re(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return this.getValue().equals(De.Black)},set(e){this.getValue().assign(e)},getHSV(){return this.getValue().getHSV([])},setHSV(e,t,n){this.getValue().setHSV(e,t,n),this.addEvent()},lerp:function(){const e=[],t=[],n=[];return function(i,s){const r=new Re;return this.getValue().getHSV(e),i.getValue().getHSV(t),De.lerp(e,t,s,n),r.setHSV(n[0],n[1],n[2]),r}}(),toStream(e){const t=this.getValue(),n=t.length-1;for(let i=0;i<n;++i)e.string+=e.FloatFormat(t[i]),e.string+=e.TidySpace();e.string+=e.FloatFormat(t[n])},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.TidySpace(),this.toJSONStreamValue(e),e.string+=e.TidySpace(),e.string+="]"},toJSONStreamValue(e){const t=this.getValue(),n=t.length-1;for(let i=0;i<n;++i)e.string+=e.JSONNumber(e.FloatFormat(t[i])),e.string+=",",e.string+=e.TidySpace();e.string+=e.JSONNumber(e.FloatFormat(t[n]))}});for(const e of Reflect.ownKeys(Re.prototype))Object.defineProperty(Re.prototype,e,{enumerable:!1});const Ae={get(){return this.getValue().r},set(e){this.getValue().r=+e,this.addEvent()}},Ve={get(){return this.getValue().g},set(e){this.getValue().g=+e,this.addEvent()}},Le={get(){return this.getValue().b},set(e){this.getValue().b=+e,this.addEvent()}};Object.defineProperties(Re.prototype,{0:Ae,1:Ve,2:Le,r:Object.assign({enumerable:!0},Ae),g:Object.assign({enumerable:!0},Ve),b:Object.assign({enumerable:!0},Le)}),Object.defineProperties(Re,{typeName:{value:"SFColor",enumerable:!0}});const Be=Re;n.set("x_ite/Fields/SFColor",Be);const Ue=Be,{clamp:Xe}=f,je=Symbol.for("X_ITE.Color3.r"),ke=Symbol.for("X_ITE.Color3.g"),ze=Symbol.for("X_ITE.Color3.b"),Ge=Symbol();function He(e,t,n,i){this[je]=Xe(e,0,1),this[ke]=Xe(t,0,1),this[ze]=Xe(n,0,1),this[Ge]=Xe(i,0,1)}Object.assign(He.prototype,{*[Symbol.iterator](){yield this[je],yield this[ke],yield this[ze],yield this[Ge]},copy(){const e=Object.create(He.prototype);return e[je]=this[je],e[ke]=this[ke],e[ze]=this[ze],e[Ge]=this[Ge],e},assign(e){return this[je]=e[je],this[ke]=e[ke],this[ze]=e[ze],this[Ge]=e[Ge],this},set(e,t,n,i){return this[je]=Xe(e,0,1),this[ke]=Xe(t,0,1),this[ze]=Xe(n,0,1),this[Ge]=Xe(i,0,1),this},equals(e){return this[je]===e[je]&&this[ke]===e[ke]&&this[ze]===e[ze]&&this[Ge]===e[Ge]},getHSVA(e){return De.prototype.getHSV.call(this,e),e[3]=this[Ge],e},setHSVA(e,t,n,i){return De.prototype.setHSV.call(this,e,t,n),this[Ge]=Xe(i,0,1),this},toString(){return this[je]+" "+this[ke]+" "+this[ze]+" "+this[Ge]}});const qe={get(){return this[je]},set(e){this[je]=Xe(e,0,1)}},Ye={get(){return this[ke]},set(e){this[ke]=Xe(e,0,1)}},We={get(){return this[ze]},set(e){this[ze]=Xe(e,0,1)}},$e={get(){return this[Ge]},set(e){this[Ge]=Xe(e,0,1)}};Object.defineProperties(He.prototype,{length:{value:4},0:qe,1:Ye,2:We,3:$e,r:Object.assign({enumerable:!0},qe),g:Object.assign({enumerable:!0},Ye),b:Object.assign({enumerable:!0},We),a:Object.assign({enumerable:!0},$e)}),Object.assign(He,{Transparent:new He(0,0,0,0),Black:new He(0,0,0,1),White:new He(1,1,1,1),HSVA(e,t,n,i){const s=Object.create(this.prototype);return s.setHSVA(e,t,n,i),s},lerp(e,t,n,i){const s=e[3];return De.lerp(e,t,n,i),i[3]=s+n*(t[3]-s),i}});const Ke=He;n.set("standard/Math/Numbers/Color4",Ke);const Je=Ke;function Ze(e,t,n,i){switch(arguments.length){case 0:fe.call(this,new Je(0,0,0,0));break;case 1:fe.call(this,arguments[0]);break;case 4:fe.call(this,new Je(+e,+t,+n,+i));break;default:throw new Error("Invalid arguments.")}}Object.assign(Object.setPrototypeOf(Ze.prototype,fe.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new Ze(this.getValue().copy())},equals:Ue.prototype.equals,isDefaultValue(){return this.getValue().equals(Je.Transparent)},set:Ue.prototype.set,getHSVA(){return this.getValue().getHSVA([])},setHSVA(e,t,n,i){this.getValue().setHSVA(e,t,n,i),this.addEvent()},lerp:function(){const e=[],t=[],n=[];return function(i,s){const r=new Ze;return this.getValue().getHSVA(e),i.getValue().getHSVA(t),Je.lerp(e,t,s,n),r.setHSVA(n[0],n[1],n[2],n[3]),r}}(),toStream:Ue.prototype.toStream,toVRMLStream:Ue.prototype.toVRMLStream,toXMLStream:Ue.prototype.toXMLStream,toJSONStream:Ue.prototype.toJSONStream,toJSONStreamValue:Ue.prototype.toJSONStreamValue});for(const e of Reflect.ownKeys(Ze.prototype))Object.defineProperty(Ze.prototype,e,{enumerable:!1});const Qe={get(){return this.getValue().r},set(e){this.getValue().r=+e,this.addEvent()}},et={get(){return this.getValue().g},set(e){this.getValue().g=+e,this.addEvent()}},tt={get(){return this.getValue().b},set(e){this.getValue().b=+e,this.addEvent()}},nt={get(){return this.getValue().a},set(e){this.getValue().a=+e,this.addEvent()}};Object.defineProperties(Ze.prototype,{0:Qe,1:et,2:tt,3:nt,r:Object.assign({enumerable:!0},Qe),g:Object.assign({enumerable:!0},et),b:Object.assign({enumerable:!0},tt),a:Object.assign({enumerable:!0},nt)}),Object.defineProperties(Ze,{typeName:{value:"SFColorRGBA",enumerable:!0}});const it=Ze;n.set("x_ite/Fields/SFColorRGBA",it);const st=it;function rt(e){fe.call(this,arguments.length?+e:0)}Object.assign(Object.setPrototypeOf(rt.prototype,fe.prototype),{copy(){return new rt(this.getValue())},isDefaultValue(){return 0===this.getValue()},set(e){fe.prototype.set.call(this,+e)},valueOf:fe.prototype.getValue,toStream(e){const t=e.Unit(this.getUnit());e.string+=e.DoubleFormat(e.ToUnit(t,this.getValue()))},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){const t=e.Unit(this.getUnit());e.string+=e.JSONNumber(e.DoubleFormat(e.ToUnit(t,this.getValue())))}});for(const e of Reflect.ownKeys(rt.prototype))Object.defineProperty(rt.prototype,e,{enumerable:!1});Object.defineProperties(rt,{typeName:{value:"SFDouble",enumerable:!0}});const ot=rt;n.set("x_ite/Fields/SFDouble",ot);const at=ot;function lt(e){fe.call(this,arguments.length?+e:0)}Object.assign(Object.setPrototypeOf(lt.prototype,fe.prototype),{copy(){return new lt(this.getValue())},isDefaultValue(){return 0===this.getValue()},set(e){fe.prototype.set.call(this,+e)},valueOf:fe.prototype.getValue,toStream(e){const t=e.Unit(this.getUnit());e.string+=e.FloatFormat(e.ToUnit(t,this.getValue()))},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){const t=e.Unit(this.getUnit());e.string+=e.JSONNumber(e.FloatFormat(e.ToUnit(t,this.getValue())))}});for(const e of Reflect.ownKeys(lt.prototype))Object.defineProperty(lt.prototype,e,{enumerable:!1});Object.defineProperties(lt,{typeName:{value:"SFFloat",enumerable:!0}});const ut=lt;n.set("x_ite/Fields/SFFloat",ut);const ht=ut;function ct(e){fe.call(this,0|e)}Object.assign(Object.setPrototypeOf(ct.prototype,fe.prototype),{copy(){return new ct(this.getValue())},isDefaultValue(){return 0===this.getValue()},set(e){fe.prototype.set.call(this,0|e)},valueOf:fe.prototype.getValue,toStream(e){e.string+=this.getValue().toString()},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){this.toStream(e)},toJSONStreamValue(e){this.toStream(e)}});for(const e of Reflect.ownKeys(ct.prototype))Object.defineProperty(ct.prototype,e,{enumerable:!1});Object.defineProperties(ct,{typeName:{value:"SFInt32",enumerable:!0}});const dt=ct;n.set("x_ite/Fields/SFInt32",dt);const pt=dt;const gt=function(e,t,n,i,s){const r=s?"DoubleFormat":"FloatFormat";return Object.defineProperties(e,{typeName:{value:t,enumerable:!0}}),Object.assign(Object.setPrototypeOf(e.prototype,fe.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new this.constructor(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return this.getValue().equals(n.Identity)},set(e){this.getValue().assign(e)},setTransform(e,t,n,i,s){e=e?e.getValue():null,t=t?t.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,s=s?s.getValue():null,this.getValue().set(e,t,n,i,s)},getTransform(e,t,n,i,s){e=e?e.getValue():null,t=t?t.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,s=s?s.getValue():null,this.getValue().get(e,t,n,i,s)},determinant(){return this.getValue().determinant()},transpose(){return new this.constructor(this.getValue().copy().transpose())},inverse(){return new this.constructor(this.getValue().copy().inverse())},multLeft(e){return new this.constructor(this.getValue().copy().multLeft(e.getValue()))},multRight(e){return new this.constructor(this.getValue().copy().multRight(e.getValue()))},multVecMatrix(e){return new i(this.getValue().multVecMatrix(e.getValue().copy()))},multMatrixVec(e){return new i(this.getValue().multMatrixVec(e.getValue().copy()))},multDirMatrix(e){return new i(this.getValue().multDirMatrix(e.getValue().copy()))},multMatrixDir(e){return new i(this.getValue().multMatrixDir(e.getValue().copy()))},toStream(e){const t=this.getValue(),n=t.length-1;for(let i=0;i<n;++i)e.string+=e[r](t[i]),e.string+=e.TidySpace();e.string+=e[r](t[n])},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.TidySpace(),this.toJSONStreamValue(e),e.string+=e.TidySpace(),e.string+="]"},toJSONStreamValue(e){const t=this.getValue(),n=t.length-1;for(let i=0;i<n;++i)e.string+=e.JSONNumber(e[r](t[i])),e.string+=",",e.string+=e.TidySpace();e.string+=e.JSONNumber(e[r](t[n]))}})};n.set("x_ite/Fields/SFMatrixPrototypeTemplate",gt);const ft=gt;const mt=function(e,t,n,i){const s=i?"DoubleFormat":"FloatFormat";return Object.defineProperties(e,{typeName:{value:t,enumerable:!0}}),Object.assign(Object.setPrototypeOf(e.prototype,fe.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new this.constructor(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return this.getValue().equals(n.Zero)},set(e){this.getValue().assign(e)},abs(){return new this.constructor(this.getValue().copy().abs())},add(e){return new this.constructor(this.getValue().copy().add(e.getValue()))},distance(e){return this.getValue().distance(e.getValue())},divide(e){return new this.constructor(this.getValue().copy().divide(e))},divVec(e){return new this.constructor(this.getValue().copy().divVec(e.getValue()))},dot(e){return this.getValue().dot(e.getValue())},inverse(){return new this.constructor(this.getValue().copy().inverse())},length(){return this.getValue().magnitude()},lerp(e,t){return new this.constructor(this.getValue().copy().lerp(e,t))},max(e){return new this.constructor(this.getValue().copy().max(e.getValue()))},min(e){return new this.constructor(this.getValue().copy().min(e.getValue()))},multiply(e){return new this.constructor(this.getValue().copy().multiply(e))},multVec(e){return new this.constructor(this.getValue().copy().multVec(e.getValue()))},negate(){return new this.constructor(this.getValue().copy().negate())},normalize(e){return new this.constructor(this.getValue().copy().normalize())},subtract(e){return new this.constructor(this.getValue().copy().subtract(e.getValue()))},toStream(e){const t=this.getValue(),n=t.length-1,i=e.Unit(this.getUnit());for(let r=0;r<n;++r)e.string+=e[s](e.ToUnit(i,t[r])),e.string+=e.TidySpace();e.string+=e[s](e.ToUnit(i,t[n]))},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.TidySpace(),this.toJSONStreamValue(e),e.string+=e.TidySpace(),e.string+="]"},toJSONStreamValue(e){const t=this.getValue(),n=t.length-1,i=e.Unit(this.getUnit());for(let r=0;r<n;++r)e.string+=e.JSONNumber(e[s](e.ToUnit(i,t[r]))),e.string+=",",e.string+=e.TidySpace();e.string+=e.JSONNumber(e[s](e.ToUnit(i,t[n])))}})};n.set("x_ite/Fields/SFVecPrototypeTemplate",mt);const _t=mt;function xt(e,t){this.x=e,this.y=t}Object.assign(xt.prototype,{*[Symbol.iterator](){yield this.x,yield this.y},copy(){const e=Object.create(xt.prototype);return e.x=this.x,e.y=this.y,e},assign(e){return this.x=e.x,this.y=e.y,this},set(e,t){return this.x=e,this.y=t,this},equals(e){return this.x===e.x&&this.y===e.y},negate(){return this.x=-this.x,this.y=-this.y,this},inverse(){return this.x=1/this.x,this.y=1/this.y,this},add(e){return this.x+=e.x,this.y+=e.y,this},subtract(e){return this.x-=e.x,this.y-=e.y,this},multiply(e){return this.x*=e,this.y*=e,this},multVec(e){return this.x*=e.x,this.y*=e.y,this},divide(e){return this.x/=e,this.y/=e,this},divVec(e){return this.x/=e.x,this.y/=e.y,this},normalize(){const e=Math.hypot(this.x,this.y);return e&&(this.x/=e,this.y/=e),this},dot(e){return this.x*e.x+this.y*e.y},norm(){const{x:e,y:t}=this;return e*e+t*t},magnitude(){return Math.hypot(this.x,this.y)},distance(e){return Math.hypot(this.x-e.x,this.y-e.y)},lerp(e,t){const{x:n,y:i}=this;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this},abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},min(e){let{x:t,y:n}=this;for(const e of arguments)t=Math.min(t,e.x),n=Math.min(n,e.y);return this.x=t,this.y=n,this},max(e){let{x:t,y:n}=this;for(const e of arguments)t=Math.max(t,e.x),n=Math.max(n,e.y);return this.x=t,this.y=n,this},toString(){return this.x+" "+this.y}}),Object.defineProperties(xt.prototype,{length:{value:2},0:{get(){return this.x},set(e){this.x=e}},1:{get(){return this.y},set(e){this.y=e}}}),Object.assign(xt,{Zero:new xt(0,0),One:new xt(1,1),xAxis:new xt(1,0),yAxis:new xt(0,1)});const yt=xt;n.set("standard/Math/Numbers/Vector2",yt);const wt=yt;function bt(e,t){function n(e,t){switch(arguments.length){case 0:fe.call(this,new wt(0,0));break;case 1:fe.call(this,arguments[0]);break;case 2:fe.call(this,new wt(+e,+t));break;default:throw new Error("Invalid arguments.")}}_t(n,e,wt,t);for(const e of Reflect.ownKeys(n.prototype))Object.defineProperty(n.prototype,e,{enumerable:!1});const i={get(){return this.getValue().x},set(e){this.getValue().x=+e,this.addEvent()}},s={get(){return this.getValue().y},set(e){this.getValue().y=+e,this.addEvent()}};return Object.defineProperties(n.prototype,{0:i,1:s,x:Object.assign({enumerable:!0},i),y:Object.assign({enumerable:!0},s)}),n}const St={SFVec2d:bt("SFVec2d",!0),SFVec2f:bt("SFVec2f",!1)};n.set("x_ite/Fields/SFVec2",St);const vt=St;function Tt(e,t,n){this.x=e,this.y=t,this.z=n}Object.assign(Tt.prototype,{*[Symbol.iterator](){yield this.x,yield this.y,yield this.z},copy(){const e=Object.create(Tt.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e},assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},set(e,t,n){return this.x=e,this.y=t,this.z=n,this},equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},inverse(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply(e){return this.x*=e,this.y*=e,this.z*=e,this},multVec(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},divide(e){return this.x/=e,this.y/=e,this.z/=e,this},divVec(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},cross(e){const{x:t,y:n,z:i}=this,{x:s,y:r,z:o}=e;return this.x=n*o-i*r,this.y=i*s-t*o,this.z=t*r-n*s,this},normalize(){const e=Math.hypot(this.x,this.y,this.z);return e&&(this.x/=e,this.y/=e,this.z/=e),this},dot(e){return this.x*e.x+this.y*e.y+this.z*e.z},norm(){const{x:e,y:t,z:n}=this;return e*e+t*t+n*n},magnitude(){return Math.hypot(this.x,this.y,this.z)},distance(e){return Math.hypot(this.x-e.x,this.y-e.y,this.z-e.z)},lerp(e,t){const{x:n,y:i,z:s}=this;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=s+t*(e.z-s),this},slerp:function(){const e=new Tt(0,0,0);return function(t,n){return f.simpleSlerp(this,e.assign(t),n)}}(),abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},min(e){let{x:t,y:n,z:i}=this;for(const e of arguments)t=Math.min(t,e.x),n=Math.min(n,e.y),i=Math.min(i,e.z);return this.x=t,this.y=n,this.z=i,this},max(e){let{x:t,y:n,z:i}=this;for(const e of arguments)t=Math.max(t,e.x),n=Math.max(n,e.y),i=Math.max(i,e.z);return this.x=t,this.y=n,this.z=i,this},toString(){return this.x+" "+this.y+" "+this.z}}),Object.defineProperties(Tt.prototype,{length:{value:3},0:{get(){return this.x},set(e){this.x=e}},1:{get(){return this.y},set(e){this.y=e}},2:{get(){return this.z},set(e){this.z=e}}}),Object.assign(Tt,{Zero:new Tt(0,0,0),One:new Tt(1,1,1),xAxis:new Tt(1,0,0),yAxis:new Tt(0,1,0),zAxis:new Tt(0,0,1)});const Ot=Tt;n.set("standard/Math/Numbers/Vector3",Ot);const Et=Ot;function Ct(){if(arguments.length)for(let e=0;e<4;++e)this[e]=arguments[e];else this.identity()}Object.assign(Ct.prototype,{*[Symbol.iterator](){for(let e=0;e<4;++e)yield this[e]},copy(){const e=Object.create(Ct.prototype);for(let t=0;t<4;++t)e[t]=this[t];return e},assign(e){for(let t=0;t<4;++t)this[t]=e[t];return this},equals(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]},set1(e,t,n){this[e*this.order+t]=n},get1(e,t){return this[e*this.order+t]},set(){switch(arguments.length){case 0:this.identity();break;case 4:for(let e=0;e<4;++e)this[e]=arguments[e]}return this},determinant1(){return this[0]},determinant(){return this[0]*this[3]-this[1]*this[2]},transpose(){const e=this[1];return this[1]=this[2],this[2]=e,this},inverse(){const{0:e,1:t,2:n,3:i}=this,s=e*i-t*n;return this[0]=i/s,this[1]=-t/s,this[2]=-n/s,this[3]=e/s,this},multLeft(e){const{0:t,1:n,2:i,3:s}=this,{0:r,1:o,2:a,3:l}=e;return this[0]=t*r+i*o,this[1]=n*r+s*o,this[2]=t*a+i*l,this[3]=n*a+s*l,this},multRight(e){const{0:t,1:n,2:i,3:s}=this,{0:r,1:o,2:a,3:l}=e;return this[0]=r*t+a*n,this[1]=o*t+l*n,this[2]=r*i+a*s,this[3]=o*i+l*s,this},multVecMatrix(e){if("number"==typeof e){const t=e,n=t*this[1]+this[3];return(t*this[0]+this[2])/n}{const{x:t,y:n}=e;return e.x=t*this[0]+n*this[2],e.y=t*this[1]+n*this[3],e}},multMatrixVec(e){if("number"==typeof e){const t=e,n=t*this[2]+this[3];return(t*this[0]+this[1])/n}{const{x:t,y:n}=e;return e.x=t*this[0]+n*this[1],e.y=t*this[2]+n*this[3],e}},identity(){this[0]=1,this[1]=0,this[2]=0,this[3]=1},toString(){return Array.prototype.join.call(this," ")}}),Object.defineProperties(Ct.prototype,{order:{value:2},length:{value:4},x:{get:function(){const e=new wt(0,0);return function(){return e.set(this[0],this[1])}}()},y:{get:function(){const e=new wt(0,0);return function(){return e.set(this[2],this[3])}}()},xAxis:{get(){return this[0]}},origin:{get(){return this[2]}},submatrix:{get(){return this[0]}}}),Object.assign(Ct,{Identity:new Ct});const Nt=Ct;n.set("standard/Math/Numbers/Matrix2",Nt);const Ft=Nt,It=[],Mt=[],Pt=[];const Dt=function(e,t){const n=e.order,i=e.length,s=t.values,r=t.vectors;let o,a,l,u,h,c,d,p,g,f,m,_,x;for(_=0;_<n;++_)for(It[_]=It[_]??[],Mt[_]=s[_]=e.get1(_,_),Pt[_]=0,x=0;x<n;++x)r[_][x]=_===x?1:0,It[_][x]=e.get1(x,_);for(_=0;_<50;++_){for(o=0,f=0;f<n-1;++f)for(m=f+1;m<n;++m)o+=Math.abs(It[f][m]);if(0===o)break;for(g=_<3?.2*o/i:0,f=0;f<n-1;++f)for(m=f+1;m<n;++m)if(p=100*Math.abs(It[f][m]),_>3&&Math.abs(s[f])+p===Math.abs(s[f])&&Math.abs(s[m])+p===Math.abs(s[m]))It[f][m]=0;else if(Math.abs(It[f][m])>g){for(d=s[m]-s[f],Math.abs(d)+p===Math.abs(d)?h=It[f][m]/d:(a=.5*d/It[f][m],h=1/(Math.abs(a)+Math.sqrt(1+a*a)),a<0&&(h=-h)),l=1/Math.sqrt(1+h*h),u=h*l,c=u/(1+l),d=h*It[f][m],Pt[f]-=d,Pt[m]+=d,s[f]-=d,s[m]+=d,It[f][m]=0,x=0;x<f;++x)p=It[x][f],d=It[x][m],It[x][f]=p-u*(d+p*c),It[x][m]=d+u*(p-d*c);for(x=f+1;x<m;++x)p=It[f][x],d=It[x][m],It[f][x]=p-u*(d+p*c),It[x][m]=d+u*(p-d*c);for(x=m+1;x<n;++x)p=It[f][x],d=It[m][x],It[f][x]=p-u*(d+p*c),It[m][x]=d+u*(p-d*c);for(x=0;x<n;++x)p=r[x][f],d=r[x][m],r[x][f]=p-u*(d+p*c),r[x][m]=d+u*(p-d*c)}for(f=0;f<n;++f)s[f]=Mt[f]+=Pt[f],Pt[f]=0}return t};n.set("standard/Math/Algorithms/eigen_decomposition",Dt);const Rt=Dt;function At(){if(arguments.length)for(let e=0;e<9;++e)this[e]=arguments[e];else this.identity()}Object.assign(At.prototype,{*[Symbol.iterator](){for(let e=0;e<9;++e)yield this[e]},copy(){const e=Object.create(At.prototype);for(let t=0;t<9;++t)e[t]=this[t];return e},assign(e){for(let t=0;t<9;++t)this[t]=e[t];return this},equals(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]&&this[4]===e[4]&&this[5]===e[5]&&this[6]===e[6]&&this[7]===e[7]&&this[8]===e[8]},rotation(){return Math.atan2(this[1],this[0])},set1(e,t,n){return this[e*this.order+t]=n,this},get1(e,t){return this[e*this.order+t]},set:function(){const e=new wt(0,0);return function(t,n,i,s,r){switch(arguments.length){case 0:this.identity();break;case 1:null===t&&(t=wt.Zero),this.identity(),this.translate(t);break;case 2:null===t&&(t=wt.Zero),null===n&&(n=0),this.identity(),this.translate(t),0!==n&&this.rotate(n);break;case 3:null===t&&(t=wt.Zero),null===n&&(n=0),null===i&&(i=wt.One),this.identity(),this.translate(t),0!==n&&this.rotate(n),i.equals(wt.One)||this.scale(i);break;case 4:if(null===t&&(t=wt.Zero),null===n&&(n=0),null===i&&(i=wt.One),null===s&&(s=0),this.identity(),this.translate(t),0!==n&&this.rotate(n),!i.equals(wt.One)){0!==s?(this.rotate(s),this.scale(i),this.rotate(-s)):this.scale(i)}break;case 5:{null===t&&(t=wt.Zero),null===n&&(n=0),null===i&&(i=wt.One),null===s&&(s=0),null===r&&(r=wt.Zero),this.identity(),this.translate(t);const o=!r.equals(wt.Zero);o&&this.translate(r),0!==n&&this.rotate(n),i.equals(wt.One)||(0!==s?(this.rotate(s),this.scale(i),this.rotate(-s)):this.scale(i)),o&&this.translate(e.assign(r).negate());break}case 9:for(let e=0;e<9;++e)this[e]=arguments[e]}return this}}(),get:function(){const e=new wt(0,0),t=new Et(0,0,0),n=new wt(0,0),i=new Et(0,0,0),s=new wt(0,0),r=new Ft,o=new Ft,a=new wt(0,0);return function(l,u,h,c,d){switch(null===l&&(l=e),null===u&&(u=t),null===h&&(h=n),null===c&&(c=i),null===d&&(d=s),arguments.length){case 1:l.set(this[6],this[7]);break;case 2:this.factor(l,r,n,o),u[0]=r[0],u[1]=r[1],u[2]=Math.atan2(r[1],r[0]);break;case 3:this.factor(l,r,h,o),u[0]=r[0],u[1]=r[1],u[2]=Math.atan2(r[1],r[0]);break;case 4:this.factor(l,r,h,o),u[0]=r[0],u[1]=r[1],u[2]=Math.atan2(r[1],r[0]),c[0]=o[0],c[1]=o[1],c[2]=Math.atan2(o[1],o[0]);break;case 5:Vt.set(a.assign(d).negate()),Vt.multLeft(this),Vt.translate(d),Vt.get(l,u,h,c)}}}(),factor:function(){const e=new Ft,t=new Ft,n=new Ft,i={values:[],vectors:[[],[]]};return function(s,r,o,a){s.set(this[6],this[7]);const l=this.submatrix,u=l.determinant()<0?-1:1;n.assign(l).transpose().multLeft(l);const h=Rt(n,i);a.set(h.vectors[0][0],h.vectors[1][0],h.vectors[0][1],h.vectors[1][1]),o.x=u*Math.sqrt(h.values[0]),o.y=u*Math.sqrt(h.values[1]),e[0]=1/o.x,e[3]=1/o.y,r.assign(t.assign(a).transpose().multRight(e).multRight(a).multRight(l))}}(),determinant2(){return this[0]*this[4]-this[1]*this[3]},determinant(){const{0:e,1:t,2:n,3:i,4:s,5:r,6:o,7:a,8:l}=this;return e*(s*l-r*a)-t*(i*l-r*o)+n*(i*a-s*o)},transpose(){let e;return e=this[1],this[1]=this[3],this[3]=e,e=this[2],this[2]=this[6],this[6]=e,e=this[5],this[5]=this[7],this[7]=e,this},inverse(){const{0:e,1:t,2:n,3:i,4:s,5:r,6:o,7:a,8:l}=this,u=e*s,h=e*a,c=i*t,d=i*a,p=o*t,g=o*s;let f=u*l-h*r-c*l+d*n+p*r-g*n;f=1/f;const m=(s*l-a*r)*f,_=-(t*l-a*n)*f,x=(t*r-s*n)*f,y=-(i*l-o*r)*f,w=(e*l-o*n)*f,b=-(e*r-i*n)*f;return this[0]=m,this[1]=_,this[2]=x,this[3]=y,this[4]=w,this[5]=b,this[6]=(d-g)*f,this[7]=-(h-p)*f,this[8]=(u-c)*f,this},multLeft(e){const{0:t,1:n,2:i,3:s,4:r,5:o,6:a,7:l,8:u}=this,{0:h,1:c,2:d,3:p,4:g,5:f,6:m,7:_,8:x}=e;return this[0]=t*h+s*c+a*d,this[1]=n*h+r*c+l*d,this[2]=i*h+o*c+u*d,this[3]=t*p+s*g+a*f,this[4]=n*p+r*g+l*f,this[5]=i*p+o*g+u*f,this[6]=t*m+s*_+a*x,this[7]=n*m+r*_+l*x,this[8]=i*m+o*_+u*x,this},multRight(e){const{0:t,1:n,2:i,3:s,4:r,5:o,6:a,7:l,8:u}=this,{0:h,1:c,2:d,3:p,4:g,5:f,6:m,7:_,8:x}=e;return this[0]=t*h+n*p+i*m,this[1]=t*c+n*g+i*_,this[2]=t*d+n*f+i*x,this[3]=s*h+r*p+o*m,this[4]=s*c+r*g+o*_,this[5]=s*d+r*f+o*x,this[6]=a*h+l*p+u*m,this[7]=a*c+l*g+u*_,this[8]=a*d+l*f+u*x,this},multVecMatrix(e){if(2===e.length){const{x:t,y:n}=e,i=t*this[2]+n*this[5]+this[8];return e.x=(t*this[0]+n*this[3]+this[6])/i,e.y=(t*this[1]+n*this[4]+this[7])/i,e}{const{x:t,y:n,z:i}=e;return e.x=t*this[0]+n*this[3]+i*this[6],e.y=t*this[1]+n*this[4]+i*this[7],e.z=t*this[2]+n*this[5]+i*this[8],e}},multMatrixVec(e){if(2===e.length){const{x:t,y:n}=e,i=t*this[6]+n*this[7]+this[8];return e.x=(t*this[0]+n*this[1]+this[2])/i,e.y=(t*this[3]+n*this[4]+this[5])/i,e}{const{x:t,y:n,z:i}=e;return e.x=t*this[0]+n*this[1]+i*this[2],e.y=t*this[3]+n*this[4]+i*this[5],e.z=t*this[6]+n*this[7]+i*this[8],e}},multDirMatrix(e){const{x:t,y:n}=e;return e.x=t*this[0]+n*this[3],e.y=t*this[1]+n*this[4],e},multMatrixDir(e){const{x:t,y:n}=e;return e.x=t*this[0]+n*this[1],e.y=t*this[3]+n*this[4],e},identity(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this[6]=0,this[7]=0,this[8]=1,this},translate(e){const{x:t,y:n}=e;return this[6]+=this[0]*t+this[3]*n,this[7]+=this[1]*t+this[4]*n,this},rotate(e){return this.multLeft(At.Rotation(e))},scale(e){const{x:t,y:n}=e;return this[0]*=t,this[3]*=n,this[1]*=t,this[4]*=n,this},skewX(e){const t=Math.tan(e);return this[3]+=this[0]*t,this[4]+=this[1]*t,this[5]+=this[2]*t,this},skewY(e){const t=Math.tan(e);return this[0]+=this[3]*t,this[1]+=this[4]*t,this[2]+=this[5]*t,this},toString(){return Array.prototype.join.call(this," ")}}),Object.defineProperties(At.prototype,{order:{value:3},length:{value:9},x:{get:function(){const e=new Et(0,0,0);return function(){return e.set(this[0],this[1],this[2])}}()},y:{get:function(){const e=new Et(0,0,0);return function(){return e.set(this[3],this[4],this[5])}}()},z:{get:function(){const e=new Et(0,0,0);return function(){return e.set(this[6],this[7],this[8])}}()},xAxis:{get:function(){const e=new wt(0,0);return function(){return e.set(this[0],this[1])}}()},yAxis:{get:function(){const e=new wt(0,0);return function(){return e.set(this[3],this[4])}}()},origin:{get:function(){const e=new wt(0,0);return function(){return e.set(this[6],this[7])}}()},submatrix:{get:function(){const e=new Ft;return function(){return e[0]=this[0],e[1]=this[1],e[2]=this[3],e[3]=this[4],e}}()}}),Object.assign(At,{Identity:new At,Rotation(e){const t=Math.sin(e),n=Math.cos(e);return new At(n,t,0,-t,n,0,0,0,1)},Matrix2:e=>new At(e[0],e[1],0,e[2],e[3],0,0,0,1)});const Vt=new At,Lt=At;n.set("standard/Math/Numbers/Matrix3",Lt);const Bt=Lt;function Ut(e,t,n){function i(e,t,n,i,s,r,o,a,l){switch(arguments.length){case 0:fe.call(this,new Bt);break;case 1:fe.call(this,arguments[0]);break;case 3:{const e=arguments[0],t=arguments[1],n=arguments[2];fe.call(this,new Bt(e.x,e.y,e.z,t.x,t.y,t.z,n.x,n.y,n.z));break}case 9:fe.call(this,new Bt(+e,+t,+n,+i,+s,+r,+o,+a,+l));break;default:throw new Error("Invalid arguments.")}}Object.assign(ft(i,e,Bt,t,n),{setTransform(e,t,n,i,s){e=e?e.getValue():null,t=t||0,n=n?n.getValue():null,i=i||0,s=s?s.getValue():null,this.getValue().set(e,t,n,i,s)}});for(const e of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,e,{enumerable:!1});function s(e){Object.defineProperty(i.prototype,e,{get(){return this.getValue()[e]},set(t){this.getValue()[e]=+t,this.addEvent()},enumerable:!0})}for(let e=0,t=Bt.prototype.length;e<t;++e)s(e);return i}const Xt={SFMatrix3d:Ut("SFMatrix3d",vt.SFVec2d,!0),SFMatrix3f:Ut("SFMatrix3f",vt.SFVec2f,!1)};n.set("x_ite/Fields/SFMatrix3",Xt);const jt=Xt;function kt(e,t){function n(e,t,n){switch(arguments.length){case 0:fe.call(this,new Et(0,0,0));break;case 1:fe.call(this,arguments[0]);break;case 3:fe.call(this,new Et(+e,+t,+n));break;default:throw new Error("Invalid arguments.")}}Object.assign(_t(n,e,Et,t),{cross(e){return new this.constructor(this.getValue().copy().cross(e.getValue()))}});for(const e of Reflect.ownKeys(n.prototype))Object.defineProperty(n.prototype,e,{enumerable:!1});const i={get(){return this.getValue().x},set(e){this.getValue().x=+e,this.addEvent()}},s={get(){return this.getValue().y},set(e){this.getValue().y=+e,this.addEvent()}},r={get(){return this.getValue().z},set(e){this.getValue().z=+e,this.addEvent()}};return Object.defineProperties(n.prototype,{0:i,1:s,2:r,x:Object.assign({enumerable:!0},i),y:Object.assign({enumerable:!0},s),z:Object.assign({enumerable:!0},r)}),n}const zt={SFVec3d:kt("SFVec3d",!0),SFVec3f:kt("SFVec3f",!1)};n.set("x_ite/Fields/SFVec3",zt);const Gt=zt;function Ht(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i}Object.assign(Ht.prototype,{*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w},copy(){const e=Object.create(Ht.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},getReal(e){return e.x=this.x/this.w,e.y=this.y/this.w,e.z=this.z/this.w,e},negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this.w=1/this.w,this},add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiply(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},multVec(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},divide(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this},divVec(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},normalize(){const e=Math.hypot(this.x,this.y,this.z,this.w);return e&&(this.x/=e,this.y/=e,this.z/=e,this.w/=e),this},dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},norm(){const{x:e,y:t,z:n,w:i}=this;return e*e+t*t+n*n+i*i},magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)},distance(e){return Math.hypot(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},lerp(e,t){const{x:n,y:i,z:s,w:r}=this;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=s+t*(e.z-s),this.w=r+t*(e.w-r),this},abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},min(e){let{x:t,y:n,z:i,w:s}=this;for(const e of arguments)t=Math.min(t,e.x),n=Math.min(n,e.y),i=Math.min(i,e.z),s=Math.min(s,e.w);return this.x=t,this.y=n,this.z=i,this.w=s,this},max(e){let{x:t,y:n,z:i,w:s}=this;for(const e of arguments)t=Math.max(t,e.x),n=Math.max(n,e.y),i=Math.max(i,e.z),s=Math.max(s,e.w);return this.x=t,this.y=n,this.z=i,this.w=s,this},toString(){return this.x+" "+this.y+" "+this.z+" "+this.w}}),Object.defineProperties(Ht.prototype,{length:{value:4},0:{get(){return this.x},set(e){this.x=e}},1:{get(){return this.y},set(e){this.y=e}},2:{get(){return this.z},set(e){this.z=e}},3:{get(){return this.w},set(e){this.w=e}}}),Object.assign(Ht,{Zero:new Ht(0,0,0,0),One:new Ht(1,1,1,1),xAxis:new Ht(1,0,0,0),yAxis:new Ht(0,1,0,0),zAxis:new Ht(0,0,1,0),wAxis:new Ht(0,0,0,1)});const qt=Ht;n.set("standard/Math/Numbers/Vector4",qt);const Yt=qt;function Wt(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i}Object.assign(Wt.prototype,{*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w},copy(){const e=Object.create(Wt.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setMatrix(e){if(e[0]>e[4])var t=e[0]>e[8]?0:2;else t=e[4]>e[8]?1:2;const n=e[0]+e[4]+e[8];if(n>e[3*t+t]){this[3]=Math.sqrt(n+1)/2;const t=4*this[3];this[0]=(e[5]-e[7])/t,this[1]=(e[6]-e[2])/t,this[2]=(e[1]-e[3])/t}else{const n=(t+1)%3,i=(t+2)%3;this[t]=Math.sqrt(e[3*t+t]-e[3*n+n]-e[3*i+i]+1)/2;const s=4*this[t];this[n]=(e[3*t+n]+e[3*n+t])/s,this[i]=(e[3*t+i]+e[3*i+t])/s,this[3]=(e[3*n+i]-e[3*i+n])/s}return this},getMatrix(e=new Bt){const{x:t,y:n,z:i,w:s}=this,r=t*t,o=t*n,a=n*n,l=n*i,u=i*t,h=i*i,c=s*t,d=s*n,p=s*i;return e[0]=1-2*(a+h),e[1]=2*(o+p),e[2]=2*(u-d),e[3]=2*(o-p),e[4]=1-2*(h+r),e[5]=2*(l+c),e[6]=2*(u+d),e[7]=2*(l-c),e[8]=1-2*(a+r),e},isReal(){return!(this.x||this.y||this.z)},isImag(){return!this.w},equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiply(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},multLeft(e){const{x:t,y:n,z:i,w:s}=this,{x:r,y:o,z:a,w:l}=e;return this.x=s*r+t*l+n*a-i*o,this.y=s*o+n*l+i*r-t*a,this.z=s*a+i*l+t*o-n*r,this.w=s*l-t*r-n*o-i*a,this},multRight(e){const{x:t,y:n,z:i,w:s}=this,{x:r,y:o,z:a,w:l}=e;return this.x=l*t+r*s+o*i-a*n,this.y=l*n+o*s+a*t-r*i,this.z=l*i+a*s+r*n-o*t,this.w=l*s-r*t-o*n-a*i,this},divide(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this},multVecQuat(e){const{x:t,y:n,z:i,w:s}=this,{x:r,y:o,z:a}=e,l=s*s-t*t-n*n-i*i,u=2*(r*t+o*n+a*i),h=2*s;return e.x=l*r+u*t+h*(n*a-i*o),e.y=l*o+u*n+h*(i*r-t*a),e.z=l*a+u*i+h*(t*o-n*r),e},multQuatVec(e){const{x:t,y:n,z:i,w:s}=this,{x:r,y:o,z:a}=e,l=s*s-t*t-n*n-i*i,u=2*(r*t+o*n+a*i),h=2*s;return e.x=l*r+u*t-h*(n*a-i*o),e.y=l*o+u*n-h*(i*r-t*a),e.z=l*a+u*i-h*(t*o-n*r),e},normalize(){const e=Math.hypot(this.x,this.y,this.z,this.w);return e&&(this.x/=e,this.y/=e,this.z/=e,this.w/=e),this},dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},norm(){const{x:e,y:t,z:n,w:i}=this;return e*e+t*t+n*n+i*i},magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)},pow(t){if(t instanceof Wt)return this.assign(e.assign(t).multRight(this.log()).exp());if(this.isReal())return this.set(0,0,0,Math.pow(this.w,t));const n=this.magnitude(),i=Math.acos(this.w/n),s=this.imag.magnitude(),r=Math.pow(n,t),o=t*i,a=r/s*Math.sin(o);return this.x*=a,this.y*=a,this.z*=a,this.w=r*Math.cos(o),this},log(){if(this.isReal())return this.w>0?this.set(0,0,0,Math.log(this.w)):this.set(Math.PI,0,0,Math.log(-this.w));const e=this.magnitude(),t=this.imag.normalize().multiply(Math.acos(this.w/e)),n=Math.log(e);return this.x=t.x,this.y=t.y,this.z=t.z,this.w=n,this},exp(){if(this.isReal())return this.set(0,0,0,Math.exp(this.w));const e=this.imag,t=e.magnitude(),n=Math.exp(this.w),i=n*Math.cos(t),s=e.multiply(n*Math.sin(t)/t);return this.x=s.x,this.y=s.y,this.z=s.z,this.w=i,this},slerp(e,t){return f.slerp(this,$t.assign(e),t)},squad(e,t,n,i){return f.slerp(f.slerp(this,$t.assign(n),i),f.slerp(Kt.assign(e),Jt.assign(t),i),2*i*(1-i))},toString(){return this.x+" "+this.y+" "+this.z+" "+this.w}}),Object.defineProperties(Wt.prototype,{length:{value:4},0:{get(){return this.x},set(e){this.x=e}},1:{get(){return this.y},set(e){this.y=e}},2:{get(){return this.z},set(e){this.z=e}},3:{get(){return this.w},set(e){this.w=e}},real:{get(){return this.w}},imag:{get:function(){const e=new Et(0,0,0);return function(){return e.set(this.x,this.y,this.z)}}()}}),Object.assign(Wt,{Identity:new Wt(0,0,0,1),spline:function(){const e=new Wt(0,0,0,1),t=new Wt(0,0,0,1),n=new Wt(0,0,0,1),i=new Wt(0,0,0,1);return function(s,r,o){return e.assign(s),t.assign(r),n.assign(o),e.dot(t)<0&&e.negate(),n.dot(t)<0&&n.negate(),i.assign(t).inverse(),t.multRight($t.assign(i).multRight(e).log().add(Kt.assign(i).multRight(n).log()).divide(-4).exp()).normalize().copy()}}()});const $t=new Wt(0,0,0,1),Kt=new Wt(0,0,0,1),Jt=new Wt(0,0,0,1),Zt=Wt;n.set("standard/Math/Numbers/Quaternion",Zt);const Qt=Zt,en=Symbol(),tn=Symbol(),nn=Symbol(),sn=Symbol(),rn=Symbol();function on(e,t,n,i){switch(this[en]=0,this[tn]=0,this[nn]=1,this[sn]=0,arguments.length){case 0:return void(this[rn]=new Qt(0,0,0,1));case 1:return this[rn]=arguments[0],void this.update();case 2:{const e=arguments[0],t=arguments[1];return this[rn]=new Qt(0,0,0,1),t instanceof Et?this.setFromToVec(e,t):void this.set(e.x,e.y,e.z,t)}case 4:return this[rn]=new Qt(0,0,0,1),void this.set(e,t,n,i)}}Object.assign(on.prototype,{*[Symbol.iterator](){yield this[en],yield this[tn],yield this[nn],yield this[sn]},update(){const e=this.get();return this[en]=e.x,this[tn]=e.y,this[nn]=e.z,this[sn]=e.w,this},copy(){const e=Object.create(on.prototype);return e[en]=this[en],e[tn]=this[tn],e[nn]=this[nn],e[sn]=this[sn],e[rn]=this[rn].copy(),e},assign(e){return this[en]=e[en],this[tn]=e[tn],this[nn]=e[nn],this[sn]=e[sn],this[rn].assign(e[rn]),this},set(e,t,n,i){this[en]=e,this[tn]=t,this[nn]=n,this[sn]=i;const s=Math.hypot(e,t,n);if(0===s)return this[rn].set(0,0,0,1),this;const r=f.interval(i/2,0,Math.PI),o=Math.sin(r)/s;return this[rn].set(e*o,t*o,n*o,Math.cos(r)),this},get:function(){const e=new Yt(0,0,0,0);return function(){const t=this[rn];if(Math.abs(t.w)>1)return Yt.zAxis;{const n=2*Math.acos(t.w),i=Math.sin(n/2);if(0===i)return Yt.zAxis;{const s=t.imag.divide(i);return e.set(s.x,s.y,s.z,n)}}}}(),setAxisAngle(e,t){return this.set(e.x,e.y,e.z,t)},setFromToVec:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new Et(0,0,0);return function(s,r){e.assign(s).normalize(),t.assign(r).normalize();const o=f.clamp(e.dot(t),-1,1),a=n.assign(e).cross(t).normalize();return 0===a.magnitude()?o>0?this[rn].set(0,0,0,1):(i.assign(e).cross(Et.xAxis),0===i.norm()&&i.assign(e).cross(Et.yAxis),i.normalize(),this[rn].set(i.x,i.y,i.z,0)):(a.multiply(Math.sqrt(Math.abs(1-o)/2)),this[rn].set(a.x,a.y,a.z,Math.sqrt(Math.abs(1+o)/2))),this.update(),this}}(),setAxis(e){this.set(e.x,e.y,e.z,this[sn])},getAxis(e=new Et(0,0,0)){return e.set(this[en],this[tn],this[nn])},setQuaternion(e){return this[rn].assign(e).normalize(),this.update(),this},getQuaternion(e=new Qt(0,0,0,1)){return e.assign(this[rn])},setMatrix(e){return this[rn].setMatrix(e).normalize(),this.update(),this},getMatrix(e=new Bt){return this[rn].getMatrix(e)},equals(e){return this[rn].equals(e[rn])},inverse(){return this[rn].inverse(),this.update(),this},multLeft(e){return this[rn].multLeft(e[rn]).normalize(),this.update(),this},multRight(e){return this[rn].multRight(e[rn]).normalize(),this.update(),this},multVecRot(e){return this[rn].multVecQuat(e)},multRotVec(e){return this[rn].multQuatVec(e)},normalize(){return this[rn].normalize(),this.update(),this},pow(e){return this[rn].pow(e),this.update(),this},slerp(e,t){return this[rn].slerp(e[rn],t),this.update(),this},squad(e,t,n,i){return this[rn].squad(e[rn],t[rn],n[rn],i),this.update(),this},toString(){return this[en]+" "+this[tn]+" "+this[nn]+" "+this[sn]}});const an={get(){return this[en]},set(e){this[en]=e,this.set(e,this[tn],this[nn],this[sn])},enumerable:!0},ln={get(){return this[tn]},set(e){this[tn]=e,this.set(this[en],e,this[nn],this[sn])},enumerable:!0},un={get(){return this[nn]},set(e){this[nn]=e,this.set(this[en],this[tn],e,this[sn])},enumerable:!0},hn={get(){return this[sn]},set(e){this[sn]=e,this.set(this[en],this[tn],this[nn],e)},enumerable:!0};Object.defineProperties(on.prototype,{length:{value:4},x:an,y:ln,z:un,angle:hn}),an.enumerable=!1,ln.enumerable=!1,un.enumerable=!1,hn.enumerable=!1,Object.defineProperties(on.prototype,{0:an,1:ln,2:un,3:hn}),Object.assign(on,{Identity:new on,spline(e,t,n){const i=Object.create(this.prototype);return i[rn]=Qt.spline(e[rn],t[rn],n[rn]),i.update(),i}});const cn=on;n.set("standard/Math/Numbers/Rotation4",cn);const dn=cn;function pn(){if(arguments.length)for(let e=0;e<16;++e)this[e]=arguments[e];else this.identity()}Object.assign(pn.prototype,{*[Symbol.iterator](){for(let e=0;e<16;++e)yield this[e]},copy(){const e=Object.create(pn.prototype);for(let t=0;t<16;++t)e[t]=this[t];return e},assign(e){for(let t=0;t<16;++t)this[t]=e[t];return this},equals(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]&&this[4]===e[4]&&this[5]===e[5]&&this[6]===e[6]&&this[7]===e[7]&&this[8]===e[8]&&this[9]===e[9]&&this[10]===e[10]&&this[11]===e[11]&&this[12]===e[12]&&this[13]===e[13]&&this[14]===e[14]&&this[15]===e[15]},set1(e,t,n){return this[e*this.order+t]=n,this},get1(e,t){return this[e*this.order+t]},set:function(){const e=new dn,t=new Et(0,0,0);return function(n,i,s,r,o){switch(arguments.length){case 0:this.identity();break;case 1:null===n&&(n=Et.Zero),this.identity(),this.translate(n);break;case 2:null===n&&(n=Et.Zero),null===i&&(i=dn.Identity),this.identity(),this.translate(n),i.equals(dn.Identity)||this.rotate(i);break;case 3:null===n&&(n=Et.Zero),null===i&&(i=dn.Identity),null===s&&(s=Et.One),this.identity(),this.translate(n),i.equals(dn.Identity)||this.rotate(i),s.equals(Et.One)||this.scale(s);break;case 4:if(null===n&&(n=Et.Zero),null===i&&(i=dn.Identity),null===s&&(s=Et.One),null===r&&(r=dn.Identity),this.identity(),this.translate(n),i.equals(dn.Identity)||this.rotate(i),!s.equals(Et.One)){!r.equals(dn.Identity)?(this.rotate(r),this.scale(s),this.rotate(e.assign(r).inverse())):this.scale(s)}break;case 5:{null===n&&(n=Et.Zero),null===i&&(i=dn.Identity),null===s&&(s=Et.One),null===r&&(r=dn.Identity),null===o&&(o=Et.Zero),this.identity(),this.translate(n);const a=!o.equals(Et.Zero);a&&this.translate(o),i.equals(dn.Identity)||this.rotate(i),s.equals(Et.One)||(r.equals(dn.Identity)?this.scale(s):(this.rotate(r),this.scale(s),this.rotate(e.assign(r).inverse()))),a&&this.translate(t.assign(o).negate());break}case 16:for(let e=0;e<16;++e)this[e]=arguments[e]}return this}}(),get:function(){const e=new Et(0,0,0),t=new dn,n=new Et(0,0,0),i=new dn,s=new Et(0,0,0),r=new Bt,o=new Bt,a=new Et(0,0,0);return function(l,u,h,c,d){switch(null===l&&(l=e),null===u&&(u=t),null===h&&(h=n),null===c&&(c=i),null===d&&(d=s),arguments.length){case 1:l.set(this[12],this[13],this[14]);break;case 2:this.factor(l,r,n,o),u.setMatrix(r);break;case 3:this.factor(l,r,h,o),u.setMatrix(r);break;case 4:this.factor(l,r,h,o),u.setMatrix(r),c.setMatrix(o);break;case 5:fn.set(a.assign(d).negate()),fn.multLeft(this),fn.translate(d),fn.get(l,u,h,c)}}}(),setRotation(e){return this.setQuaternion(e.getQuaternion(gn))},setQuaternion(e){const{x:t,y:n,z:i,w:s}=e,r=n*n,o=i*i,a=t*n,l=i*s,u=i*t,h=n*s,c=t*t,d=n*i,p=t*s;return this[0]=1-2*(r+o),this[1]=2*(a+l),this[2]=2*(u-h),this[3]=0,this[4]=2*(a-l),this[5]=1-2*(o+c),this[6]=2*(d+p),this[7]=0,this[8]=2*(u+h),this[9]=2*(d-p),this[10]=1-2*(r+c),this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},factor:function(){const e=new Bt,t=new Bt,n=new Bt,i={values:[],vectors:[[],[],[]]};return function(s,r,o,a){s.set(this[12],this[13],this[14]);const l=this.submatrix,u=l.determinant()<0?-1:1;n.assign(l).transpose().multLeft(l);const h=Rt(n,i);a.set(h.vectors[0][0],h.vectors[1][0],h.vectors[2][0],h.vectors[0][1],h.vectors[1][1],h.vectors[2][1],h.vectors[0][2],h.vectors[1][2],h.vectors[2][2]),o.x=u*Math.sqrt(h.values[0]),o.y=u*Math.sqrt(h.values[1]),o.z=u*Math.sqrt(h.values[2]),e[0]=1/o.x,e[4]=1/o.y,e[8]=1/o.z,r.assign(t.assign(a).transpose().multRight(e).multRight(a).multRight(l))}}(),determinant3(){const e=this[0],t=this[1],n=this[2],i=this[4],s=this[5],r=this[6],o=this[8],a=this[9],l=this[10];return e*(s*l-r*a)-t*(i*l-r*o)+n*(i*a-s*o)},determinant(){const{0:e,1:t,2:n,3:i,4:s,5:r,6:o,7:a,8:l,9:u,10:h,11:c,12:d,13:p,14:g,15:f}=this,m=h*f,_=g*c,x=o*f,y=g*a,w=o*c,b=h*a,S=n*f,v=g*i,T=n*c,O=h*i,E=n*a,C=o*i;return e*(m*r+y*u+w*p-_*r-x*u-b*p)+s*(_*t+S*u+O*p-m*t-v*u-T*p)+l*(x*t+v*r+E*p-y*t-S*r-C*p)+d*(b*t+T*r+C*u-w*t-O*r-E*u)},transpose(){let e;return e=this[1],this[1]=this[4],this[4]=e,e=this[2],this[2]=this[8],this[8]=e,e=this[3],this[3]=this[12],this[12]=e,e=this[6],this[6]=this[9],this[9]=e,e=this[7],this[7]=this[13],this[13]=e,e=this[11],this[11]=this[14],this[14]=e,this},inverse(){const{0:e,1:t,2:n,3:i,4:s,5:r,6:o,7:a,8:l,9:u,10:h,11:c,12:d,13:p,14:g,15:f}=this,m=h*f,_=g*c,x=o*f,y=g*a,w=o*c,b=h*a,S=n*f,v=g*i,T=n*c,O=h*i,E=n*a,C=o*i,N=l*p,F=d*u,I=s*p,M=d*r,P=s*u,D=l*r,R=e*p,A=d*t,V=e*u,L=l*t,B=e*r,U=s*t,X=m*r+y*u+w*p-(_*r+x*u+b*p),j=_*t+S*u+O*p-(m*t+v*u+T*p),k=x*t+v*r+E*p-(y*t+S*r+C*p),z=b*t+T*r+C*u-(w*t+O*r+E*u);let G=e*X+s*j+l*k+d*z;return G=1/G,this[0]=G*X,this[1]=G*j,this[2]=G*k,this[3]=G*z,this[4]=G*(_*s+x*l+b*d-m*s-y*l-w*d),this[5]=G*(m*e+v*l+T*d-_*e-S*l-O*d),this[6]=G*(y*e+S*s+C*d-x*e-v*s-E*d),this[7]=G*(w*e+O*s+E*l-b*e-T*s-C*l),this[8]=G*(N*a+M*c+P*f-F*a-I*c-D*f),this[9]=G*(F*i+R*c+L*f-N*i-A*c-V*f),this[10]=G*(I*i+A*a+B*f-M*i-R*a-U*f),this[11]=G*(D*i+V*a+U*c-P*i-L*a-B*c),this[12]=G*(I*h+D*g+F*o-P*g-N*o-M*h),this[13]=G*(V*g+N*n+A*h-R*h-L*g-F*n),this[14]=G*(R*o+U*g+M*n-B*g-I*n-A*o),this[15]=G*(B*h+P*n+L*o-V*o-U*h-D*n),this},multLeft(e){const{0:t,1:n,2:i,3:s,4:r,5:o,6:a,7:l,8:u,9:h,10:c,11:d,12:p,13:g,14:f,15:m}=this,{0:_,1:x,2:y,3:w,4:b,5:S,6:v,7:T,8:O,9:E,10:C,11:N,12:F,13:I,14:M,15:P}=e;return this[0]=t*_+r*x+u*y+p*w,this[1]=n*_+o*x+h*y+g*w,this[2]=i*_+a*x+c*y+f*w,this[3]=s*_+l*x+d*y+m*w,this[4]=t*b+r*S+u*v+p*T,this[5]=n*b+o*S+h*v+g*T,this[6]=i*b+a*S+c*v+f*T,this[7]=s*b+l*S+d*v+m*T,this[8]=t*O+r*E+u*C+p*N,this[9]=n*O+o*E+h*C+g*N,this[10]=i*O+a*E+c*C+f*N,this[11]=s*O+l*E+d*C+m*N,this[12]=t*F+r*I+u*M+p*P,this[13]=n*F+o*I+h*M+g*P,this[14]=i*F+a*I+c*M+f*P,this[15]=s*F+l*I+d*M+m*P,this},multRight(e){const{0:t,1:n,2:i,3:s,4:r,5:o,6:a,7:l,8:u,9:h,10:c,11:d,12:p,13:g,14:f,15:m}=this,{0:_,1:x,2:y,3:w,4:b,5:S,6:v,7:T,8:O,9:E,10:C,11:N,12:F,13:I,14:M,15:P}=e;return this[0]=t*_+n*b+i*O+s*F,this[1]=t*x+n*S+i*E+s*I,this[2]=t*y+n*v+i*C+s*M,this[3]=t*w+n*T+i*N+s*P,this[4]=r*_+o*b+a*O+l*F,this[5]=r*x+o*S+a*E+l*I,this[6]=r*y+o*v+a*C+l*M,this[7]=r*w+o*T+a*N+l*P,this[8]=u*_+h*b+c*O+d*F,this[9]=u*x+h*S+c*E+d*I,this[10]=u*y+h*v+c*C+d*M,this[11]=u*w+h*T+c*N+d*P,this[12]=p*_+g*b+f*O+m*F,this[13]=p*x+g*S+f*E+m*I,this[14]=p*y+g*v+f*C+m*M,this[15]=p*w+g*T+f*N+m*P,this},multVecMatrix(e){if(3===e.length){const{x:t,y:n,z:i}=e,s=1/(t*this[3]+n*this[7]+i*this[11]+this[15]);return e.x=(t*this[0]+n*this[4]+i*this[8]+this[12])*s,e.y=(t*this[1]+n*this[5]+i*this[9]+this[13])*s,e.z=(t*this[2]+n*this[6]+i*this[10]+this[14])*s,e}{const{x:t,y:n,z:i,w:s}=e;return e.x=t*this[0]+n*this[4]+i*this[8]+s*this[12],e.y=t*this[1]+n*this[5]+i*this[9]+s*this[13],e.z=t*this[2]+n*this[6]+i*this[10]+s*this[14],e.w=t*this[3]+n*this[7]+i*this[11]+s*this[15],e}},multMatrixVec(e){if(3===e.length){const{x:t,y:n,z:i}=e,s=1/(t*this[12]+n*this[13]+i*this[14]+this[15]);return e.x=(t*this[0]+n*this[1]+i*this[2]+this[3])*s,e.y=(t*this[4]+n*this[5]+i*this[6]+this[7])*s,e.z=(t*this[8]+n*this[9]+i*this[10]+this[11])*s,e}{const{x:t,y:n,z:i,w:s}=e;return e.x=t*this[0]+n*this[1]+i*this[2]+s*this[3],e.y=t*this[4]+n*this[5]+i*this[6]+s*this[7],e.z=t*this[8]+n*this[9]+i*this[10]+s*this[11],e.w=t*this[12]+n*this[13]+i*this[14]+s*this[15],e}},multDirMatrix(e){const{x:t,y:n,z:i}=e;return e.x=t*this[0]+n*this[4]+i*this[8],e.y=t*this[1]+n*this[5]+i*this[9],e.z=t*this[2]+n*this[6]+i*this[10],e},multMatrixDir(e){const{x:t,y:n,z:i}=e;return e.x=t*this[0]+n*this[1]+i*this[2],e.y=t*this[4]+n*this[5]+i*this[6],e.z=t*this[8]+n*this[9]+i*this[10],e},identity(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},translate(e){const{x:t,y:n,z:i}=e;return this[12]+=this[0]*t+this[4]*n+this[8]*i,this[13]+=this[1]*t+this[5]*n+this[9]*i,this[14]+=this[2]*t+this[6]*n+this[10]*i,this},rotate(e){return this.multLeft(fn.setQuaternion(e.getQuaternion(gn)))},scale(e){const{x:t,y:n,z:i}=e;return this[0]*=t,this[4]*=n,this[8]*=i,this[1]*=t,this[5]*=n,this[9]*=i,this[2]*=t,this[6]*=n,this[10]*=i,this},toString(){return Array.prototype.join.call(this," ")}}),Object.defineProperties(pn.prototype,{order:{value:4},length:{value:16},x:{get:function(){const e=new Yt(0,0,0,0);return function(){return e.set(this[0],this[1],this[2],this[3])}}()},y:{get:function(){const e=new Yt(0,0,0,0);return function(){return e.set(this[4],this[5],this[6],this[7])}}()},z:{get:function(){const e=new Yt(0,0,0,0);return function(){return e.set(this[8],this[9],this[10],this[11])}}()},w:{get:function(){const e=new Yt(0,0,0,0);return function(){return e.set(this[12],this[13],this[14],this[15])}}()},xAxis:{get:function(){const e=new Et(0,0,0);return function(){return e.set(this[0],this[1],this[2])}}()},yAxis:{get:function(){const e=new Et(0,0,0);return function(){return e.set(this[4],this[5],this[6])}}()},zAxis:{get:function(){const e=new Et(0,0,0);return function(){return e.set(this[8],this[9],this[10])}}()},origin:{get:function(){const e=new Et(0,0,0);return function(){return e.set(this[12],this[13],this[14])}}()},submatrix:{get:function(){const e=new Bt;return function(){return e[0]=this[0],e[1]=this[1],e[2]=this[2],e[3]=this[4],e[4]=this[5],e[5]=this[6],e[6]=this[8],e[7]=this[9],e[8]=this[10],e}}()}}),Object.assign(pn,{Identity:new pn,Rotation(e){return Object.create(this.prototype).setQuaternion(e.getQuaternion(gn))},Quaternion(e){return Object.create(this.prototype).setQuaternion(e)},Matrix3:e=>new pn(e[0],e[1],0,0,e[3],e[4],0,0,0,0,1,0,e[6],e[7],0,1),SubMatrix:e=>new pn(e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1)});const gn=new Qt,fn=new pn,mn=pn;n.set("standard/Math/Numbers/Matrix4",mn);const _n=mn;function xn(e,t,n){function i(e,t,n,i,s,r,o,a,l,u,h,c,d,p,g,f){switch(arguments.length){case 0:fe.call(this,new _n);break;case 1:fe.call(this,arguments[0]);break;case 4:{const e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];fe.call(this,new _n(e.x,e.y,e.z,e.w,t.x,t.y,t.z,t.w,n.x,n.y,n.z,n.w,i.x,i.y,i.z,i.w));break}case 16:fe.call(this,new _n(+e,+t,+n,+i,+s,+r,+o,+a,+l,+u,+h,+c,+d,+p,+g,+f));break;default:throw new Error("Invalid arguments.")}}ft(i,e,_n,t,n);for(const e of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,e,{enumerable:!1});function s(e){Object.defineProperty(i.prototype,e,{get(){return this.getValue()[e]},set(t){this.getValue()[e]=t,this.addEvent()},enumerable:!0})}for(let e=0,t=_n.prototype.length;e<t;++e)s(e);return i}const yn={SFMatrix4d:xn("SFMatrix4d",Gt.SFVec3d,!0),SFMatrix4f:xn("SFMatrix4f",Gt.SFVec3f,!1),VrmlMatrix:xn("VrmlMatrix",Gt.SFVec3f,!1)};n.set("x_ite/Fields/SFMatrix4",yn);const wn=yn,bn=new WeakMap;function Sn(){const e=this.getValue();e?.dispose(),Mn.prototype.dispose.call(this),bn.delete(e)}const vn={get(e){const t=bn.get(e);if(t)return t;{const t=new Mn(e);return t.dispose=Sn,bn.set(e,t),t}}};n.set("x_ite/Fields/SFNodeCache",vn);const Tn=vn,On=Symbol(),En=Symbol(),Cn=Symbol(),Nn={get(e,t){try{const n=e[t];if(void 0!==n)return n;const i=e.getValue().getField(t);if(i.getAccessType()===c.inputOnly)return;return i.valueOf()}catch{return}},set(e,t,n){if(t in e)return e[t]=n,!0;try{const i=e.getValue().getField(t);return i.getAccessType()!==c.outputOnly&&i.setValue(n),!0}catch(n){return console.error(e,t,n),!1}},has(e,t){try{return!!e.getValue().getField(t)}catch{return t in e}},ownKeys(e){const t=e.getValue(),n=[];if(t)for(const e of t.getFieldDefinitions())n.push(e.name);return n},getOwnPropertyDescriptor(e,t){const n=e.getValue();if(n){const i=n.getFieldDefinitions().get(t);if(i)return{value:this.get(e,t),writable:i.accessType!==c.outputOnly,enumerable:!0,configurable:!0}}}};function Fn(e){const t=new Proxy(this,Nn);return this[On]=this,this[En]=t,e?(e.addParent(t),fe.call(this,e)):fe.call(this,null),t}Object.assign(Object.setPrototypeOf(Fn.prototype,fe.prototype),{[On]:null,[En]:null,[Cn]:0,copy(e){const t=this[On].getValue();return t?new Fn(e?t.copy(e):t):new Fn},equals(e){const t=this[On];return e?t.getValue()===e.getValue():null===t.getValue()},isDefaultValue(){return null===this[On].getValue()},set(e){const t=this[On],n=t.getValue();n&&(n.removeCloneCount(t[Cn]),n.removeParent(t[En])),e?(e.addParent(t[En]),e.addCloneCount(t[Cn]),fe.prototype.set.call(t,e)):fe.prototype.set.call(t,null)},getNodeTypeName(){const e=this[On].getValue();if(e)return e.getTypeName();throw new Error("SFNode.getNodeTypeName: node is null.")},getNodeName(){const e=this[On].getValue();if(e)return e.getName();throw new Error("SFNode.getNodeName: node is null.")},getNodeDisplayName(){const e=this[On].getValue();if(e)return e.getDisplayName();throw new Error("SFNode.getNodeDisplayName: node is null.")},getNodeType(){const e=this[On].getValue();if(e)return Array.from(e.getType());throw new Error("SFNode.getNodeType: node is null.")},getFieldDefinitions(){const e=this[On].getValue();if(e)return e.getFieldDefinitions();throw new Error("SFNode.getFieldDefinitions: node is null.")},addFieldCallback(e,t,n){const i=this[On];switch(arguments.length){case 2:return fe.prototype.addFieldCallback.apply(i,arguments);case 3:{const s=i.getValue();if(s)return s.getField(e).addFieldCallback(t,n);throw new Error("SFNode.addFieldCallback: node is null.")}}},removeFieldCallback(e,t){const n=this[On];switch(arguments.length){case 1:return fe.prototype.removeFieldCallback.apply(n,arguments);case 2:{const i=n.getValue();if(i)return i.getField(e).removeFieldCallback(t);throw new Error("SFNode.removeFieldCallback: node is null.")}}},addCloneCount(e){const t=this[On];t[Cn]+=e,t.getValue()?.addCloneCount(e)},removeCloneCount(e){const t=this[On];t[Cn]-=e,t.getValue()?.removeCloneCount(e)},getNodeUserData(e){const t=this[On].getValue();if(t)return t.getUserData(e);throw new Error("SFNode.getNodeUserData: node is null.")},setNodeUserData(e,t){const n=this[On].getValue();if(n)return n.setUserData(e,t);throw new Error("SFNode.setNodeUserData: node is null.")},removeNodeUserData(e){const t=this[On].getValue();if(t)return t.removeUserData(e);throw new Error("SFNode.removeNodeUserData: node is null.")},valueOf(){const e=this[On].getValue();return e?Tn.get(e):null},toStream(e){const t=this[On].getValue();t?t.toStream(e):e.string+="NULL"},toVRMLStream(e){const t=this[On].getValue();t?t.toVRMLStream(e):e.string+="NULL"},toXMLStream(e){const t=this[On].getValue();t?t.toXMLStream(e):e.string+="\x3c!-- NULL --\x3e"},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){const t=this[On].getValue();t?t.toJSONStream(e):e.string+="null"},dispose(){const e=this[On];e.set(null),e.processInterests(),fe.prototype.dispose.call(e)}});for(const e of Reflect.ownKeys(Fn.prototype))Object.defineProperty(Fn.prototype,e,{enumerable:!1});Object.defineProperties(Fn,{typeName:{value:"SFNode",enumerable:!0}});const In=Fn;n.set("x_ite/Fields/SFNode",In);const Mn=In,Pn=Gt.SFVec3d,Dn=Gt.SFVec3f,Rn=jt.SFMatrix3d,An=jt.SFMatrix3f;function Vn(e,t,n,i){switch(arguments.length){case 0:fe.call(this,new dn);break;case 1:if(arguments[0]instanceof Rn||arguments[0]instanceof An){fe.call(this,(new dn).setMatrix(arguments[0].getValue()));break}fe.call(this,arguments[0]);break;case 2:if(arguments[1]instanceof Pn||arguments[1]instanceof Dn){fe.call(this,new dn(arguments[0].getValue(),arguments[1].getValue()));break}fe.call(this,new dn(arguments[0].getValue(),+arguments[1]));break;case 4:fe.call(this,new dn(+e,+t,+n,+i));break;default:throw new Error("Invalid arguments.")}}Object.assign(Object.setPrototypeOf(Vn.prototype,fe.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new Vn(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return this.getValue().equals(dn.Identity)},set(e){this.getValue().assign(e)},setAxis(e){this.getValue().setAxis(e.getValue()),this.addEvent()},getAxis(){return new Dn(this.getValue().getAxis())},setMatrix(e){this.getValue().setMatrix(e.getValue()),this.addEvent()},getMatrix(){return new An(this.getValue().getMatrix())},inverse(){return new Vn(this.getValue().copy().inverse())},multiply(e){return new Vn(this.getValue().copy().multRight(e.getValue()))},multVec(e){return new e.constructor(this.getValue().multVecRot(e.getValue().copy()))},slerp(e,t){return new Vn(this.getValue().copy().slerp(e.getValue(),t))},toStream(e){const{x:t,y:n,z:i,angle:s}=this.getValue();e.string+=e.DoubleFormat(t),e.string+=e.TidySpace(),e.string+=e.DoubleFormat(n),e.string+=e.TidySpace(),e.string+=e.DoubleFormat(i),e.string+=e.TidySpace(),e.string+=e.DoubleFormat(e.ToUnit("angle",s))},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.TidySpace(),this.toJSONStreamValue(e),e.string+=e.TidySpace(),e.string+="]"},toJSONStreamValue(e){const{x:t,y:n,z:i,angle:s}=this.getValue();e.string+=e.JSONNumber(e.DoubleFormat(t)),e.string+=",",e.string+=e.TidySpace(),e.string+=e.JSONNumber(e.DoubleFormat(n)),e.string+=",",e.string+=e.TidySpace(),e.string+=e.JSONNumber(e.DoubleFormat(i)),e.string+=",",e.string+=e.TidySpace(),e.string+=e.JSONNumber(e.DoubleFormat(e.ToUnit("angle",s)))}});for(const e of Reflect.ownKeys(Vn.prototype))Object.defineProperty(Vn.prototype,e,{enumerable:!1});const Ln={get(){return this.getValue().x},set(e){this.getValue().x=+e,this.addEvent()}},Bn={get(){return this.getValue().y},set(e){this.getValue().y=+e,this.addEvent()}},Un={get(){return this.getValue().z},set(e){this.getValue().z=+e,this.addEvent()}},Xn={get(){return this.getValue().angle},set(e){this.getValue().angle=+e,this.addEvent()}};Object.defineProperties(Vn.prototype,{0:Ln,1:Bn,2:Un,3:Xn,x:Object.assign({enumerable:!0},Ln),y:Object.assign({enumerable:!0},Bn),z:Object.assign({enumerable:!0},Un),angle:Object.assign({enumerable:!0},Xn)}),Object.defineProperties(Vn,{typeName:{value:"SFRotation",enumerable:!0}});const jn=Vn;n.set("x_ite/Fields/SFRotation",jn);const kn=jn;function zn(e){fe.call(this,arguments.length?String(e):"")}Object.assign(Object.setPrototypeOf(zn.prototype,fe.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new zn(this.getValue())},isDefaultValue(){return""===this.getValue()},set(e){fe.prototype.set.call(this,String(e))},valueOf:fe.prototype.getValue,toStream(e){e.string+='"',e.string+=zn.escape(this.getValue()),e.string+='"'},toVRMLStream(e){this.toStream(e)},toXMLStream(e,t=!1){e.string+=t?e.XMLEncodeSourceText(this.getValue()):e.XMLEncode(this.getValue())},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){e.string+='"',e.string+=e.JSONEncode(this.getValue()),e.string+='"'}});for(const e of Reflect.ownKeys(zn.prototype))Object.defineProperty(zn.prototype,e,{enumerable:!1});Object.defineProperty(zn.prototype,"length",{get(){return this.getValue().length}}),Object.defineProperties(zn,{typeName:{value:"SFString",enumerable:!0}}),Object.assign(zn,{unescape:e=>e.replace(/\\([\\"])/g,"$1"),escape:e=>e.replace(/([\\"])/g,"\\$1")});const Gn=zn;n.set("x_ite/Fields/SFString",Gn);const Hn=Gn;function qn(e){fe.call(this,arguments.length?+e:0)}Object.assign(Object.setPrototypeOf(qn.prototype,fe.prototype),{copy(){return new qn(this.getValue())},isDefaultValue(){return 0===this.getValue()},set(e){fe.prototype.set.call(this,+e)},valueOf:fe.prototype.getValue,toStream(e){e.string+=this.getValue()},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){e.string+=e.JSONNumber(e.DoubleFormat(this.getValue()))}});for(const e of Reflect.ownKeys(qn.prototype))Object.defineProperty(qn.prototype,e,{enumerable:!1});Object.defineProperties(qn,{typeName:{value:"SFTime",enumerable:!0}});const Yn=qn;n.set("x_ite/Fields/SFTime",Yn);const Wn=Yn;function $n(e,t){function n(e,t,n,i){switch(arguments.length){case 0:fe.call(this,new Yt(0,0,0,0));break;case 1:fe.call(this,arguments[0]);break;case 4:fe.call(this,new Yt(+e,+t,+n,+i));break;default:throw new Error("Invalid arguments.")}}_t(n,e,Yt,t);for(const e of Reflect.ownKeys(n.prototype))Object.defineProperty(n.prototype,e,{enumerable:!1});const i={get(){return this.getValue().x},set(e){this.getValue().x=+e,this.addEvent()}},s={get(){return this.getValue().y},set(e){this.getValue().y=+e,this.addEvent()}},r={get(){return this.getValue().z},set(e){this.getValue().z=+e,this.addEvent()}},o={get(){return this.getValue().w},set(e){this.getValue().w=+e,this.addEvent()}};return Object.defineProperties(n.prototype,{0:i,1:s,2:r,3:o,x:Object.assign({enumerable:!0},i),y:Object.assign({enumerable:!0},s),z:Object.assign({enumerable:!0},r),w:Object.assign({enumerable:!0},o)}),n}const Kn={SFVec4d:$n("SFVec4d",!0),SFVec4f:$n("SFVec4f",!1)};n.set("x_ite/Fields/SFVec4",Kn);const Jn=Kn;function Zn(e){fe.call(this,e)}Object.assign(Object.setPrototypeOf(Zn.prototype,fe.prototype),{at:Array.prototype.at,entries:Array.prototype.entries,every:Array.prototype.every,fill:Array.prototype.fill,filter(){return new this.constructor(...Array.prototype.filter.call(this,...arguments))},find:Array.prototype.find,findIndex:Array.prototype.findIndex,findLast:Array.prototype.findLast,findLastIndex:Array.prototype.findLastIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:Array.prototype.keys,lastIndexOf:Array.prototype.lastIndexOf,map(){return new this.constructor(...Array.prototype.map.call(this,...arguments))},reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,reverse:Array.prototype.reverse,slice(){return new this.constructor(...Array.prototype.slice.call(this,...arguments))},some:Array.prototype.some,sort:Array.prototype.sort,toReversed(){return this.copy().reverse()},toSorted(){return this.copy().sort(...arguments)},toSpliced(){const e=this.copy();return e.splice(...arguments),e},values:Array.prototype.values,with(e,t){const n=this.copy();return n[e]=t,n}});for(const e of Reflect.ownKeys(Zn.prototype))Object.defineProperty(Zn.prototype,e,{enumerable:!1});const Qn=Zn;n.set("x_ite/Base/X3DArrayField",Qn);const ei=Qn,ti=Symbol(),ni=Symbol(),ii=Symbol(),si=Symbol(),ri={get(e,t){const n=e[t];if(void 0!==n)return n;if("string"==typeof t){const n=e.getValue(),i=+t;return Number.isInteger(i)?(i>=n.length&&e.resize(i+1),n[i].valueOf()):e[t]}},set(e,t,n){if(t in e)return e[t]=n,!0;const i=e.getValue(),s=+t;return s>=i.length&&e.resize(s+1),i[s].setValue(n),!0},has:(e,t)=>Number.isInteger(+t)?t<e.getValue().length:t in e,ownKeys:e=>Object.keys(e.getValue()),getOwnPropertyDescriptor(e,t){if("string"!=typeof t)return;const n=+t;return Number.isInteger(n)&&n<e.getValue().length?Object.getOwnPropertyDescriptor(e.getValue(),t):void 0}};function oi(e){const t=new Proxy(this,ri);return ei.call(this,[]),this[ti]=this,this[ni]=t,this.push(...e),t}Object.assign(Object.setPrototypeOf(oi.prototype,ei.prototype),{[ti]:null,[ni]:null,*[Symbol.iterator](){const e=this[ti].getValue();for(const t of e)yield t.valueOf()},getTarget(){return this[ti]},copy(){const e=this[ti],t=e.create(),n=e.getValue();return t.push(...n),t.setModificationTime(0),t},equals(e){const t=this[ti].getValue(),n=e.getValue(),i=t.length;if(t===n)return!0;if(i!==n.length)return!1;for(let e=0;e<i;++e)if(!t[e].equals(n[e]))return!1;return!0},isDefaultValue(){return 0===this.length},set(e){const t=this[ti],n=t.getValue(),i=e.length;t.resize(i,void 0,!0);for(let t=0;t<i;++t)n[t].set(e[t]instanceof fe?e[t].getValue():e[t])},setValue(e){const t=this[ti];t.set(e instanceof oi?e.getValue():e),t.addEvent()},unshift(e){const t=this[ti],n=t.getValue();for(let e=arguments.length-1;e>=0;--e){const i=new(t.getSingleType());i.setValue(arguments[e]),t.addChildObject(i),n.unshift(i)}return t.addEvent(),n.length},shift(){const e=this[ti],t=e.getValue();if(t.length){const n=t.shift(),i=n.valueOf();return e.removeChildObject(n),e.addEvent(),i}},push(e){const t=this[ti],n=t.getValue();for(const e of arguments){const i=new(t.getSingleType());i.setValue(e),t.addChildObject(i),n.push(i)}return t.addEvent(),n.length},pop(){const e=this[ti],t=e.getValue();if(t.length){const n=t.pop(),i=n.valueOf();return e.removeChildObject(n),e.addEvent(),i}},splice(e,t,...n){const i=this[ti],s=i.getValue().length;if(0===arguments.length)return new i.constructor;arguments.length<2&&(t=s);const r=i[si](e,t);return n.length&&i[ii](e,n),r},[ii](e,t){const n=this[ti],i=[];for(const e of t){const t=new(n.getSingleType());t.setValue(e),n.addChildObject(t),i.push(t)}n.getValue().splice(e,0,...i),n.addEvent()},[si](e,t){const n=this[ti],i=n.getValue().splice(e,t),s=new n.constructor(...i);for(const e of i)n.removeChildObject(e);return n.addEvent(),s},resize(e,t,n){const i=this[ti],s=i.getValue(),r=s.length;if(e<r){for(let t=e;t<r;++t)i.removeChildObject(s[t]);s.length=e,n||i.addEvent()}else if(e>r){for(let n=r;n<e;++n){const e=new(i.getSingleType());void 0!==t&&e.setValue(t),i.addChildObject(e),s.push(e)}n||i.addEvent()}},addChildObject(e){e.addParent(this[ni])},removeChildObject(e){e.removeParent(this[ni]),e.dispose()},reverse(){const e=this[ti];return e.getValue().reverse(),e.addEvent(),e[ni]},sort(e){const t=this[ti];return Array.prototype.sort.call(this,e),t.addEvent(),t[ni]},toStream(e){const t=this[ti],n=t.getValue();switch(n.length){case 0:e.string+="[",e.string+=e.TidySpace(),e.string+="]";break;case 1:e.PushUnitCategory(t.getUnit()),n[0].toStream(e),e.PopUnitCategory();break;default:e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.ListStart(),e.IncIndent();for(let t=0,i=n.length-1;t<i;++t)e.string+=e.ListIndent(),n[t].toStream(e),e.string+=e.Comma(),e.string+=e.ListBreak();e.string+=e.ListIndent(),n.at(-1).toStream(e),e.string+=e.ListEnd(),e.DecIndent(),e.string+=e.ListIndent(),e.string+="]",e.PopUnitCategory()}},toVRMLStream(e){this.toStream(e)},toXMLStream(e){const t=this[ti];if(t.length){const n=t.getValue();e.PushUnitCategory(t.getUnit());for(let t=0,i=n.length-1;t<i;++t)n[t].toXMLStream(e),e.string+=e.Comma(),e.string+=e.TidySpace();n.at(-1).toXMLStream(e),e.PopUnitCategory()}},toJSONStream(e){const t=this[ti],n=t.length;if(n){const i=this.getValue();e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.ListBreak(),e.string+=e.IncIndent();for(let t=0,s=n-1;t<s;++t)e.string+=e.ListIndent(),i[t].toJSONStreamValue(e),e.string+=",",e.string+=e.ListBreak();e.string+=e.ListIndent(),i.at(-1).toJSONStreamValue(e),e.string+=e.ListBreak(),e.string+=e.DecIndent(),e.string+=e.ListIndent(),e.string+="]",e.PopUnitCategory()}else e.string+="[",e.string+=e.TidySpace(),e.string+="]"}});for(const e of Reflect.ownKeys(oi.prototype))Object.defineProperty(oi.prototype,e,{enumerable:!1});Object.defineProperty(oi.prototype,"length",{get(){return this[ti].getValue().length},set(e){this[ti].resize(e)}});const ai=oi;n.set("x_ite/Base/X3DObjectArrayField",ai);const li=ai,ui=Symbol(),hi=Symbol(),ci=Symbol(),di=Symbol(),pi=Symbol(),gi=Symbol(),fi=Symbol(),mi=Symbol(),_i={get(e,t){const n=e[t];if(void 0!==n)return n;if("string"==typeof t){const n=+t;if(Number.isInteger(n)){const t=e.getComponents(),i=e.getValueType();let s=e.getValue();return n>=e[pi]&&(s=e.resize(n+1)),1===t?i(s[n]):e[ci][n]??(e[ci][n]=yi(e,n,t,i))}return e[t]}},set(e,t,n){if(t in e)return e[t]=n,!0;const i=e.getComponents();let s=+t,r=e.getValue();if(s>=e[pi]&&(r=e.resize(s+1)),1===i){const t=e.getValueType();r[s]=t(n)}else{s*=i;for(let e=0;e<i;++e,++s)r[s]=n[e]}return e.addEvent(),!0},has:(e,t)=>Number.isInteger(+t)?t<e[pi]:t in e,ownKeys(e){const t=[];for(let n=0,i=e[pi];n<i;++n)t.push(String(n));return t},getOwnPropertyDescriptor(e,t){if("string"!=typeof t)return;const n=+t;return Number.isInteger(n)&&n<e[pi]?Object.getOwnPropertyDescriptor(e.getValue(),t):void 0}};function xi(e){const t=new Proxy(this,_i);return ei.call(this,new(this.getArrayType())(16)),this[ui]=this,this[hi]=t,this.getComponents()>1&&(this[ci]=[],this[di]=[]),this.push(...e),t}Object.assign(Object.setPrototypeOf(xi.prototype,ei.prototype),{[ui]:null,[di]:null,[pi]:0,*[Symbol.iterator](){const e=this[ui],t=e.getValue(),n=e.getComponents(),i=e.getValueType(),s=e[pi];if(1===n)for(let e=0;e<s;++e)yield i(t[e]);else{const t=e[ci];for(let r=0;r<s;++r)yield t[r]??(t[r]=yi(e,r,n,i))}},getTarget(){return this[ui]},copy(){const e=this[ui],t=e.getValue(),n=e.create(),i=new(e.getArrayType())(t);return n[pi]=e[pi],ei.prototype.set.call(n,i),n.setModificationTime(0),n},equals(e){const t=this[ui],n=e[ui],i=t[pi];if(t===n)return!0;if(i!==n[pi])return!1;const s=t.getValue(),r=n.getValue();for(let e=0,n=i*t.getComponents();e<n;++e)if(s[e]!==r[e])return!1;return!0},assign(e){const t=this[ui];t.set(e.getValue(),e.length),t.addEvent()},set(e,t){const n=this[ui],i=n.getComponents(),s=n[pi];let r=n.getValue(),o=void 0!==t?t*i:e.length;const a=o%i;a&&(o-=a,console.warn(`Array length must be multiple of components size, which is ${i}.`)),o/=i,r.length<e.length?(r=n[mi](e.length),r.set(e),a&&r.fill(0,o*i,o*i+a)):(r.set(e),o<s&&r.fill(0,o*i,s*i)),n[pi]=o},isDefaultValue(){return 0===this[pi]},setValue(e){const t=this[ui];e instanceof t.constructor?t.assign(e):(t.set(e),t.addEvent())},unshift(e){const t=this[ui],n=t.getComponents(),i=t[pi],s=arguments.length,r=t[mi]((i+s)*n);if(r.copyWithin(s*n,0,i*n),1===n){const e=t.getValueType();for(let t=0;t<s;++t)r[t]=e(arguments[t])}else for(let e=0,t=0;t<s;++t){const i=arguments[t];for(let t=0;t<n;++t,++e)r[e]=i[t]}return t[pi]+=s,t.addEvent(),t[pi]},shift(){const e=this[ui],t=e[pi];if(t){const i=e.getValue(),s=e.getComponents(),r=e.getValueType(),o=t-1;if(1===s)var n=r(i[0]);else{const t=e[di];for(let e=0;e<s;++e)t[e]=i[e];n=new r(...t)}return i.copyWithin(0,s,t*s),i.fill(0,s*o,t*s),e[pi]=o,e.addEvent(),n}},push(e){const t=this[ui],n=t.getComponents(),i=t[pi],s=arguments.length,r=t[mi]((i+s)*n);if(1===n){const e=t.getValueType();for(let t=0,n=i;t<s;++t,++n)r[n]=e(arguments[t])}else for(let e=i*n,t=0;t<s;++t){const i=arguments[t];for(let t=0;t<n;++t,++e)r[e]=i[t]}return t[pi]+=s,t.addEvent(),t[pi]},pop(){const e=this[ui],t=e[pi];if(t){const i=e.getValue(),s=e.getComponents(),r=e.getValueType(),o=t-1;if(1===s)var n=r(i[t-1]);else{const t=e[di];for(let e=0,n=o*s;e<s;++e,++n)t[e]=i[n];n=new r(...t)}return i.fill(0,o*s,t*s),e[pi]=o,e.addEvent(),n}},splice(e,t,...n){const i=this[ui],s=i[pi];if(0===arguments.length)return new i.constructor;e=Math.min(0|e,s),arguments.length<2&&(t=s),e+(t|=0)>s&&(t=s-e);const r=i[fi](e,e+t);return n.length&&i[gi](e,n),i.addEvent(),r},[gi](e,t){const n=this[ui],i=n.getComponents(),s=n[pi],r=t.length,o=n[mi]((s+r)*i);if(e*=i,o.copyWithin(e+r*i,e,s*i),1===i){const i=n.getValueType();for(let n=0,s=e;n<r;++n,++s)o[s]=i(t[n])}else for(let n=0,s=e;n<r;++n){const e=t[n];for(let t=0;t<i;++t,++s)o[s]=e[t]}n[pi]+=r},[fi](e,t){const n=this[ui],i=n.getValue(),s=n.getComponents(),r=t-e,o=n[pi],a=o-r,l=n[hi].slice(e,t);return e*=s,t*=s,i.copyWithin(e,t,o*s),i.fill(0,a*s,o*s),n[pi]=a,s>1&&(n[ci].length=a),n.addEvent(),l},resize(e,t,n){const i=this[ui],s=i[pi],r=i.getComponents();let o=i.getValue();if(e<s)o.fill(0,e*r,s*r),r>1&&(i[ci].length=e),n||i.addEvent();else if(e>s){if(o=i[mi](e*r),void 0!==t)if(1===r)o.fill(t,s*r,e*r);else for(let n=s*r,i=e*r;n<i;)for(let e=0;e<r;++e,++n)o[n]=t[e];n||i.addEvent()}return i[pi]=e,o},[mi](e){const t=this[ui],n=t.getValue();if(e<n.length)return n;const i=f.nextPowerOfTwo(e),s=new(t.getArrayType())(i);return s.set(n),ei.prototype.set.call(t,s),s},shrinkToFit(){const e=this[ui],t=e.getValue(),n=e[pi]*e.getComponents();if(t.length==n)return t;const i=t.subarray(0,n);return ei.prototype.set.call(e,i),i},reverse(){const e=this[ui],t=e.getValue(),n=e.getComponents(),i=e[pi]*n,s=Math.floor(e[pi]/2)*n;if(1===n)for(let e=0;e<s;++e){const n=i-e-1,s=t[e];t[e]=t[n],t[n]=s}else for(let e=0;e<s;e+=n)for(let s=0;s<n;++s){const r=e+s,o=i-e-1-(n-s-1),a=t[r];t[r]=t[o],t[o]=a}return e.addEvent(),e[hi]},sort(e){const t=this[ui],n=t.getValue(),i=t.getComponents(),s=t[pi];if(1===i){const i=t.getValueType(),r=e?(t,n)=>e(i(t),i(n)):f.cmp;t.set(n.subarray(0,s).sort(r))}else{const r=Array.from(t[hi],(e=>e.copy())).sort(e??((e,t)=>{for(let n=0;n<i;++n){if(e[n]<t[n])return-1;if(t[n]<e[n])return 1}return 0}));for(let e=0;e<s;++e){const t=r[e];for(let s=0,r=e*i;s<i;++s,++r)n[r]=t[s]}}return t.addEvent(),t[hi]},toStream(e){const t=this[ui],n=t.getValue(),i=t[pi],s=t.getComponents(),r=new(t.getSingleType());switch(i){case 0:e.string+="[",e.string+=e.TidySpace(),e.string+="]";break;case 1:if(e.PushUnitCategory(t.getUnit()),1===s)r.set(n[0]),r.toStream(e);else{for(let e=0,t=0;e<s;++e,++t)r[e]=n[t];r.toStream(e)}e.PopUnitCategory();break;default:if(e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.ListStart(),e.IncIndent(),1===s){for(let t=0,o=i-1;t<o;++t)e.string+=e.ListIndent(),r.set(n[t*s]),r.toStream(e),e.string+=e.Comma(),e.string+=e.ListBreak();e.string+=e.ListIndent(),r.set(n[(i-1)*s]),r.toStream(e)}else{for(let t=0,o=i-1;t<o;++t){e.string+=e.ListIndent();for(let e=0,i=t*s;e<s;++e,++i)r[e]=n[i];r.toStream(e),e.string+=e.Comma(),e.string+=e.ListBreak()}e.string+=e.ListIndent();for(let e=0,t=(i-1)*s;e<s;++e,++t)r[e]=n[t];r.toStream(e)}e.string+=e.ListEnd(),e.DecIndent(),e.string+=e.ListIndent(),e.string+="]",e.PopUnitCategory()}},toVRMLStream(e){this.toStream(e)},toXMLStream(e){const t=this[ui],n=t[pi];if(n){const i=t.getValue(),s=t.getComponents(),r=new(t.getSingleType());if(e.PushUnitCategory(t.getUnit()),1===s){for(let t=0,o=n-1;t<o;++t)r.set(i[t*s]),r.toXMLStream(e),e.string+=e.Comma(),e.string+=e.TidySpace();r.set(i[(n-1)*s]),r.toXMLStream(e)}else{for(let t=0,o=n-1;t<o;++t){for(let e=0,n=t*s;e<s;++e,++n)r[e]=i[n];r.toXMLStream(e),e.string+=e.Comma(),e.string+=e.TidySpace()}for(let e=0,t=(n-1)*s;e<s;++e,++t)r[e]=i[t];r.toXMLStream(e)}e.PopUnitCategory()}},toJSONStream(e){const t=this[ui],n=t.length;if(n){const i=t.getValue(),s=t.getComponents(),r=new(t.getSingleType());if(e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.ListBreak(),e.string+=e.IncIndent(),1===s){for(let t=0,o=n-1;t<o;++t)e.string+=e.ListIndent(),r.set(i[t*s]),r.toJSONStreamValue(e),e.string+=",",e.string+=e.ListBreak();e.string+=e.ListIndent(),r.set(i[(n-1)*s]),r.toJSONStreamValue(e)}else{for(let t=0,o=n-1;t<o;++t){e.string+=e.ListIndent();for(let e=0,n=t*s;e<s;++e,++n)r[e]=i[n];r.toJSONStreamValue(e),e.string+=",",e.string+=e.ListBreak()}e.string+=e.ListIndent();for(let e=0,t=(n-1)*s;e<s;++e,++t)r[e]=i[t];r.toJSONStreamValue(e)}e.string+=e.ListBreak(),e.string+=e.DecIndent(),e.string+=e.ListIndent(),e.string+="]",e.PopUnitCategory()}else e.string+="[",e.string+=e.TidySpace(),e.string+="]"},dispose(){ei.prototype.dispose.call(this[ui])}});for(const e of Reflect.ownKeys(xi.prototype))Object.defineProperty(xi.prototype,e,{enumerable:!1});function yi(e,t,n,i){const s=new i,r=s.getValue(),o=t*n;return s.addEvent=bi.bind(e,o,n,r),s.getValue=wi.bind(e,o,n,r),s}function wi(e,t,n){const i=this.getValue();for(let s=0;s<t;++s,++e)n[s]=i[e];return n}function bi(e,t,n){const i=this.getValue();for(let s=0;s<t;++s,++e)i[e]=n[s];this.addEvent()}Object.defineProperty(xi.prototype,"length",{get(){return this[pi]},set(e){this[ui].resize(e)}});const Si=xi;n.set("x_ite/Base/X3DTypedArrayField",Si);const vi=Si,Ti=jt.SFMatrix3d,Oi=jt.SFMatrix3f,Ei=wn.SFMatrix4d,Ci=wn.SFMatrix4f,Ni=vt.SFVec2d,Fi=vt.SFVec2f,Ii=Gt.SFVec3d,Mi=Gt.SFVec3f,Pi=Jn.SFVec4d,Di=Jn.SFVec4f,Ri=Symbol();function Ai(...e){return li.call(this,e)}Object.assign(Object.setPrototypeOf(Ai.prototype,li.prototype),{[Ri]:0,getSingleType:()=>Mn,copy(e){if(e){const t=new Ai;for(const n of this.getValue())t.push(n.copy(e));return t.setModificationTime(0),t}return li.prototype.copy.call(this)},addCloneCount(e){const t=this.getTarget();t[Ri]+=e;for(const n of t.getValue())n.addCloneCount(e)},removeCloneCount(e){const t=this.getTarget();t[Ri]-=e;for(const n of t.getValue())n.removeCloneCount(e)},addChildObject(e){const t=this.getTarget();li.prototype.addChildObject.call(t,e),e.addCloneCount(t[Ri])},removeChildObject(e){const t=this.getTarget();li.prototype.removeChildObject.call(t,e),e.removeCloneCount(t[Ri])},toStream(e){const t=this.getTarget(),n=t.getValue();switch(n.length){case 0:e.string+="[",e.string+=e.TidySpace(),e.string+="]";break;case 1:e.PushUnitCategory(t.getUnit()),n[0].toStream(e),e.PopUnitCategory();break;default:e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.TidyBreak(),e.IncIndent();for(let t=0,i=n.length;t<i;++t)e.string+=e.Indent(),n[t].toStream(e),e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.PopUnitCategory()}},toVRMLStream(e){const t=this.getTarget().getValue();switch(t.length){case 0:e.string+="[",e.string+=e.TidySpace(),e.string+="]";break;case 1:e.EnterScope(),t[0].toVRMLStream(e),e.LeaveScope();break;default:e.EnterScope(),e.string+="[",e.string+=e.TidyBreak(),e.IncIndent();for(const n of t)e.string+=e.Indent(),n.toVRMLStream(e),e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.LeaveScope()}},toXMLStream(e){const t=this.getTarget(),n=t.length;if(n){e.EnterScope();const i=t.getValue();for(let t=0,s=n-1;t<s;++t){const n=i[t].getValue();if(n)n.toXMLStream(e),e.string+=e.TidyBreak();else{e.string+=e.Indent(),e.string+="<",e.string+="NULL";const t=e.ContainerField();t&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(t.getName()),e.string+="'"),e.string+=e.closingTags?"></NULL>":"/>"}}const s=i.at(-1).getValue();if(s)s.toXMLStream(e);else{e.string+=e.Indent(),e.string+="<",e.string+="NULL";const t=e.ContainerField();t&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(t.getName()),e.string+="'")}e.LeaveScope()}},toJSONStream(e){const t=this.getTarget(),n=t.length;if(n){const i=t.getValue();e.EnterScope(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(let t=0,s=n-1;t<s;++t)e.string+=e.Indent(),i[t]?i[t].toJSONStreamValue(e):e.string+="null",e.string+=",",e.string+=e.TidyBreak();e.string+=e.Indent(),i.at(-1)?i.at(-1).toJSONStreamValue(e):e.string+="null",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.LeaveScope()}else e.string+="[",e.string+=e.TidySpace(),e.string+="]"},dispose(){const e=this.getTarget();e.resize(0,void 0,!1),e.processInterests(),li.prototype.dispose.call(e)}});for(const e of Reflect.ownKeys(Ai.prototype))Object.defineProperty(Ai.prototype,e,{enumerable:!1});function Vi(...e){return li.call(this,e)}Object.defineProperties(Ai,{typeName:{value:"MFNode",enumerable:!0}}),Object.assign(Object.setPrototypeOf(Vi.prototype,li.prototype),{getSingleType:()=>Hn,toXMLStream(e,t=!1){const n=this.getTarget(),i=n.length;if(i){const s=n.getValue();for(let n=0,r=i-1;n<r;++n)e.string+='"',s[n].toXMLStream(e,t),e.string+='"',e.string+=e.Comma(),e.string+=e.TidySpace();e.string+='"',s.at(-1).toXMLStream(e,t),e.string+='"'}}});for(const e of Reflect.ownKeys(Vi.prototype))Object.defineProperty(Vi.prototype,e,{enumerable:!1});function Li(...e){return li.call(this,e)}Object.defineProperties(Vi,{typeName:{value:"MFString",enumerable:!0}}),Object.assign(Object.setPrototypeOf(Li.prototype,li.prototype),{getSingleType:()=>Ji});for(const e of Reflect.ownKeys(Li.prototype))Object.defineProperty(Li.prototype,e,{enumerable:!1});function Bi(e,t,n,i,s){function r(...e){return vi.call(this,e)}Object.assign(Object.setPrototypeOf(r.prototype,vi.prototype),{getSingleType:()=>t,getValueType:()=>n,getArrayType:()=>i,getComponents:()=>s});for(const e of Reflect.ownKeys(r.prototype))Object.defineProperty(r.prototype,e,{enumerable:!1});return Object.defineProperties(r,{typeName:{value:e,enumerable:!0}}),r}Object.defineProperties(Li,{typeName:{value:"MFImage",enumerable:!0}});const Ui=e=>e,Xi={MFBool:Bi("MFBool",be,Boolean,Uint8Array,1),MFColor:Bi("MFColor",Ue,Ue,Float32Array,3),MFColorRGBA:Bi("MFColorRGBA",st,st,Float32Array,4),MFDouble:Bi("MFDouble",at,Ui,Float64Array,1),MFFloat:Bi("MFFloat",ht,Ui,Float32Array,1),MFImage:Li,MFInt32:Bi("MFInt32",pt,Ui,Int32Array,1),MFMatrix3d:Bi("MFMatrix3d",Ti,Ti,Float64Array,9),MFMatrix3f:Bi("MFMatrix3f",Oi,Oi,Float32Array,9),MFMatrix4d:Bi("MFMatrix4d",Ei,Ei,Float64Array,16),MFMatrix4f:Bi("MFMatrix4f",Ci,Ci,Float32Array,16),MFNode:Ai,MFRotation:Bi("MFRotation",kn,kn,Float64Array,4),MFString:Vi,MFTime:Bi("MFTime",Wn,Ui,Float64Array,1),MFVec2d:Bi("MFVec2d",Ni,Ni,Float64Array,2),MFVec2f:Bi("MFVec2f",Fi,Fi,Float32Array,2),MFVec3d:Bi("MFVec3d",Ii,Ii,Float64Array,3),MFVec3f:Bi("MFVec3f",Mi,Mi,Float32Array,3),MFVec4d:Bi("MFVec4d",Pi,Pi,Float64Array,4),MFVec4f:Bi("MFVec4f",Di,Di,Float32Array,4)};n.set("x_ite/Fields/ArrayFields",Xi);const ji=Xi,ki=ji.MFInt32;function zi(e,t,n,i){this.width=Math.max(0|e,0),this.height=Math.max(0|t,0),this.comp=f.clamp(0|n,0,4),this.array=new ki,this.array.setValue(i),this.array.length=this.width*this.height}Object.assign(zi.prototype,{copy(){return new zi(this.width,this.height,this.comp,this.array)},equals(e){return this.width===e.width&&this.height===e.height&&this.comp===e.comp&&this.array.equals(e.array)},assign(e){this.width=e.width,this.height=e.height,this.comp=e.comp,this.array.assign(e.array)},set(e,t,n,i){this.width=0|e,this.height=0|t,this.comp=0|n,this.array.assign(i)},setWidth(e){this.width=Math.max(0|e,0),this.array.length=this.width*this.height},getWidth(){return this.width},setHeight(e){this.height=Math.max(0|e,0),this.array.length=this.width*this.height},getHeight(){return this.height},setComp(e){this.comp=f.clamp(0|e,0,4)},getComp(){return this.comp},setArray(e){this.array.setValue(e),this.array.length=this.width*this.height},getArray(){return this.array}});const Gi=Symbol();function Hi(e,t,n,i){switch(arguments.length){case 0:fe.call(this,new zi(0,0,0,new ki));break;case 1:fe.call(this,arguments[0]);break;case 3:fe.call(this,new zi(e,t,n,new ki));break;case 4:fe.call(this,new zi(e,t,n,i));break;default:throw new Error("Invalid arguments.")}this.getValue().getArray().addParent(this),this.addInterest(Gi,this)}Object.assign(Object.setPrototypeOf(Hi.prototype,fe.prototype),{[Gi](){this.getValue().getArray().length=this.width*this.height},*[Symbol.iterator](){yield this.width,yield this.height,yield this.comp,yield this.array},copy(){return new Hi(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return 0===this.width&&0===this.height&&0===this.comp},set(e){this.getValue().assign(e)},toStream(e){const t=this.array;e.string+=this.width,e.string+=e.Space(),e.string+=this.height,e.string+=e.Space(),e.string+=this.comp,e.string+=e.AttribBreak(),e.IncIndent();for(let n=0,i=this.height;n<i;++n){e.string+=e.ListIndent();const s=n*this.width;for(let n=0,i=this.width;n<i;++n)e.string+="0x",e.string+=t[n+s].toString(16),n!==i-1&&(e.string+=e.Space());n!==i-1&&(e.string+=e.AttribBreak())}e.DecIndent()},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.ListBreak(),e.string+=e.IncIndent(),e.string+=e.ListIndent(),this.toJSONStreamValue(e),e.string+=e.DecIndent(),e.string+=e.ListBreak(),e.string+=e.ListIndent(),e.string+="]"},toJSONStreamValue(e){const t=this.array,n=t.length;if(e.string+=this.width,e.string+=",",e.string+=e.TidySpace(),e.string+=this.height,e.string+=",",e.string+=e.TidySpace(),e.string+=this.comp,e.string+=",",this.width&&this.height){e.string+=e.ListBreak(),e.string+=e.IncIndent();for(let i=0,s=this.height;i<s;++i){e.string+=e.ListIndent();const r=i*this.width;for(let i=0,s=this.width;i<s;++i)e.string+=t[i+r],i+r!==n-1&&(e.string+=","),i!==s-1&&(e.string+=e.TidySpace());i!==s-1&&(e.string+=e.ListBreak())}e.string+=e.DecIndent()}}});for(const e of Reflect.ownKeys(Hi.prototype))Object.defineProperty(Hi.prototype,e,{enumerable:!1});const qi={get(){return this.getValue().getWidth()},set(e){this.getValue().setWidth(e),this.addEvent()}},Yi={get(){return this.getValue().getHeight()},set(e){this.getValue().setHeight(e),this.addEvent()}},Wi={get(){return this.getValue().getComp()},set(e){this.getValue().setComp(e),this.addEvent()}},$i={get(){return this.getValue().getArray()},set(e){this.getValue().setArray(e),this.addEvent()}};Object.defineProperties(Hi.prototype,{x:qi,y:Yi,width:Object.assign({enumerable:!0},qi),height:Object.assign({enumerable:!0},Yi),comp:Object.assign({enumerable:!0},Wi),array:Object.assign({enumerable:!0},$i)}),Object.defineProperties(Hi,{typeName:{value:"SFImage",enumerable:!0}});const Ki=Hi;n.set("x_ite/Fields/SFImage",Ki);const Ji=Ki,Zi={SFBool:be,SFColor:Ue,SFColorRGBA:st,SFDouble:at,SFFloat:ht,SFImage:Ji,SFInt32:pt,...jt,...wn,SFNode:Mn,SFRotation:kn,SFString:Hn,SFTime:Wn,...vt,...Gt,...Jn,...ji};n.set("x_ite/Fields",Zi);const Qi=Zi,es=new Map,ts=new Map,ns={addConcreteNode({typeName:e,fieldDefinitions:t}){this.addNodeTypeName(e);for(const{name:e,accessType:n}of t)n&c.initializeOnly&&this.addFieldName(e)},addNodeTypeName(e){es.set(e,e),es.set(e.toUpperCase(),e)},getNodeTypeName:e=>es.get(e),addFieldName(e){ts.set(e,e),ts.set(e.toLowerCase(),e)},getFieldName:e=>ts.get(e)};n.set("x_ite/Parser/HTMLSupport",ns);const is=ns,ss=Symbol(),rs=Symbol(),os=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),as=Symbol(),ls=Symbol(),us=Symbol(),hs=Symbol(),cs=Symbol(),ds=Symbol(),ps=Symbol(),gs=Symbol();function fs(e){if(!this[ss]){k.call(this,e.getBrowser()),this[ss]=e,this[rs]=[c.X3DBaseNode],this[os]=this.constructor.fieldDefinitions??this[os],this[as]=new xe,this[ls]=new xe,this[us]=[],this[cs]=!0,this[hs]=!1,this[gs]=0,this.canUserDefinedFields()&&(this[os]=new te(this[os])),this.addChildObjects("name_changed",new Qi.SFTime,"typeName_changed",new Qi.SFTime,"cloneCount_changed",new Qi.SFTime);for(const e of this[os])this.addPredefinedField(e)}}Object.assign(Object.setPrototypeOf(fs.prototype,k.prototype),{[os]:new te([]),setName(e){k.prototype.setName.call(this,e),this._name_changed=this.getBrowser().getCurrentTime()},getMainScene(){let e=this[ss].getScene();for(;!e.isMainScene();)e=e.getScene();return e},getScene(){let e=this[ss];for(;!e.isScene();)e=e.getExecutionContext();return e},getExecutionContext(){return this[ss]},setExecutionContext(e){this[ss]=e},addType(e){this[rs].push(e)},getType(){return this[rs]},getInnerNode(){return this},isLive(){return this[cs]},setLive(e){this[cs]=e.valueOf(),this[ds]()},getLive:function(){function e(){return this._live}return function(){return Object.defineProperty(this,"getLive",{value:e}),this.addChildObjects("live",new Qi.SFBool(this.getLiveState())),this._live.removeParent(this),this.getOuterNode?.()?this.getOuterNode().getLive().addInterest(ds,this):this[ss]!==this&&this[ss].getLive().addInterest(ds,this),this._live}}(),getLiveState(){return this.getOuterNode?.()?this[cs]&&this.getOuterNode().getLive().getValue():this!==this[ss]?this[cs]&&this[ss].getLive().getValue():this[cs]},[ds](){const e=this._live;if(e)if(this.getLiveState()){if(e.getValue())return;e.set(!0),e.processEvent()}else e.getValue()&&(e.set(!1),e.processEvent())},create(e=this[ss]){return new this.constructor(e)},setup(){Object.freeze(this[rs]),this[os].addParent(this),this[as].addParent(this),this[ls].addParent(this);for(const e of this[us])e.setTainted(!1);for(const e of this[as])e.setTainted(!1);for(const e of this[ls])e.setTainted(!1);this.initialize(),this[hs]=!0},initialize(){},isInitialized(){return this[hs]},copy(e){const t=this.create(e);for(const e of this[as])t.getPredefinedFields().get(e.getName()).assign(e);if(this.canUserDefinedFields())for(const e of this[ls])t.addUserDefinedField(e.getAccessType(),e.getName(),e.copy());return t.setup(),t},addChildObjects(){for(let e=0,t=arguments.length;e<t;e+=2)this.addChildObject(arguments[e],arguments[e+1])},addChildObject(e,t){this[us].push(t),t.setTainted(!0),t.addParent(this),t.setName(e),Object.defineProperty(this,`_${e}`,{get:()=>t,set(e){t.setValue(e)}})},getFieldDefinitions(){return this[os]},getField(e){const t=ms(this[ls],e)??ms(this[as],e);if(t)return t;throw new Error(`Unknown field '${e}' in node class ${this.getTypeName()}.`)},getFields(){return[...this[as],...this[ls]]},addPredefinedField({accessType:e,name:t,value:n}){const i=n.copy();i.setTainted(!this[hs]),i.addParent(this),i.setName(t),i.setAccessType(e),this[as].add(t,i),Object.defineProperty(this,`_${t}`,{get:()=>i,set(e){i.setValue(e)},configurable:!0}),this.isPrivate()||i.addCloneCount(1)},addAlias(e,t){this[as].alias(e,t.getName()),t.isInitializable()&&is.addFieldName(e)},removePredefinedField(e){const t=this[as].get(e);t&&(t.removeParent(this),this[as].remove(e),delete this[`_${t.getName()}`],this.isPrivate()||t.removeCloneCount(1))},getPredefinedField(e){const t=ms(this[as],e);if(t)return t;throw new Error(`Unknown predefined field '${e}' in node class ${this.getTypeName()}.`)},getPredefinedFields(){return this[as]},canUserDefinedFields:()=>!1,addUserDefinedField(e,t,n){if(!this.canUserDefinedFields())throw new Error("Couldn't add user-defined field, node does not support this.");this[ls].has(t)&&this.removeUserDefinedField(t),n.setTainted(!this[hs]),n.addParent(this),n.setName(t),n.setAccessType(e),this[os].remove(t),this[os].add(t,new H(e,t,n)),this[ls].add(t,n),this.isPrivate()||n.addCloneCount(1)},removeUserDefinedField(e){const t=this[ls].get(e);t&&(t.removeParent(this),this[os].remove(e),this[ls].remove(e),this.isPrivate()||t.removeCloneCount(1))},getUserDefinedField(e){const t=ms(this[ls],e);if(t)return t;throw new Error(`Unknown user-defined field '${e}' in node class ${this.getTypeName()}.`)},getUserDefinedFields(){return this[ls]},getChangedFields(e){const t=[];if(e)for(const e of this[ls])t.push(e);for(const n of this[as])if(e&&(n.getInputRoutes().size||n.getOutputRoutes().size))t.push(n);else{if(0===n.getReferences().size){if(!n.isInitializable())continue;if(this.isDefaultValue(n))continue}t.push(n)}return t},isDefaultValue(e){if((this[ls].get(e.getName())??this[as].get(e.getName()))===e)var t=this[os].get(e.getName());else if(this.constructor.fieldDefinitions)t=this.constructor.fieldDefinitions.get(e.getName());return t?t.value!==e&&t.value.equals(e):!e.getModificationTime()},hasRoutes(){for(const e of this[as])if(e.getInputRoutes().size||e.getOutputRoutes().size)return!0;for(const e of this[ls])if(e.getInputRoutes().size||e.getOutputRoutes().size)return!0;return!1},isPrivate(){return this[ps]},setPrivate(e){if(this[ps]=e,e){for(const e of this[as])e.removeCloneCount(1);for(const e of this[ls])e.removeCloneCount(1)}else{for(const e of this[as])e.addCloneCount(1);for(const e of this[ls])e.addCloneCount(1)}},getCloneCount(){return this[gs]},addCloneCount(e){if(0===e)return;const t=this.getBrowser().getCurrentTime();this[gs]+=e,this[ss]._sceneGraph_changed=t,this._cloneCount_changed=t},removeCloneCount(e){if(0===e)return;const t=this.getBrowser().getCurrentTime();this[gs]-=e,this[ss]._sceneGraph_changed=t,this._cloneCount_changed=t},dispose(){this.setLive(!1);for(const e of this[us])e.dispose();for(const e of this[as])e.dispose();for(const e of this[ls])e.dispose();k.prototype.dispose.call(this)}});const ms=function(){const e=/^set_(.*?)$/,t=/^(.*?)_changed$/;return function(n,i){const s=n.get(i);if(s)return s;const r=i.match(e);if(r){const e=n.get(r[1]);if(e?.getAccessType()===c.inputOutput)return e}else{const e=i.match(t);if(e){const t=n.get(e[1]);if(t?.getAccessType()===c.inputOutput)return t}}}}();for(const e of Reflect.ownKeys(fs.prototype))Object.defineProperty(fs.prototype,e,{enumerable:!1});Object.defineProperties(fs.prototype,{name_changed:{get(){return this._name_changed},enumerable:!1},typeName_changed:{get(){return this._typeName_changed},enumerable:!1},cloneCount_changed:{get(){return this._cloneCount_changed},enumerable:!1}});const _s=fs;n.set("x_ite/Base/X3DBaseNode",_s);const xs=_s,ys="8.7.8";n.set("x_ite/Browser/VERSION",ys);const ws=ys;function bs(e){xs.call(this,e),this.addType(c.X3DNode)}Object.assign(Object.setPrototypeOf(bs.prototype,xs.prototype),{getComponentName(){return this.constructor.componentName},getContainerField(){return this.constructor.containerField},getSpecificationRange(){return this.constructor.specificationRange},copy(e){if(!e||e.getType().includes(c.X3DExecutionContext))return xs.prototype.copy.call(this,e);{const t=e.getBody();if(this.getName().length){const e=t.getNamedNodes().get(this.getName());if(e)return e.getValue()}const n=this.create(t);this.getNeedsName()&&this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(),this),this.getName().length&&t.updateNamedNode(this.getName(),n);for(const t of this.getPredefinedFields())try{const i=n.getPredefinedField(t.getName());if(t.hasReferences())for(const n of t.getReferences())try{i.addReference(e.getField(n.getName()))}catch(e){console.error(e)}else if(t.getAccessType()&c.initializeOnly)switch(t.getType()){case c.SFNode:case c.MFNode:i.assign(t.copy(e));break;default:i.assign(t)}i.setModificationTime(t.getModificationTime())}catch(e){console.error(e)}for(const t of this.getUserDefinedFields()){const i=t.copy(e);if(n.addUserDefinedField(t.getAccessType(),t.getName(),i),t.hasReferences())for(const n of t.getReferences())try{i.addReference(e.getField(n.getName()))}catch(t){console.error(`No reference '${n.getName()}' inside execution context ${e.getTypeName()} '${e.getName()}'.`)}i.setModificationTime(t.getModificationTime())}return n.setup(),n}},getDisplayName(){return this.getName().replace(/_\d+$/,"")},getNeedsName(){if(this.getName().length)return!1;if(this.getCloneCount()>1)return!0;if(this.hasRoutes())return!0;const e=this.getExecutionContext();for(const t of e.getImportedNodes())if(t.getInlineNode()===this)return!0;if(e.isScene())for(const t of e.getExportedNodes())if(t.getLocalNode()===this)return!0;return!1},getSourceText:()=>null,traverse(){},toStream(e){e.string+=this.getTypeName()+" { }"},toVRMLStream(e){e.EnterScope();const t=e.Name(this);if(t.length&&e.ExistsNode(this))return e.string+="USE",e.string+=e.Space(),e.string+=t,void e.LeaveScope();t.length&&(e.AddNode(this),e.string+="DEF",e.string+=e.Space(),e.string+=t,e.string+=e.Space()),e.string+=this.getTypeName(),e.string+=e.TidySpace(),e.string+="{";const n=this.getChangedFields(),i=this.getUserDefinedFields();if(this.canUserDefinedFields()&&i.length){let t=0,s=0;for(const n of i)t=Math.max(t,n.getTypeName().length),s=Math.max(s,e.AccessType(n.getAccessType()).length);const r=i.at(-1);e.string+=e.TidyBreak(),e.IncIndent();for(const n of i)this.toVRMLStreamUserDefinedField(e,n,t,s),e.string+=n===r?e.TidyBreak():e.Break();e.DecIndent(),0!==n.length&&(e.string+=e.TidyBreak())}if(0===n.length)i.length?e.string+=e.Indent():e.string+=e.TidySpace();else{const t=n.at(-1);0===i.length&&(e.string+=e.TidyBreak()),e.IncIndent();for(const i of n)this.toVRMLStreamField(e,i),e.string+=i===t?e.TidyBreak():e.Break();e.DecIndent(),e.string+=e.Indent()}e.string+="}",e.LeaveScope()},toVRMLStreamUserDefinedField(e,t,n,i){const s=e.IsSharedNode(this);if(0===t.getReferences().size||!e.ExecutionContext()||s)e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(i," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(n," "),e.string+=e.Space(),e.string+=t.getName(),t.isInitializable()&&(e.string+=e.Space(),t.toVRMLStream(e));else{let s=0,r=!1;for(const o of t.getReferences())r=r||o.isInitializable(),e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(i," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(n," "),e.string+=e.Space(),e.string+=t.getName(),e.string+=e.Space(),e.string+="IS",e.string+=e.Space(),e.string+=o.getName(),++s,s!==t.getReferences().size&&(e.string+=e.Break());t.getAccessType()!==c.inputOutput||r||t.isDefaultValue()||(e.string+=e.Break(),e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(i," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(n," "),e.string+=e.Space(),e.string+=t.getName(),t.isInitializable()&&(e.string+=e.Space(),t.toVRMLStream(e)))}},toVRMLStreamField(e,t){const n=e.IsSharedNode(this);if(0===t.getReferences().size||!e.ExecutionContext()||n)t.isInitializable()&&(e.string+=e.Indent(),e.string+=t.getName(),e.string+=e.Space(),t.toVRMLStream(e));else{let n=0,i=!1;for(const s of t.getReferences())i=i||s.isInitializable(),e.string+=e.Indent(),e.string+=t.getName(),e.string+=e.Space(),e.string+="IS",e.string+=e.Space(),e.string+=s.getName(),++n,n!==t.getReferences().size&&(e.string+=e.Break());t.getAccessType()!==c.inputOutput||i||this.isDefaultValue(t)||(e.string+=e.Break(),e.string+=e.Indent(),e.string+=t.getName(),e.string+=e.Space(),t.toVRMLStream(e))}},toXMLStream(e){const t=e.IsSharedNode(this);e.EnterScope();const n=e.Name(this);if(n.length&&e.ExistsNode(this)){e.string+=e.Indent(),e.string+="<",e.string+=this.getTypeName(),e.html&&"Script"===this.getTypeName()&&(e.string+=e.Space(),e.string+="type='model/x3d+xml'"),e.string+=e.Space(),e.string+="USE='",e.string+=e.XMLEncode(n),e.string+="'";const t=e.ContainerField();return t&&t.getName()!==this.getContainerField()&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(t.getName()),e.string+="'"),e.closingTags?(e.string+="></",e.string+=this.getTypeName(),e.string+=">"):e.string+="/>",void e.LeaveScope()}e.string+=e.Indent(),e.string+="<",e.string+=this.getTypeName(),e.html&&"Script"===this.getTypeName()&&(e.string+=e.Space(),e.string+="type='model/x3d+xml'"),n.length&&(e.AddNode(this),e.string+=e.Space(),e.string+="DEF='",e.string+=e.XMLEncode(n),e.string+="'");const i=e.ContainerField();i&&i.getName()!==this.getContainerField()&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(i.getName()),e.string+="'");const s=this.getChangedFields(),r=this.getUserDefinedFields(),o=[],a=[];let l=this.getSourceText();(0===l?.length||e.html&&"Script"!==this.getTypeName())&&(l=null),e.IncIndent(),e.IncIndent();for(const n of s){let i=!1;if(e.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((e=>e.isInitializable()))||(i=!this.isDefaultValue(n))),0===n.getReferences().size||!e.ExecutionContext()||t||i){if(i&&o.push(n),n.isInitializable())switch(n.getType()){case c.SFNode:case c.MFNode:a.push(n);break;default:if(n===l)break;e.string+=e.AttribBreak(),e.string+=e.ListIndent(),e.string+=n.getName(),e.string+="='",n.toXMLStream(e,n===this.getSourceText()),e.string+="'"}}else o.push(n)}if(e.DecIndent(),e.DecIndent(),this.canUserDefinedFields()&&r.length||o.length&&!t||a.length||l){if(e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),this.canUserDefinedFields())for(const n of r){e.string+=e.Indent(),e.string+="<field",e.string+=e.Space(),e.string+="accessType='",e.string+=e.AccessType(n.getAccessType()),e.string+="'",e.string+=e.Space(),e.string+="type='",e.string+=n.getTypeName(),e.string+="'",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(n.getName()),e.string+="'";let i=!1;if(e.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((e=>e.isInitializable()))||(i=!0)),0===n.getReferences().size||!e.ExecutionContext()||t||i)if(i&&e.ExecutionContext()&&o.push(n),!n.isInitializable()||n.isDefaultValue())e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak();else switch(n.getType()){case c.SFNode:case c.MFNode:e.PushContainerField(null),e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),n.toXMLStream(e),e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</field>",e.string+=e.TidyBreak(),e.PopContainerField();break;default:e.string+=e.Space(),e.string+="value='",n.toXMLStream(e),e.string+="'",e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak()}else e.ExecutionContext()&&o.push(n),e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak()}if(o.length&&!t){e.string+=e.Indent(),e.string+="<IS>",e.string+=e.TidyBreak(),e.IncIndent();for(const t of o){const n=t.getReferences();for(const i of n)e.string+=e.Indent(),e.string+="<connect",e.string+=e.Space(),e.string+="nodeField='",e.string+=e.XMLEncode(t.getName()),e.string+="'",e.string+=e.Space(),e.string+="protoField='",e.string+=e.XMLEncode(i.getName()),e.string+="'",e.string+=e.closingTags?"></connect>":"/>",e.string+=e.TidyBreak()}e.DecIndent(),e.string+=e.Indent(),e.string+="</IS>",e.string+=e.TidyBreak()}for(const t of a)e.PushContainerField(t),t.toXMLStream(e),e.string+=e.TidyBreak(),e.PopContainerField();if(l)for(const t of l)e.string+="<![CDATA[",e.string+=t,e.string+="]]>",e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="</",e.string+=this.getTypeName(),e.string+=">"}else e.closingTags?(e.string+="></",e.string+=this.getTypeName(),e.string+=">"):e.string+="/>";e.LeaveScope()},toJSONStream(e){const t=e.IsSharedNode(this);e.EnterScope();const n=e.Name(this);if(n.length&&e.ExistsNode(this))return e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+=this.getTypeName(),e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@USE",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",void e.LeaveScope();e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+=this.getTypeName(),e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),n.length&&(e.AddNode(this),e.string+=e.Indent(),e.string+='"',e.string+="@DEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n),e.string+='"',e.string+=",",e.string+=e.TidyBreak());const i=this.getChangedFields(),s=this.getUserDefinedFields(),r=[];let o=this.getSourceText();if(o&&1!==o.length&&(o=null),i.length){const n=[];for(const s of i){let i=!1;e.ExecutionContext()&&s.getAccessType()===c.inputOutput&&0!==s.getReferences().size&&([...s.getReferences()].some((e=>e.isInitializable()))||(i=!this.isDefaultValue(s))),0===s.getReferences().size||!e.ExecutionContext()||t||i?(i&&r.push(s),s!==o&&n.push(s)):r.push(s)}for(const t of n)if(t.isInitializable()){switch(t.getType()){case c.SFNode:case c.MFNode:e.string+=e.Indent(),e.string+='"',e.string+="-",e.string+=t.getName(),e.string+='"',e.string+=":",e.string+=e.TidySpace(),t.toJSONStream(e);break;default:e.string+=e.Indent(),e.string+='"',e.string+="@",e.string+=t.getName(),e.string+='"',e.string+=":",e.string+=e.TidySpace(),t.toJSONStream(e)}e.string+=",",e.string+=e.TidyBreak()}}if(this.canUserDefinedFields()&&s.length){e.string+=e.Indent(),e.string+='"',e.string+="field",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const n of s){e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@accessType",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.AccessType(n.getAccessType()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@type",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=n.getTypeName(),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n.getName()),e.string+='"';let i=!1;if(e.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((e=>e.isInitializable()))||(i=!0)),0===n.getReferences().size||!e.ExecutionContext()||t||i)if(i&&e.ExecutionContext()&&r.push(n),!n.isInitializable()||n.isDefaultValue());else switch(e.string+=",",e.string+=e.TidyBreak(),n.getType()){case c.SFNode:e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),n.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]";break;case c.MFNode:e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),n.toJSONStream(e);break;default:e.string+=e.Indent(),e.string+='"',e.string+="@value",e.string+='"',e.string+=":",e.string+=e.TidySpace(),n.toJSONStream(e)}else e.ExecutionContext()&&r.push(n);e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",n!==s.at(-1)&&(e.string+=","),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=",",e.string+=e.TidyBreak()}else;if(o){e.string+=e.Indent(),e.string+='"',e.string+="#sourceText",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();const t=o[0].split("\n");for(let n=0,i=t.length;n<i;++n)e.string+=e.ListIndent(),e.string+='"',e.string+=e.JSONEncode(t[n]),e.string+='"',n!==i-1&&(e.string+=","),e.string+=e.TidyBreak();e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=",",e.string+=e.TidyBreak()}if(r.length&&!t){e.string+=e.Indent(),e.string+='"',e.string+="IS",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="connect",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const t of r){const n=[...t.getReferences()];for(const i of n)e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@nodeField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@protoField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i.getName()),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",t===r.at(-1)&&i===n.at(-1)||(e.string+=","),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak()}e.JSONRemoveComma(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.LeaveScope()},dispose(){const e=this.getExecutionContext();if(this.getName()&&e.removeNamedNode(this.getName()),e.isScene()){if(!e.isMainScene()){const t=e.getExecutionContext();for(const e of[...t.getImportedNodes()])try{e.getExportedNode()===this&&t.removeImportedNode(e.getImportedName())}catch(e){}}for(const t of[...e.getExportedNodes()])t.getLocalNode()===this&&e.removeExportedNode(t.getExportedName())}for(const e of new Set(this.getParents()))if(e instanceof Qi.SFNode)for(const t of new Set(e.getParents()))t instanceof Qi.MFNode&&t.assign(t.filter((e=>e?.getValue()!==this)));for(const e of new Set(this.getParents()))e instanceof Qi.SFNode&&e.setValue(null);xs.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(bs.prototype))Object.defineProperty(bs.prototype,e,{enumerable:!1});Object.defineProperties(bs,{typeName:{value:"X3DNode",enumerable:!0},componentName:{value:"Core",enumerable:!0}});const Ss=bs;n.set("x_ite/Components/Core/X3DNode",Ss);const vs=Ss;function Ts(e){this.addType(c.X3DMetadataObject)}Object.assign(Ts.prototype,{initialize(){},dispose(){}}),Object.defineProperties(Ts,{typeName:{value:"X3DMetadataObject",enumerable:!0},componentName:{value:"Core",enumerable:!0}});const Os=Ts;n.set("x_ite/Components/Core/X3DMetadataObject",Os);const Es=Os;function Cs(e){vs.call(this,e),Es.call(this,e),this.addType(c.MetadataBoolean)}Object.assign(Object.setPrototypeOf(Cs.prototype,vs.prototype),Es.prototype,{initialize(){vs.prototype.initialize.call(this),Es.prototype.initialize.call(this)},dispose(){Es.prototype.dispose.call(this),vs.prototype.dispose.call(this)}}),Object.defineProperties(Cs,{typeName:{value:"MetadataBoolean",enumerable:!0},componentName:{value:"Core",enumerable:!0},containerField:{value:"metadata",enumerable:!0},specificationRange:{value:Object.freeze(["3.3","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"name",new Qi.SFString),new H(c.inputOutput,"reference",new Qi.SFString),new H(c.inputOutput,"value",new Qi.MFBool)]),enumerable:!0}});const Ns=Cs;n.set("x_ite/Components/Core/MetadataBoolean",Ns);const Fs=Ns;function Is(e){vs.call(this,e),Es.call(this,e),this.addType(c.MetadataDouble)}Object.assign(Object.setPrototypeOf(Is.prototype,vs.prototype),Es.prototype,{initialize(){vs.prototype.initialize.call(this),Es.prototype.initialize.call(this)},dispose(){Es.prototype.dispose.call(this),vs.prototype.dispose.call(this)}}),Object.defineProperties(Is,{typeName:{value:"MetadataDouble",enumerable:!0},componentName:{value:"Core",enumerable:!0},containerField:{value:"metadata",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"name",new Qi.SFString),new H(c.inputOutput,"reference",new Qi.SFString),new H(c.inputOutput,"value",new Qi.MFDouble)]),enumerable:!0}});const Ms=Is;n.set("x_ite/Components/Core/MetadataDouble",Ms);const Ps=Ms;function Ds(e){vs.call(this,e),Es.call(this,e),this.addType(c.MetadataFloat)}Object.assign(Object.setPrototypeOf(Ds.prototype,vs.prototype),Es.prototype,{initialize(){vs.prototype.initialize.call(this),Es.prototype.initialize.call(this)},dispose(){Es.prototype.dispose.call(this),vs.prototype.dispose.call(this)}}),Object.defineProperties(Ds,{typeName:{value:"MetadataFloat",enumerable:!0},componentName:{value:"Core",enumerable:!0},containerField:{value:"metadata",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"name",new Qi.SFString),new H(c.inputOutput,"reference",new Qi.SFString),new H(c.inputOutput,"value",new Qi.MFFloat)]),enumerable:!0}});const Rs=Ds;n.set("x_ite/Components/Core/MetadataFloat",Rs);const As=Rs;function Vs(e){vs.call(this,e),Es.call(this,e),this.addType(c.MetadataInteger)}Object.assign(Object.setPrototypeOf(Vs.prototype,vs.prototype),Es.prototype,{initialize(){vs.prototype.initialize.call(this),Es.prototype.initialize.call(this)},dispose(){Es.prototype.dispose.call(this),vs.prototype.dispose.call(this)}}),Object.defineProperties(Vs,{typeName:{value:"MetadataInteger",enumerable:!0},componentName:{value:"Core",enumerable:!0},containerField:{value:"metadata",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"name",new Qi.SFString),new H(c.inputOutput,"reference",new Qi.SFString),new H(c.inputOutput,"value",new Qi.MFInt32)]),enumerable:!0}});const Ls=Vs;n.set("x_ite/Components/Core/MetadataInteger",Ls);const Bs=Ls;function Us(e){vs.call(this,e),Es.call(this,e),this.addType(c.MetadataSet)}Object.assign(Object.setPrototypeOf(Us.prototype,vs.prototype),Es.prototype,{initialize(){vs.prototype.initialize.call(this),Es.prototype.initialize.call(this)},dispose(){Es.prototype.dispose.call(this),vs.prototype.dispose.call(this)}}),Object.defineProperties(Us,{typeName:{value:"MetadataSet",enumerable:!0},componentName:{value:"Core",enumerable:!0},containerField:{value:"metadata",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"name",new Qi.SFString),new H(c.inputOutput,"reference",new Qi.SFString),new H(c.inputOutput,"value",new Qi.MFNode)]),enumerable:!0}});const Xs=Us;n.set("x_ite/Components/Core/MetadataSet",Xs);const js=Xs;function ks(e){vs.call(this,e),Es.call(this,e),this.addType(c.MetadataString)}Object.assign(Object.setPrototypeOf(ks.prototype,vs.prototype),Es.prototype,{initialize(){vs.prototype.initialize.call(this),Es.prototype.initialize.call(this)},dispose(){Es.prototype.dispose.call(this),vs.prototype.dispose.call(this)}}),Object.defineProperties(ks,{typeName:{value:"MetadataString",enumerable:!0},componentName:{value:"Core",enumerable:!0},containerField:{value:"metadata",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"name",new Qi.SFString),new H(c.inputOutput,"reference",new Qi.SFString),new H(c.inputOutput,"value",new Qi.MFString)]),enumerable:!0}});const zs=ks;n.set("x_ite/Components/Core/MetadataString",zs);const Gs=zs;function Hs(e){this.getExecutionContext()||(vs.call(this,e),this.addType(c.X3DChildNode),this.addChildObjects("isCameraObject",new Qi.SFBool,"isPickableObject",new Qi.SFBool),this._isCameraObject.setAccessType(c.outputOnly),this._isPickableObject.setAccessType(c.outputOnly))}Object.assign(Object.setPrototypeOf(Hs.prototype,vs.prototype),{setCameraObject(e){e!==this._isCameraObject.getValue()&&(this._isCameraObject=e)},isCameraObject(){return this._isCameraObject.getValue()},setPickableObject(e){e!==this._isPickableObject.getValue()&&(this._isPickableObject=e)},isPickableObject(){return this._isPickableObject.getValue()}}),Object.defineProperties(Hs,{typeName:{value:"X3DChildNode",enumerable:!0},componentName:{value:"Core",enumerable:!0}});const qs=Hs;n.set("x_ite/Components/Core/X3DChildNode",qs);const Ys=qs;function Ws(e){Ys.call(this,e),this.addType(c.X3DInfoNode)}Object.setPrototypeOf(Ws.prototype,Ys.prototype),Object.defineProperties(Ws,{typeName:{value:"X3DInfoNode",enumerable:!0},componentName:{value:"Core",enumerable:!0}});const $s=Ws;n.set("x_ite/Components/Core/X3DInfoNode",$s);const Ks=$s;function Js(e){Ks.call(this,e),this.addType(c.WorldInfo)}Object.assign(Object.setPrototypeOf(Js.prototype,Ks.prototype),{initialize(){Ks.prototype.initialize.call(this),this.getExecutionContext().addWorldInfo(this)},dispose(){this.getExecutionContext().removeWorldInfo(this),Ks.prototype.dispose.call(this)}}),Object.defineProperties(Js,{typeName:{value:"WorldInfo",enumerable:!0},componentName:{value:"Core",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"title",new Qi.SFString),new H(c.initializeOnly,"info",new Qi.MFString)]),enumerable:!0}});const Zs=Js;n.set("x_ite/Components/Core/WorldInfo",Zs);const Qs=Zs;function er(e){Ys.call(this,e),this.addType(c.X3DBindableNode)}Object.assign(Object.setPrototypeOf(er.prototype,Ys.prototype),{isCameraObject:()=>!0,transitionStart(){}}),Object.defineProperties(er,{typeName:{value:"X3DBindableNode",enumerable:!0},componentName:{value:"Core",enumerable:!0}});const tr=er;n.set("x_ite/Components/Core/X3DBindableNode",tr);const nr=tr;function ir(e=[]){return Z.call(this,Array.from(e,(e=>[e.typeName,e])),Function)}Object.assign(Object.setPrototypeOf(ir.prototype,Z.prototype),{add(e,t){c.addNode(t),Z.prototype.add.call(this,e,t)}});for(const e of Reflect.ownKeys(ir.prototype))Object.defineProperty(ir.prototype,e,{enumerable:!1});Object.defineProperties(ir,{typeName:{value:"AbstractNodesArray",enumerable:!0}});const sr=ir;n.set("x_ite/Configuration/AbstractNodesArray",sr);const rr=sr,or=new rr;n.set("x_ite/Configuration/AbstractNodes",or);const ar=or;function lr(e=[]){return Z.call(this,Array.from(e,(e=>[e.getNodeName(),e])),Mn)}Object.setPrototypeOf(lr.prototype,Z.prototype);for(const e of Reflect.ownKeys(lr.prototype))Object.defineProperty(lr.prototype,e,{enumerable:!1});Object.defineProperties(lr,{typeName:{value:"NamedNodesArray",enumerable:!0}});const ur=lr;n.set("x_ite/Execution/NamedNodesArray",ur);const hr=ur,cr=Symbol(),dr=Symbol(),pr=Symbol(),gr=Symbol();function fr(e,t,n,i){vs.call(this,e),this[cr]=t,this[dr]=n,this[pr]=i,this[gr]=new Set,this[cr]._loadState.addInterest("set_loadState__",this)}Object.assign(Object.setPrototypeOf(fr.prototype,vs.prototype),{getInlineNode(){return this[cr]},getExportedName(){return this[dr]},getExportedNode(){return this[cr].getInternalScene().getExportedNode(this[dr]).getValue()},getImportedName(){return this[pr]},addRoute(e,t,n,i){const s={sourceNode:e,sourceField:t,destinationNode:n,destinationField:i};this[gr].add(s),this[cr].checkLoadState()===c.COMPLETE_STATE&&this.resolveRoute(s)},resolveRoute(e){try{const t=e.sourceField,n=e.destinationField;let i=e.sourceNode,s=e.destinationNode;e.real&&e.real.dispose(),i instanceof fr&&(i=i.getExportedNode()),s instanceof fr&&(s=s.getExportedNode()),e.real=this.getExecutionContext().addSimpleRoute(i,t,s,n)}catch(e){console.error(e.message)}},deleteRoute(e){for(const t of this[gr])t.real===e&&this[gr].delete(t)},deleteRoutes(){for(const e of this[gr]){const t=e.real;t&&(delete e.real,this.getExecutionContext().deleteSimpleRoute(t))}},set_loadState__(){switch(this[cr].checkLoadState()){case c.NOT_STARTED_STATE:case c.FAILED_STATE:this.deleteRoutes();break;case c.COMPLETE_STATE:this.deleteRoutes();for(const e of this[gr])this.resolveRoute(e)}},toStream(e){F.prototype.toStream.call(this,e)},toVRMLStream(e){if(!e.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");e.string+=e.Indent(),e.string+="IMPORT",e.string+=e.Space(),e.string+=e.Name(this.getInlineNode()),e.string+=".",e.string+=this.getExportedName(),this.getImportedName()!==this.getExportedName()&&(e.string+=e.Space(),e.string+="AS",e.string+=e.Space(),e.string+=this.getImportedName());try{e.AddRouteNode(this),e.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch{for(const t of this[gr]){const n=t.sourceNode,i=t.sourceField,s=t.destinationNode,r=t.destinationField;if(e.ExistsRouteNode(n)&&e.ExistsRouteNode(s)){const t=n instanceof fr?n.getImportedName():e.Name(n),o=s instanceof fr?s.getImportedName():e.Name(s);e.string+=e.Break(),e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="ROUTE",e.string+=e.Space(),e.string+=t,e.string+=".",e.string+=i,e.string+=e.Space(),e.string+="TO",e.string+=e.Space(),e.string+=o,e.string+=".",e.string+=r}}}},toXMLStream(e){if(!e.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");e.string+=e.Indent(),e.string+="<IMPORT",e.string+=e.Space(),e.string+="inlineDEF='",e.string+=e.XMLEncode(e.Name(this.getInlineNode())),e.string+="'",e.string+=e.Space(),e.string+="importedDEF='",e.string+=e.XMLEncode(this.getExportedName()),e.string+="'",this.getImportedName()!==this.getExportedName()&&(e.string+=e.Space(),e.string+="AS='",e.string+=e.XMLEncode(this.getImportedName()),e.string+="'"),e.string+=e.closingTags?"></IMPORT>":"/>";try{e.AddRouteNode(this),e.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch{for(const t of this[gr]){const n=t.sourceNode,i=t.sourceField,s=t.destinationNode,r=t.destinationField;if(e.ExistsRouteNode(n)&&e.ExistsRouteNode(s)){const t=n instanceof fr?n.getImportedName():e.Name(n),o=s instanceof fr?s.getImportedName():e.Name(s);e.string+=e.Break(),e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="<ROUTE",e.string+=e.Space(),e.string+="fromNode='",e.string+=e.XMLEncode(t),e.string+="'",e.string+=e.Space(),e.string+="fromField='",e.string+=e.XMLEncode(i),e.string+="'",e.string+=e.Space(),e.string+="toNode='",e.string+=e.XMLEncode(o),e.string+="'",e.string+=e.Space(),e.string+="toField='",e.string+=e.XMLEncode(r),e.string+="'",e.string+=e.closingTags?"></ROUTE>":"/>"}}}},toJSONStream(e){if(!e.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toJSONStream: Inline node does not exist.");e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="IMPORT",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@inlineDEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(e.Name(this.getInlineNode())),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@importedDEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.getExportedName()),e.string+='"',this.getImportedName()!==this.getExportedName()?(e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@AS",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.getImportedName()),e.string+='"',e.string+=e.TidyBreak()):e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}";try{e.AddRouteNode(this),e.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch{for(const t of this[gr]){const n=t.sourceNode,i=t.sourceField,s=t.destinationNode,r=t.destinationField;if(e.ExistsRouteNode(n)&&e.ExistsRouteNode(s)){const t=n instanceof fr?n.getImportedName():e.Name(n),o=s instanceof fr?s.getImportedName():e.Name(s);e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ROUTE",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@fromNode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@fromField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@toNode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(o),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@toField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(r),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}}}},dispose(){this[cr]._loadState.removeInterest("set_loadState__",this),this.deleteRoutes(),vs.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(fr.prototype))Object.defineProperty(fr.prototype,e,{enumerable:!1});Object.defineProperties(fr.prototype,{inlineNode:{get(){return Tn.get(this[cr])},enumerable:!0},exportedName:{get(){return this[dr]},enumerable:!0},exportedNode:{get(){return this[cr].getInternalScene().getExportedNode(this[dr])},enumerable:!0},importedName:{get(){return this[pr]},enumerable:!0}}),Object.defineProperties(fr,{typeName:{value:"X3DImportedNode",enumerable:!0}});const mr=fr;n.set("x_ite/Execution/X3DImportedNode",mr);const _r=mr;function xr(e=[]){return Z.call(this,Array.from(e,(e=>[e.getImportedName(),e])),_r)}Object.setPrototypeOf(xr.prototype,Z.prototype);for(const e of Reflect.ownKeys(xr.prototype))Object.defineProperty(xr.prototype,e,{enumerable:!1});Object.defineProperties(xr,{typeName:{value:"ImportedNodesArray",enumerable:!0}});const yr=xr;n.set("x_ite/Execution/ImportedNodesArray",yr);const wr=yr;function br(e){xs.call(this,e),this.addType(c.X3DProtoDeclarationNode),this.addChildObjects("updateInstances",new Qi.SFTime)}Object.assign(Object.setPrototypeOf(br.prototype,xs.prototype),{canUserDefinedFields:()=>!0,createInstance(e,t=!0){if(!1===t)return new Wh(e,this);{const t=new Wh(e,this);return t.setup(),Tn.get(t)}},newInstance(){return this.createInstance(this.getExecutionContext())},requestUpdateInstances(){this._updateInstances=this.getBrowser().getCurrentTime()},updateInstances(){this._updateInstances.processEvent()}});for(const e of Reflect.ownKeys(br.prototype))Object.defineProperty(br.prototype,e,{enumerable:!1});Object.defineProperties(br,{typeName:{value:"X3DProtoDeclarationNode",enumerable:!0}}),c.addNode(br);const Sr=br;n.set("x_ite/Prototype/X3DProtoDeclarationNode",Sr);const vr=Sr,Tr=Symbol();function Or(e){vr.call(this,e),this.addType(c.X3DProtoDeclaration),this[Tr]=new jh(e,this),this[Tr].setLive(!1),this.setLive(!1)}Object.assign(Object.setPrototypeOf(Or.prototype,vr.prototype),{initialize(){vr.prototype.initialize.call(this),this[Tr].setup()},getProtoDeclaration(){return this},getBody(){return this[Tr]},canUserDefinedFields:()=>!0,toVRMLStream(e){e.string+=e.Indent(),e.string+="PROTO",e.string+=e.Space(),e.string+=this.getName(),e.string+=e.TidySpace(),e.string+="[",e.EnterScope();const t=this.getUserDefinedFields();if(0===t.length)e.string+=e.TidySpace();else{let n=0,i=0;for(const s of t)n=Math.max(n,s.getTypeName().length),i=Math.max(i,e.AccessType(s.getAccessType()).length);e.string+=e.TidyBreak(),e.IncIndent();for(const s of t)this.toVRMLStreamUserDefinedField(e,s,n,i),e.string+=e.Break();e.DecIndent(),e.string+=e.Indent()}e.LeaveScope(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.IncIndent(),this[Tr].toVRMLStream(e),e.DecIndent(),e.string+=e.Indent(),e.string+="}"},toVRMLStreamUserDefinedField(e,t,n,i){e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(i," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(n," "),e.string+=e.Space(),e.string+=t.getName(),t.isInitializable()&&(e.string+=e.Space(),t.toVRMLStream(e))},toXMLStream(e){e.string+=e.Indent(),e.string+="<ProtoDeclare",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.getName()),e.string+="'",e.string+=">",e.string+=e.TidyBreak(),e.EnterScope();const t=this.getUserDefinedFields();if(0!==t.length){e.IncIndent(),e.string+=e.Indent(),e.string+="<ProtoInterface>",e.string+=e.TidyBreak(),e.IncIndent();for(const n of t)if(e.string+=e.Indent(),e.string+="<field",e.string+=e.Space(),e.string+="accessType='",e.string+=e.AccessType(n.getAccessType()),e.string+="'",e.string+=e.Space(),e.string+="type='",e.string+=n.getTypeName(),e.string+="'",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(n.getName()),e.string+="'",n.isDefaultValue())e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak();else switch(n.getType()){case c.SFNode:case c.MFNode:e.PushContainerField(n),e.string+=e.TidyBreak(),e.IncIndent(),n.toXMLStream(e),e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</field>",e.string+=e.TidyBreak(),e.PopContainerField();break;default:e.string+=e.Space(),e.string+="value='",n.toXMLStream(e),e.string+="'",e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak()}e.DecIndent(),e.string+=e.Indent(),e.string+="</ProtoInterface>",e.string+=e.TidyBreak(),e.DecIndent()}e.LeaveScope(),e.IncIndent(),e.string+=e.Indent(),e.string+="<ProtoBody>",e.string+=e.TidyBreak(),e.IncIndent(),this[Tr].toXMLStream(e),e.DecIndent(),e.string+=e.Indent(),e.string+="</ProtoBody>",e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</ProtoDeclare>"},toJSONStream(e){e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ProtoDeclare",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+='"',e.string+=e.JSONEncode(this.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="ProtoInterface",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.EnterScope();const t=this.getUserDefinedFields();if(t.length){e.string+=e.Indent(),e.string+='"',e.string+="field",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const n of t){if(e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@accessType",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.AccessType(n.getAccessType()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@type",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=n.getTypeName(),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n.getName()),e.string+='"',n.isDefaultValue())e.string+=e.TidyBreak();else switch(e.string+=",",e.string+=e.TidyBreak(),n.getType()){case c.SFNode:e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),n.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak();break;case c.MFNode:e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),n.toJSONStream(e),e.string+=e.TidyBreak();break;default:e.string+=e.Indent(),e.string+='"',e.string+="@value",e.string+='"',e.string+=":",e.string+=e.TidySpace(),n.toJSONStream(e),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",n!==t.at(-1)&&(e.string+=","),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]"}e.string+=e.DecIndent(),e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="}",e.string+=",",e.string+=e.TidyBreak(),e.LeaveScope(),e.string+=e.Indent(),e.string+='"',e.string+="ProtoBody",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),this[Tr].toJSONStream(e),e.JSONRemoveComma(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Reflect.ownKeys(Or.prototype))Object.defineProperty(Or.prototype,e,{enumerable:!1});Object.defineProperties(Or.prototype,{name:{get:Or.prototype.getName,enumerable:!0},fields:{get:Or.prototype.getFieldDefinitions,enumerable:!0},isExternProto:{value:!1,enumerable:!0}}),Object.defineProperties(Or,{typeName:{value:"X3DProtoDeclaration",enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode)]),enumerable:!0}}),c.addNode(Or);const Er=Or;n.set("x_ite/Prototype/X3DProtoDeclaration",Er);const Cr=Er,Nr=Symbol(),Fr=Symbol(),Ir=Symbol(),Mr=Symbol();function Pr(e){this.addType(c.X3DUrlObject),this.addChildObjects("loadState",new Qi.SFInt32(c.NOT_STARTED_STATE),"loadData",new Qi.SFTime),this[Nr]=!0,this[Fr]=Date.now()}Object.assign(Pr.prototype,{initialize(){this.getLive().addInterest("set_live__",this),this._load.addInterest("set_load__",this),this._url.addInterest("set_url__",this),this._loadData.addInterest("loadData",this),this._autoRefresh.addInterest("set_autoRefresh__",this),this._autoRefreshTimeLimit.addInterest("set_autoRefresh__",this)},setLoadState(e,t=!0){if(this._loadState=e,e===c.COMPLETE_STATE&&(this[Ir]=Date.now(),this.setAutoRefreshTimer(this._autoRefresh.getValue())),t)switch(e){case c.NOT_STARTED_STATE:break;case c.IN_PROGRESS_STATE:this.getScene().addLoadingObject(this);break;case c.COMPLETE_STATE:case c.FAILED_STATE:this.getScene().removeLoadingObject(this)}},checkLoadState(){return this._loadState.getValue()},getLoadState(){return this._loadState},setCache(e){this[Nr]=e},getCache(){return this[Nr]&&this.getBrowser().getBrowserOption("Cache")},requestImmediateLoad(e=!0){return new Promise(((t,n)=>{const i=()=>{const e=Symbol();this._loadState.addFieldCallback(e,(()=>{switch(this.checkLoadState()){case c.COMPLETE_STATE:this._loadState.removeFieldCallback(e),t();break;case c.FAILED_STATE:this._loadState.removeFieldCallback(e),n()}}))},s=this.checkLoadState();s!==c.COMPLETE_STATE?s!==c.IN_PROGRESS_STATE?this._load.getValue()?0!==this._url.length?(this.setCache(e),this.setLoadState(c.IN_PROGRESS_STATE),this.isInitialized()?this._loadData=this.getBrowser().getCurrentTime():this.loadData(),i()):t():n():i():t()}))},loadNow(){return this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad()},loadData(){},requestUnload(){const e=this.checkLoadState();e!==c.NOT_STARTED_STATE&&e!==c.FAILED_STATE&&(this.setLoadState(c.NOT_STARTED_STATE),this.unloadData())},unloadNow(){this.requestUnload()},unloadData(){},setAutoRefreshTimer(e){if(clearTimeout(this[Mr]),this._autoRefresh.getValue()<=0)return;const t=this._autoRefreshTimeLimit.getValue();0!==t&&(Date.now()-this[Fr])/1e3>t-e||(this[Mr]=setTimeout(this.performAutoRefresh.bind(this),1e3*e))},performAutoRefresh(){this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad(!1).catch(Function.prototype)},set_live__(){this.getLive().getValue()?this.set_autoRefresh__():clearTimeout(this[Mr])},set_load__(){this._load.getValue()?this.requestImmediateLoad().catch(Function.prototype):this.requestUnload()},set_url__(){this._load.getValue()&&(this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad().catch(Function.prototype))},set_autoRefresh__(){if(this.checkLoadState()!==c.COMPLETE_STATE)return;const e=(Date.now()-this[Ir])/1e3,t=this._autoRefresh.getValue();let n=t-e;n<0&&(n=Math.ceil(e/t)*t-e),this.setAutoRefreshTimer(n)},dispose(){}}),Object.defineProperties(Pr,{typeName:{value:"X3DUrlObject",enumerable:!0},componentName:{value:"Networking",enumerable:!0}});const Dr=Pr;n.set("x_ite/Components/Networking/X3DUrlObject",Dr);const Rr=Dr;var Ar=i(666);function Vr(e){this.scene=e,this.executionContexts=[e],this.prototypes=[]}Object.assign(Vr.prototype,{getBrowser(){return this.scene.getBrowser()},getScene(){return this.scene},getExecutionContext(){return this.executionContexts.at(-1)},pushExecutionContext(e){return this.executionContexts.push(e)},popExecutionContext(){this.executionContexts.pop()},getPrototype(){return this.prototypes.at(-1)},pushPrototype(e){return this.prototypes.push(e)},popPrototype(){this.prototypes.pop()},isInsideProtoDefinition(){return!!this.prototypes.length},loadComponents(){const e=this.getBrowser(),t=this.getScene();return Promise.all([e.loadComponents(t.getProfile()||e.getProfile("Full")),e.loadComponents(t.getComponents())])},setUnits(e){e?delete this.fromUnit:this.fromUnit=function(e,t){return t}},fromUnit(e,t){return this.scene.fromUnit(e,t)},convertColor(e,t="white"){const n=Ar("<div></div>").hide().css("color",t).appendTo(Ar("body")),i=Ar("<div></div>").css("color",e).appendTo(n),s=window.getComputedStyle(i[0]).color.replace(/^rgba?\(|\)$/g,"").split(/[\s,]+/).map((e=>parseFloat(e)));return n.remove(),s[0]/=255,s[1]/=255,s[2]/=255,"number"!=typeof s[3]&&(s[3]=1),s},sanitizeName:(e="")=>e=(e=(e=(e=e.replace(/^[\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f]*/,"")).replace(/[\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f]+/g,"-")).trim().replace(/[\s_-]+/g,"-")).replace(/^-+|-+$/g,"")});const Lr=Vr;n.set("x_ite/Parser/X3DParser",Lr);const Br=Lr;function Ur(e){return this.lastIndex=e.lastIndex,e.result=this.exec(e.input),!!e.result&&(e.lastIndex=this.lastIndex,!0)}function Xr(e){const t=e.lastIndex,n=this.parse(e);return e.lastIndex=t,n}const jr=function(e){for(const t of Object.values(e))t.parse=Ur,t.lookahead=Xr;return e};n.set("x_ite/Parser/Expressions",jr);const kr=jr;var zr=i(666);const Gr=kr({Whitespaces:/([\x20\n,\t\r]+)/gy,Comment:/#(.*?)(?=[\n\r])/gy,Break:/\r?\n/g,Header:/^#(VRML|X3D) V(.*?) (utf8)(?:[ \t]+(.*?))?[ \t]*[\n\r]/gy,AS:/AS/gy,COMPONENT:/COMPONENT/gy,DEF:/DEF/gy,EXPORT:/EXPORT/gy,EXTERNPROTO:/EXTERNPROTO/gy,FALSE:/FALSE|false/gy,IMPORT:/IMPORT/gy,IS:/IS/gy,META:/META/gy,NULL:/NULL/gy,TRUE:/TRUE|true/gy,PROFILE:/PROFILE/gy,PROTO:/PROTO/gy,ROUTE:/ROUTE/gy,TO:/TO/gy,UNIT:/UNIT/gy,USE:/USE/gy,OpenBrace:/\{/gy,CloseBrace:/\}/gy,OpenBracket:/\[/gy,CloseBracket:/\]/gy,Period:/\./gy,Colon:/\:/gy,Id:/([^\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f]{1}[^\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f]*)/gy,ComponentNameId:/([^\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f\x3a]{1}[^\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f\x3a]*)/gy,initializeOnly:/initializeOnly/gy,inputOnly:/inputOnly/gy,outputOnly:/outputOnly/gy,inputOutput:/inputOutput/gy,field:/field/gy,eventIn:/eventIn/gy,eventOut:/eventOut/gy,exposedField:/exposedField/gy,FieldType:/(MFBool|MFColorRGBA|MFColor|MFDouble|MFFloat|MFImage|MFInt32|MFMatrix3d|MFMatrix3f|MFMatrix4d|MFMatrix4f|MFNode|MFRotation|MFString|MFTime|MFVec2d|MFVec2f|MFVec3d|MFVec3f|MFVec4d|MFVec4f|SFBool|SFColorRGBA|SFColor|SFDouble|SFFloat|SFImage|SFInt32|SFMatrix3d|SFMatrix3f|SFMatrix4d|SFMatrix4f|SFNode|SFRotation|SFString|SFTime|SFVec2d|SFVec2f|SFVec3d|SFVec3f|SFVec4d|SFVec4f)/gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,string:/"((?:[^\\"]|\\\\|\\")*)"/gy,CONSTANTS:/([+-]?)\b(NAN|INFINITY|INF|PI|PI2|PI1_4|PI2_4|PI3_4|PI4_4|PI5_4|PI6_4|PI7_4|PI8_4|PI1_2|PI2_2|PI3_2|PI4_2|PI1_3|PI2_3|PI3_3|PI4_3|PI5_3|PI6_3|SQRT1_2|SQRT2)\b/giy,HTMLColor:/([a-zA-Z]+|0[xX][\da-fA-F]+|rgba?\(.*?\))/gy});function Hr(e){Br.call(this,e)}Object.assign(Object.setPrototypeOf(Hr.prototype,Br.prototype),{accessTypes:{field:c.initializeOnly,eventIn:c.inputOnly,eventOut:c.outputOnly,exposedField:c.inputOutput,initializeOnly:c.initializeOnly,inputOnly:c.inputOnly,outputOnly:c.outputOnly,inputOutput:c.inputOutput},SFImage:new Qi.SFImage,SFNode:new Qi.SFNode,MFString:new Qi.MFString,Color3:new De(0,0,0),Color4:new Je(0,0,0,0),Matrix3:new Bt,Matrix4:new _n,Rotation4:new dn,Vector2:new wt(0,0),Vector3:new Et(0,0,0),Vector4:new Yt(0,0,0,0),CONSTANTS:{NAN:Number.NaN,INFINITY:Number.POSITIVE_INFINITY,INF:Number.POSITIVE_INFINITY,PI:Math.PI,PI2:2*Math.PI,PI1_4:1*Math.PI/4,PI2_4:2*Math.PI/4,PI3_4:3*Math.PI/4,PI4_4:4*Math.PI/4,PI5_4:5*Math.PI/4,PI6_4:6*Math.PI/4,PI7_4:7*Math.PI/4,PI8_4:8*Math.PI/4,PI1_2:1*Math.PI/2,PI2_2:2*Math.PI/2,PI3_2:3*Math.PI/2,PI4_2:4*Math.PI/2,PI1_3:1*Math.PI/3,PI2_3:2*Math.PI/3,PI3_3:3*Math.PI/3,PI4_3:4*Math.PI/3,PI5_3:5*Math.PI/3,PI6_3:6*Math.PI/3,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2},getEncoding:()=>"STRING",setInput(e){this.input=e,this.lineNumber=1,this.lastIndex=0},isValid(){return"string"==typeof this.input&&!!this.input.match(/^(?:#X3D|#VRML|(?:[\x20\n,\t\r]*|#.*?[\r\n])*(PROFILE|COMPONENT|META|UNIT|EXTERNPROTO|PROTO|DEF|NULL|IMPORT|EXPORT|ROUTE|\w+(?:[\x20\n,\t\r]*|#.*?[\r\n])\{|$))/)},parseIntoScene(e,t){try{this.resolve=e,this.reject=t,this.getScene().setEncoding("VRML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.x3dScene()}catch(e){throw new Error(this.getError(e))}},throwOrWarn(e){if(this.getBrowser().isStrict())throw new Error(e);console.warn(e)},getError(e){const t=e.message;let n=this.getLine(),i=this.getLastLine(),s=this.getLastLine(),r=i.length-n.length+1;i.length>80&&(i=i.substr(r-40,80),s="",r=40);return`\n********************************************************************************\nParser error at line ${this.lineNumber}:${r}\nin '${this.getExecutionContext().getWorldURL()}'\n\n${s}\n${i}\n${Array(r).join(" ")}^\n${t}\n********************************************************************************\n`},getLine(){let e=this.input,t=this.lastIndex,n="";for(;t<e.length&&"\n"!==e[t]&&"\r"!==e[t];)n+=e[t++];return this.lastIndex=t,n},getLastLine(){let e=this.input,t=this.lastIndex,n="";for(t<e.length&&("\n"!==e[t]||"\r"!==e[t])&&--t;t>=0&&"\n"!==e[t]&&"\r"!==e[t];)n=e[t--]+n;return this.lastIndex=t,n},comments(){for(;this.comment(););},comment(){return!!this.whitespaces()||Gr.Comment.parse(this)},whitespaces(){return!!Gr.Whitespaces.parse(this)&&(this.lines(this.result[1]),!0)},lines(e){const t=e.match(Gr.Break);t&&(this.lineNumber+=t.length)},x3dScene:function(){const e=["Core","EnvironmentalEffects","EnvironmentalSensor","Geometry3D","Grouping","Interpolation","Lighting","Navigation","Networking","PointingDeviceSensor","Rendering","Scripting","Shape","Sound","Text","Texturing","Time"];return function(){if(this.headerStatement(),this.profileStatement(),this.componentStatements(),this.unitStatements(),this.metaStatements(),"2.0"===this.getScene().getSpecificationVersion()){this.getScene().setProfile(this.getBrowser().getProfile("Core"));for(const t of e)this.getScene().addComponent(this.getBrowser().getComponent(t))}if(this.resolve)this.loadComponents().then((()=>{try{if(this.statements(this.getExecutionContext().rootNodes),this.lastIndex<this.input.length)throw new Error("Unknown statement.");this.resolve(this.getScene())}catch(e){console.error(e),this.reject(new Error(this.getError(e)))}})).catch(this.reject);else if(this.statements(this.getExecutionContext().rootNodes),this.lastIndex<this.input.length)throw new Error("Unknown statement.")}}(),headerStatement(){Gr.Header.lastIndex=0;const e=Gr.Header.exec(this.input);return!!e&&(this.getScene().setSpecificationVersion(e[2]),this.getScene().setEncoding("VRML"),!0)},profileStatement(){if(this.comments(),Gr.PROFILE.parse(this)){if(this.profileNameId()){const e=this.getBrowser().getProfile(this.result[1]);return void this.getScene().setProfile(e)}throw new Error("Expected a profile name.")}},componentStatements(){let e;for(;e=this.componentStatement();)this.getScene().updateComponent(e)},componentStatement(){if(this.comments(),Gr.COMPONENT.parse(this)){if(this.componentNameId()){const e=this.result[1];if(this.comments(),Gr.Colon.parse(this)){if(this.componentSupportLevel()){const t=this.value;return this.getBrowser().getComponent(e,t)}throw new Error("Expected a component support level.")}throw new Error("Expected a ':' after component name.")}throw new Error("Expected a component name.")}return null},componentSupportLevel(){return this.int32()},unitStatements(){for(;this.unitStatement(););},unitStatement(){if(this.comments(),Gr.UNIT.parse(this)){if(this.categoryNameId()){const e=this.result[1];if(this.unitNameId()){const t=this.result[1];if(this.unitConversionFactor()){const n=this.value;try{return this.getScene().updateUnit(e,t,n),!0}catch(e){return console.log(e.message),!0}}throw new Error("Expected unit conversion factor.")}throw new Error("Expected unit name identifier.")}throw new Error("Expected category name identifier after UNIT statement.")}return!1},unitConversionFactor(){return this.double()},metaStatements(){for(;this.metaStatement(););},metaStatement(){if(this.comments(),Gr.META.parse(this)){if(this.metaKey()){const e=this.value;if(this.metaValue()){const t=this.value;return this.getScene().addMetaData(e,t),!0}throw new Error("Expected metadata value.")}throw new Error("Expected metadata key.")}return!1},metaKey(){return this.string()},metaValue(){return this.string()},exportStatement(){if(this.comments(),Gr.EXPORT.parse(this)){if(this.nodeNameId()){const t=this.result[1];this.comments();const n=this.getScene().getLocalNode(t);if(Gr.AS.parse(this)){if(!this.exportedNodeNameId())throw new Error("No name given after AS.");var e=this.result[1]}else e=t;if(this.getScene()===this.getExecutionContext())return this.getScene().updateExportedNode(e,n),!0;throw new Error("Export statement not allowed here.")}throw new Error("No name given after EXPORT.")}return!1},importStatement(){if(this.comments(),Gr.IMPORT.parse(this)){if(this.nodeNameId()){const t=this.result[1],n=this.getExecutionContext().getNamedNode(t);if(this.comments(),Gr.Period.parse(this)){if(this.exportedNodeNameId()){const t=this.result[1];if(this.comments(),Gr.AS.parse(this)){if(!this.nodeNameId())throw new Error("No name given after AS.");var e=this.result[1]}else e=t;return this.getExecutionContext().updateImportedNode(n,t,e),!0}throw new Error("Expected exported node name.")}throw new Error("Expected a '.' after exported node name.")}throw new Error("No name given after IMPORT statement.")}return!1},statements(e){for(;this.statement(e););},statement(e){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.importStatement())return!0;if(this.exportStatement())return!0;const t=this.nodeStatement();return!1!==t&&(e.push(t),!0)},nodeStatement(){if(this.comments(),Gr.DEF.parse(this)){if(this.nodeNameId())return this.node(this.result[1]);throw new Error("No name given after DEF.")}if(Gr.USE.parse(this)){if(this.nodeNameId())return this.getExecutionContext().getNamedNode(this.result[1]).getValue();throw new Error("No name given after USE.")}return Gr.NULL.parse(this)?null:this.node("")},protoStatement(){return!!this.proto()||!!this.externproto()},protoStatements(){for(;this.protoStatement(););},proto(){if(this.comments(),Gr.PROTO.parse(this)){if(this.nodeTypeId()){const e=this.result[1];if(this.comments(),Gr.OpenBracket.parse(this)){const t=this.interfaceDeclarations();if(this.comments(),Gr.CloseBracket.parse(this)){if(this.comments(),Gr.OpenBrace.parse(this)){const n=new Cr(this.getExecutionContext());for(const e of t)n.addUserDefinedField(e.getAccessType(),e.getName(),e);if(this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.protoBody(n.getBody().rootNodes),this.popExecutionContext(),this.popPrototype(),this.comments(),Gr.CloseBrace.parse(this)){n.setup();try{const t=this.getExecutionContext().getProtoDeclaration(e);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(e),t)}catch{}return this.getExecutionContext().updateProtoDeclaration(e,n),!0}throw new Error("Expected a '}' at the end of PROTO body.")}throw new Error("Expected a '{' at the beginning of PROTO body.")}throw new Error("Expected a ']' at the end of PROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of PROTO interface declaration.")}throw new Error("Invalid PROTO definition name.")}return!1},protoBody(e){this.protoStatements();const t=this.rootNodeStatement();!1!==t&&e.push(t),this.statements(e)},rootNodeStatement(){if(this.comments(),Gr.DEF.parse(this)){if(this.nodeNameId()){const e=this.result[0],t=this.node(e);if(!1!==t)return t;throw new Error("Expected node type name after DEF.")}throw new Error("No name given after DEF.")}const e=this.node("");return!1!==e&&e},interfaceDeclarations(){const e=[];let t;for(;t=this.interfaceDeclaration();)e.push(t);return e},restrictedInterfaceDeclaration(){if(this.comments(),Gr.inputOnly.parse(this)||Gr.eventIn.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.inputOnlyId()){const t=this.result[1],n=new Qi[e];return n.setAccessType(c.inputOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Gr.outputOnly.parse(this)||Gr.eventOut.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.outputOnlyId()){const t=this.result[1],n=new Qi[e];return n.setAccessType(c.outputOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Gr.initializeOnly.parse(this)||Gr.field.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.initializeOnlyId()){const t=this.result[1],n=new Qi[e];if(this.fieldValue(n))return n.setAccessType(c.initializeOnly),n.setName(t),n;throw new Error(`Couldn't read value for field '${t}'.`)}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}return null},interfaceDeclaration(){const e=this.restrictedInterfaceDeclaration();if(e)return e;if(this.comments(),Gr.inputOutput.parse(this)||Gr.exposedField.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.inputOutputId()){const t=this.result[1],n=new Qi[e];if(this.fieldValue(n))return n.setAccessType(c.inputOutput),n.setName(t),n;throw new Error(`Couldn't read value for field '${t}'.`)}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}return null},externproto(){if(this.comments(),Gr.EXTERNPROTO.parse(this)){if(this.nodeTypeId()){const e=this.result[1];if(this.comments(),Gr.OpenBracket.parse(this)){const t=this.externInterfaceDeclarations();if(this.comments(),Gr.CloseBracket.parse(this)){if(this.URLList(this.MFString)){const n=new fh(this.getExecutionContext(),this.MFString);for(const e of t)n.addUserDefinedField(e.getAccessType(),e.getName(),e);n.setup();try{const t=this.getExecutionContext().getExternProtoDeclaration(e);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(e),t)}catch{}return this.getExecutionContext().updateExternProtoDeclaration(e,n),!0}throw new Error(`Expected a URL list after EXTERNPROTO interface declaration '${e}'.`)}throw new Error("Expected a ']' at the end of EXTERNPROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of EXTERNPROTO interface declaration.")}throw new Error("Invalid EXTERNPROTO definition name.")}return!1},externInterfaceDeclarations(){const e=[];let t;for(;t=this.externInterfaceDeclaration();)e.push(t);return e},externInterfaceDeclaration(){if(this.comments(),Gr.inputOnly.parse(this)||Gr.eventIn.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.inputOnlyId()){const t=this.result[1],n=new Qi[e];return n.setAccessType(c.inputOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Gr.outputOnly.parse(this)||Gr.eventOut.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.outputOnlyId()){const t=this.result[1],n=new Qi[e];return n.setAccessType(c.outputOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Gr.initializeOnly.parse(this)||Gr.field.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.initializeOnlyId()){const t=this.result[1],n=new Qi[e];return n.setAccessType(c.initializeOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Gr.inputOutput.parse(this)||Gr.exposedField.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.inputOutputId()){const t=this.result[1],n=new Qi[e];return n.setAccessType(c.inputOutput),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}return null},URLList(e){return this.mfstringValue(e)},routeStatement(){if(this.comments(),Gr.ROUTE.parse(this)){if(this.nodeNameId()){const e=this.result[1],t=this.getExecutionContext().getLocalNode(e);if(this.comments(),Gr.Period.parse(this)){if(this.outputOnlyId()){const e=this.result[1];if(this.comments(),Gr.TO.parse(this)){if(this.nodeNameId()){const n=this.result[1],i=this.getExecutionContext().getLocalNode(n);if(this.comments(),Gr.Period.parse(this)){if(this.inputOnlyId())try{const n=this.result[1];return this.getExecutionContext().addRoute(t,e,i,n),!0}catch(e){return this.throwOrWarn(e.message),!0}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}throw new Error("Bad ROUTE specification: Expected a 'TO'.")}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}return!1},node(e){if(this.nodeTypeId()){const t=this.result[1],n=this.getExecutionContext().createNode(t,!1)??this.getExecutionContext().createProto(t,!1);if(!n)throw new Error(`Unknown node type or proto '${t}', you probably have insufficient component/profile statements, and/or an inappropriate specification version.`);if(e.length){try{const t=this.getExecutionContext().getNamedNode(e);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(e),t)}catch{}this.getExecutionContext().updateNamedNode(e,n)}if(this.comments(),Gr.OpenBrace.parse(this)){if(n.canUserDefinedFields()?this.scriptBody(n):this.nodeBody(n),this.comments(),Gr.CloseBrace.parse(this))return this.isInsideProtoDefinition()||n.setup(),n;throw new Error("Expected '}' at the end of node body.")}throw new Error("Expected '{' at the beginning of node body.")}return!1},scriptBody(e){for(;this.scriptBodyElement(e););},scriptBodyElement(e){const t=this.lastIndex,n=this.lineNumber;if(this.Id()){const t=this.accessTypes[this.result[1]];if(t&&this.fieldType()){const n=this.result[1];if(this.Id()){const s=this.result[1];if(this.comments(),Gr.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){const r=this.result[1];try{var i=this.getPrototype().getField(r)}catch{return this.throwOrWarn(`No such event or field '${r}' inside PROTO ${this.getPrototype().getName()} interface declaration.`),!0}if(c[n]===i.getType()){if(i.isReference(t)){let r=zr.try((()=>e.getUserDefinedField(s)));if(r||(r=new Qi[n],e.addUserDefinedField(t,s,r)),t===r.getAccessType()&&i.getType()===r.getType())return r.addReference(i),!0;throw new Error(`Couldn't add field '${s}', field already exists with different access type or data type.`)}throw new Error(`Field '${s}' and '${i.getName()}' in PROTO '${this.getPrototype().getName()}' are incompatible as an IS mapping.`)}throw new Error(`Field '${s}' and '${i.getName()}' in PROTO '${this.getPrototype().getName()}' have different types.`)}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}}}}this.lastIndex=t,this.lineNumber=n;const s=this.interfaceDeclaration();if(s){const t=zr.try((()=>e.getUserDefinedField(s.getName())));if(t){if(t.getAccessType()===s.getAccessType()&&t.getType()===s.getType())return t.assign(s),!0;throw new Error(`Couldn't set value for field '${s.getName()}', field already exists with different access type or data type.`)}return e.addUserDefinedField(s.getAccessType(),s.getName(),s),!0}return this.nodeBodyElement(e)},nodeBody(e){for(;this.nodeBodyElement(e););},nodeBodyElement(e){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.Id()){const i=this.result[1];try{var t=e.getPredefinedField(i)}catch{throw new Error(`Unknown field '${i}' in class '${e.getTypeName()}'.`)}if(this.comments(),Gr.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){const e=this.result[1];try{var n=this.getPrototype().getField(e)}catch{return this.throwOrWarn(`No such event or field '${e}' inside PROTO ${this.getPrototype().getName()}`),!0}if(t.getType()===n.getType()){if(n.isReference(t.getAccessType()))return t.addReference(n),!0;throw new Error(`Field '${t.getName()}' and '${n.getName()}' in PROTO ${this.getPrototype().getName()} are incompatible as an IS mapping.`)}throw new Error(`Field '${t.getName()}' and '${n.getName()}' in PROTO ${this.getPrototype().getName()} have different types.`)}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}if(t.isInitializable()){if(this.fieldValue(t))return!0;throw new Error(`Couldn't read value for field '${i}'.`)}throw new Error(`Couldn't assign value to ${this.accessTypeToString(t.getAccessType())} field '${i}'.`)}return!1},profileNameId(){return this.Id()},componentNameId(){return this.comments(),Gr.ComponentNameId.parse(this)},categoryNameId(){return this.Id()},unitNameId(){return this.Id()},exportedNodeNameId(){return this.Id()},nodeNameId(){return this.Id()},nodeTypeId(){return this.Id()},initializeOnlyId(){return this.Id()},inputOnlyId(){return this.Id()},outputOnlyId(){return this.Id()},inputOutputId(){return this.Id()},Id(){return this.comments(),Gr.Id.parse(this)},fieldType(){return this.comments(),Gr.FieldType.parse(this)},fieldValue(e){return this[e.getType()](e,e.getUnit())},bool(){return this.comments(),Gr.TRUE.parse(this)?(this.value=!0,!0):!!Gr.FALSE.parse(this)&&(this.value=!1,!0)},double(){return this.comments(),Gr.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!Gr.CONSTANTS.parse(this)&&(this.value=this.CONSTANTS[this.result[2].toUpperCase()],"-"===this.result[1]&&(this.value=-this.value),!0)},int32(){return this.comments(),!!Gr.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},string(){return this.comments(),!!Gr.string.parse(this)&&(this.value=Qi.SFString.unescape(this.result[1]),this.lines(this.value),!0)},sfboolValue(e){return!!this.bool()&&(e.setValue(this.value),!0)},mfboolValue(e){if(e.length=0,this.bool())return e.push(this.value),!0;if(Gr.OpenBracket.parse(this)){if(this.sfboolValues(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfboolValues(e){for(e.length=0,e=e.getTarget();this.bool();)e.push(this.value)},sfcolorValue(e){const t=this.lastIndex;if(this.double()){const t=this.value;if(this.double()){const n=this.value;if(this.double()){const i=this.value;return e.r=t,e.g=n,e.b=i,!0}}}if(this.lastIndex=t,this.comments(),Gr.HTMLColor.parse(this)){const t=this.convertColor(this.result[1].replace(/0x/i,"#"));return e.r=t[0],e.g=t[1],e.b=t[2],!0}return!1},mfcolorValue(e){if(e.length=0,this.sfcolorValue(this.Color3))return e.push(this.Color3),!0;if(Gr.OpenBracket.parse(this)){if(this.sfcolorValues(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorValues(e){e.length=0,e=e.getTarget();const t=this.Color3;for(;this.sfcolorValue(t);)e.push(t)},sfcolorrgbaValue(e){const t=this.lastIndex;if(this.double()){const t=this.value;if(this.double()){const n=this.value;if(this.double()){const i=this.value;if(this.double()){const s=this.value;return e.r=t,e.g=n,e.b=i,e.a=s,!0}}}}if(this.lastIndex=t,this.comments(),Gr.HTMLColor.parse(this)){const t=this.convertColor(this.result[1].replace(/0x/i,"#"));return e.r=t[0],e.g=t[1],e.b=t[2],e.a=t[3],!0}return!1},mfcolorrgbaValue(e){if(e.length=0,this.sfcolorrgbaValue(this.Color4))return e.push(this.Color4),!0;if(Gr.OpenBracket.parse(this)){if(this.sfcolorrgbaValues(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorrgbaValues(e){e.length=0,e=e.getTarget();const t=this.Color4;for(;this.sfcolorrgbaValue(t);)e.push(t)},sfdoubleValue(e){return!!this.double()&&(e.setValue(this.fromUnit(e.getUnit(),this.value)),!0)},mfdoubleValue(e){if(e.length=0,this.double())return e.push(this.fromUnit(e.getUnit(),this.value)),!0;if(Gr.OpenBracket.parse(this)){if(this.sfdoubleValues(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfdoubleValues(e){e.length=0;const t=(e=e.getTarget()).getUnit();for(;this.double();)e.push(this.fromUnit(t,this.value))},sfimageValue(e){if(this.int32()){const t=this.value;if(this.int32()){const n=this.value;if(this.int32()){const i=this.value,s=t*n;e.width=t,e.height=n,e.comp=i;const r=e.array;for(let e=0;e<s;++e){if(!this.int32())return!1;r[e]=this.value}return!0}}}return!1},mfimageValue(e){if(e.length=0,this.sfimageValue(this.SFImage))return e.push(this.SFImage),!0;if(Gr.OpenBracket.parse(this)){if(this.sfimageValues(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfimageValues(e){e.length=0,e=e.getTarget();const t=this.SFImage;for(;this.sfimageValue(t);)e.push(t)},sfint32Value(e){return!!this.int32()&&(e.setValue(this.value),!0)},mfint32Value(e){if(e.length=0,this.int32())return e.push(this.value),!0;if(Gr.OpenBracket.parse(this)){if(this.sfint32Values(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfint32Values(e){for(e.length=0,e=e.getTarget();this.int32();)e.push(this.value)},sfmatrix3Value(e){if(this.double()){const t=this.value;if(this.double()){const n=this.value;if(this.double()){const i=this.value;if(this.double()){const s=this.value;if(this.double()){const r=this.value;if(this.double()){const o=this.value;if(this.double()){const a=this.value;if(this.double()){const l=this.value;if(this.double()){const u=this.value;return e[0]=t,e[1]=n,e[2]=i,e[3]=s,e[4]=r,e[5]=o,e[6]=a,e[7]=l,e[8]=u,!0}}}}}}}}}return!1},mfmatrix3Value(e){if(e.length=0,this.sfmatrix3Value(this.Matrix3))return e.push(this.Matrix3),!0;if(Gr.OpenBracket.parse(this)){if(this.sfmatrix3Values(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3Values(e){e.length=0,e=e.getTarget();const t=this.Matrix3;for(;this.sfmatrix3Value(t);)e.push(t)},sfmatrix4Value(e){if(this.double()){const t=this.value;if(this.double()){const n=this.value;if(this.double()){const i=this.value;if(this.double()){const s=this.value;if(this.double()){const r=this.value;if(this.double()){const o=this.value;if(this.double()){const a=this.value;if(this.double()){const l=this.value;if(this.double()){const u=this.value;if(this.double()){const h=this.value;if(this.double()){const c=this.value;if(this.double()){const d=this.value;if(this.double()){const p=this.value;if(this.double()){const g=this.value;if(this.double()){const f=this.value;if(this.double()){const m=this.value;return e[0]=t,e[1]=n,e[2]=i,e[3]=s,e[4]=r,e[5]=o,e[6]=a,e[7]=l,e[8]=u,e[9]=h,e[10]=c,e[11]=d,e[12]=p,e[13]=g,e[14]=f,e[15]=m,!0}}}}}}}}}}}}}}}}return!1},mfmatrix4Value(e){if(e.length=0,this.sfmatrix4Value(this.Matrix4))return e.push(this.Matrix4),!0;if(Gr.OpenBracket.parse(this)){if(this.sfmatrix4Values(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4Values(e){e.length=0,e=e.getTarget();const t=this.Matrix4;for(;this.sfmatrix4Value(t);)e.push(t)},sfnodeValue(e){const t=this.nodeStatement();return!1!==t&&(e.setValue(t),!0)},mfnodeValue(e){e.length=0;const t=this.nodeStatement();if(!1!==t)return e.push(t),!0;if(Gr.OpenBracket.parse(this)){if(this.nodeStatements(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},nodeStatements(e){this.statements(e)},sfrotationValue(e){if(this.double()){const t=this.value;if(this.double()){const n=this.value;if(this.double()){const i=this.value;if(this.double()){const s=this.value;return e.x=t,e.y=n,e.z=i,e.angle=this.fromUnit("angle",s),!0}}}}return!1},mfrotationValue(e){if(e.length=0,this.sfrotationValue(this.Rotation4))return e.push(this.Rotation4),!0;if(Gr.OpenBracket.parse(this)){if(this.sfrotationValues(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfrotationValues(e){e.length=0,e=e.getTarget();const t=this.Rotation4;for(;this.sfrotationValue(t);)e.push(t)},sfstringValue(e){return!!this.string()&&(e.setValue(this.value),!0)},mfstringValue(e){if(e.length=0,this.string())return e.push(this.value),!0;if(Gr.OpenBracket.parse(this)){if(this.sfstringValues(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfstringValues(e){for(e.length=0,e=e.getTarget();this.string();)e.push(this.value)},sfvec2Value(e,t){if(this.double()){const n=this.value;if(this.double()){const i=this.value;return e.x=this.fromUnit(t,n),e.y=this.fromUnit(t,i),!0}}return!1},mfvec2Value(e){if(e.length=0,this.sfvec2Value(this.Vector2,e.getUnit()))return e.push(this.Vector2),!0;if(Gr.OpenBracket.parse(this)){if(this.sfvec2Values(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2Values(e){e.length=0,e=e.getTarget();const t=this.Vector2,n=e.getUnit();for(;this.sfvec2Value(t,n);)e.push(t)},sfvec3Value(e,t){if(this.double()){const n=this.value;if(this.double()){const i=this.value;if(this.double()){const s=this.value;return e.x=this.fromUnit(t,n),e.y=this.fromUnit(t,i),e.z=this.fromUnit(t,s),!0}}}return!1},mfvec3Value(e){if(e.length=0,this.sfvec3Value(this.Vector3,e.getUnit()))return e.push(this.Vector3),!0;if(Gr.OpenBracket.parse(this)){if(this.sfvec3Values(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3Values(e){e.length=0,e=e.getTarget();const t=this.Vector3,n=e.getUnit();for(;this.sfvec3Value(t,n);)e.push(t)},sfvec4Value(e,t){if(this.double()){const n=this.value;if(this.double()){const i=this.value;if(this.double()){const s=this.value;if(this.double()){const r=this.value;return e.x=this.fromUnit(t,n),e.y=this.fromUnit(t,i),e.z=this.fromUnit(t,s),e.w=this.fromUnit(t,r),!0}}}}return!1},mfvec4Value(e){if(e.length=0,this.sfvec4Value(this.Vector4,e.getUnit()))return e.push(this.Vector4),!0;if(Gr.OpenBracket.parse(this)){if(this.sfvec4Values(e),Gr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4Values(e){e.length=0,e=e.getTarget();const t=this.Vector4,n=e.getUnit();for(;this.sfvec4Value(t,n);)e.push(t)},accessTypeToString(e){switch(e){case c.initializeOnly:return"initializeOnly";case c.inputOnly:return"inputOnly";case c.outputOnly:return"outputOnly";case c.inputOutput:return"inputOutput"}}}),Object.assign(Hr.prototype,{[c.SFBool]:Hr.prototype.sfboolValue,[c.SFColor]:Hr.prototype.sfcolorValue,[c.SFColorRGBA]:Hr.prototype.sfcolorrgbaValue,[c.SFDouble]:Hr.prototype.sfdoubleValue,[c.SFFloat]:Hr.prototype.sfdoubleValue,[c.SFImage]:Hr.prototype.sfimageValue,[c.SFInt32]:Hr.prototype.sfint32Value,[c.SFMatrix3f]:Hr.prototype.sfmatrix3Value,[c.SFMatrix3d]:Hr.prototype.sfmatrix3Value,[c.SFMatrix4f]:Hr.prototype.sfmatrix4Value,[c.SFMatrix4d]:Hr.prototype.sfmatrix4Value,[c.SFNode]:Hr.prototype.sfnodeValue,[c.SFRotation]:Hr.prototype.sfrotationValue,[c.SFString]:Hr.prototype.sfstringValue,[c.SFTime]:Hr.prototype.sfdoubleValue,[c.SFVec2d]:Hr.prototype.sfvec2Value,[c.SFVec2f]:Hr.prototype.sfvec2Value,[c.SFVec3d]:Hr.prototype.sfvec3Value,[c.SFVec3f]:Hr.prototype.sfvec3Value,[c.SFVec4d]:Hr.prototype.sfvec4Value,[c.SFVec4f]:Hr.prototype.sfvec4Value,[c.MFBool]:Hr.prototype.mfboolValue,[c.MFColor]:Hr.prototype.mfcolorValue,[c.MFColorRGBA]:Hr.prototype.mfcolorrgbaValue,[c.MFDouble]:Hr.prototype.mfdoubleValue,[c.MFFloat]:Hr.prototype.mfdoubleValue,[c.MFImage]:Hr.prototype.mfimageValue,[c.MFInt32]:Hr.prototype.mfint32Value,[c.MFMatrix3d]:Hr.prototype.mfmatrix3Value,[c.MFMatrix3f]:Hr.prototype.mfmatrix3Value,[c.MFMatrix4d]:Hr.prototype.mfmatrix4Value,[c.MFMatrix4f]:Hr.prototype.mfmatrix4Value,[c.MFNode]:Hr.prototype.mfnodeValue,[c.MFRotation]:Hr.prototype.mfrotationValue,[c.MFString]:Hr.prototype.mfstringValue,[c.MFTime]:Hr.prototype.mfdoubleValue,[c.MFVec2d]:Hr.prototype.mfvec2Value,[c.MFVec2f]:Hr.prototype.mfvec2Value,[c.MFVec3d]:Hr.prototype.mfvec3Value,[c.MFVec3f]:Hr.prototype.mfvec3Value,[c.MFVec4d]:Hr.prototype.mfvec4Value,[c.MFVec4f]:Hr.prototype.mfvec4Value}),fe.prototype.fromString=function(e,t){const n=new Hr(t);if(n.setUnits(!!t),n.setInput(e),!n.fieldValue(this))throw new Error(`Couldn't read value for field '${this.getName()}'.`)};const qr=Hr;n.set("x_ite/Parser/VRMLParser",qr);const Yr=qr;var Wr=i(666);const $r={initializeOnly:c.initializeOnly,inputOnly:c.inputOnly,outputOnly:c.outputOnly,inputOutput:c.inputOutput};function Kr(e){Br.call(this,e),this.protoDeclarations=[],this.parents=[],this.parser=new Yr(e),this.url=new Qi.MFString,this.protoNames=new Map,this.protoFields=new WeakMap}Object.assign(Object.setPrototypeOf(Kr.prototype,Br.prototype),{getEncoding:()=>"XML",setInput(e){try{"string"==typeof e&&(e=Wr.parseXML(e)),this.input=e,this.xml=this.isXML(e),this.xml||Object.assign(this,Jr)}catch{this.input=void 0}},isValid(){return this.input instanceof XMLDocument||this.input instanceof HTMLElement||null===this.input},isXML:e=>!(e instanceof HTMLElement),parseIntoScene(e,t){this.resolve=e,this.reject=t,this.getScene().setEncoding("XML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.xmlElement(this.input)},xmlElement(e){if(null===e)return this.resolve?.(this.getScene());switch(e.nodeName){case"#document":{const t=Wr(e).children("X3D");if(t.length)for(const e of t)this.x3dElement(e);else this.resolve?this.loadComponents().then((()=>{this.childrenElements(e),this.resolve(this.getScene())})).catch(this.reject):this.childrenElements(e);break}case"X3D":this.x3dElement(e);break;case"Scene":case"SCENE":this.resolve?this.loadComponents().then((()=>{this.sceneElement(e),this.resolve(this.getScene())})).catch(this.reject):this.sceneElement(e);break;default:this.resolve?this.loadComponents().then((()=>{this.childrenElements(e),this.resolve(this.getScene())})).catch(this.reject):this.childrenElements(e)}},x3dElement(e){try{const t=e.getAttribute("profile"),n=this.getBrowser().getProfile(t||"Full");Wr.data(this.scene,"X3D",e),this.getScene().setProfile(n)}catch(e){console.error(e)}const t=e.getAttribute("version");t&&this.getScene().setSpecificationVersion(t);for(const t of e.childNodes)this.x3dElementChildHead(t);if(this.xml||this.headElement(e),this.resolve)this.loadComponents().then((()=>{for(const t of e.childNodes)this.x3dElementChildScene(t);this.resolve(this.getScene())})).catch(this.reject);else for(const t of e.childNodes)this.x3dElementChildScene(t)},x3dElementChildHead(e){switch(e.nodeName){case"head":case"HEAD":return void this.headElement(e)}},x3dElementChildScene(e){switch(e.nodeName){case"Scene":case"SCENE":return void this.sceneElement(e)}},headElement(e){for(const t of e.childNodes)this.headElementChild(t)},headElementChild(e){switch(e.nodeName){case"component":case"COMPONENT":return void this.componentElement(e);case"unit":case"UNIT":return void this.unitElement(e);case"meta":case"META":return void this.metaElement(e)}},componentElement(e){try{const t=e.getAttribute("name"),n=parseInt(e.getAttribute("level"));if(null===t)return console.warn("XML Parser Error: Bad component statement. Expected name attribute.");if(null===n)return console.warn("XML Parser Error: Bad component statement. Expected level attribute.");const i=this.getBrowser().getComponent(t,n);this.getScene().updateComponent(i)}catch(e){console.log(e.message)}},unitElement(e){const t=e.getAttribute("category"),n=e.getAttribute("name"),i=e.getAttribute("conversionFactor");return null===t?console.warn("XML Parser Error: Bad unit statement. Expected category attribute."):null===n?console.warn("XML Parser Error: Bad unit statement. Expected name attribute."):null===i?console.warn("XML Parser Error: Bad unit statement. Expected conversionFactor attribute."):void this.getScene().updateUnit(t,n,parseFloat(i))},metaElement(e){const t=e.getAttribute("name"),n=e.getAttribute("content");return null===t?console.warn("XML Parser Error: Bad meta statement. Expected name attribute."):null===n?console.warn("XML Parser Error: Bad meta statement. Expected content attribute."):void this.getScene().addMetaData(t,n)},sceneElement(e){Wr.data(e,"node",this.scene),this.childrenElements(e)},childrenElements(e){for(const t of e.childNodes)this.childElement(t)},childElement(e){switch(e.nodeName){case"#comment":case"#text":return;case"#cdata-section":return void this.cdataNode(e);case"ExternProtoDeclare":case"EXTERNPROTODECLARE":return void this.externProtoDeclareElement(e);case"ProtoDeclare":case"PROTODECLARE":return void this.protoDeclareElement(e);case"IS":return void this.isElement(e);case"ProtoInstance":case"PROTOINSTANCE":return void this.protoInstanceElement(e);case"fieldValue":case"FIELDVALUE":return void this.fieldValueElement(e);case"field":case"FIELD":return void this.fieldElement(e);case"ROUTE":return void this.routeElement(e);case"IMPORT":return void this.importElement(e);case"EXPORT":return void this.exportElement(e);default:return void this.nodeElement(e)}},externProtoDeclareElement(e){const t=e.getAttribute("name");if(this.id(t)){const n=e.getAttribute("url");this.parser.setInput(n??""),this.parser.sfstringValues(this.url),this.url.length||console.warn("XML Parser Error: Bad ExternProtoDeclare statement. Expected url attribute with value.");const i=new fh(this.getExecutionContext(),this.url);this.pushParent(i),this.protoInterfaceElement(e),this.popParent(),this.addProtoFieldNames(i),i.setup();try{const e=this.getExecutionContext().getExternProtoDeclaration(t);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(t),e)}catch{}this.getExecutionContext().updateExternProtoDeclaration(t,i),this.addProtoName(t)}},protoDeclareElement(e){const t=e.getAttribute("name");if(this.id(t)){const n=new Cr(this.getExecutionContext());for(const t of e.childNodes){switch(t.nodeName){case"ProtoInterface":case"PROTOINTERFACE":this.pushParent(n),this.protoInterfaceElement(t),this.popParent(),this.addProtoFieldNames(n);break;default:continue}break}for(const t of e.childNodes){switch(t.nodeName){case"ProtoBody":case"PROTOBODY":this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.pushParent(n),this.protoBodyElement(t),this.popParent(),this.popExecutionContext(),this.popPrototype();break;default:continue}break}n.setup();try{const e=this.getExecutionContext().getProtoDeclaration(t);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(t),e)}catch{}this.getExecutionContext().updateProtoDeclaration(t,n),this.addProtoName(t)}},protoInterfaceElement(e){for(const t of e.childNodes)this.protoInterfaceElementChild(t)},protoInterfaceElementChild(e){switch(e.nodeName){case"field":case"FIELD":return void this.fieldElement(e)}},fieldElement(e){try{if(0===this.getParents().length)return;const t=this.getParent();if(!(t instanceof xs))return;if(!t.canUserDefinedFields())return;const n=$r[e.getAttribute("accessType")]||c.initializeOnly,i=Qi[e.getAttribute("type")];if(!i)return;const s=e.getAttribute("name");if(!this.id(s))return;const r=new i;n&c.initializeOnly&&(this.fieldValue(r,e.getAttribute("value")),this.pushParent(r),this.childrenElements(e),this.popParent()),t.addUserDefinedField(n,s,r)}catch(e){console.error(e)}},protoBodyElement(e){this.childrenElements(e)},isElement(e){if(this.isInsideProtoDefinition())for(const t of e.childNodes)this.isElementChild(t)},isElementChild(e){switch(e.nodeName){case"connect":case"CONNECT":return void this.connectElement(e)}},connectElement(e){const t=e.getAttribute("nodeField"),n=e.getAttribute("protoField");if(null===t)return console.warn("XML Parser Error: Bad connect statement. Expected nodeField attribute.");if(null===n)return console.warn("XML Parser Error: Bad connect statement. Expected protoField attribute.");try{if(0===this.getParents().length)return;const e=this.getParent(),i=this.getPrototype();if(!(e instanceof vs))return;const s=e.getField(t),r=i.getField(n);if(s.getType()!==r.getType())throw new Error(`Field '${s.getName()}' and '${r.getName()}' in PROTO ${this.proto.getName()} have different types.`);if(!r.isReference(s.getAccessType()))throw new Error(`Field '${s.getName()}' and '${r.getName()}' in PROTO ${i.getName()} are incompatible as an IS mapping.`);s.addReference(r)}catch(e){console.warn(`XML Parser Error: Couldn't create IS reference. ${e.message}`)}},protoInstanceElement(e){try{if(this.useAttribute(e))return;const t=e.getAttribute("name");if(this.id(t)){const n=this.getExecutionContext().createProto(t,!1);if(!n)throw new Error(`Unknown proto or externproto type '${t}'.`);Wr.data(e,"node",n),this.defAttribute(e,n),this.addNode(e,n),this.pushParent(n),this.childrenElements(e),this.isInsideProtoDefinition()||n.setup(),this.popParent()}}catch(e){console.warn("XML Parser Error: ",e.message)}},fieldValueElement(e){try{if(0===this.getParents().length)return;const t=this.getParent(),n=e.getAttribute("name");if(!(t instanceof Wh))return;if(!this.id(n))return;const i=t.getField(n);i.getAccessType()&c.initializeOnly&&(i.getType()===c.MFNode&&(i.length=0),this.fieldValue(i,e.getAttribute("value")),this.pushParent(i),this.childrenElements(e),this.popParent())}catch(e){console.warn(`XML Parser Error: Couldn't assign field value. ${e.message}`)}},nodeElement(e){try{if(this.useAttribute(e))return;const t=this.getExecutionContext().createNode(this.nodeNameToCamelCase(e.nodeName),!1)??this.getExecutionContext().createProto(this.protoNameToCamelCase(e.nodeName),!1);if(!t)throw new Error(`Unknown node type '${e.nodeName}', you probably have insufficient component/profile statements and/or an inappropriate specification version.`);Wr.data(e,"node",t),"SCRIPT"===e.nodeName&&this.scriptElement(e),this.defAttribute(e,t),this.addNode(e,t),this.pushParent(t),this.nodeAttributes(e,t),this.childrenElements(e),this.isInsideProtoDefinition()||t.setup(),this.popParent()}catch(t){if("NULL"==e.nodeName)return void this.addNode(e,null);console.error(`XML Parser Error: ${t.message}`)}},scriptElement(e){const t=(new DOMParser).parseFromString(e.outerHTML,"application/xml").children[0].childNodes;e.textContent="// Content moved into childNodes.";for(const n of t)1!==n.nodeType&&4!==n.nodeType||e.appendChild(n)},routeElement(e){try{const t=e.getAttribute("fromNode"),n=e.getAttribute("fromField"),i=e.getAttribute("toNode"),s=e.getAttribute("toField");if(null===t)throw new Error("Bad ROUTE statement: Expected fromNode attribute.");if(null===n)throw new Error("Bad ROUTE statement: Expected fromField attribute.");if(null===i)throw new Error("Bad ROUTE statement: Expected toNode attribute.");if(null===s)throw new Error("Bad ROUTE statement: Expected toField attribute.");const r=this.getExecutionContext(),o=r.getLocalNode(t),a=r.getLocalNode(i),l=r.addRoute(o,n,a,s);Wr.data(e,"node",l)}catch(e){console.warn(`XML Parser Error: ${e.message}`)}},importElement(e){try{const t=e.getAttribute("inlineDEF"),n=e.getAttribute("importedDEF")||e.getAttribute("exportedDEF"),i=e.getAttribute("AS")||n;if(null===t)throw new Error("Bad IMPORT statement: Expected inlineDEF attribute.");if(null===n)throw new Error("Bad IMPORT statement: Expected importedDEF attribute.");const s=this.getExecutionContext().getNamedNode(t);this.getExecutionContext().updateImportedNode(s,n,i)}catch(e){console.warn(`XML Parser Error: ${e.message}`)}},exportElement(e){try{if(this.getScene()!==this.getExecutionContext())return void console.warn("XML Parser Error: Export statement not allowed here.");const t=e.getAttribute("localDEF"),n=e.getAttribute("AS")||t;if(null===t)throw new Error("Bad EXPORT statement: Expected localDEF attribute.");const i=this.getExecutionContext().getLocalNode(t);this.getScene().updateExportedNode(n,i)}catch(e){console.warn(`XML Parser Error: ${e.message}`)}},cdataNode(e){if(0===this.getParents().length)return;const t=this.getParent();t instanceof vs&&t.getSourceText()?.push(e.data)},useAttribute(e){try{const t=e.getAttribute("USE");if(this.id(t)){const n=this.getExecutionContext().getNamedNode(t);return this.addNode(e,n.getValue()),!0}}catch(e){console.warn(`Invalid USE name: ${e.message}`)}return!1},defAttribute(e,t){try{const n=e.getAttribute("DEF");if(n){try{const e=this.getExecutionContext().getNamedNode(n);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(n),e)}catch{}this.getExecutionContext().updateNamedNode(n,t)}}catch(e){console.warn(`Invalid DEF name: ${e.message}`)}},nodeAttributes(e,t){for(const n of e.attributes)this.nodeAttribute(n,t)},nodeAttribute(e,t){try{const n=t.getPredefinedField(this.attributeToCamelCase(t,e.name));n.isInitializable()&&this.fieldValue(n,e.value)}catch(e){}},fieldValue(e,t){null!==t&&(this.parser.pushExecutionContext(this.getExecutionContext()),this.parser.setInput(t),this[e.getType()].call(this.parser,e,e.getUnit()),this.parser.popExecutionContext())},id:e=>null!==e&&0!==e.length,getParents(){return this.parents},getParent(){return this.parents.at(-1)},pushParent(e){return this.parents.push(e)},popParent(){this.parents.pop()},addNode(e,t){if(0===this.parents.length||this.getParent()instanceof Cr)return void this.getExecutionContext().rootNodes.push(t);const n=this.getParent();if(n instanceof fe)switch(n.getType()){case c.SFNode:return void n.setValue(t);case c.MFNode:return void n.push(t)}else try{const i=e.getAttribute("containerField")||t?.getContainerField();if(!i)throw new Error("Node must have a container field attribute.");const s=n.getField(i);switch(s.getType()){case c.SFNode:return void s.setValue(t);case c.MFNode:return void s.push(t)}}catch(e){}},addProtoName(e){},addProtoFieldNames(e){},protoNameToCamelCase:e=>e,nodeNameToCamelCase:e=>e,attributeToCamelCase:(e,t)=>t}),Object.assign(Kr.prototype,{[c.SFBool]:Yr.prototype.sfboolValue,[c.SFColor]:Yr.prototype.sfcolorValue,[c.SFColorRGBA]:Yr.prototype.sfcolorrgbaValue,[c.SFDouble]:Yr.prototype.sfdoubleValue,[c.SFFloat]:Yr.prototype.sfdoubleValue,[c.SFImage]:Yr.prototype.sfimageValue,[c.SFInt32]:Yr.prototype.sfint32Value,[c.SFMatrix3f]:Yr.prototype.sfmatrix3Value,[c.SFMatrix3d]:Yr.prototype.sfmatrix3Value,[c.SFMatrix4f]:Yr.prototype.sfmatrix4Value,[c.SFMatrix4d]:Yr.prototype.sfmatrix4Value,[c.SFNode](e){e.setValue(null)},[c.SFRotation]:Yr.prototype.sfrotationValue,[c.SFString](e){e.setValue(Qi.SFString.unescape(this.input))},[c.SFTime]:Yr.prototype.sfdoubleValue,[c.SFVec2d]:Yr.prototype.sfvec2Value,[c.SFVec2f]:Yr.prototype.sfvec2Value,[c.SFVec3d]:Yr.prototype.sfvec3Value,[c.SFVec3f]:Yr.prototype.sfvec3Value,[c.SFVec4d]:Yr.prototype.sfvec4Value,[c.SFVec4f]:Yr.prototype.sfvec4Value,[c.MFBool]:Yr.prototype.sfboolValues,[c.MFColor]:Yr.prototype.sfcolorValues,[c.MFColorRGBA]:Yr.prototype.sfcolorrgbaValues,[c.MFDouble]:Yr.prototype.sfdoubleValues,[c.MFFloat]:Yr.prototype.sfdoubleValues,[c.MFImage]:Yr.prototype.sfimageValues,[c.MFInt32]:Yr.prototype.sfint32Values,[c.MFMatrix3d]:Yr.prototype.sfmatrix3Values,[c.MFMatrix3f]:Yr.prototype.sfmatrix3Values,[c.MFMatrix4d]:Yr.prototype.sfmatrix4Values,[c.MFMatrix4f]:Yr.prototype.sfmatrix4Values,[c.MFNode](e){e.length=0},[c.MFRotation]:Yr.prototype.sfrotationValues,[c.MFString]:Yr.prototype.sfstringValues,[c.MFTime]:Yr.prototype.sfdoubleValues,[c.MFVec2d]:Yr.prototype.sfvec2Values,[c.MFVec2f]:Yr.prototype.sfvec2Values,[c.MFVec3d]:Yr.prototype.sfvec3Values,[c.MFVec3f]:Yr.prototype.sfvec3Values,[c.MFVec4d]:Yr.prototype.sfvec4Values,[c.MFVec4f]:Yr.prototype.sfvec4Values});const Jr={addProtoName(e){this.protoNames.set(e,e),this.protoNames.set(e.toUpperCase(),e)},addProtoFieldNames:function(){const e=new Set;for(const t of["DEF","USE","containerField"])e.add(t).add(t.toLowerCase());return function(t){const n=new Map;this.protoFields.set(t,n);for(const{name:i}of t.getFieldDefinitions())e.has(i)||(n.set(i,i),n.set(i.toLowerCase(),i))}}(),protoNameToCamelCase(e){return this.protoNames.get(e)},nodeNameToCamelCase:e=>is.getNodeTypeName(e),attributeToCamelCase(e,t){return e instanceof Wh?this.protoFields.get(e.getProtoNode()).get(t):is.getFieldName(t)}},Zr=Kr;n.set("x_ite/Parser/XMLParser",Zr);const Qr=Zr;function eo(e){Br.call(this,e),this.namespace="http://www.web3d.org/specifications/x3d-namespace"}Object.assign(Object.setPrototypeOf(eo.prototype,Br.prototype),{getEncoding:()=>"JSON",setInput(e){try{"string"==typeof e&&(e=JSON.parse(e)),this.input=e}catch{this.input=void 0}},isValid(){return this.input instanceof Object},parseIntoScene(e,t){const n=this.createElement("X3D");this.convertToDOM(this.input,"",n);const i=new Qr(this.getScene());i.setInput(n),i.parseIntoScene(e,t),this.getScene().setEncoding("JSON")},elementSetAttribute(e,t,n){switch(t){case"SON schema":case"ncoding":break;default:"function"==typeof e.setAttribute&&e.setAttribute(t,n)}},convertChildren(e,t,n){for(const i in t)"object"==typeof t[i]&&(isNaN(parseInt(i))?this.convertObject(i,t,n,e.substr(1)):this.convertToDOM(t[i],i,n,e.substr(1)))},createElement(e,t){if(void 0===this.namespace)var n=document.createElement(e);else null==(n=document.createElementNS(this.namespace,e))&&(console.error("Trouble creating element for",e),n=document.createElement(e));return void 0!==t&&this.elementSetAttribute(n,"containerField",t),n},createCDATA(e,t,n){const i=(new DOMParser).parseFromString("<xml></xml>","application/xml").createCDATASection(n);t.appendChild(i)},convertObject(e,t,n,i){if(null!==t&&"object"==typeof t[e])if("@"===e.substr(0,1))this.convertToDOM(t[e],e,n);else if("-"===e.substr(0,1))this.convertChildren(e,t[e],n);else if("#comment"===e)for(const i in t[e]){const s=document.createComment(this.commentStringToXML(t[e][i]));n.appendChild(s)}else if("#sourceCode"===e||"@sourceCode"===e||"#sourceText"===e)this.createCDATA(document,n,t[e].join("\n"));else if("connect"===e||"fieldValue"===e||"field"===e||"meta"===e||"component"===e||"unit"===e){for(const s in t[e])if("object"==typeof t[e][s]){const r=this.createElement(e,i);this.convertToDOM(t[e][s],s,r),n.appendChild(r),n.appendChild(document.createTextNode("\n"))}}else{const s=this.createElement(e,i);this.convertToDOM(t[e],e,s),n.appendChild(s),n.appendChild(document.createTextNode("\n"))}},commentStringToXML:e=>e.replace(/\\\\/g,"\\"),SFStringToXML:e=>e.replace(/([\\"])/g,"\\$1"),JSONStringToXML:e=>e=(e=e.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n"),convertToDOM(e,t,n,i){let s=!1,r=[],o=!1;for(const t in e)if(s=!isNaN(parseInt(t)),s)switch(typeof e[t]){case"number":case"boolean":r.push(e[t]);break;case"string":r.push(e[t]),o=!0;break;case"object":this.convertToDOM(e[t],t,n);break;case"undefined":break;default:console.error("Unknown type found in array "+typeof e[t])}else switch(typeof e[t]){case"object":"X3D"===t?this.convertToDOM(e[t],t,n):this.convertObject(t,e,n,i);break;case"number":case"boolean":this.elementSetAttribute(n,t.substr(1),e[t]);break;case"string":if("#comment"!==t)this.elementSetAttribute(n,t.substr(1),this.JSONStringToXML(e[t]));else{const i=document.createComment(this.commentStringToXML(e[t]));n.appendChild(i)}break;case"undefined":break;default:console.error("Unknown type found in object "+typeof e[t]),console.error(e)}if(s){if("@"===t.substr(0,1))if(o){o=!1;for(const e in r)r[e]=this.SFStringToXML(r[e]);this.elementSetAttribute(n,t.substr(1),'"'+r.join('" "')+'"')}else this.elementSetAttribute(n,t.substr(1),r.join(" "));s=!1}return n}});const to=eo;n.set("x_ite/Parser/JSONParser",to);const no=to;function io(){}Object.assign(io.prototype,{removeGroups:!1,removeEmptyGroups:!1,combineGroupingNodes:!1,optimizeSceneGraph(e){const t=[];e.setValue(this.optimizeNodes(e,!0,t)),t.forEach((e=>e.dispose()))},optimizeNodes(e,t,n){return[...e].flatMap((e=>this.optimizeNode(e,t,n)))},optimizeNode(e,t,n){if(!e)return[];switch(e.getNodeTypeName()){case"Transform":e.children=this.optimizeNodes(e.children,!0,n);break;case"Anchor":case"Group":if(e.children=this.optimizeNodes(e.children,!0,n),this.removeEmptyGroups&&0===e.children.length)return[];if(this.removeGroups)break;return e;case"LOD":case"Switch":return this.optimizeNodes(e.children,!1,n),e;default:return e}if(!t)return e;if(this.removeEmptyGroups&&0===e.children.length)return[];if(!this.combineGroupingNodes)return e;if(e.getValue().hasRoutes())return e;if("Transform"===e.getNodeTypeName()){if(this.combineSingleChild(e,n),!e.translation.getValue().equals(Et.Zero))return e;if(!e.rotation.getValue().equals(dn.Identity))return e;if(!e.scale.getValue().equals(Et.One))return e}return n.push(e.getValue()),[...e.children]},combineSingleChild(e,t){if(1!==e.children.length)return;const n=e.children[0];if("Transform"!==n.getNodeTypeName())return;if(n.getValue().hasRoutes())return;const i=new Et(0,0,0),s=new dn,r=new Et(1,1,1),o=new dn,a=new _n,l=new _n;a.set(e.translation.getValue(),e.rotation.getValue(),e.scale.getValue(),e.scaleOrientation.getValue()),l.set(n.translation.getValue(),n.rotation.getValue(),n.scale.getValue(),n.scaleOrientation.getValue()),a.multLeft(l),a.get(i,s,r,o),e.translation=i,e.rotation=s,e.scale=r,e.scaleOrientation=o,e.children=n.children,t.push(n.getValue())}});const so=io;n.set("x_ite/Parser/X3DOptimizer",so);const ro=so,oo={NODE_ENV:"object"==typeof process&&-1!==process.release.name.search(/node|io.js/)};n.set("x_ite/Browser/Networking/Features",oo);const ao=oo,lo={getScriptUrl:function(){if(ao.NODE_ENV)var e=i.g.require("url").pathToFileURL(__filename).href;else if(document.currentScript)e=document.currentScript.src;else e=document.location.href;return function(){return e}}(),getProviderUrl(e){return e?(this.getScriptUrl().match(/\.min\.js$/)&&(e+=".min"),new URL("assets/components/"+e+".js",this.getScriptUrl()).href):"https://create3000.github.io/x_ite/"},getFontsUrl(e){return new URL("assets/fonts/"+e,this.getScriptUrl()).href},getLinetypeUrl(){return new URL("assets/linetype/linetypes.png",this.getScriptUrl()).href},getHatchingUrl(e){return new URL("assets/hatching/"+e+".png",this.getScriptUrl()).href},getLibUrl(e){return new URL("assets/lib/"+e,this.getScriptUrl()).href}};n.set("x_ite/Browser/Networking/URLs",lo);const uo=lo;var ho=i(666);function co(e){Br.call(this,e),ro.call(this),this.removeGroups=!1,this.removeEmptyGroups=!0,this.combineGroupingNodes=!0,this.extensions=new Set,this.lights=[],this.usedLights=0,this.buffers=[],this.bufferViews=[],this.accessors=[],this.samplers=[],this.materials=[],this.textureTransformNodes=[],this.cameras=[],this.viewpoints=0,this.nodes=[],this.animations=0}Object.assign(Object.setPrototypeOf(co.prototype,Br.prototype),ro.prototype,{getEncoding:()=>"JSON",setInput(e){try{"string"==typeof e&&(e=JSON.parse(e)),this.input=e}catch{this.input=void 0}},isValid:function(){const e=new Set(["asset","extra","extensions","extensionsRequired","extensionsUsed","buffers","bufferViews","accessors","samplers","images","textures","materials","meshes","cameras","nodes","scenes","scene","animations","skins"]);return function(){if(!(this.input instanceof Object))return!1;if(!Object.keys(this.input).every((t=>e.has(t))))return!1;const t=this.input.asset;return t instanceof Object&&"2.0"===t.version}}(),setBuffers(e){this.buffers=e},parseIntoScene(e,t){this.rootObject(this.input).then(e).catch(t)},rootObject:async function(e){if(!(e instanceof Object))return;const t=this.getBrowser(),n=this.getScene();return n.setEncoding("GLTF"),n.setProfile(t.getProfile("Interchange")),this.assetObject(e.asset),this.extensionsArray(e.extensionsUsed,this.extensions),this.extensionsArray(e.extensionsRequired,this.extensions),this.extensionsObject(e.extensions),await this.loadComponents(),await this.buffersArray(e.buffers),this.extensions.has("KHR_draco_mesh_compression")&&(this.draco=await this.createDraco()),this.bufferViewsArray(e.bufferViews),this.accessorsArray(e.accessors),this.samplersArray(e.samplers),await this.imagesArray(e.images),this.texturesArray(e.textures),this.materialsArray(e.materials),this.meshesArray(e.meshes),this.camerasArray(e.cameras),this.nodesArray(e.nodes),this.scenesArray(e.scenes,e.scene),this.animationsArray(e.animations),this.skinsArray(e.skins),this.getScene()},assetObject(e){if(!(e instanceof Object))return;const t=this.getExecutionContext(),n=t.getWorldURL(),i=t.createNode("WorldInfo",!1);for(const[t,n]of Object.entries(e))"string"==typeof n&&i._info.push(`${t}: ${n}`);if(e.extras instanceof Object)for(const[t,n]of Object.entries(e.extras))"string"==typeof n&&("title"===t?i._title=n:i._info.push(`${t}: ${n}`));i._info.sort(),i._title.getValue()||(i._title=decodeURI(new URL(n).pathname.split("/").at(-1)||n)),i.setup(),t.getRootNodes().push(i)},extensionsArray(e,t){if(!(e instanceof Array))return;const n=this.getBrowser(),i=this.getExecutionContext();for(const s of e)if(t.add(s),"KHR_texture_transform"===s)i.addComponent(n.getComponent("Texturing3D",2))},extensionsObject(e){if(e instanceof Object)for(const[t,n]of Object.entries(e))if("KHR_lights_punctual"===t)return this.khrLightsPunctualObject(n)},khrLightsPunctualObject(e){e instanceof Object&&this.lightsArray(e.lights)},lightsArray(e){e instanceof Array&&(this.lights=e)},lightObject(e){if(!(e instanceof Object))return null;const t=this.lightType(e);if(!t)return null;const n=this.getExecutionContext(),i=this.sanitizeName(e.name),s=new De(1,1,1);return this.vectorValue(e.color,s)&&(t._color=s),t._global=!0,t._intensity=this.numberValue(e.intensity,1),t.setup(),i&&(n.addNamedNode(n.getUniqueName(i),t),n.addExportedNode(n.getUniqueExportName(i),t)),t},lightType(e){switch(e.type){case"directional":return this.directionalLight(e);case"spot":return this.spotLight(e);case"point":return this.pointLight(e)}},directionalLight(e){return this.getExecutionContext().createNode("DirectionalLight",!1)},spotLight(e){const t=this.getExecutionContext().createNode("SpotLight",!1);return t._radius=this.numberValue(e.range,0)||1e9,t._cutOffAngle=this.numberValue(e.outerConeAngle,Math.PI/4),t._beamWidth=this.numberValue(e.innerConeAngle,0),t._attenuation=new Et(0,0,1),t},pointLight(e){const t=this.getExecutionContext().createNode("PointLight",!1);return t._radius=this.numberValue(e.range,0)||1e9,t._attenuation=new Et(0,0,1),t},buffersArray:async function(e){e instanceof Array&&(this.buffers=await Promise.all(e.map(((e,t)=>this.bufferObject(e,t)))))},bufferObject:async function(e,t){if(!(e instanceof Object))return;if(!e.uri)return this.buffers[t];const n=new URL(e.uri,this.getExecutionContext().getWorldURL()),i=await fetch(n),s=await i.blob(),r=await s.arrayBuffer();return ho.ungzip(r)},bufferViewsArray(e){if(e instanceof Array){this.bufferViews=e;for(const t of e)t.buffer=this.bufferViewObject(t)}},bufferViewObject(e){if(!(e instanceof Object))return;const t=this.buffers[e.buffer];if(!t)return;const n=e.byteOffset||0,i=e.byteLength;return t.slice(n,n+i)},accessorsArray(e){if(e instanceof Array){this.accessors=e;for(const t of e)this.accessorObject(t)}},accessorObject:function(){const e=new Map([[5120,Int8Array],[5121,Uint8Array],[5122,Int16Array],[5123,Uint16Array],[5124,Int32Array],[5125,Uint32Array],[5126,Float32Array]]),t=new Map([["SCALAR",1],["VEC2",2],["VEC3",3],["VEC4",4],["MAT2",4],["MAT3",9],["MAT4",16]]);return function(n){n instanceof Object&&Object.defineProperty(n,"array",{get:()=>{const i=e.get(n.componentType),s=this.bufferViews[n.bufferView||0],r=n.byteOffset||0,o=s.byteStride||0,a=t.get(n.type),l=n.count||0,u=o?o/i.BYTES_PER_ELEMENT:a,h=Math.min(u*l,(s.byteLength-r)/i.BYTES_PER_ELEMENT),c=new i(s.buffer,r,h);if(u===a){const e=this.sparseObject(n.sparse,c,a);return Object.defineProperty(n,"array",{value:e}),e}{const e=l*a,t=new i(e);for(let n=0,i=0;n<e;i+=u)for(let e=0;e<a;++e,++n)t[n]=c[i+e];const s=this.sparseObject(n.sparse,t,a);return Object.defineProperty(n,"array",{value:s}),s}},configurable:!0})}}(),sparseObject:function(){const e=new Map([[5121,Uint8Array],[5123,Uint16Array],[5125,Uint32Array]]);return function(t,n,i){if(!(t instanceof Object))return n;if(!(t.indices instanceof Object))return n;if(!(t.values instanceof Object))return n;const s=e.get(t.indices.componentType),r=this.bufferViews[t.indices.bufferView],o=t.indices.byteOffset,a=new s(r.buffer,o,t.count),l=n.constructor,u=this.bufferViews[t.values.bufferView],h=t.values.byteOffset,c=new l(u.buffer,h,t.count*i);n=n.slice();let d=0;for(const e of a)for(let t=0;t<i;++t,++d)n[e*i+t]=c[d];return n}}(),samplersArray(e){if(e instanceof Array){this.samplers=e;for(const t of e)this.samplerObject(t)}},samplerObject:function(){const e=new Map([[9728,["NEAREST_PIXEL",!1]],[9729,["AVG_PIXEL",!1]],[9984,["NEAREST_PIXEL_NEAREST_MIPMAP",!0]],[9985,["AVG_PIXEL_NEAREST_MIPMAP",!0]],[9986,["NEAREST_PIXEL_AVG_MIPMAP",!0]],[9987,["AVG_PIXEL_AVG_MIPMAP",!0]]]),t=new Map([[9728,"NEAREST_PIXEL"],[9729,"AVG_PIXEL"]]),n=new Map([[33071,"CLAMP_TO_EDGE"],[33648,"MIRRORED_REPEAT"],[10497,"REPEAT"]]);return function(i){i instanceof Object&&Object.defineProperty(i,"texturePropertiesNode",{get:()=>{const s=this.getExecutionContext(),r=s.createNode("TextureProperties",!1),o=this.sanitizeName(i.name);o&&(s.addNamedNode(s.getUniqueName(o),r),s.addExportedNode(s.getUniqueExportName(o),r));const a=e.get(i.minFilter)||["AVG_PIXEL",!1];return r._minificationFilter=a[0],r._generateMipMaps=a[1],r._magnificationFilter=t.get(i.magFilter)||"AVG_PIXEL",r._boundaryModeS=n.get(i.wrapS)||"REPEAT",r._boundaryModeT=n.get(i.wrapT)||"REPEAT",r.setup(),Object.defineProperty(i,"texturePropertiesNode",{value:r}),r},configurable:!0})}}(),imagesArray:async function(e){e instanceof Array&&(this.images=await Promise.all(e.map((e=>this.imageObject(e)))))},imageObject:async function(e){if(!(e instanceof Object))return;if(e.uri)return e;const t=this.bufferViews[e.bufferView];if(!t)return e;const n=t.buffer,i=new Blob([new Uint8Array(n)],{type:e.mimeType}),s=await this.blobToDataUrl(i);return e.uri=s,e},blobToDataUrl:e=>new Promise(((t,n)=>{const i=new FileReader;i.onload=t,i.onerror=n,i.readAsDataURL(e)})).then((e=>e.target.result)),texturesArray(e){e instanceof Array&&(this.textures=e)},textureObject(e){if(!(e instanceof Object))return;const t=this.images[e.source];if(!t)return null;if(e.textureNode)return e.textureNode;const n=this.getExecutionContext(),i=n.createNode("ImageTexture",!1),s=this.sanitizeName(e.name||t.name);s&&(n.addNamedNode(n.getUniqueName(s),i),n.addExportedNode(n.getUniqueExportName(s),i)),i._url=[t.uri];const r=this.samplers[e.sampler];return r instanceof Object&&(i._textureProperties=r.texturePropertiesNode),i.setup(),e.textureNode=i},materialsArray(e){e instanceof Array&&(this.materials=e)},materialObject(e){if(!(e instanceof Object))return this.getDefaultAppearance();if(e.appearanceNode)return e.appearanceNode;const t=this.texCoordIndices("",e);this.texCoordIndex=[...t].reduce(Math.max,-1),this.textureTransformNodes=[],this.texCoordMappings=new Map,e.texCoordMappings=this.texCoordMappings;const n=this.getExecutionContext(),i=n.createNode("Appearance",!1),s=this.createMaterial(e),r=this.sanitizeName(e.name),o=new De(0,0,0);this.vectorValue(e.emissiveFactor,o)&&(s._emissiveColor=o),s._emissiveTexture=this.textureInfo(e.emissiveTexture),s._emissiveTextureMapping=this.textureMapping(e.emissiveTexture),this.occlusionTextureInfo(e.occlusionTexture,s),this.normalTextureInfo(e.normalTexture,s),this.materialExtensions(e.extensions,s),s.setup();for(const e of t){const t=`TEXCOORD_${e}`;if(this.textureTransformNodes.length){const e=n.createNode("TextureTransform",!1);e._mapping=t,e._translation.y=-1,e._scale.y=-1,e.setup(),this.textureTransformNodes.push(e)}this.texCoordMappings.set(t,e)}return r&&(n.addNamedNode(n.getUniqueName(r),i),n.addExportedNode(n.getUniqueExportName(r),i)),i._alphaMode=this.stringValue(e.alphaMode,"OPAQUE"),i._alphaCutoff=this.numberValue(e.alphaCutoff,.5),i._material=s,i._textureTransform=this.createMultiTextureTransform(s),i.setup(),e.appearanceNode=i},texCoordIndices(e,t,n=new Set){if(!(t instanceof Object))return n;e.endsWith("Texture")&&!t?.extensions?.KHR_texture_transform&&n.add(t.texCoord||0);for(const[e,i]of Object.entries(t))this.texCoordIndices(e,i,n);return n},createMaterial(e){const t=[this.pbrMetallicRoughnessObject.bind(this,e.pbrMetallicRoughness),this.pbrSpecularGlossinessObject.bind(this,e.extensions?.KHR_materials_pbrSpecularGlossiness),this.pbrMetallicRoughnessObject.bind(this,{})];for(const e of t){const t=e();if(t)return t}},pbrMetallicRoughnessObject(e){if(!(e instanceof Object))return null;const t=this.getExecutionContext().createNode("PhysicalMaterial",!1),n=new Je(0,0,0,0),i=new De(0,0,0);return this.vectorValue(e.baseColorFactor,n)&&(t._baseColor=i.set(...n),t._transparency=1-n.a),t._metallic=this.numberValue(e.metallicFactor,1),t._roughness=this.numberValue(e.roughnessFactor,1),t._baseTexture=this.textureInfo(e.baseColorTexture),t._baseTextureMapping=this.textureMapping(e.baseColorTexture),t._metallicRoughnessTexture=this.textureInfo(e.metallicRoughnessTexture),t._metallicRoughnessTextureMapping=this.textureMapping(e.metallicRoughnessTexture),t},pbrSpecularGlossinessObject(e){if(!(e instanceof Object))return null;const t=this.getExecutionContext().createNode("Material",!1),n=new Je(0,0,0,0),i=new De(0,0,0),s=new De(0,0,0);return this.vectorValue(e.diffuseFactor,n)?(t._diffuseColor=i.set(...n),t._transparency=1-n.a):t._diffuseColor=De.White,this.vectorValue(e.specularFactor,s)?t._specularColor=s:t._specularColor=De.White,t._shininess=this.numberValue(e.glossinessFactor,1),t._diffuseTexture=this.textureInfo(e.diffuseTexture),t._diffuseTextureMapping=this.textureMapping(e.diffuseTexture),t._specularTexture=this.textureInfo(e.specularGlossinessTexture),t._specularTextureMapping=this.textureMapping(e.specularGlossinessTexture),t._shininessTexture=this.textureInfo(e.specularGlossinessTexture),t._shininessTextureMapping=this.textureMapping(e.specularGlossinessTexture),t},occlusionTextureInfo(e,t){if(!(e instanceof Object))return null;t._occlusionStrength=this.numberValue(e.strength,1),t._occlusionTexture=this.textureInfo(e),t._occlusionTextureMapping=this.textureMapping(e)},normalTextureInfo(e,t){if(!(e instanceof Object))return null;t._normalScale=this.numberValue(e.scale,1),t._normalTexture=this.textureInfo(e),t._normalTextureMapping=this.textureMapping(e)},textureInfo(e){return e instanceof Object?(e.extensions instanceof Object?e.mapping=this.textureTransformObject(e.extensions.KHR_texture_transform,e.texCoord||0):e.mapping=`TEXCOORD_${e.texCoord||0}`,this.textureObject(this.textures[e.index])):null},textureMapping:e=>e instanceof Object?e.mapping:"",materialExtensions(e,t){if(e instanceof Object)for(const[n,i]of Object.entries(e))switch(n){case"KHR_materials_unlit":this.khrMaterialsUnlitObject(t);break;case"KHR_materials_emissive_strength":this.khrMaterialsEmissiveStrengthObject(i,t)}},khrMaterialsUnlitObject(e){switch(e.getTypeName()){case"PhysicalMaterial":e._emissiveColor=e._baseColor,e._emissiveTextureMapping=e._baseTextureMapping,e._emissiveTexture=e._baseTexture,e._baseColor=De.Black,e._baseTextureMapping="",e._baseTexture=null;break;case"Material":e._emissiveColor=e._diffuseColor,e._emissiveTextureMapping=e._diffuseTextureMapping,e._emissiveTexture=e._diffuseTexture,e._diffuseColor=De.Black,e._diffuseTextureMapping="",e._diffuseTexture=null}},khrMaterialsEmissiveStrengthObject(e,t){if(!(e instanceof Object))return;const n=this.numberValue(e.emissiveStrength,1);t._emissiveColor.r*=n,t._emissiveColor.g*=n,t._emissiveColor.b*=n},textureTransformObject(e,t){if(!(e instanceof Object))return;if(!this.extensions.has("KHR_texture_transform"))return;const n=this.getExecutionContext().createNode("TextureTransformMatrix3D",!1),i=`TEXCOORD_${this.texCoordIndex+this.textureTransformNodes.length+1}`,s=new wt(0,0),r=new wt(1,1),o=new _n;return o.scale(new Et(1,-1,1)),o.translate(new Et(0,-1,0)),this.vectorValue(e.offset,s)&&o.translate(new Et(...s,0)),o.rotate(new dn(0,0,-1,this.numberValue(e.rotation,0))),this.vectorValue(e.scale,r)&&o.scale(new Et(...r,1)),n._mapping=i,n._matrix=o,n.setup(),this.textureTransformNodes.push(n),this.texCoordMappings.set(i,e.texCoord??t),i},meshesArray(e){e instanceof Array&&(this.meshes=e)},meshObject(e){if(!(e instanceof Object))return;if(e.shapeNodes)return e.shapeNodes;const t=this.primitivesArray(e.primitives),n=this.getExecutionContext(),i=this.sanitizeName(e.name);if(i)for(const e of t)n.addNamedNode(n.getUniqueName(i),e),n.addExportedNode(n.getUniqueExportName(i),e);return e.shapeNodes=t},primitivesArray(e){if(!(e instanceof Array))return[];const t=[];for(const n of e)this.primitiveObject(n,t);return t},primitiveObject(e,t){e instanceof Object&&(this.attributesObject(e.attributes),this.targetsArray(e.targets),e.indices=this.accessors[e.indices],e.material=this.materials[e.material],this.primitiveExtensionsObject(e.extensions,e),t.push(this.createShape(e)))},attributesObject(e){if(e instanceof Object){for(const t in e)e[t]=this.accessors[e[t]];e.TEXCOORD=[],e.COLOR=[],e.JOINTS=[],e.WEIGHTS=[];for(let t=0;e["TEXCOORD_"+t];++t)e.TEXCOORD.push(e["TEXCOORD_"+t]);for(let t=0;e["COLOR_"+t];++t)e.COLOR.push(e["COLOR_"+t]);for(let t=0;e["JOINTS_"+t];++t)e.JOINTS.push(e["JOINTS_"+t]);for(let t=0;e["WEIGHTS_"+t];++t)e.WEIGHTS.push(e["WEIGHTS_"+t])}},targetsArray(e){},primitiveExtensionsObject(e,t){if(e instanceof Object)for(const[n,i]of Object.entries(e))if("KHR_draco_mesh_compression"===n)return this.khrDracoMeshCompressionObject(i,t)},khrDracoMeshCompressionObject(e,t){if(!(e instanceof Object))return;if(!this.draco)return;const n=t.attributes,i=new Uint8Array(this.bufferViews[e.bufferView].buffer);this.dracoDecodeMesh(this.draco,i,e.attributes,(function(e){Object.defineProperty(t.indices,"array",{value:e})}),(function(e,t){n[e]&&Object.defineProperty(n[e],"array",{value:t})}))},dracoDecodeMesh(e,t,n,i,s){const r=new e.DecoderBuffer,o=new e.Decoder;let a,l;r.Init(t,t.byteLength);try{const t=o.GetEncodedGeometryType(r);switch(t){case e.TRIANGULAR_MESH:a=new e.Mesh,l=o.DecodeBufferToMesh(r,a);break;case e.POINT_CLOUD:a=new e.PointCloud,l=o.DecodeBufferToPointCloud(r,a);break;default:throw new Error(`Invalid geometry type ${t}.`)}if(!l.ok()||!a.ptr)throw new Error(l.error_msg());if(t===e.TRIANGULAR_MESH){const t=3*a.num_faces(),n=4*t,s=e._malloc(n);try{const r=new Uint32Array(t);o.GetTrianglesUInt32Array(a,n,s),r.set(new Uint32Array(e.HEAPF32.buffer,s,t)),i(r)}finally{e._free(s)}}for(const[t,i]of Object.entries(n)){const n=o.GetAttributeByUniqueId(a,i),r=n.num_components(),l=a.num_points()*r,u=l*Float32Array.BYTES_PER_ELEMENT,h=e._malloc(u);try{const i=new Float32Array(l);o.GetAttributeDataArrayForAllPoints(a,n,e.DT_FLOAT32,u,h),i.set(new Float32Array(e.HEAPF32.buffer,h,l)),s(t,i)}finally{e._free(h)}}}finally{a&&e.destroy(a),e.destroy(o),e.destroy(r)}},createDraco:async function(){if(this.constructor.draco)return this.constructor.draco;{const e=await fetch(uo.getLibUrl("draco_decoder_gltf.js")),t=await e.text(),n=await new Function(t)()();return this.constructor.draco=n}},camerasArray(e){e instanceof Array&&(this.cameras=e)},cameraObject(e){if(!(e instanceof Object))return null;if(void 0!==e.viewpointNode)return e.viewpointNode;const t=this.cameraType(e);if(!t)return e.viewpointNode=null;const n=this.getExecutionContext(),i=this.sanitizeName(e.name);return i&&(n.addNamedNode(n.getUniqueName(i),t),n.addExportedNode(n.getUniqueExportName(i),t)),e.name?t._description=e.name:t._description="Viewpoint "+ ++this.viewpoints,t._position=Et.Zero,t._centerOfRotation=new Et(0,0,-10),e.viewpointNode=t},cameraType(e){switch(e.type){case"orthographic":return this.orthographicCamera(e.orthographic);case"perspective":return this.perspectiveCamera(e.perspective);default:return null}},orthographicCamera(e){const t=this.getExecutionContext().createNode("OrthoViewpoint",!1);return"number"==typeof e.xmag&&(t._fieldOfView[0]=-e.xmag/2,t._fieldOfView[2]=+e.xmag/2),"number"==typeof e.ymag&&(t._fieldOfView[1]=-e.ymag/2,t._fieldOfView[3]=+e.ymag/2),"number"==typeof e.znear&&(t._nearDistance=e.znear),"number"==typeof e.zfar&&(t._farDistance=e.zfar),t.setup(),t},perspectiveCamera(e){const t=this.getExecutionContext().createNode("Viewpoint",!1);return"number"==typeof e.yfov&&(t._fieldOfView=e.yfov),"number"==typeof e.znear&&(t._nearDistance=e.znear),"number"==typeof e.zfar&&(t._farDistance=e.zfar),t.setup(),t},nodesArray(e){e instanceof Array&&(this.nodes=e)},nodeObject(e){if(!(e instanceof Object))return;if(void 0!==e.childNode)return e.childNode;const t=this.getExecutionContext(),n=t.createNode("Transform",!1),i=this.sanitizeName(e.name);i&&(t.addNamedNode(t.getUniqueName(i),n),t.addExportedNode(t.getUniqueExportName(i),n));const s=new Et(0,0,0),r=new Qt(0,0,0,1),o=new dn,a=new Et(1,1,1),l=new dn,u=new _n;this.vectorValue(e.matrix,u)?(u.get(s,o,a,l),n._translation=s,n._rotation=o,n._scale=a,n._scaleOrientation=l):(this.vectorValue(e.translation,s)&&(n._translation=s),this.vectorValue(e.rotation,r)&&(n._rotation=new dn(r)),this.vectorValue(e.scale,a)&&(n._scale=a));const h=this.cameraObject(this.cameras[e.camera]);h&&n._children.push(h),this.nodeExtensions(e.extensions,n);const c=this.meshes[e.mesh];return c&&n._children.push(...this.meshObject(c)),n._children.push(...this.nodeChildrenArray(e.children)),n.setup(),0===n._children.length?e.childNode=null:e.childNode=n},nodeExtensions(e,t){e instanceof Object&&this.nodeLight(e.KHR_lights_punctual,t)},nodeLight(e,t){if(!(e instanceof Object))return;const n=this.lightObject(this.lights[e.light]);n&&(++this.usedLights,t._children.push(n))},nodeChildrenArray(e){return e instanceof Array?e.map((e=>this.nodeObject(this.nodes[e],e))).filter((e=>e)):[]},scenesArray(e,t){if(!(e instanceof Array))return;const n=this.getExecutionContext(),i=e.map((e=>this.sceneObject(e)));switch(i.length){case 0:return;case 1:if(0===t)return this.usedLights&&n.getRootNodes().push(this.createNavigationInfo()),void n.getRootNodes().push(i[0]);default:{this.usedLights&&n.getRootNodes().push(this.createNavigationInfo());const e=n.createNode("Switch",!1);return n.addNamedNode(n.getUniqueName("Scenes"),e),n.addExportedNode(n.getUniqueExportName("Scenes"),e),e._whichChoice=t,e._children=i,e.setup(),void n.getRootNodes().push(e)}}},sceneObject(e){if(!(e instanceof Object))return null;const t=this.sceneNodesArray(e.nodes);switch(t.length){case 0:return null;case 1:return t[0];default:{const n=this.getExecutionContext(),i=n.createNode("Group",!1),s=this.sanitizeName(e.name);return s&&(n.addNamedNode(n.getUniqueName(s),i),n.addExportedNode(n.getUniqueExportName(s),i)),i._children=t,i.setup(),i}}},sceneNodesArray(e){return this.nodeChildrenArray(e)},animationsArray(e){if(!(e instanceof Array))return;const t=e.map((e=>this.animationObject(e))).filter((e=>e));if(!t.length)return;const n=this.getExecutionContext(),i=n.createNode("Group",!1);n.addNamedNode(n.getUniqueName("Animations"),i),n.addExportedNode(n.getUniqueExportName("Animations"),i),i._children=t,i.setup(),n.getRootNodes().push(i)},animationObject(e){if(!(e instanceof Object))return null;const t=this.getExecutionContext(),n=t.createNode("TimeSensor",!1),i=this.animationChannelsArray(e.channels,e.samplers,n);if(!i.length)return null;const s=t.createNode("Group",!1),r=this.sanitizeName(e.name);return++this.animations,t.addNamedNode(t.getUniqueName(r||`Animation${this.animations}`),s),t.addNamedNode(t.getUniqueName(`Timer${this.animations}`),n),t.addExportedNode(t.getUniqueExportName(r||`Animation${this.animations}`),s),t.addExportedNode(t.getUniqueExportName(`Timer${this.animations}`),n),n._description=e.name||`Animation ${this.animations}`,s._children.push(n,...i),n.setup(),s.setup(),s},animationChannelsArray(e,t,n){if(!(e instanceof Array))return[];if(!(t instanceof Array))return[];const i=t.map((e=>this.accessors[e.input])).filter((e=>e&&e.array.length)).reduce(((e,t)=>Math.max(e,t.array.at(-1))),0);return n._loop=S,n._cycleInterval=i,e.map((e=>this.animationChannelObject(e,t,n))).filter((e=>e))},animationChannelObject(e,t,n){if(!(e instanceof Object))return null;const i=e.target;if(!(i instanceof Object))return null;const s=this.nodeObject(this.nodes[i.node]);if(!s)return null;const r=t[e.sampler];if(!r)return null;const o=this.accessors[r.input];if(!o)return null;if(!o.array.length)return null;const a=this.accessors[r.output];if(!a)return null;if(!a.array.length)return null;const l=this.getExecutionContext(),u=this.createInterpolator(i.path,r.interpolation,o.array,a.array,n._cycleInterval.getValue());return u?(l.addRoute(n,"fraction_changed",u,"set_fraction"),l.addRoute(u,"value_changed",s,i.path),u):null},skinsArray(e){},createNavigationInfo(){const e=this.getExecutionContext().createNode("NavigationInfo",!1);return e._headlight=!1,e.setup(),e},createShape(e){const t=this.getExecutionContext().createNode("Shape",!1),n=this.materialObject(e.material),i=this.createGeometry(e);return t._appearance=n,t._geometry=i,t.setup(),t},getDefaultAppearance(){if(this.defaultAppearance)return this.defaultAppearance;const e=this.getExecutionContext(),t=e.createNode("Appearance",!1),n=e.createNode("PhysicalMaterial",!1);return t._alphaMode="OPAQUE",t._material=n,n.setup(),t.setup(),this.defaultAppearance=t,t},createMultiTextureTransform(e){if(!+e.getTextureBits())return null;const t=this.textureTransformNodes.sort(((e,t)=>f.cmp(e._mapping.getValue(),t._mapping.getValue())));switch(t.length){case 0:{if(this.textureTransformNode)return this.textureTransformNode;const e=this.getExecutionContext().createNode("TextureTransform",!1);return e._translation.y=-1,e._scale.y=-1,e.setup(),this.textureTransformNode=e}case 1:return t[0];default:{const e=this.getExecutionContext().createNode("MultiTextureTransform",!1);return e._textureTransform=t,e.setup(),e}}},createGeometry(e){switch(e.mode){case 0:return this.createPointSet(e);case 1:return e.indices?this.createIndexedLineSet(e,1):this.createLineSet(e);case 2:return this.createIndexedLineSet(e,2);case 3:return this.createIndexedLineSet(e,3);default:case 4:return e.indices?this.createIndexedTriangleSet(e):this.createTriangleSet(e);case 5:return e.indices?this.createIndexedTriangleStripSet(e):this.createTriangleStripSet(e);case 6:return e.indices?this.createIndexedTriangleFanSet(e):this.createTriangleFanSet(e)}},createPointSet({attributes:e,material:t}){const n=this.getExecutionContext().createNode("PointSet",!1);return n._color=this.createColor(e.COLOR[0],t),n._normal=this.createNormal(e.NORMAL),n._coord=this.createCoordinate(e.POSITION),n.setup(),n},createIndexedLineSet({attributes:e,indices:t,material:n},i){const s=this.getExecutionContext().createNode("IndexedLineSet",!1);switch(s._color=this.createColor(e.COLOR[0],n),s._normal=this.createNormal(e.NORMAL),s._coord=this.createCoordinate(e.POSITION),i){case 1:{const e=s._coordIndex,n=t.array,i=n.length;for(let t=0;t<i;t+=2)e.push(n[t],n[t+1],-1);break}case 2:{const e=s._coordIndex;if(t)e.push(...t.array),e.length&&e.push(e[0],-1);else{const t=s._coord;t&&t.point.length&&e.push(...t.point.keys(),0,-1)}break}case 3:{const e=s._coordIndex;if(t)e.push(...t.array),e.length&&e.push(-1);else{const t=s._coord;t&&t.point.length&&e.push(...t.point.keys(),-1)}break}}return s.setup(),s},createLineSet({attributes:e,material:t}){const n=this.getExecutionContext().createNode("LineSet",!1);return n._color=this.createColor(e.COLOR[0],t),n._normal=this.createNormal(e.NORMAL),n._coord=this.createCoordinate(e.POSITION),n.setup(),n},createIndexedTriangleSet({attributes:e,indices:t,material:n}){const i=this.getExecutionContext().createNode("IndexedTriangleSet",!1);return i._solid=!n||!n.doubleSided,i._index=t.array,i._color=this.createColor(e.COLOR[0],n),i._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,n),i._normal=this.createNormal(e.NORMAL),i._coord=this.createCoordinate(e.POSITION),i._normalPerVertex=!!i._normal,i.setup(),i},createTriangleSet({attributes:e,material:t}){const n=this.getExecutionContext().createNode("TriangleSet",!1);return n._solid=!t||!t.doubleSided,n._color=this.createColor(e.COLOR[0],t),n._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,t),n._normal=this.createNormal(e.NORMAL),n._coord=this.createCoordinate(e.POSITION),n._normalPerVertex=!!n._normal,n.setup(),n},createIndexedTriangleStripSet({attributes:e,indices:t,material:n}){const i=this.getExecutionContext().createNode("IndexedTriangleStripSet",!1);return i._solid=!n||!n.doubleSided,i._index=t.array,i._color=this.createColor(e.COLOR[0],n),i._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,n),i._normal=this.createNormal(e.NORMAL),i._coord=this.createCoordinate(e.POSITION),i._normalPerVertex=!!i._normal,i.setup(),i},createTriangleStripSet({attributes:e,material:t}){const n=this.getExecutionContext().createNode("TriangleStripSet",!1);n._solid=!t||!t.doubleSided,n._color=this.createColor(e.COLOR[0],t),n._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,t),n._normal=this.createNormal(e.NORMAL),n._coord=this.createCoordinate(e.POSITION),n._normalPerVertex=!!n._normal;const i=n._coord;return i&&i.point.length&&(n._stripCount=[i.point.length]),n.setup(),n},createIndexedTriangleFanSet({attributes:e,indices:t,material:n}){const i=this.getExecutionContext().createNode("IndexedTriangleFanSet",!1);return i._solid=!n||!n.doubleSided,i._index=t.array,i._color=this.createColor(e.COLOR[0],n),i._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,n),i._normal=this.createNormal(e.NORMAL),i._coord=this.createCoordinate(e.POSITION),i._normalPerVertex=!!i._normal,i.setup(),i},createTriangleFanSet({attributes:e,material:t}){const n=this.getExecutionContext().createNode("TriangleFanSet",!1);n._solid=!t||!t.doubleSided,n._color=this.createColor(e.COLOR[0],t),n._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,t),n._normal=this.createNormal(e.NORMAL),n._coord=this.createCoordinate(e.POSITION),n._normalPerVertex=!!n._normal;const i=n._coord;return i&&i.point.length&&(n._fanCount=[i.point.length]),n.setup(),n},createColor:function(){const e=new Map([["VEC3","Color"],["VEC4","ColorRGBA"]]);return function(t,n){if(!(t instanceof Object))return null;const i=e.get(t.type);if(!i)return null;if(t.colorNode)return t.colorNode;const s=this.getExecutionContext(),r="OPAQUE"===this.materialObject(n)._alphaMode.getValue(),o=s.createNode(r?"Color":i,!1);return o._color=r&&"Color"!==i?t.array.filter(((e,t)=>(t+1)%4)):t.array,o.setup(),t.colorNode=o}}(),createMultiTextureCoordinate(e,t){if(!+this.materialObject(t)._material.getValue().getTextureBits())return null;if(e.textureCoordinateNode)return e.textureCoordinateNode;switch(t.texCoordMappings.size){case 0:return null;case 1:return e.textureCoordinateNode=[...t.texCoordMappings.entries()].map((([t,n])=>this.createTextureCoordinate(e[n],t)))[0];default:{const n=[...t.texCoordMappings.entries()].map((([t,n])=>this.createTextureCoordinate(e[n],t))).filter((e=>e)).sort(((e,t)=>f.cmp(e._mapping.getValue(),t._mapping.getValue())));if(!n.length)return null;const i=this.getExecutionContext().createNode("MultiTextureCoordinate",!1);return i._texCoord=n,i.setup(),e.textureCoordinateNode=i}}},createTextureCoordinate(e,t){if(!(e instanceof Object))return null;if("VEC2"!==e.type)return null;if(e[t])return e[t];const n=this.getExecutionContext().createNode("TextureCoordinate",!1);return n._mapping=t,n._point=e.array,n.setup(),e[t]=n},createNormal(e){if(!(e instanceof Object))return null;if("VEC3"!==e.type)return null;if(e.normalNode)return e.normalNode;const t=this.getExecutionContext().createNode("Normal",!1);return t._vector=e.array,t.setup(),e.normalNode=t},createCoordinate(e){if(!(e instanceof Object))return null;if("VEC3"!==e.type)return null;if(e.coordinateNode)return e.coordinateNode;const t=this.getExecutionContext().createNode("Coordinate",!1);return t._point=e.array,t.setup(),e.coordinateNode=t},createInterpolator(e,t,n,i,s){const r=this.getExecutionContext();switch(e){case"translation":{const e=this.createPositionInterpolator(t,n,i,s);return r.addNamedNode(r.getUniqueName("TranslationInterpolator"),e),e}case"rotation":{const e=this.createOrientationInterpolator(t,n,i,s);return r.addNamedNode(r.getUniqueName("RotationInterpolator"),e),e}case"scale":{const e=this.createPositionInterpolator(t,n,i,s);return r.addNamedNode(r.getUniqueName("ScaleInterpolator"),e),e}default:return null}},createPositionInterpolator(e,t,n,i){const s=this.getExecutionContext();switch(e){case"STEP":{const e=s.createNode("PositionInterpolator",!1);e._key.push(t[0]/i);for(let n=1,s=t.length;n<s;++n)e._key.push(t[n]/i,t[n]/i);e._keyValue.push(new Et(n[0],n[1],n[2]));for(let t=0,i=n.length-3;t<i;t+=3)e._keyValue.push(new Et(n[t+0],n[t+1],n[t+2]),new Et(n[t+3],n[t+4],n[t+5]));return e.setup(),e}default:case"LINEAR":{const e=s.createNode("PositionInterpolator",!1);return e._key=t.map((e=>e/i)),e._keyValue=n,e.setup(),e}case"CUBICSPLINE":{const e=s.createNode("PositionInterpolator",!1),r=[];for(let e=0,t=n.length;e<t;e+=3)r.push(new Et(n[e+0],n[e+1],n[e+2]));const o=[...Array(Math.floor(30*t.at(-1))).keys()].map(((e,n,i)=>n/(i.length-1)*t.at(-1)));for(const n of o)e._key.push(n/i),e._keyValue.push(this.cubicSpline(n,t,r));return e.setup(),e}}},createOrientationInterpolator(e,t,n,i){const s=this.getExecutionContext();switch(e){case"STEP":{const e=s.createNode("OrientationInterpolator",!1);e._key.push(t[0]/i);for(let n=1,s=t.length;n<s;++n)e._key.push(t[n]/i,t[n]/i);e._keyValue.push(new dn(new Qt(n[0],n[1],n[2],n[3])));for(let t=0,i=n.length-4;t<i;t+=4)e._keyValue.push(new dn(new Qt(n[t+0],n[t+1],n[t+2],n[t+3])),new dn(new Qt(n[t+4],n[t+5],n[t+6],n[t+7])));return e.setup(),e}default:case"LINEAR":{const e=s.createNode("OrientationInterpolator",!1);e._key=t.map((e=>e/i));for(let t=0,i=n.length;t<i;t+=4)e._keyValue.push(new dn(new Qt(n[t+0],n[t+1],n[t+2],n[t+3])));return e.setup(),e}case"CUBICSPLINE":{const e=s.createNode("OrientationInterpolator",!1),r=[];for(let e=0,t=n.length;e<t;e+=4)r.push(new Qt(n[e+0],n[e+1],n[e+2],n[e+3]));const o=[...Array(Math.floor(30*t.at(-1))).keys()].map(((e,n,i)=>n/(i.length-1)*t.at(-1)));for(const n of o){const s=this.cubicSpline(n,t,r).normalize();e._key.push(n/i),e._keyValue.push(new dn(s))}return e.setup(),e}}},cubicSpline(e,t,n){const i=f.clamp(f.upperBound(t,0,t.length,e),1,t.length-1),s=i-1,r=t[i]-t[s],o=(e-t[s])/r,a=o*o,l=a*o,u=n[3*s+1].copy(),h=n[3*s+2].copy(),c=n[3*i+1].copy(),d=n[3*i+0].copy();return u.multiply(2*l-3*a+1),h.multiply(r*(l-2*a+o)),c.multiply(-2*l+3*a),d.multiply(r*(l-a)),u.add(h).add(c).add(d)},vectorValue:(e,t)=>e instanceof Array&&(e.length===t.length&&(t.set(...e),!0)),numberValue:(e,t)=>"number"!=typeof e?t:e,stringValue:(e,t)=>"string"!=typeof e?t:e});const po=co;n.set("x_ite/Parser/GLTF2Parser",po);const go=po;var fo=i(666);function mo(e){Br.call(this,e),this.json=[],this.buffers=[]}Object.assign(Object.setPrototypeOf(mo.prototype,Br.prototype),{getEncoding:()=>"ARRAY_BUFFER",setInput(e){this.arrayBuffer=e,this.dataView=new DataView(e)},isValid(){return this.arrayBuffer instanceof ArrayBuffer&&(!(this.dataView.byteLength<12)&&(1179937895===this.dataView.getUint32(0,!0)&&(2===this.dataView.getUint32(4,!0)&&this.dataView.getUint32(8,!0)===this.dataView.byteLength)))},parseIntoScene(e,t){this.glb().then(e).catch(t)},glb:async function(){this.chunks();const e=new go(this.getScene());e.setBuffers(this.buffers);for(const t of this.json)e.setInput(t),e.isValid()&&await e.rootObject(e.input);return this.getScene()},chunks(){for(let e=12;e<this.dataView.byteLength;){const t=this.dataView.getUint32(e,!0),n=this.dataView.getUint32(e+4,!0);switch(e+=8,n){case 1313821514:this.json.push(fo.decodeText(this.arrayBuffer.slice(e,e+t)));break;case 5130562:this.buffers.push(this.arrayBuffer.slice(e,e+t))}e+=t}return this.getScene()}});const _o=mo;n.set("x_ite/Parser/GLB2Parser",_o);const xo=_o;var yo=i(666);const wo=kr({whitespaces:/[\x20\n\t\r]+/gy,whitespacesNoLineTerminator:/[\x20\t]+/gy,comment:/#.*?(?=[\n\r])/gy,untilEndOfLine:/([^\r\n]+)/gy,mtllib:/\bmtllib\b/gy,usemtl:/\busemtl\b/gy,newmtl:/\bnewmtl\b/gy,Ka:/\bKa\b/gy,Kd:/\bKd\b/gy,Ks:/\bKs\b/gy,Ns:/\bNs\b/gy,d:/\bd\b/gy,Tr:/\bTr\b/gy,illum:/\billum\b/gy,map_Kd:/\bmap_Kd\b/gy,o:/\bo\b/gy,v:/\bv\b/gy,vt:/\bvt\b/gy,vn:/\bvn\b/gy,g:/\bg\b/gy,s:/\bs\b/gy,off:/\boff\b/gy,f:/\bf\b/gy,slash:/\//gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy});function bo(e){Br.call(this,e),ro.call(this),this.removeGroups=!0,this.removeEmptyGroups=!0,this.combineGroupingNodes=!1,this.smoothingGroup=0,this.smoothingGroups=new Map,this.groups=new Map,this.materials=new Map,this.textures=new Map,this.point2=new wt,this.point3=new Et,this.lastIndex=0}function So(e,t){this.executionContext=e,this.input=t,this.material=e.createNode("Material"),this.materials=new Map,this.textures=new Map,this.color3=new De(0,0,0),this.id=""}Object.assign(Object.setPrototypeOf(bo.prototype,Br.prototype),ro.prototype,{CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:()=>"STRING",setInput(e){this.input=e},isValid(){return"string"==typeof this.input&&!!this.input.match(/^(?:[\x20\n\t\r]+|#.*?[\r\n])*\b(?:mtllib|usemtl|o|g|s|vt|vn|v|f)\b/)},parseIntoScene(e,t){this.obj().then(e).catch(t)},obj:async function(){const e=this.getBrowser(),t=this.getScene();return t.setEncoding("OBJ"),t.setProfile(e.getProfile("Interchange")),await this.loadComponents(),this.object=t.createNode("Transform"),this.group=t.createNode("Group"),this.defaultMaterial=t.createNode("Material"),this.texCoord=t.createNode("TextureCoordinate"),this.normal=t.createNode("Normal"),this.coord=t.createNode("Coordinate"),this.object.children.push(this.group),t.getRootNodes().push(this.object),await this.statements(),this.optimizeSceneGraph(t.getRootNodes()),this.getScene()},comments(){for(;this.comment(););},comment(){return this.whitespaces(),!!wo.comment.parse(this)},whitespaces(){wo.whitespaces.parse(this)},whitespacesNoLineTerminator(){wo.whitespacesNoLineTerminator.parse(this)},statements:async function(){for(;await this.statement(););},statement:async function(){return!!await this.mtllibs()||(!!this.usemtl()||(!!this.o()||(!!this.g()||(!!this.s()||(!!this.vts()||(!!this.vns()||(!!this.vs()||(!!this.fs()||!!wo.untilEndOfLine.parse(this)))))))))},mtllibs:async function(){if(this.comments(),wo.mtllib.parse(this)){if(this.whitespacesNoLineTerminator(),wo.untilEndOfLine.parse(this)){const e=this.result[1].trim().split(/\s+/);await Promise.all(e.map((e=>this.mtllib(e))))}return!0}return!1},mtllib:async function(e){try{const t=this.getExecutionContext(),n=new URL(e,t.getWorldURL()),i=await fetch(n),s=await i.arrayBuffer(),r=new So(t,yo.decodeText(yo.ungzip(s)));r.parse();for(const[e,n]of r.materials){const i=this.sanitizeName(e);i&&(t.addNamedNode(t.getUniqueName(i),n),t.addExportedNode(t.getUniqueExportName(i),n)),this.materials.set(e,n)}for(const[e,n]of r.textures){const i=this.sanitizeName(e);i&&(t.addNamedNode(t.getUniqueName(i),n),t.addExportedNode(t.getUniqueExportName(i),n)),this.textures.set(e,n)}}catch(e){console.warn(e)}},usemtl(){if(this.comments(),wo.usemtl.parse(this)){if(this.whitespacesNoLineTerminator(),wo.untilEndOfLine.parse(this)){const e=this.result[1];this.material=this.materials.get(e)||this.defaultMaterial,this.texture=this.textures.get(e);const t=this.smoothingGroups.get(this.group.getNodeName());t&&t.delete(this.smoothingGroup)}return!0}return!1},o(){if(this.comments(),wo.o.parse(this)){if(this.whitespacesNoLineTerminator(),wo.untilEndOfLine.parse(this)){const e=this.getExecutionContext(),t=this.sanitizeName(this.result[1]);this.group.children.length&&(this.object=e.createNode("Transform"),this.group=e.createNode("Group"),this.object.children.push(this.group),e.getRootNodes().push(this.object)),t&&(e.addNamedNode(e.getUniqueName(t),this.object),e.addExportedNode(e.getUniqueExportName(t),this.object))}return!0}return!1},g(){if(this.comments(),wo.g.parse(this)){if(this.whitespacesNoLineTerminator(),wo.untilEndOfLine.parse(this)){const e=this.getExecutionContext(),t=this.result[1],n=this.sanitizeName(t),i=this.groups.get(t);i?this.group=i:this.group.children.length&&(this.group=e.createNode("Group"),this.object.children.push(this.group)),this.groups.set(t,this.group),n&&(e.addNamedNode(e.getUniqueName(n),this.group),e.addExportedNode(e.getUniqueExportName(n),this.group)),this.smoothingGroup=0}return!0}return!1},s(){return this.comments(),!!wo.s.parse(this)&&(this.whitespacesNoLineTerminator(),wo.off.parse(this)?(this.smoothingGroup=0,!0):!this.int32()||(this.smoothingGroup=this.value,!0))},vts(){const e=this.texCoord.point;let t=!1;for(;this.vt(e);)t=!0;return t},vt(e){if(this.comments(),wo.vt.parse(this)){if(this.vec2())return e.push(this.point2),!0;throw new Error("Expected a texture coordinate.")}return!1},vns(){const e=this.normal.vector;let t=!1;for(;this.vn(e);)t=!0;return t},vn(e){if(this.comments(),wo.vn.parse(this)){if(this.vec3())return e.push(this.point3),!0;throw new Error("Expected a normal vector.")}return!1},vs(){const e=this.coord.point;let t=!1;for(;this.v(e);)t=!0;return t},v(e){if(this.comments(),wo.v.parse(this)){if(this.vec3())return e.push(this.point3),!0;throw new Error("Expected a vertex coordinate.")}return!1},fs(){if(this.comments(),wo.f.lookahead(this)){try{this.shape=this.smoothingGroups.get(this.group.getNodeName()).get(this.smoothingGroup),this.geometry=this.shape.geometry}catch{const e=this.getExecutionContext(),t=e.createNode("Appearance");this.geometry=e.createNode("IndexedFaceSet"),this.shape=e.createNode("Shape"),t.material=this.material,t.texture=this.texture,this.geometry.creaseAngle=this.smoothingGroup?Math.PI:0,this.shape.appearance=t,this.shape.geometry=this.geometry,this.group.children.push(this.shape),this.smoothingGroups.has(this.group.getNodeName())||this.smoothingGroups.set(this.group.getNodeName(),new Map),this.smoothingGroups.get(this.group.getNodeName()).set(this.smoothingGroup,this.shape)}for(;this.f(););return this.geometry.texCoordIndex.length&&(this.geometry.texCoord=this.texCoord),this.geometry.normalIndex.length&&(this.geometry.normal=this.normal),this.geometry.coord=this.coord,!0}return!1},f(){if(this.comments(),wo.f.parse(this)){const e=this.geometry,t=e.texCoordIndex,n=e.normalIndex,i=e.coordIndex,s=t.length,r=n.length,o=this.texCoord.point.length,a=this.normal.vector.length,l=this.coord.point.length;for(;this.indices(t,n,i,o,a,l););return t.length!==s&&t.push(-1),n.length!==r&&n.push(-1),i.push(-1),!0}return!1},indices(e,t,n,i,s,r){return!!this.int32()&&(n.push(this.index(this.value,r)),wo.slash.parse(this)&&(this.int32()&&e.push(this.index(this.value,i)),wo.slash.parse(this)&&this.int32()&&t.push(this.index(this.value,s))),!0)},index(e,t){if(0===e)throw new Error("Invalid index.");return e<0?t+e:e-1},int32(){return this.whitespaces(),!!wo.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double(){return this.whitespaces(),wo.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!wo.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},vec2(){return!(!this.double()||(this.point2.x=this.value,!this.double()))&&(this.point2.y=this.value,!0)},vec3(){return!!(this.double()&&(this.point3.x=this.value,this.double()&&(this.point3.y=this.value,this.double())))&&(this.point3.z=this.value,!0)}}),Object.assign(So.prototype,{CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),parse(){try{this.statements()}catch(e){S}},comments(){for(;this.comment(););},comment(){return this.whitespaces(),!!wo.comment.parse(this)},whitespaces(){wo.whitespaces.parse(this)},whitespacesNoLineTerminator(){wo.whitespacesNoLineTerminator.parse(this)},statements(){for(;this.statement(););},statement(){return!!this.newmtl()||(!!this.Ka()||(!!this.Kd()||(!!this.Ks()||(!!this.Ns()||(!!this.d()||(!!this.Tr()||(!!this.illum()||(!!this.map_Kd()||!!wo.untilEndOfLine.parse(this)))))))))},newmtl(){return this.comments(),!!wo.newmtl.parse(this)&&(this.whitespacesNoLineTerminator(),this.id="",wo.untilEndOfLine.parse(this)?(this.id=this.result[1],this.material=this.executionContext.createNode("Material"),this.materials.set(this.id,this.material),!0):(wo.untilEndOfLine.parse(this),!0))},Ka(){if(this.comments(),wo.Ka.parse(this)){if(this.col3()){const e=this.color3.getHSV([]);return this.material.ambientIntensity=e[2],!0}return wo.untilEndOfLine.parse(this),!0}return!1},Kd(){return this.comments(),!!wo.Kd.parse(this)&&(this.col3()?(this.material.diffuseColor=this.color3,!0):(wo.untilEndOfLine.parse(this),!0))},Ks(){return this.comments(),!!wo.Ks.parse(this)&&(this.col3()?(this.material.specularColor=this.color3,!0):(wo.untilEndOfLine.parse(this),!0))},Ns(){return this.comments(),!!wo.Ns.parse(this)&&(this.double()?(this.material.shininess=this.value/1e3,!0):(wo.untilEndOfLine.parse(this),!0))},d(){return this.comments(),!!wo.d.parse(this)&&(this.double()?(this.material.transparency=1-this.value,!0):(wo.untilEndOfLine.parse(this),!0))},Tr(){return this.comments(),!!wo.Tr.parse(this)&&(this.double()?(this.material.transparency=this.value,!0):(wo.untilEndOfLine.parse(this),!0))},illum(){return this.comments(),!!wo.illum.parse(this)&&(this.int32()||wo.untilEndOfLine.parse(this),!0)},map_Kd(){if(this.comments(),wo.map_Kd.parse(this)){if(this.whitespacesNoLineTerminator(),wo.untilEndOfLine.parse(this)){const e=this.result[1];if(e.length&&this.id.length){const t=e.trim().split(/\s+/);if(t.length){const e=this.executionContext.createNode("ImageTexture"),n=t.at(-1).replace(/\\/g,"/");e.url=[n],this.textures.set(this.id,e)}}return!0}return wo.untilEndOfLine.parse(this),!0}return!1},int32(){return this.whitespaces(),!!wo.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double(){return this.whitespaces(),wo.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!wo.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},col3(){return!!(this.double()&&(this.color3.r=this.value,this.double()&&(this.color3.g=this.value,this.double())))&&(this.color3.b=this.value,!0)}});const vo=bo;n.set("x_ite/Parser/OBJParser",vo);const To=vo,Oo=kr({whitespaces:/[\x20\n\t\r]+/gy,whitespacesNoLineTerminator:/[\x20\t]+/gy,comment:/;.*?(?=[\n\r])/gy,untilEndOfLine:/([^\r\n]+)/gy,solid:/solid/gy,facet:/facet/gy,normal:/normal/gy,outer:/outer/gy,loop:/loop/gy,vertex:/vertex/gy,endloop:/endloop/gy,endfacet:/endfacet/gy,endsolid:/endsolid/gy,name:/(\w+)/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy});function Eo(e){Br.call(this,e),this.vector=[],this.point=[]}Object.assign(Object.setPrototypeOf(Eo.prototype,Br.prototype),{CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:()=>"STRING",setInput(e){this.input=e},isValid(){return"string"==typeof this.input&&!!this.input.match(/^(?:[\x20\n\t\r]+|;.*?[\r\n])*\b(?:solid)\b/)},parseIntoScene(e,t){this.stl().then(e).catch(t)},stl:async function(){const e=this.getBrowser(),t=this.getScene();return t.setEncoding("STL"),t.setProfile(e.getProfile("Interchange")),await this.loadComponents(),this.material=t.createNode("Material"),this.appearance=t.createNode("Appearance"),this.material.diffuseColor=De.White,this.appearance.material=this.material,this.statements(),this.getScene()},comments(){for(;this.comment(););},comment(){return this.whitespaces(),!!Oo.comment.parse(this)},whitespaces(){Oo.whitespaces.parse(this)},whitespacesNoLineTerminator(){Oo.whitespacesNoLineTerminator.parse(this)},statements(){for(;this.solid(););},solid(){if(this.comments(),Oo.solid.parse(this)){this.whitespacesNoLineTerminator();const e=this.getExecutionContext(),t=e.createNode("Shape"),n=e.createNode("TriangleSet"),i=e.createNode("Normal"),s=e.createNode("Coordinate"),r=this.sanitizeName(Oo.name.parse(this)?this.result[1]:"");if(Oo.untilEndOfLine.parse(this),this.facets(),t.appearance=this.appearance,t.geometry=n,n.normalPerVertex=!1,n.normal=i,n.coord=s,i.vector=this.vector,s.point=this.point,r&&(e.addNamedNode(e.getUniqueName(r),t),e.addExportedNode(e.getUniqueExportName(r),t)),e.getRootNodes().push(t),this.comments(),Oo.endsolid.parse(this))return!0;throw new Error("Expected 'endsolid' statement.")}return!1},facets(){for(this.vector.length=0,this.point.length=0;this.facet(););},facet(){if(this.comments(),Oo.facet.parse(this)&&this.normal()&&this.loop()){if(this.comments(),Oo.endfacet.parse(this))return!0;throw new Error("Expected 'endfacet' statement.")}return!1},normal(){if(this.whitespacesNoLineTerminator(),Oo.normal.parse(this)){if(this.double()){if(this.vector.push(this.value),this.double()){if(this.vector.push(this.value),this.double())return this.vector.push(this.value),!0;throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected 'normal' statement.")},loop(){if(this.comments(),Oo.outer.parse(this)){if(this.whitespacesNoLineTerminator(),Oo.loop.parse(this)&&this.vertex()&&this.vertex()&&this.vertex()){if(this.comments(),Oo.endloop.parse(this))return!0;throw new Error("Expected 'endloop' statement.")}throw new Error("Expected 'loop' statement.")}throw new Error("Expected 'outer' statement.")},vertex(){if(this.comments(),Oo.vertex.parse(this)){if(this.double()){if(this.point.push(this.value),this.double()){if(this.point.push(this.value),this.double())return this.point.push(this.value),!0;throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected 'vertex' statement.")},double(){return this.whitespacesNoLineTerminator(),Oo.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!Oo.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)}});const Co=Eo;n.set("x_ite/Parser/STLAParser",Co);const No=Co;function Fo(e){Br.call(this,e)}Object.assign(Object.setPrototypeOf(Fo.prototype,Br.prototype),{getEncoding:()=>"ARRAY_BUFFER",setInput(e){this.arrayBuffer=e,this.dataView=new DataView(e)},isValid(){if(!(this.arrayBuffer instanceof ArrayBuffer))return!1;if(this.dataView.byteLength<84)return!1;return 50*this.dataView.getUint32(80,!0)+84===this.dataView.byteLength},parseIntoScene(e,t){this.stl().then(e).catch(t)},stl:async function(){const e=this.getBrowser(),t=this.getScene();return t.setEncoding("STL"),t.setProfile(e.getProfile("Interchange")),await this.loadComponents(),this.material=t.createNode("Material"),this.appearance=t.createNode("Appearance"),this.material.diffuseColor=De.White,this.appearance.material=this.material,this.shape(),this.getScene()},shape(){const e=this.getExecutionContext(),t=e.createNode("Shape"),n=e.createNode("TriangleSet"),i=e.createNode("Normal"),s=e.createNode("Coordinate"),r=this.dataView,o=this.dataView.byteLength,a=[],l=[];for(let e=84;e<o;e+=50){for(let t=0;t<3;++t)a.push(r.getFloat32(e+4*t,!0));for(let t=3;t<12;++t)l.push(r.getFloat32(e+4*t,!0))}t.appearance=this.appearance,t.geometry=n,n.normalPerVertex=!1,n.normal=i,n.coord=s,i.vector=a,s.point=l,e.getRootNodes().push(t)}});const Io=Fo;n.set("x_ite/Parser/STLBParser",Io);const Mo=Io;function Po(e,t){this.real=e,this.imag=t}Object.assign(Po.prototype,{*[Symbol.iterator](){yield this.real,yield this.imag},copy(){const e=Object.create(Po.prototype);return e.real=this.real,e.imag=this.imag,e},assign(e){return this.real=e.real,this.imag=e.imag,this},equals(e){return this.real===e.real&&this.imag===e.imag},set(e,t){return this.real=e,this.imag=t,this},setPolar(e,t){return this.real=e*Math.cos(t),this.imag=e*Math.sin(t),this},conjugate(){return this.imag=-this.imag,this},negate(){return this.real=-this.real,this.imag=-this.imag,this},inverse(){const e=this.real*this.real+this.imag*this.imag;return this.real/=e,this.imag/=-e,this},add(e){return this.real+=e.real,this.imag+=e.imag,this},subtract(e){return this.real-=e.real,this.imag-=e.imag,this},multiply(e){return this.real*=e,this.imag*=e,this},multComp(e){const{real:t,imag:n}=this,{real:i,imag:s}=e;return this.real=t*i-n*s,this.imag=t*s+n*i,this},divide(e){return this.real/=e,this.imag/=e,this},divComp(e){const{real:t,imag:n}=this,{real:i,imag:s}=e,r=i*i+s*s;return this.real=(t*i+n*s)/r,this.imag=(n*i-t*s)/r,this},toString(){let e="";return e+=this.real,this.imag<0?(e+=this.imag,e+="i"):this.imag>0&&(e+="+",e+=this.imag,e+="i"),e}}),Object.defineProperties(Po.prototype,{length:{value:2},0:{get(){return this.real},set(e){this.real=e}},1:{get(){return this.imag},set(e){this.imag=e}},magnitude:{get(){return this.real?this.imag?Math.hypot(this.real,this.imag):Math.abs(this.real):Math.abs(this.imag)},set(e){this.setPolar(e,this.angle)}},angle:{get(){return Math.atan2(this.imag,this.real)},set(e){this.setPolar(this.magnitude,e)}}}),Object.assign(Po,{Polar:(e,t)=>Object.create(Po.prototype).setPolar(e,t),multiply:(e,t)=>e.copy().multiply(t)});const Do=Po;n.set("standard/Math/Numbers/Complex",Do);const Ro=Do;function Ao(){this.matrix=new Bt,this.set(...arguments)}Object.assign(Ao.prototype,{copy(){const e=Object.create(Ao.prototype);return e.matrix=this.matrix.copy(),e},assign(e){return this.matrix.assign(e.matrix),this},equals(e){return this.matrix.equals(e.matrix)},set(e,t){switch(arguments.length){case 0:return this.matrix.set(0,0,0,0,0,0,0,0,0),this;case 2:return this.matrix.set(e.x/2,0,0,0,e.y/2,0,t.x,t.y,1),this}},setExtents(e,t){const n=(t.x-e.x)/2,i=(t.y-e.y)/2,s=(t.x+e.x)/2,r=(t.y+e.y)/2;return this.matrix.set(n,0,0,0,i,0,s,r,1),this},isEmpty(){return 0===this.matrix[8]},add:function(){const e=new wt(0,0),t=new wt(0,0),n=new wt(0,0),i=new wt(0,0);return function(s){return this.isEmpty()?this.assign(s):s.isEmpty()?this:(this.getExtents(e,t),s.getExtents(n,i),this.setExtents(e.min(n),t.max(i)))}}(),multLeft(e){return this.matrix.multLeft(e),this},multRight(e){return this.matrix.multRight(e),this},getExtents(e,t){this.getAbsoluteExtents(e,t),e.add(this.center),t.add(this.center)},getAbsoluteExtents:function(){const e=new wt(0,0);return function(t,n){const i=this.matrix,s=i.xAxis,r=i.yAxis;e.assign(s).add(r);const o=r.subtract(s);t.assign(e).min(o),n.assign(e).max(o),e.negate(),o.negate(),t.min(e,o),n.max(e,o)}}(),containsPoint:function(){const e=new wt(0,0),t=new wt(0,0);return function(n){return this.getExtents(e,t),e.x<=n.x&&t.x>=n.x&&e.y<=n.y&&t.y>=n.y}}(),toString(){return`${this.size}, ${this.center}`}}),Object.assign(Ao,{Extents:(e,t)=>(new Ao).setExtents(e,t),Points:(...e)=>(new Ao).setExtents(e[0].copy().min(...e),e[0].copy().max(...e))}),Object.defineProperties(Ao.prototype,{size:{get:function(){const e=new wt(0,0),t=new wt(0,0);return function(){return this.getAbsoluteExtents(e,t),t.subtract(e)}}(),enumerable:!0},center:{get(){return this.matrix.origin},enumerable:!0}});const Vo=Ao;n.set("standard/Math/Geometry/Box2",Vo);const Lo=Vo,{interval:Bo}=f,Uo={quadric:function(){const e=new Bt(1,0,0,-2,2,0,1,-2,1),t=new Bt;return function(n,i,s,r,o,a,l,u,h,c,d){t.set(n,i,s,r,o,a,l,u,h).multLeft(e);for(let e=0,n=c-1;e<c;++e){const i=e/n;d.push(t.multVecMatrix(new Et(1,i,i*i)))}}}(),cubic:function(){const e=new Yt(0,0,0,0),t=new _n(1,0,0,0,-3,3,0,0,3,-6,3,0,-1,3,-3,1),n=new _n;return function(i,s,r,o,a,l,u,h,c,d,p,g,f,m){n.set(i,s,r,0,o,a,l,0,u,h,c,0,d,p,g,0).multLeft(t);for(let t=0,i=f-1;t<f;++t){const s=t/i;n.multVecMatrix(e.set(1,s,s*s,s*s*s)),m.push(new Et(e.x,e.y,e.z))}}}(),arc(e,t,n,i,s,r,o,a,l,u,h){if(e===a&&t===l)return void h.push(new Et(a,l,0));if(n=Math.abs(n),i=Math.abs(i),0===n||0===i)return void h.push(new Et(e,t,0),new Et(a,l,0));const c=n*n,d=i*i;s=Bo(s,0,2*Math.PI);const p=Math.sin(s),g=Math.cos(s),f=new wt(e-a,t-l).divide(2),m=new wt(g*f.x+p*f.y,-p*f.x+g*f.y),_=m.copy().multVec(m),x=_.x/c+_.y/d;x>1&&(n=Math.sqrt(x)*n,i=Math.sqrt(x)*i);let y=(c*d-c*_.y-d*_.x)/(c*_.y+d*_.x);y=Math.max(0,y);const w=(r!==o?1:-1)*Math.sqrt(y),b=new wt(w*n*m.y/i,-w*i*m.x/n),S=new wt(g*b.x-p*b.y+(e+a)/2,p*b.x+g*b.y+(t+l)/2),v=new wt((m.x-b.x)/n,(m.y-b.y)/i),T=new wt((-m.x-b.x)/n,(-m.y-b.y)/i),O=e=>e>0?e:2*Math.PI+e,E=O(Math.atan2(v.y,v.x));let C=O(Math.atan2(T.y,T.x))-E;r?C<0&&(C+=2*Math.PI):C>0&&(C-=2*Math.PI),o&&C<0?C+=2*Math.PI:!o&&C>0&&(C-=2*Math.PI);const N=Math.max(4,Math.abs(C)*u/(2*Math.PI))-1;h.push(new Et(e,t,0));for(let e=1;e<N;++e){const t=E+C*(e/N),s=n*Math.cos(t),r=i*Math.sin(t);h.push(new Et(g*s-p*r+S.x,p*s+g*r+S.y,0))}h.push(new Et(a,l,0))}},Xo=Uo;n.set("standard/Math/Algorithms/Bezier",Xo);const jo=Xo;const ko=function(e){return Object.assign([new e],{top:0,set(e){this[this.top].assign(e)},get(){return this[this.top]},push(){const e=++this.top;e<this.length?this[e].assign(this[e-1]):this[e]=this[e-1].copy()},pushMatrix(e){const t=++this.top;t<this.length?this[t].assign(e):this[t]=e.copy()},pop(){--this.top},clear(){this.top=0},size(){return this.top+1},identity(){this[this.top].identity()},multLeft(e){this[this.top].multLeft(e)},translate(e){this[this.top].translate(e)},rotate(e){this[this.top].rotate(e)},scale(e){this[this.top].scale(e)}})};n.set("standard/Math/Utility/MatrixStack",ko);const zo=ko;var Go=i(666),Ho=i(132);const qo=kr({whitespaces:/[\x20\n\t\r]+/gy,comma:/,/gy,openParenthesis:/\(/gy,closeParenthesis:/\)/gy,length:/(em|ex|px|in|cm|mm|pt|pc|%)/gy,percent:/%/gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy,matrix:/matrix/gy,translate:/translate/gy,rotate:/rotate/gy,scale:/scale/gy,skewX:/skewX/gy,skewY:/skewY/gy,color:/([a-zA-Z]+|#[\da-fA-F]+|rgba?\(.*?\))/gy,url:/url\("?(.*?)"?\)/gy,path:/([mMlLhHvVqQtTcCsSaAzZ])/gy}),Yo=.0254,Wo=Yo/90,$o=16;function Ko(e){Br.call(this,e),ro.call(this),this.removeGroups=!0,this.removeEmptyGroups=!0,this.combineGroupingNodes=!1,this.solid=!1,this.viewBox=new Yt(0,0,100,100),this.modelMatrix=new zo(_n),this.fillGeometries=new Map,this.strokeGeometries=new Map,this.lineProperties=new Map,this.tessy=this.createTesselator(),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.styles=[{display:"inline",fillType:"COLOR",fillColor:Je.Black,fillURL:"",fillOpacity:1,fillRule:"nonzero",strokeType:"none",strokeColor:Je.Black,strokeURL:"",strokeOpacity:1,strokeWidth:1,opacity:1,stopColor:Je.Black,stopOpacity:1,vectorEffect:"none"}];const t=e.getBrowser();switch(t.getBrowserOption("PrimitiveQuality")){case"LOW":this.BEZIER_STEPS=6,this.CIRCLE_STEPS=20;break;case"HIGH":this.BEZIER_STEPS=10,this.CIRCLE_STEPS=64;break;default:this.BEZIER_STEPS=8,this.CIRCLE_STEPS=32}switch(t.getBrowserOption("TextureQuality")){case"LOW":this.GRADIENT_SIZE=128;break;case"HIGH":this.GRADIENT_SIZE=512;break;default:this.GRADIENT_SIZE=256}this.canvas.width=this.GRADIENT_SIZE,this.canvas.height=this.GRADIENT_SIZE}Object.assign(Object.setPrototypeOf(Ko.prototype,Br.prototype),ro.prototype,{CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:()=>"XML",setInput(e){try{"string"==typeof e&&(e=Go.parseXML(e)),this.input=e}catch{this.input=void 0}},isValid(){return this.input instanceof XMLDocument&&(!!Go(this.input).children("svg").length||"svg"===this.input.nodeName)},parseIntoScene(e,t){this.xmlElement(this.input).then(e).catch(t)},xmlElement:async function(e){switch(e.nodeName){case"#document":{const t=Go(e).children("svg");for(const e of t)await this.svgElement(e);break}case"svg":await this.svgElement(e)}return this.getScene()},svgElement:async function(e){const t=this.getBrowser(),n=this.getScene();n.setEncoding("SVG"),n.setProfile(t.getProfile("Interchange")),n.addComponent(t.getComponent("Geometry2D",2)),await this.loadComponents(),this.document=this.input,this.rootTransform=n.createNode("Transform"),this.groupNodes=[this.rootTransform],this.texturePropertiesNode=this.createTextureProperties();const i=n.createNode("Background");i.skyColor=[1,1,1],n.getRootNodes().push(i);const s=n.createNode("NavigationInfo");s.type=["PLANE_create3000.github.io","PLANE","EXAMINE","ANY"],n.getRootNodes().push(s);const r=this.lengthAttribute(e.getAttribute("width"),300,"width"),o=this.lengthAttribute(e.getAttribute("height"),150,"height"),a=this.viewBox.set(0,0,r,o),l=this.viewBoxAttribute(e.getAttribute("viewBox"),a),u=this.lengthAttribute(e.getAttribute("width"),l[2],"width"),h=this.lengthAttribute(e.getAttribute("height"),l[3],"height");{const e=u/h;l[2]/l[3]>e?l[3]+=l[2]/e-l[3]:l[2]+=l[3]*e-l[2]}const c=n.createNode("OrthoViewpoint"),d=(l.x+u/2)*Wo,p=-(l.y+h/2)*Wo;c.position=new Et(d,p,10),c.centerOfRotation=new Et(d,p,0),c.fieldOfView=[-u/2*Wo,-h/2*Wo,u/2*Wo,h/2*Wo],n.getRootNodes().push(c);const g=new Et(u*Wo/l[2],-h*Wo/l[3],1),f=new Et(-l.x,l.y,0).multVec(g);this.rootTransform.translation=f,this.rootTransform.scale=g,this.elements(e),n.addNamedNode(n.getUniqueName("ViewBox"),this.rootTransform),n.addExportedNode(n.getUniqueExportName("ViewBox"),this.rootTransform),n.getRootNodes().push(this.rootTransform),this.optimizeSceneGraph(n.getRootNodes())},elements(e){for(const t of e.childNodes)this.element(t)},element(e){switch(e.nodeName){case"use":return this.useElement(e);case"g":return this.gElement(e);case"switch":return this.switchElement(e);case"a":return this.aElement(e);case"rect":return this.rectElement(e);case"circle":return this.circleElement(e);case"ellipse":return this.ellipseElement(e);case"text":return this.textElement(e);case"image":return this.imageElement(e);case"polyline":return this.polylineElement(e);case"polygon":return this.polygonElement(e);case"path":return this.pathElement(e)}},useElement(e){const t=this.hrefAttribute(e.getAttribute("href")||e.getAttribute("xlink:href"));if(!t)return;if(!this.styleAttributes(e))return;const n=this.lengthAttribute(e.getAttribute("x"),0,"width"),i=this.lengthAttribute(e.getAttribute("y"),0,"height"),s=(this.lengthAttribute(e.getAttribute("width"),0,"width"),this.lengthAttribute(e.getAttribute("height"),0,"height"),this.createTransform(e,new wt(n,i)));this.groupNodes.push(s),this.element(t),this.popAll()},gElement(e){if(!this.styleAttributes(e))return;const t=this.createTransform(e);this.groupNodes.push(t),this.elements(e),this.popAll()},switchElement(e){if(!this.styleAttributes(e))return;const t=this.getExecutionContext(),n=this.createTransform(e),i=t.createNode("Switch");n.children.push(i),i.whichChoice=0,this.groupNodes.push(i),this.elements(e),this.popAll()},aElement(e){if(!this.styleAttributes(e))return;const t=e.getAttribute("href")||e.getAttribute("xlink:href"),n=e.getAttribute("title")||e.getAttribute("xlink:title"),i=e.getAttribute("target"),s=this.getExecutionContext(),r=this.createTransform(e),o=s.createNode("Anchor");r.children.push(o),o.description=n,o.url=[t],i&&(o.parameter=[`target=${i}`]),this.groupNodes.push(o),this.elements(e),this.popAll()},rectElement(e){const t=this.lengthAttribute(e.getAttribute("x"),0,"width"),n=this.lengthAttribute(e.getAttribute("y"),0,"height"),i=this.lengthAttribute(e.getAttribute("width"),0,"width"),s=this.lengthAttribute(e.getAttribute("height"),0,"height");let r=Math.max(0,this.lengthAttribute(e.getAttribute("rx"),0,"width")),o=Math.max(0,this.lengthAttribute(e.getAttribute("ry"),0,"height"));if(0===r&&0===o){if(!this.styleAttributes(e))return;const r=this.getExecutionContext(),o=new wt(i,s),a=new wt(t+i/2,n+s/2),l=new Lo(o,a),u=this.createTransform(e,a);if(this.groupNodes.push(u),"none"!==this.style.fillType){const t=r.createNode("Shape"),n=this.fillGeometries.get(e);if(u.children.push(t),t.appearance=this.createFillAppearance(l),n)t.geometry=n;else{const n=r.createNode("Rectangle2D");this.fillGeometries.set(e,n),t.geometry=n,n.solid=this.solid,n.size=o}}if("none"!==this.style.strokeType){const t=r.createNode("Shape"),n=this.strokeGeometries.get(e);if(u.children.push(t),t.appearance=this.createStrokeAppearance(),n)t.geometry=n;else{const n=r.createNode("Polyline2D"),o=i/2,a=s/2;this.strokeGeometries.set(e,n),t.geometry=n,n.lineSegments=[o,a,-o,a,-o,-a,o,-a,o,a]}}this.popAll()}else{r&&!o&&(o=r),o&&!r&&(r=o),r=Math.min(r,i/2),o=Math.min(o,s/2);const a=[t+i-r,t+r,t+r,t+i-r],l=[n+s-o,n+s-o,n+o,n+o],u=Object.assign([],{closed:!0});for(let e=0;e<4;++e){const t=e*Math.PI/2;for(let n=0,i=this.CIRCLE_STEPS/4;n<i;++n){const s=Ro.Polar(1,t+Math.PI/2*n/(i-1));u.push(new Et(a[e]+s.real*r,l[e]+s.imag*o,0))}}u.pop(),this.pathLikeElement(e,[u])}},circleElement(e){if(!this.styleAttributes(e))return;const t=this.lengthAttribute(e.getAttribute("cx"),0,"width"),n=this.lengthAttribute(e.getAttribute("cy"),0,"height"),i=this.lengthAttribute(e.getAttribute("r"),0),s=this.getExecutionContext(),r=new Lo(new wt(2*i,2*i),new wt(t,n)),o=this.createTransform(e,new wt(t,n));if(this.groupNodes.push(o),"none"!==this.style.fillType){const t=s.createNode("Shape"),n=this.fillGeometries.get(e);if(o.children.push(t),t.appearance=this.createFillAppearance(r),n)t.geometry=n;else{const n=s.createNode("Disk2D");this.fillGeometries.set(e,n),t.geometry=n,n.solid=this.solid,n.outerRadius=i}}if("none"!==this.style.strokeType){const t=s.createNode("Shape"),n=this.strokeGeometries.get(e);if(o.children.push(t),t.appearance=this.createStrokeAppearance(),n)t.geometry=n;else{const n=s.createNode("Circle2D");this.strokeGeometries.set(e,n),t.geometry=n,n.radius=i}}this.popAll()},ellipseElement(e){if(!this.styleAttributes(e))return;const t=this.lengthAttribute(e.getAttribute("cx"),0,"width"),n=this.lengthAttribute(e.getAttribute("cy"),0,"height"),i=this.lengthAttribute(e.getAttribute("rx"),0,"width"),s=this.lengthAttribute(e.getAttribute("ry"),0,"height"),r=this.getExecutionContext(),o=Math.min(i,s),a=new Lo(new wt(2*i,2*s),new wt(t,n)),l=this.createTransform(e,new wt(t,n),new wt(i/o,s/o));if(this.groupNodes.push(l),"none"!==this.style.fillType){const t=r.createNode("Shape"),n=this.fillGeometries.get(e);if(l.children.push(t),t.appearance=this.createFillAppearance(a),n)t.geometry=n;else{const n=r.createNode("Disk2D");this.fillGeometries.set(e,n),t.geometry=n,n.solid=this.solid,n.outerRadius=o}}if("none"!==this.style.strokeType){const t=r.createNode("Shape"),n=this.strokeGeometries.get(e);if(l.children.push(t),t.appearance=this.createStrokeAppearance(),n)t.geometry=n;else{const n=r.createNode("Circle2D");this.strokeGeometries.set(e,n),t.geometry=n,n.radius=o}}this.popAll()},textElement(e){},imageElement(e){const t=this.fillGeometries.get(e);if(t)this.groupNodes.at(-1).children.push(t);else{if(!this.styleAttributes(e))return;const t=this.lengthAttribute(e.getAttribute("x"),0,"width"),n=this.lengthAttribute(e.getAttribute("y"),0,"height"),i=this.lengthAttribute(e.getAttribute("width"),0,"width"),s=this.lengthAttribute(e.getAttribute("height"),0,"height"),r=e.getAttribute("href")||e.getAttribute("xlink:href"),o=this.getExecutionContext(),a=this.createTransform(e,new wt(t+i/2,n+s/2),new wt(1,-1));this.fillGeometries.set(e,a),this.groupNodes.push(a);const l=o.createNode("Shape"),u=o.createNode("Appearance"),h=o.createNode("ImageTexture"),c=o.createNode("Rectangle2D");l.appearance=u,l.geometry=c,u.texture=h,h.url=[r],h.textureProperties=this.texturePropertiesNode,c.solid=this.solid,c.size=new wt(i,s),a.children.push(l),this.popAll()}},polylineElement(e){const t=[];this.pointsAttribute(e.getAttribute("points"),t)&&this.pathLikeElement(e,[t])},polygonElement(e){const t=Object.assign([],{closed:!0});this.pointsAttribute(e.getAttribute("points"),t)&&this.pathLikeElement(e,[t])},pathElement(e){const t=[];this.dAttribute(e.getAttribute("d"),t)&&this.pathLikeElement(e,t)},pathLikeElement(e,t){if(!this.styleAttributes(e))return;t=t.map((function(e){return e.closed?Object.assign(e.filter(((e,t,n)=>e.distance(n[(t+1)%n.length])>1e-9)),{closed:!0}):e.filter(((e,t,n)=>!t||e.distance(n[t-1])>1e-9))})).filter((e=>e.length>2)),t.forEach(((e,t,n)=>e.index=t?n[t-1].index+n[t-1].length:0));const n=this.getExecutionContext(),i=this.createTransform(e),s=new Lo;for(const e of t)s.add(Lo.Points(...e));this.groupNodes.push(i);const r=n.createNode("Coordinate");for(const e of t)r.point.push(...e);if("none"!==this.style.fillType){const o=n.createNode("Shape"),a=this.fillGeometries.get(e);if(i.children.push(o),o.appearance=this.createFillAppearance(s),a)o.geometry=a;else{const i=n.createNode("IndexedTriangleSet");this.fillGeometries.set(e,i),o.geometry=i,i.solid=this.solid,i.index=this.triangulatePolygon(t,r),i.texCoord=this.createTextureCoordinate(r,s,o.appearance),i.coord=r}}if("none"!==this.style.strokeType){const s=n.createNode("Shape"),o=this.strokeGeometries.get(e);if(i.children.push(s),s.appearance=this.createStrokeAppearance(),o)s.geometry=o;else{const i=n.createNode("IndexedLineSet");this.strokeGeometries.set(e,i),s.geometry=i,i.coord=r;const o=i.coordIndex;for(const e of t){for(const t of e.keys())o.push(e.index+t);e.closed&&o.push(e.index),o.push(-1)}}}this.popAll()},linearGradientElementUrl(e,t){const n=this.linearGradientElement(e,t,{stops:[]}),i=this.context.createLinearGradient(n.x1,n.y1,n.x2,n.y2);return this.drawGradient(i,n,t)},linearGradientElement(e,t,n){if("linearGradient"!==e.nodeName)return;const i=this.hrefAttribute(e.getAttribute("href")||e.getAttribute("xlink:href"));i&&this.gradientElement(i,t,n),n.x1=this.lengthAttribute(e.getAttribute("x1"),n.x1||0,"width"),n.y1=this.lengthAttribute(e.getAttribute("y1"),n.y1||0,"height"),n.x2=this.lengthAttribute(e.getAttribute("x2"),n.x2||1,"width"),n.y2=this.lengthAttribute(e.getAttribute("y2"),n.y2||0,"height"),n.units=e.getAttribute("gradientUnits")||"objectBoundingBox",n.transform=this.transformAttribute(e.getAttribute("gradientTransform"));const s=new Bt,r=new wt(n.x1,n.y1);s.translate(r),s.scale(new wt($o,$o)),s.translate(r.negate()),n.spreadMatrix=s;for(const t of e.childNodes)this.gradientChild(t,n);return n},radialGradientElementUrl(e,t){const n=this.radialGradientElement(e,t,{stops:[]}),i=this.context.createRadialGradient(n.fx,n.fy,n.fr,n.cx,n.cy,n.r);return this.drawGradient(i,n,t)},radialGradientElement(e,t,n){const i=this.hrefAttribute(e.getAttribute("href")||e.getAttribute("xlink:href"));i&&this.gradientElement(i,t,n),n.cx=this.lengthAttribute(e.getAttribute("cx"),n.cx||.5,"width"),n.cy=this.lengthAttribute(e.getAttribute("cy"),n.cy||.5,"height"),n.r=this.lengthAttribute(e.getAttribute("r"),n.r||.5),n.fx=this.lengthAttribute(e.getAttribute("fx"),n.fx||n.cx,"width"),n.fy=this.lengthAttribute(e.getAttribute("fy"),n.fy||n.cy,"height"),n.fr=this.lengthAttribute(e.getAttribute("fr"),n.fr||0),n.units=e.getAttribute("gradientUnits")||"objectBoundingBox",n.spreadMethod=e.getAttribute("spreadMethod"),n.transform=this.transformAttribute(e.getAttribute("gradientTransform"));const s=new Bt,r=new wt(n.fx,n.fy);s.translate(r),s.scale(new wt($o,$o)),s.translate(r.negate()),n.spreadMatrix=s;for(const t of e.childNodes)this.gradientChild(t,n);return n},gradientElement(e,t,n){if(e)switch(e.nodeName){case"linearGradient":return this.linearGradientElement(e,t,n);case"radialGradient":return this.radialGradientElement(e,t,n)}},gradientChild(e,t){if("stop"===e.nodeName)return this.stopElement(e,t)},stopElement(e,t){if(!this.styleAttributes(e))return;const n=this.percentAttribute(e.getAttribute("offset"),0);if(n<0||n>1)return;const{stopColor:i,stopOpacity:s}=this.style;t.stops.push([n,i,s]),this.styles.pop()},drawGradient(e,t,n){switch(t.spreadMethod){default:t.spreadMatrix.identity();for(const[n,i,s]of t.stops)e.addColorStop(n,this.cssColor(i,s));break;case"repeat":for(let n=0;n<$o;++n){const i=n/$o;for(const[n,s,r]of t.stops)e.addColorStop(i+n/$o,this.cssColor(s,r))}break;case"reflect":for(let n=0;n<$o;++n){const i=n/$o;for(const[s,r,o]of t.stops)e.addColorStop(i+(n%2?1-s:s)/$o,this.cssColor(r,o))}}const i=new Bt;i.scale(new wt(this.GRADIENT_SIZE/2,this.GRADIENT_SIZE/2)),i.translate(wt.One),i.scale(new wt(1,-1)),"userSpaceOnUse"===t.units?i.multLeft(n.matrix.copy().inverse()):i.multLeft(new Bt(2,0,0,0,2,0,-1,-1,1)),i.multLeft(t.transform),i.multLeft(t.spreadMatrix);const s=this.context;return s.fillStyle=e,s.save(),s.clearRect(0,0,this.GRADIENT_SIZE,this.GRADIENT_SIZE),s.rect(0,0,this.GRADIENT_SIZE,this.GRADIENT_SIZE),s.transform(i[0],i[1],i[3],i[4],i[6],i[7]),s.fill(),s.restore(),this.canvas.toDataURL("image/png")},patternUrl(e){},idAttribute(e,t){if(null===e)return;const n=this.getExecutionContext(),i=this.sanitizeName(e);i&&(n.addNamedNode(n.getUniqueName(i),t),n.addExportedNode(n.getUniqueExportName(i),t))},viewBoxAttribute(e,t){if(null===e)return t;if(this.parseValue(e),this.double()){const e=this.value;if(this.double()){const t=this.value;if(this.double()){const n=this.value;if(this.double()){const i=this.value;return new Yt(e,t,n,i)}}}}return t},hrefAttribute(e){if(!e)return;const t=this.getExecutionContext(),n=new URL(e,t.getWorldURL()).hash.slice(1);return this.document.getElementById(n)},lengthAttribute(e,t,n){if(null===e)return t;if(this.parseValue(e),this.double()){let e=this.value;if(qo.length.parse(this))switch(this.result[1]){case"em":e*=16;break;case"ex":case"px":break;case"in":e*=90;break;case"cm":e*=.01/Wo;break;case"mm":e*=.001/Wo;break;case"pt":e*=1.25;break;case"pc":e*=14.999999999999998;break;case"%":switch(n){case"width":e*=this.viewBox[2]/100;break;case"height":e*=this.viewBox[3]/100;break;default:e*=Math.hypot(this.viewBox[2],this.viewBox[3])/100}}return e}return t},percentAttribute(e,t){if(this.parseValue(e),this.double()){let e=this.value;return qo.percent.parse(this)&&(e/=100),f.clamp(e,0,1)}return t},pointsAttribute(e,t){if(null===e)return!1;for(this.parseValue(e);;){if(this.double()){const e=this.value;if(this.comma()&&this.double()){const n=this.value;if(t.push(new Et(e,n,0)),this.comma())continue}}break}return!!t.length},dAttribute(e,t){if(null===e)return!1;this.parseValue(e);let n=[],i="",s="",r=!1,o=0,a=0,l=0,u=0;for(;this.whitespaces(),qo.path.parse(this);){switch(i=s,s=this.result[1],r=s===s.toLowerCase(),s){case"m":case"M":for(n.length>2&&t.push(Object.assign(n,{closed:!1})),n=[];;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;r&&(e+=o,t+=a),n.push(new Et(e,t,0)),o=e,a=t,this.comma();continue}}break}continue;case"l":case"L":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;r&&(e+=o,t+=a),n.push(new Et(e,t,0)),o=e,a=t,this.comma();continue}}break}continue;case"h":case"H":for(;this.double();){let e=this.value;r&&(e+=o),n.push(new Et(e,a,0)),o=e,this.comma()}continue;case"v":case"V":for(;this&&this.double();){let e=this.value;r&&(e+=a),n.push(new Et(o,e,0)),a=e,this.comma()}continue;case"q":case"Q":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;if(this.comma(),this.double()){let i=this.value;if(this.comma(),this.double()){let s=this.value;r&&(e+=o,t+=a,i+=o,s+=a),jo.quadric(o,a,0,e,t,0,i,s,0,this.BEZIER_STEPS,n),o=i,a=s,l=e,u=t,this.comma();continue}}}}break}continue;case"t":case"T":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;switch(r&&(e+=o,t+=a),i){case"Q":case"q":case"T":case"t":h=o+(o-l),c=a+(a-u);break;default:h=o,c=a}jo.quadric(o,a,0,h,c,0,e,t,0,this.BEZIER_STEPS,n),o=e,a=t,this.comma();continue}}break}continue;case"c":case"C":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;if(this.comma(),this.double()){let i=this.value;if(this.comma(),this.double()){let s=this.value;if(this.comma(),this.double()){let h=this.value;if(this.comma(),this.double()){let c=this.value;r&&(e+=o,t+=a,i+=o,s+=a,h+=o,c+=a),jo.cubic(o,a,0,e,t,0,i,s,0,h,c,0,this.BEZIER_STEPS,n),o=h,a=c,l=i,u=s,this.comma();continue}}}}}}break}continue;case"s":case"S":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;if(this.comma(),this.double()){let s=this.value;if(this.comma(),this.double()){let d=this.value;switch(r&&(e+=o,t+=a,s+=o,d+=a),i){case"C":case"c":case"S":case"s":var h=o+(o-l),c=a+(a-u);break;default:h=o,c=a}jo.cubic(o,a,0,h,c,0,e,t,0,s,d,0,this.BEZIER_STEPS,n),o=s,a=d,l=e,u=t,this.comma();continue}}}}break}continue;case"a":case"A":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;if(this.comma(),this.double()){let i=f.radians(this.value);if(this.comma(),this.int32()){let s=this.value;if(this.comma(),this.int32()){let l=this.value;if(this.comma(),this.double()){let u=this.value;if(this.comma(),this.double()){let h=this.value;r&&(u+=o,h+=a),jo.arc(o,a,e,t,i,s,l,u,h,this.CIRCLE_STEPS,n),o=u,a=h,this.comma();continue}}}}}}}break}continue;case"z":case"Z":n.length>2&&(o=n[0].x,a=n[0].y,t.push(Object.assign(n,{closed:!0}))),n=[],this.comma();continue}break}return n.length>2&&t.push(Object.assign(n,{closed:!1})),!!t.length},transformAttribute(e){const t=new Bt;if(null===e)return t;for(this.parseValue(e);;){if(this.comma(),this.whitespaces(),qo.matrix.parse(this)){if(this.whitespaces(),qo.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.comma()&&this.double()){const n=this.value;if(this.comma()&&this.double()){const i=this.value;if(this.comma()&&this.double()){const s=this.value;if(this.comma()&&this.double()){const r=this.value;if(this.comma()&&this.double()){const o=this.value;if(this.whitespaces(),qo.closeParenthesis.parse(this)){t.multLeft(new Bt(e,n,0,i,s,0,r,o,1));continue}}}}}}}}else if(qo.translate.parse(this)){if(this.whitespaces(),qo.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.comma()){if(this.double())var n=this.value}else n=0;if(this.whitespaces(),qo.closeParenthesis.parse(this)){t.translate(new wt(e,n));continue}}}else if(qo.rotate.parse(this)){if(this.whitespaces(),qo.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.whitespaces(),qo.closeParenthesis.parse(this)){t.rotate(f.radians(e));continue}if(this.comma()&&this.double()){const n=this.value;if(this.comma()&&this.double()){const i=this.value;if(this.whitespaces(),qo.closeParenthesis.parse(this)){t.translate(new wt(n,i)),t.rotate(f.radians(e)),t.translate(new wt(-n,-i));continue}}}}}else if(qo.scale.parse(this)){if(this.whitespaces(),qo.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.comma()){if(this.double())var i=this.value}else i=e;if(this.whitespaces(),qo.closeParenthesis.parse(this)){t.scale(new wt(e,i));continue}}}else if(qo.skewX.parse(this)){if(this.whitespaces(),qo.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.whitespaces(),qo.closeParenthesis.parse(this)){t.skewX(f.radians(e));continue}}}else if(qo.skewY.parse(this)&&(this.whitespaces(),qo.openParenthesis.parse(this)&&this.double())){const e=this.value;if(this.whitespaces(),qo.closeParenthesis.parse(this)){t.skewY(f.radians(e));continue}}break}return t},styleAttributes(e){const t=Object.assign({},this.styles.at(-1));if("none"===this.style.display)return!1;this.styles.push(t);for(const t of e.attributes)this.parseStyle(t.name,t.value);return this.styleAttribute(e.getAttribute("style")),!0},styleAttribute(e){if(null===e)return;const t=e.split(";");for(const e of t){const t=e.split(":");2===t.length&&this.parseStyle(t[0].trim(),t[1].trim())}},parseStyle(e,t){if("inherit"!==t&&"unset"!=t)switch(this.parseValue(t),e){case"display":this.displayStyle(t);break;case"fill":this.fillStyle(t);break;case"fill-opacity":this.fillOpacityStyle(t);break;case"fill-rule":this.fillRuleStyle(t);break;case"stroke":this.strokeStyle(t);break;case"stroke-opacity":this.strokeOpacityStyle(t);break;case"stroke-width":this.strokeWidthStyle(t);break;case"opacity":this.opacityStyle(t);break;case"stop-color":this.stopColorStyle(t);break;case"stop-opacity":this.stopOpacityStyle(t);break;case"vector-effect":this.vectorEffectStyle(t)}},displayStyle(e){this.style.display="default"!==e?e:"inline"},fillStyle(e){if("default"===e)return this.style.fillType=this.styles[0].fillType,this.style.fillColor=this.styles[0].fillColor,void(this.style.fillURL=this.styles[0].fillURL);if("transparent"!==e){if("none"!==e)return this.urlValue()?(this.style.fillType="URL",void(this.style.fillURL=this.result[1].trim())):this.colorValue(this.styles.at(-1).fillColor)?(this.style.fillType="COLOR",void(this.style.fillColor=this.value.copy())):void 0;this.style.fillType="none"}else this.style.fillType="none"},fillOpacityStyle(e){"default"!==e?"transparent"!==e?this.double()&&(this.style.fillOpacity=f.clamp(this.value,0,1)):this.style.fillOpacity=0:this.style.fillOpacity=this.styles[0].fillOpacity},fillRuleStyle(e){this.style.fillRule="default"!==e?e:this.styles[0].fillRule},strokeStyle(e){if("default"===e)return this.style.strokeType=this.styles[0].strokeType,this.style.strokeColor=this.styles[0].strokeColor,void(this.style.strokeURL=this.styles[0].strokeURL);if("transparent"!==e){if("none"!==e)return this.urlValue()?(this.style.strokeType="URL",void(this.style.strokeURL=this.result[1].trim())):this.colorValue(this.styles.at(-1).strokeColor)?(this.style.strokeType="COLOR",void(this.style.strokeColor=this.value.copy())):void 0;this.style.strokeType="none"}else this.style.strokeType="none"},strokeOpacityStyle(e){"default"!==e?"transparent"!==e?this.double()&&(this.style.strokeOpacity=f.clamp(this.value,0,1)):this.style.strokeOpacity=0:this.style.strokeOpacity=this.styles[0].strokeOpacity},strokeWidthStyle(e){"default"!==e?"none"!==e?this.double()&&(this.style.strokeWidth=this.lengthAttribute(this.value,1)):this.style.strokeWidth=0:this.style.strokeWidth=this.styles[0].strokeWidth},opacityStyle(e){"default"!==e?"transparent"!==e?this.double()&&(this.style.opacity=f.clamp(this.value,0,1)*this.styles.at(-1).opacity):this.style.opacity=0:this.style.opacity=this.styles[0].opacity},stopColorStyle(e){"default"!==e?this.colorValue(Je.Black)&&(this.style.stopColor=this.value.copy()):this.style.stopColor=this.styles[0].stopColor},stopOpacityStyle(e){"default"!==e?"transparent"!==e?this.double()&&(this.style.stopOpacity=f.clamp(this.value,0,1)):this.style.stopOpacity=0:this.style.stopOpacity=this.styles[0].stopOpacity},vectorEffectStyle(e){this.style.vectorEffect="default"!==e?e:this.styles[0].vectorEffect},parseValue(e){this.input=e,this.lastIndex=0,this.value=void 0},whitespaces(){return qo.whitespaces.parse(this)},comma(){return!!(this.whitespaces()|qo.comma.parse(this))},int32(){return this.whitespaces(),!!qo.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double(){return this.whitespaces(),qo.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!qo.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},colorValue:function(){const e=new Je(0,0,0,0);return function(t){if(!qo.color.parse(this))return!1;const n=this.cssColor(t);return this.value=e.set(...this.convertColor(this.result[1],n)),!0}}(),urlValue(){return qo.url.parse(this)},cssColor:(e,t=e.a)=>`rgba(${255*e.r},${255*e.g},${255*e.b},${t})`,createTransform(e,t=wt.Zero,n=wt.One){const i=this.getExecutionContext(),s=this.transformAttribute(e.getAttribute("transform"));this.modelMatrix.push(),this.modelMatrix.multLeft(_n.Matrix3(s)),s.translate(t),s.scale(n);const r=i.createNode("Transform"),o=_n.Matrix3(s),a=new Et(0,0,0),l=new dn,u=new Et(1,1,1),h=new dn;return o.get(a,l,u,h),r.translation=a,r.rotation=l,r.scale=u,r.scaleOrientation=h,this.idAttribute(e.getAttribute("id"),r),this.groupNodes.at(-1).children.push(r),r},popAll(){this.groupNodes.pop(),this.modelMatrix.pop(),this.styles.pop()},createFillAppearance(e){const t=this.getExecutionContext(),n=t.createNode("Appearance");switch(this.style.fillType){case"none":return null;case"COLOR":{const e=t.createNode("UnlitMaterial");n.material=e,e.emissiveColor=new De(...this.style.fillColor),e.transparency=1-this.style.fillOpacity*this.style.opacity;break}case"URL":{const t=this.getExecutionContext().createNode("ImageTexture"),i=this.getFillUrl(this.style.fillURL,e);if(!i)return null;t.url=[i],t.textureProperties=this.texturePropertiesNode,n.texture=t;break}}return n},getFillUrl(e,t){const n=this.hrefAttribute(e);if(n)switch(n.nodeName){case"linearGradient":return this.linearGradientElementUrl(n,t);case"radialGradient":return this.radialGradientElementUrl(n,t);case"pattern":return this.patternUrl(n)}},createStrokeAppearance(){const e=this.getExecutionContext(),t=e.createNode("Appearance"),n=e.createNode("UnlitMaterial");t.material=n,n.emissiveColor=new De(...this.style.strokeColor),n.transparency=1-this.style.strokeOpacity*this.style.opacity;const i="non-scaling-stroke"===this.vectorEffect?this.style.strokeWidth:this.getStokeWidth();return i>1&&(t.lineProperties=this.getLineProperties(i)),t},getStokeWidth(){const e=this.modelMatrix.get().multDirMatrix(new Et(this.style.strokeWidth,this.style.strokeWidth,0));return(e.x+e.y)/2},getLineProperties(e){const t=this.lineProperties.get(e);if(t)return t;{const t=this.getExecutionContext().createNode("LineProperties");return t.linewidthScaleFactor=e,this.lineProperties.set(e,t),t}},createTextureProperties(){const e=this.getExecutionContext().createNode("TextureProperties");return e.generateMipMaps=!0,e.minificationFilter="NICEST",e.magnificationFilter="NICEST",e.boundaryModeS="CLAMP_TO_EDGE",e.boundaryModeT="CLAMP_TO_EDGE",e.boundaryModeR="CLAMP_TO_EDGE",e.textureCompression="DEFAULT",e},createTextureCoordinate(e,t,n){if(!n||!n.texture)return null;const i=this.getExecutionContext().createNode("TextureCoordinate"),s=t.matrix.copy().inverse();for(const t of e.point)i.point.push(s.multVecMatrix(new wt(t.x,t.y)).add(wt.One).divide(2));return i},createTesselator(){const e=new Ho.GluTesselator;return e.gluTessCallback(Ho.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,t){t.push(e)})),e.gluTessNormal(0,0,1),e},triangulatePolygon(e,t){const n=this.tessy,i="evenodd"===this.style.fillRule?"GLU_TESS_WINDING_ODD":"GLU_TESS_WINDING_NONZERO",s=[];n.gluTessProperty(Ho.gluEnum.GLU_TESS_WINDING_RULE,Ho.windingRule[i]),n.gluTessCallback(Ho.gluEnum.GLU_TESS_COMBINE,(function(e,n,i){const s=t.point.length;return t.point.push(new Et(...e)),s})),n.gluTessBeginPolygon(s);for(const t of e){n.gluTessBeginContour();for(const[e,i]of t.entries())n.gluTessVertex(i,t.index+e);n.gluTessEndContour()}return n.gluTessEndPolygon(),s}}),Object.defineProperty(Ko.prototype,"style",{get(){return this.styles.at(-1)}});const Jo=Ko;n.set("x_ite/Parser/SVGParser",Jo);const Zo=Jo;var Qo=i(666);function ea(e){Br.call(this,e),this.inputs=new Map}Object.assign(Object.setPrototypeOf(ea.prototype,Br.prototype),{parseIntoScene(e,t,n){for(const i of ea.Parser)try{const s=new i(this.getScene()),r=this.getInput(s.getEncoding(),e);if(void 0===r)continue;if(s.setInput(r),!s.isValid())continue;return s.pushExecutionContext(this.getExecutionContext()),void s.parseIntoScene(t,n)}catch(e){if(!n)throw e;return void n(e)}throw this.getScene().worldURL.startsWith("data:")?new Error("Couldn't parse X3D. No suitable file handler found for 'data:' URL."):new Error(`Couldn't parse X3D. No suitable file handler found for '${this.getScene().worldURL}'.`)},getInput(e,t){if(this.inputs.has(e))return this.inputs.get(e);const n=this.createInput(e,t);return this.inputs.set(e,n),n},createInput(e,t){try{switch(e){case"STRING":return Qo.decodeText(t);case"XML":return Qo.parseXML(this.getInput("STRING",t));case"JSON":return JSON.parse(this.getInput("STRING",t));case"ARRAY_BUFFER":return t instanceof ArrayBuffer?t:void 0}}catch{return}}}),ea.Parser=[Zo,Qr,go,xo,no,Yr,To,No,Mo];const ta=ea;n.set("x_ite/Parser/GoldenGate",ta);const na=ta,ia=new Et(0,0,0),sa=new Et(0,0,0),ra=new _n;function oa(e,t){this.normal=t.copy(),this.distanceFromOrigin=t.dot(e)}Object.assign(oa.prototype,{copy(){const e=Object.create(oa.prototype);return e.normal=this.normal.copy(),e.distanceFromOrigin=this.distanceFromOrigin,e},assign(e){return this.normal.assign(e.normal),this.distanceFromOrigin=e.distanceFromOrigin,this},set(e,t){return this.normal.assign(t),this.distanceFromOrigin=t.dot(e),this},multRight(e){return sa.assign(this.normal).multiply(this.distanceFromOrigin),ra.assign(e).inverse(),ra.multMatrixDir(ia.assign(this.normal)).normalize(),e.multVecMatrix(sa),this.normal.assign(ia),this.distanceFromOrigin=ia.dot(sa),this},multLeft(e){return sa.assign(this.normal).multiply(this.distanceFromOrigin),ra.assign(e).inverse(),ra.multDirMatrix(ia.assign(this.normal)).normalize(),e.multMatrixVec(sa),this.normal.assign(ia),this.distanceFromOrigin=ia.dot(sa),this},getDistanceToPoint(e){return e.dot(this.normal)-this.distanceFromOrigin},intersectsLine(e,t){const{point:n,direction:i}=e,s=i.dot(this.normal);if(0===s)return!1;const r=(this.distanceFromOrigin-this.normal.dot(n))/s;return t.x=n.x+i.x*r,t.y=n.y+i.y*r,t.z=n.z+i.z*r,!0},toString(){return`${this.normal} ${this.distanceFromOrigin}`}});const aa=oa;n.set("standard/Math/Geometry/Plane3",aa);const la=aa;var ua=i(132);const ha={area:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i,s){return e.assign(i).subtract(n).cross(t.assign(s).subtract(n)).magnitude()/2}}(),normal(e,t,n,i){const s=n.x-t.x,r=n.y-t.y,o=n.z-t.z,a=e.x-t.x,l=e.y-t.y,u=e.z-t.z;return i.set(r*u-o*l,o*a-s*u,s*l-r*a),i.normalize()},quadNormal(e,t,n,i,s){const r=n.x-e.x,o=n.y-e.y,a=n.z-e.z,l=i.x-t.x,u=i.y-t.y,h=i.z-t.z;return s.set(o*h-a*u,a*l-r*h,r*u-o*l),s.normalize()},triangulatePolygon:function(){const e=new ua.GluTesselator;return e.gluTessCallback(ua.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,t){t.push(e)})),e.gluTessCallback(ua.gluEnum.GLU_TESS_COMBINE,(function(e,t,n){return t[0]})),e.gluTessProperty(ua.gluEnum.GLU_TESS_WINDING_RULE,ua.windingRule.GLU_TESS_WINDING_ODD),function(t,n){e.gluTessBeginPolygon(n),e.gluTessBeginContour();for(const n of t)e.gluTessVertex(n,n.index);return e.gluTessEndContour(),e.gluTessEndPolygon(),n}}(),triangulateConvexPolygon(e,t){for(let n=1,i=e.length-1;n<i;++n)t.push(e[0],e[n],e[n+1])}},ca=ha;n.set("standard/Math/Geometry/Triangle3",ca);const da=ca,pa={min:0,max:0},ga={min:0,max:0};function fa(){}function ma(e,t,n){n.min=Number.POSITIVE_INFINITY,n.max=Number.NEGATIVE_INFINITY;for(const i of e){const e=i.dot(t);e<n.min&&(n.min=e),e>n.max&&(n.max=e)}}function _a(e,t,n){return t<=e&&e<=n}fa.isSeparated=function(e,t,n){for(const o of e)if(ma(t,o,pa),ma(n,o,ga),r=ga.max,!_a(s=ga.min,i=pa.min,pa.max)&&!_a(i,s,r))return!0;var i,s,r;return!1};const xa=fa;n.set("standard/Math/Algorithms/SAT",xa);const ya=xa;function wa(e,t,n){this.viewport=new Yt(0,0,0,0),this.scissor=new Yt(0,0,0,0),this.points=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],this.normals=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],this.edges=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],this.planes=[new la(Et.Zero,Et.Zero),new la(Et.Zero,Et.Zero),new la(Et.Zero,Et.Zero),new la(Et.Zero,Et.Zero),new la(Et.Zero,Et.Zero),new la(Et.Zero,Et.Zero)],arguments.length&&this.set(e,t,n)}Object.assign(wa.prototype,{set:function(){const e=new _n;return function(t,n,i){this.viewport.assign(n),this.scissor.assign(i);const[s,r,o,a,l,u,h,c]=this.points,d=i[0],p=d+i[2],g=i[1],f=g+i[3];e.assign(t).inverse(),wa.unProjectPointMatrix(d,g,0,e,n,s),wa.unProjectPointMatrix(p,g,0,e,n,r),wa.unProjectPointMatrix(p,f,0,e,n,o),wa.unProjectPointMatrix(d,f,0,e,n,a),wa.unProjectPointMatrix(d,g,1,e,n,l),wa.unProjectPointMatrix(p,g,1,e,n,u),wa.unProjectPointMatrix(p,f,1,e,n,h),wa.unProjectPointMatrix(d,f,1,e,n,c);const m=this.normals;da.normal(s,r,o,m[0]),da.normal(c,l,s,m[1]),da.normal(h,o,r,m[2]),da.normal(o,h,c,m[3]),da.normal(r,s,l,m[4]),da.normal(l,c,h,m[5]);const _=this.planes;return _[0].set(r,m[0]),_[1].set(l,m[1]),_[2].set(o,m[2]),_[3].set(h,m[3]),_[4].set(s,m[4]),_[5].set(c,m[5]),this.edges.tainted=!0,this}}(),getViewport(){return this.viewport},getScissor(){return this.scissor},getEdges(){const e=this.edges;if(e.tainted){const[t,n,i,s,r,o,a,l]=this.points;e[0].assign(t).subtract(n),e[1].assign(n).subtract(i),e[2].assign(i).subtract(s),e[3].assign(s).subtract(t),e[4].assign(t).subtract(r),e[5].assign(n).subtract(o),e[6].assign(i).subtract(a),e[7].assign(s).subtract(l),e.tainted=!1}return e},intersectsSphere(e,t){const[n,i,s,r,o,a,l,u]=this.planes;return!(n.getDistanceToPoint(t)>e)&&(!(i.getDistanceToPoint(t)>e)&&(!(s.getDistanceToPoint(t)>e)&&(!(r.getDistanceToPoint(t)>e)&&(!(o.getDistanceToPoint(t)>e)&&!(a.getDistanceToPoint(t)>e)))))},intersectsBox:function(){const e=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],t=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],n=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],i=[];for(let e=0;e<24;++e)i.push(new Et(0,0,0));return function(s){s.getPoints(e);const r=this.points;if(ya.isSeparated(s.getNormals(t),e,r))return!1;if(ya.isSeparated(this.normals,e,r))return!1;s.getAxes(n);const o=this.getEdges();for(let e=0;e<3;++e)for(let t=0;t<8;++t)i[3*e+t].assign(n[e]).cross(o[t]);return!ya.isSeparated(i,e,r)}}()}),Object.assign(wa,{unProjectPoint:function(){const e=new _n;return function(t,n,i,s,r,o,a){return this.unProjectPointMatrix(t,n,i,e.assign(s).multRight(r).inverse(),o,a)}}(),unProjectPointMatrix:function(){const e=new Yt(0,0,0,0);return function(t,n,i,s,r,o){e.set((t-r[0])/r[2]*2-1,(n-r[1])/r[3]*2-1,2*i-1,1),s.multVecMatrix(e);const a=1/e.w;return o.set(e.x*a,e.y*a,e.z*a,1)}}(),unProjectRay:function(){const e=new _n;return function(t,n,i,s,r,o){return this.unProjectRayMatrix(t,n,e.assign(i).multRight(s).inverse(),r,o)}}(),unProjectRayMatrix:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i,s,r,o){return wa.unProjectPointMatrix(n,i,0,s,r,e),wa.unProjectPointMatrix(n,i,.9,s,r,t),o.setPoints(e,t)}}(),projectPoint:function(){const e=new Yt(0,0,0,0);return function(t,n,i,s,r){4===t.length?e.assign(t):e.set(t.x,t.y,t.z,1),i.multVecMatrix(n.multVecMatrix(e));const o=1/(2*e.w);return r.set((e.x*o+.5)*s[2]+s[0],(e.y*o+.5)*s[3]+s[1],e.z*o+.5)}}(),projectPointMatrix:function(){const e=new Yt(0,0,0,0);return function(t,n,i,s){4===t.length?e.assign(t):e.set(t.x,t.y,t.z,1),n.multVecMatrix(e);const r=1/(2*e.w);return s.set((e.x*r+.5)*i[2]+i[0],(e.y*r+.5)*i[3]+i[1],e.z*r+.5)}}(),projectLine:function(){const e=new _n;return function(t,n,i,s,r){return this.projectLineMatrix(t,e.assign(n).multRight(i),s,r)}}(),projectLineMatrix:function(){const e=new wt(0,0),t=new wt(0,0),n=new Et(0,0,0);return function(i,s,r,o){return wa.projectPointMatrix(i.point,s,r,e),wa.projectPointMatrix(n.assign(i.direction).multiply(1e9).add(i.point),s,r,t),o.setPoints(e,t)}}()});const ba=wa;n.set("standard/Math/Geometry/ViewVolume",ba);const Sa=ba;function va(e,t,n,i=!1){const s=e.getContext();if(this.browser=e,this.width=t,this.height=n,Object.defineProperty(this,"array",{get(){const e=i?new Float32Array(t*n*4):new Uint8Array(t*n*4);return Object.defineProperty(this,"array",{value:e}),e},configurable:!0}),this.lastBuffer=s.getParameter(s.FRAMEBUFFER_BINDING),this.frameBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer),this.colorTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.colorTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),i?s.texImage2D(s.TEXTURE_2D,0,s.getVersion()>1?s.RGBA32F:s.RGBA,t,n,0,s.RGBA,s.FLOAT,null):s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,n,0,s.RGBA,s.UNSIGNED_BYTE,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.colorTexture,0),s.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.depthTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST);const e=s.getVersion()>=2?s.DEPTH_COMPONENT24:s.DEPTH_COMPONENT;s.texImage2D(s.TEXTURE_2D,0,e,t,n,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this.depthBuffer),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,t,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this.depthBuffer);const r=s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE;if(s.bindTexture(s.TEXTURE_2D,null),s.bindFramebuffer(s.FRAMEBUFFER,this.lastBuffer),!r)throw new Error("Couldn't create frame buffer.")}Object.assign(va.prototype,{getWidth(){return this.width},getHeight(){return this.height},getColorTexture(){return this.colorTexture},getDepthTexture(){return this.depthTexture},readPixels(){const e=this.browser.getContext(),t=this.array,n=this.width,i=this.height;return e.readPixels(0,0,n,i,e.RGBA,e.UNSIGNED_BYTE,t),t},readDepth:function(){const e=new _n,t=new Et(0,0,0);return function(n,i){const s=this.browser.getContext(),r=this.array,o=this.width,a=this.height;s.readPixels(0,0,o,a,s.RGBA,s.FLOAT,r);let l=0,u=0,h=Number.POSITIVE_INFINITY;for(let e=0,t=0;e<a;++e)for(let n=0;n<o;++n,t+=4){const i=r[t];i<h&&(l=n,u=e,h=i)}return e.assign(n).inverse(),Sa.unProjectPointMatrix(l,u,h,e,i,t),t.z}}(),bind(){const e=this.browser.getContext();this.lastBuffer=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer)},unbind(){const e=this.browser.getContext();e.bindFramebuffer(e.FRAMEBUFFER,this.lastBuffer)},delete(){const e=this.browser.getContext();e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.colorTexture),e.HAS_FEATURE_DEPTH_TEXTURE?e.deleteTexture(this.depthTexture):e.deleteRenderbuffer(this.depthBuffer)}});for(const e of Reflect.ownKeys(va.prototype))Object.defineProperty(va.prototype,e,{enumerable:!1});const Ta=va;n.set("x_ite/Rendering/TextureBuffer",Ta);const Oa=Ta;let Ea=0;const Ca={POINTER:Ea++,CAMERA:Ea++,PICKING:Ea++,COLLISION:Ea++,SHADOW:Ea++,DISPLAY:Ea++};n.set("x_ite/Rendering/TraverseType",Ca);const Na=Ca;function Fa(e,t){this.array=e,this.auxiliary=[],t&&(this.compare=t)}Object.assign(Fa.prototype,{compare:(e,t)=>e<t,sort(e,t){this.mergeSort(e,t-1)},mergeSort(e,t){if(e<t){const n=e+t>>>1;this.mergeSort(e,n),this.mergeSort(n+1,t),this.merge(e,n,t)}},merge(e,t,n){const{array:i,auxiliary:s,compare:r}=this;let o,a,l;for(o=0,a=e;a<=t;)s[o++]=i[a++];for(o=0,l=e;l<a&&a<=n;)r(i[a],s[o])?i[l++]=i[a++]:i[l++]=s[o++];for(;l<a;)i[l++]=s[o++]}});const Ia=Fa;n.set("standard/Math/Algorithms/MergeSort",Ia);const Ma=Ia,Pa={frustum(e,t,n,i,s,r,o){const a=t-e,l=i-n,u=r-s,h=2*s,c=(t+e)/a,d=(i+n)/l,p=-(r+s)/u,g=-h*r/u,f=h/a,m=h/l;return o.set(f,0,0,0,0,m,0,0,c,d,p,-1,0,0,g,0)},perspective(e,t,n,i,s,r){const o=Math.tan(e/2)*t;if(i>s){const e=i*o/s;return this.frustum(-e,e,-o,o,t,n,r)}{const e=s*o/i;return this.frustum(-o,o,-e,e,t,n,r)}},perspective2(e,t,n,i,s,r){const o=Math.tan(e/2)*t;return this.frustum(-o,o,-o,o,t,n,r)},ortho(e,t,n,i,s,r,o){const a=t-e,l=i-n,u=r-s,h=2/a,c=2/l,d=-2/u,p=-(t+e)/a,g=-(i+n)/l,f=-(r+s)/u;return o.set(h,0,0,0,0,c,0,0,0,0,d,0,p,g,f,1)},orthoBox:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i){return n.getExtents(e,t),this.ortho(e.x,t.x,e.y,t.y,-t.z,-e.z,i)}}()},Da=Pa;n.set("standard/Math/Geometry/Camera",Da);const Ra=Da;function Aa(){this.matrix=new _n,this.set(...arguments)}Object.assign(Aa.prototype,{copy(){const e=Object.create(Aa.prototype);return e.matrix=this.matrix.copy(),e},assign(e){return this.matrix.assign(e.matrix),this},equals(e){return this.matrix.equals(e.matrix)},getMatrix(){return this.matrix},set(e,t){switch(arguments.length){case 0:return this.matrix.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this;case 2:return this.matrix.set(e.x/2,0,0,0,0,e.y/2,0,0,0,0,e.z/2,0,t.x,t.y,t.z,1),this}},setExtents(e,t){const n=(t.x-e.x)/2,i=(t.y-e.y)/2,s=(t.z-e.z)/2,r=(t.x+e.x)/2,o=(t.y+e.y)/2,a=(t.z+e.z)/2;return this.matrix.set(n,0,0,0,0,i,0,0,0,0,s,0,r,o,a,1),this},getExtents(e,t){this.getAbsoluteExtents(e,t),e.add(this.center),t.add(this.center)},getAbsoluteExtents:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0);return function(i,s){const r=this.matrix,o=r.xAxis,a=r.yAxis,l=r.zAxis;e.assign(a).add(l);const u=l.subtract(a);t.assign(o).add(e),n.assign(o).add(u);const h=e.subtract(o),c=u.subtract(o);i.assign(t).min(h,c,n),s.assign(t).max(h,c,n),t.negate(),h.negate(),c.negate(),n.negate(),i.min(t,h,c,n),s.max(t,h,c,n)}}(),getPoints:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new Et(0,0,0);return function(s){const r=this.matrix;e.assign(r.xAxis),t.assign(r.yAxis),n.assign(r.zAxis),i.assign(t).add(n);const o=n.subtract(t);s[0].assign(e).add(i),s[1].assign(i).subtract(e),s[2].assign(o).subtract(e),s[3].assign(e).add(o),s[4].assign(s[2]).negate(),s[5].assign(s[3]).negate(),s[6].assign(s[0]).negate(),s[7].assign(s[1]).negate();const a=this.center;return s[0].add(a),s[1].add(a),s[2].add(a),s[3].add(a),s[4].add(a),s[5].add(a),s[6].add(a),s[7].add(a),s}}(),getAxes(e){const t=this.matrix;return e[0].assign(t.xAxis),e[1].assign(t.yAxis),e[2].assign(t.zAxis),e},getNormals:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=[Et.xAxis,Et.yAxis,Et.zAxis];return function(s){const r=this.matrix;if(e.assign(r.xAxis),t.assign(r.yAxis),n.assign(r.zAxis),0===e.norm()&&(e.assign(t).cross(n),0===e.norm())){for(const n of i)if(e.assign(n).cross(t),0!==e.norm())break;if(0===e.norm()){for(const t of i)if(e.assign(t).cross(n),0!==e.norm())break;0===e.norm()&&e.assign(Et.xAxis)}}if(0===t.norm()&&(t.assign(n).cross(e),0===t.norm())){for(const e of i)if(t.assign(e).cross(n),0!==t.norm())break;if(0===t.norm()){for(const n of i)if(t.assign(n).cross(e),0!==t.norm())break;0===t.norm()&&t.assign(Et.yAxis)}}if(0===n.norm()&&(n.assign(e).cross(t),0===n.norm())){for(const t of i)if(n.assign(t).cross(e),0!==n.norm())break;if(0===n.norm()){for(const e of i)if(n.assign(e).cross(t),0!==n.norm())break;0===n.norm()&&n.assign(Et.zAxis)}}return s[0].assign(t).cross(n).normalize(),s[1].assign(n).cross(e).normalize(),s[2].assign(e).cross(t).normalize(),s}}(),isEmpty(){return 0===this.matrix[15]},add:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new Et(0,0,0);return function(s){return this.isEmpty()?this.assign(s):s.isEmpty()?this:(this.getExtents(e,t),s.getExtents(n,i),this.setExtents(e.min(n),t.max(i)))}}(),multLeft(e){return this.matrix.multLeft(e),this},multRight(e){return this.matrix.multRight(e),this},containsPoint:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n){return this.getExtents(e,t),e.x<=n.x&&t.x>=n.x&&e.y<=n.y&&t.y>=n.y&&e.z<=n.z&&t.z>=n.z}}(),intersectsBox:function(){const e=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],t=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],n=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],i=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],s=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],r=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)];return function(o){if(this.isEmpty())return!1;if(o.isEmpty())return!1;if(this.getPoints(e),o.getPoints(t),ya.isSeparated(this.getNormals(r),e,t))return!1;if(ya.isSeparated(o.getNormals(r),e,t))return!1;this.getAxes(n),o.getAxes(i);for(let e=0;e<3;++e)for(let t=0;t<3;++t)s[3*e+t].assign(n[e]).cross(i[t]);return!ya.isSeparated(s,e,t)}}(),intersectsTriangle:function(){const e=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],t=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],n=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],i=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)],s=[],r=[new Et(0,0,0)],o=[new Et(0,0,0),new Et(0,0,0),new Et(0,0,0)];return function(a,l,u){if(this.isEmpty())return!1;if(this.getPoints(e),s[0]=a,s[1]=l,s[2]=u,ya.isSeparated(this.getNormals(i),e,s))return!1;if(da.normal(a,l,u,r[0]),ya.isSeparated(r,e,s))return!1;this.getAxes(t),o[0].assign(a).subtract(l),o[1].assign(l).subtract(u),o[2].assign(u).subtract(a);for(let e=0;e<3;++e)for(let i=0;i<3;++i)n[3*e+i].assign(t[e]).cross(o[i]);return!ya.isSeparated(n,e,s)}}(),toString(){return`${this.size}, ${this.center}`}}),Object.assign(Aa,{Extents:(e,t)=>(new Aa).setExtents(e,t),Points:(...e)=>(new Aa).setExtents(e[0].copy().min(...e),e[0].copy().max(...e))}),Object.defineProperties(Aa.prototype,{size:{get:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(){return this.getAbsoluteExtents(e,t),t.subtract(e)}}(),enumerable:!0},center:{get(){return this.matrix.origin},enumerable:!0}});const Va=Aa;n.set("standard/Math/Geometry/Box3",Va);const La=Va;function Ba(e,t){this.point=e.copy(),this.direction=t.copy()}Object.assign(Ba.prototype,{copy(){const e=Object.create(Ba.prototype);return e.point=this.point.copy(),e.direction=this.direction.copy(),e},assign(e){return this.point.assign(e.point),this.direction.assign(e.direction),this},set(e,t){return this.point.assign(e),this.direction.assign(t),this},setPoints(e,t){return this.point.assign(e),this.direction.assign(t).subtract(e).normalize(),this},multMatrixLine(e){return e.multMatrixVec(this.point),e.multMatrixDir(this.direction).normalize(),this},multLineMatrix(e){return e.multVecMatrix(this.point),e.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint(e,t){const n=t.assign(e).subtract(this.point).dot(this.direction);return t.assign(this.direction).multiply(n).add(this.point)},getClosestPointToLine:function(){const e=new Et(0,0,0);return function(t,n){const{point:i,direction:s}=this,{point:r,direction:o}=t;let a=s.dot(o);return!(Math.abs(a)>=1)&&(e.assign(r).subtract(i),a=(e.dot(s)-a*e.dot(o))/(1-a*a),n.assign(s).multiply(a).add(i),!0)}}(),getPerpendicularVectorToPoint:function(){const e=new Et(0,0,0);return function(t,n){return n.assign(this.point).subtract(t),n.subtract(e.assign(this.direction).multiply(n.dot(this.direction)))}}(),getPerpendicularVectorToLine:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i){const s=i;e.assign(this.point).subtract(n.point);const r=e.dot(this.direction),o=e.dot(n.direction),a=this.direction.dot(n.direction),l=a*a,u=(r-o*a)/(1-l),h=-(o-r*a)/(1-l);return t.assign(this.direction).multiply(u),s.assign(n.direction).multiply(h),s.subtract(t).add(e)}}(),intersectsTriangle:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i,s,r){const o=i.subtract(n),a=s.subtract(n);e.assign(this.direction).cross(a);const l=o.dot(e);if(0===l)return!1;const u=1/l;t.assign(this.point).subtract(n);const h=t.dot(e)*u;if(h<0||h>1)return!1;const c=t.cross(o),d=this.direction.dot(c)*u;return!(d<0||h+d>1)&&(r.u=h,r.v=d,r.t=1-h-d,!0)}}(),toString(){return`${this.point}, ${this.direction}`}}),Object.assign(Ba,{Points(e,t){const n=Object.create(Ba.prototype);return n.point=e.copy(),n.direction=t.copy().subtract(e).normalize(),n}});const Ua=Ba;n.set("standard/Math/Geometry/Line3",Ua);const Xa=Ua;const ja=class{#e=0;#t=0;cycles=0;elapsedTime=0;start(){this.#e=Date.now()}stop(){this.#e<=this.#t||(this.#t=Date.now(),this.cycles+=1,this.elapsedTime+=this.#t-this.#e)}reset(){this.#e=0,this.#t=0,this.cycles=0,this.elapsedTime=0}get averageTime(){return this.cycles?this.elapsedTime/this.cycles:0}};n.set("standard/Time/StopWatch",ja);const ka=ja;function za(e){this.viewVolumes=[],this.cameraSpaceMatrix=new zo(_n),this.viewMatrix=new zo(_n),this.projectionMatrix=new zo(_n),this.modelViewMatrix=new zo(_n),this.viewportArray=new Int32Array(4),this.projectionMatrixArray=new Float32Array(16),this.cameraSpaceMatrixArray=new Float32Array(16),this.hitRay=new Xa(Et.Zero,Et.Zero),this.sensors=[[]],this.localObjectsCount=[0,0,0],this.globalObjects=[],this.localObjects=[],this.lights=[],this.globalShadows=[!1],this.localShadows=[!1],this.localFogs=[null],this.layouts=[],this.textureProjectors=[],this.generatedCubeMapTextures=[],this.collisions=[],this.collisionTime=new ka,this.numPointingShapes=0,this.numCollisionShapes=0,this.numShadowShapes=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.pointingShapes=[],this.collisionShapes=[],this.activeCollisions=[],this.shadowShapes=[],this.opaqueShapes=[],this.transparentShapes=[],this.transparencySorter=new Ma(this.transparentShapes,((e,t)=>e.distance<t.distance)),this.speed=0;try{this.depthBuffer=new Oa(e.getBrowser(),16,16,!0)}catch(e){console.error(e),this.getDepth=function(){return 0}}}function Ga(e,t){for(var n=0,i=t.length;n<i;++n)e[n]=t[n];e.length=i}Object.assign(za.prototype,{initialize(){},isIndependent:()=>!0,getRenderTime(){return this.renderTime},getViewVolumes(){return this.viewVolumes},getViewVolume(){return this.viewVolumes.at(-1)},getCameraSpaceMatrix(){return this.cameraSpaceMatrix},getViewMatrix(){return this.viewMatrix},getProjectionMatrix(){return this.projectionMatrix},getModelViewMatrix(){return this.modelViewMatrix},getViewportArray(){return this.viewportArray},getProjectionMatrixArray(){return this.projectionMatrixArray},getCameraSpaceMatrixArray(){return this.cameraSpaceMatrixArray},getHitRay(){return this.hitRay},getSensors(){return this.sensors},getGlobalObjects(){return this.globalObjects},getLocalObjects(){return this.localObjects},getLocalObjectsCount(){return this.localObjectsCount},getLights(){return this.lights},pushGlobalShadows(e){this.globalShadows.push(e||this.globalShadows.at(-1))},getGlobalShadows(){return this.globalShadows},pushLocalShadows(e){this.localShadows.push(e||this.localShadows.at(-1))},popLocalShadows(){this.localShadows.pop()},setGlobalFog:function(){const e=new _n;return function(t){if(t.getFogType()){const n=this.localFogs[0]||t.getFogs().pop();e.assign(t.getModelMatrix()).multRight(this.getViewMatrix().get()),n.set(t,e),this.localFogs[0]=n}else this.localFogs[0]=null}}(),getLocalFogs(){return this.localFogs},getLayouts(){return this.layouts},getParentLayout(){return this.layouts.at(-1)},getTextureProjectors(){return this.textureProjectors},getGeneratedCubeMapTextures(){return this.generatedCubeMapTextures},getCollisions(){return this.collisions},getCollisionTime(){return this.collisionTime},setNumPointingShapes(e){this.numPointingShapes=e},getNumPointingShapes(){return this.numPointingShapes},getPointingShapes(){return this.pointingShapes},setNumCollisionShapes(e){this.numCollisionShapes=e},getNumCollisionShapes(){return this.numCollisionShapes},getCollisionShapes(){return this.collisionShapes},setNumShadowShapes(e){this.numShadowShapes=e},getNumShadowShapes(){return this.numShadowShapes},getShadowShapes(){return this.shadowShapes},setNumOpaqueShapes(e){this.numOpaqueShapes=e},getNumOpaqueShapes(){return this.numOpaqueShapes},getOpaqueShapes(){return this.opaqueShapes},setNumTransparentShapes(e){this.numTransparentShapes=e},getNumTransparentShapes(){return this.numTransparentShapes},getTransparentShapes(){return this.transparentShapes},constrainTranslation(e,t){const n=this.getDistance(e)-this.getNavigationInfo().getCollisionRadius();if(n>0){return e.magnitude()>n?e.normalize().multiply(n):e}return t?this.constrainTranslation(e.normalize().multiply(n),!1):e.assign(Et.Zero)},getDistance:function(){const e=new _n,t=new _n,n=new dn,i=new Et(0,0,0),s=new dn;return function(r){this.collisionTime.start();const o=this.getViewpoint(),a=this.getNavigationInfo(),l=a.getCollisionRadius(),u=a.getStepHeight()-a.getAvatarHeight(),h=a.getNearValue(),c=a.getAvatarHeight();Ra.ortho(-l,l,Math.min(u,-l),l,h,Math.max(2*l,2*c),e),n.assign(o._orientation.getValue()).inverse().multRight(o.getOrientation()),s.setFromToVec(Et.zAxis,i.assign(r).negate()).multRight(n),o.straightenHorizon(s),t.assign(o.getModelMatrix()),t.translate(o.getUserPosition()),t.rotate(s),t.inverse(),t.multRight(e),t.multLeft(o.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(t);const d=this.getDepth(e);return this.getProjectionMatrix().pop(),this.collisionTime.stop(),-d}}(),getDepth:function(){const e=new Yt(0,0,16,16),t=new Sa;return t.set(_n.Identity,e,e),function(n){this.depthBuffer.bind(),this.viewVolumes.push(t),this.depth(this.collisionShapes,this.numCollisionShapes);const i=this.depthBuffer.readDepth(n,e);return this.viewVolumes.pop(),this.depthBuffer.unbind(),i}}(),render(e,t,n){switch(e){case Na.POINTER:this.numPointingShapes=0,t.call(n,e,this),this.pointing(this.pointingShapes,this.numPointingShapes);break;case Na.COLLISION:this.numCollisionShapes=0,t.call(n,e,this),this.collide(),this.gravite();break;case Na.SHADOW:this.numShadowShapes=0,t.call(n,e,this),this.depth(this.shadowShapes,this.numShadowShapes);break;case Na.DISPLAY:this.lightIndex=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.setGlobalFog(this.getFog()),t.call(n,e,this),this.draw()}},setHitRay(e,t,n){Sa.unProjectRay(n.x,n.y,_n.Identity,e,t,this.hitRay)},addPointingShape:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(e.assign(n.getBBoxSize())),i.multVecMatrix(t.assign(n.getBBoxCenter()));const s=e.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(s,t)){const e=this.numPointingShapes++;e===this.pointingShapes.length&&this.pointingShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[],sensors:[]});const t=this.pointingShapes[e];return t.modelViewMatrix.set(i),t.shapeNode=n,t.scissor=r.getScissor(),Ga(t.clipPlanes,this.localObjects),Ga(t.sensors,this.sensors.at(-1)),!0}return!1}}(),addCollisionShape:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(e.assign(n.getBBoxSize())),i.multVecMatrix(t.assign(n.getBBoxCenter()));const s=e.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(s,t)){const e=this.numCollisionShapes++;e===this.collisionShapes.length&&this.collisionShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),collisions:[],clipPlanes:[]});const t=this.collisionShapes[e];return t.modelViewMatrix.set(i),t.shapeNode=n,t.scissor=r.getScissor(),Ga(t.collisions,this.collisions),Ga(t.clipPlanes,this.localObjects),!0}return!1}}(),addShadowShape:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(e.assign(n.getBBoxSize())),i.multVecMatrix(t.assign(n.getBBoxCenter()));const s=e.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(s,t)){const e=this.numShadowShapes++;e===this.shadowShapes.length&&this.shadowShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[]});const t=this.shadowShapes[e];return t.modelViewMatrix.set(i),t.shapeNode=n,t.scissor=r.getScissor(),Ga(t.clipPlanes,this.localObjects),!0}return!1}}(),addDisplayShape:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(e.assign(n.getBBoxSize())),i.multVecMatrix(t.assign(n.getBBoxCenter()));const s=e.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(s,t)){if(n.isTransparent()){const e=this.numTransparentShapes++;e===this.transparentShapes.length&&this.transparentShapes.push(this.createRenderContext(!0)),(o=this.transparentShapes[e]).distance=t.z}else{const e=this.numOpaqueShapes++;e===this.opaqueShapes.length&&this.opaqueShapes.push(this.createRenderContext(!1));var o=this.opaqueShapes[e]}return o.modelViewMatrix.set(i),o.scissor.assign(r.getScissor()),o.shadows=this.localShadows.at(-1),o.fogNode=this.localFogs.at(-1),o.shapeNode=n,o.appearanceNode=n.getAppearance(),Ga(o.localObjects,this.localObjects),Ga(o.objectsCount,this.localObjectsCount),!0}return!1}}(),createRenderContext(e){return{renderObject:this,transparent:e,modelViewMatrix:new Float32Array(16),scissor:new Yt(0,0,0,0),localObjects:[],objectsCount:[0,0,0]}},pointing:function(){const e=new Float32Array(16);return function(t,n){const i=this.getBrowser(),s=i.getContext(),r=this.getViewVolume().getViewport(),[o,a]=i.getPointer();e.set(this.getProjectionMatrix().get()),s.viewport(r[0]-o,r[1]-a,r[2],r[3]),s.scissor(0,0,1,1),s.clear(s.DEPTH_BUFFER_BIT),s.depthMask(!0),s.enable(s.DEPTH_TEST),s.disable(s.BLEND),s.disable(s.CULL_FACE);for(let r=0;r<n;++r){const n=t[r],{scissor:l,clipPlanes:u,modelViewMatrix:h,shapeNode:c}=n,d=c.getAppearance(),p=c.getGeometryContext(),g=d.getStyleProperties(p.geometryType),f=i.getPointingShader(u.length,c),m=i.addPointingShape(n);s.scissor(l.x-o,l.y-a,l.z,l.w),f.enable(s),f.setClipPlanes(s,u),s.uniformMatrix4fv(f.x3d_ProjectionMatrix,!1,e),s.uniformMatrix4fv(f.x3d_ModelViewMatrix,!1,h),s.uniform1f(f.x3d_Id,m),g&&g.setShaderUniforms(s,f),c.displaySimple(s,n,f),i.resetTextureUnits()}}}(),collide:function(){const e=new _n,t=new _n,n=new La(Et.Zero,Et.Zero),i=new Et(0,0,0);return function(){const s=[],r=2.2*this.getNavigationInfo().getCollisionRadius();i.set(r,r,r);for(let r=0,o=this.numCollisionShapes;r<o;++r){const o=this.collisionShapes[r],a=o.collisions;if(a.length&&(n.set(i,Et.Zero),n.multRight(e.assign(o.modelViewMatrix).inverse()),o.shapeNode.intersectsBox(n,o.clipPlanes,t.assign(o.modelViewMatrix))))for(const e of a)s.push(e)}if(this.activeCollisions.length){const e=s.length?this.activeCollisions.filter((e=>!s.includes(e))):this.activeCollisions;for(const t of e)t.set_active(!1)}this.activeCollisions=s;for(const e of s)e.set_active(!0)}}(),gravite:function(){const e=new _n,t=new _n,n=new Et(0,0,0),i=new dn;return function(){const s=this.getBrowser();if(s.getActiveLayer()===this){if("WALK"!==s.getCurrentViewer())return}else if("WALK"!==this.getNavigationInfo().getViewer())return;const r=this.getNavigationInfo(),o=this.getViewpoint(),a=r.getCollisionRadius(),l=r.getNearValue(),u=r.getAvatarHeight(),h=r.getStepHeight();Ra.ortho(-a,a,-a,a,l,Math.max(2*a,2*u),e);const c=o.getUpVector(),d=i.setFromToVec(Et.zAxis,c);t.assign(o.getModelMatrix()),t.translate(o.getUserPosition()),t.rotate(d),t.inverse(),t.multRight(e),t.multLeft(o.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(t);let p=-this.getDepth(e);this.getProjectionMatrix().pop(),p-=u;const g=i.setFromToVec(Et.yAxis,c);if(p>0){const e=this.speed?s.getCurrentFrameRate():1e6;this.speed-=s.getBrowserOptions()._Gravity.getValue()/e;let t=this.speed/e;t<-p&&(t=-p,this.speed=0),o._positionOffset=o._positionOffset.getValue().add(g.multVecRot(n.set(0,t,0)))}else this.speed=0,p=-p,p>.01&&p<h&&(this.constrainTranslation(g.multVecRot(n.set(0,p,0)),!1),o._positionOffset=n.add(o._positionOffset.getValue()))}}(),depth:function(){const e=new Float32Array(16);return function(t,n){const i=this.getBrowser(),s=i.getContext(),r=this.getViewVolume().getViewport();e.set(this.getProjectionMatrix().get()),s.viewport(...r),s.scissor(...r),s.clearColor(1,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.depthMask(!0),s.enable(s.DEPTH_TEST),s.disable(s.BLEND),s.disable(s.CULL_FACE);for(let r=0;r<n;++r){const n=t[r],{scissor:o,clipPlanes:a,modelViewMatrix:l,shapeNode:u}=n,h=u.getAppearance(),c=u.getGeometryContext(),d=h.getStyleProperties(c.geometryType),p=i.getDepthShader(a.length,u);s.scissor(...o),p.enable(s),p.setClipPlanes(s,a),s.uniformMatrix4fv(p.x3d_ProjectionMatrix,!1,e),s.uniformMatrix4fv(p.x3d_ModelViewMatrix,!1,l),d&&d.setShaderUniforms(s,p),u.displaySimple(s,n,p),i.resetTextureUnits()}}}(),draw(){const e=this.getBrowser(),t=e.getContext(),n=this.getViewVolume().getViewport(),i=this.globalObjects,s=this.lights,r=this.textureProjectors,o=this.generatedCubeMapTextures,a=this.globalShadows,l=a.at(-1),u=this.getNavigationInfo()._headlight.getValue(),h=i.reduce(((e,t)=>e+!!t.lightNode),0),c=i.reduce(((e,t)=>e+!!t.textureProjectorNode),0);if(this.renderTime=Date.now(),this.isIndependent()){for(const e of s)e.renderShadowMap(this);for(const e of o)e.renderTexture(this)}u&&e.getHeadlight().setGlobalVariables(this);for(const e of s)e.setGlobalVariables(this);for(const e of r)e.setGlobalVariables(this);this.viewportArray.set(n),this.cameraSpaceMatrixArray.set(this.getCameraSpaceMatrix().get()),this.projectionMatrixArray.set(this.getProjectionMatrix().get()),t.viewport(...n),t.scissor(...n),t.clear(t.DEPTH_BUFFER_BIT),this.getBackground().display(t,this,n),t.depthMask(!0),t.enable(t.DEPTH_TEST),t.disable(t.BLEND);const d=this.opaqueShapes;for(let n=0,i=this.numOpaqueShapes;n<i;++n){const i=d[n];t.scissor(...i.scissor),i.shadows=i.shadows||l,i.objectsCount[1]+=h,i.objectsCount[2]+=c,i.shapeNode.display(t,i),e.resetTextureUnits()}t.depthMask(!1),t.enable(t.BLEND);const p=this.transparentShapes;this.transparencySorter.sort(0,this.numTransparentShapes);for(let n=0,i=this.numTransparentShapes;n<i;++n){const i=p[n];t.scissor(...i.scissor),i.shadows=i.shadows||l,i.objectsCount[1]+=h,i.objectsCount[2]+=c,i.shapeNode.display(t,i),e.resetTextureUnits()}if(t.depthMask(!0),t.disable(t.BLEND),this.isIndependent()){const t=e.getLocalObjects();for(const e of t)e.dispose();t.length=0;for(const e of i)e.dispose()}i.length=0,s.length=0,a.length=1,r.length=0,o.length=0}});const Ha=za;n.set("x_ite/Rendering/X3DRenderObject",Ha);const qa=Ha;function Ya(e,t){xs.call(this,e),this.nodes=[t]}Object.assign(Object.setPrototypeOf(Ya.prototype,xs.prototype),{get(){return this.nodes},top(){return this.nodes.at(-1)},pushOnTop(e){e!==this.nodes[0]&&(this.nodes.at(-1)._isBound=!1,this.nodes.push(e)),e._isBound=!0,e._bindTime=this.getBrowser().getCurrentTime(),this.addNodeEvent()},update(e,t,n){if(0===t.length&&0===n.length)return;const i=this.top(),s=this.nodes.at(-1);for(const e of t){const t=this.nodes.indexOf(e);t>0&&this.nodes.splice(t,1)}s!==this.nodes[0]&&n.some((e=>!e._set_bind.getValue()&&e===s))&&this.nodes.pop();for(const e of n)if(e._set_bind.getValue()){const t=this.nodes.indexOf(e);t>-1&&this.nodes.splice(t,1),this.nodes.push(e)}const r=this.nodes.at(-1);r!==s&&(s._set_bind=!1,s._isBound=!1,r._set_bind=!0,r._isBound=!0,r._bindTime=this.getBrowser().getCurrentTime()),r.transitionStart(e,i),this.addNodeEvent()}});for(const e of Reflect.ownKeys(Ya.prototype))Object.defineProperty(Ya.prototype,e,{enumerable:!1});Object.defineProperties(Ya,{typeName:{value:"BindableStack",enumerable:!0}});const Wa=Ya;n.set("x_ite/Execution/BindableStack",Wa);const $a=Wa;function Ka(e,t){xs.call(this,e),this.updateTime=0,this.nodes=[t],this.collectedNodes=[t],this.changedNodes=[],this.removedNodes=[]}Object.assign(Object.setPrototypeOf(Ka.prototype,xs.prototype),{get(){return this.nodes},getBound(e){const t=this.nodes.length;if(1===t)return this.nodes[0];if(e)for(let n=1;n<t;++n){const t=this.nodes[n];if((t.getExecutionContext().getOuterNode()?.getScene()??t.getScene()).isMainScene()&&t.getName()==e)return t}for(let e=1;e<t;++e){const t=this.nodes[e];if((t.getExecutionContext().getOuterNode()?.getScene()??t.getScene()).isMainScene()&&t._isBound.getValue())return t}for(let e=1;e<t;++e){const t=this.nodes[e];if((t.getExecutionContext().getOuterNode()?.getScene()??t.getScene()).isMainScene())return t}return this.nodes[0]},push(e){return this.collectedNodes.push(e)},update(e,t){const n=this.collectedNodes,i=this.changedNodes,s=this.removedNodes;for(const e of n)e._set_bind.getModificationTime()>this.updateTime&&i.push(e);if(!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.nodes)){for(const e of this.nodes)n.includes(e)||s.push(e);const e=this.nodes;this.nodes=n,this.collectedNodes=e}this.collectedNodes.length=1,t.update(e,s,i),i.length=0,s.length=0,this.updateTime=Date.now()}});for(const e of Reflect.ownKeys(Ka.prototype))Object.defineProperty(Ka.prototype,e,{enumerable:!1});Object.defineProperties(Ka,{typeName:{value:"BindableList",enumerable:!0}});const Ja=Ka;n.set("x_ite/Execution/BindableList",Ja);const Za=Ja,Qa={TELEPORT:!0,LINEAR:!0,ANIMATE:!0};function el(e){nr.call(this,e),this.addType(c.NavigationInfo),this.addChildObjects("transitionStart",new Qi.SFBool,"transitionActive",new Qi.SFBool,"availableViewers",new Qi.MFString,"viewer",new Qi.SFString("EXAMINE")),this._avatarSize.setUnit("length"),this._speed.setUnit("speed"),this._visibilityLimit.setUnit("speed")}Object.assign(Object.setPrototypeOf(el.prototype,nr.prototype),{initialize(){nr.prototype.initialize.call(this),this._type.addInterest("set_type__",this),this._headlight.addInterest("set_headlight__",this),this._transitionStart.addInterest("set_transitionStart__",this),this._transitionComplete.addInterest("set_transitionComplete__",this),this._isBound.addInterest("set_isBound__",this),this.set_type__(),this.set_headlight__()},getViewer(){return this._viewer.getValue()},getCollisionRadius(){return this._avatarSize.length>0&&this._avatarSize[0]>0?this._avatarSize[0]:.25},getAvatarHeight(){return this._avatarSize.length>1?this._avatarSize[1]:1.6},getStepHeight(){return this._avatarSize.length>2?this._avatarSize[2]:.75},getNearValue(){const e=this.getCollisionRadius();return 0===e?1e-5:e/2},getFarValue(e){return this._visibilityLimit.getValue()?this._visibilityLimit.getValue():e.getMaxFarValue()},getTransitionType(){for(const e of this._transitionType){if(Qa[e])return e}return"LINEAR"},set_type__(){this._viewer="EXAMINE";for(const e of this._type){switch(e){case"EXAMINE":case"WALK":case"FLY":case"LOOKAT":case"PLANE":case"NONE":this._viewer=e;break;case"PLANE_create3000.github.io":case"PLANE_create3000.de":this._viewer="PLANE";break;default:continue}break}let e=!1,t=!1,n=!1,i=!1,s=!1,r=!1;if(this._type.length)for(const o of this._type){switch(o){case"EXAMINE":default:e=!0;continue;case"WALK":t=!0;continue;case"FLY":n=!0;continue;case"LOOKAT":r=!0;continue;case"PLANE":i=!0;continue;case"NONE":s=!0;continue;case"ANY":e=!0,t=!0,n=!0,i=!0,s=!0,r=!0}break}else e=!0,t=!0,n=!0,i=!0,s=!0,r=!0;this._availableViewers.length=0,e&&this._availableViewers.push("EXAMINE"),t&&this._availableViewers.push("WALK"),n&&this._availableViewers.push("FLY"),i&&this._availableViewers.push("PLANE"),r&&this._availableViewers.push("LOOKAT"),s&&this._availableViewers.push("NONE")},set_headlight__(){this._headlight.getValue()?delete this.enable:this.enable=Function.prototype},set_transitionStart__(){this._transitionActive.getValue()||(this._transitionActive=!0)},set_transitionComplete__(){this._transitionActive.getValue()&&(this._transitionActive=!1)},set_isBound__(){this._isBound.getValue()||this._transitionActive.getValue()&&(this._transitionActive=!1)},enable(e,t){e===Na.DISPLAY&&this._headlight.getValue()&&t.getGlobalObjects().push(this.getBrowser().getHeadlight())},traverse(e,t){e===Na.CAMERA&&t.getLayer().getNavigationInfos().push(this)}}),Object.defineProperties(el,{typeName:{value:"NavigationInfo",enumerable:!0},componentName:{value:"Navigation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_bind",new Qi.SFBool),new H(c.inputOutput,"type",new Qi.MFString("EXAMINE","ANY")),new H(c.inputOutput,"avatarSize",new Qi.MFFloat(.25,1.6,.75)),new H(c.inputOutput,"speed",new Qi.SFFloat(1)),new H(c.inputOutput,"headlight",new Qi.SFBool(!0)),new H(c.inputOutput,"visibilityLimit",new Qi.SFFloat),new H(c.inputOutput,"transitionType",new Qi.MFString("LINEAR")),new H(c.inputOutput,"transitionTime",new Qi.SFTime(1)),new H(c.outputOnly,"transitionComplete",new Qi.SFBool),new H(c.outputOnly,"isBound",new Qi.SFBool),new H(c.outputOnly,"bindTime",new Qi.SFTime)]),enumerable:!0}});const tl=el;n.set("x_ite/Components/Navigation/NavigationInfo",tl);const nl=tl;const il=function(e){return Object.assign([],{top:0,pop(){return 0!==this.top?this[--this.top]:new e},push(e){this[this.top++]=e},clear(){this.length=0,this.top=0}})};n.set("standard/Utility/ObjectCache",il);const sl=il,rl=sl(ol);function ol(){this.fogMatrix=new Float32Array(9)}function al(e){this.addType(c.X3DFogObject),this._visibilityRange.setUnit("length"),this.hidden=!1,this.colorArray=new Float32Array(3)}Object.assign(ol.prototype,{set(e,t){this.fogNode=e,this.fogMatrix.set(t.submatrix.inverse())},getFogType(){return this.fogNode.getFogType()},setShaderUniforms(e,t){if(t.hasFog(this))return;const n=this.fogNode;e.uniform3fv(t.x3d_FogColor,n.colorArray),e.uniform1f(t.x3d_FogVisibilityRange,n.visibilityRange),e.uniformMatrix3fv(t.x3d_FogMatrix,!1,this.fogMatrix)},dispose(){rl.push(this)}}),Object.assign(al.prototype,{initialize(){this._fogType.addInterest("set_fogType__",this),this._color.addInterest("set_color__",this),this._visibilityRange.addInterest("set_visibilityRange__",this),this.set_color__(),this.set_visibilityRange__()},isHidden(){return this.hidden},setHidden(e){this.hidden=e,this.set_fogType__(),this.getBrowser().addBrowserEvent()},getFogType(){return this.fogType},getFogs:()=>rl,set_fogType__:function(){const e=new Map([["LINEAR",1],["EXPONENTIAL",2]]);return function(){this.hidden||0===this.visibilityRange?this.fogType=0:this.fogType=e.get(this._fogType.getValue())||1}}(),set_color__(){const e=this._color.getValue(),t=this.colorArray;t[0]=e.r,t[1]=e.g,t[2]=e.b},set_visibilityRange__(){this.visibilityRange=Math.max(0,this._visibilityRange.getValue()),this.set_fogType__()},dispose(){}}),Object.defineProperties(al,{typeName:{value:"X3DFogObject",enumerable:!0},componentName:{value:"EnvironmentalEffects",enumerable:!0}});const ll=al;n.set("x_ite/Components/EnvironmentalEffects/X3DFogObject",ll);const ul=ll;function hl(e){nr.call(this,e),ul.call(this,e),this.addType(c.Fog),this.modelMatrix=new _n}Object.assign(Object.setPrototypeOf(hl.prototype,nr.prototype),ul.prototype,{initialize(){nr.prototype.initialize.call(this),ul.prototype.initialize.call(this)},getModelMatrix(){return this.modelMatrix},traverse(e,t){e===Na.CAMERA&&(t.getLayer().getFogs().push(this),this.modelMatrix.assign(t.getModelViewMatrix().get()))},dispose(){ul.prototype.dispose.call(this),nr.prototype.dispose.call(this)}}),Object.defineProperties(hl,{typeName:{value:"Fog",enumerable:!0},componentName:{value:"EnvironmentalEffects",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_bind",new Qi.SFBool),new H(c.inputOutput,"fogType",new Qi.SFString("LINEAR")),new H(c.inputOutput,"color",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"visibilityRange",new Qi.SFFloat),new H(c.outputOnly,"isBound",new Qi.SFBool),new H(c.outputOnly,"bindTime",new Qi.SFTime)]),enumerable:!0}});const cl=hl;n.set("x_ite/Components/EnvironmentalEffects/Fog",cl);const dl=cl;function pl(e){this.gl=e,this.vertexArrays=new Map}Object.assign(pl.prototype,{update(e=!0){return e&&this.delete(),this},enable(e){const t=this.vertexArrays.get(e);if(t)return this.gl.bindVertexArray(t),!1;{const t=this.gl.createVertexArray();return this.vertexArrays.set(e,t),this.gl.bindVertexArray(t),!0}},delete(){for(const e of this.vertexArrays.values())this.gl.deleteVertexArray(e);this.vertexArrays.clear()}});const gl=pl;n.set("x_ite/Rendering/VertexArray",gl);const fl=gl;let ml=0;const _l={POINT:ml++,WIREFRAME:ml++,FLAT:ml++,GOURAUD:ml++,PHONG:ml++};n.set("x_ite/Browser/Core/Shading",_l);const xl=_l,yl=[new Et(0,0,1),new Et(0,0,-1),new Et(0,1,0),new Et(0,-1,0),new Et(1,0,0)];function wl(e){vs.call(this,e),this.addType(c.X3DGeometryNode),this.addChildObjects("transparent",new Qi.SFBool,"bbox_changed",new Qi.SFTime,"rebuild",new Qi.SFTime),this._transparent.setAccessType(c.outputOnly),this._bbox_changed.setAccessType(c.outputOnly),this._rebuild.setAccessType(c.outputOnly);const t=this.getBrowser();this.min=new Et(0,0,0),this.max=new Et(0,0,0),this.bbox=La.Extents(this.min,this.max),this.solid=!0,this.primitiveMode=t.getContext().TRIANGLES,this.geometryType=3,this.flatShading=void 0,this.colorMaterial=!1,this.attribNodes=[],this.attribArrays=[],this.textureCoordinateMapping=new Map,this.multiTexCoords=[],this.texCoords=wl.createArray(),this.fogDepths=wl.createArray(),this.colors=wl.createArray(),this.normals=wl.createArray(),this.flatNormals=wl.createArray(),this.vertices=wl.createArray(),this.hasFogCoords=!1,this.hasNormals=!1,this.geometryKey="",this.vertexCount=0,this.planes=[];for(let e=0;e<5;++e)this.planes[e]=new la(Et.Zero,Et.zAxis)}Object.defineProperty(wl,"createArray",{value(){const e=[];return e.typedArray=new Float32Array,e.assign=function(e){const t=e.length;for(let n=0;n<t;++n)this[n]=e[n];this.length=t},e.getValue=function(){return this.typedArray},e.shrinkToFit=function(){this.length===this.typedArray.length?this.typedArray.set(this):this.typedArray=new Float32Array(this)},e}}),Object.assign(Object.setPrototypeOf(wl.prototype,vs.prototype),{setup(){vs.prototype.setup.call(this),this.rebuild()},initialize(){vs.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getContext();this.getLive().addInterest("set_live__",this),this.addInterest("requestRebuild",this),this._rebuild.addInterest("rebuild",this),this.frontFace=t.CCW,this.backFace=new Map([[t.CCW,t.CW],[t.CW,t.CCW]]),this.attribBuffers=[],this.textureCoordinateNode=e.getDefaultTextureCoordinate(),this.texCoordBuffers=Array.from({length:e.getMaxTexCoords()},(()=>t.createBuffer())),this.fogDepthBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.normalBuffer=t.createBuffer(),this.vertexBuffer=t.createBuffer(),this.vertexArrayObject=new fl(t),this.set_live__()},setGeometryType(e){this.geometryType=e},getGeometryType(){return this.geometryType},setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()},getBBox(){return this.bbox},setBBox(e){if(!e.equals(this.bbox)){e.getExtents(this.min,this.max),this.bbox.assign(e);for(let e=0;e<5;++e)this.planes[e].set(e%2?this.min:this.max,yl[e]);this._bbox_changed.addEvent()}},getMin(){return this.min},getMax(){return this.max},getMatrix:()=>_n.Identity,setPrimitiveMode(e){this.primitiveMode=e},getPrimitiveMode(){return this.primitiveMode},setSolid(e){this.solid=e},setCCW(e){const t=this.getBrowser().getContext();this.frontFace=e?t.CCW:t.CW},getAttrib(){return this.attribNodes},getAttribs(){return this.attribArrays},getAttribBuffers(){return this.attribBuffers},setFogDepths(e){this.fogDepths.assign(e)},getFogDepths(){return this.fogDepths},setColors(e){this.colors.assign(e)},getColors(){return this.colors},setMultiTexCoords(e){const t=this.multiTexCoords,n=e.length;for(let i=0;i<n;++i)t[i]=e[i];t.length=n},getMultiTexCoords(){return this.multiTexCoords},getTexCoords(){return this.texCoords},getTextureCoordinate(){return this.textureCoordinateNode},setTextureCoordinate(e){this.textureCoordinateNode.removeInterest("updateTextureCoordinateMapping",this),this.textureCoordinateNode=e||this.getBrowser().getDefaultTextureCoordinate(),this.textureCoordinateNode.addInterest("updateTextureCoordinateMapping",this),this.updateTextureCoordinateMapping()},getTextureCoordinateMapping(){return this.textureCoordinateMapping},updateTextureCoordinateMapping(){this.textureCoordinateMapping.clear(),this.textureCoordinateNode.getTextureCoordinateMapping(this.textureCoordinateMapping)},setNormals(e){this.normals.assign(e)},getNormals(){return this.normals},setVertices(e){this.vertices.assign(e)},getVertices(){return this.vertices},updateVertexArrays(){this.vertexArrayObject.update(),this.updateParticles=!0},buildTexCoords(){const e=this.texCoords;if(0===e.length){const t=this.getTexCoordParams(),n=t.min,i=t.Sindex,s=t.Tindex,r=t.Ssize,o=n[i],a=n[s],l=this.vertices.getValue();for(let t=0,n=l.length;t<n;t+=4)e.push((l[t+i]-o)/r,(l[t+s]-a)/r,0,1);e.shrinkToFit()}this.getMultiTexCoords().push(e)},getTexCoordParams:function(){const e={min:new Et(0,0,0),Ssize:0,Sindex:0,Tindex:0};return function(){const t=this.getBBox(),n=t.size,i=n.x,s=n.y,r=n.z;return e.min.assign(t.center).subtract(n.divide(2)),i>=s&&i>=r?(e.Ssize=i,e.Sindex=0,e.Tindex=s>=r?1:2):s>=i&&s>=r?(e.Ssize=s,e.Sindex=1,e.Tindex=i>=r?0:2):(e.Ssize=r,e.Sindex=2,e.Tindex=i>=s?0:1),e}}(),refineNormals(e,t,n){if(0===n)return t;const i=Math.cos(f.clamp(n,0,Math.PI)),s=[];for(const n in e){const r=e[n];for(const e of r){const n=t[e],o=new Et(0,0,0);for(const e of r){const s=t[e];s.dot(n)>=i&&o.add(s)}s[e]=o.normalize()}}return s},transformLine(e){},transformMatrix(e){},isClipped:(e,t)=>t.some((function(t){return t.isClipped(e)})),intersectsLine:function(){const e=new _n,t={u:0,v:0,t:0},n=new Et(0,0,0),i=new Et(0,0,0),s=new Et(0,0,0),r=new Et(0,0,0);return function(o,a,l,u){if(this.intersectsBBox(o)){this.transformLine(o),this.transformMatrix(e.assign(a));const h=this.multiTexCoords[0].getValue(),c=this.normals.getValue(),d=this.vertices.getValue(),p=this.vertexCount;for(let a=0;a<p;a+=3){const p=4*a;if(n.x=d[p],n.y=d[p+1],n.z=d[p+2],i.x=d[p+4],i.y=d[p+5],i.z=d[p+6],s.x=d[p+8],s.y=d[p+9],s.z=d[p+10],o.intersectsTriangle(n,i,s,t)){const n=t.u,i=t.v,s=t.t,o=new Et(s*d[p]+n*d[p+4]+i*d[p+8],s*d[p+1]+n*d[p+5]+i*d[p+9],s*d[p+2]+n*d[p+6]+i*d[p+10]);if(l.length&&this.isClipped(e.multVecMatrix(r.assign(o)),l))continue;const g=new wt(s*h[p]+n*h[p+4]+i*h[p+8],s*h[p+1]+n*h[p+5]+i*h[p+9]),f=3*a,m=new Et(s*c[f]+n*c[f+3]+i*c[f+6],s*c[f+1]+n*c[f+4]+i*c[f+7],s*c[f+2]+n*c[f+5]+i*c[f+8]);u.push({texCoord:g,normal:m,point:this.getMatrix().multVecMatrix(o)})}}}return u.length}}(),getPlanesWithOffset:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=[];for(let e=0;e<5;++e)n[e]=new la(Et.Zero,Et.zAxis);return function(i,s,r,o,a,l){e.set(i,s,r),t.set(o,a,l);for(let i=0;i<5;++i)n[i].set(i%2?e:t,yl[i]);return n}}(),intersectsBBox:function(){const e=new Et(0,0,0);return function(t,n){if(n)var i=this.min,s=this.max,r=i.x-n.x,o=s.x+n.x,a=i.y-n.y,l=s.y+n.y,u=i.z-n.z,h=s.z+n.z,c=this.getPlanesWithOffset(r,a,u,o,l,h);else i=this.min,s=this.max,r=i.x,o=s.x,a=i.y,l=s.y,u=i.z,h=s.z,c=this.planes;return!!(c[0].intersectsLine(t,e)&&e.x>=r&&e.x<=o&&e.y>=a&&e.y<=l)||(!!(c[1].intersectsLine(t,e)&&e.x>=r&&e.x<=o&&e.y>=a&&e.y<=l)||(!!(c[2].intersectsLine(t,e)&&e.x>=r&&e.x<=o&&e.z>=u&&e.z<=h)||(!!(c[3].intersectsLine(t,e)&&e.x>=r&&e.x<=o&&e.z>=u&&e.z<=h)||!!(c[4].intersectsLine(t,e)&&e.y>=a&&e.y<=l&&e.z>=u&&e.z<=h))))}}(),intersectsBox:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new _n,s=new Et(0,0,0);return function(r,o,a){if(r.intersectsBox(this.bbox)){r.multRight(i.assign(this.getMatrix()).inverse()),this.transformMatrix(a);const l=this.vertices.getValue();for(let i=0,u=this.vertexCount;i<u;i+=3){const u=4*i;if(e.x=l[u],e.y=l[u+1],e.z=l[u+2],t.x=l[u+4],t.y=l[u+5],t.z=l[u+6],n.x=l[u+8],n.y=l[u+9],n.z=l[u+10],r.intersectsTriangle(e,t,n)){if(o.length){if(this.isClipped(a.multVecMatrix(s.assign(e)),o))continue;if(this.isClipped(a.multVecMatrix(s.assign(t)),o))continue;if(this.isClipped(a.multVecMatrix(s.assign(n)),o))continue}return!0}}}return!1}}(),set_live__(){this.getLive().getValue()?this.getBrowser().getBrowserOptions()._Shading.addInterest("set_shading__",this):this.getBrowser().getBrowserOptions()._Shading.removeInterest("set_shading__",this)},set_shading__:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new Et(0,0,0);return function(s){const r=this.getBrowser(),o=r.getContext();if(this.geometryType<2)o.bindBuffer(o.ARRAY_BUFFER,this.normalBuffer),o.bufferData(o.ARRAY_BUFFER,this.normals.getValue(),o.DYNAMIC_DRAW);else{const s=r.getBrowserOptions().getShading()===xl.FLAT;if(s===this.flatShading)return;if(this.flatShading=s,s&&!this.flatNormals.length){const s=this.frontFace===o.CW,r=this.flatNormals,a=this.vertices.getValue();for(let o=0,l=a.length;o<l;o+=12)da.normal(e.set(a[o],a[o+1],a[o+2]),t.set(a[o+4],a[o+5],a[o+6]),n.set(a[o+8],a[o+9],a[o+10]),i),s&&i.negate(),r.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z);r.shrinkToFit()}o.bindBuffer(o.ARRAY_BUFFER,this.normalBuffer),o.bufferData(o.ARRAY_BUFFER,s?this.flatNormals.getValue():this.normals.getValue(),o.DYNAMIC_DRAW)}}}(),requestRebuild(){this._rebuild.addEvent()},rebuild:function(){const e=new Et(0,0,0);return function(){this.clear(),this.build();for(const e of this.attribArrays)e.shrinkToFit();for(const e of this.multiTexCoords)e.shrinkToFit();this.fogDepths.shrinkToFit(),this.colors.shrinkToFit(),this.normals.shrinkToFit(),this.vertices.shrinkToFit();const t=this.min,n=this.max,i=this.vertices.getValue();if(i.length){if(t.x===Number.POSITIVE_INFINITY)for(let s=0,r=i.length;s<r;s+=4)e.set(i[s],i[s+1],i[s+2]),t.min(e),n.max(e);this.bbox.setExtents(t,n)}else this.bbox.setExtents(t.set(0,0,0),n.set(0,0,0));this._bbox_changed.addEvent();for(let e=0;e<5;++e)this.planes[e].set(e%2?t:n,yl[e]);0===this.multiTexCoords.length&&this.buildTexCoords(),this.transfer(),this.updateGeometryKey(),this.updateRenderFunctions()}}(),clear(){this.min.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.max.set(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);{const e=this.attribArrays;for(const t of e)t.length=0;const t=this.attribNodes.length;for(let n=e.length;n<t;++n)e[n]=wl.createArray();e.length=t}this.flatShading=void 0,this.fogDepths.length=0,this.colors.length=0,this.multiTexCoords.length=0,this.texCoords.length=0,this.normals.length=0,this.flatNormals.length=0,this.vertices.length=0},transfer(){const e=this.getBrowser().getContext();for(let t=this.attribBuffers.length,n=this.attribArrays.length;t<n;++t)this.attribBuffers.push(e.createBuffer());for(let t=0,n=this.attribArrays.length;t<n;++t)e.bindBuffer(e.ARRAY_BUFFER,this.attribBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.attribArrays[t].getValue(),e.DYNAMIC_DRAW);const t=this.hasFogCoords;e.bindBuffer(e.ARRAY_BUFFER,this.fogDepthBuffer),e.bufferData(e.ARRAY_BUFFER,this.fogDepths.getValue(),e.DYNAMIC_DRAW),this.hasFogCoords=!!this.fogDepths.length,this.hasFogCoords!==t&&this.updateVertexArrays();const n=this.colorMaterial;e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors.getValue(),e.DYNAMIC_DRAW),this.colorMaterial=!!this.colors.length,this.colorMaterial!==n&&this.updateVertexArrays();for(let t=0,n=this.multiTexCoords.length;t<n;++t)e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.multiTexCoords[t].getValue(),e.DYNAMIC_DRAW);const i=this.hasNormals;this.set_shading__(this.getBrowser().getBrowserOptions()._Shading),this.hasNormals=!!this.normals.length,this.hasNormals!==i&&this.updateVertexArrays(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices.getValue(),e.DYNAMIC_DRAW),this.vertexCount=this.vertices.length/4},updateGeometryKey(){this.geometryKey="",this.geometryKey+=this.geometryType,this.geometryKey+=this.hasFogCoords?"1":"0",this.geometryKey+=this.colorMaterial?"1":"0",this.geometryKey+=this.hasNormals?"1":"0"},updateRenderFunctions(){this.vertexCount?(delete this.displaySimple,delete this.display,delete this.displaySimpleParticles,delete this.displayParticles):(this.displaySimple=Function.prototype,this.display=Function.prototype,this.displaySimpleParticles=Function.prototype,this.displayParticles=Function.prototype)},traverse(e,t){},displaySimple(e,t,n){this.vertexArrayObject.enable(n)&&(this.multiTexCoords.length&&n.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),this.hasNormals&&n.enableNormalAttribute(e,this.normalBuffer,0,0),n.enableVertexAttribute(e,this.vertexBuffer,0,0)),e.drawArrays(this.primitiveMode,0,this.vertexCount)},display(e,t){const n=t.appearanceNode,i=n.getShader(this,t);if(this.solid||!n.getBackMaterial()||this.getBrowser().getWireframe())this.displayGeometry(e,t,n,i,!0,!0);else{const s=n.getBackShader(this,t);this.displayGeometry(e,t,n,s,!0,!1),this.displayGeometry(e,t,n,i,!1,!0)}},displayGeometry(e,t,n,i,s,r){const o=this.getBrowser(),a=n.getBlendMode(),l=this.attribNodes,u=this.attribBuffers,h=o.getPrimitiveMode(this.primitiveMode);if(a?.enable(e),i.enable(e),i.setUniforms(e,this,t,r),this.vertexArrayObject.enable(i)){for(let t=0,n=l.length;t<n;++t)l[t].enable(e,i,u[t]);this.hasFogCoords&&i.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(e,this.colorBuffer,0,0),i.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),i.enableNormalAttribute(e,this.normalBuffer,0,0),i.enableVertexAttribute(e,this.vertexBuffer,0,0)}if(o.getWireframe())for(let t=0,n=this.vertexCount;t<n;t+=3)e.drawArrays(h,t,3);else{const n=_n.prototype.determinant3.call(t.modelViewMatrix)>0;e.frontFace(n?this.frontFace:this.backFace.get(this.frontFace)),t.transparent||s!==r?(e.enable(e.CULL_FACE),s&&!this.solid&&(e.cullFace(e.FRONT),e.drawArrays(h,0,this.vertexCount)),r&&(e.cullFace(e.BACK),e.drawArrays(h,0,this.vertexCount))):(this.solid?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.drawArrays(h,0,this.vertexCount))}a?.disable(e)},displaySimpleParticles(e,t,n){const i=n.outputParticles;if(i.vertexArrayObject.update(this.updateParticles).enable(t)){const{particleStride:s,particleOffset:r,matrixOffset:o}=n;t.enableParticleAttribute(e,i,s,r,1),t.enableParticleMatrixAttribute(e,i,s,o,1),t.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),t.enableNormalAttribute(e,this.normalBuffer,0,0),t.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}e.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,n.numParticles)},displayParticles(e,t,n){const i=t.appearanceNode,s=i.getShader(this,t);if(this.solid||!i.getBackMaterial()||this.getBrowser().getWireframe())this.displayParticlesGeometry(e,t,i,s,!0,!0,n);else{const r=i.getBackShader(this,t);this.displayParticlesGeometry(e,t,i,r,!0,!1,n),this.displayParticlesGeometry(e,t,i,s,!1,!0,n)}},displayParticlesGeometry(e,t,n,i,s,r,o){const a=this.getBrowser(),l=n.getBlendMode(),u=this.attribNodes,h=this.attribBuffers,c=a.getPrimitiveMode(this.primitiveMode);l?.enable(e),i.enable(e),i.setUniforms(e,this,t,r);const d=o.outputParticles;if(d.vertexArrayObject.update(this.updateParticles).enable(i)){const{particleStride:t,particleOffset:n,matrixOffset:s}=o;i.enableParticleAttribute(e,d,t,n,1),i.enableParticleMatrixAttribute(e,d,t,s,1);for(let t=0,n=u.length;t<n;++t)u[t].enable(e,i,h[t]);this.hasFogCoords&&i.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(e,this.colorBuffer,0,0),i.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),i.enableNormalAttribute(e,this.normalBuffer,0,0),i.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}const p=_n.prototype.determinant3.call(t.modelViewMatrix)>0;e.frontFace(p?this.frontFace:this.backFace.get(this.frontFace)),t.transparent||s!==r?(e.enable(e.CULL_FACE),s&&!this.solid&&(e.cullFace(e.FRONT),e.drawArraysInstanced(c,0,this.vertexCount,o.numParticles)),r&&(e.cullFace(e.BACK),e.drawArraysInstanced(c,0,this.vertexCount,o.numParticles))):(this.solid?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.drawArraysInstanced(c,0,this.vertexCount,o.numParticles)),l?.disable(e)}}),Object.defineProperties(wl,{typeName:{value:"X3DGeometryNode",enumerable:!0},componentName:{value:"Rendering",enumerable:!0}});const bl=wl;n.set("x_ite/Components/Rendering/X3DGeometryNode",bl);const Sl=bl;let vl=0;const Tl={AUTO:vl++,OPAQUE:vl++,MASK:vl++,BLEND:vl++};n.set("x_ite/Browser/Shape/AlphaMode",Tl);const Ol=Tl;function El(e={}){Object.assign(this,{alphaMode:Ol.OPAQUE,geometryType:3,hasFogCoords:!1,colorMaterial:!1,hasNormals:!1,textureNode:!1,objectsCount:[0,0,0],textureCoordinateMapping:new Map,textureCoordinateNode:null},e),this.updateGeometryKey()}Object.assign(El.prototype,{updateGeometryKey:Sl.prototype.updateGeometryKey,getTextureCoordinateMapping(){return this.textureCoordinateMapping},getTextureCoordinate(){return this.textureCoordinateNode}});const Cl=El;n.set("x_ite/Browser/Rendering/GeometryContext",Cl);const Nl=Cl;function Fl(e=0){this.value=e}Object.assign(Fl.prototype,{*[Symbol.iterator](){let e=this.value,t=0;for(;e;)1&e&&(yield t),e>>>=1,t+=1},get(e){const t=1<<e;return!!(this.value&t)},set(e,t){const n=1<<e;t?this.value|=n:this.value&=~n},clear(){this.value=0},*entries(){for(const e of this)yield[e,e]},valueOf(){return this.value},toString(e){return this.value.toString(e)}}),Fl.prototype.keys=Fl.prototype[Symbol.iterator],Fl.prototype.values=Fl.prototype[Symbol.iterator],Object.defineProperty(Fl.prototype,"size",{get(){return f.bitCount(this.value)}});const Il=Fl;n.set("standard/Utility/BitSet",Il);const Ml=Il,Pl=Math.SQRT2/2;function Dl(e){nr.call(this,e),this.addType(c.X3DBackgroundNode),this._skyAngle.setUnit("angle"),this._groundAngle.setUnit("angle"),this.hidden=!1,this.projectionMatrixArray=new Float32Array(16),this.modelMatrix=new _n,this.modelViewMatrixArray=new Float32Array(16),this.clipPlanes=[],this.colors=[],this.sphere=[],this.textureNodes=new Array(6),this.textureBits=new Ml,this.sphereContext=new Nl({colorMaterial:!0}),this.sphereAlphaContext=new Nl({colorMaterial:!0,alphaMode:Ol.BLEND}),this.texturesContext=new Nl({textureNode:!0}),this.texturesAlphaContext=new Nl({textureNode:!0,alphaMode:Ol.BLEND})}Object.assign(Object.setPrototypeOf(Dl.prototype,nr.prototype),{initialize(){nr.prototype.initialize.call(this);const e=this.getBrowser().getContext();this.colorBuffer=e.createBuffer(),this.sphereBuffer=e.createBuffer(),this.texCoordBuffers=[e.createBuffer()],this.textureBuffers=Array.from({length:6},(()=>e.createBuffer())),this.sphereArrayObject=new fl(e),this.textureArrayObjects=Array.from({length:6},(()=>new fl(e))),this._groundAngle.addInterest("build",this),this._groundColor.addInterest("build",this),this._skyAngle.addInterest("build",this),this._skyColor.addInterest("build",this),this.build(),this.transferRectangle()},isHidden(){return this.hidden},setHidden(e){this.hidden=e,this.getBrowser().addBrowserEvent()},isTransparent(){if(this.hidden)return!0;if(this._transparency.getValue()<=0)return!1;if(6!==this.textureBits.size)return!0;for(const e of this.textureBits)if(this.textureNodes[e]._transparent.getValue())return!0;return!1},set_texture__(e,t){this.textureNodes[t]?._loadState.removeInterest("set_loadState__",this),this.textureNodes[t]=e,e?._loadState.addInterest("set_loadState__",this,e,t),this.set_loadState__(e,t)},set_loadState__(e,t){this.setTextureBit(t,e,e?.checkLoadState()??c.NOT_STARTED)},setTextureBit(e,t,n){this.textureBits.set(e,n===c.COMPLETE_STATE||t?.getWidth())},getColor:(e,t,n)=>t[f.upperBound(n,0,n.length,e)],build(){const e=Pl;if(this.colors.length=0,this.sphere.length=0,0===this._groundColor.length&&1==this._skyColor.length){this.sphere.vertices=36,this.sphere.push(e,e,-e,1,-e,e,-e,1,-e,-e,-e,1,e,e,-e,1,-e,-e,-e,1,e,-e,-e,1,-e,e,e,1,e,e,e,1,-e,-e,e,1,-e,-e,e,1,e,e,e,1,e,-e,e,1,-e,e,-e,1,-e,e,e,1,-e,-e,e,1,-e,e,-e,1,-e,-e,e,1,-e,-e,-e,1,e,e,e,1,e,e,-e,1,e,-e,e,1,e,-e,e,1,e,e,-e,1,e,-e,-e,1,e,e,e,1,-e,e,e,1,-e,e,-e,1,e,e,e,1,-e,e,-e,1,e,e,-e,1,-e,-e,e,1,e,-e,e,1,-e,-e,-e,1,-e,-e,-e,1,e,-e,e,1,e,-e,-e,1);const t=this._skyColor[0];for(let e=0,n=this.sphere.vertices;e<n;++e)this.colors.push(...t,1)}else{if(this._skyColor.length>this._skyAngle.length){const e=this._skyAngle.slice();(0===e.length||e[0]>0)&&e.unshift(0),e.at(-1)<Math.PI&&e.push(Math.PI),2===e.length&&e.splice(1,0,(e[0]+e[1])/2),this.buildSphere(1,e,this._skyAngle,this._skyColor,!1)}if(this._groundColor.length>this._groundAngle.length){const e=this._groundAngle.slice().reverse();(0===e.length||e[0]<Math.PI/2)&&e.unshift(Math.PI/2),e.at(-1)>0&&e.push(0),this.buildSphere(1,e,this._groundAngle,this._groundColor,!0)}}this.transferSphere()},buildSphere:function(){const e=new Ro(0,0),t=new Ro(0,0),n=new Ro(0,0),i=new Ro(0,0),s=new Ro(0,0),r=new Ro(0,0);return function(o,a,l,u,h){const c=h?Math.PI/2:Math.PI,d=a.length-1;for(let p=0;p<d;++p){let d=f.clamp(a[p],0,c),g=f.clamp(a[p+1],0,c);h&&(d=Math.PI-d,g=Math.PI-g),e.setPolar(o,d),t.setPolar(o,g);const m=this.getColor(a[p],u,l),_=this.getColor(a[p+1],u,l);for(let o=0;o<20;++o){const a=o<19?o+1:0;let l=2*Math.PI*(o/20);n.setPolar(-e.imag,l),i.setPolar(-t.imag,l),l=2*Math.PI*(a/20),s.setPolar(-t.imag,l),r.setPolar(-e.imag,l),this.colors.push(...m,1,..._,1,..._,1,...m,1,...m,1,..._,1),this.sphere.push(n.imag,e.real,n.real,1,s.imag,t.real,s.real,1,i.imag,t.real,i.real,1,n.imag,e.real,n.real,1,r.imag,e.real,r.real,1,s.imag,t.real,s.real,1)}}}}(),transferSphere(){const e=this.getBrowser().getContext();e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.colors),e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.sphereBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sphere),e.DYNAMIC_DRAW),this.sphereCount=this.sphere.length/4},transferRectangle:function(){const e=Pl,t=new Float32Array([1,1,0,1,0,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,1]),n=[new Float32Array([e,e,-e,1,-e,e,-e,1,-e,-e,-e,1,e,e,-e,1,-e,-e,-e,1,e,-e,-e,1]),new Float32Array([-e,e,e,1,e,e,e,1,e,-e,e,1,-e,e,e,1,e,-e,e,1,-e,-e,e,1]),new Float32Array([-e,e,-e,1,-e,e,e,1,-e,-e,e,1,-e,e,-e,1,-e,-e,e,1,-e,-e,-e,1]),new Float32Array([e,e,e,1,e,e,-e,1,e,-e,-e,1,e,e,e,1,e,-e,-e,1,e,-e,e,1]),new Float32Array([e,e,e,1,-e,e,e,1,-e,e,-e,1,e,e,e,1,-e,e,-e,1,e,e,-e,1]),new Float32Array([e,-e,-e,1,-e,-e,-e,1,-e,-e,e,1,e,-e,-e,1,-e,-e,e,1,e,-e,e,1])];return function(){const e=this.getBrowser().getContext();e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffers[0]),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW);for(let t=0;t<6;++t)e.bindBuffer(e.ARRAY_BUFFER,this.textureBuffers[t]),e.bufferData(e.ARRAY_BUFFER,n[t],e.DYNAMIC_DRAW)}}(),traverse(e,t){switch(e){case Na.CAMERA:return t.getLayer().getBackgrounds().push(this),void this.modelMatrix.assign(t.getModelViewMatrix().get());case Na.DISPLAY:{const e=t.getLocalObjects(),n=this.clipPlanes;let i=0;for(let t=0,s=e.length;t<s;++t)e[t].isClipped&&(n[i++]=e[t]);return n.length=i,this.sphereContext.objectsCount[0]=n.length,void(this.texturesContext.objectsCount[0]=n.length)}}},display:function(){const e=new _n,t=new dn,n=new Et(0,0,0);return function(i,s,r){this.hidden||(i.depthMask(!1),i.disable(i.DEPTH_TEST),i.enable(i.CULL_FACE),i.frontFace(i.CCW),this.projectionMatrixArray.set(s.getViewpoint().getProjectionMatrixWithLimits(.125,2e5,r)),e.assign(this.modelMatrix),e.multRight(s.getViewMatrix().get()),e.get(null,t),e.identity(),e.rotate(t),e.scale(n.set(1e5,1e5,1e5)),this.modelViewMatrixArray.set(e),this.drawSphere(s),+this.textureBits&&this.drawCube(s))}}(),drawSphere(e){const t=f.clamp(this._transparency.getValue(),0,1);if(1===t)return;const n=this.getBrowser(),i=n.getContext(),s=n.getDefaultMaterial().getShader(t?this.sphereAlphaContext:this.sphereContext);s.enable(i),s.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(s.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(s.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniform1f(s.x3d_Transparency,t),i.uniform1i(s.x3d_TextureCoordinateGeneratorMode[0],0),this.sphereArrayObject.enable(s)&&(s.enableColorAttribute(i,this.colorBuffer,0,0),s.enableVertexAttribute(i,this.sphereBuffer,0,0)),t?i.enable(i.BLEND):i.disable(i.BLEND),i.drawArrays(i.TRIANGLES,0,this.sphereCount)},drawCube:function(){const e=new Float32Array(_n.Identity);return function(t){const n=this.getBrowser(),i=n.getContext(),s=n.getDefaultMaterial().getShader(this.texturesContext),r=n.getDefaultMaterial().getShader(this.texturesAlphaContext);s.enable(i),s.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(s.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(s.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniformMatrix4fv(s.x3d_TextureMatrix[0],!1,e),i.uniform3f(s.x3d_EmissiveColor,1,1,1),i.uniform1f(s.x3d_Transparency,0),i.uniform1i(s.x3d_TextureCoordinateGeneratorMode[0],0);for(const e of this.textureBits){const o=this.textureNodes[e];this.drawRectangle(i,n,o._transparent.getValue()?r:s,t,o,this.textureBuffers[e],this.textureArrayObjects[e])}}}(),drawRectangle(e,t,n,i,s,r,o){s.setShaderUniforms(e,n,i),o.enable(e,n)&&(n.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),n.enableVertexAttribute(e,r,0,0)),s._transparent.getValue()?e.enable(e.BLEND):e.disable(e.BLEND),e.drawArrays(e.TRIANGLES,0,6),t.resetTextureUnits()}}),Object.defineProperties(Dl,{typeName:{value:"X3DBackgroundNode",enumerable:!0},componentName:{value:"EnvironmentalEffects",enumerable:!0}});const Rl=Dl;n.set("x_ite/Components/EnvironmentalEffects/X3DBackgroundNode",Rl);const Al=Rl;function Vl(e){vs.call(this,e),this.addType(c.X3DAppearanceChildNode)}Object.setPrototypeOf(Vl.prototype,vs.prototype),Object.defineProperties(Vl,{typeName:{value:"X3DAppearanceChildNode",enumerable:!0},componentName:{value:"Shape",enumerable:!0}});const Ll=Vl;n.set("x_ite/Components/Shape/X3DAppearanceChildNode",Ll);const Bl=Ll;function Ul(e){Bl.call(this,e),this.addType(c.X3DTextureNode),this.addChildObjects("transparent",new Qi.SFBool),this._transparent.setAccessType(c.outputOnly)}Object.assign(Object.setPrototypeOf(Ul.prototype,Bl.prototype),{setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()}}),Object.defineProperties(Ul,{typeName:{value:"X3DTextureNode",enumerable:!0},componentName:{value:"Texturing",enumerable:!0}});const Xl=Ul;n.set("x_ite/Components/Texturing/X3DTextureNode",Xl);const jl=Xl;const kl=function(e,t,n=!0){try{if(t&&(t instanceof Qi.SFNode&&(t=t.getValue()),t&&(n&&(t=t.getInnerNode()),t.getType().includes(e))))return t}catch{}return null};n.set("x_ite/Base/X3DCast",kl);const zl=kl;function Gl(e){jl.call(this,e),this.addType(c.X3DSingleTextureNode)}Object.assign(Object.setPrototypeOf(Gl.prototype,jl.prototype),{initialize(){jl.prototype.initialize.call(this),this._textureProperties.addInterest("set_textureProperties__",this,!0);const e=this.getBrowser().getContext();this.texture=e.createTexture(),this.set_textureProperties__(!1)},set_textureProperties__(e){this.texturePropertiesNode&&this.texturePropertiesNode.removeInterest("updateTextureParameters",this),this.texturePropertiesNode=zl(c.TextureProperties,this._textureProperties),this.texturePropertiesNode||(this.texturePropertiesNode=this.getBrowser().getDefaultTextureProperties()),this.texturePropertiesNode.addInterest("updateTextureParameters",this),e&&this.updateTextureParameters()},getCount:()=>1,getTexture(){return this.texture},updateTextureParameters:function(){const e=["EXT_texture_filter_anisotropic","MOZ_EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"];return function(t,n,i,s,r,o,a,l){const u=this.getBrowser().getContext();u.bindTexture(t,this.getTexture()),Math.max(s,r)<this.getBrowser().getMinTextureSize()&&!n?(u.texParameteri(t,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(t,u.TEXTURE_MAG_FILTER,u.NEAREST)):(i._generateMipMaps.getValue()&&u.generateMipmap(t),u.texParameteri(t,u.TEXTURE_MIN_FILTER,u[i.getMinificationFilter()]),u.texParameteri(t,u.TEXTURE_MAG_FILTER,u[i.getMagnificationFilter()])),n?(u.texParameteri(t,u.TEXTURE_WRAP_S,u[i.getBoundaryModeS()]),u.texParameteri(t,u.TEXTURE_WRAP_T,u[i.getBoundaryModeT()]),u.getVersion()>=2&&u.texParameteri(t,u.TEXTURE_WRAP_R,u[i.getBoundaryModeR()])):(u.texParameteri(t,u.TEXTURE_WRAP_S,o?u.REPEAT:u.CLAMP_TO_EDGE),u.texParameteri(t,u.TEXTURE_WRAP_T,a?u.REPEAT:u.CLAMP_TO_EDGE),u.getVersion()>=2&&u.texParameteri(t,u.TEXTURE_WRAP_R,l?u.REPEAT:u.CLAMP_TO_EDGE));for(const n of e){const e=u.getExtension(n);if(e){u.texParameterf(t,e.TEXTURE_MAX_ANISOTROPY_EXT,i._anisotropicDegree.getValue());break}}}}(),updateTextureBits(e,t=0){const n=this.getTextureType()-1;e.set(2*t+0,1&n),e.set(2*t+1,2&n)},getShaderOptions:function(){const e={2:"2D",3:"3D",4:"CUBE"};return function(t,n=0){t.push(`X3D_TEXTURE${n}_${e[this.getTextureType()]}`)}}()}),Object.defineProperties(Gl,{typeName:{value:"X3DSingleTextureNode",enumerable:!0},componentName:{value:"Texturing",enumerable:!0}});const Hl=Gl;n.set("x_ite/Components/Texturing/X3DSingleTextureNode",Hl);const ql=Hl,Yl=new Uint8Array([255,255,255,255]);function Wl(e){ql.call(this,e),this.addType(c.X3DTexture2DNode);const t=this.getBrowser().getContext();this.target=t.TEXTURE_2D,this.width=0,this.height=0}Object.assign(Object.setPrototypeOf(Wl.prototype,ql.prototype),{initialize(){ql.prototype.initialize.call(this),this._repeatS.addInterest("updateTextureParameters",this),this._repeatT.addInterest("updateTextureParameters",this);const e=this.getBrowser().getContext();e.bindTexture(e.TEXTURE_2D,this.getTexture()),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Yl)},getTarget(){return this.target},getTextureType:()=>2,getTextureTypeString:()=>"2D",getWidth(){return this.width},getHeight(){return this.height},clearTexture(){this.setTexture(1,1,!1,Yl,!1)},setTexture(e,t,n,i,s){this.width=e,this.height=t;const r=this.getBrowser().getContext();r.bindTexture(r.TEXTURE_2D,this.getTexture()),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,i),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),this.setTransparent(n),this.updateTextureParameters(),this.addNodeEvent()},updateTexture(e,t){const n=this.getBrowser().getContext();n.bindTexture(n.TEXTURE_2D,this.getTexture()),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),this.texturePropertiesNode._generateMipMaps.getValue()&&n.generateMipmap(n.TEXTURE_2D),this.addNodeEvent()},updateTextureParameters(){ql.prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,this.width,this.height,this._repeatS.getValue(),this._repeatT.getValue(),!1)},setShaderUniforms(e,t,n,i=t.x3d_Texture[0]){const s=this.getBrowser().getTexture2DUnit();e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,this.getTexture()),e.uniform1i(i.texture2D,s)}}),Object.defineProperties(Wl,{typeName:{value:"X3DTexture2DNode",enumerable:!0},componentName:{value:"Texturing",enumerable:!0}});const $l=Wl;n.set("x_ite/Components/Texturing/X3DTexture2DNode",$l);const Kl=$l;var Jl=i(666);function Zl(e){Kl.call(this,e),Rr.call(this,e),this.addType(c.ImageTexture),this.image=Jl("<img></img>"),this.urlStack=new Qi.MFString}Object.assign(Object.setPrototypeOf(Zl.prototype,Kl.prototype),Rr.prototype,{initialize(){Kl.prototype.initialize.call(this),Rr.prototype.initialize.call(this),this.image.on("load",this.setImage.bind(this)),this.image.on("abort error",this.setError.bind(this)),this.image.prop("crossOrigin","Anonymous"),this.requestImmediateLoad().catch(Function.prototype)},getElement(){return this.image[0]},unloadData(){this.clearTexture()},loadData(){this.urlStack.setValue(this._url),this.loadNext()},loadNext(){if(0===this.urlStack.length)return this.clearTexture(),void this.setLoadState(c.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.image.attr("src",this.URL.href)},setError(e){"data:"!==this.URL.protocol&&console.warn(`Error loading image '${decodeURI(this.URL.href)}'`,e.type),this.loadNext()},setImage:async function(){try{const e=this.getBrowser().getContext(),t=this.image[0];if(1!==e.getVersion()||f.isPowerOfTwo(t.width)&&f.isPowerOfTwo(t.height)){const e=await this.getImageData(t),n=this.isImageTransparent(e),i=t.width,s=t.height;this.flipImage(e,i,s,4),this.setTexture(i,s,n,e,!1),this.setLoadState(c.COMPLETE_STATE)}else{const e=document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0}),i=f.nextPowerOfTwo(t.width),s=f.nextPowerOfTwo(t.height);e.width=i,e.height=s,n.clearRect(0,0,i,s),n.save(),n.translate(0,s),n.scale(1,-1),n.drawImage(t,0,0,t.width,t.height,0,0,i,s),n.restore();const r=n.getImageData(0,0,i,s).data,o=this.isImageTransparent(r);this.setTexture(i,s,o,r,!1),this.setLoadState(c.COMPLETE_STATE)}}catch(e){this.setError({type:e.message})}},getImageData:async function(e){const t=this.getBrowser().getContext(),n=t.createFramebuffer(),i=t.createTexture(),s=new Uint8Array(e.width*e.height*4);return t.bindFramebuffer(t.FRAMEBUFFER,n),t.bindTexture(t.TEXTURE_2D,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),await t.readPixelsAsync(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,s),t.deleteFramebuffer(n),t.deleteTexture(i),s},isImageTransparent(e){for(let t=3,n=e.length;t<n;t+=4)if(255!==e[t])return!0;return!1},flipImage(e,t,n,i){const s=n>>>1,r=t*i,o=new Uint8Array(r);for(let t=0;t<s;++t){const i=t*r,s=(n-t-1)*r;o.set(e.subarray(i,i+r)),e.copyWithin(i,s,s+r),e.set(o,s)}return e},dispose(){Rr.prototype.dispose.call(this),Kl.prototype.dispose.call(this)}}),Object.defineProperties(Zl,{typeName:{value:"ImageTexture",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600)),new H(c.initializeOnly,"repeatS",new Qi.SFBool(!0)),new H(c.initializeOnly,"repeatT",new Qi.SFBool(!0)),new H(c.initializeOnly,"textureProperties",new Qi.SFNode)]),enumerable:!0}});const Ql=Zl;n.set("x_ite/Components/Texturing/ImageTexture",Ql);const eu=Ql;function tu(e){Al.call(this,e),this.addType(c.Background)}Object.assign(Object.setPrototypeOf(tu.prototype,Al.prototype),{initialize(){Al.prototype.initialize.call(this);const e=new eu(this.getExecutionContext()),t=new eu(this.getExecutionContext()),n=new eu(this.getExecutionContext()),i=new eu(this.getExecutionContext()),s=new eu(this.getExecutionContext()),r=new eu(this.getExecutionContext()),o=this.getBrowser().getBackgroundTextureProperties();this._frontUrl.addFieldInterest(e._url),this._backUrl.addFieldInterest(t._url),this._leftUrl.addFieldInterest(n._url),this._rightUrl.addFieldInterest(i._url),this._topUrl.addFieldInterest(s._url),this._bottomUrl.addFieldInterest(r._url),e._url=this._frontUrl,t._url=this._backUrl,n._url=this._leftUrl,i._url=this._rightUrl,s._url=this._topUrl,r._url=this._bottomUrl,e._textureProperties=o,t._textureProperties=o,n._textureProperties=o,i._textureProperties=o,s._textureProperties=o,r._textureProperties=o,e.setup(),t.setup(),n.setup(),i.setup(),s.setup(),r.setup(),this.set_texture__(e,0),this.set_texture__(t,1),this.set_texture__(n,2),this.set_texture__(i,3),this.set_texture__(s,4),this.set_texture__(r,5)}}),Object.defineProperties(tu,{typeName:{value:"Background",enumerable:!0},componentName:{value:"EnvironmentalEffects",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_bind",new Qi.SFBool),new H(c.inputOutput,"frontUrl",new Qi.MFString),new H(c.inputOutput,"backUrl",new Qi.MFString),new H(c.inputOutput,"leftUrl",new Qi.MFString),new H(c.inputOutput,"rightUrl",new Qi.MFString),new H(c.inputOutput,"topUrl",new Qi.MFString),new H(c.inputOutput,"bottomUrl",new Qi.MFString),new H(c.inputOutput,"skyAngle",new Qi.MFFloat),new H(c.inputOutput,"skyColor",new Qi.MFColor(new Qi.SFColor)),new H(c.inputOutput,"groundAngle",new Qi.MFFloat),new H(c.inputOutput,"groundColor",new Qi.MFColor),new H(c.inputOutput,"transparency",new Qi.SFFloat),new H(c.outputOnly,"isBound",new Qi.SFBool),new H(c.outputOnly,"bindTime",new Qi.SFTime)]),enumerable:!0}});const nu=tu;n.set("x_ite/Components/EnvironmentalEffects/Background",nu);const iu=nu;function su(e,t,n){vs.call(this,e),qa.call(this,e),this.addType(c.X3DLayerNode),e.getSpecificationVersion()<4&&this.addAlias("isPickable",this._pickable),this.groupNode=n,this.viewportNode=null,this.defaultNavigationInfo=new nl(e),this.defaultViewpoint=t,this.defaultBackground=new iu(e),this.defaultFog=new dl(e),this.navigationInfoStack=new $a(e,this.defaultNavigationInfo),this.viewpointStack=new $a(e,this.defaultViewpoint),this.backgroundStack=new $a(e,this.defaultBackground),this.fogStack=new $a(e,this.defaultFog),this.navigationInfos=new Za(e,this.defaultNavigationInfo),this.viewpoints=new Za(e,this.defaultViewpoint),this.backgrounds=new Za(e,this.defaultBackground),this.fogs=new Za(e,this.defaultFog),this.defaultBackground.setHidden(!0),this.defaultFog.setHidden(!0)}Object.assign(Object.setPrototypeOf(su.prototype,vs.prototype),qa.prototype,{layer0:!1,initialize(){vs.prototype.initialize.call(this),qa.prototype.initialize.call(this),this.defaultNavigationInfo.setup(),this.defaultViewpoint.setup(),this.defaultBackground.setup(),this.defaultFog.setup(),this.navigationInfoStack.setup(),this.viewpointStack.setup(),this.backgroundStack.setup(),this.fogStack.setup(),this.navigationInfos.setup(),this.viewpoints.setup(),this.backgrounds.setup(),this.fogs.setup(),this._viewport.addInterest("set_viewport__",this),this.set_viewport__()},isLayer0(e){this.layer0=e,this.defaultBackground.setHidden(!e)},getLayer(){return this},getBBox(e,t){return this.groupNode.getBBox(e,t)},getGroup(){return this.groupNode},setGroup(e){this.groupNode=e},getViewport(){return this.viewportNode},getBackground(){return this.backgroundStack.top()},getFog(){return this.fogStack.top()},getNavigationInfo(){return this.navigationInfoStack.top()},getViewpoint(){return this.viewpointStack.top()},getBackgrounds(){return this.backgrounds},getFogs(){return this.fogs},getNavigationInfos(){return this.navigationInfos},getViewpoints(){return this.viewpoints},getUserViewpoints(){const e=[];for(const t of this.viewpoints.get())t._description.length&&e.push(t);return e},getBackgroundStack(){return this.backgroundStack},getFogStack(){return this.fogStack},getNavigationInfoStack(){return this.navigationInfoStack},getViewpointStack(){return this.viewpointStack},getCollisionTime(){return this.collisionTime},viewAll(e=1,t=!1){const n=this.getViewpoint(),i=this.getBBox(new La).multRight(n.getModelMatrix().copy().inverse());n.lookAt(this,i.center,n.getLookAtDistance(i),e,t)},straightenView(){this.getViewpoint().straightenView(this)},set_viewport__(){this.viewportNode=zl(c.X3DViewportNode,this._viewport),this.viewportNode||(this.viewportNode=this.getBrowser().getDefaultViewport())},bindBindables(e){this.traverse(Na.CAMERA,this);const t=this.navigationInfos.getBound(),n=this.backgrounds.getBound(),i=this.fogs.getBound(),s=this.viewpoints.getBound(e);this.navigationInfoStack.pushOnTop(t),this.viewpointStack.pushOnTop(s),this.backgroundStack.pushOnTop(n),this.fogStack.pushOnTop(i),s.resetUserOffsets(),s._viewAll.getValue()&&s.viewAll(this.getBBox(new La))},traverse(e,t=this){const n=this.getViewpoint();switch(this.getProjectionMatrix().pushMatrix(n.getProjectionMatrix(this)),this.getCameraSpaceMatrix().pushMatrix(n.getCameraSpaceMatrix()),this.getViewMatrix().pushMatrix(n.getViewMatrix()),e){case Na.POINTER:this.pointer(e,t);break;case Na.CAMERA:this.camera(e,t);break;case Na.PICKING:this.picking(e,t);break;case Na.COLLISION:this.collision(e,t);break;case Na.SHADOW:case Na.DISPLAY:this.display(e,t)}this.getViewMatrix().pop(),this.getCameraSpaceMatrix().pop(),this.getProjectionMatrix().pop()},pointer(e,t){const n=this.getBrowser(),i=this.viewportNode.getRectangle();if(n.getPointingLayer()){if(n.getPointingLayer()!==this)return}else if(!n.isPointerInRectangle(i))return;this.setHitRay(this.getProjectionMatrix().get(),i,n.getPointer()),this.getNavigationInfo().enable(e,t),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),t.render(e,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop()},camera(e,t){this._visible.getValue()&&(this.getModelViewMatrix().pushMatrix(_n.Identity),this.viewportNode.push(this),this.groupNode.traverse(e,t),this.viewportNode.pop(this),this.getModelViewMatrix().pop(),this.navigationInfos.update(this,this.navigationInfoStack),this.viewpoints.update(this,this.viewpointStack),this.backgrounds.update(this,this.backgroundStack),this.fogs.update(this,this.fogStack),this.getViewpoint().update())},picking(e,t){this._pickable.getValue()&&(this.getModelViewMatrix().pushMatrix(_n.Identity),this.viewportNode.push(this),this.groupNode.traverse(e,t),this.viewportNode.pop(this),this.getModelViewMatrix().pop())},collision:function(){const e=new _n;return function(t,n){if(this._visible.getValue()){const i=this.getNavigationInfo();if(i._transitionActive.getValue())return;const s=i.getCollisionRadius(),r=i.getAvatarHeight(),o=Math.max(2*s,2*r);Ra.ortho(-o,o,-o,o,-o,o,e),this.getProjectionMatrix().pushMatrix(e),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),n.render(t,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop(),this.getProjectionMatrix().pop()}}}(),display(e,t){this._visible.getValue()&&(this.getNavigationInfo().enable(e,t),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),t.render(e,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop())}}),Object.defineProperties(su,{typeName:{value:"X3DLayerNode",enumerable:!0},componentName:{value:"Layering",enumerable:!0}});const ru=su;n.set("x_ite/Components/Layering/X3DLayerNode",ru);const ou=ru;function au(e){Ys.call(this,e),this.addType(c.X3DSensorNode)}Object.setPrototypeOf(au.prototype,Ys.prototype),Object.defineProperties(au,{typeName:{value:"X3DSensorNode",enumerable:!0},componentName:{value:"Core",enumerable:!0}});const lu=au;n.set("x_ite/Components/Core/X3DSensorNode",lu);const uu=lu;function hu(e){this.addType(c.X3DTimeDependentNode),this.addChildObjects("initialized",new Qi.SFTime,"isEvenLive",new Qi.SFBool),this.startTimeValue=0,this.pauseTimeValue=0,this.resumeTimeValue=0,this.stopTimeValue=0,this.start=0,this.pause=0,this.pauseInterval=0,this.timeouts=new Map,this.disabled=!1}Object.assign(Object.setPrototypeOf(hu.prototype,Ys.prototype),{initialize(){this.getLive().addInterest("set_live__",this),this._isEvenLive.addInterest("set_live__",this),this._initialized.addInterest("set_loop__",this),this._enabled.addInterest("set_enabled__",this),this._loop.addInterest("set_loop__",this),this._startTime.addInterest("set_startTime__",this),this._pauseTime.addInterest("set_pauseTime__",this),this._resumeTime.addInterest("set_resumeTime__",this),this._stopTime.addInterest("set_stopTime__",this),this.startTimeValue=this._startTime.getValue(),this.pauseTimeValue=this._pauseTime.getValue(),this.resumeTimeValue=this._resumeTime.getValue(),this.stopTimeValue=this._stopTime.getValue(),this._initialized=this.getBrowser().getCurrentTime()},getDisabled(){return this.disabled},getLiveState(){return this.isLive()&&(this.getExecutionContext().getLive().getValue()||this._isEvenLive.getValue())},getElapsedTime(){return this.getBrowser().getCurrentTime()-this.start-this.pauseInterval},resetElapsedTime(){this.start=this.getBrowser().getCurrentTime(),this.pause=this.getBrowser().getCurrentTime(),this.pauseInterval=0},set_live__(){this.getLive().getValue()||this._isEvenLive.getValue()?this.disabled&&(this.disabled=!1,this._isActive.getValue()&&!this._isPaused.getValue()&&this.real_resume()):this.disabled||!this._isActive.getValue()||this._isPaused.getValue()||(this.disabled=!0,this.real_pause())},set_enabled__(){this._enabled.getValue()?this.set_loop__():this.stop()},set_loop__(){this._enabled.getValue()&&this._loop.getValue()&&this.stopTimeValue<=this.startTimeValue&&this.startTimeValue<=this.getBrowser().getCurrentTime()&&this.do_start(),this.set_loop()},set_startTime__(){this.startTimeValue=this._startTime.getValue(),this._enabled.getValue()&&(this.removeTimeout("start"),this.startTimeValue<=this.getBrowser().getCurrentTime()?this.do_start():this.addTimeout("start","do_start",this.startTimeValue))},set_pauseTime__(){if(this.pauseTimeValue=this._pauseTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("pause"),this.pauseTimeValue<=this.resumeTimeValue)return;this.pauseTimeValue<=this.getBrowser().getCurrentTime()?this.do_pause():this.addTimeout("pause","do_pause",this.pauseTimeValue)}},set_resumeTime__(){if(this.resumeTimeValue=this._resumeTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("resume"),this.resumeTimeValue<=this.pauseTimeValue)return;this.resumeTimeValue<=this.getBrowser().getCurrentTime()?this.do_resume():this.addTimeout("resume","do_resume",this.resumeTimeValue)}},set_stopTime__(){if(this.stopTimeValue=this._stopTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("stop"),this.stopTimeValue<=this.startTimeValue)return;this.stopTimeValue<=this.getBrowser().getCurrentTime()?this.do_stop():this.addTimeout("stop","do_stop",this.stopTimeValue)}},do_start(){this._isActive.getValue()||(this.resetElapsedTime(),this._isActive=!0,this._elapsedTime=0,this.set_start(),this.getLive().getValue()?this.getBrowser().timeEvents().addInterest("set_time",this):(this.disabled=!0,this.real_pause()))},do_pause(){this._isActive.getValue()&&!this._isPaused.getValue()&&(this._isPaused=!0,this.pauseTimeValue!==this.getBrowser().getCurrentTime()&&(this.pauseTimeValue=this.getBrowser().getCurrentTime()),this.getLive().getValue()&&this.real_pause())},real_pause(){this.pause=Date.now(),this.set_pause(),this.getBrowser().timeEvents().removeInterest("set_time",this)},do_resume(){this._isActive.getValue()&&this._isPaused.getValue()&&(this._isPaused=!1,this.resumeTimeValue!==this.getBrowser().getCurrentTime()&&(this.resumeTimeValue=this.getBrowser().getCurrentTime()),this.getLive().getValue()&&this.real_resume())},real_resume(){const e=(Date.now()-this.pause)/1e3;this.pauseInterval+=e,this.set_resume(e),this.getBrowser().timeEvents().addInterest("set_time",this),this.getBrowser().addBrowserEvent()},do_stop(){this.stop()},stop(){this._isActive.getValue()&&(this.set_stop(),this._elapsedTime=this.getElapsedTime(),this._isPaused.getValue()&&(this._isPaused=!1),this._isActive=!1,this.getBrowser().timeEvents().removeInterest("set_time",this))},addTimeout(e,t,n){this.removeTimeout(e),this.timeouts.set(e,setTimeout(this.processTimeout.bind(this,t),1e3*(n-this.getBrowser().getCurrentTime())))},removeTimeout(e){clearTimeout(this.timeouts.get(e)),this.timeouts.delete(e)},processTimeout(e){this._enabled.getValue()&&(this.getLive().getValue()||this._isEvenLive.getValue())&&(this.getBrowser().advanceTime(),this[e]())},set_loop:Function.prototype,set_start:Function.prototype,set_pause:Function.prototype,set_resume:Function.prototype,set_stop:Function.prototype,set_time:Function.prototype,dispose(){for(const e of[...this.timeouts.keys()])this.removeTimeout(e)}}),Object.defineProperties(hu,{typeName:{value:"X3DTimeDependentNode",enumerable:!0},componentName:{value:"Time",enumerable:!0}});const cu=hu;n.set("x_ite/Components/Time/X3DTimeDependentNode",cu);const du=cu;function pu(e){uu.call(this,e),du.call(this,e),this.addType(c.TimeSensor),this.addChildObjects("range",new Qi.MFFloat(0,0,1)),this.cycle=0,this.interval=0,this.fraction=0,this.first=0,this.last=1,this.scale=1}Object.assign(Object.setPrototypeOf(pu.prototype,uu.prototype),du.prototype,{initialize(){uu.prototype.initialize.call(this),du.prototype.initialize.call(this),this._cycleInterval.addInterest("set_cycleInterval__",this),this._range.addInterest("set_range__",this)},setRange(e,t,n){const i=this.getBrowser().getCurrentTime(),s=this._startTime.getValue(),r=this._cycleInterval.getValue();this.first=t,this.last=n,this.scale=this.last-this.first,this.interval=r*this.scale,this.fraction=f.fract((e>=1?0:e)+(this.interval?(i-s)/this.interval:0)),this.cycle=i-(this.fraction-this.first)*r},set_cycleInterval__(){this._isActive.getValue()&&this.setRange(this.fraction,this._range[1],this._range[2])},set_range__(){this._isActive.getValue()&&(this.setRange(this._range[0],this._range[1],this._range[2]),this._isPaused.getValue()||this.set_fraction(this.getBrowser().getCurrentTime()))},set_start(){this.setRange(this._range[0],this._range[1],this._range[2]),this.getLive().getValue()&&(this._fraction_changed=this.fraction,this._time=this.getBrowser().getCurrentTime())},set_resume(e){const t=this.getBrowser().getCurrentTime(),n=this._startTime.getValue();this.setRange(this.interval?f.fract(this.fraction-(t-n)/this.interval):0,this._range[1],this._range[2])},set_fraction(e){this._fraction_changed=this.fraction=this.first+(this.interval?f.fract((e-this.cycle)/this.interval):0)*this.scale},set_time(){const e=this.getBrowser().getCurrentTime();e-this.cycle>=this.interval?this._loop.getValue()?this.interval&&(this.cycle+=this.interval*Math.floor((e-this.cycle)/this.interval),this._elapsedTime=this.getElapsedTime(),this._cycleTime=e,this.set_fraction(e)):(this._fraction_changed=this.fraction=this.last,this.stop()):(this._elapsedTime=this.getElapsedTime(),this.set_fraction(e)),this._time=e},dispose(){du.prototype.dispose.call(this),uu.prototype.dispose.call(this)}}),Object.defineProperties(pu,{typeName:{value:"TimeSensor",enumerable:!0},componentName:{value:"Time",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"cycleInterval",new Qi.SFTime(1)),new H(c.inputOutput,"loop",new Qi.SFBool),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"cycleTime",new Qi.SFTime),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.outputOnly,"fraction_changed",new Qi.SFFloat),new H(c.outputOnly,"time",new Qi.SFTime)]),enumerable:!0}});const gu=pu;n.set("x_ite/Components/Time/TimeSensor",gu);const fu=gu;function mu(e){Ys.call(this,e),this.addType(c.X3DInterpolatorNode)}Object.assign(Object.setPrototypeOf(mu.prototype,Ys.prototype),{setup(){this.set_key__(),this._key.length&&this.interpolate(0,0,0),Ys.prototype.setup.call(this)},initialize(){Ys.prototype.initialize.call(this),this._set_fraction.addInterest("set_fraction__",this),this._key.addInterest("set_key__",this)},set_fraction__(){const e=this._key,t=e.length,n=this._set_fraction.getValue();switch(t){case 0:return;case 1:return this.interpolate(0,0,0);default:{if(n<=e[0])return this.interpolate(0,1,0);const i=f.upperBound(e,0,t,n);if(i!==t){const t=i-1,s=(n-e[t])/(e[i]-e[t]);this.interpolate(t,i,f.clamp(s,0,1))}else this.interpolate(t-2,t-1,1)}}},set_key__(){this.set_keyValue__()},set_keyValue__(){},interpolate(){}}),Object.defineProperties(mu,{typeName:{value:"X3DInterpolatorNode",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0}});const _u=mu;n.set("x_ite/Components/Interpolation/X3DInterpolatorNode",_u);const xu=_u;function yu(e){xu.call(this,e),this.addType(c.EaseInEaseOut)}Object.assign(Object.setPrototypeOf(yu.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._easeInEaseOut.addInterest("set_keyValue__",this)},set_keyValue__(){this._easeInEaseOut.length<this._key.length&&this._easeInEaseOut.resize(this._key.length,this._easeInEaseOut.length?this._easeInEaseOut[this._easeInEaseOut.length-1]:new Qi.SFVec2f)},interpolate(e,t,n){let i=this._easeInEaseOut[e].y,s=this._easeInEaseOut[t].x;const r=i+s;if(r<0)this._modifiedFraction_changed=n;else{r>1&&(s/=r,i/=r);const e=1/(2-i-s);if(n<i)this._modifiedFraction_changed=e/i*n*n;else if(n<=1-s)this._modifiedFraction_changed=e*(2*n-i);else{const t=1-n;this._modifiedFraction_changed=1-e*t*t/s}}}}),Object.defineProperties(yu,{typeName:{value:"EaseInEaseOut",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"easeInEaseOut",new Qi.MFVec2f),new H(c.outputOnly,"modifiedFraction_changed",new Qi.SFFloat)]),enumerable:!0}});const wu=yu;n.set("x_ite/Components/Interpolation/EaseInEaseOut",wu);const bu=wu;function Su(e){xu.call(this,e),this.addType(c.PositionInterpolator)}Object.assign(Object.setPrototypeOf(Su.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Qi.SFVec3f)},interpolate:function(){const e=new Et(0,0,0);return function(t,n,i){this._value_changed=e.assign(this._keyValue[t].getValue()).lerp(this._keyValue[n].getValue(),i)}}()}),Object.defineProperties(Su,{typeName:{value:"PositionInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFVec3f),new H(c.outputOnly,"value_changed",new Qi.SFVec3f)]),enumerable:!0}});const vu=Su;n.set("x_ite/Components/Interpolation/PositionInterpolator",vu);const Tu=vu;function Ou(e){xu.call(this,e),this.addType(c.OrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle")}Object.assign(Object.setPrototypeOf(Ou.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Qi.SFRotation)},interpolate:function(){const e=new dn,t=new dn;return function(n,i,s){e.assign(this._keyValue[n].getValue()),t.assign(this._keyValue[i].getValue()),this._value_changed=e.slerp(t,s)}}()}),Object.defineProperties(Ou,{typeName:{value:"OrientationInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFRotation),new H(c.outputOnly,"value_changed",new Qi.SFRotation)]),enumerable:!0}});const Eu=Ou;n.set("x_ite/Components/Interpolation/OrientationInterpolator",Eu);const Cu=Eu;function Nu(e){xu.call(this,e),this.addType(c.ScalarInterpolator)}Object.assign(Object.setPrototypeOf(Nu.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:0)},interpolate(e,t,n){this._value_changed=f.lerp(this._keyValue[e],this._keyValue[t],n)}}),Object.defineProperties(Nu,{typeName:{value:"ScalarInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFFloat),new H(c.outputOnly,"value_changed",new Qi.SFFloat)]),enumerable:!0}});const Fu=Nu;n.set("x_ite/Components/Interpolation/ScalarInterpolator",Fu);const Iu=Fu;function Mu(e){nr.call(this,e),this.addType(c.X3DViewpointNode),this.addChildObjects("positionOffset",new Qi.SFVec3f,"orientationOffset",new Qi.SFRotation,"scaleOffset",new Qi.SFVec3f(1,1,1),"scaleOrientationOffset",new Qi.SFRotation,"centerOfRotationOffset",new Qi.SFVec3f,"fieldOfViewScale",new Qi.SFFloat(1)),this.userPosition=new Et(0,1,0),this.userOrientation=new dn,this.userCenterOfRotation=new Et(0,0,0),this.modelMatrix=new _n,this.cameraSpaceMatrix=new _n(1,0,0,0,0,1,0,0,0,0,1,0,0,0,10,1),this.viewMatrix=new _n(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-10,1);const t=this.getBrowser();this.timeSensor=new fu(t.getPrivateScene()),this.easeInEaseOut=new bu(t.getPrivateScene()),this.positionInterpolator=new Tu(t.getPrivateScene()),this.orientationInterpolator=new Cu(t.getPrivateScene()),this.scaleInterpolator=new Tu(t.getPrivateScene()),this.scaleOrientationInterpolator=new Cu(t.getPrivateScene()),this.fieldOfViewScaleInterpolator=new Iu(t.getPrivateScene())}Object.assign(Object.setPrototypeOf(Mu.prototype,nr.prototype),{initialize(){nr.prototype.initialize.call(this),this.timeSensor._stopTime=1,this.timeSensor.setup(),this.easeInEaseOut._key=new Qi.MFFloat(0,1),this.easeInEaseOut._easeInEaseOut=new Qi.MFVec2f(new Qi.SFVec2f(0,0),new Qi.SFVec2f(0,0)),this.easeInEaseOut.setup(),this.positionInterpolator._key=new Qi.MFFloat(0,1),this.orientationInterpolator._key=new Qi.MFFloat(0,1),this.scaleInterpolator._key=new Qi.MFFloat(0,1),this.scaleOrientationInterpolator._key=new Qi.MFFloat(0,1),this.fieldOfViewScaleInterpolator._key=new Qi.MFFloat(0,1),this.positionInterpolator.setup(),this.orientationInterpolator.setup(),this.scaleInterpolator.setup(),this.scaleOrientationInterpolator.setup(),this.fieldOfViewScaleInterpolator.setup(),this.timeSensor._fraction_changed.addFieldInterest(this.easeInEaseOut._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.positionInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.orientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleOrientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewScaleInterpolator._set_fraction),this.positionInterpolator._value_changed.addFieldInterest(this._positionOffset),this.orientationInterpolator._value_changed.addFieldInterest(this._orientationOffset),this.scaleInterpolator._value_changed.addFieldInterest(this._scaleOffset),this.scaleOrientationInterpolator._value_changed.addFieldInterest(this._scaleOrientationOffset),this.fieldOfViewScaleInterpolator._value_changed.addFieldInterest(this._fieldOfViewScale),this._nearDistance.addInterest("set_nearDistance__",this),this._farDistance.addInterest("set_farDistance__",this),this._viewAll.addInterest("set_viewAll__",this),this._navigationInfo.addInterest("set_navigationInfo__",this),this._isBound.addInterest("set_bound__",this),this.set_nearDistance__(),this.set_farDistance__(),this.set_navigationInfo__()},set_nearDistance__(){const e=this._nearDistance.getValue();this.nearDistance=e>=0?e:void 0},set_farDistance__(){const e=this._farDistance.getValue();this.farDistance=e>=0?e:void 0},set_viewAll__(){this._viewAll.getValue()&&this._isBound.getValue()&&(this._set_bind=!0)},set_navigationInfo__(){this.navigationInfoNode&&this._isBound.removeFieldInterest(this.navigationInfoNode._set_bind),this.navigationInfoNode=zl(c.NavigationInfo,this._navigationInfo),this.navigationInfoNode&&this._isBound.addFieldInterest(this.navigationInfoNode._set_bind)},set_bound__(){const e=this.getBrowser();this._isBound.getValue()?e.getNotification()._string=this._description:this.timeSensor._stopTime=e.getCurrentTime()},set_active__(e,t){t.getValue()||(this.timeSensor._isActive.removeInterest("set_active__",this),this._isBound.getValue()&&1===this.timeSensor._fraction_changed.getValue()&&(e._transitionComplete=!0))},setInterpolators(){},getPosition(){return this._position.getValue()},getUserPosition(){return this.userPosition.assign(this.getPosition()).add(this._positionOffset.getValue())},getOrientation(){return this._orientation.getValue()},getUserOrientation(){return this.userOrientation.assign(this.getOrientation()).multRight(this._orientationOffset.getValue())},getCenterOfRotation(){return this._centerOfRotation.getValue()},getUserCenterOfRotation(){return this.userCenterOfRotation.assign(this.getCenterOfRotation()).add(this._centerOfRotationOffset.getValue())},getProjectionMatrix(e){const t=e.getNavigationInfo();return this.getProjectionMatrixWithLimits(this.nearDistance??t.getNearValue(),this.farDistance??t.getFarValue(this),e.getLayer().getViewport().getRectangle())},getCameraSpaceMatrix(){return this.cameraSpaceMatrix},getViewMatrix(){return this.viewMatrix},getModelMatrix(){return this.modelMatrix},getMaxFarValue(){return this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")?1e10:1e5},getUpVector:()=>Et.yAxis,getSpeedFactor:()=>1,setVRMLTransition(e){this.VRMLTransition=e},getVRMLTransition(){return this.VRMLTransition},transitionStart(e,t){if(this._jump.getValue()){const n=this.getRelativeTransformation(t);this._retainUserOffsets.getValue()||this.resetUserOffsets(),this._viewAll.getValue()&&this.viewAll(e.getBBox(new La));const i=e.getNavigationInfo(),s=i._transitionTime.getValue();let r=i.getTransitionType();switch("2.0"===this.getExecutionContext().getSpecificationVersion()&&(r=this.getVRMLTransition()?"LINEAR":"TELEPORT"),this.setVRMLTransition(!1),s<=0&&(r="TELEPORT"),this.constructor!==t.constructor&&(r="TELEPORT"),r){case"TELEPORT":return void(i._transitionComplete=!0);case"ANIMATE":this.easeInEaseOut._easeInEaseOut=new Qi.MFVec2f(new Qi.SFVec2f(0,1),new Qi.SFVec2f(1,0));break;default:this.easeInEaseOut._easeInEaseOut=new Qi.MFVec2f(new Qi.SFVec2f(0,0),new Qi.SFVec2f(0,0))}i._transitionStart=!0,this.timeSensor._cycleInterval=s,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,i),this.positionInterpolator._keyValue=new Qi.MFVec3f(n.position,this._positionOffset),this.orientationInterpolator._keyValue=new Qi.MFRotation(n.orientation,this._orientationOffset),this.scaleInterpolator._keyValue=new Qi.MFVec3f(n.scale,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Qi.MFRotation(n.scaleOrientation,this._scaleOrientationOffset),this._positionOffset=n.position,this._orientationOffset=n.orientation,this._scaleOffset=n.scale,this._scaleOrientationOffset=n.scaleOrientation,this.setInterpolators(t,n)}else{e.getNavigationInfo()._transitionComplete=!0;const n=this.getRelativeTransformation(t);this._positionOffset=n.position,this._orientationOffset=n.orientation,this._scaleOffset=n.scale,this._scaleOrientationOffset=n.scaleOrientation,this.setInterpolators(t,n)}},transitionStop(){this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.removeInterest("set_active__",this)},resetUserOffsets(){this._positionOffset=Et.Zero,this._orientationOffset=dn.Identity,this._scaleOffset=Et.One,this._scaleOrientationOffset=dn.Identity,this._centerOfRotationOffset=Et.Zero,this._fieldOfViewScale=1,this.set_nearDistance__(),this.set_farDistance__()},getRelativeTransformation:function(){const e=new Et(0,0,0),t=new dn,n=new Et(0,0,0),i=new dn;return function(s){return this.modelMatrix.copy().multRight(s.getViewMatrix()).inverse().get(e,t,n,i),e.subtract(this.getPosition()),t.multLeft(this.getOrientation().copy().inverse()),{position:e,orientation:t,scale:n,scaleOrientation:i}}}(),getLookAtRotation:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new Bt,s=new dn;return function(r,o){const a=this.getUpVector(!0);return n.assign(r).subtract(o).normalize(),e.assign(a).cross(n).normalize(),t.assign(n).cross(e).normalize(),i.set(...e,...t,...n),s.setMatrix(i),s}}(),lookAtPoint(e,t,n,i){this.getCameraSpaceMatrix().multVecMatrix(t),this.getModelMatrix().copy().inverse().multVecMatrix(t);const s=2*e.getNavigationInfo().getNearValue();this.lookAt(e,t,s,n,i)},lookAtBBox(e,t,n,i){t=t.copy().multRight(this.getModelMatrix().copy().inverse());const s=Math.max(2*e.getNavigationInfo().getNearValue(),this.getLookAtDistance(t));this.lookAt(e,t.center,s,n,i)},lookAt(e,t,n,i,s){const r=t.copy().add(this.getUserOrientation().multVecRot(new Et(0,0,n))).subtract(this.getPosition());e.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=1,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,e.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new Qi.MFVec2f(new Qi.SFVec2f(0,1),new Qi.SFVec2f(1,0));const o=this._positionOffset.getValue().copy().lerp(r,i),a=this.getPosition().copy().add(o).subtract(t);let l=this._orientationOffset.getValue().copy().multRight(new dn(this.getUserOrientation().multVecRot(new Et(0,0,1)),a));s&&(l=this.getOrientation().copy().inverse().multRight(this.straightenHorizon(this.getOrientation().copy().multRight(l)))),this.positionInterpolator._keyValue=new Qi.MFVec3f(this._positionOffset,o),this.orientationInterpolator._keyValue=new Qi.MFRotation(this._orientationOffset,l),this.scaleInterpolator._keyValue=new Qi.MFVec3f(this._scaleOffset,Et.One),this.scaleOrientationInterpolator._keyValue=new Qi.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset);const u=this.getRelativeTransformation(this);this._fieldOfViewScale=1,this._centerOfRotationOffset=t.copy().subtract(this.getCenterOfRotation()),this.nearDistance=Math.min(n/2,.125),this.farDistance=this.nearDistance*this.getMaxFarValue()/.125,this.setInterpolators(this,u)},straightenView(e){e.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=1,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,e.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new Qi.MFVec2f(new Qi.SFVec2f(0,1),new Qi.SFVec2f(1,0));const t=this.getOrientation().copy().inverse().multRight(this.straightenHorizon(this.getUserOrientation()));this.positionInterpolator._keyValue=new Qi.MFVec3f(this._positionOffset,this._positionOffset),this.orientationInterpolator._keyValue=new Qi.MFRotation(this._orientationOffset,t),this.scaleInterpolator._keyValue=new Qi.MFVec3f(this._scaleOffset,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Qi.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset);const n=this.getRelativeTransformation(this);this._fieldOfViewScale=1,this.setInterpolators(this,n)},straightenHorizon:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new dn;return function(i,s=this.getUpVector(!0)){i.multVecRot(e.assign(Et.xAxis).negate()),i.multVecRot(t.assign(Et.zAxis));const r=t.cross(s);return Math.abs(t.dot(s))>=1||Math.abs(r.dot(e))>=1?i:(n.setFromToVec(e,r),i.multRight(n))}}(),viewAll(e){e.multRight(this.modelMatrix.copy().inverse());const t=this.getUserPosition().copy().subtract(e.center).normalize(),n=this.getLookAtDistance(e),i=e.center.copy().add(t.multiply(n)),s=this.getLookAtRotation(i,e.center);this._positionOffset=i.subtract(this.getPosition()),this._orientationOffset=this.getOrientation().copy().inverse().multRight(s),this._centerOfRotationOffset=e.center.copy().subtract(this.getCenterOfRotation()),this._fieldOfViewScale=1,this.nearDistance=Math.min((n-e.size.magnitude())/2,.125),this.farDistance=this.nearDistance*this.getMaxFarValue()/.125},traverse(e,t){e===Na.CAMERA&&(this.navigationInfoNode&&this.navigationInfoNode.traverse(e,t),t.getLayer().getViewpoints().push(this),this.modelMatrix.assign(t.getModelViewMatrix().get()))},update(){this.cameraSpaceMatrix.set(this.getUserPosition(),this.getUserOrientation(),this._scaleOffset.getValue(),this._scaleOrientationOffset.getValue()),this.cameraSpaceMatrix.multRight(this.modelMatrix),this.viewMatrix.assign(this.cameraSpaceMatrix).inverse()}}),Object.defineProperties(Mu,{typeName:{value:"X3DViewpointNode",enumerable:!0},componentName:{value:"Navigation",enumerable:!0}});const Pu=Mu;n.set("x_ite/Components/Navigation/X3DViewpointNode",Pu);const Du=Pu;function Ru(e){Du.call(this,e),this.addType(c.Viewpoint),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("angle"),this.projectionMatrix=new _n}Object.assign(Object.setPrototypeOf(Ru.prototype,Du.prototype),{getRelativeTransformation(e){const t=Du.prototype.getRelativeTransformation.call(this,e);return e.constructor===this.constructor&&(t.fieldOfView=e.getFieldOfView()),t},setInterpolators(e,t){if(e.constructor===this.constructor){const e=t.fieldOfView/this.getFieldOfView();this.fieldOfViewScaleInterpolator._keyValue=new Qi.MFFloat(e,this._fieldOfViewScale.getValue()),this._fieldOfViewScale=e}else this.fieldOfViewScaleInterpolator._keyValue=new Qi.MFFloat(this._fieldOfViewScale.getValue(),this._fieldOfViewScale.getValue()),this._fieldOfViewScale=this._fieldOfViewScale.getValue()},getLogarithmicDepthBuffer:()=>!1,getFieldOfView(){const e=this._fieldOfView.getValue()*this._fieldOfViewScale.getValue();return e>0&&e<Math.PI?e:Math.PI/4},getScreenScale(e,t,n){const i=t[2],s=t[3];let r=Math.abs(e.z)*Math.tan(this.getFieldOfView()/2)*2;return r/=i>s?s:i,n.set(r,r,r)},getViewportSize:function(){const e=new wt(0,0);return function(t,n){const i=t[2],s=t[3],r=n*Math.tan(this.getFieldOfView()/2)*2,o=i/s;return o>1?e.set(r*o,r):e.set(r,r/o)}}(),getLookAtDistance(e){return e.size.magnitude()/2/Math.tan(this.getFieldOfView()/2)},getProjectionMatrixWithLimits(e,t,n){return Ra.perspective(this.getFieldOfView(),e,t,n[2],n[3],this.projectionMatrix)}}),Object.defineProperties(Ru,{typeName:{value:"Viewpoint",enumerable:!0},componentName:{value:"Navigation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_bind",new Qi.SFBool),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"position",new Qi.SFVec3f(0,0,10)),new H(c.inputOutput,"orientation",new Qi.SFRotation),new H(c.inputOutput,"centerOfRotation",new Qi.SFVec3f),new H(c.inputOutput,"fieldOfView",new Qi.SFFloat(.7854)),new H(c.inputOutput,"nearDistance",new Qi.SFFloat(-1)),new H(c.inputOutput,"farDistance",new Qi.SFFloat(-1)),new H(c.inputOutput,"viewAll",new Qi.SFBool),new H(c.inputOutput,"jump",new Qi.SFBool(!0)),new H(c.inputOutput,"retainUserOffsets",new Qi.SFBool),new H(c.outputOnly,"isBound",new Qi.SFBool),new H(c.outputOnly,"bindTime",new Qi.SFTime),new H(c.inputOutput,"navigationInfo",new Qi.SFNode)]),enumerable:!0}});const Au=Ru;n.set("x_ite/Components/Navigation/Viewpoint",Au);const Vu=Au;function Lu(e){this.addType(c.X3DBoundedObject),this.addChildObjects("transformSensors_changed",new Qi.SFTime),this._bboxSize.setUnit("length"),this._bboxCenter.setUnit("length"),this.childBBox=new La,this.transformSensorNodes=new Set}Object.assign(Lu.prototype,{initialize(){},getDefaultBBoxSize:function(){const e=new Et(-1,-1,-1);return function(){return e}}(),getBBox(e,t,n){const i=this.childBBox;t.set();for(const s of e)s.getBBox&&t.add(s.getBBox(i,n));return t},displayBBox:function(){const e=new La,t=new _n;return function(n,i){const s=i.getModelViewMatrix();this.getBBox(e),t.set(e.center,null,e.size),s.push(),s.multLeft(t),this.getBrowser().getBBoxNode().traverse(n,i),s.pop()}}(),addTransformSensor(e){this.transformSensorNodes.add(e),this._transformSensors_changed=this.getBrowser().getCurrentTime()},removeTransformSensor(e){this.transformSensorNodes.delete(e),this._transformSensors_changed=this.getBrowser().getCurrentTime()},getTransformSensors(){return this.transformSensorNodes},dispose(){}}),Object.defineProperties(Lu,{typeName:{value:"X3DBoundedObject",enumerable:!0},componentName:{value:"Grouping",enumerable:!0}});const Bu=Lu;n.set("x_ite/Components/Grouping/X3DBoundedObject",Bu);const Uu=Bu;function Xu(e){Ys.call(this,e),Uu.call(this,e),this.addType(c.X3DGroupingNode),this.hidden=!1,this.allowedTypes=new Set,this.clipPlaneNodes=[],this.localFogNodes=[],this.lightNodes=[],this.textureProjectorNodes=[],this.pointingDeviceSensorNodes=[],this.maybeCameraObjects=[],this.cameraObjects=[],this.maybePickableSensorNodes=[],this.pickableSensorNodes=[],this.pickableObjects=[],this.childNodes=[],this.displayNodes=[],this.visibleNodes=[],this.boundedObjects=[],this.sensors=[]}function ju(e,t){const n=new Set(t);return e.filter((e=>!n.has(e)))}Object.assign(Object.setPrototypeOf(Xu.prototype,Ys.prototype),Uu.prototype,{initialize(){Ys.prototype.initialize.call(this),Uu.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this._addChildren.addInterest("set_addChildren__",this),this._removeChildren.addInterest("set_removeChildren__",this),this._children.addInterest("set_children__",this),this.set_children__()},getBBox(e,t){return this.getSubBBox(e,t)},getSubBBox(e,t){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?Uu.prototype.getBBox.call(this,this.visibleNodes,e,t):e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},isHidden(){return this.hidden},setHidden(e){e!==this.hidden&&(this.hidden=e,this.set_children__(),this.getBrowser().addBrowserEvent())},setAllowedTypes(){const e=this.allowedTypes;e.clear();for(const t of arguments)e.add(t)},set_addChildren__(){0!==this._addChildren.length&&(this._addChildren.setTainted(!0),this._addChildren.assign(ju(this._addChildren,this._children)),this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.splice(this._children.length,0,...this._addChildren),this.add(this._addChildren),this._addChildren.length=0,this._addChildren.setTainted(!1))},set_removeChildren__(){0!==this._removeChildren.length&&(this._removeChildren.setTainted(!0),this._children.length>0&&(this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.assign(ju(this._children,this._removeChildren)),this.remove(this._removeChildren)),this._removeChildren.length=0,this._removeChildren.setTainted(!1))},set_children__(){this.clear(),this.add(this._children)},connectChildren(){this._children.removeInterest("connectChildren",this),this._children.addInterest("set_children__",this)},clear(){for(const e of this.maybePickableSensorNodes)e._isPickableObject.removeInterest("set_pickableObjects__",this);for(const e of this.childNodes)e._isCameraObject.removeInterest("set_cameraObjects__",this),e._isPickableObject.removeInterest("set_pickableObjects__",this),zl(c.X3DBoundedObject,e)&&(e._visible.removeInterest("set_visibles__",this),e._bboxDisplay.removeInterest("set_bboxDisplays__",this));this.clipPlaneNodes.length=0,this.localFogNodes.length=0,this.lightNodes.length=0,this.textureProjectorNodes.length=0,this.pointingDeviceSensorNodes.length=0,this.maybeCameraObjects.length=0,this.maybePickableSensorNodes.length=0,this.childNodes.length=0},add(e){if(!this.hidden){for(const t of e)if(t)try{const e=t.getValue().getInnerNode(),n=e.getType();for(let t=n.length-1;t>=0;--t){switch(n[t]){case c.X3DPointingDeviceSensorNode:this.pointingDeviceSensorNodes.push(e);break;case c.ClipPlane:this.clipPlaneNodes.push(e);break;case c.LocalFog:this.localFogNodes.push(e);break;case c.X3DTextureProjectorNode:this.textureProjectorNodes.push(e);break;case c.X3DLightNode:this.lightNodes.push(e);break;case c.X3DBindableNode:this.maybeCameraObjects.push(e);break;case c.TransformSensor:case c.X3DPickSensorNode:e._isPickableObject.addInterest("set_pickableObjects__",this),this.maybePickableSensorNodes.push(e);break;case c.X3DBackgroundNode:case c.X3DChildNode:e._isCameraObject.addInterest("set_cameraObjects__",this),e._isPickableObject.addInterest("set_pickableObjects__",this),zl(c.X3DBoundedObject,e)&&(e._visible.addInterest("set_visibles__",this),e._bboxDisplay.addInterest("set_bboxDisplays__",this)),this.maybeCameraObjects.push(e),this.childNodes.push(e);break;case c.BooleanFilter:case c.BooleanToggle:case c.NurbsOrientationInterpolator:case c.NurbsPositionInterpolator:case c.NurbsSurfaceInterpolator:case c.TimeSensor:case c.X3DFollowerNode:case c.X3DInfoNode:case c.X3DInterpolatorNode:case c.X3DKeyDeviceSensorNode:case c.X3DLayoutNode:case c.X3DScriptNode:case c.X3DSequencerNode:case c.X3DTriggerNode:break;default:continue}break}}catch{}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()}},remove(e){for(const n of e)if(n)try{const e=n.getValue().getInnerNode(),i=e.getType();for(let n=i.length-1;n>=0;--n){switch(i[n]){case c.X3DPointingDeviceSensorNode:{const t=this.pointingDeviceSensorNodes.indexOf(e);t>=0&&this.pointingDeviceSensorNodes.splice(t,1);break}case c.ClipPlane:{const t=this.clipPlaneNodes.indexOf(e);t>=0&&this.clipPlaneNodes.splice(t,1);break}case c.LocalFog:{const t=this.localFogNodes.indexOf(e);t>=0&&this.localFogNodes.splice(t,1);break}case c.X3DTextureProjectorNode:{const t=this.textureProjectorNodes.indexOf(e);t>=0&&this.textureProjectorNodes.splice(t,1);break}case c.X3DLightNode:{const t=this.lightNodes.indexOf(e);t>=0&&this.lightNodes.splice(t,1);break}case c.X3DBindableNode:{const t=this.maybeCameraObjects.indexOf(e);t>=0&&this.maybeCameraObjects.splice(t,1);break}case c.TransformSensor:case c.X3DPickSensorNode:{e._isPickableObject.removeInterest("set_pickableObjects__",this);const t=this.maybePickableSensorNodes.indexOf(e);t>=0&&this.maybePickableSensorNodes.splice(t,1);break}case c.X3DBackgroundNode:case c.X3DChildNode:var t;e._isCameraObject.removeInterest("set_cameraObjects__",this),e._isPickableObject.removeInterest("set_pickableObjects__",this),zl(c.X3DBoundedObject,e)&&(e._visible.removeInterest("set_visibles__",this),e._bboxDisplay.removeInterest("set_bboxDisplays__",this)),(t=this.maybeCameraObjects.indexOf(e))>=0&&this.maybeCameraObjects.splice(t,1),(t=this.childNodes.indexOf(e))>=0&&this.childNodes.splice(t,1);break;case c.BooleanFilter:case c.BooleanToggle:case c.NurbsOrientationInterpolator:case c.NurbsPositionInterpolator:case c.NurbsSurfaceInterpolator:case c.TimeSensor:case c.X3DFollowerNode:case c.X3DInfoNode:case c.X3DInterpolatorNode:case c.X3DKeyDeviceSensorNode:case c.X3DLayoutNode:case c.X3DScriptNode:case c.X3DSequencerNode:case c.X3DTriggerNode:break;default:continue}break}}catch{}this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()},set_cameraObjects__(){const e=this.cameraObjects;e.length=0;for(const t of this.maybeCameraObjects)t.isCameraObject()&&(zl(c.X3DBoundedObject,t)?t._visible.getValue()&&e.push(t):e.push(t));this.setCameraObject(!!e.length)},set_pickableObjects__(){const e=this.pickableSensorNodes,t=this.pickableObjects;e.length=0,t.length=0;for(const t of this.maybePickableSensorNodes)t.isPickableObject()&&e.push(t);for(const e of this.visibleNodes)e.isPickableObject()&&t.push(e);this.set_transformSensors__()},set_transformSensors__(){this.setPickableObject(!!(this.getTransformSensors().size||this.pickableSensorNodes.length||this.pickableObjects.length))},set_displayNodes__(){const e=this.displayNodes;e.length=0;for(const t of this.clipPlaneNodes)e.push(t);for(const t of this.localFogNodes)e.push(t);for(const t of this.lightNodes)e.push(t);for(const t of this.textureProjectorNodes)e.push(t)},set_visibles__(){const e=this.visibleNodes;e.length=0;for(const t of this.childNodes)zl(c.X3DBoundedObject,t)?t._visible.getValue()&&e.push(t):e.push(t);this.set_cameraObjects__(),this.set_pickableObjects__()},set_bboxDisplays__(){const e=this.boundedObjects;e.length=0;for(const t of this.childNodes)zl(c.X3DBoundedObject,t)&&t._bboxDisplay.getValue()&&e.push(t)},traverse(e,t){switch(e){case Na.POINTER:{const n=this.pointingDeviceSensorNodes,i=this.clipPlaneNodes,s=this.sensors;if(s.length=0,n.length){for(const e of n)e.push(t,s);s.length&&t.getSensors().push(s)}for(const e of i)e.push(t);for(const n of this.visibleNodes)n.traverse(e,t);for(const e of i)e.pop(t);return void(s.length&&t.getSensors().pop())}case Na.CAMERA:for(const n of this.cameraObjects)n.traverse(e,t);return;case Na.PICKING:{if(this.getTransformSensors().size){const e=t.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}for(const n of this.pickableSensorNodes)n.traverse(e,t);const n=this.getBrowser(),i=n.getPickingHierarchy();if(i.push(this),n.getPickable().at(-1))for(const n of this.visibleNodes)n.traverse(e,t);else for(const n of this.pickableObjects)n.traverse(e,t);return void i.pop()}case Na.COLLISION:{const n=this.clipPlaneNodes;for(const e of n)e.push(t);for(const n of this.visibleNodes)n.traverse(e,t);for(const e of n)e.pop(t);return}case Na.SHADOW:{const n=this.clipPlaneNodes;for(const e of n)e.push(t);for(const n of this.visibleNodes)n.traverse(e,t);for(const e of n)e.push(t);return}case Na.DISPLAY:{const n=this.displayNodes;for(const e of n)e.push(t,this);for(const n of this.visibleNodes)n.traverse(e,t);for(const n of this.boundedObjects)n.displayBBox(e,t);for(const e of n)e.pop(t);return}}},dispose(){Uu.prototype.dispose.call(this),Ys.prototype.dispose.call(this)}}),Object.defineProperties(Xu,{typeName:{value:"X3DGroupingNode",enumerable:!0},componentName:{value:"Grouping",enumerable:!0}});const ku=Xu;n.set("x_ite/Components/Grouping/X3DGroupingNode",ku);const zu=ku;function Gu(e){zu.call(this,e),this.addType(c.Group)}Object.setPrototypeOf(Gu.prototype,zu.prototype),Object.defineProperties(Gu,{typeName:{value:"Group",enumerable:!0},componentName:{value:"Grouping",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const Hu=Gu;n.set("x_ite/Components/Grouping/Group",Hu);const qu=Hu;function Yu(e){ou.call(this,e,new Vu(e),new qu(e)),this.addType(c.Layer)}Object.assign(Object.setPrototypeOf(Yu.prototype,ou.prototype),{initialize(){ou.prototype.initialize.call(this),this._addChildren.addFieldInterest(this.getGroup()._addChildren),this._removeChildren.addFieldInterest(this.getGroup()._removeChildren),this._children.addFieldInterest(this.getGroup()._children),this.getGroup()._children=this._children,this.getGroup().setPrivate(!0),this.getGroup().setup()}}),Object.defineProperties(Yu,{typeName:{value:"Layer",enumerable:!0},componentName:{value:"Layering",enumerable:!0},containerField:{value:"layers",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"pickable",new Qi.SFBool(!0)),new H(c.inputOutput,"objectType",new Qi.MFString("ALL")),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"viewport",new Qi.SFNode),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const Wu=Yu;n.set("x_ite/Components/Layering/Layer",Wu);const $u=Wu;function Ku(e){vs.call(this,e),this.addType(c.LayerSet),this.layerNodes=[new $u(e)],this.layerNode0=this.layerNodes[0],this.activeLayerNode=null}Object.assign(Object.setPrototypeOf(Ku.prototype,vs.prototype),{initialize(){vs.prototype.initialize.call(this),this.layerNode0.setPrivate(!0),this.layerNode0.setup(),this.layerNode0.isLayer0(!0),this._activeLayer.addInterest("set_activeLayer__",this),this._order.addInterest("set_layers__",this),this._layers.addInterest("set_layers__",this),this.set_layers__()},getActiveLayer(){return this.activeLayerNode},setLayer0(e){this.layerNode0=e,this.set_layers__()},getLayer0(){return this.layerNode0},getLayers(){return this.layerNodes},set_activeLayer__(){if(0===this._activeLayer.getValue())this.activeLayerNode!==this.layerNode0&&(this.activeLayerNode=this.layerNode0);else{const e=this._activeLayer-1;e>=0&&e<this._layers.length?this.activeLayerNode!==this._layers[e].getValue()&&(this.activeLayerNode=zl(c.X3DLayerNode,this._layers[e])):null!==this.activeLayerNode&&(this.activeLayerNode=null)}},set_layers__(){const e=this._layers.getValue();this.layerNodes.length=0;for(let t of this._order)if(0===t)this.layerNodes.push(this.layerNode0);else if(--t,t>=0&&t<e.length){const n=zl(c.X3DLayerNode,e[t]);n&&this.layerNodes.push(n)}this.set_activeLayer__()},bindBindables(e){const t=this._layers.getValue();this.layerNode0.bindBindables(e);for(let n=0,i=t.length;n<i;++n){const i=zl(c.X3DLayerNode,t[n]);i&&i.bindBindables(e)}},traverse(e,t){for(const n of this.layerNodes)n.traverse(e,t)}}),Object.defineProperties(Ku,{typeName:{value:"LayerSet",enumerable:!0},componentName:{value:"Layering",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"activeLayer",new Qi.SFInt32),new H(c.inputOutput,"order",new Qi.MFInt32(0)),new H(c.inputOutput,"layers",new Qi.MFNode)]),enumerable:!0}});const Ju=Ku;n.set("x_ite/Components/Layering/LayerSet",Ju);const Zu=Ju;function Qu(e){xs.call(this,e),this.addType(c.X3DWorld),this.addChildObjects("activeLayer",new Mn(this.layer0)),this.defaultLayerSet=new Zu(e),this.layerSet=this.defaultLayerSet,this.layer0=new $u(e)}Object.assign(Object.setPrototypeOf(Qu.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this),this.layerSet.setPrivate(!0),this.layerSet.setup(),this.layerSet.setLayer0(this.layer0),this.layerSet._activeLayer.addInterest("set_rootNodes__",this),this.getExecutionContext().getRootNodes().addInterest("set_rootNodes__",this),this.set_rootNodes__(),this.layer0.setPrivate(!0),this.layer0.isLayer0(!0),this.layer0.setup(),this.set_activeLayer__()},getCache(){return this.getBrowser().getBrowserOption("Cache")},getLayerSet(){return this.layerSet},getActiveLayer(){return this._activeLayer.getValue()},set_rootNodes__(){const e=this.layerSet,t=this.getExecutionContext().getRootNodes();this.layerSet=this.defaultLayerSet,this.layer0._children=t;for(const e of t){const t=zl(c.LayerSet,e);t&&(this.layerSet=t)}this.layerSet!==e&&(this.layerSet.setLayer0(this.layer0),e._activeLayer.removeInterest("set_activeLayer__",this),this.layerSet._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__())},set_activeLayer__(){this._activeLayer=this.layerSet.getActiveLayer()},bindBindables(){const e=this.getExecutionContext().getWorldURL();this.layerSet.bindBindables(decodeURIComponent(new URL(e,e).hash.substr(1)))},traverse(e,t){this.layerSet.traverse(e,t)}});for(const e of Reflect.ownKeys(Qu.prototype))Object.defineProperty(Qu.prototype,e,{enumerable:!1});Object.defineProperties(Qu,{typeName:{value:"X3DWorld",enumerable:!0}}),c.addNode(Qu);const eh=Qu;n.set("x_ite/Execution/X3DWorld",eh);const th=eh;var nh=i(666);const ih=/^\s*(?:vrmlscript|javascript|ecmascript)\:(.*)$/s,sh=/^data:(.*?)(?:;charset=(.*?))?(?:;(base64))?,(.*)$/s,rh=new RegExp(".(?:html|htm|xhtml)$"),oh={"text/html":!0,"application/xhtml+xml":!0},ah=new Qi.MFString;function lh(e){F.call(this),this.node=e,this.browser=e.getBrowser(),this.external=this.browser.isExternal(),this.executionContext=this.external?e.getExecutionContext():this.browser.currentScene,this.target="",this.url=[],this.URL=new URL(this.getReferer(),this.getReferer()),this.controller=new AbortController}Object.assign(Object.setPrototypeOf(lh.prototype,F.prototype),{abort(){this.url.length=0,this.controller.abort()},getURL(){return this.URL},getReferer(){return this.node instanceof th&&this.external?this.browser.getBaseURL():this.executionContext.getWorldURL()},getTarget(e){for(const t of e){const e=t.split("=");if(2===e.length&&"target"===e[0])return e[1]}return""},createX3DFromString(e,t="",n,i){try{const s=this.browser.createScene();return this.node instanceof th?s.loader=this:s.setExecutionContext(this.executionContext),s.setWorldURL(new URL(e,this.getReferer()).href),n&&(n=this.setScene.bind(this,s,n,i)),new na(s).parseIntoScene(t,n,i),s}catch(e){if(!i)throw e;i(e)}},setScene(e,t,n){e._initLoadCount.addInterest("set_initLoadCount__",this,e,t,n),e._initLoadCount.addEvent()},set_initLoadCount__(e,t,n,i){i.getValue()||(e._initLoadCount.removeInterest("set_initLoadCount__",this),delete e.loader,setTimeout((()=>{try{t(e)}catch(e){if(!n)throw e;n(e)}})))},createX3DFromURL(e,t,n,i,s){return this.bindViewpoint=i,this.foreign=s,this.target=this.getTarget(t||ah),this.loadDocument(e,this.createX3DFromURLAsync.bind(this,n))},createX3DFromURLAsync(e,t){null===t?e(null):this.createX3DFromString(this.URL,t,e,this.loadDocumentError.bind(this))},loadDocument(e,t){if(this.url=e.copy(),this.callback=t,0===e.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift()).catch(this.loadDocumentError.bind(this))},loadDocumentAsync:async function(e){if(0===e.length)return void this.loadDocumentError(new Error("URL is empty."));{const t=ih.exec(e);if(t)return void this.callback(t[1])}{const t=sh.exec(e);if(t){let e=t[4];return e="base64"===t[3]?atob(e):unescape(e),void this.callback(e)}}if(this.URL=new URL(e,this.getReferer()),this.bindViewpoint){const e=new URL(this.getReferer());if(this.URL.protocol===e.protocol&&this.URL.hostname===e.hostname&&this.URL.port===e.port&&this.URL.pathname===e.pathname&&this.URL.hash)return void this.bindViewpoint(decodeURIComponent(this.URL.hash.substr(1)))}if(this.foreign){if(this.target.length&&"_self"!==this.target)return this.foreign(this.URL.href,this.target);if(this.URL.href.match(rh))return this.foreign(this.URL.href,this.target)}const t={cache:this.node.getCache()?"default":"reload",signal:this.controller.signal},n=this.handleErrors(await fetch(this.URL.href,t)),i=n.headers.get("content-type")?.replace(/;.*$/,"");if(this.foreign&&oh[i])return this.foreign(this.URL.href,this.target);this.callback(nh.ungzip(await n.arrayBuffer()),this.URL)},handleErrors(e){if(e.ok)return e;throw Error(e.statusText||e.status)},loadDocumentError(e){this.setError(e),this.url.length?this.loadDocumentAsync(this.url.shift()).catch(this.loadDocumentError.bind(this)):this.callback(null)},setError(e){"data:"===this.URL.protocol?console.error("Couldn't load data URL.",e):console.error(`Couldn't load URL '${decodeURI(this.URL.href)}'.`,e)}});for(const e of Reflect.ownKeys(lh.prototype))Object.defineProperty(lh.prototype,e,{enumerable:!1});const uh=lh;n.set("x_ite/InputOutput/FileLoader",uh);const hh=uh,ch=Symbol(),dh=Symbol();function ph(e,t){vr.call(this,e),Rr.call(this,e),this.addType(c.X3DExternProtoDeclaration),this.addChildObjects("load",new Qi.SFBool(!0),"url",t.copy(),"autoRefresh",new Qi.SFTime,"autoRefreshTimeLimit",new Qi.SFTime(3600))}Object.assign(Object.setPrototypeOf(ph.prototype,vr.prototype),Rr.prototype,{initialize(){vr.prototype.initialize.call(this),Rr.prototype.initialize.call(this)},set_live__(){Rr.prototype.set_live__.call(this),this.checkLoadState()===c.COMPLETE_STATE&&this[dh].setLive(this.getLive().getValue())},canUserDefinedFields:()=>!0,setProtoDeclaration(e){if(this[ch]=e,e){for(const e of[...this.getUserDefinedFields()])this.removeUserDefinedField(e.getName());for(const t of e.getUserDefinedFields())this.addUserDefinedField(t.getAccessType(),t.getName(),t)}this.updateInstances()},getProtoDeclaration(){return this[ch]},loadData(){this.getScene().addInitLoadCount(this),new hh(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},setInternalSceneAsync(e){e?this.setInternalScene(e):this.setError(new Error("File could not be loaded.")),this.getScene().removeInitLoadCount(this)},setInternalScene(e){this[dh]=e;const t=decodeURIComponent(new URL(this[dh].getWorldURL()).hash.substr(1)),n=t?this[dh].protos.get(t):this[dh].protos[0];if(!n)throw new Error("PROTO not found");this[dh].setLive(this.getLive().getValue()),this[dh].setPrivate(this.getScene().isPrivate()),this[dh].setExecutionContext(this.getExecutionContext()),this.setLoadState(c.COMPLETE_STATE),this.setProtoDeclaration(n)},getInternalScene(){return this[dh]},setError(e){console.error(`Error loading extern prototype '${this.getName()}':`,e),this[dh]=this.getBrowser().getPrivateScene(),this.setLoadState(c.FAILED_STATE),this.setProtoDeclaration(null)},toVRMLStream(e){e.string+=e.Indent(),e.string+="EXTERNPROTO",e.string+=e.Space(),e.string+=this.getName(),e.string+=e.TidySpace(),e.string+="[";const t=this.getUserDefinedFields();if(0===t.length)e.string+=e.TidySpace();else{let n=0,i=0;for(const s of t)n=Math.max(n,s.getTypeName().length),i=Math.max(i,e.AccessType(s.getAccessType()).length);e.string+=e.TidyBreak(),e.IncIndent();for(const s of t)this.toVRMLStreamUserDefinedField(e,s,n,i),e.string+=e.Break();e.DecIndent(),e.string+=e.Indent()}e.string+="]",e.string+=e.TidyBreak(),e.string+=e.Indent(),this._url.toVRMLStream(e)},toVRMLStreamUserDefinedField(e,t,n,i){e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(i," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(n," "),e.string+=e.Space(),e.string+=t.getName()},toXMLStream(e){e.string+=e.Indent(),e.string+="<ExternProtoDeclare",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.getName()),e.string+="'",e.string+=e.Space(),e.string+="url='",this._url.toXMLStream(e),e.string+="'",e.string+=">",e.string+=e.TidyBreak(),e.IncIndent();const t=this.getUserDefinedFields();for(const n of t)e.string+=e.Indent(),e.string+="<field",e.string+=e.Space(),e.string+="accessType='",e.string+=e.AccessType(n.getAccessType()),e.string+="'",e.string+=e.Space(),e.string+="type='",e.string+=n.getTypeName(),e.string+="'",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(n.getName()),e.string+="'",e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="</ExternProtoDeclare>"},toJSONStream(e){e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ExternProtoDeclare",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+='"',e.string+=e.JSONEncode(this.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak();const t=this.getUserDefinedFields();if(t.length){e.string+=e.Indent(),e.string+='"',e.string+="field",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const n of t)e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@accessType",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.AccessType(n.getAccessType()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@type",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=n.getTypeName(),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n.getName()),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",n!==t.at(-1)&&(e.string+=","),e.string+=e.TidyBreak();e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=",",e.string+=e.TidyBreak()}e.string+=e.Indent(),e.string+='"',e.string+="@url",e.string+='"',e.string+=":",e.string+=e.TidySpace(),this._url.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Reflect.ownKeys(ph.prototype))Object.defineProperty(ph.prototype,e,{enumerable:!1});Object.defineProperties(ph.prototype,{name:{get:ph.prototype.getName,enumerable:!0},fields:{get:ph.prototype.getFieldDefinitions,enumerable:!0},isExternProto:{value:!0,enumerable:!0},urls:{get(){return this._url},enumerable:!0},loadState:{get:ph.prototype.checkLoadState,enumerable:!0}}),Object.defineProperties(ph,{typeName:{value:"X3DExternProtoDeclaration",enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode)]),enumerable:!0}}),c.addNode(ph);const gh=ph;n.set("x_ite/Prototype/X3DExternProtoDeclaration",gh);const fh=gh;function mh(e=[]){return Z.call(this,Array.from(e,(e=>[e.name,e])),fh)}Object.setPrototypeOf(mh.prototype,Z.prototype);for(const e of Reflect.ownKeys(mh.prototype))Object.defineProperty(mh.prototype,e,{enumerable:!1});Object.defineProperties(mh,{typeName:{value:"ExternProtoDeclarationArray",enumerable:!0}});const _h=mh;n.set("x_ite/Prototype/ExternProtoDeclarationArray",_h);const xh=_h;function yh(e=[]){return Z.call(this,Array.from(e,(e=>[e.name,e])),Cr)}Object.setPrototypeOf(yh.prototype,Z.prototype);for(const e of Reflect.ownKeys(yh.prototype))Object.defineProperty(yh.prototype,e,{enumerable:!1});Object.defineProperties(yh,{typeName:{value:"ProtoDeclarationArray",enumerable:!0}});const wh=yh;n.set("x_ite/Prototype/ProtoDeclarationArray",wh);const bh=wh,Sh=Symbol(),vh=Symbol(),Th=Symbol(),Oh=Symbol(),Eh=Symbol();function Ch(e,t,n,i,s){F.call(this,e),this[Sh]=e,this[vh]=t,this[Th]=n,this[Oh]=i,this[Eh]=s,n.addFieldInterest(s),n.addOutputRoute(this),s.addInputRoute(this)}Object.assign(Object.setPrototypeOf(Ch.prototype,F.prototype),{getExecutionContext(){return this[Sh]},getId(){return Ch.getId(this[Th],this[Eh])},getSourceNode(){return this[vh]},getSourceField(){return this[Th]},getDestinationNode(){return this[Oh]},getDestinationField(){return this[Eh]},disconnect(){this[Th].removeFieldInterest(this[Eh]),this[Th].removeOutputRoute(this),this[Eh].removeInputRoute(this)},toVRMLStream(e){const t=e.LocalName(this[vh]),n=e.LocalName(this[Oh]);e.string+=e.Indent(),e.string+="ROUTE",e.string+=e.Space(),e.string+=t,e.string+=".",e.string+=this[Th].getName(),this[Th].getAccessType()===c.inputOutput&&(e.string+="_changed"),e.string+=e.Space(),e.string+="TO",e.string+=e.Space(),e.string+=n,e.string+=".",this[Eh].getAccessType()===c.inputOutput&&(e.string+="set_"),e.string+=this[Eh].getName()},toXMLStream(e){const t=e.LocalName(this[vh]),n=e.LocalName(this[Oh]);e.string+=e.Indent(),e.string+="<ROUTE",e.string+=e.Space(),e.string+="fromNode='",e.string+=e.XMLEncode(t),e.string+="'",e.string+=e.Space(),e.string+="fromField='",e.string+=e.XMLEncode(this[Th].getName()),this[Th].getAccessType()===c.inputOutput&&(e.string+="_changed"),e.string+="'",e.string+=e.Space(),e.string+="toNode='",e.string+=e.XMLEncode(n),e.string+="'",e.string+=e.Space(),e.string+="toField='",this[Eh].getAccessType()===c.inputOutput&&(e.string+="set_"),e.string+=e.XMLEncode(this[Eh].getName()),e.string+="'",e.string+=e.closingTags?"></ROUTE>":"/>"},toJSONStream(e){const t=e.LocalName(this[vh]),n=e.LocalName(this[Oh]);e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ROUTE",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@fromNode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@fromField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this[Th].getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@toNode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@toField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this[Eh].getName()),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"},dispose(){this.disconnect(),this[Sh].deleteRoute(this),F.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(Ch.prototype))Object.defineProperty(Ch.prototype,e,{enumerable:!1});Object.defineProperties(Ch.prototype,{sourceNode:{get(){return Tn.get(this[vh])},enumerable:!0},sourceField:{get(){return this[Th].getName()},enumerable:!0},destinationNode:{get(){return Tn.get(this[Oh])},enumerable:!0},destinationField:{get(){return this[Eh].getName()},enumerable:!0}}),Object.defineProperties(Ch,{typeName:{value:"X3DRoute",enumerable:!0}}),Object.assign(Ch,{getId:(e,t)=>`${e.getId()}.${t.getId()}`});const Nh=Ch;n.set("x_ite/Routing/X3DRoute",Nh);const Fh=Nh;function Ih(e=[]){return Z.call(this,Array.from(e,(e=>[e.getId(),e])),Fh)}Object.setPrototypeOf(Ih.prototype,Z.prototype);for(const e of Reflect.ownKeys(Ih.prototype))Object.defineProperty(Ih.prototype,e,{enumerable:!1});Object.defineProperties(Ih,{typeName:{value:"RouteArray",enumerable:!0}});const Mh=Ih;n.set("x_ite/Routing/RouteArray",Mh);const Ph=Mh,Dh=Symbol(),Rh=Symbol(),Ah=Symbol(),Vh=Symbol(),Lh=Symbol(),Bh=Symbol();function Uh(e,t=null){xs.call(this,e),this.addType(c.X3DExecutionContext),this.addChildObjects("rootNodes",new Qi.MFNode,"worldInfos",new Qi.MFNode,"sceneGraph_changed",new Qi.SFTime),this._rootNodes.setAccessType(c.initializeOnly),this._rootNodes.addCloneCount(1),this[Bh]=t,this[Dh]=new hr,this[Rh]=new wr,this[Ah]=new bh,this[Vh]=new xh,this[Lh]=new Ph,this[Dh].addParent(this),this[Rh].addParent(this),this[Ah].addParent(this),this[Vh].addParent(this),this[Lh].addParent(this)}Object.assign(Object.setPrototypeOf(Uh.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this),this.isScene()||this._sceneGraph_changed.addInterest("set_sceneGraph",this)},set_sceneGraph(){this.getExecutionContext()._sceneGraph_changed=this.getBrowser().getCurrentTime()},isScene:()=>!1,getOuterNode(){return this[Bh]},getSpecificationVersion(){return this.getExecutionContext().getSpecificationVersion()},getEncoding(){return this.getExecutionContext().getEncoding()},getWorldURL(){return this.getExecutionContext().getWorldURL()},getProfile(){return this.getExecutionContext().getProfile()},hasComponent(e){return this.getExecutionContext().hasComponent(e)},getComponents(){return this.getExecutionContext().getComponents()},fromUnit(e,t){return this.getExecutionContext().fromUnit(e,t)},toUnit(e,t){return this.getExecutionContext().toUnit(e,t)},getUnits(){return this.getExecutionContext().getUnits()},createNode(e,t=!0){if(e=String(e),!1===t){const t=this.getBrowser().getConcreteNode(e);if(!t)return null;const n=t.specificationRange;return this.getSpecificationVersion()<n[0]||this.getSpecificationVersion()>n[1]?null:(this.hasComponent(t.componentName)||console.warn(`Node type '${e}' does not match component/profile statements in '${this.getWorldURL()}'.`),new t(this))}{const t=this.getBrowser().getConcreteNode(e);if(!t)throw new Error(`Unknown node type '${e}'.`);const n=t.specificationRange;if(this.getSpecificationVersion()<n[0])throw new Error(`Node type '${e}' does not match specification version in '${this.getWorldURL()}.`);if(this.getSpecificationVersion()>n[1])throw new Error(`Node type '${e}' does not match specification version in '${this.getWorldURL()}.`);this.hasComponent(t.componentName)||console.warn(`Node type '${e}' does not match component/profile statements in '${this.getWorldURL()}'.`);const i=new t(this);return i.setup(),Tn.get(i)}},createProto(e,t=!0){e=String(e);let n=this;for(;;){const i=n.protos.get(e)??n.externprotos.get(e);if(i)return i.createInstance(this,t);if(n.isScene())break;n=n.getExecutionContext()}if(!1===t)return null;throw new Error(`Unknown proto or externproto type '${e}'.`)},addNamedNode(e,t){if(e=String(e),!(t=zl(c.X3DNode,t,!1)))throw new Error("Couldn't add named node: node must be of type X3DNode.");if(t.getExecutionContext()!==this)throw new Error("Couldn't add named node: node does not belong to this execution context.");if(0===e.length)throw new Error("Couldn't add named node: node name is empty.");if(this[Dh].has(e))throw new Error(`Couldn't add named node: node named '${e}' is already in use.`);if(this[Dh].get(t.getName())?.getValue()===t)throw new Error(`Couldn't add named node: node named '${t.getName()}' is already added.`);t.setName(e),this[Dh].add(e,Tn.get(t))},updateNamedNode(e,t){if(e=String(e),!(t=zl(c.X3DNode,t,!1)))throw new Error("Couldn't update named node: node must be of type X3DNode.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update named node: node does not belong to this execution context.");if(0===e.length)throw new Error("Couldn't update named node: node name is empty.");this.removeNamedNode(t.getName()),this.removeNamedNode(e),t.setName(e),this[Dh].add(e,Tn.get(t)),this._namedNodes_changed=this.getBrowser().getCurrentTime()},removeNamedNode(e){e=String(e);const t=this[Dh].get(e);t&&t.getValue()&&(t.getValue().setName(""),this[Dh].remove(e),this._namedNodes_changed=this.getBrowser().getCurrentTime())},getNamedNode(e){e=String(e);const t=this[Dh].get(e);if(t)return t;throw new Error(`Named node '${e}' not found.`)},getNamedNodes(){return this[Dh]},getUniqueName(e){return d(this[Dh],e)},addImportedNode(e,t,n=t){if(t=String(t),n=String(n),this[Rh].has(n))throw new Error(`Couldn't add imported node: imported name '${n}' already in use.`);this.updateImportedNode(e,t,n)},updateImportedNode(e,t,n){if(e=zl(c.Inline,e,!1),t=String(t),n=void 0===n?t:String(n),!e)throw new Error("Node must be of type Inline node.");if(e.getExecutionContext()!==this)throw new Error("Couldn't update imported node: Inline node does not belong to this execution context.");if(0===t.length)throw new Error("Couldn't update imported node: exported name is empty.");if(0===n.length)throw new Error("Couldn't update imported node: imported name is empty.");this.removeImportedNode(n);const i=new _r(this,e,t,n);this[Rh].add(n,i),this._importedNodes_changed=this.getBrowser().getCurrentTime()},removeImportedNode(e){e=String(e);const t=this[Rh].get(e);t&&(t.dispose(),this[Rh].remove(e),this._importedNodes_changed=this.getBrowser().getCurrentTime())},getImportedNode(e){e=String(e);const t=this[Rh].get(e);if(t)return Tn.get(t.getExportedNode());throw new Error(`Imported node '${e}' not found.`)},getImportedNodes(){return this[Rh]},getLocalNode(e){e=String(e);try{return this.getNamedNode(e)}catch{const t=this[Rh].get(e);if(t)return Tn.get(t);throw new Error(`Unknown named or imported node '${e}'.`)}},getLocalName(e){if(!(e=zl(c.X3DNode,e,!1)))throw new Error("Couldn't get local name: node must be of type X3DNode.");if(e.getExecutionContext()===this)return e.getName();for(const t of this[Rh])try{if(t.getExportedNode()===e)return t.getImportedName()}catch{}throw new Error("Couldn't get local name: node is shared.")},setRootNodes(){},getRootNodes(){return this._rootNodes},getProtoDeclaration(e){e=String(e);const t=this[Ah].get(e);if(t)return t;throw new Error(`Proto declaration '${e}' not found.`)},addProtoDeclaration(e,t){if(e=String(e),!(t instanceof Cr))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(t.getExecutionContext()!==this)throw new Error("Couldn't add proto declaration: proto does not belong to this execution context.");if(this[Ah].get(e))throw new Error(`Couldn't add proto declaration: proto '${e}' already in use.`);if(this[Ah].get(t.getName())===t)throw new Error(`Couldn't add proto declaration: proto '${t.getName()}' already added.`);if(0===(e=String(e)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[Ah].add(e,t),t.setName(e),this._protos_changed=this.getBrowser().getCurrentTime()},updateProtoDeclaration(e,t){if(e=String(e),!(t instanceof Cr))throw new Error("Couldn't update proto declaration: proto must be of type X3DProtoDeclaration.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update proto declaration: proto does not belong to this execution context.");if(0===(e=String(e)).length)throw new Error("Couldn't update proto declaration: proto name is empty.");this[Ah].update(t.getName(),e,t),t.setName(e),this._protos_changed=this.getBrowser().getCurrentTime()},removeProtoDeclaration(e){e=String(e),this[Ah].remove(e),this._protos_changed=this.getBrowser().getCurrentTime()},getProtoDeclarations(){return this[Ah]},getUniqueProtoName(e){return d(this[Ah],e)},getExternProtoDeclaration(e){e=String(e);const t=this[Vh].get(e);if(t)return t;throw new Error(`Extern proto declaration '${e}' not found.`)},addExternProtoDeclaration(e,t){if(e=String(e),!(t instanceof fh))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(t.getExecutionContext()!==this)throw new Error("Couldn't add extern proto declaration: extern proto does not belong to this execution context.");if(this[Vh].get(e))throw new Error(`Couldn't add extern proto declaration: extern proto '${e}' already in use.`);if(this[Vh].get(t.getName())===t)throw new Error(`Couldn't add extern proto declaration: extern proto '${t.getName()}' already added.`);if(0===(e=String(e)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[Vh].add(e,t),t.setName(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},updateExternProtoDeclaration(e,t){if(e=String(e),!(t instanceof fh))throw new Error("Couldn't update extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update extern proto declaration: extern proto does not belong to this execution context.");if(0===(e=String(e)).length)throw new Error("Couldn't update extern proto declaration: extern proto name is empty.");this[Vh].update(t.getName(),e,t),t.setName(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},removeExternProtoDeclaration(e){e=String(e),this[Vh].remove(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},getExternProtoDeclarations(){return this[Vh]},getUniqueExternProtoName(e){return d(this[Vh],e)},addRoute(e,t,n,i){if(e=zl(c.X3DNode,e,!1),t=String(t),n=zl(c.X3DNode,n,!1),i=String(i),!e)throw new Error("Bad ROUTE specification: source node must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destination node must be of type X3DNode.");let s=e instanceof _r?e:null,r=n instanceof _r?n:null;try{e.getExecutionContext()!==this&&(s=this.getLocalNode(this.getLocalName(e)).getValue())}catch{}try{n.getExecutionContext()!==this&&(r=this.getLocalNode(this.getLocalName(n)).getValue())}catch{}if(s instanceof _r&&r instanceof _r?(s.addRoute(s,t,r,i),r.addRoute(s,t,r,i)):s instanceof _r?s.addRoute(s,t,n,i):r instanceof _r&&r.addRoute(e,t,r,i),s!==e&&r!==n)return this.addSimpleRoute(e,t,n,i)},addSimpleRoute(e,t,n,i){try{if(t=e.getField(t),i=n.getField(i),!t.isOutput())throw new Error(`Field named '${t.getName()}' in node named '${e.getName()}' of type ${e.getTypeName()} is not an output field.`);if(!i.isInput())throw new Error(`Field named '${i.getName()}' in node named '${n.getName()}' of type ${n.getTypeName()} is not an input field.`);if(t.getType()!==i.getType())throw new Error(`ROUTE types ${t.getTypeName()} and ${i.getTypeName()} do not match.`);const s=Fh.getId(t,i);let r=this[Lh].get(s);return r||(r=new Fh(this,e,t,n,i),this[Lh].add(s,r),this._routes_changed=this.getBrowser().getCurrentTime(),r)}catch(e){throw new Error(`Bad ROUTE specification: ${e.message}`)}},deleteRoute(e){4===arguments.length&&(e=this.getRoute(...arguments)),e instanceof Fh&&e.getExecutionContext()===this&&(this.deleteSimpleRoute(e),this.deleteImportedRoute(e.sourceNode,e.destinationNode,e))},deleteSimpleRoute(e){const t=Fh.getId(e.getSourceField(),e.getDestinationField());this[Lh].remove(t),e.disconnect(),this._routes_changed=this.getBrowser().getCurrentTime()},deleteImportedRoute(e,t,n){let i=null,s=null;try{e.getValue().getExecutionContext()!==this&&(i=this.getLocalNode(this.getLocalName(e)).getValue())}catch{}try{t.getValue().getExecutionContext()!==this&&(s=this.getLocalNode(this.getLocalName(t)).getValue())}catch{}i instanceof _r&&s instanceof _r?(i.deleteRoute(n),s.deleteRoute(n)):i instanceof _r?i.deleteRoute(n):s instanceof _r&&s.deleteRoute(n)},getRoute(e,t,n,i){if(e=zl(c.X3DNode,e,!1),t=String(t),n=zl(c.X3DNode,n,!1),i=String(i),!e)throw new Error("Bad ROUTE specification: sourceNode must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destinationNode must be of type X3DNode.");return t=e.getField(t),i=n.getField(i),this[Lh].get(Fh.getId(t,i))},getRoutes(){return this[Lh]},getWorldInfos(){return this._worldInfos},addWorldInfo(e){this._worldInfos.push(e)},removeWorldInfo(e){for(let t=this._worldInfos.length-1;t>=0;--t)this._worldInfos[t].getValue()===e&&this._worldInfos.splice(t,1)},toVRMLStream(e){e.PushExecutionContext(this),e.EnterScope(),e.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toVRMLStream(e),this.getProtoDeclarations().toVRMLStream(e);const t=this.getRootNodes();for(let n=0,i=t.length;n<i;++n){const s=t[n];e.string+=e.Indent(),s?s.toVRMLStream(e):e.string+="NULL",e.string+=e.TidyBreak(),n!==i-1&&(e.string+=e.TidyBreak())}const n=this.getImportedNodes();n.length&&(e.string+=e.TidyBreak(),n.toVRMLStream(e));const i=this.getRoutes();i.length&&(e.string+=e.TidyBreak(),i.toVRMLStream(e)),e.LeaveScope(),e.PopExecutionContext()},toXMLStream(e){e.PushExecutionContext(this),e.EnterScope(),e.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toXMLStream(e),this.getProtoDeclarations().toXMLStream(e);const t=this.getRootNodes();t.length&&(t.toXMLStream(e),e.string+=e.TidyBreak()),this.getImportedNodes().toXMLStream(e),this.getRoutes().toXMLStream(e),e.LeaveScope(),e.PopExecutionContext()},toJSONStream(e){if(e.PushExecutionContext(this),e.EnterScope(),e.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toJSONStream(e,!0),this.getProtoDeclarations().toJSONStream(e,!0),this.getRootNodes().length)for(const t of this.getRootNodes())e.string+=e.Indent(),t?t.toJSONStream(e):(e.string+=e.Indent(),e.string+="null"),e.string+=",",e.string+=e.TidyBreak();this.getImportedNodes().toJSONStream(e,!0),this.getRoutes().toJSONStream(e,!0),e.LeaveScope(),e.PopExecutionContext()},dispose(){for(const e of[...this[Lh]])this.deleteRoute(e);xs.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(Uh.prototype))Object.defineProperty(Uh.prototype,e,{enumerable:!1});Object.defineProperties(Uh.prototype,{specificationVersion:{get:Uh.prototype.getSpecificationVersion,enumerable:!0},encoding:{get:Uh.prototype.getEncoding,enumerable:!0},profile:{get:Uh.prototype.getProfile,enumerable:!0},components:{get:Uh.prototype.getComponents,enumerable:!0},worldURL:{get:Uh.prototype.getWorldURL,enumerable:!0},units:{get:Uh.prototype.getUnits,enumerable:!0},namedNodes:{get:Uh.prototype.getNamedNodes,enumerable:!0},importedNodes:{get:Uh.prototype.getImportedNodes,enumerable:!0},rootNodes:{get:Uh.prototype.getRootNodes,set:Uh.prototype.setRootNodes,enumerable:!0},protos:{get:Uh.prototype.getProtoDeclarations,enumerable:!0},externprotos:{get:Uh.prototype.getExternProtoDeclarations,enumerable:!0},routes:{get:Uh.prototype.getRoutes,enumerable:!0}}),Object.defineProperties(Uh,{typeName:{value:"X3DExecutionContext",enumerable:!0}}),c.addNode(Uh);const Xh=Uh;n.set("x_ite/Execution/X3DExecutionContext",Xh);const jh=Xh,kh=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),zh=Symbol(),Gh=Symbol(),Hh=Symbol();function qh(e,t){this[zh]=t,this[kh]=new te(t.getFieldDefinitions()),this[Hh]=null,vs.call(this,e),this.addType(c.X3DPrototypeInstance)}Object.assign(Object.setPrototypeOf(qh.prototype,vs.prototype),{create(e){return new qh(e,this[zh])},getTypeName(){return this[zh].getName()},initialize(){vs.prototype.initialize.call(this),this.setProtoNode(this[zh])},construct(){this[Hh]?.dispose();const e=this[zh].getProtoDeclaration();if(!e)return this[Hh]=new jh(this.getExecutionContext(),this),this[Hh].setup(),void(this.isInitialized()&&A.prototype.addEvent.call(this));if(this[zh].isExternProto)for(const t of e.getUserDefinedFields())try{const e=this.getField(t.getName());if(e.getAccessType()!==t.getAccessType())continue;if(e.getType()!==t.getType())continue;if(!e.isInitializable())continue;if(e.getModificationTime())continue;if(e.hasReferences())continue;if(e.equals(t))continue;e.assign(t)}catch{this.addPredefinedField(e.getFieldDefinitions().get(t.getName()))}this[Hh]=new jh(e.getExecutionContext(),this),this.importExternProtos(e.getBody().externprotos),this.importProtos(e.getBody().protos),this.copyRootNodes(e.getBody().rootNodes),this.copyImportedNodes(e.getBody(),e.getBody().getImportedNodes()),this.copyRoutes(e.getBody(),e.getBody().routes),this[Hh].setup(),this.isInitialized()&&A.prototype.addEvent.call(this),this[zh]._updateInstances.removeInterest("construct",this),this[zh]._updateInstances.addInterest("update",this)},update(){this[kh].assign(this[zh].getFieldDefinitions());const e=this[Gh],t=new Map(Array.from(this.getPredefinedFields(),(e=>[e.getName(),e])));for(const e of t.values())this.removePredefinedField(e.getName());this[Gh]=new Map(Array.from(this[zh].getUserDefinedFields(),(e=>[e,e.getName()])));for(const e of this.getFieldDefinitions())this.addPredefinedField(e);for(const n of this[Gh].keys()){const i=e.get(n);if(!i)continue;const s=this.getPredefinedFields().get(n.getName()),r=t.get(i);r.addParent(this),r.setAccessType(s.getAccessType()),r.setName(s.getName()),this.getPredefinedFields().update(s.getName(),s.getName(),r),this.isPrivate()||r.addCloneCount(1),t.delete(i),s.dispose()}for(const e of t.values())e.dispose();this.construct()},getExtendedEventHandling:()=>!1,getProtoNode(){return this[zh]},setProtoNode(e){this[zh]._name_changed.removeFieldInterest(this._typeName_changed),this[zh]._updateInstances.removeInterest("construct",this),this[zh]._updateInstances.removeInterest("update",this),this[zh]=e,this[Gh]=new Map(Array.from(e.getUserDefinedFields(),(e=>[e,e.getName()]))),e._name_changed.addFieldInterest(this._typeName_changed),e.isExternProto?this[zh].checkLoadState()===c.COMPLETE_STATE?this.construct():(e._updateInstances.addInterest("construct",this),e.requestImmediateLoad().catch(Function.prototype)):this.construct()},getBody(){return this[Hh]},getInnerNode(){const e=this[Hh].getRootNodes();if(e.length){const t=e[0];if(t)return t.getValue().getInnerNode()}throw new Error("Root node not available.")},importExternProtos(e){const t=this[Hh].externprotos;for(const n of e)t.add(n.getName(),n)},importProtos(e){const t=this[Hh].protos;for(const n of e)t.add(n.getName(),n)},copyRootNodes(e){const t=this[Hh].getRootNodes();for(const n of e)t.push(n.copy(this))},copyImportedNodes(e,t){for(const e of t)try{const t=this[Hh].getNamedNode(e.getInlineNode().getName()),n=e.getImportedName(),i=e.getExportedName();this[Hh].addImportedNode(t,i,n)}catch(e){console.error("Bad IMPORT specification in copy: ",e)}},copyRoutes(e,t){for(const n of t)try{const t=this[Hh].getLocalNode(e.getLocalName(n.sourceNode)),i=this[Hh].getLocalNode(e.getLocalName(n.destinationNode));this[Hh].addRoute(t,n.sourceField,i,n.destinationField)}catch(e){console.error(e)}},toXMLStream(e){const t=e.IsSharedNode(this);e.EnterScope();const n=e.Name(this);if(n.length&&e.ExistsNode(this)){e.string+=e.Indent(),e.string+="<ProtoInstance",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.getTypeName()),e.string+="'",e.string+=e.Space(),e.string+="USE='",e.string+=e.XMLEncode(n),e.string+="'";const t=e.ContainerField();return t&&t.getName()!==this.getContainerField()&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(t.getName()),e.string+="'"),e.string+=e.closingTags?"></ProtoInstance>":"/>",void e.LeaveScope()}e.string+=e.Indent(),e.string+="<ProtoInstance",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.getTypeName()),e.string+="'",n.length&&(e.AddNode(this),e.string+=e.Space(),e.string+="DEF='",e.string+=e.XMLEncode(n),e.string+="'");const i=e.ContainerField();i&&i.getName()!==this.getContainerField()&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(i.getName()),e.string+="'");const s=this.getChangedFields();if(0===s.length)e.string+=e.closingTags?"></ProtoInstance>":"/>";else{e.string+=">",e.string+=e.TidyBreak(),e.IncIndent();const n=[];for(const i of s){let s=!1;if(e.ExecutionContext()&&i.getAccessType()===c.inputOutput&&0!==i.getReferences().size&&([...i.getReferences()].some((e=>e.isInitializable()))||(s=!this.isDefaultValue(i))),0===i.getReferences().size||!e.ExecutionContext()||t||s)switch(s&&n.push(i),i.getType()){case c.MFNode:e.string+=e.Indent(),e.string+="<fieldValue",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(i.getName()),e.string+="'",0===i.length?(e.string+=e.closingTags?"></fieldValue>":"/>",e.string+=e.TidyBreak()):(e.PushContainerField(i),e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),i.toXMLStream(e),e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</fieldValue>",e.string+=e.TidyBreak(),e.PopContainerField());break;case c.SFNode:if(null!==i.getValue()){e.PushContainerField(null),e.string+=e.Indent(),e.string+="<fieldValue",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(i.getName()),e.string+="'",e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),i.toXMLStream(e),e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</fieldValue>",e.string+=e.TidyBreak(),e.PopContainerField();break}default:e.string+=e.Indent(),e.string+="<fieldValue",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(i.getName()),e.string+="'",e.string+=e.Space(),e.string+="value='",i.toXMLStream(e),e.string+="'",e.string+=e.closingTags?"></fieldValue>":"/>",e.string+=e.TidyBreak()}else n.push(i)}if(n.length&&!t){e.string+=e.Indent(),e.string+="<IS>",e.string+=e.TidyBreak(),e.IncIndent();for(const t of n){const n=t.getReferences();for(const i of n)e.string+=e.Indent(),e.string+="<connect",e.string+=e.Space(),e.string+="nodeField='",e.string+=e.XMLEncode(t.getName()),e.string+="'",e.string+=e.Space(),e.string+="protoField='",e.string+=e.XMLEncode(i.getName()),e.string+="'",e.string+=e.closingTags?"></connect>":"/>",e.string+=e.TidyBreak()}e.DecIndent(),e.string+=e.Indent(),e.string+="</IS>",e.string+=e.TidyBreak()}e.DecIndent(),e.string+=e.Indent(),e.string+="</ProtoInstance>"}e.LeaveScope()},toJSONStream(e){const t=e.IsSharedNode(this);e.EnterScope();const n=e.Name(this);if(n.length&&e.ExistsNode(this))return e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ProtoInstance",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.getTypeName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@USE",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",void e.LeaveScope();e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ProtoInstance",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),n.length&&(e.AddNode(this),e.string+=e.Indent(),e.string+='"',e.string+="@DEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n),e.string+='"',e.string+=",",e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.getTypeName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak();const i=this.getChangedFields(),s=[];if(i.length){e.string+=e.Indent(),e.string+='"',e.string+="fieldValue",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();const n=[];for(const r of i){let i=!1;e.ExecutionContext()&&r.getAccessType()===c.inputOutput&&0!==r.getReferences().size&&([...r.getReferences()].some((e=>e.isInitializable()))||(i=!this.isDefaultValue(r))),0===r.getReferences().size||!e.ExecutionContext()||t||i?(i&&s.push(r),n.push(r)):s.push(r)}for(const t of n){switch(t.getType()){case c.SFNode:e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),t.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}";break;case c.MFNode:e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),t.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}";break;default:e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@value",e.string+='"',e.string+=":",e.string+=e.TidySpace(),t.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}t!==n.at(-1)&&(e.string+=","),e.string+=e.TidyBreak()}if(e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=",",e.string+=e.TidyBreak(),s.length&&!t){e.string+=e.Indent(),e.string+='"',e.string+="IS",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="connect",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const t of s){const n=[...t.getReferences()];for(const i of n)e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@nodeField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@protoField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i.getName()),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",t===s.at(-1)&&i===n.at(-1)||(e.string+=","),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=",",e.string+=e.TidyBreak()}}e.JSONRemoveComma(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.LeaveScope()},dispose(){this[zh]._name_changed.removeFieldInterest(this._typeName_changed),this[zh]._updateInstances.removeInterest("construct",this),this[zh]._updateInstances.removeInterest("update",this),this[Hh]?.dispose(),vs.prototype.dispose.call(this)}}),Object.defineProperties(qh,{typeName:{value:"X3DPrototypeInstance",enumerable:!0},componentName:{value:"Core",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0}});const Yh=qh;n.set("x_ite/Components/Core/X3DPrototypeInstance",Yh);const Wh=Yh,$h={name:"Core",concreteNodes:[Fs,Ps,As,Bs,js,Gs,Qs],abstractNodes:[nr,Ys,Ks,Es,vs,Wh,uu]};n.set("x_ite/Components/Core",$h);const Kh=$h;function Jh(e){vs.call(this,e),this.addType(c.X3DGeometricPropertyNode)}Object.setPrototypeOf(Jh.prototype,vs.prototype),Object.defineProperties(Jh,{typeName:{value:"X3DGeometricPropertyNode",enumerable:!0},componentName:{value:"Rendering",enumerable:!0}});const Zh=Jh;n.set("x_ite/Components/Rendering/X3DGeometricPropertyNode",Zh);const Qh=Zh;function ec(e){Qh.call(this,e),this.addType(c.FogCoordinate),this._depth.setUnit("length")}Object.assign(Object.setPrototypeOf(ec.prototype,Qh.prototype),{initialize(){Qh.prototype.initialize.call(this),this._depth.addInterest("set_depth__",this),this.set_depth__()},set_depth__(){this.depth=this._depth.getValue(),this.length=this._depth.length},isEmpty(){return 0===this.length},getSize(){return this.length},addDepth(e,t){e<this.length?t.push(this.depth[e]):this.length?t.push(this.depth[this.length-1]):t.push(0)},addDepths(e,t){const n=this.length;if(n){const i=this.depth;for(let t=0;t<n;++t)e.push(i[t]);const s=i[n-1];for(let i=n;i<t;++i)e.push(s)}else for(let n=0;n<t;++n)e.push(0)}}),Object.defineProperties(ec,{typeName:{value:"FogCoordinate",enumerable:!0},componentName:{value:"EnvironmentalEffects",enumerable:!0},containerField:{value:"fogCoord",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"depth",new Qi.MFFloat)]),enumerable:!0}});const tc=ec;n.set("x_ite/Components/EnvironmentalEffects/FogCoordinate",tc);const nc=tc;function ic(e){Ys.call(this,e),ul.call(this,e),this.addType(c.LocalFog)}Object.assign(Object.setPrototypeOf(ic.prototype,Ys.prototype),ul.prototype,{initialize(){Ys.prototype.initialize.call(this),ul.prototype.initialize.call(this)},push(e){if(this._enabled.getValue()&&this.getFogType()){const t=this.getFogs().pop();t.set(this,e.getModelViewMatrix().get()),e.getLocalFogs().push(t)}},pop(e){this._enabled.getValue()&&this.getFogType()&&this.getBrowser().getLocalObjects().push(e.getLocalFogs().pop())},dispose(){ul.prototype.dispose.call(this),Ys.prototype.dispose.call(this)}}),Object.defineProperties(ic,{typeName:{value:"LocalFog",enumerable:!0},componentName:{value:"EnvironmentalEffects",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"fogType",new Qi.SFString("LINEAR")),new H(c.inputOutput,"color",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"visibilityRange",new Qi.SFFloat)]),enumerable:!0}});const sc=ic;n.set("x_ite/Components/EnvironmentalEffects/LocalFog",sc);const rc=sc;function oc(e){Al.call(this,e),this.addType(c.TextureBackground)}Object.assign(Object.setPrototypeOf(oc.prototype,Al.prototype),{initialize(){Al.prototype.initialize.call(this),this._frontTexture.addInterest("set_texture__",this,0),this._backTexture.addInterest("set_texture__",this,1),this._leftTexture.addInterest("set_texture__",this,2),this._rightTexture.addInterest("set_texture__",this,3),this._topTexture.addInterest("set_texture__",this,4),this._bottomTexture.addInterest("set_texture__",this,5),this.set_texture__(0,this._frontTexture),this.set_texture__(1,this._backTexture),this.set_texture__(2,this._leftTexture),this.set_texture__(3,this._rightTexture),this.set_texture__(4,this._topTexture),this.set_texture__(5,this._bottomTexture)},set_texture__(e,t){Al.prototype.set_texture__.call(this,zl(c.X3DTextureNode,t),e)}}),Object.defineProperties(oc,{typeName:{value:"TextureBackground",enumerable:!0},componentName:{value:"EnvironmentalEffects",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_bind",new Qi.SFBool),new H(c.inputOutput,"skyAngle",new Qi.MFFloat),new H(c.inputOutput,"skyColor",new Qi.MFColor(new Qi.SFColor)),new H(c.inputOutput,"groundAngle",new Qi.MFFloat),new H(c.inputOutput,"groundColor",new Qi.MFColor),new H(c.inputOutput,"transparency",new Qi.SFFloat),new H(c.outputOnly,"isBound",new Qi.SFBool),new H(c.outputOnly,"bindTime",new Qi.SFTime),new H(c.inputOutput,"frontTexture",new Qi.SFNode),new H(c.inputOutput,"backTexture",new Qi.SFNode),new H(c.inputOutput,"leftTexture",new Qi.SFNode),new H(c.inputOutput,"rightTexture",new Qi.SFNode),new H(c.inputOutput,"topTexture",new Qi.SFNode),new H(c.inputOutput,"bottomTexture",new Qi.SFNode)]),enumerable:!0}});const ac=oc;n.set("x_ite/Components/EnvironmentalEffects/TextureBackground",ac);const lc={name:"EnvironmentalEffects",concreteNodes:[iu,dl,nc,rc,ac],abstractNodes:[Al,ul]};n.set("x_ite/Components/EnvironmentalEffects",lc);const uc=lc;function hc(e){uu.call(this,e),this.addType(c.X3DEnvironmentalSensorNode),this.addChildObjects("traversed",new Qi.SFBool(!0)),this._size.setUnit("length"),this._center.setUnit("length"),this.zeroTest=!1,this.currentTraversed=!0}Object.assign(Object.setPrototypeOf(hc.prototype,uu.prototype),{initialize(){uu.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._size.addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this.set_live__()},set_live__(){!(this._traversed.getValue()&&this.getLive().getValue()&&this._enabled.getValue())||this.zeroTest&&this._size.getValue().equals(Et.Zero)?(this.getBrowser().sensorEvents().removeInterest("update",this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime())):this.getBrowser().sensorEvents().addInterest("update",this)},setZeroTest(e){this.zeroTest=e},getZeroTest(){return this.zeroTest},setTraversed(e){e?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=e},getTraversed(){return this.currentTraversed},update(){}}),Object.defineProperties(hc,{typeName:{value:"X3DEnvironmentalSensorNode",enumerable:!0},componentName:{value:"EnvironmentalSensor",enumerable:!0}});const cc=hc;n.set("x_ite/Components/EnvironmentalSensor/X3DEnvironmentalSensorNode",cc);const dc=cc;function pc(e){dc.call(this,e),this.addType(c.ProximitySensor),this.setCameraObject(!0),this._centerOfRotation_changed.setUnit("length"),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new Et(0,0,0),this.max=new Et(0,0,0),this.layerNode=null,this.modelMatrix=new _n,this.inside=!1}Object.assign(Object.setPrototypeOf(pc.prototype,dc.prototype),{initialize(){dc.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._traversed.addFieldInterest(this._isCameraObject),this.set_enabled__(),this.set_extents__()},set_enabled__(){this.setCameraObject(this._enabled.getValue()),this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},set_extents__(){const e=this._size.getValue(),t=this._center.getValue(),n=e.x/2,i=e.y/2,s=e.z/2,r=t.x,o=t.y,a=t.z;this.min.set(r-n,o-i,a-s),this.max.set(r+n,o+i,a+s)},update:function(){const e=new _n,t=new _n,n=new Et(0,0,0),i=new dn,s=new Et(0,0,0);return function(){if(this.inside&&this.getTraversed()){if(this.layerNode){const r=this.layerNode.getViewpoint(),o=this.modelMatrix;t.assign(r.getModelMatrix()),t.translate(r.getUserCenterOfRotation()),t.multRight(e.assign(o).inverse()),o.multRight(r.getViewMatrix()),o.get(null,i),o.inverse(),n.set(o[12],o[13],o[14]),i.inverse(),s.set(t[12],t[13],t[14]),this._isActive.getValue()?(this._position_changed.getValue().equals(n)||(this._position_changed=n),this._orientation_changed.getValue().equals(i)||(this._orientation_changed=i),this._centerOfRotation_changed.getValue().equals(s)||(this._centerOfRotation_changed=s)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=n,this._orientation_changed=i,this._centerOfRotation_changed=s)}}else this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());this.inside=!1,this.layerNode=null,this.setTraversed(!1)}}(),traverse:function(){const e=new _n,t=new Et(-1,-1,-1);return function(n,i){switch(n){case Na.CAMERA:return this.layerNode=i.getLayer(),void this.modelMatrix.assign(i.getModelViewMatrix().get());case Na.DISPLAY:if(this.setTraversed(!0),this.inside)return;return void(this._size.getValue().equals(t)?this.inside=!0:(e.assign(i.getModelViewMatrix().get()).inverse(),this.inside=this.containsPoint(e.origin)))}}}(),containsPoint(e){const t=this.min,n=this.max;return t.x<=e.x&&n.x>=e.x&&t.y<=e.y&&n.y>=e.y&&t.z<=e.z&&n.z>=e.z}}),Object.defineProperties(pc,{typeName:{value:"ProximitySensor",enumerable:!0},componentName:{value:"EnvironmentalSensor",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"size",new Qi.SFVec3f),new H(c.inputOutput,"center",new Qi.SFVec3f),new H(c.outputOnly,"enterTime",new Qi.SFTime),new H(c.outputOnly,"exitTime",new Qi.SFTime),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"position_changed",new Qi.SFVec3f),new H(c.outputOnly,"orientation_changed",new Qi.SFRotation),new H(c.outputOnly,"centerOfRotation_changed",new Qi.SFVec3f)]),enumerable:!0}});const gc=pc;n.set("x_ite/Components/EnvironmentalSensor/ProximitySensor",gc);const fc=gc,mc=sl(_n),_c=sl(_n);function xc(e){dc.call(this,e),this.addType(c.TransformSensor),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new Et,this.max=new Et,this.targetObjectNode=null,this.modelMatrices=[],this.targetMatrices=[]}Object.assign(Object.setPrototypeOf(xc.prototype,dc.prototype),{initialize(){dc.prototype.initialize.call(this),this.getLive().addInterest("set_enabled__",this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._targetObject.addInterest("set_targetObject__",this),this.set_extents__(),this.set_targetObject__()},set_live__(){},set_enabled__(){this.getLive().getValue()&&this.targetObjectNode&&this._enabled.getValue()&&!this._size.getValue().equals(Et.Zero)?(this.setPickableObject(!0),this.getBrowser().addTransformSensor(this),this.targetObjectNode.addTransformSensor(this)):(this.setPickableObject(!1),this.getBrowser().removeTransformSensor(this),this.targetObjectNode&&this.targetObjectNode.removeTransformSensor(this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()))},set_extents__(){const e=this._size.getValue(),t=this._center.getValue(),n=e.x/2,i=e.y/2,s=e.z/2,r=t.x,o=t.y,a=t.z;this.min.set(r-n,o-i,a-s),this.max.set(r+n,o+i,a+s)},set_targetObject__(){this.targetObjectNode=null;try{const e=this._targetObject.getValue().getInnerNode(),t=e.getType();for(let n=t.length-1;n>=0;--n){switch(t[n]){case c.X3DGroupingNode:case c.X3DShapeNode:this.targetObjectNode=e;break;default:continue}break}}catch{}this.set_enabled__()},traverse(e,t){e===Na.PICKING&&this.isPickableObject()&&this.modelMatrices.push(mc.pop().assign(t.getModelViewMatrix().get()))},collect(e){this.targetMatrices.push(_c.pop().assign(e))},process:function(){const e=new Et(0,0,0),t=new dn;return function(){const n=this.modelMatrices,i=this.targetMatrices,s=this.intersects();s?(s.get(e,t),this._isActive.getValue()?(this._position_changed.getValue().equals(e)||(this._position_changed=e),this._orientation_changed.getValue().equals(t)||(this._orientation_changed=t)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=e,this._orientation_changed=t)):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());for(const e of n)mc.push(e);for(const e of i)_c.push(e);n.length=0,i.length=0}}(),intersects:function(){const e=new Et(-1,-1,-1);return function(){const t=this.modelMatrices,n=this.targetMatrices,i=this._size.getValue().equals(e);for(const e of t){const t=e.inverse();for(const e of n){const n=e.multRight(t);if(i||this.containsPoint(n.origin))return n}}return null}}(),containsPoint(e){const t=this.min,n=this.max;return t.x<=e.x&&n.x>=e.x&&t.y<=e.y&&n.y>=e.y&&t.z<=e.z&&n.z>=e.z}}),Object.defineProperties(xc,{typeName:{value:"TransformSensor",enumerable:!0},componentName:{value:"EnvironmentalSensor",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"size",new Qi.SFVec3f),new H(c.inputOutput,"center",new Qi.SFVec3f),new H(c.outputOnly,"enterTime",new Qi.SFTime),new H(c.outputOnly,"exitTime",new Qi.SFTime),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"position_changed",new Qi.SFVec3f),new H(c.outputOnly,"orientation_changed",new Qi.SFRotation),new H(c.inputOutput,"targetObject",new Qi.SFNode)]),enumerable:!0}});const yc=xc;n.set("x_ite/Components/EnvironmentalSensor/TransformSensor",yc);const wc=yc;function bc(e){dc.call(this,e),this.addType(c.VisibilitySensor),this.setZeroTest(!1),this.visible=!1}Object.assign(Object.setPrototypeOf(bc.prototype,dc.prototype),{initialize(){dc.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__(){this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},update(){this.visible&&this.getTraversed()?(this._isActive.getValue()||(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime()),this.visible=!1):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()),this.setTraversed(!1)},traverse:function(){const e=new La,t=new Et(-1,-1,-1);return function(n,i){n===Na.DISPLAY&&(this.setTraversed(!0),this.visible||(this._size.getValue().equals(t)?this.visible=!0:(e.set(this._size.getValue(),this._center.getValue()).multRight(i.getModelViewMatrix().get()),this.visible=i.getViewVolume().intersectsBox(e))))}}()}),Object.defineProperties(bc,{typeName:{value:"VisibilitySensor",enumerable:!0},componentName:{value:"EnvironmentalSensor",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"size",new Qi.SFVec3f),new H(c.inputOutput,"center",new Qi.SFVec3f),new H(c.outputOnly,"enterTime",new Qi.SFTime),new H(c.outputOnly,"exitTime",new Qi.SFTime),new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const Sc=bc;n.set("x_ite/Components/EnvironmentalSensor/VisibilitySensor",Sc);const vc={name:"EnvironmentalSensor",concreteNodes:[fc,wc,Sc],abstractNodes:[dc]};n.set("x_ite/Components/EnvironmentalSensor",vc);const Tc=vc;function Oc(e){Ys.call(this,e),this.addType(c.X3DFollowerNode),this.buffer=[],this.a=this.getVector(),this.vector=this.getVector()}Object.assign(Object.setPrototypeOf(Oc.prototype,Ys.prototype),{initialize(){Ys.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this)},getBuffer(){return this.buffer},getValue(){return this._set_value.getValue()},getDestination(){return this._set_destination.getValue()},getInitialValue(){return this._initialValue.getValue()},getInitialDestination(){return this._initialDestination.getValue()},setValue(e){this._value_changed=e},setDestination(e){this.destination.assign(e)},duplicate:e=>e.copy(),assign(e,t,n){e[t].assign(n)},equals(e,t,n){return this.a.assign(e).subtract(t).magnitude()<n},interpolate(e,t,n){return this.vector.assign(e).lerp(t,n)},set_live__(){(this.getLive().getValue()||this.isPrivate())&&this._isActive.getValue()?(this.getBrowser().prepareEvents().addInterest("prepareEvents",this),this.getBrowser().addBrowserEvent()):this.getBrowser().prepareEvents().removeInterest("prepareEvents",this)},set_active(e){e!==this._isActive.getValue()&&(this._isActive=e,this.set_live__())}}),Object.defineProperties(Oc,{typeName:{value:"X3DFollowerNode",enumerable:!0},componentName:{value:"Followers",enumerable:!0}});const Ec=Oc;n.set("x_ite/Components/Followers/X3DFollowerNode",Ec);const Cc=Ec;function Nc(e){Cc.call(this,e),this.addType(c.X3DChaserNode),this.destination=null,this.previousValue=null,this.bufferEndTime=0,this.stepTime=0,this.deltaOut=this.getVector()}Object.assign(Object.setPrototypeOf(Nc.prototype,Cc.prototype),{initialize(){Cc.prototype.initialize.call(this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this),this._duration.addInterest("set_duration__",this),this.set_duration__();var e=this.getBuffer(),t=this.getInitialValue(),n=this.getInitialDestination(),i=this.getNumBuffers();this.bufferEndTime=this.getBrowser().getCurrentTime(),this.previousValue=this.duplicate(t),e[0]=this.duplicate(n);for(var s=1;s<i;++s)e[s]=this.duplicate(t);this.destination=this.duplicate(n),this.equals(n,t,this.getTolerance())?this.setValue(n):this.set_active(!0)},getNumBuffers:()=>60,getTolerance:()=>1e-8,getArray(){return this.getVector()},setPreviousValue(e){this.previousValue.assign(e)},step(e,t,n){this.output.add(this.deltaOut.assign(e).subtract(t).multiply(n))},stepResponse(e){if(e<=0)return 0;var t=this._duration.getValue();return e>=t?1:.5-.5*Math.cos(e/t*Math.PI)},set_value__(){this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime());for(var e=this.getBuffer(),t=this.getValue(),n=0,i=e.length;n<i;++n)this.assign(e,n,t);this.setPreviousValue(t),this.setValue(t),this.set_active(!0)},set_destination__(){this.setDestination(this.getDestination()),this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime()),this.set_active(!0)},set_duration__(){this.stepTime=this._duration.getValue()/this.getNumBuffers()},prepareEvents(){var e=this.getBuffer(),t=e.length,n=this.updateBuffer();this.output=this.interpolate(this.previousValue,e[t-1],this.stepResponse((t-1+n)*this.stepTime));for(var i=t-2;i>=0;--i)this.step(e[i],e[i+1],this.stepResponse((i+n)*this.stepTime));this.setValue(this.output),this.equals(this.output,this.destination,this.getTolerance())&&this.set_active(!1)},updateBuffer(){var e=this.getBuffer(),t=e.length,n=(this.getBrowser().getCurrentTime()-this.bufferEndTime)/this.stepTime;if(n>=1){var i=Math.floor(n);if(n-=i,i<t){this.setPreviousValue(e[t-i]);for(var s=t-1;s>=i;--s)this.assign(e,s,e[s-i]);for(s=0;s<i;++s){var r=s/i;this.assign(e,s,this.interpolate(this.destination,e[i],r))}}else{this.setPreviousValue(i==t?e[0]:this.destination);for(s=0;s<t;++s)this.assign(e,s,this.destination)}this.bufferEndTime+=i*this.stepTime}return n}}),Object.defineProperties(Nc,{typeName:{value:"X3DChaserNode",enumerable:!0},componentName:{value:"Followers",enumerable:!0}});const Fc=Nc;n.set("x_ite/Components/Followers/X3DChaserNode",Fc);const Ic=Fc;var Mc=new Et(0,0,0),Pc=new Et(0,0,0),Dc=new Et(0,0,0),Rc=new Et(0,0,0);function Ac(e){Ic.call(this,e),this.addType(c.ColorChaser)}Object.assign(Object.setPrototypeOf(Ac.prototype,Ic.prototype),{getVector:()=>new Et(0,0,0),getValue(){return this._set_value.getValue().getHSV(Rc)},getDestination(){return this._set_destination.getValue().getHSV(Rc)},getInitialValue(){return this._initialValue.getValue().getHSV(Mc)},getInitialDestination(){return this._initialDestination.getValue().getHSV(Pc)},setValue(e){this._value_changed.setHSV(e.x,e.y,e.z)},interpolate:(e,t,n)=>De.lerp(e,t,n,Rc),step(e,t,n){Dc.assign(this.output).add(e).subtract(t),De.lerp(this.output,Dc,n,this.output)}}),Object.defineProperties(Ac,{typeName:{value:"ColorChaser",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.3","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFColor),new H(c.inputOnly,"set_destination",new Qi.SFColor),new H(c.initializeOnly,"initialValue",new Qi.SFColor(.8,.8,.8)),new H(c.initializeOnly,"initialDestination",new Qi.SFColor(.8,.8,.8)),new H(c.initializeOnly,"duration",new Qi.SFTime(1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFColor)]),enumerable:!0}});const Vc=Ac;n.set("x_ite/Components/Followers/ColorChaser",Vc);const Lc=Vc;function Bc(e){Cc.call(this,e),this.addType(c.X3DDamperNode)}Object.assign(Object.setPrototypeOf(Bc.prototype,Cc.prototype),{initialize(){Cc.prototype.initialize.call(this),this._order.addInterest("set_order__",this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this);var e=this.getBuffer(),t=this.getInitialValue(),n=this.getInitialDestination();e[0]=this.duplicate(n);for(var i=1,s=this.getOrder()+1;i<s;++i)e[i]=this.duplicate(t);this.equals(n,t,this.getTolerance())?this.setValue(n):this.set_active(!0)},getOrder(){return f.clamp(this._order.getValue(),0,5)},getTolerance(){return this._tolerance.getValue()<0?1e-4:this._tolerance.getValue()},prepareEvents(){var e=this.getBuffer(),t=e.length-1;if(this._tau.getValue()){for(var n=1/this.getBrowser().currentFrameRate,i=Math.exp(-n/this._tau.getValue()),s=0;s<t;++s)this.assign(e,s+1,this.interpolate(e[s],e[s+1],i));if(this.setValue(e[t]),!this.equals(e[t],e[0],this.getTolerance()))return}else this.setValue(e[0]),t=0;s=1;for(var r=e.length;s<r;++s)this.assign(e,s,e[t]);this.set_active(!1)},set_value__(){for(var e=this.getBuffer(),t=this.getValue(),n=1,i=e.length;n<i;++n)this.assign(e,n,t);this.setValue(t),this.set_active(!0)},set_destination__(){this.assign(this.getBuffer(),0,this.getDestination()),this.set_active(!0)},set_order__(){for(var e=this.getBuffer(),t=e[e.length-1],n=e.length,i=this.getOrder()+1;n<i;++n)e[n]=this.duplicate(t);e.length=i}}),Object.defineProperties(Bc,{typeName:{value:"X3DDamperNode",enumerable:!0},componentName:{value:"Followers",enumerable:!0}});const Uc=Bc;n.set("x_ite/Components/Followers/X3DDamperNode",Uc);const Xc=Uc;var jc=new Et(0,0,0),kc=new Et(0,0,0),zc=new Et(0,0,0),Gc=new Et(0,0,0);function Hc(e){Xc.call(this,e),this.addType(c.ColorDamper)}Object.assign(Object.setPrototypeOf(Hc.prototype,Xc.prototype),{getVector:()=>new Et(0,0,0),getValue(){return this._set_value.getValue().getHSV(Gc)},getDestination(){return this._set_destination.getValue().getHSV(Gc)},getInitialValue(){return this._initialValue.getValue().getHSV(kc)},getInitialDestination(){return this._initialDestination.getValue().getHSV(zc)},setValue(e){this._value_changed.setHSV(e.x,e.y,e.z)},equals:(e,t,n)=>jc.assign(e).subtract(t).magnitude()<n,interpolate:(e,t,n)=>De.lerp(e,t,n,Gc)}),Object.defineProperties(Hc,{typeName:{value:"ColorDamper",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFColor),new H(c.inputOnly,"set_destination",new Qi.SFColor),new H(c.initializeOnly,"initialValue",new Qi.SFColor(.8,.8,.8)),new H(c.initializeOnly,"initialDestination",new Qi.SFColor(.8,.8,.8)),new H(c.initializeOnly,"order",new Qi.SFInt32(3)),new H(c.inputOutput,"tau",new Qi.SFTime(.3)),new H(c.inputOutput,"tolerance",new Qi.SFFloat(-1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFColor)]),enumerable:!0}});const qc=Hc;n.set("x_ite/Components/Followers/ColorDamper",qc);const Yc=qc;const Wc=function(e){function t(){this.array=this.getArray(),this.zero=this.getVector()}return Object.assign(t.prototype,{getArray(){const e=[];return e.assign=function(e){if(Array.isArray(e)){for(var t=0,n=Math.min(this.length,e.length);t<n;++t)this[t].assign(e[t]);for(t=n,n=e.length;t<n;++t)this[t]=e[t].copy();this.length=n}else{for(t=0,n=Math.min(this.length,e.length);t<n;++t)this[t].assign(e[t].getValue());for(t=n,n=e.length;t<n;++t)this[t]=e[t].getValue().copy();this.length=n}},e},getValue(){return this._set_value},getDestination(){return this._set_destination},getInitialValue(){return this._initialValue},getInitialDestination(){return this._initialDestination},setValue(e){if(Array.isArray(e)){const i=this._value_changed;for(var t=0,n=e.length;t<n;++t)i[t]=e[t];i.length=n}else this._value_changed=e},duplicate(e){const t=this.getArray();return t.assign(e),t},equals(e,t,n){if(e.length!==t.length)return!1;const i=this.a;let s=0;for(let n=0,r=e.length;n<r;++n)s=Math.max(i.assign(e[n]).subtract(t[n]).magnitude());return s<n},interpolate(e,t,n){const i=this.array;i.assign(e);for(let e=0,s=i.length;e<s;++e)i[e].lerp(t[e]||this.zero,n);return i},set_destination__(){const t=this.getBuffer(),n=this._set_destination.length;for(let e=0,i=t.length;e<i;++e){const i=t[e];for(let e=i.length;e<n;++e)i[e]=this.getVector();i.length=n}e.prototype.set_destination__.call(this)}}),t};n.set("x_ite/Browser/Followers/X3DArrayFollowerTemplate",Wc);const $c=Wc;const Kc=function(e){const t=$c(e);function n(){t.call(this),this.array=this.getArray()}return Object.assign(n.prototype,t.prototype,{step(e,t,n){const i=this.output,s=this.deltaOut;for(let r=0,o=i.length;r<o;++r)i[r].add(s.assign(e[r]||this.zero).subtract(t[r]||this.zero).multiply(n))}}),n};n.set("x_ite/Browser/Followers/X3DArrayChaserTemplate",Kc);const Jc=Kc;var Zc=Jc(Ic);function Qc(e){Ic.call(this,e),Zc.call(this,e),this.addType(c.CoordinateChaser)}Object.assign(Object.setPrototypeOf(Qc.prototype,Ic.prototype),Zc.prototype,{getVector:()=>new Et(0,0,0)}),Object.defineProperties(Qc,{typeName:{value:"CoordinateChaser",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.3","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.MFVec3f),new H(c.inputOnly,"set_destination",new Qi.MFVec3f),new H(c.initializeOnly,"initialValue",new Qi.MFVec3f(new Et(0,0,0))),new H(c.initializeOnly,"initialDestination",new Qi.MFVec3f(new Et(0,0,0))),new H(c.initializeOnly,"duration",new Qi.SFTime(1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.MFVec3f)]),enumerable:!0}});const ed=Qc;n.set("x_ite/Components/Followers/CoordinateChaser",ed);const td=ed;var nd=$c(Xc);function id(e){Xc.call(this,e),nd.call(this,e),this.addType(c.CoordinateDamper)}Object.assign(Object.setPrototypeOf(id.prototype,Xc.prototype),nd.prototype,{getVector:()=>new Et(0,0,0)}),Object.defineProperties(id,{typeName:{value:"CoordinateDamper",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.MFVec3f),new H(c.inputOnly,"set_destination",new Qi.MFVec3f),new H(c.initializeOnly,"initialValue",new Qi.MFVec3f(new Et(0,0,0))),new H(c.initializeOnly,"initialDestination",new Qi.MFVec3f(new Et(0,0,0))),new H(c.initializeOnly,"order",new Qi.SFInt32(3)),new H(c.inputOutput,"tau",new Qi.SFTime(.3)),new H(c.inputOutput,"tolerance",new Qi.SFFloat(-1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.MFVec3f)]),enumerable:!0}});const sd=id;n.set("x_ite/Components/Followers/CoordinateDamper",sd);const rd=sd;var od=new dn,ad=new dn;function ld(e){Ic.call(this,e),this.addType(c.OrientationChaser),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}Object.assign(Object.setPrototypeOf(ld.prototype,Ic.prototype),{getVector:()=>new dn,equals:(e,t,n)=>(od.assign(e).inverse().multRight(t),Math.abs(od.angle)<n),interpolate:(e,t,n)=>ad.assign(e).slerp(t,n),step(e,t,n){this.deltaOut.assign(t).inverse().multRight(e).multLeft(this.output),this.output.slerp(this.deltaOut,n)}}),Object.defineProperties(ld,{typeName:{value:"OrientationChaser",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFRotation),new H(c.inputOnly,"set_destination",new Qi.SFRotation),new H(c.initializeOnly,"initialValue",new Qi.SFRotation),new H(c.initializeOnly,"initialDestination",new Qi.SFRotation),new H(c.initializeOnly,"duration",new Qi.SFTime(1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFRotation)]),enumerable:!0}});const ud=ld;n.set("x_ite/Components/Followers/OrientationChaser",ud);const hd=ud;var cd=new dn,dd=new dn;function pd(e){Xc.call(this,e),this.addType(c.OrientationDamper),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}Object.assign(Object.setPrototypeOf(pd.prototype,Xc.prototype),{getVector:()=>new dn,equals:(e,t,n)=>(cd.assign(e).inverse().multRight(t),Math.abs(cd.angle)<n),interpolate:(e,t,n)=>dd.assign(e).slerp(t,n)}),Object.defineProperties(pd,{typeName:{value:"OrientationDamper",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFRotation),new H(c.inputOnly,"set_destination",new Qi.SFRotation),new H(c.initializeOnly,"initialValue",new Qi.SFRotation),new H(c.initializeOnly,"initialDestination",new Qi.SFRotation),new H(c.initializeOnly,"order",new Qi.SFInt32(3)),new H(c.inputOutput,"tau",new Qi.SFTime(.3)),new H(c.inputOutput,"tolerance",new Qi.SFFloat(-1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFRotation)]),enumerable:!0}});const gd=pd;n.set("x_ite/Components/Followers/OrientationDamper",gd);const fd=gd;function md(e){Ic.call(this,e),this.addType(c.PositionChaser)}Object.assign(Object.setPrototypeOf(md.prototype,Ic.prototype),{getVector:()=>new Et(0,0,0)}),Object.defineProperties(md,{typeName:{value:"PositionChaser",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFVec3f),new H(c.inputOnly,"set_destination",new Qi.SFVec3f),new H(c.initializeOnly,"initialValue",new Qi.SFVec3f),new H(c.initializeOnly,"initialDestination",new Qi.SFVec3f),new H(c.initializeOnly,"duration",new Qi.SFTime(1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFVec3f)]),enumerable:!0}});const _d=md;n.set("x_ite/Components/Followers/PositionChaser",_d);const xd=_d;function yd(e){Ic.call(this,e),this.addType(c.PositionChaser2D)}Object.assign(Object.setPrototypeOf(yd.prototype,Ic.prototype),{getVector:()=>new wt(0,0)}),Object.defineProperties(yd,{typeName:{value:"PositionChaser2D",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFVec2f),new H(c.inputOnly,"set_destination",new Qi.SFVec2f),new H(c.initializeOnly,"initialValue",new Qi.SFVec2f),new H(c.initializeOnly,"initialDestination",new Qi.SFVec2f),new H(c.initializeOnly,"duration",new Qi.SFTime(1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFVec2f)]),enumerable:!0}});const wd=yd;n.set("x_ite/Components/Followers/PositionChaser2D",wd);const bd=wd;function Sd(e){Xc.call(this,e),this.addType(c.PositionDamper)}Object.assign(Object.setPrototypeOf(Sd.prototype,Xc.prototype),{getVector:()=>new Et(0,0,0)}),Object.defineProperties(Sd,{typeName:{value:"PositionDamper",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFVec3f),new H(c.inputOnly,"set_destination",new Qi.SFVec3f),new H(c.initializeOnly,"initialValue",new Qi.SFVec3f),new H(c.initializeOnly,"initialDestination",new Qi.SFVec3f),new H(c.initializeOnly,"order",new Qi.SFInt32(3)),new H(c.inputOutput,"tolerance",new Qi.SFFloat(-1)),new H(c.inputOutput,"tau",new Qi.SFTime(.3)),new H(c.outputOnly,"value_changed",new Qi.SFVec3f),new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const vd=Sd;n.set("x_ite/Components/Followers/PositionDamper",vd);const Td=vd;function Od(e){Xc.call(this,e),this.addType(c.PositionDamper2D)}Object.assign(Object.setPrototypeOf(Od.prototype,Xc.prototype),{getVector:()=>new wt(0,0)}),Object.defineProperties(Od,{typeName:{value:"PositionDamper2D",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFVec2f),new H(c.inputOnly,"set_destination",new Qi.SFVec2f),new H(c.initializeOnly,"initialValue",new Qi.SFVec2f),new H(c.initializeOnly,"initialDestination",new Qi.SFVec2f),new H(c.initializeOnly,"order",new Qi.SFInt32(3)),new H(c.inputOutput,"tau",new Qi.SFTime(.3)),new H(c.inputOutput,"tolerance",new Qi.SFFloat(-1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFVec2f)]),enumerable:!0}});const Ed=Od;n.set("x_ite/Components/Followers/PositionDamper2D",Ed);const Cd=Ed;function Nd(e){Ic.call(this,e),this.addType(c.ScalarChaser)}Object.assign(Object.setPrototypeOf(Nd.prototype,Ic.prototype),{getVector:()=>0,setPreviousValue(e){this.previousValue=e},setDestination(e){this.destination=e},duplicate:e=>e,assign(e,t,n){e[t]=n},equals:(e,t,n)=>Math.abs(e-t)<n,interpolate:(e,t,n)=>f.lerp(e,t,n),step(e,t,n){this.output+=(e-t)*n}}),Object.defineProperties(Nd,{typeName:{value:"ScalarChaser",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFFloat),new H(c.inputOnly,"set_destination",new Qi.SFFloat),new H(c.initializeOnly,"initialValue",new Qi.SFFloat),new H(c.initializeOnly,"initialDestination",new Qi.SFFloat),new H(c.initializeOnly,"duration",new Qi.SFTime(1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFFloat)]),enumerable:!0}});const Fd=Nd;n.set("x_ite/Components/Followers/ScalarChaser",Fd);const Id=Fd;function Md(e){Xc.call(this,e),this.addType(c.ScalarDamper)}Object.assign(Object.setPrototypeOf(Md.prototype,Xc.prototype),{getVector:()=>0,duplicate:e=>e,assign(e,t,n){e[t]=n},equals:(e,t,n)=>Math.abs(e-t)<n,interpolate:(e,t,n)=>f.lerp(e,t,n)}),Object.defineProperties(Md,{typeName:{value:"ScalarDamper",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.3","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.SFFloat),new H(c.inputOnly,"set_destination",new Qi.SFFloat),new H(c.initializeOnly,"initialValue",new Qi.SFFloat),new H(c.initializeOnly,"initialDestination",new Qi.SFFloat),new H(c.initializeOnly,"order",new Qi.SFInt32(3)),new H(c.inputOutput,"tau",new Qi.SFTime(.3)),new H(c.inputOutput,"tolerance",new Qi.SFFloat(-1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFFloat)]),enumerable:!0}});const Pd=Md;n.set("x_ite/Components/Followers/ScalarDamper",Pd);const Dd=Pd;var Rd=Jc(Ic);function Ad(e){Ic.call(this,e),Rd.call(this,e),this.addType(c.TexCoordChaser2D)}Object.assign(Object.setPrototypeOf(Ad.prototype,Ic.prototype),Rd.prototype,{getVector:()=>new wt(0,0)}),Object.defineProperties(Ad,{typeName:{value:"TexCoordChaser2D",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.3","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.MFVec2f),new H(c.inputOnly,"set_destination",new Qi.MFVec2f),new H(c.initializeOnly,"initialValue",new Qi.MFVec2f),new H(c.initializeOnly,"initialDestination",new Qi.MFVec2f),new H(c.initializeOnly,"duration",new Qi.SFTime(1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.MFVec2f)]),enumerable:!0}});const Vd=Ad;n.set("x_ite/Components/Followers/TexCoordChaser2D",Vd);const Ld=Vd;var Bd=$c(Xc);function Ud(e){Xc.call(this,e),Bd.call(this,e),this.addType(c.TexCoordDamper2D)}Object.assign(Object.setPrototypeOf(Ud.prototype,Xc.prototype),Bd.prototype,{getVector:()=>new wt(0,0,0)}),Object.defineProperties(Ud,{typeName:{value:"TexCoordDamper2D",enumerable:!0},componentName:{value:"Followers",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_value",new Qi.MFVec2f),new H(c.inputOnly,"set_destination",new Qi.MFVec2f),new H(c.initializeOnly,"initialValue",new Qi.MFVec2f),new H(c.initializeOnly,"initialDestination",new Qi.MFVec2f),new H(c.initializeOnly,"order",new Qi.SFInt32(3)),new H(c.inputOutput,"tau",new Qi.SFTime(.3)),new H(c.inputOutput,"tolerance",new Qi.SFFloat(-1)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.MFVec2f)]),enumerable:!0}});const Xd=Ud;n.set("x_ite/Components/Followers/TexCoordDamper2D",Xd);const jd={name:"Followers",concreteNodes:[Lc,Yc,td,rd,hd,fd,xd,bd,Td,Cd,Id,Dd,Ld,Xd],abstractNodes:[Ic,Xc,Cc]};n.set("x_ite/Components/Followers",jd);const kd=jd;function zd(e){Sl.call(this,e),this.addType(c.Box),this._size.setUnit("length")}Object.assign(Object.setPrototypeOf(zd.prototype,Sl.prototype),{build:function(){const e=new Et(2,2,2);return function(){const t=this.getBrowser().getBoxOptions().getGeometry(),n=this._size.getValue();if(this.setMultiTexCoords(t.getMultiTexCoords()),this.setNormals(t.getNormals()),n.equals(e))this.setVertices(t.getVertices()),this.getMin().assign(t.getMin()),this.getMax().assign(t.getMax());else{const e=Math.abs(n.x/2),i=Math.abs(n.y/2),s=Math.abs(n.z/2),r=t.getVertices().getValue(),o=this.getVertices();for(let t=0,n=r.length;t<n;t+=4)o.push(e*r[t],i*r[t+1],s*r[t+2],1);this.getMin().set(-e,-i,-s),this.getMax().set(e,i,s)}this.setSolid(this._solid.getValue())}}()}),Object.defineProperties(zd,{typeName:{value:"Box",enumerable:!0},componentName:{value:"Geometry3D",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"size",new Qi.SFVec3f(2,2,2)),new H(c.initializeOnly,"solid",new Qi.SFBool(!0))]),enumerable:!0}});const Gd=zd;n.set("x_ite/Components/Geometry3D/Box",Gd);const Hd=Gd;function qd(e){Sl.call(this,e),this.addType(c.Cone),this._height.setUnit("length"),this._bottomRadius.setUnit("length")}Object.assign(Object.setPrototypeOf(qd.prototype,Sl.prototype),{set_live__(){Sl.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getConeOptions().addInterest("requestRebuild",this):this.getBrowser().getConeOptions().removeInterest("requestRebuild",this)},build(){const e=this.getBrowser().getConeOptions()._xDimension.getValue(),t=this._height.getValue(),n=this._bottomRadius.getValue(),i=this.getTexCoords(),s=this.getNormals(),r=this.getVertices();this.getMultiTexCoords().push(i);const o=t/2,a=-o,l=Ro.Polar(1,-Math.PI/2+Math.atan(n/t));if(this._side.getValue())for(let t=0;t<e;++t){const u=(t+.5)/e,h=2*Math.PI*u,c=Ro.Polar(l.imag,h),d=t/e,p=2*Math.PI*d,g=Ro.Polar(-n,p),f=Ro.Polar(l.imag,p),m=(t+1)/e,_=2*Math.PI*m,x=Ro.Polar(-n,_),y=Ro.Polar(l.imag,_);i.push(u,1,0,1),s.push(c.imag,l.real,c.real),r.push(0,o,0,1),i.push(d,0,0,1),s.push(f.imag,l.real,f.real),r.push(g.imag,a,g.real,1),i.push(m,0,0,1),s.push(y.imag,l.real,y.real),r.push(x.imag,a,x.real,1)}if(this._bottom.getValue()){const t=[],o=[];for(let i=e-1;i>-1;--i){const s=i/e,r=2*Math.PI*s,l=Ro.Polar(-1,r),u=l.copy().multiply(n);t.push(new wt((l.imag+1)/2,(l.real+1)/2)),o.push(new Et(u.imag,a,u.real))}const l=t[0],u=o[0];for(let e=1,n=o.length-1;e<n;++e){const n=t[e],a=t[e+1],h=o[e],c=o[e+1];i.push(l.x,l.y,0,1),s.push(0,-1,0),r.push(u.x,u.y,u.z,1),i.push(n.x,n.y,0,1),s.push(0,-1,0),r.push(h.x,h.y,h.z,1),i.push(a.x,a.y,0,1),s.push(0,-1,0),r.push(c.x,c.y,c.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents(){const e=this._bottomRadius.getValue(),t=this._height.getValue()/2,n=-t;this._side.getValue()||this._bottom.getValue()?this._side.getValue()?(this.getMin().set(-e,n,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,n,-e),this.getMax().set(e,n,e)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}}),Object.defineProperties(qd,{typeName:{value:"Cone",enumerable:!0},componentName:{value:"Geometry3D",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"side",new Qi.SFBool(!0)),new H(c.inputOutput,"bottom",new Qi.SFBool(!0)),new H(c.initializeOnly,"height",new Qi.SFFloat(2)),new H(c.initializeOnly,"bottomRadius",new Qi.SFFloat(1)),new H(c.initializeOnly,"solid",new Qi.SFBool(!0))]),enumerable:!0}});const Yd=qd;n.set("x_ite/Components/Geometry3D/Cone",Yd);const Wd=Yd;function $d(e){Sl.call(this,e),this.addType(c.Cylinder),this._height.setUnit("length"),this._radius.setUnit("length")}Object.assign(Object.setPrototypeOf($d.prototype,Sl.prototype),{set_live__(){Sl.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getCylinderOptions().addInterest("requestRebuild",this):this.getBrowser().getCylinderOptions().removeInterest("requestRebuild",this)},build(){const e=this.getBrowser().getCylinderOptions()._xDimension.getValue(),t=this.getTexCoords(),n=this.getNormals(),i=this.getVertices();this.getMultiTexCoords().push(t);const s=this._radius.getValue(),r=this._height.getValue()/2,o=-r;if(this._side.getValue())for(let a=0;a<e;++a){const l=a/e,u=2*Math.PI*l,h=Ro.Polar(-1,u),c=h.copy().multiply(s),d=(a+1)/e,p=2*Math.PI*d,g=Ro.Polar(-1,p),f=g.copy().multiply(s);t.push(l,1,0,1),n.push(h.imag,0,h.real),i.push(c.imag,r,c.real,1),t.push(l,0,0,1),n.push(h.imag,0,h.real),i.push(c.imag,o,c.real,1),t.push(d,0,0,1),n.push(g.imag,0,g.real),i.push(f.imag,o,f.real,1),t.push(l,1,0,1),n.push(h.imag,0,h.real),i.push(c.imag,r,c.real,1),t.push(d,0,0,1),n.push(g.imag,0,g.real),i.push(f.imag,o,f.real,1),t.push(d,1,0,1),n.push(g.imag,0,g.real),i.push(f.imag,r,f.real,1)}if(this._top.getValue()){const o=[],a=[];for(let t=0;t<e;++t){const n=t/e,i=2*Math.PI*n,l=Ro.Polar(-1,i);o.push(new wt((l.imag+1)/2,-(l.real-1)/2)),a.push(new Et(l.imag*s,r,l.real*s))}const l=o[0],u=a[0];for(let e=1,s=a.length-1;e<s;++e){const s=o[e],r=o[e+1],h=a[e],c=a[e+1];t.push(l.x,l.y,0,1),n.push(0,1,0),i.push(u.x,u.y,u.z,1),t.push(s.x,s.y,0,1),n.push(0,1,0),i.push(h.x,h.y,h.z,1),t.push(r.x,r.y,0,1),n.push(0,1,0),i.push(c.x,c.y,c.z,1)}}if(this._bottom.getValue()){const r=[],a=[];for(let t=e-1;t>-1;--t){const n=t/e,i=2*Math.PI*n,l=Ro.Polar(-1,i);r.push(new wt((l.imag+1)/2,(l.real+1)/2)),a.push(new Et(l.imag*s,o,l.real*s))}const l=r[0],u=a[0];for(let e=1,s=a.length-1;e<s;++e){const s=r[e],o=r[e+1],h=a[e],c=a[e+1];t.push(l.x,l.y,0,1),n.push(0,-1,0),i.push(u.x,u.y,u.z,1),t.push(s.x,s.y,0,1),n.push(0,-1,0),i.push(h.x,h.y,h.z,1),t.push(o.x,o.y,0,1),n.push(0,-1,0),i.push(c.x,c.y,c.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents(){const e=this._radius.getValue(),t=this._height.getValue()/2,n=-t;this._top.getValue()||this._side.getValue()||this._bottom.getValue()?this._top.getValue()||this._side.getValue()?this._bottom.getValue()||this._side.getValue()?(this.getMin().set(-e,n,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,t,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,n,-e),this.getMax().set(e,n,e)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}}),Object.defineProperties($d,{typeName:{value:"Cylinder",enumerable:!0},componentName:{value:"Geometry3D",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"top",new Qi.SFBool(!0)),new H(c.inputOutput,"side",new Qi.SFBool(!0)),new H(c.inputOutput,"bottom",new Qi.SFBool(!0)),new H(c.initializeOnly,"height",new Qi.SFFloat(2)),new H(c.initializeOnly,"radius",new Qi.SFFloat(1)),new H(c.initializeOnly,"solid",new Qi.SFBool(!0))]),enumerable:!0}});const Kd=$d;n.set("x_ite/Components/Geometry3D/Cylinder",Kd);const Jd=Kd;function Zd(e){Sl.call(this,e),this.addType(c.ElevationGrid),this._xSpacing.setUnit("length"),this._zSpacing.setUnit("length"),this._creaseAngle.setUnit("angle"),this._height.setUnit("length"),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(Zd.prototype,Sl.prototype),{initialize(){Sl.prototype.initialize.call(this),this._set_height.addFieldInterest(this._height),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__()},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=zl(c.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=zl(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=zl(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_texCoord__(){this.texCoordNode?.removeInterest("requestRebuild",this),this.texCoordNode=zl(c.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode?.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=zl(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},getColor(){return this.colorNode},getTexCoord(){return this.texCoordNode},getNormal(){return this.normalNode},getHeight(e){return e<this._height.length?this._height[e]:0},createTexCoords(){const e=[],t=this._xDimension.getValue(),n=this._zDimension.getValue(),i=t-1,s=n-1;for(let r=0;r<n;++r)for(let n=0;n<t;++n)e.push(new wt(n/i,r/s));return e},createNormals(e,t,n){const i=!this._ccw.getValue(),s=[],r=[];for(let t=0,n=e.length;t<n;++t)s[t]=[];for(let n=0,o=t.length;n<o;n+=3){const o=t[n],a=t[n+1],l=t[n+2];s[o].push(r.length),s[a].push(r.length+1),s[l].push(r.length+2);const u=da.normal(e[o],e[a],e[l],new Et(0,0,0));i&&u.negate(),r.push(u),r.push(u),r.push(u)}return this.refineNormals(s,r,this._creaseAngle.getValue())},createCoordIndex(){const e=[],t=this._xDimension.getValue(),n=t-1,i=this._zDimension.getValue()-1;for(let s=0;s<i;++s)for(let i=0;i<n;++i){const n=s*t+i,r=(s+1)*t+i,o=(s+1)*t+(i+1),a=s*t+(i+1);e.push(n),e.push(r),e.push(o),e.push(n),e.push(o),e.push(a)}return e},createPoints(){const e=[],t=this._xDimension.getValue(),n=this._zDimension.getValue(),i=this._xSpacing.getValue(),s=this._zSpacing.getValue();for(let r=0;r<n;++r)for(let n=0;n<t;++n)e.push(new Et(i*n,this.getHeight(n+r*t),s*r));return e},build(){if(this._xDimension.getValue()<2||this._zDimension.getValue()<2)return;const e=this._colorPerVertex.getValue(),t=this._normalPerVertex.getValue(),n=this.createCoordIndex(),i=this.getAttrib(),s=i.length,r=this.getAttribs(),o=this.fogCoordNode,a=this.getColor(),l=this.getTexCoord(),u=this.getNormal(),h=this.createPoints(),c=this.getFogDepths(),d=this.getColors(),p=this.getMultiTexCoords(),g=this.getNormals(),f=this.getVertices();let m=0;if(l)l.init(p);else{var _=this.createTexCoords(),x=this.getTexCoords();p.push(x)}for(let y=0,w=n.length;y<w;++m)for(let w=0;w<6;++w,++y){const w=n[y],b=h[w];for(let e=0;e<s;++e)i[e].addValue(w,r[e]);if(o?.addDepth(w,c),a&&(e?a.addColor(w,d):a.addColor(m,d)),l)l.addPoint(w,p);else{const e=_[w];x.push(e.x,e.y,0,1)}u&&(t?u.addVector(w,g):u.addVector(m,g)),f.push(b.x,b.y,b.z,1)}if(!u){const e=this.createNormals(h,n);for(const t of e)g.push(t.x,t.y,t.z)}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}),Object.defineProperties(Zd,{typeName:{value:"ElevationGrid",enumerable:!0},componentName:{value:"Geometry3D",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_height",new Qi.MFFloat),new H(c.initializeOnly,"xDimension",new Qi.SFInt32),new H(c.initializeOnly,"zDimension",new Qi.SFInt32),new H(c.initializeOnly,"xSpacing",new Qi.SFFloat(1)),new H(c.initializeOnly,"zSpacing",new Qi.SFFloat(1)),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"creaseAngle",new Qi.SFFloat),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"normalPerVertex",new Qi.SFBool(!0)),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.initializeOnly,"height",new Qi.MFFloat)]),enumerable:!0}});const Qd=Zd;n.set("x_ite/Components/Geometry3D/ElevationGrid",Qd);const ep=Qd;function tp(e){Sl.call(this,e),this.addType(c.Extrusion),this._creaseAngle.setUnit("angle"),this._crossSection.setUnit("length"),this._spine.setUnit("length")}Object.assign(Object.setPrototypeOf(tp.prototype,Sl.prototype),{initialize(){Sl.prototype.initialize.call(this),this._set_crossSection.addFieldInterest(this._crossSection),this._set_orientation.addFieldInterest(this._orientation),this._set_scale.addFieldInterest(this._scale),this._set_spine.addFieldInterest(this._spine)},getClosedOrientation(){const e=this._orientation;if(e.length){const t=e[0].getValue(),n=e[e.length-1].getValue();return t.equals(n)}return!0},createPoints:function(){const e=new Et(1,1,1);return function(){const t=this._crossSection,n=this._orientation,i=this._scale,s=this._spine,r=[],o=this.createRotations();for(let a=0,l=s.length;a<l;++a){const s=o[a];if(n.length&&s.rotate(n[Math.min(a,n.length-1)].getValue()),i.length){const t=i[Math.min(a,i.length-1)].getValue();s.scale(e.set(t.x,1,t.y))}for(let e=0,n=t.length;e<n;++e){const n=t[e].getValue();r.push(s.multVecMatrix(new Et(n.x,0,n.y)))}}return r}}(),createRotations:function(){const e=[],t=new Et(0,0,0),n=new Et(0,0,0),i=new Et(0,0,0),s=new Et(0,0,0),r=new Et(0,0,0),o=new Et(0,0,0),a=new dn;return function(){const l=this._spine,u=l.length,h=l[0].getValue(),c=l[l.length-1].getValue(),d=h.equals(c)&&this.getClosedOrientation();for(let t=e.length;t<u;++t)e[t]=new _n;if(e.length=u,t.set(0,0,0),n.set(0,0,0),i.set(0,0,0),d){const e=h;for(let t=1,i=u-2;t<i&&(n.assign(l[t].getValue()).subtract(e).normalize().subtract(o.assign(l[i].getValue()).subtract(e).normalize()).normalize(),n.equals(Et.Zero));++t);for(let e=0,t=u-2;e<t&&(i.assign(l[e+1].getValue()).subtract(l[e].getValue()).cross(o.assign(l[t].getValue()).subtract(l[e].getValue())).normalize(),i.equals(Et.Zero));++e);}else{for(let e=0,t=u-1;e<t&&(n.assign(l[e+1].getValue()).subtract(l[e].getValue()).normalize(),n.equals(Et.Zero));++e);for(let e=1,t=u-1;e<t&&(i.assign(l[e+1].getValue()).subtract(l[e].getValue()).cross(o.assign(l[e-1].getValue()).subtract(l[e].getValue())).normalize(),i.equals(Et.Zero));++e);}n.equals(Et.Zero)&&n.set(0,1,0),i.equals(Et.Zero)&&a.setFromToVec(Et.yAxis,n).multVecRot(i.assign(Et.zAxis)),t.assign(n).cross(i);const p=h;e[0].set(t.x,t.y,t.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,p.x,p.y,p.z,1),s.assign(n),r.assign(i);for(let a=1,h=u-1;a<h;++a){const u=l[a].getValue();n.assign(l[a+1].getValue()).subtract(u).normalize().subtract(o.assign(l[a-1].getValue()).subtract(u).normalize()).normalize(),i.assign(l[a+1].getValue()).subtract(u).cross(o.assign(l[a-1].getValue()).subtract(u)).normalize(),r.dot(i)<0&&i.negate(),n.equals(Et.Zero)?n.assign(s):s.assign(n),i.equals(Et.Zero)?i.assign(r):r.assign(i),t.assign(n).cross(i),e[a].set(t.x,t.y,t.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,u.x,u.y,u.z,1)}if(d)e[u-1].assign(e[0]);else{const a=c;n.assign(a).subtract(l[u-2].getValue()).normalize(),u>2&&i.assign(a).subtract(l[u-2].getValue()).cross(o.assign(l[u-3].getValue()).subtract(l[u-2].getValue())).normalize(),r.dot(i)<0&&i.negate(),n.equals(Et.Zero)&&n.assign(s),i.equals(Et.Zero)&&i.assign(r),t.assign(n).cross(i),e[u-1].set(t.x,t.y,t.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,a.x,a.y,a.z,1)}return e}}(),build:function(){const e=new wt(0,0,0),t=new wt(0,0,0),n=new wt(0,0,0);return function(){const i=!this._ccw.getValue(),s=this._crossSection,r=this._spine,o=r.length,a=this.getTexCoords();if(o<2||s.length<2)return;this.getMultiTexCoords().push(a);const l=s.length;function u(e,t){return e*l+t}const h=r[0].getValue(),c=r[o-1].getValue(),d=h.equals(c)&&this.getClosedOrientation(),p=s[0].getValue(),g=s[s.length-1].getValue(),f=p.equals(g);e.assign(s[0].getValue()),t.assign(s[0].getValue());for(let n=1,i=s.length;n<i;++n)e.min(s[n].getValue()),t.max(s[n].getValue());const m=n.assign(t).subtract(e),_=Math.max(m.x,m.y),x=f?s.length-1:s.length,y=[],w=[],b=this.createPoints();for(let e=0,t=b.length;e<t;++e)y[e]=[];const S=this.getNormals(),v=this.getVertices(),T=s.length-1,O=o-1;let E=u(0,0),C=u(0,f?0:T);for(let e=0;e<O;++e)for(let t=0;t<T;++t){const n=d&&e===o-2?0:e+1,r=f&&t===s.length-2?0:t+1;let l=u(e,t),h=u(e,r),c=u(n,r),p=u(n,t),g=b[l],m=b[h],_=b[c],x=b[p],S=m.distance(_)>=1e-7,I=x.distance(g)>=1e-7;if(i)var N=da.normal(_,m,g,new Et(0,0,0)),F=da.normal(x,_,g,new Et(0,0,0));else N=da.normal(g,m,_,new Et(0,0,0)),F=da.normal(g,_,x,new Et(0,0,0));if(0==t&&(I?E=l:(l=E,g=b[l])),t==s.length-2&&(S?C=h:(c=C,_=b[c])),S){if(I)a.push(t/T,e/O,0,1);else{const n=(e/O+(e+1)/O)/2;a.push(t/T,n,0,1)}y[l].push(w.length),w.push(N),v.push(g.x,g.y,g.z,1),a.push((t+1)/T,e/O,0,1),y[h].push(w.length),w.push(N),v.push(m.x,m.y,m.z,1),a.push((t+1)/T,(e+1)/O,0,1),y[c].push(w.length),w.push(N),v.push(_.x,_.y,_.z,1)}if(I){if(a.push(t/T,e/O,0,1),y[l].push(w.length),w.push(F),v.push(g.x,g.y,g.z,1),S)a.push((t+1)/T,(e+1)/O,0,1);else{const n=((e+1)/O+e/O)/2;a.push((t+1)/T,n,0,1)}y[c].push(w.length),w.push(F),v.push(_.x,_.y,_.z,1),a.push(t/T,(e+1)/O,0,1),y[p].push(w.length),w.push(F),v.push(x.x,x.y,x.z,1)}}const I=this.refineNormals(y,w,this._creaseAngle.getValue());for(const e of I)S.push(e.x,e.y,e.z);if(_&&x>2){if(this._beginCap.getValue()){const t=0,n=this._convex.getValue(),r={},o=[],l=[];for(let i=0;i<x;++i){const a=u(t,x-1-i),l=b[a].copy();l.index=a,r[a]=s[x-1-i].getValue().copy().subtract(e).divide(_),o.push(n?a:l)}if(n?da.triangulateConvexPolygon(o,l):da.triangulatePolygon(o,l),l.length>=3){const e=da.normal(b[l[0]],b[l[1]],b[l[2]],new Et(0,0,0));i&&e.negate(),this.addCap(a,r,e,b,l)}}if(this._endCap.getValue()){const t=o-1,n=this._convex.getValue(),r={},l=[],h=[];for(let i=0;i<x;++i){const o=u(t,i),a=b[o].copy();a.index=o,r[o]=s[i].getValue().copy().subtract(e).divide(_),l.push(n?o:a)}if(n?da.triangulateConvexPolygon(l,h):da.triangulatePolygon(l,h),h.length>=3){const e=da.normal(b[h[0]],b[h[1]],b[h[2]],new Et(0,0,0));i&&e.negate(),this.addCap(a,r,e,b,h)}}}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}(),addCap(e,t,n,i,s){const r=this.getNormals(),o=this.getVertices();for(let a=0,l=s.length;a<l;a+=3){const l=i[s[a]],u=i[s[a+1]],h=i[s[a+2]],c=t[s[a]],d=t[s[a+1]],p=t[s[a+2]];e.push(c.x,c.y,0,1),e.push(d.x,d.y,0,1),e.push(p.x,p.y,0,1),r.push(n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z),o.push(l.x,l.y,l.z,1,u.x,u.y,u.z,1,h.x,h.y,h.z,1)}}}),Object.defineProperties(tp,{typeName:{value:"Extrusion",enumerable:!0},componentName:{value:"Geometry3D",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_crossSection",new Qi.MFVec2f),new H(c.inputOnly,"set_orientation",new Qi.MFRotation),new H(c.inputOnly,"set_scale",new Qi.MFVec2f),new H(c.inputOnly,"set_spine",new Qi.MFVec3f),new H(c.initializeOnly,"beginCap",new Qi.SFBool(!0)),new H(c.initializeOnly,"endCap",new Qi.SFBool(!0)),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"convex",new Qi.SFBool(!0)),new H(c.initializeOnly,"creaseAngle",new Qi.SFFloat),new H(c.initializeOnly,"crossSection",new Qi.MFVec2f(new wt(1,1),new wt(1,-1),new wt(-1,-1),new wt(-1,1),new wt(1,1))),new H(c.initializeOnly,"orientation",new Qi.MFRotation(new dn)),new H(c.initializeOnly,"scale",new Qi.MFVec2f(new wt(1,1))),new H(c.initializeOnly,"spine",new Qi.MFVec3f(new Et(0,0,0),new Et(0,1,0)))]),enumerable:!0}});const np=tp;n.set("x_ite/Components/Geometry3D/Extrusion",np);const ip=np;function sp(e){Sl.call(this,e),this.addType(c.X3DComposedGeometryNode),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(sp.prototype,Sl.prototype),{initialize(){Sl.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__(),this.set_coord__()},getFogCoord(){return this.fogCoordNode},getColor(){return this.colorNode},getTexCoord(){return this.texCoordNode},getNormal(){return this.normalNode},getCoord(){return this.coordNode},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=zl(c.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=zl(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=zl(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_texCoord__(){this.texCoordNode?.removeInterest("requestRebuild",this),this.texCoordNode=zl(c.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode?.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=zl(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=zl(c.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},getPolygonIndex:e=>e,getTriangleIndex:e=>e,build(e,t,n,i){if(!this.coordNode||this.coordNode.isEmpty())return;t-=t%e,i-=i%n;const s=this._colorPerVertex.getValue(),r=this._normalPerVertex.getValue(),o=this.getAttrib(),a=o.length,l=this.getAttribs(),u=this.getFogCoord(),h=this.getColor(),c=this.getTexCoord(),d=this.getNormal(),p=this.getCoord(),g=this.getFogDepths(),f=this.getColors(),m=this.getMultiTexCoords(),_=this.getNormals(),x=this.getVertices();c?.init(m);for(let e=0;e<i;++e){const t=Math.floor(e/n),i=this.getPolygonIndex(this.getTriangleIndex(e));for(let e=0;e<a;++e)o[e].addValue(i,l[e]);u?.addDepth(i,g),h&&(s?h.addColor(i,f):h.addColor(t,f)),c?.addPoint(i,m),d&&(r?d.addVector(i,_):d.addVector(t,_)),p.addPoint(i,x)}this.getNormal()||this.buildNormals(e,t,i),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},buildNormals(e,t,n){const i=this.createNormals(e,t),s=this.getNormals();for(let e=0;e<n;++e){const t=i[this.getTriangleIndex(e)];s.push(t.x,t.y,t.z)}},createNormals(e,t){const n=this.createFaceNormals(e,t);if(this._normalPerVertex.getValue()){const e=[];for(let n=0;n<t;++n){const t=this.getPolygonIndex(n);let i=e[t];i||(i=e[t]=[]),i.push(n)}return this.refineNormals(e,n,Math.PI)}return n},createFaceNormals(e,t){const n=!this._ccw.getValue(),i=this.coordNode,s=[];for(let r=0;r<t;r+=e){const t=this.getPolygonNormal(r,e,i);n&&t.negate();for(let n=0;n<e;++n)s.push(t)}return s},getPolygonNormal:function(){let e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i,s){const r=new Et(0,0,0);s.get1Point(this.getPolygonIndex(n),t);for(let o=0;o<i;++o){const a=e;e=t,t=a,s.get1Point(this.getPolygonIndex(n+(o+1)%i),t),r.x+=(e.y-t.y)*(e.z+t.z),r.y+=(e.z-t.z)*(e.x+t.x),r.z+=(e.x-t.x)*(e.y+t.y)}return r.normalize()}}()}),Object.defineProperties(sp,{typeName:{value:"X3DComposedGeometryNode",enumerable:!0},componentName:{value:"Rendering",enumerable:!0}});const rp=sp;n.set("x_ite/Components/Rendering/X3DComposedGeometryNode",rp);const op=rp;function ap(e){op.call(this,e),this.addType(c.IndexedFaceSet),this._creaseAngle.setUnit("angle")}Object.assign(Object.setPrototypeOf(ap.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_texCoordIndex.addFieldInterest(this._texCoordIndex),this._set_normalIndex.addFieldInterest(this._normalIndex),this._set_coordIndex.addFieldInterest(this._coordIndex)},getTexCoordPerVertexIndex(e){return e<this._texCoordIndex.length?this._texCoordIndex[e]:this._coordIndex[e]},getColorPerVertexIndex(e){return e<this._colorIndex.length?this._colorIndex[e]:this._coordIndex[e]},getColorIndex(e){return e<this._colorIndex.length?this._colorIndex[e]:e},getNormalPerVertexIndex(e){return e<this._normalIndex.length?this._normalIndex[e]:this._coordIndex[e]},getNormalIndex(e){return e<this._normalIndex.length?this._normalIndex[e]:e},build(){const e=this.triangulate();if(0===e.length)return;const t=this._colorPerVertex.getValue(),n=this._normalPerVertex.getValue(),i=this._coordIndex.getValue(),s=this.getAttrib(),r=s.length,o=this.getAttribs(),a=this.getFogCoord(),l=this.getColor(),u=this.getTexCoord(),h=this.getNormal(),c=this.getCoord(),d=this.getFogDepths(),p=this.getColors(),g=this.getMultiTexCoords(),f=this.getNormals(),m=this.getVertices();u?.init(g);for(const _ of e){const e=_.triangles,x=_.face;for(const _ of e){const e=i[_];for(let t=0;t<r;++t)s[t].addValue(e,o[t]);a?.addDepth(e,d),l&&(t?l.addColor(this.getColorPerVertexIndex(_),p):l.addColor(this.getColorIndex(x),p)),u?.addPoint(this.getTexCoordPerVertexIndex(_),g),h&&(n?h.addVector(this.getNormalPerVertexIndex(_),f):h.addVector(this.getNormalIndex(x),f)),c.addPoint(e,m)}}this.getNormal()||this.buildNormals(e),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},triangulate(){const e=this._convex.getValue(),t=this._coordIndex.length,n=[];if(!this.getCoord())return n;if(t&&this._coordIndex[t-1]>-1&&this._coordIndex.push(-1),t){const t=this._coordIndex.getValue(),i=this._coordIndex.length;for(let s=0,r=0,o=[];s<i;++s){if(t[s]>-1)o.push(s);else{switch(o.length){case 0:case 1:case 2:o.length=0;break;case 3:n.push({vertices:o,triangles:o,face:r}),o=[];break;default:{const t=[],i={vertices:o,triangles:t,face:r};e?da.triangulateConvexPolygon(o,t):this.triangulatePolygon(o,t),t.length<3?o.length=0:(n.push(i),o=[]);break}}++r}}}return n},triangulatePolygon:function(){const e=[];return function(t,n){const i=this._coordIndex.getValue(),s=this.getCoord(),r=t.length;for(let t=e.length;t<r;++t)e.push(new Et(0,0,0));for(let n=0;n<r;++n){const r=t[n],o=e[n];o.index=r,s.get1Point(i[r],o)}e.length=r,da.triangulatePolygon(e,n)}}(),buildNormals(e){const t=this.createNormals(e),n=this.getNormals();for(const i of e)for(const e of i.triangles){const i=t[e];n.push(i.x,i.y,i.z)}},createNormals:function(){const e=[],t=[];return function(n){const i=!this._ccw.getValue(),s=this._coordIndex.getValue(),r=this.getCoord();e.length=0,t.length=0;for(const a of n){const n=a.vertices,l=n.length;switch(l){case 3:var o=r.getNormal(s[n[0]],s[n[1]],s[n[2]]);break;case 4:o=r.getQuadNormal(s[n[0]],s[n[1]],s[n[2]],s[n[3]]);break;default:o=this.getPolygonNormal(n,s,r)}for(let e=0;e<l;++e){const i=n[e],r=s[i];let o=t[r];o||(o=t[r]=[]),o.push(i)}i&&o.negate();for(let t=0;t<l;++t)e[n[t]]=o}return this.refineNormals(t,e,this._creaseAngle.getValue())}}(),getPolygonNormal:function(){let e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i,s){const r=new Et(0,0,0);s.get1Point(i[n[0]],t);for(let o=0,a=n.length;o<a;++o){const l=e;e=t,t=l,s.get1Point(i[n[(o+1)%a]],t),r.x+=(e.y-t.y)*(e.z+t.z),r.y+=(e.z-t.z)*(e.x+t.x),r.z+=(e.x-t.x)*(e.y+t.y)}return r.normalize()}}()}),Object.defineProperties(ap,{typeName:{value:"IndexedFaceSet",enumerable:!0},componentName:{value:"Geometry3D",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_colorIndex",new Qi.MFInt32),new H(c.inputOnly,"set_texCoordIndex",new Qi.MFInt32),new H(c.inputOnly,"set_normalIndex",new Qi.MFInt32),new H(c.inputOnly,"set_coordIndex",new Qi.MFInt32),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"convex",new Qi.SFBool(!0)),new H(c.initializeOnly,"creaseAngle",new Qi.SFFloat),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"normalPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"colorIndex",new Qi.MFInt32),new H(c.initializeOnly,"texCoordIndex",new Qi.MFInt32),new H(c.initializeOnly,"normalIndex",new Qi.MFInt32),new H(c.initializeOnly,"coordIndex",new Qi.MFInt32),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const lp=ap;n.set("x_ite/Components/Geometry3D/IndexedFaceSet",lp);const up=lp;function hp(e){Sl.call(this,e),this.addType(c.Sphere),this._radius.setUnit("length")}Object.assign(Object.setPrototypeOf(hp.prototype,Sl.prototype),{set_live__(){Sl.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getSphereOptions().addInterest("requestRebuild",this):this.getBrowser().getSphereOptions().removeInterest("requestRebuild",this)},build(){const e=this.getBrowser().getSphereOptions().getGeometry(),t=Math.abs(this._radius.getValue());if(this.setMultiTexCoords(e.getMultiTexCoords()),this.setNormals(e.getNormals()),1===t)this.setVertices(e.getVertices()),this.getMin().assign(e.getMin()),this.getMax().assign(e.getMax());else{const n=e.getVertices().getValue(),i=this.getVertices();for(let e=0,s=n.length;e<s;e+=4)i.push(t*n[e],t*n[e+1],t*n[e+2],1);this.getMin().set(-t,-t,-t),this.getMax().set(t,t,t)}this.setSolid(this._solid.getValue())}}),Object.defineProperties(hp,{typeName:{value:"Sphere",enumerable:!0},componentName:{value:"Geometry3D",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"radius",new Qi.SFFloat(1)),new H(c.initializeOnly,"solid",new Qi.SFBool(!0))]),enumerable:!0}});const cp=hp;n.set("x_ite/Components/Geometry3D/Sphere",cp);const dp={name:"Geometry3D",concreteNodes:[Hd,Wd,Jd,ep,ip,up,cp],abstractNodes:[]};n.set("x_ite/Components/Geometry3D",dp);const pp=dp,gp=Symbol(),fp=Symbol(),mp=Symbol(),_p=Symbol(),xp=Symbol();function yp(e){Ys.call(this,e),Uu.call(this,e),this.addType(c.StaticGroup),this.groupNode=new qu(this.getExecutionContext()),this.bbox=new La,this.shadowBBox=new La}Object.assign(Object.setPrototypeOf(yp.prototype,Ys.prototype),Uu.prototype,{initialize(){Ys.prototype.initialize.call(this),Uu.prototype.initialize.call(this),this._bboxSize.addFieldInterest(this.groupNode._bboxSize),this._bboxCenter.addFieldInterest(this.groupNode._bboxCenter),this._children.addFieldInterest(this.groupNode._children),this.groupNode._bboxSize=this._bboxSize,this.groupNode._bboxCenter=this._bboxCenter,this.groupNode._children=this._children,this.groupNode.setPrivate(!0),this.groupNode.setup(),this.groupNode._isCameraObject.addFieldInterest(this._isCameraObject),this.groupNode._isPickableObject.addFieldInterest(this._isPickableObject),this.groupNode._children.addInterest("set_children__",this),this.setCameraObject(this.groupNode.isCameraObject()),this.setPickableObject(this.groupNode.isPickableObject()),this.set_children__()},getBBox(e,t){return e.assign(t?this.shadowBBox:this.bbox)},set_children__(){this.groupNode.getBBox(this.bbox),this.groupNode.getBBox(this.shadowBBox,!0),this[gp]=null,this[fp]=null,this[mp]=null,this[_p]=null,this[xp]=null},traverse(e,t){switch(e){case Na.CAMERA:return;case Na.POINTER:return void this.traverseObjects(gp,"Pointing",e,t);case Na.COLLISION:return void this.traverseObjects(fp,"Collision",e,t);case Na.SHADOW:return void this.traverseObjects(mp,"Shadow",e,t);case Na.DISPLAY:return this.traverseObjects(_p,"Opaque",e,t),void this.traverseObjects(xp,"Transparent",e,t)}},traverseObjects:function(){const e=new Sa;return e.intersectsSphere=function(){return!0},function(t,n,i,s){if(!this[t]){const r=s.getViewVolumes(),o=s.getViewport(),a=s.getProjectionMatrix(),l=s.getModelViewMatrix(),u=s[`getNum${n}Shapes`]();r.push(e.set(a,o,o)),l.push(),l.identity(),this.groupNode.traverse(i,s),l.pop(),r.pop();const h=s[`getNum${n}Shapes`]();this[t]=s[`get${n}Shapes`]().splice(u,h-u),s[`setNum${n}Shapes`](u)}const r=s.getModelViewMatrix();for(const{modelViewMatrix:e,shapeNode:n}of this[t])r.push(),r.multLeft(e),n.traverse(i,s),r.pop()}}(),dispose(){Uu.prototype.dispose.call(this),Ys.prototype.dispose.call(this)}}),Object.defineProperties(yp,{typeName:{value:"StaticGroup",enumerable:!0},componentName:{value:"Grouping",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.initializeOnly,"children",new Qi.MFNode)]),enumerable:!0}});const wp=yp;n.set("x_ite/Components/Grouping/StaticGroup",wp);const bp=wp;function Sp(e){zu.call(this,e),this.addType(c.Switch),"2.0"===e.getSpecificationVersion()&&this.addAlias("choice",this._children),this.childNode=null,this.visibleNode=null,this.boundedObject=null}Object.assign(Object.setPrototypeOf(Sp.prototype,zu.prototype),{initialize(){zu.prototype.initialize.call(this),this._whichChoice.addInterest("set_child__",this),this._children.addInterest("set_child__",this),this.set_child__()},getSubBBox(e,t){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=zl(c.X3DBoundedObject,this.visibleNode);return n?.getBBox(e,t)??e.set()}return e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear(){},add(){},remove(){},set_child__(){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),zl(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this));const e=this._whichChoice.getValue();e>=0&&e<this._children.length?(this.childNode=zl(c.X3DChildNode,this._children[e]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),zl(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)),delete this.traverse)):(this.childNode=null,this.traverse=Function.prototype),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__(){this.setCameraObject(!!this.visibleNode?.isCameraObject())},set_transformSensors__(){this.setPickableObject(!(!this.getTransformSensors().size&&!this.visibleNode?.isPickableObject()))},set_visible__(){zl(c.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__(),this.set_transformSensors__()},set_bboxDisplay__(){zl(c.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},traverse(e,t){switch(e){case Na.POINTER:case Na.CAMERA:case Na.SHADOW:return void this.visibleNode?.traverse(e,t);case Na.PICKING:{if(this.getTransformSensors().size){const e=t.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}const n=this.visibleNode;if(n){const i=this.getBrowser().getPickingHierarchy();i.push(this),n.traverse(e,t),i.pop()}return}case Na.COLLISION:return void this.visibleNode?.traverse(e,t);case Na.DISPLAY:return this.visibleNode?.traverse(e,t),void this.boundedObject?.displayBBox(e,t)}}}),Object.defineProperties(Sp,{typeName:{value:"Switch",enumerable:!0},componentName:{value:"Grouping",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"whichChoice",new Qi.SFInt32(-1)),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const vp=Sp;n.set("x_ite/Components/Grouping/Switch",vp);const Tp=vp;function Op(e){zu.call(this,e),this.addType(c.X3DTransformMatrix3DNode),this.matrix=new _n}Object.assign(Object.setPrototypeOf(Op.prototype,zu.prototype),{setMatrix(e){e.equals(_n.Identity)?(this.matrix.identity(),this.getBBox=this.getSubBBox,this.traverse=this.groupTraverse):(this.matrix.assign(e),delete this.getBBox,delete this.traverse)},getMatrix(){return this.matrix},setTransform(e,t,n,i,s){e.equals(Et.Zero)&&t.equals(dn.Identity)&&n.equals(Et.One)?(this.matrix.identity(),this.getBBox=this.getSubBBox,this.traverse=this.groupTraverse):(this.matrix.set(e,t,n,i,s),delete this.getBBox,delete this.traverse)},getBBox(e,t){return this.getSubBBox(e,t).multRight(this.matrix)},traverse(e,t){const n=t.getModelViewMatrix();n.push(),n.multLeft(this.matrix),zu.prototype.traverse.call(this,e,t),n.pop()},groupTraverse:zu.prototype.traverse}),Object.defineProperties(Op,{typeName:{value:"X3DTransformMatrix3DNode",enumerable:!0},componentName:{value:"Grouping",enumerable:!0}});const Ep=Op;n.set("x_ite/Components/Grouping/X3DTransformMatrix3DNode",Ep);const Cp=Ep;function Np(e){Cp.call(this,e),this.addType(c.X3DTransformNode),this._translation.setUnit("length"),this._center.setUnit("length")}Object.assign(Object.setPrototypeOf(Np.prototype,Cp.prototype),{initialize(){Cp.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed(){this.setTransform(this._translation.getValue(),this._rotation.getValue(),this._scale.getValue(),this._scaleOrientation.getValue(),this._center.getValue())}}),Object.defineProperties(Np,{typeName:{value:"X3DTransformNode",enumerable:!0},componentName:{value:"Grouping",enumerable:!0}});const Fp=Np;n.set("x_ite/Components/Grouping/X3DTransformNode",Fp);const Ip=Fp;function Mp(e){Ip.call(this,e),this.addType(c.Transform)}Object.setPrototypeOf(Mp.prototype,Ip.prototype),Object.defineProperties(Mp,{typeName:{value:"Transform",enumerable:!0},componentName:{value:"Grouping",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"translation",new Qi.SFVec3f),new H(c.inputOutput,"rotation",new Qi.SFRotation),new H(c.inputOutput,"scale",new Qi.SFVec3f(1,1,1)),new H(c.inputOutput,"scaleOrientation",new Qi.SFRotation),new H(c.inputOutput,"center",new Qi.SFVec3f),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const Pp=Mp;n.set("x_ite/Components/Grouping/Transform",Pp);const Dp={name:"Grouping",concreteNodes:[qu,bp,Tp,Pp],abstractNodes:[Uu,zu,Cp,Ip]};n.set("x_ite/Components/Grouping",Dp);const Rp=Dp;function Ap(e){xu.call(this,e),this.addType(c.ColorInterpolator),this.hsv=[]}Object.assign(Object.setPrototypeOf(Ap.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._keyValue;e.length<this._key.length&&this._keyValue.resize(this._key.length,e.length?e[this._keyValue.length-1]:new Qi.SFColor),this.hsv.length=0;for(const t of e)this.hsv.push(t.getHSV())},interpolate:function(){const e=[];return function(t,n,i){De.lerp(this.hsv[t],this.hsv[n],i,e),this._value_changed.setHSV(e[0],e[1],e[2])}}()}),Object.defineProperties(Ap,{typeName:{value:"ColorInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFColor),new H(c.outputOnly,"value_changed",new Qi.SFColor)]),enumerable:!0}});const Vp=Ap;n.set("x_ite/Components/Interpolation/ColorInterpolator",Vp);const Lp=Vp;function Bp(e){xu.call(this,e),this.addType(c.CoordinateInterpolator)}Object.assign(Object.setPrototypeOf(Bp.prototype,xu.prototype),{set_keyValue__(){},interpolate(e,t,n){const i=this._keyValue.getValue();let s=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=s;const r=this._value_changed.getValue();t=(e*=s)+(this._key.length>1?s:0),e*=3,t*=3,s*=3;for(let o=0;o<s;o+=3){const s=o+1,a=o+2;r[o]=f.lerp(i[e+o],i[t+o],n),r[s]=f.lerp(i[e+s],i[t+s],n),r[a]=f.lerp(i[e+a],i[t+a],n)}this._value_changed.addEvent()}}),Object.defineProperties(Bp,{typeName:{value:"CoordinateInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFVec3f),new H(c.outputOnly,"value_changed",new Qi.MFVec3f)]),enumerable:!0}});const Up=Bp;n.set("x_ite/Components/Interpolation/CoordinateInterpolator",Up);const Xp=Up;function jp(e){xu.call(this,e),this.addType(c.CoordinateInterpolator2D)}Object.assign(Object.setPrototypeOf(jp.prototype,xu.prototype),{set_keyValue__(){},interpolate(e,t,n){const i=this._keyValue.getValue();let s=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=s;const r=this._value_changed.getValue();t=(e*=s)+(this._key.length>1?s:0),e*=2,t*=2,s*=2;for(let o=0;o<s;o+=2){const s=o+1;r[o]=f.lerp(i[e+o],i[t+o],n),r[s]=f.lerp(i[e+s],i[t+s],n)}this._value_changed.addEvent()}}),Object.defineProperties(jp,{typeName:{value:"CoordinateInterpolator2D",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFVec2f),new H(c.outputOnly,"value_changed",new Qi.MFVec2f)]),enumerable:!0}});const kp=jp;n.set("x_ite/Components/Interpolation/CoordinateInterpolator2D",kp);const zp=kp;function Gp(e){xu.call(this,e),this.addType(c.NormalInterpolator)}Object.assign(Object.setPrototypeOf(Gp.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){},interpolate:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i,s){const r=this._keyValue.getValue();let o=this._key.length>1?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const a=this._value_changed.getValue();i=(n*=o)+o,n*=3,i*=3,o*=3;for(let l=0;l<o;l+=3)try{const o=l+1,u=l+2;e.set(r[n+l],r[n+o],r[n+u]),t.set(r[i+l],r[i+o],r[i+u]);const h=f.simpleSlerp(e,t,s);a[l]=h[0],a[o]=h[1],a[u]=h[2]}catch(e){}this._value_changed.addEvent()}}()}),Object.defineProperties(Gp,{typeName:{value:"NormalInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFVec3f),new H(c.outputOnly,"value_changed",new Qi.MFVec3f)]),enumerable:!0}});const Hp=Gp;n.set("x_ite/Components/Interpolation/NormalInterpolator",Hp);const qp=Hp;function Yp(e){xu.call(this,e),this.addType(c.PositionInterpolator2D)}Object.assign(Object.setPrototypeOf(Yp.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Qi.SFVec2f)},interpolate:function(){const e=new wt(0,0);return function(t,n,i){this._value_changed=e.assign(this._keyValue[t].getValue()).lerp(this._keyValue[n].getValue(),i)}}()}),Object.defineProperties(Yp,{typeName:{value:"PositionInterpolator2D",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFVec2f),new H(c.outputOnly,"value_changed",new Qi.SFVec2f)]),enumerable:!0}});const Wp=Yp;n.set("x_ite/Components/Interpolation/PositionInterpolator2D",Wp);const $p=Wp;function Kp(){this.T0=[],this.T1=[]}Object.assign(Kp.prototype,{generate:function(){const e=[],t=[],n=[];return function(i,s,r,o,a){const l=this.T0,u=this.T1;if(l.length=0,u.length=0,e.length=0,t.length=0,n.length=0,s.length>1){if(0===o.length){i?e.push(this.divide(this.subtract(r[1],r[r.length-2]),2)):e.push(this.create());for(let t=1,n=r.length-1;t<n;++t)e.push(this.divide(this.subtract(r[t+1],r[t-1]),2));e.push(this.copy(e[0]))}else{for(let t=0,n=o.length;t<n;++t)e.push(this.copy(o[t]));if(a){let t=0;for(let e=0,n=r.length-1;e<n;++e)t+=this.magnitude(this.subtract(r[e],r[e+1]));for(let n=0,i=e.length-1;n<i;++n){const i=this.magnitude(e[n]);i&&(e[n]=this.multiply(e[n],t/i))}}}if(i){const e=s.length-1,i=s.length-2,r=s[1]-s[0]+s[e]-s[i];n.push(2*(s[1]-s[0])/r),t.push(2*(s[e]-s[i])/r)}else n.push(1),t.push(1);for(let e=1,i=s.length-1;e<i;++e){const i=s[e+1]-s[e-1];n.push(2*(s[e+1]-s[e])/i),t.push(2*(s[e]-s[e-1])/i)}n.push(n[0]),t.push(t[0]);for(let i=0,s=e.length;i<s;++i)l.push(this.multiply(e[i],t[i])),u.push(this.multiply(e[i],n[i]))}else l.push(this.create()),u.push(this.create())}}(),interpolate:function(){const e=new Yt(0,0,0,0),t=new _n(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0);return function(n,i,s,r){return e.set(Math.pow(s,3),Math.pow(s,2),s,1),this.dot(t.multVecMatrix(e),r[n],r[i],this.T0[n],this.T1[i])}}()});const Jp=Kp;n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator",Jp);const Zp=Jp;const Qp=function(e){function t(){this.T0=[],this.T1=[]}return Object.assign(Object.setPrototypeOf(t.prototype,Zp.prototype),{create:()=>e.Zero.copy(),copy:e=>e.copy(),subtract:(e,t)=>e.copy().subtract(t),multiply:(e,t)=>e.copy().multiply(t),divide:(e,t)=>e.copy().divide(t),magnitude:e=>e.magnitude(),dot:function(){const t=new e(0,0,0,0),n=new e(0,0,0,0),i=new e(0,0,0,0),s=new e(0,0,0,0);return function(e,r,o,a,l){return t.assign(r).multiply(e[0]),n.assign(o).multiply(e[1]),i.assign(a).multiply(e[2]),s.assign(l).multiply(e[3]),t.add(n).add(i).add(s)}}()}),t};n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolatorTemplate",Qp);const eg=Qp,tg=eg(Et);n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator3",tg);const ng=tg;function ig(e){xu.call(this,e),this.addType(c.SplinePositionInterpolator),this.spline=new ng}Object.assign(Object.setPrototypeOf(ig.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Qi.SFVec3f),this.set_keyVelocity__()},set_keyVelocity__(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Qi.SFVec3f),this.set_normalizeVelocity__()},set_normalizeVelocity__(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate(e,t,n){this._value_changed=this.spline.interpolate(e,t,n,this._keyValue)}}),Object.defineProperties(ig,{typeName:{value:"SplinePositionInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"closed",new Qi.SFBool),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFVec3f),new H(c.inputOutput,"keyVelocity",new Qi.MFVec3f),new H(c.inputOutput,"normalizeVelocity",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFVec3f)]),enumerable:!0}});const sg=ig;n.set("x_ite/Components/Interpolation/SplinePositionInterpolator",sg);const rg=sg,og=eg(wt);n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator2",og);const ag=og;function lg(e){xu.call(this,e),this.addType(c.SplinePositionInterpolator2D),this.spline=new ag}Object.assign(Object.setPrototypeOf(lg.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Qi.SFVec2f),this.set_keyVelocity__()},set_keyVelocity__(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Qi.SFVec2f),this.set_normalizeVelocity__()},set_normalizeVelocity__(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate(e,t,n){this._value_changed=this.spline.interpolate(e,t,n,this._keyValue)}}),Object.defineProperties(lg,{typeName:{value:"SplinePositionInterpolator2D",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"closed",new Qi.SFBool),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFVec2f),new H(c.inputOutput,"keyVelocity",new Qi.MFVec2f),new H(c.inputOutput,"normalizeVelocity",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFVec2f)]),enumerable:!0}});const ug=lg;n.set("x_ite/Components/Interpolation/SplinePositionInterpolator2D",ug);const hg=ug;function cg(){Zp.call(this)}Object.assign(Object.setPrototypeOf(cg.prototype,Zp.prototype),{create:()=>0,copy:e=>e,subtract:(e,t)=>e-t,multiply:(e,t)=>e*t,divide:(e,t)=>e/t,magnitude:e=>Math.abs(e),dot:(e,t,n,i,s)=>t*e[0]+n*e[1]+i*e[2]+s*e[3]});const dg=cg;n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator1",dg);const pg=dg;function gg(e){xu.call(this,e),this.addType(c.SplineScalarInterpolator),this.spline=new pg}Object.assign(Object.setPrototypeOf(gg.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Qi.SFFloat),this.set_keyVelocity__()},set_keyVelocity__(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Qi.SFFloat),this.set_normalizeVelocity__()},set_normalizeVelocity__(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate(e,t,n){this._value_changed=this.spline.interpolate(e,t,n,this._keyValue)}}),Object.defineProperties(gg,{typeName:{value:"SplineScalarInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"closed",new Qi.SFBool),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFFloat),new H(c.inputOutput,"keyVelocity",new Qi.MFFloat),new H(c.inputOutput,"normalizeVelocity",new Qi.SFBool),new H(c.outputOnly,"value_changed",new Qi.SFFloat)]),enumerable:!0}});const fg=gg;n.set("x_ite/Components/Interpolation/SplineScalarInterpolator",fg);const mg=fg;function _g(){this.s=[]}Object.assign(_g.prototype,{generate(e,t,n){const i=this.s;if(i.length=0,t.length>1){e?i.push(dn.spline(n[t.length-2].getValue(),n[0].getValue(),n[1].getValue())):i.push(n[0].getValue());for(let e=1,s=t.length-1;e<s;++e)i.push(dn.spline(n[e-1].getValue(),n[e].getValue(),n[e+1].getValue()));e?i.push(dn.spline(n[t.length-2].getValue(),n[t.length-1].getValue(),n[1].getValue())):i.push(n[t.length-1].getValue())}else t.length>0&&i.push(n[0].getValue().copy())},interpolate:function(){const e=new dn;return function(t,n,i,s){return e.assign(s[t].getValue()).squad(this.s[t],this.s[n],s[n].getValue(),i)}}()});const xg=_g;n.set("x_ite/Browser/Interpolation/SquatInterpolator",xg);const yg=xg;function wg(e){xu.call(this,e),this.addType(c.SquadOrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle"),this.squad=new yg}Object.assign(Object.setPrototypeOf(wg.prototype,xu.prototype),{initialize(){xu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Qi.SFRotation),this.squad.generate(this._closed.getValue(),this._key,this._keyValue)},interpolate(e,t,n){try{this._value_changed=this.squad.interpolate(e,t,n,this._keyValue)}catch(e){console.error(e)}}}),Object.defineProperties(wg,{typeName:{value:"SquadOrientationInterpolator",enumerable:!0},componentName:{value:"Interpolation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_fraction",new Qi.SFFloat),new H(c.inputOutput,"closed",new Qi.SFBool),new H(c.inputOutput,"key",new Qi.MFFloat),new H(c.inputOutput,"keyValue",new Qi.MFRotation),new H(c.outputOnly,"value_changed",new Qi.SFRotation)]),enumerable:!0}});const bg=wg;n.set("x_ite/Components/Interpolation/SquadOrientationInterpolator",bg);const Sg={name:"Interpolation",concreteNodes:[Lp,Xp,zp,bu,qp,Cu,Tu,$p,Iu,rg,hg,mg,bg],abstractNodes:[xu]};n.set("x_ite/Components/Interpolation",Sg);const vg=Sg;function Tg(e){zu.call(this,e),this.addType(c.X3DViewportNode)}Object.setPrototypeOf(Tg.prototype,zu.prototype),Object.defineProperties(Tg,{typeName:{value:"X3DViewportNode",enumerable:!0},componentName:{value:"Layering",enumerable:!0}});const Og=Tg;n.set("x_ite/Components/Layering/X3DViewportNode",Og);const Eg=Og,Cg=sl(Sa);function Ng(e){Eg.call(this,e),this.addType(c.Viewport),this.rectangle=new Yt(0,0,0,0)}Object.assign(Object.setPrototypeOf(Ng.prototype,Eg.prototype),{getRectangle(){const e=this.getBrowser().getViewport(),t=Math.floor(e[2]*this.getLeft()),n=Math.floor(e[2]*this.getRight()),i=Math.floor(e[3]*this.getBottom()),s=Math.floor(e[3]*this.getTop());return this.rectangle.set(t,i,Math.max(0,n-t),Math.max(0,s-i)),this.rectangle},getLeft(){return this._clipBoundary.length>0?this._clipBoundary[0]:0},getRight(){return this._clipBoundary.length>1?this._clipBoundary[1]:1},getBottom(){return this._clipBoundary.length>2?this._clipBoundary[2]:0},getTop(){return this._clipBoundary.length>3?this._clipBoundary[3]:1},traverse(e,t){if(this.push(t),e===Na.POINTER)this.getBrowser().isPointerInRectangle(this.rectangle)&&Eg.prototype.traverse.call(this,e,t);else Eg.prototype.traverse.call(this,e,t);this.pop(t)},push(e){const t=e.getViewVolumes(),n=this.getRectangle(),i=t.length?t.at(-1).getViewport():n,s=Cg.pop();s.set(e.getProjectionMatrix().get(),i,n),t.push(s)},pop(e){Cg.push(e.getViewVolumes().pop())}}),Object.defineProperties(Ng,{typeName:{value:"Viewport",enumerable:!0},componentName:{value:"Layering",enumerable:!0},containerField:{value:"viewport",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"clipBoundary",new Qi.MFFloat(0,1,0,1)),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const Fg=Ng;n.set("x_ite/Components/Layering/Viewport",Fg);const Ig=Fg,Mg={name:"Layering",concreteNodes:[$u,Zu,Ig],abstractNodes:[ou,Eg]};n.set("x_ite/Components/Layering",Mg);const Pg=Mg;function Dg(e){Ys.call(this,e),this.addType(c.X3DLightNode)}Object.assign(Object.setPrototypeOf(Dg.prototype,Ys.prototype),{initialize(){Ys.prototype.initialize.call(this),this._on.addInterest("set_on__",this),this._intensity.addInterest("set_on__",this),this.set_on__()},set_on__(){this._on.getValue()&&this.getIntensity()>0?(delete this.push,delete this.pop):(this.push=Function.prototype,this.pop=Function.prototype)},getGlobal(){return this._global.getValue()},getColor(){return this._color.getValue()},getIntensity(){return Math.max(this._intensity.getValue(),0)},getAmbientIntensity(){return f.clamp(this._ambientIntensity.getValue(),0,1)},getDirection(){return this._direction.getValue()},getShadows(){return this._shadows.getValue()},getShadowColor(){return this._shadowColor.getValue()},getShadowIntensity(){return this.getShadows()?f.clamp(this._shadowIntensity.getValue(),0,1):0},getShadowBias(){return f.clamp(this._shadowBias.getValue(),0,1)},getShadowMapSize(){return Math.min(this._shadowMapSize.getValue(),this.getBrowser().getMaxTextureSize())},getBiasMatrix:function(){const e=new _n(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return e}}(),push(e,t){if(e.isIndependent()){const n=this.getLights().pop();this._global.getValue()?(n.set(this,e.getLayer().getGroup(),e.getModelViewMatrix().get()),e.getGlobalObjects().push(n),e.getLights().push(n),e.pushGlobalShadows(!!this.getShadowIntensity())):(n.set(this,t,e.getModelViewMatrix().get()),e.getLocalObjects().push(n),e.getLights().push(n),e.pushLocalShadows(!!this.getShadowIntensity()),++e.getLocalObjectsCount()[1])}else{const t=e.getLightContainer();t.modelViewMatrix.pushMatrix(e.getModelViewMatrix().get()),this._global.getValue()?(e.getGlobalObjects().push(t),e.getLights().push(t),e.pushGlobalShadows(!!this.getShadowIntensity())):(e.getLocalObjects().push(t),e.getLights().push(t),e.pushLocalShadows(!!this.getShadowIntensity()),++e.getLocalObjectsCount()[1])}},pop(e){if(this._global.getValue())return;const t=e.getLocalObjects().pop();e.isIndependent()&&this.getBrowser().getLocalObjects().push(t),e.popLocalShadows(),--e.getLocalObjectsCount()[1]}}),Object.defineProperties(Dg,{typeName:{value:"X3DLightNode",enumerable:!0},componentName:{value:"Lighting",enumerable:!0}});const Rg=Dg;n.set("x_ite/Components/Lighting/X3DLightNode",Rg);const Ag=Rg,Vg=sl(Lg);function Lg(){this.direction=new Et(0,0,0),this.shadowBuffer=null,this.bbox=new La,this.viewVolume=new Sa,this.viewport=new Yt(0,0,0,0),this.projectionMatrix=new _n,this.modelViewMatrix=new zo(_n),this.modelMatrix=new _n,this.invLightSpaceMatrix=new _n,this.invLightSpaceProjectionMatrix=new _n,this.shadowMatrix=new _n,this.shadowMatrixArray=new Float32Array(16),this.rotation=new dn,this.textureUnit=void 0}function Bg(e){Ag.call(this,e),this.addType(c.DirectionalLight),"2.0"===e.getSpecificationVersion()&&(this._global=!0)}Object.assign(Lg.prototype,{set(e,t,n){const i=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.global=e.getGlobal(),this.modelViewMatrix.pushMatrix(n),e.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap(e){if(!this.shadowBuffer)return;const t=this.lightNode,n=e.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),s=this.invLightSpaceMatrix.assign(this.global?i:_n.Identity);s.rotate(this.rotation.setFromToVec(Et.zAxis,this.direction.assign(t.getDirection()).negate())),s.inverse();const r=this.groupNode.getSubBBox(this.bbox,!0).multRight(s),o=t.getShadowMapSize(),a=this.viewport.set(0,0,o,o),l=Ra.orthoBox(r,this.projectionMatrix);this.shadowBuffer.bind(),e.getViewVolumes().push(this.viewVolume.set(l,a,a)),e.getProjectionMatrix().pushMatrix(l),e.getModelViewMatrix().pushMatrix(s),e.render(Na.SHADOW,zu.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop(),this.shadowBuffer.unbind(),this.global||s.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(s).multRight(l).multRight(t.getBiasMatrix())},setGlobalVariables(e){this.modelViewMatrix.get().multDirMatrix(this.direction.assign(this.lightNode.getDirection())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms(e,t){const n=t.numLights++;if(this.shadowBuffer){const i=this.global?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(e.activeTexture(e.TEXTURE0+i),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(n,this))return;const i=this.lightNode,s=i.getColor(),r=this.direction;if(e.uniform1i(t.x3d_LightType[n],1),e.uniform3f(t.x3d_LightColor[n],s.r,s.g,s.b),e.uniform1f(t.x3d_LightIntensity[n],i.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),e.uniform3f(t.x3d_LightDirection[n],r.x,r.y,r.z),this.shadowBuffer){const s=i.getShadowColor();e.uniform3f(t.x3d_ShadowColor[n],s.r,s.g,s.b),e.uniform1f(t.x3d_ShadowIntensity[n],i.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[n],i.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[n],i.getShadowMapSize())}else e.uniform1f(t.x3d_ShadowIntensity[n],0)},dispose(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Vg.push(this)}}),Object.assign(Object.setPrototypeOf(Bg.prototype,Ag.prototype),{getLights:()=>Vg}),Object.defineProperties(Bg,{typeName:{value:"DirectionalLight",enumerable:!0},componentName:{value:"Lighting",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"global",new Qi.SFBool),new H(c.inputOutput,"on",new Qi.SFBool(!0)),new H(c.inputOutput,"color",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"intensity",new Qi.SFFloat(1)),new H(c.inputOutput,"ambientIntensity",new Qi.SFFloat),new H(c.inputOutput,"direction",new Qi.SFVec3f(0,0,-1)),new H(c.inputOutput,"shadows",new Qi.SFBool),new H(c.inputOutput,"shadowColor",new Qi.SFColor),new H(c.inputOutput,"shadowIntensity",new Qi.SFFloat(1)),new H(c.inputOutput,"shadowBias",new Qi.SFFloat(.005)),new H(c.initializeOnly,"shadowMapSize",new Qi.SFInt32(1024))]),enumerable:!0}});const Ug=Bg;n.set("x_ite/Components/Lighting/DirectionalLight",Ug);const Xg=Ug,jg=sl(kg);function kg(){this.modelViewMatrix=new zo(_n)}function zg(e){Ag.call(this,e),this.addType(c.EnvironmentLight)}Object.assign(kg.prototype,{set(e,t,n){},setGroup(e){this.groupNode=e},getModelViewMatrix(){return this.modelViewMatrix},renderShadowMap(e){},setGlobalVariables(e){},setShaderUniforms(e,t){},dispose(){jg.push(this)}}),Object.assign(Object.setPrototypeOf(zg.prototype,Ag.prototype),{getLights:()=>jg}),Object.defineProperties(zg,{typeName:{value:"EnvironmentLight",enumerable:!0},componentName:{value:"Lighting",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"global",new Qi.SFBool),new H(c.inputOutput,"on",new Qi.SFBool(!0)),new H(c.inputOutput,"rotation",new Qi.SFRotation),new H(c.inputOutput,"color",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"intensity",new Qi.SFFloat(1)),new H(c.inputOutput,"ambientIntensity",new Qi.SFFloat),new H(c.inputOutput,"diffuseCoefficients",new Qi.MFFloat),new H(c.inputOutput,"diffuse",new Qi.SFNode),new H(c.inputOutput,"diffuseTexture",new Qi.SFNode),new H(c.inputOutput,"specularTexture",new Qi.SFNode),new H(c.inputOutput,"shadows",new Qi.SFBool),new H(c.inputOutput,"shadowColor",new Qi.SFColor),new H(c.inputOutput,"shadowIntensity",new Qi.SFFloat(1)),new H(c.inputOutput,"shadowBias",new Qi.SFFloat(.005)),new H(c.initializeOnly,"shadowMapSize",new Qi.SFInt32(1024))]),enumerable:!0}});const Gg=zg;n.set("x_ite/Components/Lighting/EnvironmentLight",Gg);const Hg=Gg,qg=[(new _n).setRotation(new dn(new Et(1,0,0),Et.zAxis)),(new _n).setRotation(new dn(new Et(-1,0,0),Et.zAxis)),(new _n).setRotation(new dn(new Et(0,0,-1),Et.zAxis)),(new _n).setRotation(new dn(new Et(0,0,1),Et.zAxis)),(new _n).setRotation(new dn(new Et(0,1,0),Et.zAxis)),(new _n).setRotation(new dn(new Et(0,-1,0),Et.zAxis))],Yg=[new Yt(0,.5,.25,.5),new Yt(.5,.5,.25,.5),new Yt(.75,.5,.25,.5),new Yt(.25,.5,.25,.5),new Yt(0,0,.5,.5),new Yt(.5,0,.5,.5)],Wg=sl($g);function $g(){this.location=new Et(0,0,0),this.matrixArray=new Float32Array(9),this.shadowBuffer=null,this.viewVolume=new Sa,this.viewport=new Yt(0,0,0,0),this.projectionMatrix=new _n,this.modelViewMatrix=new zo(_n),this.modelMatrix=new _n,this.invLightSpaceMatrix=new _n,this.invLightSpaceProjectionMatrix=new _n,this.shadowMatrix=new _n,this.shadowMatrixArray=new Float32Array(16),this.rotation=new dn,this.rotationMatrix=new _n,this.textureUnit=void 0}function Kg(e){Ag.call(this,e),this.addType(c.PointLight),this._location.setUnit("length"),this._radius.setUnit("length")}Object.assign($g.prototype,{set(e,t,n){const i=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.global=e.getGlobal(),this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),e.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap(e){if(!this.shadowBuffer)return;const t=this.lightNode,n=e.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),s=this.invLightSpaceMatrix.assign(this.global?i:_n.Identity);s.translate(t.getLocation()),s.inverse();const r=t.getShadowMapSize();this.shadowBuffer.bind();for(let t=0;t<6;++t){const n=Yg[t],i=this.viewport.set(n[0]*r,n[1]*r,n[2]*r,n[3]*r),o=Ra.perspective2(f.radians(90),.125,1e4,i[2],i[3],this.projectionMatrix);e.getViewVolumes().push(this.viewVolume.set(o,i,i)),e.getProjectionMatrix().pushMatrix(this.projectionMatrix),e.getModelViewMatrix().pushMatrix(qg[t]),e.getModelViewMatrix().multLeft(s),e.render(Na.SHADOW,zu.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop()}this.shadowBuffer.unbind(),this.global||s.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(s)},setGlobalVariables(e){this.modelViewMatrix.get().multVecMatrix(this.location.assign(this.lightNode._location.getValue())),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms(e,t){const n=t.numLights++;if(this.shadowBuffer){const i=this.global?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(e.activeTexture(e.TEXTURE0+i),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(n,this))return;const i=this.lightNode,s=i.getColor(),r=i.getAttenuation(),o=this.location;if(e.uniform1i(t.x3d_LightType[n],2),e.uniform3f(t.x3d_LightColor[n],s.r,s.g,s.b),e.uniform1f(t.x3d_LightIntensity[n],i.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),e.uniform3f(t.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),e.uniform3f(t.x3d_LightLocation[n],o.x,o.y,o.z),e.uniform1f(t.x3d_LightRadius[n],i.getRadius()),e.uniformMatrix3fv(t.x3d_LightMatrix[n],!1,this.matrixArray),this.shadowBuffer){const s=i.getShadowColor();e.uniform3f(t.x3d_ShadowColor[n],s.r,s.g,s.b),e.uniform1f(t.x3d_ShadowIntensity[n],i.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[n],i.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[n],i.getShadowMapSize())}else e.uniform1f(t.x3d_ShadowIntensity[n],0)},dispose(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Wg.push(this)}}),Object.assign(Object.setPrototypeOf(Kg.prototype,Ag.prototype),{getAttenuation(){return this._attenuation.getValue()},getLocation(){return this._location.getValue()},getRadius(){return Math.max(0,this._radius.getValue())},getLights:()=>Wg}),Object.defineProperties(Kg,{typeName:{value:"PointLight",enumerable:!0},componentName:{value:"Lighting",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"global",new Qi.SFBool(!0)),new H(c.inputOutput,"on",new Qi.SFBool(!0)),new H(c.inputOutput,"color",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"intensity",new Qi.SFFloat(1)),new H(c.inputOutput,"ambientIntensity",new Qi.SFFloat),new H(c.inputOutput,"attenuation",new Qi.SFVec3f(1,0,0)),new H(c.inputOutput,"location",new Qi.SFVec3f),new H(c.inputOutput,"radius",new Qi.SFFloat(100)),new H(c.inputOutput,"shadows",new Qi.SFBool),new H(c.inputOutput,"shadowColor",new Qi.SFColor),new H(c.inputOutput,"shadowIntensity",new Qi.SFFloat(1)),new H(c.inputOutput,"shadowBias",new Qi.SFFloat(.005)),new H(c.initializeOnly,"shadowMapSize",new Qi.SFInt32(1024))]),enumerable:!0}});const Jg=Kg;n.set("x_ite/Components/Lighting/PointLight",Jg);const Zg=Jg,Qg=sl(ef);function ef(){this.location=new Et(0,0,0),this.direction=new Et(0,0,0),this.matrixArray=new Float32Array(9),this.renderShadow=!0,this.shadowBuffer=null,this.bbox=new La,this.viewVolume=new Sa,this.viewport=new Yt(0,0,0,0),this.projectionMatrix=new _n,this.modelViewMatrix=new zo(_n),this.modelMatrix=new _n,this.invLightSpaceMatrix=new _n,this.invLightSpaceProjectionMatrix=new _n,this.shadowMatrix=new _n,this.shadowMatrixArray=new Float32Array(16),this.rotation=new dn,this.lightBBoxMin=new Et(0,0,0),this.lightBBoxMax=new Et(0,0,0),this.textureUnit=void 0}function tf(e){Ag.call(this,e),this.addType(c.SpotLight),e.getSpecificationVersion()<=3.2&&(this._beamWidth=1.5708,this._cutOffAngle=.785398),this._location.setUnit("length"),this._radius.setUnit("length"),this._beamWidth.setUnit("angle"),this._cutOffAngle.setUnit("angle")}Object.assign(ef.prototype,{set(e,t,n){const i=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.global=e.getGlobal(),this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),e.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap(e){if(!this.shadowBuffer)return;const t=this.lightNode,n=e.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),s=this.invLightSpaceMatrix.assign(this.global?i:_n.Identity);s.translate(t.getLocation()),s.rotate(this.rotation.setFromToVec(Et.zAxis,this.direction.assign(t.getDirection()).negate())),s.inverse();this.groupNode.getSubBBox(this.bbox,!0).multRight(s).getExtents(this.lightBBoxMin,this.lightBBoxMax);const r=t.getShadowMapSize(),o=Math.min(t.getRadius(),-this.lightBBoxMin.z),a=this.viewport.set(0,0,r,r),l=Ra.perspective(2*t.getCutOffAngle(),.125,Math.max(1e4,o),r,r,this.projectionMatrix);this.renderShadow=o>0,this.shadowBuffer.bind(),e.getViewVolumes().push(this.viewVolume.set(l,a,a)),e.getProjectionMatrix().pushMatrix(l),e.getModelViewMatrix().pushMatrix(s),e.render(Na.SHADOW,zu.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop(),this.shadowBuffer.unbind(),this.global||s.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(s).multRight(l).multRight(t.getBiasMatrix())},setGlobalVariables(e){const t=this.lightNode,n=this.modelViewMatrix.get();n.multVecMatrix(this.location.assign(t._location.getValue())),n.multDirMatrix(this.direction.assign(t._direction.getValue())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms(e,t){const n=t.numLights++;if(this.shadowBuffer){const i=this.global?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(e.activeTexture(e.TEXTURE0+i),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(n,this))return;const i=this.lightNode,s=i.getColor(),r=i.getAttenuation(),o=this.location,a=this.direction;if(e.uniform1i(t.x3d_LightType[n],3),e.uniform3f(t.x3d_LightColor[n],s.r,s.g,s.b),e.uniform1f(t.x3d_LightIntensity[n],i.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),e.uniform3f(t.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),e.uniform3f(t.x3d_LightLocation[n],o.x,o.y,o.z),e.uniform3f(t.x3d_LightDirection[n],a.x,a.y,a.z),e.uniform1f(t.x3d_LightRadius[n],i.getRadius()),e.uniform1f(t.x3d_LightBeamWidth[n],i.getBeamWidth()),e.uniform1f(t.x3d_LightCutOffAngle[n],i.getCutOffAngle()),e.uniformMatrix3fv(t.x3d_LightMatrix[n],!1,this.matrixArray),this.renderShadow&&this.shadowBuffer){const s=i.getShadowColor();e.uniform3f(t.x3d_ShadowColor[n],s.r,s.g,s.b),e.uniform1f(t.x3d_ShadowIntensity[n],i.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[n],i.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[n],i.getShadowMapSize())}else e.uniform1f(t.x3d_ShadowIntensity[n],0)},dispose(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Qg.push(this)}}),Object.assign(Object.setPrototypeOf(tf.prototype,Ag.prototype),{getAttenuation(){return this._attenuation.getValue()},getLocation(){return this._location.getValue()},getRadius(){return Math.max(0,this._radius.getValue())},getBeamWidth(){const e=this._beamWidth.getValue(),t=this.getCutOffAngle();return e>t?t:f.clamp(e,0,Math.PI/2)},getCutOffAngle(){return f.clamp(this._cutOffAngle.getValue(),0,Math.PI/2)},getLights:()=>Qg}),Object.defineProperties(tf,{typeName:{value:"SpotLight",enumerable:!0},componentName:{value:"Lighting",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"global",new Qi.SFBool(!0)),new H(c.inputOutput,"on",new Qi.SFBool(!0)),new H(c.inputOutput,"color",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"intensity",new Qi.SFFloat(1)),new H(c.inputOutput,"ambientIntensity",new Qi.SFFloat),new H(c.inputOutput,"attenuation",new Qi.SFVec3f(1,0,0)),new H(c.inputOutput,"location",new Qi.SFVec3f),new H(c.inputOutput,"direction",new Qi.SFVec3f(0,0,-1)),new H(c.inputOutput,"radius",new Qi.SFFloat(100)),new H(c.inputOutput,"beamWidth",new Qi.SFFloat(.785398)),new H(c.inputOutput,"cutOffAngle",new Qi.SFFloat(1.5708)),new H(c.inputOutput,"shadows",new Qi.SFBool),new H(c.inputOutput,"shadowColor",new Qi.SFColor),new H(c.inputOutput,"shadowIntensity",new Qi.SFFloat(1)),new H(c.inputOutput,"shadowBias",new Qi.SFFloat(.005)),new H(c.initializeOnly,"shadowMapSize",new Qi.SFInt32(1024))]),enumerable:!0}});const nf=tf;n.set("x_ite/Components/Lighting/SpotLight",nf);const sf={name:"Lighting",concreteNodes:[Xg,Hg,Zg,nf],abstractNodes:[Ag]};n.set("x_ite/Components/Lighting",sf);const rf=sf;function of(e){zu.call(this,e),this.addType(c.Billboard),this.matrix=new _n}Object.assign(Object.setPrototypeOf(of.prototype,zu.prototype),{getBBox(e,t){return zu.prototype.getBBox.call(this,e,t).multRight(this.matrix)},getMatrix(){return this.matrix},rotate:function(){const e=new _n,t=new Et(0,0,0),n=new Et(0,0,0),i=new Et(0,0,0),s=new Et(0,0,0),r=new dn;return function(o){e.assign(o).inverse();const a=e.origin.normalize();if(this._axisOfRotation.getValue().equals(Et.Zero)){e.multDirMatrix(t.assign(Et.yAxis)).normalize();const i=t.cross(a);n.assign(a).cross(i);const s=a;i.normalize(),n.normalize(),this.matrix.set(i.x,i.y,i.z,0,n.x,n.y,n.z,0,s.x,s.y,s.z,0,0,0,0,1)}else i.assign(this._axisOfRotation.getValue()).cross(a),s.assign(this._axisOfRotation.getValue()).cross(Et.zAxis),this.matrix.setRotation(r.setFromToVec(s,i));return this.matrix}}(),traverse(e,t){const n=t.getModelViewMatrix();switch(n.push(),e){case Na.CAMERA:case Na.PICKING:case Na.SHADOW:n.multLeft(this.matrix);break;default:n.multLeft(this.rotate(n.get()))}zu.prototype.traverse.call(this,e,t),n.pop()}}),Object.defineProperties(of,{typeName:{value:"Billboard",enumerable:!0},componentName:{value:"Navigation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"axisOfRotation",new Qi.SFVec3f(0,1,0)),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const af=of;n.set("x_ite/Components/Navigation/Billboard",af);const lf=af;function uf(e){zu.call(this,e),uu.call(this,e),this.addType(c.Collision),"2.0"===e.getSpecificationVersion()&&this.addAlias("collide",this._enabled)}Object.assign(Object.setPrototypeOf(uf.prototype,zu.prototype),uu.prototype,{initialize(){zu.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._proxy.addInterest("set_proxy__",this),this.set_live__(),this.set_proxy__()},set_live__(){this.getLive().getValue()&&this._enabled.getValue()?this.getBrowser().addCollision(this):this.getBrowser().removeCollision(this)},set_active(e){this._isActive.getValue()!==e&&(this._isActive=e,e&&(this._collideTime=this.getBrowser().getCurrentTime()))},set_proxy__(){this.proxyNode=zl(c.X3DChildNode,this._proxy)},traverse(e,t){if(e!==Na.COLLISION)zu.prototype.traverse.call(this,e,t);else if(this._enabled.getValue()){const n=t.getCollisions();n.push(this),this.proxyNode?this.proxyNode.traverse(e,t):zu.prototype.traverse.call(this,e,t),n.pop()}},dispose(){zu.prototype.dispose.call(this)}}),Object.defineProperties(uf,{typeName:{value:"Collision",enumerable:!0},componentName:{value:"Navigation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"collideTime",new Qi.SFTime),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.initializeOnly,"proxy",new Qi.SFNode),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const hf=uf;n.set("x_ite/Components/Navigation/Collision",hf);const cf=hf;function df(e){zu.call(this,e),this.addType(c.LOD),"2.0"===e.getSpecificationVersion()&&this.addAlias("level",this._children),this._center.setUnit("length"),this._range.setUnit("length"),this.frameRate=60,this.keepCurrentLevel=!1,this.childNode=null,this.visibleNode=null,this.boundedObject=null}Object.assign(Object.setPrototypeOf(df.prototype,zu.prototype),{initialize(){zu.prototype.initialize.call(this),this._children.addInterest("set_child__",this)},getSubBBox(e,t){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=zl(c.X3DBoundedObject,this.visibleNode);return n?.getBBox(e,t)??e.set()}return e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear(){},add(){},remove(){},set_child__(){this.set_level__(Math.min(this._level_changed.getValue(),this._children.length-1))},set_level__(e){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),zl(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this)),e>=0&&e<this._children.length?(this.childNode=zl(c.X3DChildNode,this._children[e]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),zl(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)))):this.childNode=null,this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__(){this.setCameraObject(!!this.visibleNode?.isCameraObject())},set_transformSensors__(){this.setPickableObject(!(!this.getTransformSensors().size&&!this.visibleNode?.isPickableObject()))},set_visible__(){zl(c.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__(),this.set_transformSensors__()},set_bboxDisplay__(){zl(c.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},getLevel:function(e,t){if(0===this._range.length){this.frameRate=(179*this.frameRate+e.currentFrameRate)/180;const t=this._children.length;switch(t){case 0:return-1;case 1:return 0;case 2:return+(this.frameRate>55);default:{const e=1-f.clamp((this.frameRate-20)/35,0,1);return Math.min(Math.floor(e*t),t-1)}}}const n=t.translate(this._center.getValue()).origin.magnitude();return f.upperBound(this._range,0,this._range.length,n)},traverse:function(){const e=new _n;return function(t,n){switch(t){case Na.POINTER:case Na.CAMERA:case Na.SHADOW:return void this.visibleNode?.traverse(t,n);case Na.PICKING:{if(this.getTransformSensors().size){const e=n.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}const e=this.visibleNode;if(e){const i=this.getBrowser().getPickingHierarchy();i.push(this),e.traverse(t,n),i.pop()}return}case Na.COLLISION:return void this.visibleNode?.traverse(t,n);case Na.DISPLAY:if(!this.keepCurrentLevel){let t=this.getLevel(this.getBrowser(),e.assign(n.getModelViewMatrix().get())),i=this._level_changed.getValue();this._forceTransitions.getValue()&&(t>i?t=i+1:t<i&&(t=i-1)),t!==i&&(this._level_changed=t,this.set_level__(Math.min(t,this._children.length-1)))}return this.visibleNode?.traverse(t,n),void this.boundedObject?.displayBBox(t,n)}}}()}),Object.defineProperties(df,{typeName:{value:"LOD",enumerable:!0},componentName:{value:"Navigation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"forceTransitions",new Qi.SFBool),new H(c.initializeOnly,"center",new Qi.SFVec3f),new H(c.initializeOnly,"range",new Qi.MFFloat),new H(c.outputOnly,"level_changed",new Qi.SFInt32(-1)),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const pf=df;n.set("x_ite/Components/Navigation/LOD",pf);const gf=pf;function ff(e){Du.call(this,e),this.addType(c.OrthoViewpoint),this.addChildObjects("fieldOfViewOffset",new Qi.MFFloat(0,0,0,0)),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("length"),this.projectionMatrix=new _n,this.fieldOfViewOffsetInterpolator0=new Iu(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator1=new Iu(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator2=new Iu(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator3=new Iu(this.getBrowser().getPrivateScene())}Object.assign(Object.setPrototypeOf(ff.prototype,Du.prototype),{initialize(){Du.prototype.initialize.call(this),this.fieldOfViewOffsetInterpolator0._key=new Qi.MFFloat(0,1),this.fieldOfViewOffsetInterpolator1._key=new Qi.MFFloat(0,1),this.fieldOfViewOffsetInterpolator2._key=new Qi.MFFloat(0,1),this.fieldOfViewOffsetInterpolator3._key=new Qi.MFFloat(0,1),this.fieldOfViewOffsetInterpolator0.setup(),this.fieldOfViewOffsetInterpolator1.setup(),this.fieldOfViewOffsetInterpolator2.setup(),this.fieldOfViewOffsetInterpolator3.setup(),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator0._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator1._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator2._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator3._set_fraction),this.fieldOfViewOffsetInterpolator0._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator1._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator2._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator3._value_changed.addInterest("set_fieldOfViewOffset__",this)},set_fieldOfViewOffset__(){this._fieldOfViewOffset[0]=this.fieldOfViewOffsetInterpolator0._value_changed.getValue(),this._fieldOfViewOffset[1]=this.fieldOfViewOffsetInterpolator1._value_changed.getValue(),this._fieldOfViewOffset[2]=this.fieldOfViewOffsetInterpolator2._value_changed.getValue(),this._fieldOfViewOffset[3]=this.fieldOfViewOffsetInterpolator3._value_changed.getValue()},resetUserOffsets(){Du.prototype.resetUserOffsets.call(this),this._fieldOfViewOffset[0]=0,this._fieldOfViewOffset[1]=0,this._fieldOfViewOffset[2]=0,this._fieldOfViewOffset[3]=0},getRelativeTransformation(e){const t=Du.prototype.getRelativeTransformation.call(this,e);return e.constructor===this.constructor&&(t.userMinimumX=e.getUserMinimumX(),t.userMinimumY=e.getUserMinimumY(),t.userMaximumX=e.getUserMaximumX(),t.userMaximumY=e.getUserMaximumY()),t},setInterpolators(e,t){if(e.constructor===this.constructor){const e=t.userMinimumX-this.getMinimumX(),n=t.userMinimumY-this.getMinimumY(),i=t.userMaximumX-this.getMaximumX(),s=t.userMaximumY-this.getMaximumY();this.fieldOfViewOffsetInterpolator0._keyValue=new Qi.MFFloat(e,this._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new Qi.MFFloat(n,this._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new Qi.MFFloat(i,this._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new Qi.MFFloat(s,this._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new Qi.MFFloat(1,this._fieldOfViewScale.getValue()),this._fieldOfViewOffset[0]=t.offset0,this._fieldOfViewOffset[1]=t.offset1,this._fieldOfViewOffset[2]=t.offset2,this._fieldOfViewOffset[3]=t.offset3,this._fieldOfViewScale=1}else this.fieldOfViewOffsetInterpolator0._keyValue=new Qi.MFFloat(this._fieldOfViewOffset[0],this._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new Qi.MFFloat(this._fieldOfViewOffset[1],this._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new Qi.MFFloat(this._fieldOfViewOffset[2],this._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new Qi.MFFloat(this._fieldOfViewOffset[3],this._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new Qi.MFFloat(1,this._fieldOfViewOffset.getValue()),this._fieldOfViewOffset=this._fieldOfViewOffset.getValue(),this._fieldOfViewScale=1},getLogarithmicDepthBuffer:()=>!1,getMinimumX(){return this._fieldOfView.length>0?this._fieldOfView[0]:-1},getUserMinimumX(){return(this.getMinimumX()+this._fieldOfViewOffset[0])*this._fieldOfViewScale.getValue()},getMinimumY(){return this._fieldOfView.length>1?this._fieldOfView[1]:-1},getUserMinimumY(){return(this.getMinimumY()+this._fieldOfViewOffset[1])*this._fieldOfViewScale.getValue()},getMaximumX(){return this._fieldOfView.length>2?this._fieldOfView[2]:1},getUserMaximumX(){return(this.getMaximumX()+this._fieldOfViewOffset[2])*this._fieldOfViewScale.getValue()},getMaximumY(){return this._fieldOfView.length>3?this._fieldOfView[3]:1},getUserMaximumY(){return(this.getMaximumY()+this._fieldOfViewOffset[3])*this._fieldOfViewScale.getValue()},getSizeX(){return this.getMaximumX()-this.getMinimumX()},getUserSizeX(){return this.getUserMaximumX()-this.getUserMinimumX()},getSizeY(){return this.getMaximumY()-this.getMinimumY()},getUserSizeY(){return this.getUserMaximumY()-this.getUserMinimumY()},getMaxFarValue:()=>1e4,getScreenScale(e,t,n){const i=t[2],s=t[3],r=this.getUserSizeX(),o=this.getUserSizeY();if(i/s>r/o){const e=o/s;return n.set(e,e,e)}{const e=r/i;return n.set(e,e,e)}},getViewportSize:function(){const e=new wt(0,0);return function(t,n){const i=t[2],s=t[3],r=this.getUserSizeX(),o=this.getUserSizeY(),a=i/s;return a>r/o?e.set(o*a,o):e.set(r,r/a)}}(),getLookAtDistance:e=>e.size.magnitude()/2+10,getProjectionMatrixWithLimits(e,t,n){const i=n[2]/n[3],s=this.getUserSizeX(),r=this.getUserSizeY();if(i>s/r){const n=(this.getUserMinimumX()+this.getUserMaximumX())/2,s=r*i/2;return Ra.ortho(n-s,n+s,this.getUserMinimumY(),this.getUserMaximumY(),e,t,this.projectionMatrix)}{const n=(this.getUserMinimumY()+this.getUserMaximumY())/2,r=s/i/2;return Ra.ortho(this.getUserMinimumX(),this.getUserMaximumX(),n-r,n+r,e,t,this.projectionMatrix)}},viewAll(e){Du.prototype.viewAll.call(this,e);const t=e.size,n=t.x/this.getSizeX(),i=t.y/this.getSizeY(),s=1.1*Math.max(n,i);this._fieldOfViewOffset[0]=this.getMinimumX()*s-this.getMinimumX(),this._fieldOfViewOffset[1]=this.getMinimumY()*s-this.getMinimumY(),this._fieldOfViewOffset[2]=this.getMaximumX()*s-this.getMaximumX(),this._fieldOfViewOffset[3]=this.getMaximumY()*s-this.getMaximumY()}}),Object.defineProperties(ff,{typeName:{value:"OrthoViewpoint",enumerable:!0},componentName:{value:"Navigation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_bind",new Qi.SFBool),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"position",new Qi.SFVec3f(0,0,10)),new H(c.inputOutput,"orientation",new Qi.SFRotation),new H(c.inputOutput,"centerOfRotation",new Qi.SFVec3f),new H(c.inputOutput,"fieldOfView",new Qi.MFFloat(-1,-1,1,1)),new H(c.inputOutput,"nearDistance",new Qi.SFFloat(-1)),new H(c.inputOutput,"farDistance",new Qi.SFFloat(-1)),new H(c.inputOutput,"viewAll",new Qi.SFBool),new H(c.inputOutput,"jump",new Qi.SFBool(!0)),new H(c.inputOutput,"retainUserOffsets",new Qi.SFBool),new H(c.outputOnly,"isBound",new Qi.SFBool),new H(c.outputOnly,"bindTime",new Qi.SFTime),new H(c.inputOutput,"navigationInfo",new Qi.SFNode)]),enumerable:!0}});const mf=ff;n.set("x_ite/Components/Navigation/OrthoViewpoint",mf);const _f=mf;function xf(e){Ys.call(this,e),this.addType(c.ViewpointGroup),this._size.setUnit("length"),this._center.setUnit("length"),this.proximitySensor=new fc(e),this.cameraObjects=[],this.viewpointGroups=[]}function yf(e,t){switch(e){case Na.CAMERA:if(this.proximitySensor.traverse(e,t),this.proximitySensor._isActive.getValue())for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(e,t);return;case Na.DISPLAY:if(this.proximitySensor.traverse(e,t),this.proximitySensor._isActive.getValue())for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(e,t);return}}function wf(e,t){switch(e){case Na.CAMERA:for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(e,t);return;case Na.DISPLAY:for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(e,t);return}}Object.assign(Object.setPrototypeOf(xf.prototype,Ys.prototype),{initialize(){Ys.prototype.initialize.call(this),this.proximitySensor.setup(),this._size.addFieldInterest(this.proximitySensor._size),this._center.addFieldInterest(this.proximitySensor._center),this.proximitySensor._size=this._size,this.proximitySensor._center=this._center,this._displayed.addInterest("set_displayed__",this),this._size.addInterest("set_displayed__",this),this._children.addInterest("set_children__",this),this.set_displayed__(),this.set_children__()},isActive(){return this.proximitySensor._isActive.getValue()},set_displayed__(){var e=!this._size.getValue().equals(Et.Zero),t=this._displayed.getValue();this.proximitySensor._enabled=t&&e,t&&e?(this.proximitySensor._isCameraObject.addFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.addFieldInterest(this._isPickableObject),this.setCameraObject(this.proximitySensor.isCameraObject()),this.setPickableObject(this.proximitySensor.isPickableObject()),this.traverse=yf):(this.proximitySensor._isCameraObject.removeFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.removeFieldInterest(this._isPickableObject),this.setCameraObject(t),this.setPickableObject(!1),t?this.traverse=wf:delete this.traverse)},set_children__(){this.cameraObjects.length=0,this.viewpointGroups.length=0;for(var e=this._children,t=0,n=e.length;t<n;++t)try{for(var i=e[t].getValue().getInnerNode(),s=i.getType(),r=s.length-1;r>=0;--r)switch(s[r]){case c.X3DViewpointNode:this.cameraObjects.push(i);break;case c.ViewpointGroup:this.cameraObjects.push(i),this.viewpointGroups.push(i)}}catch{}},traverse(){}}),Object.defineProperties(xf,{typeName:{value:"ViewpointGroup",enumerable:!0},componentName:{value:"Navigation",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"displayed",new Qi.SFBool(!0)),new H(c.inputOutput,"retainUserOffsets",new Qi.SFBool),new H(c.inputOutput,"size",new Qi.SFVec3f),new H(c.inputOutput,"center",new Qi.SFVec3f),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const bf=xf;n.set("x_ite/Components/Navigation/ViewpointGroup",bf);const Sf={name:"Navigation",concreteNodes:[lf,cf,gf,nl,_f,Vu,bf],abstractNodes:[Du]};n.set("x_ite/Components/Navigation",Sf);const vf=Sf;function Tf(e,t,n,i){this.node=null,this.modelViewMatrix=new _n,this.projectionMatrix=new _n,this.viewport=new Yt(0,0,0,0),this.set(e,t,n,i)}Object.assign(Tf.prototype,{set(e,t,n,i){this.node=e,this.modelViewMatrix.assign(t),this.projectionMatrix.assign(n),this.viewport.assign(i)},set_over__(e,t){this.node.set_over__(e,t,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_active__(e,t){this.node.set_active__(e,t,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_motion__(e){this.node.set_motion__(e,this.modelViewMatrix,this.projectionMatrix,this.viewport)}});const Of=Tf;n.set("x_ite/Browser/PointingDeviceSensor/PointingDeviceSensorContainer",Of);const Ef=Of;function Cf(e){uu.call(this,e),this.addType(c.X3DPointingDeviceSensorNode)}Object.assign(Object.setPrototypeOf(Cf.prototype,uu.prototype),{initialize(){uu.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this.set_live__()},set_live__(){this.getLive().getValue()&&this._enabled.getValue()?(this.getBrowser().addPointingDeviceSensor(this),delete this.push):(this.getBrowser().removePointingDeviceSensor(this),this._isActive.getValue()&&(this._isActive=!1),this._isOver.getValue()&&(this._isOver=!1),this.push=Function.prototype)},set_over__(e,t){e!==this._isOver.getValue()&&(this._isOver=e,e&&(this.getBrowser().getNotification()._string=this._description))},set_active__(e,t){e!==this._isActive.getValue()&&(this._isActive=e)},set_motion__(e){},push(e,t){t.push(new Ef(this,e.getModelViewMatrix().get(),e.getProjectionMatrix().get(),e.getViewVolume().getViewport()))}}),Object.defineProperties(Cf,{typeName:{value:"X3DPointingDeviceSensorNode",enumerable:!0},componentName:{value:"PointingDeviceSensor",enumerable:!0}});const Nf=Cf;n.set("x_ite/Components/PointingDeviceSensor/X3DPointingDeviceSensorNode",Nf);const Ff=Nf;function If(e){Ff.call(this,e),this.addType(c.X3DTouchSensorNode)}Object.assign(Object.setPrototypeOf(If.prototype,Ff.prototype),{set_active__(e,t){Ff.prototype.set_active__.call(this,e,t),this._enabled.getValue()&&this._isOver.getValue()&&!e&&(this._touchTime=this.getBrowser().getCurrentTime())},set_over__:function(){const e=new _n,t=new wt(0,0);return function(n,i,s,r,o){Ff.prototype.set_over__.call(this,n,i,s,r,o),this._isOver.getValue()&&(t.set(i.texCoord.x,i.texCoord.y).divide(i.texCoord.w),e.assign(s).inverse(),this._hitTexCoord_changed=t,this._hitNormal_changed=s.multMatrixDir(i.normal.copy()).normalize(),this._hitPoint_changed=e.multVecMatrix(i.point.copy()))}}()}),Object.defineProperties(If,{typeName:{value:"X3DTouchSensorNode",enumerable:!0},componentName:{value:"PointingDeviceSensor",enumerable:!0}});const Mf=If;n.set("x_ite/Components/PointingDeviceSensor/X3DTouchSensorNode",Mf);const Pf=Mf;function Df(e){Pf.call(this,e),this.addType(c.TouchSensor),this._hitPoint_changed.setUnit("length")}Object.setPrototypeOf(Df.prototype,Pf.prototype),Object.defineProperties(Df,{typeName:{value:"TouchSensor",enumerable:!0},componentName:{value:"PointingDeviceSensor",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.outputOnly,"hitTexCoord_changed",new Qi.SFVec2f),new H(c.outputOnly,"hitNormal_changed",new Qi.SFVec3f),new H(c.outputOnly,"hitPoint_changed",new Qi.SFVec3f),new H(c.outputOnly,"isOver",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"touchTime",new Qi.SFTime)]),enumerable:!0}});const Rf=Df;n.set("x_ite/Components/PointingDeviceSensor/TouchSensor",Rf);const Af=Rf;function Vf(e){zu.call(this,e),Rr.call(this,e),this.addType(c.Anchor),this.touchSensorNode=new Af(e),this.anchorSensors=[]}Object.assign(Object.setPrototypeOf(Vf.prototype,zu.prototype),Rr.prototype,{initialize(){zu.prototype.initialize.call(this),Rr.prototype.initialize.call(this),this._description.addFieldInterest(this.touchSensorNode._description),this._load.addFieldInterest(this.touchSensorNode._enabled),this.touchSensorNode._description=this._description,this.touchSensorNode._enabled=this._load,this.touchSensorNode.setup(),this.touchSensorNode.set_active__=(e,t)=>{Af.prototype.set_active__.call(this.touchSensorNode,e,t),this.touchSensorNode._isOver.getValue()&&!e&&this.requestImmediateLoad().catch(Function.prototype)}},set_load__(){},set_url__(){},requestImmediateLoad(e=!0){return this.setCache(e),this.setLoadState(c.IN_PROGRESS_STATE,!1),new Promise(((e,t)=>{new hh(this).createX3DFromURL(this._url,this._parameter,(n=>{n?(this.getBrowser().replaceWorld(n),this.setLoadState(c.COMPLETE_STATE,!1),e()):(this.setLoadState(c.FAILED_STATE,!1),t())}),(t=>{this.getBrowser().changeViewpoint(t),this.setLoadState(c.COMPLETE_STATE,!1),e()}),((t,n)=>{n?window.open(t,n):location=t,this.setLoadState(c.COMPLETE_STATE,!1),e()}))}))},requestUnload(){},traverse(e,t){if(e===Na.POINTER){const n=this.anchorSensors;n.length=0,this.touchSensorNode.push(t,n),n.length?(t.getSensors().push(n),zu.prototype.traverse.call(this,e,t),t.getSensors().pop()):zu.prototype.traverse.call(this,e,t)}else zu.prototype.traverse.call(this,e,t)},dispose(){Rr.prototype.dispose.call(this),zu.prototype.dispose.call(this)}}),Object.defineProperties(Vf,{typeName:{value:"Anchor",enumerable:!0},componentName:{value:"Networking",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"parameter",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600)),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.inputOnly,"addChildren",new Qi.MFNode),new H(c.inputOnly,"removeChildren",new Qi.MFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const Lf=Vf;n.set("x_ite/Components/Networking/Anchor",Lf);const Bf=Lf;function Uf(e){Ys.call(this,e),Rr.call(this,e),Uu.call(this,e),this.addType(c.Inline),e.getSpecificationVersion()<4&&(this._global=!0),this.scene=this.getBrowser().getDefaultScene(),this.groupNode=new qu(e),this.localObjects=[],this.localShadows=!1}Object.assign(Object.setPrototypeOf(Uf.prototype,Ys.prototype),Rr.prototype,Uu.prototype,{initialize(){Ys.prototype.initialize.call(this),Rr.prototype.initialize.call(this),Uu.prototype.initialize.call(this),this.groupNode.setPrivate(!0),this.groupNode.setup(),this.groupNode._isCameraObject.addFieldInterest(this._isCameraObject),this.groupNode._isPickableObject.addFieldInterest(this._isPickableObject),this.requestImmediateLoad().catch(Function.prototype)},getBBox(e,t){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.groupNode.getBBox(e,t):e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},set_live__(){Rr.prototype.set_live__.call(this),this.isPrivate()||this.scene.setLive(this.getLive().getValue())},unloadData(){this.abortLoading(),this.setInternalScene(this.getBrowser().getDefaultScene())},loadData(){this.abortLoading(),this.fileLoader=new hh(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},abortLoading(){this.scene._loadCount.removeInterest("checkLoadCount",this),this.fileLoader&&this.fileLoader.abort()},setInternalSceneAsync(e){e?(e._loadCount.addInterest("checkLoadCount",this),this.setInternalScene(e),this.checkLoadCount(e._loadCount)):(this.setInternalScene(this.getBrowser().getDefaultScene()),this.setLoadState(c.FAILED_STATE))},checkLoadCount(e){e.getValue()||(e.removeInterest("checkLoadCount",this),this.setLoadState(c.COMPLETE_STATE))},setInternalScene(e){this.scene.setLive(!1),this.scene.rootNodes.removeFieldInterest(this.groupNode._children),this.scene=e,this.scene.setExecutionContext(this.getExecutionContext()),this.scene.setPrivate(this.getExecutionContext().isPrivate()),this.scene.rootNodes.addFieldInterest(this.groupNode._children),this.groupNode._children=this.scene.rootNodes,this.set_live__(),this.getBrowser().addBrowserEvent()},getInternalScene(){return this.scene},traverse(e,t){switch(e){case Na.PICKING:{const n=this.getBrowser().getPickingHierarchy();return n.push(this),this.groupNode.traverse(e,t),void n.pop()}case Na.DISPLAY:if(this._global.getValue())this.groupNode.traverse(e,t);else{const n=t.getGlobalObjects(),i=t.getGlobalShadows(),s=n.length,r=i.length,o=this.localObjects,a=o.length,l=o.reduce(((e,t)=>e+!!t.lightNode),0),u=o.reduce(((e,t)=>e+!!t.textureProjectorNode),0);if(a&&(t.getLocalObjects().push(...o),t.pushLocalShadows(this.localShadows),t.getLocalObjectsCount()[1]+=l,t.getLocalObjectsCount()[2]+=u),this.groupNode.traverse(e,t),a){if(t.isIndependent()){const e=this.getBrowser();for(let n=0;n<a;++n)e.getLocalObjects().push(t.getLocalObjects().pop())}else for(let e=0;e<a;++e)t.getLocalObjects().pop();t.popLocalShadows(),t.getLocalObjectsCount()[1]-=l,t.getLocalObjectsCount()[2]-=u}const h=n.length-s;for(let e=0;e<h;++e){const t=n[s+e];t.groupNode=this.groupNode,t.global=!1,o[e]=t}o.length=h,this.localShadows=i.at(-1),n.length=s,i.length=r}return;default:return void this.groupNode.traverse(e,t)}},dispose(){Uu.prototype.dispose.call(this),Rr.prototype.dispose.call(this),Ys.prototype.dispose.call(this)}}),Object.defineProperties(Uf,{typeName:{value:"Inline",enumerable:!0},componentName:{value:"Networking",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"global",new Qi.SFBool),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600)),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f)]),enumerable:!0}});const Xf=Uf;n.set("x_ite/Components/Networking/Inline",Xf);const jf=Xf;function kf(e){uu.call(this,e),this.addType(c.X3DNetworkSensorNode)}Object.setPrototypeOf(kf.prototype,uu.prototype),Object.defineProperties(kf,{typeName:{value:"X3DNetworkSensorNode",enumerable:!0},componentName:{value:"Networking",enumerable:!0}});const zf=kf;n.set("x_ite/Components/Networking/X3DNetworkSensorNode",zf);const Gf=zf;function Hf(e){Gf.call(this,e),this.addType(c.LoadSensor),e.getSpecificationVersion()<4&&this.addAlias("watchList",this._children),this.urlObjects=[],this.aborted=!1,this.timeOutId=void 0}Object.assign(Object.setPrototypeOf(Hf.prototype,Gf.prototype),{initialize(){Gf.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._timeOut.addInterest("set_timeOut__",this),this._children.addInterest("set_children__",this),this.set_children__()},set_enabled__(){this._enabled.getValue()?this.reset():(this.abort(),this.remove())},set_timeOut__(){this._isActive.getValue()&&(this.clearTimeout(),this.aborted=!1,this._timeOut.getValue()>0&&(this.timeOutId=setTimeout(this.abort.bind(this),1e3*this._timeOut.getValue())))},set_children__(){this.reset()},set_loadState__(e){switch(e.checkLoadState()){case c.NOT_STARTED_STATE:break;case c.IN_PROGRESS_STATE:case c.COMPLETE_STATE:case c.FAILED_STATE:this.count()}},count(){const e=this.urlObjects;if(e.length){let t=0,n=0;for(const i of e)t+=i.checkLoadState()==c.COMPLETE_STATE,n+=i.checkLoadState()==c.FAILED_STATE;const i=t===e.length,s=t/e.length;this.aborted||n||i?(this.clearTimeout(),this._isActive=!1,this._isLoaded=i,this._progress=s,i&&(this._loadTime=this.getBrowser().getCurrentTime())):this._isActive.getValue()?this._progress=s:(this._isActive=!0,this._progress=s,this.set_timeOut__())}else this._isActive=!1,this._isLoaded=!1,this._progress=0},abort(){this.clearTimeout(),this.aborted=!0,this._enabled.getValue()&&this.count()},reset(){if(this.remove(),!this._enabled.getValue())return;const e=this.urlObjects;for(const t of this._children){const n=zl(c.X3DUrlObject,t);n&&(e.push(n),n._loadState.addInterest("set_loadState__",this,n))}this.count()},remove(){this.clearTimeout();const e=this.urlObjects;for(const t of e)t._loadState.removeInterest("set_loadState__",this);e.length=0},clearTimeout(){clearTimeout(this.timeOutId),this.timeOutId=void 0}}),Object.defineProperties(Hf,{typeName:{value:"LoadSensor",enumerable:!0},componentName:{value:"Networking",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"timeOut",new Qi.SFTime),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"isLoaded",new Qi.SFBool),new H(c.outputOnly,"progress",new Qi.SFFloat),new H(c.outputOnly,"loadTime",new Qi.SFTime),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const qf=Hf;n.set("x_ite/Components/Networking/LoadSensor",qf);const Yf=qf,Wf={name:"Networking",concreteNodes:[Bf,jf,Yf],abstractNodes:[Gf,Rr]};n.set("x_ite/Components/Networking",Wf);const $f=Wf;function Kf(e){Ff.call(this,e),this.addType(c.X3DDragSensorNode),this._trackPoint_changed.setUnit("length")}Object.setPrototypeOf(Kf.prototype,Ff.prototype),Object.defineProperties(Kf,{typeName:{value:"X3DDragSensorNode",enumerable:!0},componentName:{value:"PointingDeviceSensor",enumerable:!0}});const Jf=Kf;n.set("x_ite/Components/PointingDeviceSensor/X3DDragSensorNode",Jf);const Zf=Jf;function Qf(e,t){this.axis=e.copy(),this.radius=t}Object.assign(Qf.prototype,{intersectsLine(e,t,n){const i=new dn(this.axis.direction,new Et(0,1,0)),s=_n.Rotation(i),r=1/this.radius,o=new _n;o.scale(new Et(r,r,r)),o.multLeft(s);const a=e.point.copy().subtract(this.axis.point),l=new Xa(a,e.direction).multLineMatrix(o),u=this.unitCylinderIntersectsLine(l,t,n);if(u){const e=o.inverse();e.multVecMatrix(t),t.add(this.axis.point),e.multVecMatrix(n),n.add(this.axis.point)}return u},unitCylinderIntersectsLine(e,t,n){let i,s;const r=e.point,o=e.direction,a=o[0]*o[0]+o[2]*o[2],l=2*(r[0]*o[0]+r[2]*o[2]),u=r[0]*r[0]+r[2]*r[2]-1,h=l*l-4*a*u;if(h<0)return!1;const c=Math.sqrt(h);return l>0?(i=-2*u/(c+l),s=-(c+l)/(2*a)):(i=2*u/(c-l),s=(c-l)/(2*a)),t.assign(o).multiply(i).add(r),n.assign(o).multiply(s).add(r),!0},toString(){return`${this.axis}, ${this.radius}`}});const em=Qf;n.set("standard/Math/Geometry/Cylinder3",em);const tm=em;function nm(e){Zf.call(this,e),this.addType(c.CylinderSensor),this._diskAngle.setUnit("angle"),this._minAngle.setUnit("angle"),this._maxAngle.setUnit("angle"),this._offset.setUnit("angle")}Object.assign(Object.setPrototypeOf(nm.prototype,Zf.prototype),{initialize(){Zf.prototype.initialize.call(this),this.modelViewMatrix=new _n,this.invModelViewMatrix=new _n,this.cylinder=new tm(new Xa(new Et(0,0,0),new Et(0,0,0)),0),this.disk=!1,this.yPlane=null,this.zPlane=null,this.sxPlane=null,this.szNormal=null,this.behind=!1,this.fromVector=new Et(0,0,0),this.startOffset=new dn},isBehind(e,t){const n=new Et(0,0,0),i=new Et(0,0,0);return this.cylinder.intersectsLine(e,n,i),t.distance(n)>t.distance(i)},getTrackPoint(e,t){const n=new Et(0,0,0);this.zPlane.intersectsLine(e,n);const i=n.copy().add(this.cylinder.axis.getPerpendicularVectorToPoint(n,new Et(0,0,0))),s=this.sxPlane.getDistanceToPoint(n)/this.cylinder.radius,r=Math.floor((s+1)/2),o=f.interval(s,-1,1),a=(0===r?Math.asin(o):o*Math.PI/2)+r*Math.PI;new dn(this.cylinder.axis.direction,a).multVecRot(t.assign(this.szNormal).multiply(this.cylinder.radius)),t.add(i)},getAngle(e){return e.getAxis(new Et(0,0,0)).dot(this.cylinder.axis.direction)>0?e.angle:-e.angle},set_active__(e,t,n,i,s){if(Zf.prototype.set_active__.call(this,e,t,n,i,s),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();const e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=this.invModelViewMatrix.multVecMatrix(t.point.copy()),s=this._axisRotation.getValue().multVecRot(new Et(0,1,0)),r=this.invModelViewMatrix.multDirMatrix(new Et(0,0,1)).normalize(),o=new Xa(new Et(0,0,0),s),a=o.getPerpendicularVectorToPoint(i,new Et(0,0,0)).magnitude();this.cylinder=new tm(o,a),this.disk=Math.abs(r.dot(s))>Math.cos(this._diskAngle.getValue()),this.behind=this.isBehind(e,i),this.yPlane=new la(i,s),this.zPlane=new la(i,r);const l=this.invModelViewMatrix.origin,u=s.copy().cross(l).normalize();this.sxPlane=new la(new Et(0,0,0),u),this.szNormal=u.copy().cross(s).normalize();const h=new Et(0,0,0);this.disk?this.yPlane.intersectsLine(e,h):this.getTrackPoint(e,h),this.fromVector=this.cylinder.axis.getPerpendicularVectorToPoint(h,new Et(0,0,0)).negate(),this.startOffset=new dn(s,this._offset.getValue()),this._trackPoint_changed=h,this._rotation_changed=this.startOffset,this.angle=this._offset.getValue(),this.startVector=this._rotation_changed.getValue().multVecRot(this._axisRotation.getValue().multVecRot(new Et(0,0,1)))}else this._autoOffset.getValue()&&(this._offset=this.getAngle(this._rotation_changed.getValue()))},set_motion__(e){const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new Et(0,0,0);this.disk?this.yPlane.intersectsLine(t,n):this.getTrackPoint(t,n),this._trackPoint_changed=n;const i=this.cylinder.axis.getPerpendicularVectorToPoint(n,new Et(0,0,0)).negate(),s=new dn(this.fromVector,i);if(this.disk){this.modelViewMatrix.multVecMatrix(n.copy()).z>0&&s.multRight(new dn(this.yPlane.normal,Math.PI))}else this.behind&&s.inverse();if(s.multLeft(this.startOffset),this._minAngle.getValue()>this._maxAngle.getValue())this._rotation_changed=s;else{const e=s.multVecRot(this._axisRotation.getValue().multVecRot(new Et(0,0,1))),t=new dn(this.startVector,e),n=this._axisRotation.getValue().multVecRot(new Et(0,1,0)).dot(t.getAxis(new Et(0,0,0)))>0?1:-1,i=this._minAngle.getValue(),r=this._maxAngle.getValue();this.angle+=n*t.angle,this.startVector.assign(e),this.angle<i?s.setAxisAngle(this.cylinder.axis.direction,i):this.angle>r?s.setAxisAngle(this.cylinder.axis.direction,r):s.setAxisAngle(this.cylinder.axis.direction,this.angle),this._rotation_changed.getValue().equals(s)||(this._rotation_changed=s)}}}),Object.defineProperties(nm,{typeName:{value:"CylinderSensor",enumerable:!0},componentName:{value:"PointingDeviceSensor",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"axisRotation",new Qi.SFRotation),new H(c.inputOutput,"diskAngle",new Qi.SFFloat(.261792)),new H(c.inputOutput,"minAngle",new Qi.SFFloat),new H(c.inputOutput,"maxAngle",new Qi.SFFloat(-1)),new H(c.inputOutput,"offset",new Qi.SFFloat),new H(c.inputOutput,"autoOffset",new Qi.SFBool(!0)),new H(c.outputOnly,"trackPoint_changed",new Qi.SFVec3f),new H(c.outputOnly,"rotation_changed",new Qi.SFRotation),new H(c.outputOnly,"isOver",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const im=nm;n.set("x_ite/Components/PointingDeviceSensor/CylinderSensor",im);const sm=im;function rm(e,t){this.point=e.copy(),this.direction=t.copy()}Object.assign(rm.prototype,{copy(){const e=Object.create(rm.prototype);return e.point=this.point.copy(),e.direction=this.direction.copy(),e},assign(e){return this.point.assign(e.point),this.direction.assign(e.direction),this},set(e,t){return this.point.assign(e),this.direction.assign(t),this},setPoints(e,t){return this.point.assign(e),this.direction.assign(t).subtract(e).normalize(),this},multMatrixLine(e){return e.multMatrixVec(this.point),e.multMatrixDir(this.direction).normalize(),this},multLineMatrix(e){return e.multVecMatrix(this.point),e.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint(e,t){const n=t.assign(e).subtract(this.point).dot(this.direction);return t.assign(this.direction).multiply(n).add(this.point)},getPerpendicularVectorToPoint:function(){const e=new wt(0,0);return function(t,n){return n.assign(this.point).subtract(t),n.subtract(e.assign(this.direction).multiply(n.dot(this.direction)))}}(),intersectsLine:function(){const e=new wt(0,0);return function(t,n){const{point:i,direction:s}=this,{point:r,direction:o}=t,a=s.dot(o);if(Math.abs(a)>=1)return!1;e.assign(r).subtract(i);const l=(e.dot(s)-a*e.dot(o))/(1-a*a);return n.assign(s).multiply(l).add(i),!0}}(),toString(){return`${this.point}, ${this.direction}`}}),Object.assign(rm,{Points(e,t){const n=Object.create(rm.prototype);return n.point=e.copy(),n.direction=t.copy().subtract(e).normalize(),n}});const om=rm;n.set("standard/Math/Geometry/Line2",om);const am=new om(wt.Zero,wt.Zero),lm=new wt(0,0,0),um=new Xa(Et.Zero,Et.Zero);function hm(e){Zf.call(this,e),this.addType(c.PlaneSensor),this._offset.setUnit("length"),this._minPosition.setUnit("length"),this._maxPosition.setUnit("length"),this._translation_changed.setUnit("length")}Object.assign(Object.setPrototypeOf(hm.prototype,Zf.prototype),{initialize(){Zf.prototype.initialize.call(this),this.modelViewMatrix=new _n,this.invModelViewMatrix=new _n,this.projectionMatrix=new _n,this.viewport=new Yt,this.planeSensor=!0,this.plane=null,this.line=null,this.startOffset=new Et(0,0,0),this.startPoint=new Et(0,0,0)},getLineTrackPoint(e,t,n){return Sa.projectLine(t,this.modelViewMatrix,this.projectionMatrix,this.viewport,am),am.getClosestPointToPoint(e.pointer,lm),Sa.unProjectRay(lm.x,lm.y,this.modelViewMatrix,this.projectionMatrix,this.viewport,um),t.getClosestPointToLine(um,n)},set_active__(e,t,n,i,s){if(Zf.prototype.set_active__.call(this,e,t,n,i,s),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.projectionMatrix.assign(i),this.viewport.assign(s),this.invModelViewMatrix.assign(n).inverse();const e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),r=this.invModelViewMatrix.multVecMatrix(t.point.copy()),o=this._axisRotation.getValue();if(this._minPosition.x===this._maxPosition.x){this.planeSensor=!1;const e=o.multVecRot(new Et(0,Math.abs(this._maxPosition.y-this._minPosition.y),0));this.line=new Xa(r,e.normalize())}else if(this._minPosition.y===this._maxPosition.y){this.planeSensor=!1;const e=o.multVecRot(new Et(Math.abs(this._maxPosition.x-this._minPosition.x),0,0));this.line=new Xa(r,e.normalize())}else this.planeSensor=!0,this.plane=new la(r,o.multVecRot(new Et(0,0,1)));if(this.planeSensor)this.plane.intersectsLine(e,this.startPoint)&&this.trackStart(this.startPoint);else if(this.getLineTrackPoint(t,this.line,this.startPoint)){const e=new Et(0,0,0);try{this.getLineTrackPoint(t,new Xa(this.line.direction,this.line.direction),e)}catch{e.assign(this.startPoint)}this.trackStart(e)}}else this._autoOffset.getValue()&&(this._offset=this._translation_changed)},trackStart(e){this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=e,this._translation_changed=this._offset.getValue()},set_motion__(e){try{if(this.planeSensor){const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new Et(0,0,0);if(!this.plane.intersectsLine(t,n))throw new Error("Plane and line are parallel.");this.track(n,n.copy())}else{const t=new Et(0,0,0),n=new Et(0,0,0);if(!this.getLineTrackPoint(e,this.line,t))throw new Error("Lines are parallel.");try{this.getLineTrackPoint(e,new Xa(Et.Zero,this.line.direction),n)}catch{n.assign(t)}this.track(t,n)}}catch{this._trackPoint_changed.addEvent(),this._translation_changed.addEvent()}},track(e,t){const n=this._axisRotation.getValue(),i=n.copy().inverse().multVecRot(e.add(this.startOffset).subtract(this.startPoint));this._minPosition.x>this._maxPosition.x||(i.x=f.clamp(i.x,this._minPosition.x,this._maxPosition.x)),this._minPosition.y>this._maxPosition.y||(i.y=f.clamp(i.y,this._minPosition.y,this._maxPosition.y)),n.multVecRot(i),this._trackPoint_changed.getValue().equals(t)||(this._trackPoint_changed=t),this._translation_changed.getValue().equals(i)||(this._translation_changed=i)}}),Object.defineProperties(hm,{typeName:{value:"PlaneSensor",enumerable:!0},componentName:{value:"PointingDeviceSensor",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"axisRotation",new Qi.SFRotation),new H(c.inputOutput,"autoOffset",new Qi.SFBool(!0)),new H(c.inputOutput,"offset",new Qi.SFVec3f),new H(c.inputOutput,"minPosition",new Qi.SFVec2f),new H(c.inputOutput,"maxPosition",new Qi.SFVec2f(-1,-1)),new H(c.outputOnly,"trackPoint_changed",new Qi.SFVec3f),new H(c.outputOnly,"translation_changed",new Qi.SFVec3f),new H(c.outputOnly,"isOver",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const cm=hm;n.set("x_ite/Components/PointingDeviceSensor/PlaneSensor",cm);const dm=cm;function pm(e,t){this.radius=e,this.center=t.copy()}Object.assign(pm.prototype,{set(e,t){this.radius=e,this.center.assign(t)},intersectsLine(e,t,n){const{point:i,direction:s}=e,{center:r,radius:o}=this,a=2*(i.dot(s)-r.dot(s)),l=a*a-4*(i.x*i.x+i.y*i.y+i.z*i.z+(r.x*r.x+r.y*r.y+r.z*r.z)-2*i.dot(r)-o*o);if(l>=0){let e=(-a+Math.sqrt(l))/2,r=(-a-Math.sqrt(l))/2;if(e>r){const t=e;e=r,r=t}return t.assign(s).multiply(e).add(i),n.assign(s).multiply(r).add(i),!0}return!1},intersectsTriangle:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new Et(0,0,0),s=new Et(0,0,0),r=new Et(0,0,0),o=new Et(0,0,0);return function(a,l,u){const h=this.center,c=this.radius;a.subtract(h),l.subtract(h),u.subtract(h),e.assign(l).subtract(a),t.assign(u).subtract(a);const d=c*c,p=e.cross(t),g=a.dot(p);if(g*g>d*p.dot(p))return!1;const f=a.dot(a),m=a.dot(l),_=a.dot(u),x=l.dot(l),y=l.dot(u),w=u.dot(u);if(f>d&&m>f&&_>f||x>d&&m>x&&y>x||w>d&&_>w&&y>w)return!1;e.assign(l).subtract(a),n.assign(u).subtract(l),i.assign(a).subtract(u);const b=m-f,S=y-x,v=_-w,T=e.dot(e),O=n.dot(n),E=i.dot(i);s.assign(a).multiply(T).subtract(e.multiply(b)),r.assign(l).multiply(O).subtract(n.multiply(S)),o.assign(u).multiply(E).subtract(i.multiply(v));const C=u.multiply(T).subtract(s),N=a.multiply(O).subtract(r),F=l.multiply(E).subtract(o),I=s.dot(s)>d*T*T&&s.dot(C)>0,M=r.dot(r)>d*O*O&&r.dot(N)>0,P=o.dot(o)>d*E*E&&o.dot(F)>0;return!(I||M||P)}}(),toString(){return`${this.radius} ${this.center}`}});const gm=pm;n.set("standard/Math/Geometry/Sphere3",gm);const fm=gm;function mm(e){Zf.call(this,e),this.addType(c.SphereSensor)}Object.assign(Object.setPrototypeOf(mm.prototype,Zf.prototype),{initialize(){Zf.prototype.initialize.call(this),this.modelViewMatrix=new _n,this.invModelViewMatrix=new _n,this.sphere=null,this.zPlane=null,this.behind=!1,this.fromVector=new Et(0,0,0),this.startPoint=new Et(0,0,0),this.startOffset=new dn},getTrackPoint(e,t,n){const i=new Et(0,0,0);return!!this.sphere.intersectsLine(e,t,i)&&((e.point.distance(i)<e.point.distance(t))-n&&t.assign(i),!0)},set_active__(e,t,n,i,s){if(Zf.prototype.set_active__.call(this,e,t,n,i,s),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();const e=this.invModelViewMatrix.multVecMatrix(t.point.copy()),i=new Et(0,0,0);this.zPlane=new la(i,this.invModelViewMatrix.multDirMatrix(new Et(0,0,1)).normalize()),this.sphere=new fm(e.magnitude(),i),this.behind=this.zPlane.getDistanceToPoint(e)<0,this.fromVector.assign(e),this.startPoint.assign(e),this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=e,this._rotation_changed=this._offset.getValue()}else this._autoOffset.getValue()&&(this._offset=this._rotation_changed)},set_motion__(e){const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new Et(0,0,0);if(this.getTrackPoint(t,n,this.behind)){const e=this.invModelViewMatrix.multDirMatrix(new Et(0,0,1)).normalize();this.zPlane=new la(n,e)}else{const e=new Et(0,0,0);this.zPlane.intersectsLine(t,e),t.set(e,this.sphere.center.copy().subtract(e).normalize()),this.getTrackPoint(t,n,!1);const i=da.normal(this.sphere.center,n,this.startPoint,new Et(0,0,0)),s=n.copy().subtract(this.sphere.center).normalize(),r=i.copy().cross(s).normalize(),o=n.copy().subtract(r.multiply(e.copy().subtract(n).magnitude()));t.set(o,this.sphere.center.copy().subtract(o).normalize()),this.getTrackPoint(t,n,!1)}this._trackPoint_changed=n;const i=n.copy().subtract(this.sphere.center),s=new dn(this.fromVector,i);this.behind&&s.inverse(),this._rotation_changed=this.startOffset.copy().multRight(s)}}),Object.defineProperties(mm,{typeName:{value:"SphereSensor",enumerable:!0},componentName:{value:"PointingDeviceSensor",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"autoOffset",new Qi.SFBool(!0)),new H(c.inputOutput,"offset",new Qi.SFRotation),new H(c.outputOnly,"trackPoint_changed",new Qi.SFVec3f),new H(c.outputOnly,"rotation_changed",new Qi.SFRotation),new H(c.outputOnly,"isOver",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const _m=mm;n.set("x_ite/Components/PointingDeviceSensor/SphereSensor",_m);const xm={name:"PointingDeviceSensor",concreteNodes:[sm,dm,_m,Af],abstractNodes:[Zf,Ff,Pf]};n.set("x_ite/Components/PointingDeviceSensor",xm);const ym=xm,wm=sl(bm);function bm(){this.plane=new la(Et.Zero,Et.Zero)}function Sm(e){Ys.call(this,e),this.addType(c.ClipPlane),this.enabled=!1,this.plane=new Yt(0,0,0,0)}Object.assign(bm.prototype,{isClipped(e){return this.plane.getDistanceToPoint(e)<0},set(e,t){const n=this.plane,i=e.plane;n.normal.assign(i),n.distanceFromOrigin=-i.w,n.multRight(t)},setShaderUniforms(e,t){const n=this.plane,i=n.normal;e.uniform4f(t.x3d_ClipPlane[t.numClipPlanes++],i.x,i.y,i.z,n.distanceFromOrigin)},dispose(){wm.push(this)}}),Object.assign(Object.setPrototypeOf(Sm.prototype,Ys.prototype),{initialize(){Ys.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._plane.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__(){this.plane.assign(this._plane.getValue()),this.enabled=this._enabled.getValue()&&!this.plane.equals(Yt.Zero)},push(e){if(this.enabled){const t=wm.pop();t.set(this,e.getModelViewMatrix().get()),e.getLocalObjects().push(t),++e.getLocalObjectsCount()[0]}},pop(e){this.enabled&&(this.getBrowser().getLocalObjects().push(e.getLocalObjects().pop()),--e.getLocalObjectsCount()[0])}}),Object.defineProperties(Sm,{typeName:{value:"ClipPlane",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"plane",new Qi.SFVec4f(0,1,0,0))]),enumerable:!0}});const vm=Sm;n.set("x_ite/Components/Rendering/ClipPlane",vm);const Tm=vm;function Om(e){Qh.call(this,e),this.addType(c.X3DColorNode),this.addChildObjects("transparent",new Qi.SFBool),this._transparent.setAccessType(c.outputOnly)}Object.assign(Object.setPrototypeOf(Om.prototype,Qh.prototype),{setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()}}),Object.defineProperties(Om,{typeName:{value:"X3DColorNode",enumerable:!0},componentName:{value:"Rendering",enumerable:!0}});const Em=Om;n.set("x_ite/Components/Rendering/X3DColorNode",Em);const Cm=Em;function Nm(e){Cm.call(this,e),this.addType(c.Color)}Object.assign(Object.setPrototypeOf(Nm.prototype,Cm.prototype),{initialize(){Cm.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__(){this.color=this._color.getValue(),this.length=this._color.length},addColor(e,t){if(e>=0&&e<this.length){const n=this.color;e*=3,t.push(n[e],n[e+1],n[e+2],1)}else if(this.length){const n=this.color;e=3*(this.length-1),t.push(n[e],n[e+1],n[e+2],1)}else t.push(1,1,1,1)},addColors(e,t){if(this.length){const s=this.color;for(var n=0,i=3*Math.min(t,this.length);n<i;n+=3)e.push(s[n],s[n+1],s[n+2],1);if(this.length<t){const r=s[n=3*(this.length-1)],o=s[n+1],a=s[n+2];for(n=i,i=3*t;n<i;n+=3)e.push(r,o,a,1)}}else for(let n=0;n<t;++n)e.push(1,1,1,1);return e}}),Object.defineProperties(Nm,{typeName:{value:"Color",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"color",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.MFColor)]),enumerable:!0}});const Fm=Nm;n.set("x_ite/Components/Rendering/Color",Fm);const Im=Fm;function Mm(e){Cm.call(this,e),this.addType(c.ColorRGBA),this.setTransparent(!0)}Object.assign(Object.setPrototypeOf(Mm.prototype,Cm.prototype),{initialize(){Cm.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__(){this.color=this._color.getValue(),this.length=this._color.length},addColor(e,t){if(e>=0&&e<this.length){const n=this.color;e*=4,t.push(n[e],n[e+1],n[e+2],n[e+3])}else if(this.length){const n=this.color;e=4*(this.length-1),t.push(n[e],n[e+1],n[e+2],n[e+3])}else t.push(1,1,1,1)},addColors(e,t){if(this.length){const s=this.color;for(var n=0,i=4*Math.min(t,this.length);n<i;n+=4)e.push(s[n],s[n+1],s[n+2],s[n+3]);if(this.length<t){const r=s[n=4*(this.length-1)],o=s[n+1],a=s[n+2],l=s[n+2];for(n=i,i=4*t;n<i;n+=4)e.push(r,o,a,l)}}else for(let n=0;n<t;++n)e.push(1,1,1,1);return e}}),Object.defineProperties(Mm,{typeName:{value:"ColorRGBA",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"color",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.MFColorRGBA)]),enumerable:!0}});const Pm=Mm;n.set("x_ite/Components/Rendering/ColorRGBA",Pm);const Dm=Pm;function Rm(e){Qh.call(this,e),this.addType(c.X3DCoordinateNode)}Object.assign(Object.setPrototypeOf(Rm.prototype,Qh.prototype),{initialize(){Qh.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty(){return 0===this.length},getSize(){return this.length},set1Point(e,t){this._point[e]=t},get1Point(e,t){if(e<this.length){const n=this.point;return e*=3,t.set(n[e],n[e+1],n[e+2])}return t.set(0,0,0)},addPoint(e,t){if(e<this.length){const n=this.point;e*=3,t.push(n[e],n[e+1],n[e+2],1)}else t.push(0,0,0,1)},addPoints(e,t){const n=this.point;for(var i=0,s=3*this.length;i<s;i+=3)e.push(n[i],n[i+1],n[i+2],1);for(i=s,s=3*t;i<s;i+=3)e.push(0,0,0,1)},getNormal:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0);return function(i,s,r){const o=this.length;return i<o&&s<o&&r<o?da.normal(this.get1Point(i,e),this.get1Point(s,t),this.get1Point(r,n),new Et(0,0,0)):new Et(0,0,0)}}(),getQuadNormal:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new Et(0,0,0);return function(s,r,o,a){const l=this.length;return s<l&&r<l&&o<l&&a<l?da.quadNormal(this.get1Point(s,e),this.get1Point(r,t),this.get1Point(o,n),this.get1Point(a,i),new Et(0,0,0)):new Et(0,0,0)}}()}),Object.defineProperties(Rm,{typeName:{value:"X3DCoordinateNode",enumerable:!0},componentName:{value:"Rendering",enumerable:!0}});const Am=Rm;n.set("x_ite/Components/Rendering/X3DCoordinateNode",Am);const Vm=Am;function Lm(e){Vm.call(this,e),this.addType(c.Coordinate),this._point.setUnit("length")}Object.setPrototypeOf(Lm.prototype,Vm.prototype),Object.defineProperties(Lm,{typeName:{value:"Coordinate",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"coord",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"point",new Qi.MFVec3f)]),enumerable:!0}});const Bm=Lm;n.set("x_ite/Components/Rendering/Coordinate",Bm);const Um=Bm;function Xm(e){this.getExecutionContext()||Sl.call(this,e);const t=this.getBrowser().getContext();this.lineStipples=new Float32Array,this.lineStippleBuffer=t.createBuffer(),this.trianglesBuffer=t.createBuffer(),this.thickVertexArrayObject=new fl(t),this.setGeometryType(1),this.setPrimitiveMode(t.LINES),this.setSolid(!1)}Object.assign(Object.setPrototypeOf(Xm.prototype,Sl.prototype),{intersectsLine:()=>!1,intersectsBox:()=>!1,updateVertexArrays(){Sl.prototype.updateVertexArrays.call(this),this.thickVertexArrayObject.update()},buildTexCoords(){if(this.lineStipples.length/6==this.getVertices().length/8)return;const e=this.getBrowser().getContext(),t=this.getVertices().length/8;this.lineStipples=new Float32Array(6*t),e.bindBuffer(e.ARRAY_BUFFER,this.lineStippleBuffer),e.bufferData(e.ARRAY_BUFFER,this.lineStipples,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.trianglesBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(90*t),e.DYNAMIC_DRAW)},updateLengthSoFar:function(){const e=new _n,t=new Yt(0,0,0,0),n=new Yt(0,0,0,0),i=new wt(0,0),s=new wt(0,0);return function(r,o){const a=o.renderObject.getViewVolume().getViewport(),l=o.renderObject.getProjectionMatrix().get(),u=this.lineStipples,h=this.getVertices().getValue(),c=h.length;e.assign(o.modelViewMatrix).multRight(l);let d=0;for(let r=0,o=0;r<c;r+=8,o+=6)t.set(h[r],h[r+1],h[r+2],h[r+3]),n.set(h[r+4],h[r+5],h[r+6],h[r+7]),Sa.projectPointMatrix(t,e,a,i),Sa.projectPointMatrix(n,e,a,s),u[o]=s.x,u[o+1]=s.y,u[o+3]=i.x,u[o+4]=i.y,u[o+5]=d,d+=s.subtract(i).magnitude();r.bindBuffer(r.ARRAY_BUFFER,this.lineStippleBuffer),r.bufferData(r.ARRAY_BUFFER,u,r.DYNAMIC_DRAW)}}(),displaySimple(e,t,n){const i=t.shapeNode.getAppearance().getStyleProperties(1);if(i&&i.getTransformLines()){if(this.thickVertexArrayObject.enable(n)){const t=15*Float32Array.BYTES_PER_ELEMENT,i=0,s=8*Float32Array.BYTES_PER_ELEMENT,r=11*Float32Array.BYTES_PER_ELEMENT;n.enableLineStippleAttribute(e,this.trianglesBuffer,t,i),this.hasNormals&&n.enableNormalAttribute(e,this.trianglesBuffer,t,s),n.enableVertexAttribute(e,this.trianglesBuffer,t,r),e.bindBuffer(e.ARRAY_BUFFER,null)}return e.frontFace(e.CCW),e.enable(e.CULL_FACE),void e.drawArrays(e.TRIANGLES,0,3*this.vertexCount)}this.vertexArrayObject.enable(n)&&(n.enableLineStippleAttribute(e,this.lineStippleBuffer,0,0),this.hasNormals&&n.enableNormalAttribute(e,this.normalBuffer,0,0),n.enableVertexAttribute(e,this.vertexBuffer,0,0)),e.drawArrays(this.primitiveMode,0,this.vertexCount),e.lineWidth(1)},display:function(){const e=new _n,t=new Float32Array(16),n=new Float32Array(16);return function(i,s){const r=this.getBrowser(),o=s.appearanceNode,a=o.getLineProperties(),l=o.getShader(this,s),u=o.getBlendMode(),h=this.getAttrib(),c=this.getAttribBuffers();if(a&&(a.getApplied()&&1!==a.getLinetype()&&this.updateLengthSoFar(i,s),a.getTransformLines())){const o=s.renderObject,h=o.getViewVolume().getViewport(),c=o.getProjectionMatrix().get(),d=r.getWireframe()?i.TRIANGLES:r.getPrimitiveMode(i.TRIANGLES),p=r.getLineTransformShader();if(t.set(e.assign(s.modelViewMatrix).multRight(c)),n.set(e.inverse()),p.enable(i),i.uniform4f(p.viewport,h.x,h.y,h.z,h.w),i.uniformMatrix4fv(p.modelViewProjectionMatrix,!1,t),i.uniformMatrix4fv(p.invModelViewProjectionMatrix,!1,n),i.uniform1f(p.scale,a.getLinewidthScaleFactor()/2),this.thickVertexArrayObject.enable(p)){const e=6*Float32Array.BYTES_PER_ELEMENT,t=0,n=3*Float32Array.BYTES_PER_ELEMENT,s=2*Float32Array.BYTES_PER_ELEMENT,r=0,o=1*Float32Array.BYTES_PER_ELEMENT,a=8*Float32Array.BYTES_PER_ELEMENT,l=0,u=4*Float32Array.BYTES_PER_ELEMENT,h=6*Float32Array.BYTES_PER_ELEMENT,c=0,d=3*Float32Array.BYTES_PER_ELEMENT,g=8*Float32Array.BYTES_PER_ELEMENT,f=0,m=4*Float32Array.BYTES_PER_ELEMENT;p.enableFloatAttrib(i,"x3d_LineStipple0",this.lineStippleBuffer,3,e,t),p.enableFloatAttrib(i,"x3d_LineStipple1",this.lineStippleBuffer,3,e,n),this.hasFogCoords&&(p.enableFloatAttrib(i,"x3d_FogDepth0",this.fogDepthBuffer,1,s,r),p.enableFloatAttrib(i,"x3d_FogDepth1",this.fogDepthBuffer,1,s,o)),this.colorMaterial&&(p.enableFloatAttrib(i,"x3d_Color0",this.colorBuffer,4,a,l),p.enableFloatAttrib(i,"x3d_Color1",this.colorBuffer,4,a,u)),this.hasNormals&&(p.enableFloatAttrib(i,"x3d_Normal0",this.normalBuffer,3,h,c),p.enableFloatAttrib(i,"x3d_Normal1",this.normalBuffer,3,h,d)),p.enableFloatAttrib(i,"x3d_Vertex0",this.vertexBuffer,4,g,f),p.enableFloatAttrib(i,"x3d_Vertex1",this.vertexBuffer,4,g,m)}if(i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r.getLineTransformFeedback()),i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,0,this.trianglesBuffer),i.enable(i.RASTERIZER_DISCARD),i.beginTransformFeedback(i.POINTS),i.drawArraysInstanced(i.POINTS,0,this.vertexCount/2,2),i.endTransformFeedback(),i.disable(i.RASTERIZER_DISCARD),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),u?.enable(i),l.enable(i),l.setUniforms(i,this,s),this.thickVertexArrayObject.enable(l)){const e=15*Float32Array.BYTES_PER_ELEMENT,t=0,n=3*Float32Array.BYTES_PER_ELEMENT,s=4*Float32Array.BYTES_PER_ELEMENT,r=8*Float32Array.BYTES_PER_ELEMENT,o=11*Float32Array.BYTES_PER_ELEMENT;l.enableLineStippleAttribute(i,this.trianglesBuffer,e,t),this.hasFogCoords&&l.enableFogDepthAttribute(i,this.trianglesBuffer,e,n),this.colorMaterial&&l.enableColorAttribute(i,this.trianglesBuffer,e,s),this.hasNormals&&l.enableNormalAttribute(i,this.trianglesBuffer,e,r),l.enableVertexAttribute(i,this.trianglesBuffer,e,o),i.bindBuffer(i.ARRAY_BUFFER,null)}return i.frontFace(i.CCW),i.enable(i.CULL_FACE),i.drawArrays(d,0,3*this.vertexCount),void u?.disable(i)}const d=r.getPrimitiveMode(this.getPrimitiveMode());if(u?.enable(i),l.enable(i),l.setUniforms(i,this,s),this.vertexArrayObject.enable(l)){for(let e=0,t=h.length;e<t;++e)h[e].enable(i,l,c[e]);l.enableLineStippleAttribute(i,this.lineStippleBuffer,0,0),this.hasFogCoords&&l.enableFogDepthAttribute(i,this.fogDepthBuffer,0,0),this.colorMaterial&&l.enableColorAttribute(i,this.colorBuffer,0,0),this.hasNormals&&l.enableNormalAttribute(i,this.normalBuffer,0,0),l.enableVertexAttribute(i,this.vertexBuffer,0,0)}i.drawArrays(d,0,this.vertexCount),u?.disable(i),i.lineWidth(1)}}(),displayParticles(e,t,n){const i=this.getBrowser(),s=t.appearanceNode,r=s.getShader(this,t),o=s.getBlendMode(),a=this.getAttrib(),l=this.getAttribBuffers(),u=i.getPrimitiveMode(this.getPrimitiveMode());o?.enable(e),r.enable(e),r.setUniforms(e,this,t);const h=n.outputParticles;if(h.vertexArrayObject.update(this.updateParticles).enable(r)){const t=n.particleStride;r.enableParticleAttribute(e,h,t,n.particleOffset,1),r.enableParticleMatrixAttribute(e,h,t,n.matrixOffset,1);for(let t=0,n=a.length;t<n;++t)a[t].enable(e,r,l[t]);this.hasFogCoords&&r.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&r.enableColorAttribute(e,this.colorBuffer,0,0),this.hasNormals&&r.enableNormalAttribute(e,this.normalBuffer,0,0),r.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}e.drawArraysInstanced(u,0,this.vertexCount,n.numParticles),o?.disable(e),e.lineWidth(1)}}),Object.defineProperties(Xm,{typeName:{value:"X3DLineGeometryNode",enumerable:!0},componentName:{value:"Rendering",enumerable:!0}});const jm=Xm;n.set("x_ite/Components/Rendering/X3DLineGeometryNode",jm);const km=jm;function zm(e){km.call(this,e),this.addType(c.IndexedLineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(zm.prototype,km.prototype),{initialize(){km.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_coordIndex.addFieldInterest(this._coordIndex),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=zl(c.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=zl(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=zl(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=zl(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=zl(c.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},getColorPerVertexIndex(e){return e<this._colorIndex.length?this._colorIndex[e]:this._coordIndex[e]},getColorIndex(e){return e<this._colorIndex.length?this._colorIndex[e]:e},getPolylineIndices(){const e=this._coordIndex,t=[];let n=[];if(e.length){for(let i=0,s=e.length;i<s;++i){e[i]>=0?n.push(i):(t.push(n),n=[])}e[e.length-1]>=0&&t.push(n)}return t},build(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this._coordIndex,t=this.getPolylineIndices(),n=this._colorPerVertex.getValue(),i=this.getAttrib(),s=i.length,r=this.getAttribs(),o=this.fogCoordNode,a=this.colorNode,l=this.coordNode,u=this.normalNode,h=this.getFogDepths(),c=this.getColors(),d=this.getNormals(),p=this.getVertices();let g=0;for(const f of t){if(f.length>1)for(let t=0,m=f.length-1;t<m;++t)for(let m=t,_=t+2;m<_;++m){const t=f[m],_=e[t];for(let e=0;e<s;++e)i[e].addValue(_,r[e]);o?.addDepth(_,h),a&&(n?a.addColor(this.getColorPerVertexIndex(t),c):a.addColor(this.getColorIndex(g),c)),u?.addVector(_,d),l.addPoint(_,p)}++g}}}),Object.defineProperties(zm,{typeName:{value:"IndexedLineSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_colorIndex",new Qi.MFInt32),new H(c.inputOnly,"set_coordIndex",new Qi.MFInt32),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"colorIndex",new Qi.MFInt32),new H(c.initializeOnly,"coordIndex",new Qi.MFInt32),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const Gm=zm;n.set("x_ite/Components/Rendering/IndexedLineSet",Gm);const Hm=Gm;function qm(e){op.call(this,e),this.addType(c.IndexedTriangleFanSet),this.triangleIndex=[]}Object.assign(Object.setPrototypeOf(qm.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__(){const e=this._index,t=this.triangleIndex;t.length=0;for(let n=0,i=e.length;n<i;++n){const s=e[n];if(!(s<0)&&++n<i){let r=e[n];if(r<0)continue;for(++n;n<i;++n){const i=e[n];if(i<0)break;t.push(s,r,i),r=i}}}},getPolygonIndex(e){return this.triangleIndex[e]},build(){op.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}}),Object.defineProperties(qm,{typeName:{value:"IndexedTriangleFanSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_index",new Qi.MFInt32),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"normalPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"index",new Qi.MFInt32),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const Ym=qm;n.set("x_ite/Components/Rendering/IndexedTriangleFanSet",Ym);const Wm=Ym;function $m(e){op.call(this,e),this.addType(c.IndexedTriangleSet)}Object.assign(Object.setPrototypeOf($m.prototype,op.prototype),{getPolygonIndex(e){return this._index[e]},initialize(){op.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index)},build(){op.prototype.build.call(this,3,this._index.length,3,this._index.length)}}),Object.defineProperties($m,{typeName:{value:"IndexedTriangleSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_index",new Qi.MFInt32),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"normalPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"index",new Qi.MFInt32),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const Km=$m;n.set("x_ite/Components/Rendering/IndexedTriangleSet",Km);const Jm=Km;function Zm(e){op.call(this,e),this.addType(c.IndexedTriangleStripSet),this.triangleIndex=[]}Object.assign(Object.setPrototypeOf(Zm.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__(){const e=this._index,t=this.triangleIndex;t.length=0;for(let n=0,i=e.length;n<i;++n){let s=e[n];if(!(s<0)&&++n<i){let r=e[n];if(r<0)continue;++n;for(let o=0;n<i;++n,++o){const i=e[n];if(i<0)break;t.push(s,r,i),1&o?r=i:s=i}}}},getPolygonIndex(e){return this.triangleIndex[e]},build(){op.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}}),Object.defineProperties(Zm,{typeName:{value:"IndexedTriangleStripSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"set_index",new Qi.MFInt32),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"normalPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"index",new Qi.MFInt32),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const Qm=Zm;n.set("x_ite/Components/Rendering/IndexedTriangleStripSet",Qm);const e_=Qm;function t_(e){km.call(this,e),this.addType(c.LineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(t_.prototype,km.prototype),{initialize(){km.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=zl(c.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=zl(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=zl(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=zl(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=zl(c.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},build(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this._vertexCount,t=this.getAttrib(),n=t.length,i=this.getAttribs(),s=this.fogCoordNode,r=this.colorNode,o=this.normalNode,a=this.coordNode,l=this.getFogDepths(),u=this.getColors(),h=this.getNormals(),c=this.getVertices(),d=a.getSize();let p=0;for(let g of e){if(p+g>d)break;if(g>1){g=2*g-2;for(let e=0;e<g;++e,p+=1&e){for(let e=0;e<n;++e)t[e].addValue(p,i[e]);s?.addDepth(p,l),r?.addColor(p,u),o?.addVector(p,h),a.addPoint(p,c)}++p}else p+=g}}}),Object.defineProperties(t_,{typeName:{value:"LineSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"vertexCount",new Qi.MFInt32),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const n_=t_;n.set("x_ite/Components/Rendering/LineSet",n_);const i_=n_;function s_(e){Qh.call(this,e),this.addType(c.X3DNormalNode)}Object.setPrototypeOf(s_.prototype,Qh.prototype),Object.defineProperties(s_,{typeName:{value:"X3DNormalNode",enumerable:!0},componentName:{value:"Rendering",enumerable:!0}});const r_=s_;n.set("x_ite/Components/Rendering/X3DNormalNode",r_);const o_=r_;function a_(e){o_.call(this,e),this.addType(c.Normal)}Object.assign(Object.setPrototypeOf(a_.prototype,o_.prototype),{initialize(){o_.prototype.initialize.call(this),this._vector.addInterest("set_vector__",this),this.set_vector__()},set_vector__(){this.vector=this._vector.getValue(),this.length=this._vector.length},set1Vector(e,t){this._vector[e]=t},get1Vector(e,t){if(e>=0&&e<this.length){const n=this.vector;return e*=3,t.set(n[e],n[e+1],n[e+2])}if(e>=0&&this.length){const n=this.vector;return e%=this.length,e*=3,t.set(n[e],n[e+1],n[e+2])}return t.set(0,0,0)},addVector(e,t){if(e>=0&&e<this.length){const n=this.vector;e*=3,t.push(n[e],n[e+1],n[e+2])}else{if(!(e>=0&&this.length))return t.push(0,0,0);{const n=this.vector;e%=this.length,e*=3,t.push(n[e],n[e+1],n[e+2])}}},addNormals(e,t){if(this.length){const s=this.vector;for(var n=0,i=3*Math.min(t,this.length);n<i;n+=3)e.push(s[n],s[n+1],s[n+2]);if(this.length<t){const r=s[n=3*(this.length-1)],o=s[n+1],a=s[n+2];for(n=i,i=3*t;n<i;n+=3)e.push(r,o,a)}}else for(let n=0;n<t;++n)e.push(0,0,0);return e}}),Object.defineProperties(a_,{typeName:{value:"Normal",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"normal",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"vector",new Qi.MFVec3f)]),enumerable:!0}});const l_=a_;n.set("x_ite/Components/Rendering/Normal",l_);const u_=l_;function h_(e){Sl.call(this,e);const t=this.getBrowser();this.setGeometryType(0),this.setPrimitiveMode(t.getContext().POINTS),this.setSolid(!1),this.setTransparent(!0)}Object.assign(Object.setPrototypeOf(h_.prototype,Sl.prototype),{intersectsLine:()=>!1,intersectsBox:()=>!1,buildTexCoords(){},display(e,t){const n=t.appearanceNode,i=n.getShader(this,t),s=n.getBlendMode(),r=this.getAttrib(),o=this.getAttribBuffers();if(s?.enable(e),i.enable(e),i.setUniforms(e,this,t),this.vertexArrayObject.enable(i)){for(let t=0,n=r.length;t<n;++t)r[t].enable(e,i,o[t]);this.hasFogCoords&&i.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(e,this.colorBuffer,0,0),this.hasNormals&&i.enableNormalAttribute(e,this.normalBuffer,0,0),i.enableVertexAttribute(e,this.vertexBuffer,0,0)}e.drawArrays(this.primitiveMode,0,this.vertexCount),s?.disable(e)},displayParticles(e,t,n){const i=t.appearanceNode,s=i.getShader(this,t),r=i.getBlendMode(),o=this.getAttrib(),a=this.getAttribBuffers();r?.enable(e),s.enable(e),s.setUniforms(e,this,t);const l=n.outputParticles;if(l.vertexArrayObject.update(this.updateParticles).enable(s)){const t=n.particleStride;s.enableParticleAttribute(e,l,t,n.particleOffset,1),s.enableParticleMatrixAttribute(e,l,t,n.matrixOffset,1);for(let t=0,n=o.length;t<n;++t)o[t].enable(e,s,a[t]);this.hasFogCoords&&s.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&s.enableColorAttribute(e,this.colorBuffer,0,0),this.hasNormals&&s.enableNormalAttribute(e,this.normalBuffer,0,0),s.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}e.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,n.numParticles),r?.disable(e)}}),Object.defineProperties(h_,{typeName:{value:"X3DPointGeometryNode",enumerable:!0},componentName:{value:"Rendering",enumerable:!0}});const c_=h_;n.set("x_ite/Components/Rendering/X3DPointGeometryNode",c_);const d_=c_;function p_(e){d_.call(this,e),this.addType(c.PointSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(p_.prototype,d_.prototype),{initialize(){d_.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},getCoord(){return this.coordNode},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=zl(c.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=zl(c.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=zl(c.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=zl(c.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=zl(c.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},build(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this.getAttrib(),t=e.length,n=this.getAttribs(),i=this.fogCoordNode,s=this.getFogDepths(),r=this.colorNode,o=this.getColors(),a=this.coordNode,l=this.getNormals(),u=this.normalNode,h=this.getVertices(),c=a._point.length;for(let i=0;i<t;++i)for(let t=0;t<c;++t)e[i].addValue(t,n[i]);i?.addDepths(s,c),r?.addColors(o,c),u?.addNormals(l,c),a.addPoints(h,c)}}),Object.defineProperties(p_,{typeName:{value:"PointSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const g_=p_;n.set("x_ite/Components/Rendering/PointSet",g_);const f_=g_;function m_(e){op.call(this,e),this.addType(c.TriangleFanSet),this.triangleIndex=[]}Object.assign(Object.setPrototypeOf(m_.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._fanCount.addInterest("set_fanCount__",this),this.set_fanCount__()},set_fanCount__(){const e=this._fanCount,t=this.triangleIndex;t.length=0;let n=0;for(const i of e){for(let e=1,s=i-1;e<s;++e)t.push(n,n+e,n+e+1);n+=i}},getPolygonIndex(e){return this.triangleIndex[e]},build(){op.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}}),Object.defineProperties(m_,{typeName:{value:"TriangleFanSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"normalPerVertex",new Qi.SFBool(!0)),new H(c.inputOutput,"fanCount",new Qi.MFInt32),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const __=m_;n.set("x_ite/Components/Rendering/TriangleFanSet",__);const x_=__;function y_(e){op.call(this,e),this.addType(c.TriangleSet)}Object.assign(Object.setPrototypeOf(y_.prototype,op.prototype),{build(){this.getCoord()&&op.prototype.build.call(this,3,this.getCoord().getSize(),3,this.getCoord().getSize())},createNormals(e,t){return this.createFaceNormals(e,t)}}),Object.defineProperties(y_,{typeName:{value:"TriangleSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"normalPerVertex",new Qi.SFBool(!0)),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const w_=y_;n.set("x_ite/Components/Rendering/TriangleSet",w_);const b_=w_;function S_(e){op.call(this,e),this.addType(c.TriangleStripSet),this.triangleIndex=[]}Object.assign(Object.setPrototypeOf(S_.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._stripCount.addInterest("set_stripCount__",this),this.set_stripCount__()},set_stripCount__(){const e=this._stripCount,t=this.triangleIndex;t.length=0;let n=0;for(const i of e){for(let e=0,s=i-2;e<s;++e){const i=1&e;t.push(n+(i?e+1:e),n+(i?e:e+1),n+(e+2))}n+=i}},getPolygonIndex(e){return this.triangleIndex[e]},build(){op.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}}),Object.defineProperties(S_,{typeName:{value:"TriangleStripSet",enumerable:!0},componentName:{value:"Rendering",enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"solid",new Qi.SFBool(!0)),new H(c.initializeOnly,"ccw",new Qi.SFBool(!0)),new H(c.initializeOnly,"colorPerVertex",new Qi.SFBool(!0)),new H(c.initializeOnly,"normalPerVertex",new Qi.SFBool(!0)),new H(c.inputOutput,"stripCount",new Qi.MFInt32),new H(c.inputOutput,"attrib",new Qi.MFNode),new H(c.inputOutput,"fogCoord",new Qi.SFNode),new H(c.inputOutput,"color",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.SFNode),new H(c.inputOutput,"normal",new Qi.SFNode),new H(c.inputOutput,"coord",new Qi.SFNode)]),enumerable:!0}});const v_=S_;n.set("x_ite/Components/Rendering/TriangleStripSet",v_);const T_={name:"Rendering",concreteNodes:[Tm,Im,Dm,Um,Hm,Wm,Jm,e_,i_,u_,f_,x_,b_,v_],abstractNodes:[Cm,op,Vm,Qh,Sl,km,o_]};n.set("x_ite/Components/Rendering",T_);const O_=T_;function E_(e){Bl.call(this,e),this.addType(c.X3DShaderNode),this.valid=!1,this.selected=0}Object.assign(Object.setPrototypeOf(E_.prototype,Bl.prototype),{setValid(e){this._isValid=this.valid=e},isValid(){return this.valid},select(){++this.selected,this._isSelected.getValue()||(this._isSelected=!0)},deselect(){--this.selected,0===this.selected&&this._isSelected.getValue()&&(this._isSelected=!1)}}),Object.defineProperties(E_,{typeName:{value:"X3DShaderNode",enumerable:!0},componentName:{value:"Shaders",enumerable:!0}});const C_=E_;n.set("x_ite/Components/Shaders/X3DShaderNode",C_);const N_=C_;var F_=i(666);const I_=Symbol.for("X_ITE.X3DField.uniformLocation");function M_(e){this.addType(c.X3DProgrammableShaderObject),this.uniformNames=[],this.x3d_ClipPlane=[],this.x3d_LightType=[],this.x3d_LightOn=[],this.x3d_LightColor=[],this.x3d_LightIntensity=[],this.x3d_LightAmbientIntensity=[],this.x3d_LightAttenuation=[],this.x3d_LightLocation=[],this.x3d_LightDirection=[],this.x3d_LightBeamWidth=[],this.x3d_LightCutOffAngle=[],this.x3d_LightRadius=[],this.x3d_LightMatrix=[],this.x3d_ShadowIntensity=[],this.x3d_ShadowColor=[],this.x3d_ShadowBias=[],this.x3d_ShadowMatrix=[],this.x3d_ShadowMapSize=[],this.x3d_ShadowMap=[],this.x3d_Texture=[],this.x3d_MultiTextureMode=[],this.x3d_MultiTextureAlphaMode=[],this.x3d_MultiTextureSource=[],this.x3d_MultiTextureFunction=[],this.x3d_TextureCoordinateGeneratorMode=[],this.x3d_TextureCoordinateGeneratorParameter=[],this.x3d_ProjectiveTexture=[],this.x3d_ProjectiveTextureMatrix=[],this.x3d_ProjectiveTextureLocation=[],this.x3d_TexCoord=[],this.x3d_TextureMatrix=[],this.numClipPlanes=0,this.fogNode=null,this.numLights=0,this.numGlobalLights=0,this.lightNodes=[],this.numProjectiveTextures=0,this.numGlobalProjectiveTextures=0,this.projectiveTextureNodes=[],this.textures=new Set}Object.assign(M_.prototype,{initialize(){this.getBrowser().getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},canUserDefinedFields:()=>!0,getUniformNames(){return this.uniformNames},setUniformNames(e){this.uniformNames=e},getDefaultUniformsAndAttributes(){const e=this.getProgram(),t=this.getBrowser(),n=t.getContext(),i=t.getMaxClipPlanes(),s=t.getMaxLights(),r=t.getMaxTextures(),o=t.getMaxTextureTransforms(),a=t.getMaxTexCoords();n.useProgram(e);for(const t of this.uniformNames)this[t]=n.getUniformLocation(e,t);this.x3d_Id=n.getUniformLocation(e,"x3d_Id"),this.x3d_LogarithmicFarFactor1_2=n.getUniformLocation(e,"x3d_LogarithmicFarFactor1_2");for(let t=0;t<i;++t)this.x3d_ClipPlane[t]=n.getUniformLocation(e,"x3d_ClipPlane["+t+"]");this.x3d_FogColor=this.getUniformLocation(n,e,"x3d_Fog.color","x3d_FogColor"),this.x3d_FogVisibilityRange=this.getUniformLocation(n,e,"x3d_Fog.visibilityRange","x3d_FogVisibilityRange"),this.x3d_FogMatrix=this.getUniformLocation(n,e,"x3d_Fog.matrix","x3d_FogMatrix"),this.x3d_AlphaCutoff=n.getUniformLocation(e,"x3d_AlphaCutoff"),this.x3d_PointPropertiesPointSizeScaleFactor=n.getUniformLocation(e,"x3d_PointProperties.pointSizeScaleFactor"),this.x3d_PointPropertiesPointSizeMinValue=n.getUniformLocation(e,"x3d_PointProperties.pointSizeMinValue"),this.x3d_PointPropertiesPointSizeMaxValue=n.getUniformLocation(e,"x3d_PointProperties.pointSizeMaxValue"),this.x3d_PointPropertiesAttenuation=n.getUniformLocation(e,"x3d_PointProperties.attenuation"),this.x3d_LinePropertiesLinetype=n.getUniformLocation(e,"x3d_LineProperties.linetype"),this.x3d_LineStippleScale=n.getUniformLocation(e,"x3d_LineProperties.lineStippleScale"),this.x3d_LinePropertiesTexture=n.getUniformLocation(e,"x3d_LineProperties.texture"),this.x3d_FillPropertiesFilled=n.getUniformLocation(e,"x3d_FillProperties.filled"),this.x3d_FillPropertiesHatched=n.getUniformLocation(e,"x3d_FillProperties.hatched"),this.x3d_FillPropertiesHatchColor=n.getUniformLocation(e,"x3d_FillProperties.hatchColor"),this.x3d_FillPropertiesTexture=n.getUniformLocation(e,"x3d_FillProperties.texture"),this.x3d_FillPropertiesScale=n.getUniformLocation(e,"x3d_FillProperties.scale");for(let t=0;t<s;++t)this.x3d_LightType[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].type","x3d_LightType["+t+"]"),this.x3d_LightColor[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].color","x3d_LightColor["+t+"]"),this.x3d_LightAmbientIntensity[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].ambientIntensity","x3d_LightAmbientIntensity["+t+"]"),this.x3d_LightIntensity[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].intensity","x3d_LightIntensity["+t+"]"),this.x3d_LightAttenuation[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].attenuation","x3d_LightAttenuation["+t+"]"),this.x3d_LightLocation[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].location","x3d_LightLocation["+t+"]"),this.x3d_LightDirection[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].direction","x3d_LightDirection["+t+"]"),this.x3d_LightBeamWidth[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].beamWidth","x3d_LightBeamWidth["+t+"]"),this.x3d_LightCutOffAngle[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].cutOffAngle","x3d_LightCutOffAngle["+t+"]"),this.x3d_LightRadius[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].radius","x3d_LightRadius["+t+"]"),this.x3d_LightMatrix[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].matrix","x3d_LightMatrix["+t+"]"),this.x3d_ShadowIntensity[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowIntensity"),this.x3d_ShadowColor[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowColor"),this.x3d_ShadowBias[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowBias"),this.x3d_ShadowMatrix[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowMatrix"),this.x3d_ShadowMapSize[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowMapSize"),this.x3d_ShadowMap[t]=n.getUniformLocation(e,"x3d_ShadowMap["+t+"]");this.x3d_AmbientIntensity=this.getUniformLocation(n,e,"x3d_Material.ambientIntensity","x3d_FrontMaterial.ambientIntensity"),this.x3d_DiffuseColor=this.getUniformLocation(n,e,"x3d_Material.diffuseColor","x3d_FrontMaterial.diffuseColor"),this.x3d_SpecularColor=this.getUniformLocation(n,e,"x3d_Material.specularColor","x3d_FrontMaterial.specularColor"),this.x3d_EmissiveColor=this.getUniformLocation(n,e,"x3d_Material.emissiveColor","x3d_FrontMaterial.emissiveColor"),this.x3d_Shininess=this.getUniformLocation(n,e,"x3d_Material.shininess","x3d_FrontMaterial.shininess"),this.x3d_BaseColor=n.getUniformLocation(e,"x3d_Material.baseColor"),this.x3d_Metallic=n.getUniformLocation(e,"x3d_Material.metallic"),this.x3d_Roughness=n.getUniformLocation(e,"x3d_Material.roughness"),this.x3d_OcclusionStrength=n.getUniformLocation(e,"x3d_Material.occlusionStrength"),this.x3d_NormalScale=n.getUniformLocation(e,"x3d_Material.normalScale"),this.x3d_Transparency=this.getUniformLocation(n,e,"x3d_Material.transparency","x3d_FrontMaterial.transparency");const l=["x3d_AmbientTexture","x3d_DiffuseTexture","x3d_SpecularTexture","x3d_EmissiveTexture","x3d_ShininessTexture","x3d_BaseTexture","x3d_MetallicRoughnessTexture","x3d_OcclusionTexture","x3d_NormalTexture"];for(const t of l)this[t]={textureTransformMapping:n.getUniformLocation(e,t+".textureTransformMapping"),textureCoordinateMapping:n.getUniformLocation(e,t+".textureCoordinateMapping"),texture2D:n.getUniformLocation(e,t+".texture2D"),texture3D:n.getUniformLocation(e,t+".texture3D"),textureCube:n.getUniformLocation(e,t+".textureCube")};this.x3d_MultiTextureColor=n.getUniformLocation(e,"x3d_MultiTextureColor"),this.x3d_TexCoord.length=0;for(let t=0;t<r;++t)this.x3d_TextureCoordinateGeneratorMode[t]=n.getUniformLocation(e,"x3d_TextureCoordinateGenerator["+t+"].mode"),this.x3d_TextureCoordinateGeneratorParameter[t]=n.getUniformLocation(e,"x3d_TextureCoordinateGenerator["+t+"].parameter"),this.x3d_Texture[t]={texture2D:n.getUniformLocation(e,"x3d_Texture2D["+t+"]"),texture3D:n.getUniformLocation(e,"x3d_Texture3D["+t+"]"),textureCube:this.getUniformLocation(n,e,"x3d_TextureCube["+t+"]","x3d_CubeMapTexture["+t+"]")},this.x3d_MultiTextureMode[t]=n.getUniformLocation(e,"x3d_MultiTexture["+t+"].mode"),this.x3d_MultiTextureAlphaMode[t]=n.getUniformLocation(e,"x3d_MultiTexture["+t+"].alphaMode"),this.x3d_MultiTextureSource[t]=n.getUniformLocation(e,"x3d_MultiTexture["+t+"].source"),this.x3d_MultiTextureFunction[t]=n.getUniformLocation(e,"x3d_MultiTexture["+t+"].function"),this.x3d_ProjectiveTexture[t]=n.getUniformLocation(e,"x3d_ProjectiveTexture["+t+"]"),this.x3d_ProjectiveTextureMatrix[t]=n.getUniformLocation(e,"x3d_ProjectiveTextureMatrix["+t+"]"),this.x3d_ProjectiveTextureLocation[t]=n.getUniformLocation(e,"x3d_ProjectiveTextureLocation["+t+"]");for(let t=0;t<o;++t){const i=n.getUniformLocation(e,"x3d_TextureMatrix["+t+"]");null!==i&&(this.x3d_TextureMatrix[t]=i)}for(let t=0;t<a;++t){const i=this.getAttribLocation(n,e,"x3d_TexCoord"+t,t?"":"x3d_TexCoord");-1!==i&&this.x3d_TexCoord.push([t,i])}this.x3d_TexCoordRamp=n.getUniformLocation(e,"x3d_TexCoordRamp"),this.x3d_Viewport=n.getUniformLocation(e,"x3d_Viewport"),this.x3d_ProjectionMatrix=n.getUniformLocation(e,"x3d_ProjectionMatrix"),this.x3d_ModelViewMatrix=n.getUniformLocation(e,"x3d_ModelViewMatrix"),this.x3d_NormalMatrix=n.getUniformLocation(e,"x3d_NormalMatrix"),this.x3d_CameraSpaceMatrix=n.getUniformLocation(e,"x3d_CameraSpaceMatrix");const u=["LineStipple","FogDepth","Color","Normal","Vertex","Particle","ParticleMatrix"];for(const t of u){const i=n.getAttribLocation(e,`x3d_${t}`);this[`x3d_${t}`]=i,i<0?(this[`enable${t}Attribute`]=Function.prototype,this[`${F_.toLowerCaseFirst(t)}AttributeDivisor`]=Function.prototype):(delete this[`enable${t}Attribute`],delete this[`${F_.toLowerCaseFirst(t)}AttributeDivisor`])}0===this.x3d_TexCoord.length?(this.enableTexCoordAttribute=Function.prototype,this.texCoordAttributeDivisor=Function.prototype):(delete this.enableTexCoordAttribute,delete this.texCoordAttributeDivisor),n.uniform1i(this.x3d_LinePropertiesTexture,t.getDefaultTexture2DUnit()),n.uniform1i(this.x3d_FillPropertiesTexture,t.getDefaultTexture2DUnit());for(const e of l)n.uniform1i(this[e].texture2D,t.getDefaultTexture2DUnit()),n.uniform1i(this[e].texture3D,t.getDefaultTexture3DUnit()),n.uniform1i(this[e].textureCube,t.getDefaultTextureCubeUnit());for(const e of this.x3d_Texture)n.uniform1i(e.texture2D,t.getDefaultTexture2DUnit()),n.getVersion()>=2&&n.uniform1i(e.texture3D,t.getDefaultTexture3DUnit()),n.uniform1i(e.textureCube,t.getDefaultTextureCubeUnit());for(const e of this.x3d_ShadowMap)n.uniform1i(e,t.getDefaultTexture2DUnit());for(const e of this.x3d_ProjectiveTexture)n.uniform1i(e,t.getDefaultTexture2DUnit());n.uniform1i(this.x3d_TexCoordRamp,t.getDefaultTexture2DUnit())},getUniformLocation(e,t,n,i){let s=e.getUniformLocation(t,n);return s||(i?(s=e.getUniformLocation(t,i),s&&console.warn(this.getTypeName(),this.getName(),"Using uniform location name '"+i+"' is depreciated, use '"+n+"'. See https://create3000.github.io/x_ite/custom-shaders."),s):0)},getAttribLocation(e,t,n,i){let s=e.getAttribLocation(t,n);return s>=0?s:i?(s=e.getAttribLocation(t,i),s>=0&&console.warn(this.getTypeName(),this.getName(),"Using attribute location name '"+i+"' is depreciated, use '"+n+"'. See https://create3000.github.io/x_ite/custom-shaders."),s):-1},addShaderFields(){const e=this.getProgram(),t=this.getBrowser().getContext();t.useProgram(e),this.textures.clear();for(const n of this.getUserDefinedFields()){const i=t.getUniformLocation(e,n.getName());if(i){switch(n.getType()){case c.SFImage:i.array=new Int32Array(3+n.array.length);break;case c.SFMatrix3d:case c.SFMatrix3f:case c.SFRotation:i.array=new Float32Array(9);break;case c.SFMatrix4d:case c.SFMatrix4f:i.array=new Float32Array(16);break;case c.SFNode:break;case c.MFBool:case c.MFInt32:i.array=new Int32Array(this.getLocationLength(t,e,n));break;case c.MFFloat:case c.MFDouble:case c.MFTime:i.array=new Float32Array(this.getLocationLength(t,e,n));break;case c.MFImage:i.array=new Int32Array(this.getImagesLength(n));break;case c.MFMatrix3d:case c.MFMatrix3f:case c.MFRotation:i.array=new Float32Array(9*this.getLocationLength(t,e,n));break;case c.MFMatrix4d:case c.MFMatrix4f:i.array=new Float32Array(16*this.getLocationLength(t,e,n));break;case c.MFNode:{const s=i.locations=[];for(let i=0;;++i){const r=t.getUniformLocation(e,n.getName()+"["+i+"]");if(!r)break;s.push(r)}break}case c.MFVec2d:case c.MFVec2f:i.array=new Float32Array(2*this.getLocationLength(t,e,n));break;case c.MFVec3d:case c.MFVec3f:case c.MFColor:i.array=new Float32Array(3*this.getLocationLength(t,e,n));break;case c.MFVec4d:case c.MFVec4f:case c.MFColorRGBA:i.array=new Float32Array(4*this.getLocationLength(t,e,n))}i.array?n[I_]=i.array.length?i:null:n[I_]=i,n.addInterest("set_field__",this),this.set_field__(n)}}},removeShaderFields(){for(const e of this.getUserDefinedFields())e.removeInterest("set_field__",this)},set_field__:function(){const e=new Float32Array(9);return function(t){const n=this.getProgram(),i=this.getBrowser().getContext(),s=t[I_];if(i.useProgram(n),s)switch(t.getType()){case c.SFBool:case c.SFInt32:return void i.uniform1i(s,t.getValue());case c.SFColor:{const e=t.getValue();return void i.uniform3f(s,e.r,e.g,e.b)}case c.SFColorRGBA:{const e=t.getValue();return void i.uniform4f(s,e.r,e.g,e.b,e.a)}case c.SFDouble:case c.SFFloat:case c.SFTime:return void i.uniform1f(s,t.getValue());case c.SFImage:{let e=s.array;const n=t.array,r=3+n.length;r!==e.length&&(e=s.array=new Int32Array(r)),e[0]=t.width,e[1]=t.height,e[2]=t.comp;for(let t=3,i=0,s=n.length;i<s;++i,++t)e[t]=n[i];return void i.uniform1iv(s,e)}case c.SFMatrix3d:case c.SFMatrix3f:return s.array.set(t.getValue()),void i.uniformMatrix3fv(s,!1,s.array);case c.SFMatrix4d:case c.SFMatrix4f:return s.array.set(t.getValue()),void i.uniformMatrix4fv(s,!1,s.array);case c.SFNode:{const e=zl(c.X3DTextureNode,t);return void(e?(s.name=t.getName(),s.texture=e,this.textures.add(s)):this.textures.delete(s))}case c.SFRotation:return t.getValue().getMatrix(s.array),void i.uniformMatrix3fv(s,!1,s.array);case c.SFString:return;case c.SFVec2d:case c.SFVec2f:{const e=t.getValue();return void i.uniform2f(s,e.x,e.y)}case c.SFVec3d:case c.SFVec3f:{const e=t.getValue();return void i.uniform3f(s,e.x,e.y,e.z)}case c.SFVec4d:case c.SFVec4f:{const e=t.getValue();return void i.uniform4f(s,e.x,e.y,e.z,e.w)}case c.MFBool:case c.MFInt32:{const e=s.array;for(var r=0,o=t.length;r<o;++r)e[r]=t[r];for(let t=e.length;r<t;++r)e[r]=0;return void i.uniform1iv(s,e)}case c.MFColor:{const e=s.array;r=0;var a=0;for(o=t.length;r<o;++r){const n=t[r];e[a++]=n.r,e[a++]=n.g,e[a++]=n.b}for(let t=e.length;a<t;++a)e[a]=0;return void i.uniform3fv(s,e)}case c.MFColorRGBA:{const e=s.array;for(r=0,a=0,o=t.length;r<o;++r){const n=t[r];e[a++]=n.r,e[a++]=n.g,e[a++]=n.b,e[a++]=n.a}for(let t=e.length;a<t;++a)e[a]=0;return void i.uniform4fv(s,e)}case c.MFDouble:case c.MFFloat:case c.MFTime:{const e=s.array;for(r=0,o=t.length;r<o;++r)e[r]=t[r];for(let t=e.length;r<t;++r)e[r]=0;return void i.uniform1fv(s,e)}case c.MFImage:{const e=s.array;for(let n=0,i=0,s=t.length;n<s;++n){const s=t[n],r=s.array;e[i++]=s.width,e[i++]=s.height,e[i++]=s.comp;for(let t=0,n=r.length;t<n;++t)e[i++]=r[t]}return void i.uniform1iv(s,e)}case c.MFMatrix3d:case c.MFMatrix3f:{const e=s.array;for(r=0,a=0,o=t.length;r<o;++r){const n=t[r];for(let t=0;t<9;++t)e[a++]=n[t]}for(let t=e.length;a<t;++a)e[a]=0;return void i.uniformMatrix3fv(s,!1,e)}case c.MFMatrix4d:case c.MFMatrix4f:{const e=s.array;for(r=0,a=0,o=t.length;r<o;++r){const n=t[r];for(let t=0;t<16;++t)e[a++]=n[t]}for(let t=e.length;a<t;++a)e[a]=0;return void i.uniformMatrix4fv(s,!1,e)}case c.MFNode:{const e=s.locations;for(let n=0,i=t.length;n<i;++n){const i=zl(c.X3DTextureNode,t[n]);i?(e[n].name=t.getName(),e[n].texture=i,this.textures.add(e[n])):this.textures.delete(e[n])}return}case c.MFRotation:{const n=s.array;for(r=0,a=0,o=t.length;r<o;++r)t[r].getValue().getMatrix(e),n[a++]=e[0],n[a++]=e[1],n[a++]=e[2],n[a++]=e[3],n[a++]=e[4],n[a++]=e[5],n[a++]=e[6],n[a++]=e[7],n[a++]=e[8];for(let e=n.length;a<e;++a)n[a]=0;return void i.uniformMatrix3fv(s,!1,n)}case c.MFString:return;case c.MFVec2d:case c.MFVec2f:{const e=s.array;for(r=0,a=0,o=t.length;r<o;++r){const n=t[r];e[a++]=n.x,e[a++]=n.y}for(let t=e.length;a<t;++a)e[a]=0;return void i.uniform2fv(s,e)}case c.MFVec3d:case c.MFVec3f:{const e=s.array;for(r=0,a=0,o=t.length;r<o;++r){const n=t[r];e[a++]=n.x,e[a++]=n.y,e[a++]=n.z}for(let t=e.length;a<t;++a)e[a]=0;return void i.uniform3fv(s,e)}case c.MFVec4d:case c.MFVec4f:{const e=s.array;for(r=0,a=0,o=t.length;r<o;++r){const n=t[r];e[a++]=n.x,e[a++]=n.y,e[a++]=n.z,e[a++]=n.w}for(let t=e.length;a<t;++a)e[a]=0;return void i.uniform4fv(s,e)}}}}(),getImagesLength(e){const t=e.getValue();let n=3*t.length;for(const e of t)n+=e.array.length;return n},getLocationLength(e,t,n){const i=n.getName();for(let n=0;;++n){if(!e.getUniformLocation(t,i+"["+n+"]"))return n}},hasFog(e){return this.fogNode===e||(this.fogNode=e,!1)},hasLight(e,t){return this.lightNodes[e]===t||(this.lightNodes[e]=t,!1)},hasTextureProjector(e,t){return this.projectiveTextureNodes[e]===t||(this.projectiveTextureNodes[e]=t,!1)},setClipPlanes(e,t){this.numClipPlanes=0;for(const n of t)n.setShaderUniforms(e,this)},setUniforms:function(){const e=new Float32Array(9);return function(t,n,i,s=!0){const r=i.renderObject,o=i.fogNode,a=i.appearanceNode,l=a.getStyleProperties(n.geometryType),u=s?a.getMaterial():a.getBackMaterial(),h=i.textureNode||a.getTexture(),c=i.modelViewMatrix;if(this.renderTime!==r.getRenderTime()){this.renderTime=r.getRenderTime(),t.uniform4iv(this.x3d_Viewport,r.getViewportArray()),t.uniformMatrix4fv(this.x3d_ProjectionMatrix,!1,r.getProjectionMatrixArray()),t.uniformMatrix4fv(this.x3d_CameraSpaceMatrix,!1,r.getCameraSpaceMatrixArray()),this.fogNode=null,this.numLights=0,this.numProjectiveTextures=0,this.lightNodes.length=0,this.projectiveTextureNodes.length=0;const e=r.getGlobalObjects();for(const n of e)n.setShaderUniforms(t,this,r);this.numGlobalLights=this.numLights,this.numGlobalProjectiveTextures=this.numProjectiveTextures;const n=r.getViewpoint();if(this.logarithmicDepthBuffer||n.getLogarithmicDepthBuffer()){const e=r.getNavigationInfo();t.uniform1f(this.x3d_LogarithmicFarFactor1_2,1/Math.log2(e.getFarValue(n)+1))}}t.uniformMatrix4fv(this.x3d_ModelViewMatrix,!1,c),n.hasNormals&&(e[0]=c[0],e[3]=c[1],e[6]=c[2],e[1]=c[4],e[4]=c[5],e[7]=c[6],e[2]=c[8],e[5]=c[9],e[8]=c[10],Bt.prototype.inverse.call(e),t.uniformMatrix3fv(this.x3d_NormalMatrix,!1,e)),o?.setShaderUniforms(t,this),this.numClipPlanes=0,this.numLights=this.numGlobalLights,this.numProjectiveTextures=this.numGlobalProjectiveTextures;for(const e of i.localObjects)e.setShaderUniforms(t,this,r);t.uniform1f(this.x3d_AlphaCutoff,a.getAlphaCutoff()),l?.setShaderUniforms(t,this),u.setShaderUniforms(t,this,r,a.getTextureTransformMapping(),n.getTextureCoordinateMapping(),s),h?.setShaderUniforms(t,this,r),a.getTextureTransform().setShaderUniforms(t,this),n.getTextureCoordinate().setShaderUniforms(t,this)}}(),enable(e){e.useProgram(this.getProgram());for(const t of this.textures){const n=t.texture,i=this.getBrowser().getTextureUnit(n.getTextureType());if(void 0===i)return void console.warn("Not enough combined texture units for uniform variable '"+t.name+"' available.");e.activeTexture(e.TEXTURE0+i),e.bindTexture(n.getTarget(),n.getTexture()),e.uniform1i(t,i)}},enableFloatAttrib(e,t,n,i,s,r){const o=e.getAttribLocation(this.getProgram(),t);-1!==o&&(e.bindBuffer(e.ARRAY_BUFFER,n),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,i,e.FLOAT,!1,s,r))},enableMatrix3Attrib(e,t,n,i,s){const r=e.getAttribLocation(this.getProgram(),t);if(-1!==r){i=i||36,e.bindBuffer(e.ARRAY_BUFFER,n);for(let t=0;t<3;++t){const n=r+t;e.enableVertexAttribArray(n),e.vertexAttribPointer(n,3,e.FLOAT,!1,i,s+12*t)}}},enableMatrix4Attrib(e,t,n,i,s){const r=e.getAttribLocation(this.getProgram(),t);if(-1!==r){i=i||64,e.bindBuffer(e.ARRAY_BUFFER,n);for(let t=0;t<4;++t){const n=r+t;e.enableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,i,s+16*t)}}},enableLineStippleAttribute(e,t,n,i){const s=this.x3d_LineStipple;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,3,e.FLOAT,!1,n,i)},enableFogDepthAttribute(e,t,n,i){const s=this.x3d_FogDepth;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,1,e.FLOAT,!1,n,i)},enableColorAttribute(e,t,n,i){const s=this.x3d_Color;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,4,e.FLOAT,!1,n,i)},colorAttributeDivisor(e,t){e.vertexAttribDivisor(this.x3d_Color,t)},enableTexCoordAttribute(e,t,n,i){for(const[s,r]of this.x3d_TexCoord)e.bindBuffer(e.ARRAY_BUFFER,t[s]),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,n,i)},texCoordAttributeDivisor(e,t){for(const[n,i]of this.x3d_TexCoord)e.vertexAttribDivisor(i,t)},enableNormalAttribute(e,t,n,i){const s=this.x3d_Normal;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,3,e.FLOAT,!1,n,i)},normalAttributeDivisor(e,t){e.vertexAttribDivisor(this.x3d_Normal,t)},enableVertexAttribute(e,t,n,i){const s=this.x3d_Vertex;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,4,e.FLOAT,!1,n,i)},vertexAttributeDivisor(e,t){e.vertexAttribDivisor(this.x3d_Vertex,t)},enableParticleAttribute(e,t,n,i,s){const r=this.x3d_Particle;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,n,i),e.vertexAttribDivisor(r,s)},enableParticleMatrixAttribute(e,t,n,i,s){const r=this.x3d_ParticleMatrix;n=n||64,e.bindBuffer(e.ARRAY_BUFFER,t);for(let t=0;t<4;++t){const o=r+t;e.enableVertexAttribArray(o),e.vertexAttribPointer(o,4,e.FLOAT,!1,n,i+16*t),e.vertexAttribDivisor(o,s)}},getProgramInfo(){function e(e,t){return e<t?-1:e>t?1:0}const t=this.getProgram(),n=this.getBrowser().getContext(),i={attributes:[],uniforms:[],attributeCount:0,uniformCount:0},s=n.getProgramParameter(t,n.ACTIVE_UNIFORMS),r=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES),o={35664:"vec2",35665:"vec3",35666:"vec4",35667:"ivec2",35668:"ivec3",35669:"ivec4",35670:"bool",35671:"bvec2",35672:"bvec3",35673:"bvec4",35674:"mat2",35675:"mat3",35676:"mat4",35678:"sampler2D",35680:"samplerCube",5120:"byte",5121:"ubyte",5122:"short",5123:"ushort",5124:"int",5125:"uint",5126:"float"};for(let e=0;e<s;++e){const s=n.getActiveUniform(t,e);s.typeName=o[s.type],i.uniforms.push(Object.assign({},s)),i.uniformCount+=s.size}for(let e=0;e<r;++e){const s=n.getActiveAttrib(t,e);s.typeName=o[s.type],i.attributes.push(Object.assign({},s)),i.attributeCount+=s.size}return i.uniforms.sort((function(t,n){return e(t.name,n.name)})),i.attributes.sort((function(t,n){return e(t.name,n.name)})),i},printProgramInfo(){const e=this.getProgramInfo();console.log(this.getName()),console.table(e.attributes),console.log(this.getName(),"attributeCount",e.attributeCount),console.log(this.getName()),console.table(e.uniforms),console.log(this.getName(),"uniformCount",e.uniformCount)},dispose(){}}),Object.defineProperties(M_,{typeName:{value:"X3DProgrammableShaderObject",enumerable:!0},componentName:{value:"Shaders",enumerable:!0}});const P_=M_;n.set("x_ite/Components/Shaders/X3DProgrammableShaderObject",P_);const D_=P_;function R_(e){N_.call(this,e),D_.call(this,e),this.addType(c.ComposedShader),this.loadSensor=new Yf(e),this.transformFeedbackVaryings=[]}Object.assign(Object.setPrototypeOf(R_.prototype,N_.prototype),D_.prototype,{wireframe:!1,initialize(){N_.prototype.initialize.call(this),D_.prototype.initialize.call(this),this._activate.addInterest("set_activate__",this),this._parts.addFieldInterest(this.loadSensor._children),this.loadSensor._isLoaded.addInterest("connectLoaded",this),this.loadSensor._children=this._parts,this.loadSensor.setPrivate(!0),this.loadSensor.setup(),this.loadSensor._isLoaded.getValue()?this.set_loaded__():this.connectLoaded()},connectLoaded(){this.loadSensor._isLoaded.removeInterest("connectLoaded",this),this.loadSensor._isLoaded.addInterest("set_loaded__",this)},addUserDefinedField(e,t,n){const i=this.isInitialized()&&this.isValid();i&&this.removeShaderFields(),N_.prototype.addUserDefinedField.call(this,e,t,n),i&&this.addShaderFields()},removeUserDefinedField(e){const t=this.isInitialized()&&this.isValid();t&&this.removeShaderFields(),N_.prototype.removeUserDefinedField.call(this,e),t&&this.addShaderFields()},setTransformFeedbackVaryings(e){this.transformFeedbackVaryings=e},getProgram(){return this.program},set_activate__(){this._activate.getValue()&&this.set_loaded__()},set_loaded__(){if(this.loadSensor._isLoaded.getValue()&&"GLSL"===this._language.getValue()){const e=this.getBrowser().getContext(),t=e.createProgram();this.isValid()&&this.removeShaderFields(),e.deleteProgram(this.program),this.program=t;for(const n of this._parts){const i=zl(c.ShaderPart,n);i?.getShader()&&e.attachShader(t,i.getShader())}this.transformFeedbackVaryings.length&&e.transformFeedbackVaryings(t,this.transformFeedbackVaryings,e.INTERLEAVED_ATTRIBS),e.linkProgram(t),e.getProgramParameter(t,e.LINK_STATUS)?(this.setValid(!0),this.getDefaultUniformsAndAttributes(),this.addShaderFields()):(this.setValid(!1),this._parts.length&&console.warn("Couldn't initialize "+this.getTypeName()+" '"+this.getName()+"': "+e.getProgramInfoLog(t)))}else this.setValid(!1)},dispose(){D_.prototype.dispose.call(this),N_.prototype.dispose.call(this)}}),Object.defineProperties(R_,{typeName:{value:"ComposedShader",enumerable:!0},componentName:{value:"Shaders",enumerable:!0},containerField:{value:"shaders",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"activate",new Qi.SFBool),new H(c.outputOnly,"isSelected",new Qi.SFBool),new H(c.outputOnly,"isValid",new Qi.SFBool),new H(c.initializeOnly,"language",new Qi.SFString),new H(c.inputOutput,"parts",new Qi.MFNode)]),enumerable:!0}});const A_=R_;n.set("x_ite/Components/Shaders/ComposedShader",A_);const V_=A_;function L_(e){Qh.call(this,e),this.addType(c.X3DVertexAttributeNode),this.addChildObjects("attribute_changed",new Qi.SFTime)}Object.assign(Object.setPrototypeOf(L_.prototype,Qh.prototype),{initialize(){Qh.prototype.initialize.call(this),this._name.addInterest("set_attribute__",this)},set_attribute__(){this._attribute_changed=this.getBrowser().getCurrentTime()}}),Object.defineProperties(L_,{typeName:{value:"X3DVertexAttributeNode",enumerable:!0},componentName:{value:"Shaders",enumerable:!0}});const B_=L_;n.set("x_ite/Components/Shaders/X3DVertexAttributeNode",B_);const U_=B_;function X_(e){U_.call(this,e),this.addType(c.FloatVertexAttribute)}Object.assign(Object.setPrototypeOf(X_.prototype,U_.prototype),{initialize(){U_.prototype.initialize.call(this),this._numComponents.addInterest("set_numComponents__",this),this._numComponents.addInterest("set_attribute__",this),this._value.addInterest("set_value__",this),this.set_numComponents__(),this.set_value__()},set_numComponents__(){this.numComponents=f.clamp(this._numComponents.getValue(),1,4)},set_value__(){this.value=this._value.getValue(),this.length=this._value.length},addValue(e,t){const n=this.value;let i=e*this.numComponents,s=i+this.numComponents;if(s<=this.length)for(;i<s;++i)t.push(n[i]);else if(this.numComponents<=this.length)for(s=n.length,i=s-this.numComponents;i<s;++i)t.push(n[i]);else for(;i<s;++i)t.push(0)},enable(e,t,n){t.enableFloatAttrib(e,this._name.getValue(),n,this.numComponents,0,0)}}),Object.defineProperties(X_,{typeName:{value:"FloatVertexAttribute",enumerable:!0},componentName:{value:"Shaders",enumerable:!0},containerField:{value:"attrib",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"name",new Qi.SFString),new H(c.initializeOnly,"numComponents",new Qi.SFInt32(4)),new H(c.inputOutput,"value",new Qi.MFFloat)]),enumerable:!0}});const j_=X_;n.set("x_ite/Components/Shaders/FloatVertexAttribute",j_);const k_=j_;function z_(e){U_.call(this,e),this.addType(c.Matrix3VertexAttribute)}Object.assign(Object.setPrototypeOf(z_.prototype,U_.prototype),{initialize(){U_.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__(){this.value=this._value.getValue(),this.length=this._value.length},addValue(e,t){if(e<this.length){const n=this.value;for(let i=9*e,s=i+9;i<s;++i)t.push(n[i])}else if(this.length){const n=this.value;for(let i=9*(e=this.length-1),s=i+9;i<s;++i)t.push(n[i])}else{const e=Bt.Identity;for(let n=0;n<9;++n)t.push(e[n])}},enable(e,t,n){t.enableMatrix3Attrib(e,this._name.getValue(),n,0,0)}}),Object.defineProperties(z_,{typeName:{value:"Matrix3VertexAttribute",enumerable:!0},componentName:{value:"Shaders",enumerable:!0},containerField:{value:"attrib",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"name",new Qi.SFString),new H(c.inputOutput,"value",new Qi.MFMatrix3f)]),enumerable:!0}});const G_=z_;n.set("x_ite/Components/Shaders/Matrix3VertexAttribute",G_);const H_=G_;function q_(e){U_.call(this,e),this.addType(c.Matrix4VertexAttribute)}Object.assign(Object.setPrototypeOf(q_.prototype,U_.prototype),{initialize(){U_.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__(){this.value=this._value.getValue(),this.length=this._value.length},addValue(e,t){if(e<this.length){const n=this.value;for(let i=16*e,s=i+16;i<s;++i)t.push(n[i])}else if(this.length){const n=this.value;for(let i=16*(e=this.length-1),s=i+16;i<s;++i)t.push(n[i])}else{const e=Matrix4.Identity;for(let n=0;n<16;++n)t.push(e[n])}},enable(e,t,n){t.enableMatrix4Attrib(e,this._name.getValue(),n,0,0)}}),Object.defineProperties(q_,{typeName:{value:"Matrix4VertexAttribute",enumerable:!0},componentName:{value:"Shaders",enumerable:!0},containerField:{value:"attrib",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.initializeOnly,"name",new Qi.SFString),new H(c.inputOutput,"value",new Qi.MFMatrix4f)]),enumerable:!0}});const Y_=q_;n.set("x_ite/Components/Shaders/Matrix4VertexAttribute",Y_);const W_=Y_;function $_(e){N_.call(this,e),Rr.call(this,e),D_.call(this,e),this.addType(c.PackagedShader)}Object.assign(Object.setPrototypeOf($_.prototype,N_.prototype),Rr.prototype,D_.prototype,{getSourceText(){return this._url},requestImmediateLoad(e=!0){},initialize(){N_.prototype.initialize.call(this),Rr.prototype.initialize.call(this),D_.prototype.initialize.call(this)},dispose(){D_.prototype.dispose.call(this),Rr.prototype.dispose.call(this),N_.prototype.dispose.call(this)}}),Object.defineProperties($_,{typeName:{value:"PackagedShader",enumerable:!0},componentName:{value:"Shaders",enumerable:!0},containerField:{value:"shaders",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOnly,"activate",new Qi.SFBool),new H(c.outputOnly,"isSelected",new Qi.SFBool),new H(c.outputOnly,"isValid",new Qi.SFBool),new H(c.initializeOnly,"language",new Qi.SFString),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600))]),enumerable:!0}});const K_=$_;n.set("x_ite/Components/Shaders/PackagedShader",K_);const J_=K_;function Z_(e){N_.call(this,e),this.addType(c.ProgramShader)}Object.setPrototypeOf(Z_.prototype,N_.prototype),Object.defineProperties(Z_,{typeName:{value:"ProgramShader",enumerable:!0},componentName:{value:"Shaders",enumerable:!0},containerField:{value:"shaders",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOnly,"activate",new Qi.SFBool),new H(c.outputOnly,"isSelected",new Qi.SFBool),new H(c.outputOnly,"isValid",new Qi.SFBool),new H(c.initializeOnly,"language",new Qi.SFString),new H(c.inputOutput,"programs",new Qi.MFNode)]),enumerable:!0}});const Q_=Z_;n.set("x_ite/Components/Shaders/ProgramShader",Q_);const ex=Q_,tx="\n#if defined (X3D_FOG)\nstruct x3d_FogParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float visibilityRange;\n   mediump mat3  matrix;\n};\n#endif\n\n//uniform x3d_FogParameters x3d_Fog;\n\n#if defined (X3D_LIGHTING)\nstruct x3d_LightSourceParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float intensity;\n   mediump float ambientIntensity;\n   mediump vec3  attenuation;\n   mediump vec3  location;\n   mediump vec3  direction;\n   mediump float radius;\n   mediump float beamWidth;\n   mediump float cutOffAngle;\n   mediump mat3  matrix;\n   #if defined (X3D_SHADOWS)\n   mediump vec3  shadowColor;\n   mediump float shadowIntensity;\n   mediump float shadowBias;\n   mediump mat4  shadowMatrix;\n   mediump int   shadowMapSize;\n   #endif\n};\n#endif\n\n//uniform x3d_LightSourceParameters x3d_LightSource [x3d_MaxLights];\n\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_PointPropertiesParameters\n{\n   mediump float pointSizeScaleFactor;\n   mediump float pointSizeMinValue;\n   mediump float pointSizeMaxValue;\n   mediump vec3  attenuation;\n};\n#endif\n\n//uniform x3d_PointPropertiesParameters x3d_PointProperties;\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_LinePropertiesParameters\n{\n   mediump int   linetype;\n   mediump float lineStippleScale;\n   sampler2D     texture;\n};\n#endif\n\n//uniform x3d_LinePropertiesParameters x3d_LineProperties;\n\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_FillPropertiesParameters\n{\n   bool          filled;\n   bool          hatched;\n   mediump vec3  hatchColor;\n   sampler2D     texture;\n   mediump float scale;\n};\n#endif\n\n//uniform x3d_FillPropertiesParameters x3d_FillProperties;\n\n#if defined (X3D_UNLIT_MATERIAL)\nstruct x3d_UnlitMaterialParameters\n{\n   mediump vec3  emissiveColor;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_MATERIAL)\nstruct x3d_MaterialParameters\n{\n   mediump float ambientIntensity;\n   mediump vec3  diffuseColor;\n   mediump vec3  specularColor;\n   mediump vec3  emissiveColor;\n   mediump float shininess;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_PHYSICAL_MATERIAL)\nstruct x3d_PhysicalMaterialParameters\n{\n   mediump vec3  baseColor;\n   mediump vec3  emissiveColor;\n   mediump float metallic;\n   mediump float roughness;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (X3D_AMBIENT_TEXTURE)\nstruct x3d_AmbientTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_AMBIENT_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nstruct x3d_DiffuseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_DIFFUSE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n\n#if defined (X3D_SPECULAR_TEXTURE)\nstruct x3d_SpecularTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SPECULAR_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nstruct x3d_EmissiveTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_EMISSIVE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n\n#if defined (X3D_SHININESS_TEXTURE)\nstruct x3d_ShininessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SHININESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n\n#if defined (X3D_BASE_TEXTURE)\nstruct x3d_BaseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_BASE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_BaseTextureParameters x3d_BaseTexture;\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nstruct x3d_MetallicRoughnessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nstruct x3d_OcclusionTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_OCCLUSION_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n\n#if defined (X3D_NORMAL_TEXTURE)\nstruct x3d_NormalTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_NORMAL_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_NormalTextureParameters x3d_NormalTexture;\n\n#if defined (X3D_MULTI_TEXTURING)\nstruct x3d_MultiTextureParameters\n{\n   mediump int mode;\n   mediump int alphaMode;\n   mediump int source;\n   mediump int function;\n};\n#endif\n\n//uniform x3d_MultiTextureParameters x3d_MultiTexture [x3d_MaxTextures];\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nstruct x3d_TextureCoordinateGeneratorParameters\n{\n   mediump int   mode;\n   mediump float parameter [6];\n};\n#endif\n\n//uniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [x3d_MaxTextures];\n";n.set("assets/shaders/Types.glsl",tx);const nx=tx;let ix=0;const sx={REPLACE:ix++,MODULATE:ix++,MODULATE2X:ix++,MODULATE4X:ix++,ADD:ix++,ADDSIGNED:ix++,ADDSIGNED2X:ix++,ADDSMOOTH:ix++,SUBTRACT:ix++,BLENDDIFFUSEALPHA:ix++,BLENDTEXTUREALPHA:ix++,BLENDFACTORALPHA:ix++,BLENDCURRENTALPHA:ix++,MODULATEALPHA_ADDCOLOR:ix++,MODULATEINVALPHA_ADDCOLOR:ix++,MODULATEINVCOLOR_ADDALPHA:ix++,DOTPRODUCT3:ix++,SELECTARG1:ix++,SELECTARG2:ix++,OFF:ix++};n.set("x_ite/Browser/Texturing/ModeType",sx);const rx=sx;let ox=0;const ax={DEFAULT:ox++,DIFFUSE:ox++,SPECULAR:ox++,FACTOR:ox++};n.set("x_ite/Browser/Texturing/SourceType",ax);const lx=ax;let ux=0;const hx={DEFAULT:ux++,COMPLEMENT:ux++,ALPHAREPLICATE:ux++};n.set("x_ite/Browser/Texturing/FunctionType",hx);const cx=hx;let dx=0;const px={NONE:dx++,SPHERE:dx++,CAMERASPACENORMAL:dx++,CAMERASPACEPOSITION:dx++,CAMERASPACEREFLECTIONVECTOR:dx++,SPHERE_LOCAL:dx++,COORD:dx++,COORD_EYE:dx++,NOISE:dx++,NOISE_EYE:dx++,SPHERE_REFLECT:dx++,SPHERE_REFLECT_LOCAL:dx++};n.set("x_ite/Browser/Texturing/TextureCoordinateGeneratorModeType",px);const gx=px;const fx={getSource(e,t,n,i){const s="\\s+|/\\*[\\s\\S]*?\\*/|//.*?\\n",r="#line\\s+.*?\\n|#if\\s+.*?\\n|#elif\\s+.*?\\n|#ifdef\\s+.*?\\n|#ifndef\\s+.*?\\n|#else.*?\\n|#endif.*?\\n|#define\\s+(?:[^\\n\\\\]|\\\\[^\\r\\n]|\\\\\\r?\\n)*\\n|#undef\\s+.*?\\n|#pragma\\s+.*?\\n",o=new RegExp("^((?:"+s+"|"+r+")*(?:#version\\s+.*?\\n)?(?:"+s+"|"+r+"|#extension\\s+.*?\\n)*)([\\s\\S]*)$"),a=n.match(o);if(!a)return n;let l="";l+="#define X_ITE\n",e.HAS_FEATURE_DEPTH_TEXTURE&&(l+="#define X3D_DEPTH_TEXTURE\n");for(const e of i)l+="#define "+e+"\n";let u="";u+="#define x3d_None 0\n",u+="#define x3d_Points      0\n",u+="#define x3d_Lines       1\n",u+="#define x3d_Geometry2D  2\n",u+="#define x3d_Geometry3D  3\n",u+="#define x3d_MaxClipPlanes  "+t.getMaxClipPlanes()+"\n",u+="#define x3d_LinearFog        1\n",u+="#define x3d_ExponentialFog   2\n",u+="#define x3d_Exponential2Fog  3\n",u+="#define x3d_MaxLights         "+t.getMaxLights()+"\n",u+="#define x3d_DirectionalLight  1\n",u+="#define x3d_PointLight        2\n",u+="#define x3d_SpotLight         3\n",u+="#define x3d_MaxTextures      "+t.getMaxTextures()+"\n",u+="#define x3d_TextureType2D    2\n",u+="#define x3d_TextureType3D    3\n",u+="#define x3d_TextureTypeCube  4\n",u+="#define x3d_Replace                   "+rx.REPLACE+"\n",u+="#define x3d_Modulate                  "+rx.MODULATE+"\n",u+="#define x3d_Modulate2X                "+rx.MODULATE2X+"\n",u+="#define x3d_Modulate4X                "+rx.MODULATE4X+"\n",u+="#define x3d_Add                       "+rx.ADD+"\n",u+="#define x3d_AddSigned                 "+rx.ADDSIGNED+"\n",u+="#define x3d_AddSigned2X               "+rx.ADDSIGNED2X+"\n",u+="#define x3d_AddSmooth                 "+rx.ADDSMOOTH+"\n",u+="#define x3d_Subtract                  "+rx.SUBTRACT+"\n",u+="#define x3d_BlendDiffuseAlpha         "+rx.BLENDDIFFUSEALPHA+"\n",u+="#define x3d_BlendTextureAlpha         "+rx.BLENDTEXTUREALPHA+"\n",u+="#define x3d_BlendFactorAlpha          "+rx.BLENDFACTORALPHA+"\n",u+="#define x3d_BlendCurrentAlpha         "+rx.BLENDCURRENTALPHA+"\n",u+="#define x3d_ModulateAlphaAddColor     "+rx.MODULATEALPHA_ADDCOLOR+"\n",u+="#define x3d_ModulateInvAlphaAddColor  "+rx.MODULATEINVALPHA_ADDCOLOR+"\n",u+="#define x3d_ModulateInvColorAddAlpha  "+rx.MODULATEINVCOLOR_ADDALPHA+"\n",u+="#define x3d_DotProduct3               "+rx.DOTPRODUCT3+"\n",u+="#define x3d_SelectArg1                "+rx.SELECTARG1+"\n",u+="#define x3d_SelectArg2                "+rx.SELECTARG2+"\n",u+="#define x3d_Off                       "+rx.OFF+"\n",u+="#define x3d_Diffuse  "+lx.DIFFUSE+"\n",u+="#define x3d_Specular "+lx.SPECULAR+"\n",u+="#define x3d_Factor   "+lx.FACTOR+"\n",u+="#define x3d_Complement     "+cx.COMPLEMENT+"\n",u+="#define x3d_AlphaReplicate "+cx.ALPHAREPLICATE+"\n",u+="#define x3d_Sphere                      "+gx.SPHERE+"\n",u+="#define x3d_CameraSpaceNormal           "+gx.CAMERASPACENORMAL+"\n",u+="#define x3d_CameraSpacePosition         "+gx.CAMERASPACEPOSITION+"\n",u+="#define x3d_CameraSpaceReflectionVector "+gx.CAMERASPACEREFLECTIONVECTOR+"\n",u+="#define x3d_SphereLocal                 "+gx.SPHERE_LOCAL+"\n",u+="#define x3d_Coord                       "+gx.COORD+"\n",u+="#define x3d_CoordEye                    "+gx.COORD_EYE+"\n",u+="#define x3d_Noise                       "+gx.NOISE+"\n",u+="#define x3d_NoiseEye                    "+gx.NOISE_EYE+"\n",u+="#define x3d_SphereReflect               "+gx.SPHERE_REFLECT+"\n",u+="#define x3d_SphereReflectLocal          "+gx.SPHERE_REFLECT_LOCAL+"\n",u+="#define x3d_GeometryPoints  0\n",u+="#define x3d_GeometryLines   1\n",u+="#define x3d_NoneClipPlane   vec4 (88.0, 51.0, 68.0, 33.0)\n",u+="#define x3d_NoneFog         0\n",u+="#define x3d_NoneLight       0\n",u+="#define x3d_NoneTexture     0\n";const h=n.match(/\s*precision\s+(lowp|mediump|highp)\s+float\s*;/),c=n.match(/\s*precision\s+(lowp|mediump|highp)\s+int\s*;/),d=h?h[1]:"mediump",p=c?c[1]:"mediump",g=nx.replace(/mediump\s+(float|vec2|vec3|mat3|mat4)/g,d+" $1").replace(/mediump\s+(int)/g,p+" $1"),f=(a[1].match(/\n/g)||[]).length+1;return a[1]+l+u+g+"#line "+(f+1)+" -1\n"+a[2]}};n.set("x_ite/Browser/Shaders/ShaderSource",fx);const mx=fx,_x="\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/ClipPlanes.glsl",_x);const xx=_x,yx="\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\n#if defined (MANUAL_SRGB)\nvec4\nGamma (const in vec4 color)\n{\n   return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n}\n#else\n#define Gamma(color) (color)\n#endif\n";n.set("assets/shaders/webgl1/include/Colors.glsl",yx);const wx=yx,bx="\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Fog.glsl",bx);const Sx=bx,vx='\n#if defined (X3D_NORMAL_TEXTURE)\n   #extension GL_OES_standard_derivatives : enable\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   #extension GL_EXT_frag_depth : enable\n#endif\n\n#if defined (X3D_ALPHA_MODE_MASK)\n   uniform float x3d_AlphaCutoff;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         varying vec4 texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         varying vec4 texCoord3;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         vec4 texCoord2 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         vec4 texCoord3 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   varying float depth;\n#endif\n\n#pragma X3D include "Texture.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n\nvec4\ngetMaterialColor ();\n\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      setPointTexCoords ();\n   #endif\n\n   vec4 finalColor = getMaterialColor ();\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getPointColor (finalColor);\n   #endif\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   #if defined (X3D_ALPHA_MODE_OPAQUE)\n      finalColor .a = 1.0;\n   #endif\n\n   #if defined (X3D_ALPHA_MODE_MASK)\n      if (finalColor .a < x3d_AlphaCutoff)\n         discard;\n\n      finalColor .a = 1.0;\n   #endif\n\n   gl_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //https://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepthEXT = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n';n.set("assets/shaders/webgl1/include/Fragment.glsl",vx);const Tx=vx,Ox="\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture2D (x3d_FillProperties .texture, gl_FragCoord .xy / (32.0 * x3d_FillProperties .scale));\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Hatch.glsl",Ox);const Ex=Ox,Cx='\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0 && light .shadowIntensity > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n';n.set("assets/shaders/webgl1/include/Material.glsl",Cx);const Nx=Cx,Fx="\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE) && ! defined (X3D_NORMAL_TEXTURE_3D)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture2D (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = textureCube (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n";n.set("assets/shaders/webgl1/include/Normal.glsl",Fx);const Ix=Fx,Mx="\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n";n.set("assets/shaders/webgl1/include/Perlin.glsl",Mx);const Px=Mx,Dx="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetPointTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoord0 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoord1 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 2\n      texCoord2 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 3\n      texCoord3 = texCoord;\n   #endif\n}\n\n#define getPointColor(color) (color)\n\n#else\n\n#define setPointTexCoords()\n\nvarying float pointSize;\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n#endif\n#endif\n";n.set("assets/shaders/webgl1/include/Point.glsl",Dx);const Rx=Dx,Ax="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nvarying float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue = x3d_PointProperties .pointSizeMaxValue;\n   vec3  attenuation       = x3d_PointProperties .attenuation;\n   float dL                = length (vertex);\n   float pointSize         = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (attenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/PointSize.glsl",Ax);const Vx=Ax,Lx="\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   #if X3D_NUM_LIGHTS > 0\n   if (index == 0)\n      return texture2D (x3d_ShadowMap [0], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 1\n   if (index == 1)\n      return texture2D (x3d_ShadowMap [1], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 2\n   if (index == 2)\n      return texture2D (x3d_ShadowMap [2], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 3\n   if (index == 3)\n      return texture2D (x3d_ShadowMap [3], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 4\n   if (index == 4)\n      return texture2D (x3d_ShadowMap [4], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 5\n   if (index == 5)\n      return texture2D (x3d_ShadowMap [5], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 6\n   if (index == 6)\n      return texture2D (x3d_ShadowMap [6], shadowCoord) .r;\n   #endif\n\n   #if X3D_NUM_LIGHTS > 7\n   if (index == 7)\n      return texture2D (x3d_ShadowMap [7], shadowCoord) .r;\n   #endif\n\n   return 0.0;\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         vec2 d0 = - texelSize;\n         vec2 d1 =   texelSize;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + d0,                  shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0,   d0 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d1 .x, d0 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d0 .x, 0.0),   shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy, shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d1 .x, 0.0),   shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d0 .x, d1 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0,   d1 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + d1,                  shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         vec2 d0 = - texelSize;\n         vec2 d1 =   texelSize;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + d0,                  shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0,   d0 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d1 .x, d0 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d0 .x, 0.0),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy, shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d1 .x, 0.0),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d0 .x, d1 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, d1 .y),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + d1,                  shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Shadow.glsl",Lx);const Bx=Lx,Ux="\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n";n.set("assets/shaders/webgl1/include/SpotFactor.glsl",Ux);const Xx=Ux,jx='\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nmat4\ngetTextureMatrix (const in int i)\n{\n   #if X3D_NUM_TEXTURE_TRANSFORMS > 1\n      mat4 textureMatrix = mat4 (0.0);\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 0\n      if (i == 0)\n         textureMatrix = x3d_TextureMatrix [0];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 1\n      else if (i == 1)\n         textureMatrix = x3d_TextureMatrix [1];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 2\n      else if (i == 2)\n         textureMatrix = x3d_TextureMatrix [2];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 3\n      else if (i == 3)\n         textureMatrix = x3d_TextureMatrix [3];\n      #endif\n\n      return textureMatrix;\n   #else\n      return x3d_TextureMatrix [0];\n   #endif\n}\n\nvec4\ngetTexCoord (const in int i)\n{\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      vec4 texCoord = vec4 (0.0);\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n      if (i == 0)\n         texCoord = texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n      else if (i == 1)\n         texCoord = texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n      else if (i == 2)\n         texCoord = texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n      else if (i == 3)\n         texCoord = texCoord3;\n      #endif\n\n      return texCoord;\n   #else\n      return texCoord0;\n   #endif\n}\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   if (mode == x3d_None)\n   {\n      return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n   }\n   else if (mode == x3d_Sphere)\n   {\n      vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceNormal)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (N, 1.0);\n   }\n   else if (mode == x3d_CameraSpacePosition)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceReflectionVector)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (reflect (normalize (vertex), -N), 1.0);\n   }\n   else if (mode == x3d_SphereLocal)\n   {\n      vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_Coord)\n   {\n      return vec4 (localVertex, 1.0);\n   }\n   else if (mode == x3d_CoordEye)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_Noise)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (localVertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_NoiseEye)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (vertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_SphereReflect)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n      float eta = textureCoordinateGenerator .parameter [0];\n\n      return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n   }\n   else if (mode == x3d_SphereReflectLocal)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n      float eta = textureCoordinateGenerator .parameter [0];\n      vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n      return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n   }\n\n   return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord;\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n   if (textureCoordinateMapping == 0)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [0], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n   else if (textureCoordinateMapping == 1)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [1], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 2\n   else if (textureCoordinateMapping == 2)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [2], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 3\n   else if (textureCoordinateMapping == 3)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [3], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   vec4 textureColor = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURES > 0\n   if (i == 0)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   #if X3D_NUM_TEXTURES > 1\n   else if (i == 1)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [1], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [1], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   return textureColor;\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nint\nminI (const in int a, const in int b)\n{\n   return a < b ? a : b;\n}\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (minI (i, X3D_NUM_TEXTURE_TRANSFORMS - 1), minI (i, X3D_NUM_TEXTURE_COORDINATES - 1));\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         if (source == x3d_Diffuse)\n         {\n            arg1 = diffuseColor;\n         }\n         else if (source == x3d_Specular)\n         {\n            arg1 = specularColor;\n         }\n         else if (source == x3d_Factor)\n         {\n            arg1 = x3d_MultiTextureColor;\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         if (function == x3d_Complement)\n         {\n            arg1 = 1.0 - arg1;\n         }\n         else if (function == x3d_AlphaReplicate)\n         {\n            arg1 .a = arg2 .a;\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         if (mode == x3d_Replace)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_Modulate)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .rgb;\n         }\n         else if (mode == x3d_Modulate2X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n         }\n         else if (mode == x3d_Modulate4X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n         }\n         else if (mode == x3d_Add)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb;\n         }\n         else if (mode == x3d_AddSigned)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n         }\n         else if (mode == x3d_AddSigned2X)\n         {\n            currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n         }\n         else if (mode == x3d_AddSmooth)\n         {\n            currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n         }\n         else if (mode == x3d_Subtract)\n         {\n            currentColor .rgb = arg1 .rgb - arg2 .rgb;\n         }\n         else if (mode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n         }\n         else if (mode == x3d_BlendTextureAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n         }\n         else if (mode == x3d_BlendFactorAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (mode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n         }\n         else if (mode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n         }\n         else if (mode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n         }\n         else if (mode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n         }\n         else if (mode == x3d_DotProduct3)\n         {\n            currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n         }\n         else if (mode == x3d_SelectArg1)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_SelectArg2)\n         {\n            currentColor .rgb = arg2 .rgb;\n         }\n         else if (mode == x3d_Off)\n            ;\n\n         // Alpha\n\n         if (alphaMode == x3d_Replace)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_Modulate)\n         {\n            currentColor .a = arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_Modulate2X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n         }\n         else if (alphaMode == x3d_Modulate4X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n         }\n         else if (alphaMode == x3d_Add)\n         {\n            currentColor .a = arg1 .a + arg2 .a;\n         }\n         else if (alphaMode == x3d_AddSigned)\n         {\n            currentColor .a = arg1 .a + arg2 .a - 0.5;\n         }\n         else if (alphaMode == x3d_AddSigned2X)\n         {\n            currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n         }\n         else if (alphaMode == x3d_AddSmooth)\n         {\n            currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n         }\n         else if (alphaMode == x3d_Subtract)\n         {\n            currentColor .a = arg1 .a - arg2 .a;\n         }\n         else if (alphaMode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n         }\n         else if (alphaMode == x3d_BlendTextureAlpha)\n         {\n            currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n         }\n         else if (alphaMode == x3d_BlendFactorAlpha)\n         {\n            currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (alphaMode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n         }\n         else if (alphaMode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_DotProduct3)\n         {\n            currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n         }\n         else if (alphaMode == x3d_SelectArg1)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_SelectArg2)\n         {\n            currentColor .a = arg2 .a;\n         }\n         else if (alphaMode == x3d_Off)\n            ;\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #else\n         vec4 textureColor = vec4 (0.0);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   vec4 color = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 0\n   if (i == 0)\n      color = texture2D (x3d_ProjectiveTexture [0], texCoord);\n   #endif\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 1\n   else if (i == 1)\n      color = texture2D (x3d_ProjectiveTexture [1], texCoord);\n   #endif\n\n   return color;\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalize p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n';n.set("assets/shaders/webgl1/include/Texture.glsl",jx);const kx=jx,zx='\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   attribute float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   attribute vec4 x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         attribute vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         attribute vec4 x3d_TexCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         attribute vec4 x3d_TexCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         attribute vec4 x3d_TexCoord3;\n      #endif\n   #endif\n#endif\n\nattribute vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         varying vec4 texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         varying vec4 texCoord3;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   attribute vec3 x3d_Normal;\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   varying float depth;\n#endif\n\n// Main\n\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = x3d_TexCoord0;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = x3d_TexCoord1;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 2\n            texCoord2 = x3d_TexCoord2;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 3\n            texCoord3 = x3d_TexCoord3;\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal      = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n';n.set("assets/shaders/webgl1/include/Vertex.glsl",zx);const Gx=zx,Hx="\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/ClipPlanes.glsl",Hx);const qx=Hx,Yx="\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\n#if defined (MANUAL_SRGB)\nvec4\nGamma (const in vec4 color)\n{\n   return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n}\n#else\n#define Gamma(color) (color)\n#endif\n";n.set("assets/shaders/webgl2/include/Colors.glsl",Yx);const Wx=Yx,$x="\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Fog.glsl",$x);const Kx=$x,Jx='\n#if defined (X3D_ALPHA_MODE_MASK)\n   uniform float x3d_AlphaCutoff;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         in vec4 texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         in vec4 texCoord3;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         vec4 texCoord2 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         vec4 texCoord3 = vec4 (0.0, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   in vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      in vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nin vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   in vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   in float depth;\n#endif\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "Texture.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Stipple.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n\nvec4\ngetMaterialColor ();\n\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      stipple ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      setPointTexCoords ();\n   #elif defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      setTexCoords ();\n   #endif\n\n   vec4 finalColor = getMaterialColor ();\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getPointColor (finalColor);\n   #endif\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   #if defined (X3D_ALPHA_MODE_OPAQUE)\n      finalColor .a = 1.0;\n   #endif\n\n   #if defined (X3D_ALPHA_MODE_MASK)\n      if (finalColor .a < x3d_AlphaCutoff)\n         discard;\n\n      finalColor .a = 1.0;\n   #endif\n\n   x3d_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //https://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepth = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n';n.set("assets/shaders/webgl2/include/Fragment.glsl",Jx);const Zx=Jx,Qx="\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture (x3d_FillProperties .texture, gl_FragCoord .xy / (32.0 * x3d_FillProperties .scale));\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Hatch.glsl",Qx);const ey=Qx,ty="\nstruct Line2\n{\n   vec2 point;\n   vec2 direction;\n};\n\nLine2\nline2 (const in vec2 point1, const in vec2 point2)\n{\n   return Line2 (point1, normalize (point2 - point1));\n}\n\nvec2\nclosest_point (const in Line2 line, const in vec2 point)\n{\n   vec2  r = point - line .point;\n   float d = dot (r, line .direction);\n\n   return line .direction * d + line .point;\n}\n";n.set("assets/shaders/webgl2/include/Line2.glsl",ty);const ny=ty,iy='\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0 && light .shadowIntensity > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n';n.set("assets/shaders/webgl2/include/Material.glsl",iy);const sy=iy,ry="\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_3D)\n         vec3 n = texture (x3d_NormalTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = texture (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n";n.set("assets/shaders/webgl2/include/Normal.glsl",ry);const oy=ry,ay="\n#if defined (X3D_PARTICLE_SYSTEM)\n#if defined (X3D_TEX_COORD_RAMP)\n\nuniform sampler2D x3d_TexCoordRamp;\n\nin vec4 x3d_Particle;\n\nvec4\ntexelFetch (const in sampler2D sampler, const in int index, const in int lod)\n{\n   int   x = textureSize (sampler, lod) .x;\n   ivec2 p = ivec2 (index % x, index / x);\n   vec4  t = texelFetch (sampler, p, lod);\n\n   return t;\n}\n\nvec4\ngetTexCoord (const in vec4 texCoord)\n{\n   const int map [6] = int [6] (0, 1, 2, 0, 2, 3);\n\n   int index0 = int (x3d_Particle [3]);\n\n   return texelFetch (x3d_TexCoordRamp, index0 + map [gl_VertexID % 6], 0);\n}\n#else\n   #define getTexCoord(texCoord) (texCoord)\n#endif\n\nin mat4 x3d_ParticleMatrix;\n\nvec4\ngetVertex (const in vec4 vertex)\n{\n   return x3d_ParticleMatrix * vertex;\n}\n\n#else\n   #define getVertex(vertex) (vertex)\n   #define getTexCoord(texCoord) (texCoord)\n#endif\n";n.set("assets/shaders/webgl2/include/Particle.glsl",ay);const ly=ay,uy="\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n";n.set("assets/shaders/webgl2/include/Perlin.glsl",uy);const hy=uy,cy="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetPointTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoords [0] = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoords [1] = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 2\n      texCoords [2] = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 3\n      texCoords [3] = texCoord;\n   #endif\n}\n\n#define getPointColor(color) (color)\n\n#else\n\n#define setPointTexCoords()\n\nin float pointSize;\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n#endif\n#endif\n";n.set("assets/shaders/webgl2/include/Point.glsl",cy);const dy=cy,py="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nout float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue = x3d_PointProperties .pointSizeMaxValue;\n   vec3  attenuation       = x3d_PointProperties .attenuation;\n   float dL                = length (vertex);\n   float pointSize         = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (attenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/PointSize.glsl",py);const gy=py,fy="\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   switch (index)\n   {\n      #if X3D_NUM_LIGHTS > 0\n      case 0:\n      {\n         return texture (x3d_ShadowMap [0], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 1\n      case 1:\n      {\n         return texture (x3d_ShadowMap [1], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 2\n      case 2:\n      {\n         return texture (x3d_ShadowMap [2], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 3\n      case 3:\n      {\n         return texture (x3d_ShadowMap [3], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 4\n      case 4:\n      {\n         return texture (x3d_ShadowMap [4], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 5\n      case 5:\n      {\n         return texture (x3d_ShadowMap [5], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 6\n      case 6:\n      {\n         return texture (x3d_ShadowMap [6], shadowCoord) .r;\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 7\n      case 7:\n      {\n         return texture (x3d_ShadowMap [7], shadowCoord) .r;\n      }\n      #endif\n      default:\n      {\n         return 0.0;\n      }\n   }\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         vec2 d0 = - texelSize;\n         vec2 d1 =   texelSize;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + d0,                  shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0,   d0 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d1 .x, d0 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d0 .x, 0.0),   shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy,                       shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d1 .x, 0.0),   shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (d0 .x, d1 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0,   d1 .y), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + d1,                  shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         vec2 d0 = - texelSize;\n         vec2 d1 =   texelSize;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + d0,                  shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0,   d0 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d1 .x, d0 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d0 .x, 0.0),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy,                       shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d1 .x, 0.0),   shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (d0 .x, d1 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0,   d1 .y), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + d1,                  shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         if (any (greaterThan (abs (shadowCoord .xy - 0.5), vec2 (0.5))))\n            return 0.0;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Shadow.glsl",fy);const my=fy,_y='\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n\n#pragma X3D include "Line2.glsl"\n\nuniform x3d_LinePropertiesParameters x3d_LineProperties;\n\nflat in float lengthSoFar; // in px\nflat in vec2  startPoint;  // in px\nin vec2       midPoint;    // in px\n\nvoid\nstipple ()\n{\n   vec2  point = closest_point (line2 (startPoint, midPoint), gl_FragCoord .xy);\n   float s     = (lengthSoFar + length (point - startPoint)) * x3d_LineProperties .lineStippleScale;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         texCoord0 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         texCoord1 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n\n   if (x3d_LineProperties .linetype != 16)\n   {\n      int   linetype = x3d_LineProperties .linetype;\n      int   height   = textureSize (x3d_LineProperties .texture, 0) .y;\n      float t        = 1.0 - float (linetype * 2 + 1) / float (height * 2);\n      float alpha    = texture (x3d_LineProperties .texture, vec2 (s, t)) .a;\n\n      if (alpha != 1.0)\n         discard;\n   }\n}\n\n#endif\n';n.set("assets/shaders/webgl2/include/Stipple.glsl",_y);const xy=_y,yy="\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n";n.set("assets/shaders/webgl2/include/SpotFactor.glsl",yy);const wy=yy,by='\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nvec4 texCoords [X3D_NUM_TEXTURE_COORDINATES];\n\nvoid\nsetTexCoords ()\n{\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n   texCoords [0] = texCoord0;\n   #endif\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n   texCoords [1] = texCoord1;\n   #endif\n   #if X3D_NUM_TEXTURE_COORDINATES > 2\n   texCoords [2] = texCoord2;\n   #endif\n   #if X3D_NUM_TEXTURE_COORDINATES > 3\n   texCoords [3] = texCoord3;\n   #endif\n}\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   switch (mode)\n   {\n      case x3d_None:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * texCoords [textureCoordinateMapping];\n      }\n      case x3d_Sphere:\n      {\n         vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_CameraSpaceNormal:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (N, 1.0);\n      }\n      case x3d_CameraSpacePosition:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_CameraSpaceReflectionVector:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (reflect (normalize (vertex), -N), 1.0);\n      }\n      case x3d_SphereLocal:\n      {\n         vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_Coord:\n      {\n         return vec4 (localVertex, 1.0);\n      }\n      case x3d_CoordEye:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_Noise:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (localVertex * scale + translation), 1.0);\n      }\n      case x3d_NoiseEye:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (vertex * scale + translation), 1.0);\n      }\n      case x3d_SphereReflect:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n         float eta = textureCoordinateGenerator .parameter [0];\n\n         return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n      }\n      case x3d_SphereReflectLocal:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n         float eta = textureCoordinateGenerator .parameter [0];\n         vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n         return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n      }\n      default:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * texCoords [textureCoordinateMapping];\n      }\n   }\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord = getTexCoord (x3d_TextureCoordinateGenerator [textureCoordinateMapping], textureTransformMapping, textureCoordinateMapping);\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform int         x3d_TextureType [X3D_NUM_TEXTURES];\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform sampler3D   x3d_Texture3D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURES > 0\n      case 0:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [0], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [0], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [0], texCoord .stp);\n         #endif\n      #endif\n      #if X3D_NUM_TEXTURES > 1\n      case 1:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [1], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [1], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [1], texCoord .stp);\n         #endif\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (min (i, X3D_NUM_TEXTURE_TRANSFORMS - 1), min (i, X3D_NUM_TEXTURE_COORDINATES - 1));\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         switch (source)\n         {\n            case x3d_Diffuse:\n            {\n               arg1 = diffuseColor;\n               break;\n            }\n            case x3d_Specular:\n            {\n               arg1 = specularColor;\n               break;\n            }\n            case x3d_Factor:\n            {\n               arg1 = x3d_MultiTextureColor;\n               break;\n            }\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         switch (function)\n         {\n            case x3d_Complement:\n            {\n               arg1 = 1.0 - arg1;\n               break;\n            }\n            case x3d_AlphaReplicate:\n            {\n               arg1 .a = arg2 .a;\n               break;\n            }\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         switch (mode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .rgb;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .rgb = arg1 .rgb - arg2 .rgb;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .rgb = arg2 .rgb;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n\n         // Alpha\n\n         switch (alphaMode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .a = arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .a = arg1 .a + arg2 .a;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .a = arg1 .a + arg2 .a - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .a = arg1 .a - arg2 .a;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .a = arg2 .a;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_3D)\n         vec4 textureColor = texture (x3d_Texture3D [0], texCoord .stp);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = texture (x3d_TextureCube [0], texCoord .stp);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif // X3D_TEXTURE\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURE_PROJECTORS > 0\n      case 0:\n         return texture (x3d_ProjectiveTexture [0], texCoord);\n      #endif\n      #if X3D_NUM_TEXTURE_PROJECTORS > 1\n      case 1:\n         return texture (x3d_ProjectiveTexture [1], texCoord);\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalize p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n';n.set("assets/shaders/webgl2/include/Texture.glsl",by);const Sy=by,vy='\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   in vec3 x3d_LineStipple;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4  x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 x3d_TexCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         in vec4 x3d_TexCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         in vec4 x3d_TexCoord3;\n      #endif\n   #endif\n#endif\n\nin vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   out float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   out vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         out vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         out vec4 texCoord1;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 2\n         out vec4 texCoord2;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 3\n         out vec4 texCoord3;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   in  vec3 x3d_Normal;\n   out vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      out vec3 localNormal;\n   #endif\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   flat out float lengthSoFar;\n   flat out vec2  startPoint;\n   out vec2       midPoint;\n#endif\n\nout vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   out vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   out float depth;\n#endif\n\n// Main\n\n#pragma X3D include "Particle.glsl"\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      lengthSoFar = x3d_LineStipple .z;\n      startPoint  = x3d_LineStipple .xy;\n      midPoint    = x3d_LineStipple .xy;\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = getTexCoord (x3d_TexCoord0);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = getTexCoord (x3d_TexCoord1);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 2\n            texCoord2 = getTexCoord (x3d_TexCoord2);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 3\n            texCoord3 = getTexCoord (x3d_TexCoord3);\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n';n.set("assets/shaders/webgl2/include/Vertex.glsl",vy);const Ty=vy,Oy='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n';n.set("assets/shaders/webgl1/Default.vs",Oy);const Ey=Oy,Cy='\nprecision highp float;\nprecision highp int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nattribute vec4 x3d_Vertex;\nattribute vec3 x3d_Normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   attribute vec4 x3d_TexCoord0;\n#endif\n\nvarying vec3 vertex;\nvarying vec3 normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 texCoord0;\n#endif\n\n#pragma X3D include "include/PointSize.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = max (pointSize = getPointSize (vertex), 2.0);\n      #else\n         gl_PointSize = 2.0;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n   normal = x3d_Normal;\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      texCoord0 = x3d_TexCoord0;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl1/Pointing.vs",Cy);const Ny=Cy,Fy='\nprecision highp float;\nprecision highp int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nattribute vec4 x3d_Vertex;\n\nvarying vec3 vertex;\n\n#pragma X3D include "include/PointSize.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = max (pointSize = getPointSize (vertex), 2.0);\n      #else\n         gl_PointSize = 2.0;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl1/Depth.vs",Fy);const Iy=Fy,My='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n';n.set("assets/shaders/webgl1/Gouraud.vs",My);const Py=My,Dy='\n#extension GL_EXT_draw_buffers : enable\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nvarying vec3 vertex;\nvarying vec3 normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 texCoord0;\n#else\n   vec4 texCoord0 = vec4 (0.0, 0.0, 0.0, 1.0);\n#endif\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Point.glsl"\n\nuniform float x3d_Id;\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      if (getPointColor (vec4 (1.0)) .a < 0.5)\n         discard;\n\n      setPointTexCoords ();\n   #endif\n\n   gl_FragData [0] = vec4 (vertex, x3d_Id);\n   gl_FragData [1] = vec4 (normal, 0.0);\n   gl_FragData [2] = texCoord0;\n}\n';n.set("assets/shaders/webgl1/Pointing.fs",Dy);const Ry=Dy,Ay='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nvarying vec3 vertex;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Point.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      if (getPointColor (vec4 (1.0)) .a < 0.5)\n         discard;\n   #endif\n\n   gl_FragColor = vec4 (gl_FragCoord .z);\n}\n';n.set("assets/shaders/webgl1/Depth.fs",Ay);const Vy=Ay,Ly='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Gouraud.fs",Ly);const By=Ly,Uy='\n\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\n#extension GL_EXT_shader_texture_lod: enable\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture2D (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (textureCube (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture2D (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (textureCube (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture2D (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = textureCube (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture2D (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001 && light .shadowIntensity > 0.0)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/PBR.fs",Uy);const Xy=Uy,jy='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture2D (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * textureCube (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture2D (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * textureCube (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture2D (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * textureCube (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture2D (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * textureCube (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Phong.fs",jy);const ky=jy,zy='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Unlit.fs",zy);const Gy=zy,Hy='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n';n.set("assets/shaders/webgl2/Default.vs",Hy);const qy=Hy,Yy='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nin vec4 x3d_Vertex;\nin vec3 x3d_Normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 x3d_TexCoord0;\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   in vec3 x3d_LineStipple;\n#endif\n\nout vec3 vertex;\nout vec3 normal;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   out vec4 texCoord0;\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   flat out float lengthSoFar;\n   flat out vec2  startPoint;\n   out vec2       midPoint;\n#endif\n\n#pragma X3D include "include/Particle.glsl"\n#pragma X3D include "include/PointSize.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = max (pointSize = getPointSize (vertex), 2.0);\n      #else\n         gl_PointSize = 2.0;\n      #endif\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      lengthSoFar = x3d_LineStipple .z;\n      startPoint  = x3d_LineStipple .xy;\n      midPoint    = x3d_LineStipple .xy;\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n   normal = x3d_Normal;\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      texCoord0 = x3d_TexCoord0;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl2/Pointing.vs",Yy);const Wy=Yy,$y='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nin vec4 x3d_Vertex;\n\nout vec3 vertex;\n\n#pragma X3D include "include/Particle.glsl"\n#pragma X3D include "include/PointSize.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = max (pointSize = getPointSize (vertex), 2.0);\n      #else\n         gl_PointSize = 2.0;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl2/Depth.vs",$y);const Ky=$y,Jy='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nout vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   out vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n';n.set("assets/shaders/webgl2/Gouraud.vs",Jy);const Zy=Jy,Qy="#version 300 es\n\nprecision highp float;\n\nuniform vec4  viewport;\nuniform mat4  modelViewProjectionMatrix;\nuniform mat4  invModelViewProjectionMatrix;\nuniform float scale;\n\nin vec3 x3d_LineStipple0; in float x3d_FogDepth0; in vec4 x3d_Color0; in vec3 x3d_Normal0; in vec4 x3d_Vertex0;\nin vec3 x3d_LineStipple1; in float x3d_FogDepth1; in vec4 x3d_Color1; in vec3 x3d_Normal1; in vec4 x3d_Vertex1;\n\nout vec3 lineStipple0; out float fogDepth0; out vec4 color0; out vec3 normal0; out vec4 vertex0;\nout vec3 lineStipple1; out float fogDepth1; out vec4 color1; out vec3 normal1; out vec4 vertex1;\nout vec3 lineStipple2; out float fogDepth2; out vec4 color2; out vec3 normal2; out vec4 vertex2;\n\nvec3\nprojectPoint (const in vec4 point, const in mat4 modelViewProjectionMatrix, const in vec4 viewport)\n{\n   vec4 vin = modelViewProjectionMatrix * point;\n\n   vin .xyz = vin .xyz / (2.0 * vin .w) + 0.5;\n\n   return vec3 (vin .xy * viewport .zw + viewport .xy, vin .z);\n}\n\nvec4\nunProjectPoint (const in vec3 win, const in mat4 invModelViewProjection, const in vec4 viewport)\n{\n   vec4 vin = vec4 ((win .xy - viewport .xy) / viewport .zw * 2.0 - 1.0, 2.0 * win .z - 1.0, 1.0);\n\n   vin = invModelViewProjection * vin;\n\n   return vec4 (vin .xyz / vin .w, 1.0);\n}\n\nvoid\nmain ()\n{\n   vec3 projected0 = projectPoint (x3d_Vertex0, modelViewProjectionMatrix, viewport);\n   vec3 projected1 = projectPoint (x3d_Vertex1, modelViewProjectionMatrix, viewport);\n   vec2 direction  = normalize (projected1 .xy - projected0 .xy);\n   vec2 offset     = vec2 (-direction .y, direction .x) * scale;\n\n   // 0 - 3\n   // |  |\n   // 1 - 2\n\n   if (gl_InstanceID == 0)\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq1 = projected0 .xy - offset;\n      vec2 pq2 = projected1 .xy - offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p1 = unProjectPoint (vec3 (pq1 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; normal0 = x3d_Normal0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple0; fogDepth1 = x3d_FogDepth0; color1 = x3d_Color0; normal1 = x3d_Normal0; vertex1 = p1;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; normal2 = x3d_Normal1; vertex2 = p2;\n   }\n   else\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq2 = projected1 .xy - offset;\n      vec2 pq3 = projected1 .xy + offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p3 = unProjectPoint (vec3 (pq3 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; normal0 = x3d_Normal0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple1; fogDepth1 = x3d_FogDepth1; color1 = x3d_Color1; normal1 = x3d_Normal1; vertex1 = p2;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; normal2 = x3d_Normal1; vertex2 = p3;\n   }\n}\n";n.set("assets/shaders/webgl2/LineTransform.vs",Qy);const ew=Qy,tw='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nin vec3 vertex;\nin vec3 normal;\nin vec4 texCoord;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 texCoord0;\n#else\n   vec4 texCoord0 = vec4 (0.0, 0.0, 0.0, 1.0);\n#endif\n\nlayout(location = 0) out vec4 x3d_FragData0;\nlayout(location = 1) out vec4 x3d_FragData1;\nlayout(location = 2) out vec4 x3d_FragData2;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Point.glsl"\n#pragma X3D include "Stipple.glsl"\n\nuniform float x3d_Id;\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      if (getPointColor (vec4 (1.0)) .a < 0.5)\n         discard;\n\n      setPointTexCoords ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      stipple ();\n   #endif\n\n   x3d_FragData0 = vec4 (vertex, x3d_Id);\n   x3d_FragData1 = vec4 (normal, 0.0);\n   x3d_FragData2 = texCoord0;\n}\n';n.set("assets/shaders/webgl2/Pointing.fs",tw);const nw=tw,iw='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nin vec3 vertex;\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Point.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      if (getPointColor (vec4 (1.0)) .a < 0.5)\n         discard;\n   #endif\n\n   x3d_FragColor = vec4 (gl_FragCoord .z);\n}\n';n.set("assets/shaders/webgl2/Depth.fs",iw);const sw=iw,rw='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nin vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Gouraud.fs",rw);const ow=rw,aw="#version 300 es\n\nprecision highp float;\n\nvoid\nmain () { }\n";n.set("assets/shaders/webgl2/LineTransform.fs",aw);const lw=aw,uw='#version 300 es\n\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_3D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture3D, texCoord));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture3D, texCoord)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture3D, texCoord);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001 && light .shadowIntensity > 0.0)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/PBR.fs",uw);const hw=uw,cw='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_3D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * texture (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_3D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture3D, texCoord);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * texture (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_3D)\n         return specularParameter * texture (x3d_SpecularTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * texture (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_3D)\n         return shininess * texture (x3d_ShininessTexture .texture3D, texCoord) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * texture (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Phong.fs",cw);const dw=cw,pw='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Unlit.fs",pw);const gw={includes:{1:{ClipPlanes:xx,Colors:wx,Fog:Sx,Fragment:Tx,Hatch:Ex,Material:Nx,Normal:Ix,Perlin:Px,Point:Rx,PointSize:Vx,Shadow:Bx,SpotFactor:Xx,Texture:kx,Vertex:Gx},2:{ClipPlanes:qx,Colors:Wx,Fog:Kx,Fragment:Zx,Hatch:ey,Line2:ny,Material:sy,Normal:oy,Particle:ly,Perlin:hy,Point:dy,PointSize:gy,Shadow:my,Stipple:xy,SpotFactor:wy,Texture:Sy,Vertex:Ty}},vertex:{1:{Default:Ey,Pointing:Ny,Depth:Iy,Gouraud:Py},2:{Default:qy,Pointing:Wy,Depth:Ky,Gouraud:Zy,LineTransform:ew}},fragment:{1:{Pointing:Ry,Depth:Vy,Gouraud:By,PBR:Xy,Phong:ky,Unlit:Gy},2:{Pointing:nw,Depth:sw,Gouraud:ow,LineTransform:lw,PBR:hw,Phong:dw,Unlit:pw}}};n.set("x_ite/Browser/Shaders/Shaders",gw);const fw=gw,mw=/^\s*#pragma\s+X3D\s+include\s+".*?([^\/]+)\.glsl"\s*$/;function _w(e){this.includes=fw.includes[e.getVersion()],this.sourceFileNumbers={};for(const[e,t]of Object.getOwnPropertyNames(this.includes).entries())this.sourceFileNumbers[t]=e+1}Object.assign(_w.prototype,{getSourceFileName(e){return Object.getOwnPropertyNames(this.includes)[e-1]},process(e,t=0){const n=e.split("\n");e="";for(let i=0,s=n.length;i<s;++i){const s=n[i],r=s.match(mw);r?(e+="#line 1 "+this.sourceFileNumbers[r[1]]+"\n",e+=this.process(this.includes[r[1]],this.sourceFileNumbers[r[1]]),e+="\n",e+="#line "+(i+2)+" "+t+"\n"):(e+=s,e+="\n")}return e}});const xw=_w;n.set("x_ite/Browser/Shaders/ShaderCompiler",xw);const yw=xw;var ww=i(666);const bw=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D","X3D_FOG","X3D_STYLE_PROPERTIES","X3D_UNLIT_MATERIAL","X3D_MATERIAL","X3D_LIGHTING","X3D_TEXTURE","X3D_MULTI_TEXTURING"];function Sw(e){vs.call(this,e),Rr.call(this,e),this.addType(c.ShaderPart),this.options=[]}Object.assign(Object.setPrototypeOf(Sw.prototype,vs.prototype),Rr.prototype,{initialize(){vs.prototype.initialize.call(this),Rr.prototype.initialize.call(this),this.isPrivate()||(this.options=bw.slice()),this._type.addInterest("set_type__",this),this.requestImmediateLoad().catch(Function.prototype)},set_type__(){this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad().catch(Function.prototype)},getSourceText(){return this._url},getOptions(){return this.options},setOptions(e){this.options=e},getShader(){return this.shader},getShaderType:function(){const e=new Map([["VERTEX","VERTEX_SHADER"],["TESS_CONTROL","TESS_CONTROL_SHADER"],["TESS_EVALUATION","TESS_EVALUATION_SHADER"],["GEOMETRY","GEOMETRY_SHADER"],["FRAGMENT","FRAGMENT_SHADER"],["COMPUTE","COMPUTE_SHADER"]]);return function(){return e.get(this._type.getValue())||"VERTEX_SHADER"}}(),unloadData(){this.valid=!1},loadData(){new hh(this).loadDocument(this._url,function(e,t){if(null===e)this.setLoadState(c.FAILED_STATE);else{const n=this.getBrowser(),i=n.getContext(),s=this.getShaderType(),r=["X3D_"+s].concat(this.options),o=new yw(i),a=mx.getSource(i,n,o.process(ww.decodeText(e)),r),l=i.createShader(i[s]);if(i.deleteShader(this.shader),this.shader=l,i.shaderSource(l,a),i.compileShader(l),!i.getShaderParameter(l,i.COMPILE_STATUS)){const e=this.getTypeName(),n=this.getName(),s=i.getShaderInfoLog(l),r=s.match(/(\d+):(\d+)/);if(r){const i=o.getSourceFileName(r[1])||t||this.getExecutionContext().getWorldURL();throw new Error("Error in "+e+" '"+n+"' in URL '"+i+"', line "+r[2]+", "+s)}{const i=t||this.getExecutionContext().getWorldURL();throw new Error("Error in "+e+" '"+n+"' in URL '"+i+"', "+s)}}this.setLoadState(c.COMPLETE_STATE)}}.bind(this))},dispose(){Rr.prototype.dispose.call(this),vs.prototype.dispose.call(this)}}),Object.defineProperties(Sw,{typeName:{value:"ShaderPart",enumerable:!0},componentName:{value:"Shaders",enumerable:!0},containerField:{value:"parts",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.initializeOnly,"type",new Qi.SFString("VERTEX")),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600))]),enumerable:!0}});const vw=Sw;n.set("x_ite/Components/Shaders/ShaderPart",vw);const Tw=vw;function Ow(e){vs.call(this,e),Rr.call(this,e),D_.call(this,e),this.addType(c.ShaderProgram)}Object.assign(Object.setPrototypeOf(Ow.prototype,vs.prototype),Rr.prototype,D_.prototype,{getSourceText(){return this._url},requestImmediateLoad(e=!0){},initialize(){vs.prototype.initialize.call(this),Rr.prototype.initialize.call(this),D_.prototype.initialize.call(this)},dispose(){D_.prototype.dispose.call(this),Rr.prototype.dispose.call(this),vs.prototype.dispose.call(this)}}),Object.defineProperties(Ow,{typeName:{value:"ShaderProgram",enumerable:!0},componentName:{value:"Shaders",enumerable:!0},containerField:{value:"programs",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.initializeOnly,"type",new Qi.SFString("VERTEX")),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600))]),enumerable:!0}});const Ew=Ow;n.set("x_ite/Components/Shaders/ShaderProgram",Ew);const Cw={name:"Shaders",concreteNodes:[V_,k_,H_,W_,J_,ex,Tw,Ew],abstractNodes:[D_,N_,U_]};n.set("x_ite/Components/Shaders",Cw);const Nw=Cw;function Fw(e){Bl.call(this,e),this.addType(c.AcousticProperties)}Object.setPrototypeOf(Fw.prototype,Bl.prototype),Object.defineProperties(Fw,{typeName:{value:"AcousticProperties",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"AcousticProperties",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"absorption",new Qi.SFFloat),new H(c.inputOutput,"refraction",new Qi.SFFloat),new H(c.inputOutput,"diffuse",new Qi.SFFloat),new H(c.inputOutput,"specular",new Qi.SFFloat)]),enumerable:!0}});const Iw=Fw;n.set("x_ite/Components/Shape/AcousticProperties",Iw);const Mw=Iw;function Pw(e){vs.call(this,e),this.addType(c.X3DAppearanceNode),this.addChildObjects("transparent",new Qi.SFBool),this._transparent.setAccessType(c.outputOnly)}Object.assign(Object.setPrototypeOf(Pw.prototype,vs.prototype),{setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()}}),Object.defineProperties(Pw,{typeName:{value:"X3DAppearanceNode",enumerable:!0},componentName:{value:"Shape",enumerable:!0}});const Dw=Pw;n.set("x_ite/Components/Shape/X3DAppearanceNode",Dw);const Rw=Dw;var Aw=i(666);function Vw(e){Rw.call(this,e),this.addType(c.Appearance),this.stylePropertiesNode=[],this.textureTransformMapping=new Map,this.textureBits=new Ml,this.shaderNodes=[]}Object.assign(Object.setPrototypeOf(Vw.prototype,Rw.prototype),{initialize(){Rw.prototype.initialize.call(this);this.getBrowser().getRenderingProperties()._ContentScale.addInterest("set_contentScale__",this),this._alphaMode.addInterest("set_alphaMode__",this),this._alphaCutoff.addInterest("set_alphaCutoff__",this),this._pointProperties.addInterest("set_pointProperties__",this),this._lineProperties.addInterest("set_lineProperties__",this),this._fillProperties.addInterest("set_fillProperties__",this),this._material.addInterest("set_material__",this),this._backMaterial.addInterest("set_backMaterial__",this),this._texture.addInterest("set_texture__",this),this._textureTransform.addInterest("set_textureTransform__",this),this._shaders.addInterest("set_shaders__",this),this._blendMode.addInterest("set_blendMode__",this),this._alphaMode.addInterest("set_transparent__",this),this._fillProperties.addInterest("set_transparent__",this),this._material.addInterest("set_transparent__",this),this._texture.addInterest("set_transparent__",this),this._blendMode.addInterest("set_transparent__",this),this.set_alphaMode__(),this.set_pointProperties__(),this.set_lineProperties__(),this.set_fillProperties__(),this.set_material__(),this.set_backMaterial__(),this.set_texture__(),this.set_textureTransform__(),this.set_shaders__(),this.set_blendMode__(),this.set_transparent__()},getAlphaMode(){return this.alphaMode},getNormalizedAlphaMode(e){return this.alphaMode||(e?Ol.BLEND:Ol.OPAQUE)},getAlphaCutoff(){return this.alphaCutoff},getStyleProperties(e){return this.stylePropertiesNode[e]},getPointProperties(){return this.stylePropertiesNode[0]},getLineProperties(){return this.stylePropertiesNode[1]},getFillProperties(){return this.stylePropertiesNode[2]},getMaterial(){return this.materialNode},getBackMaterial(){return this.backMaterialNode},getTexture(){return this.textureNode},getTextureBits(){return this.textureBits},updateTextureBits(){this.textureBits.clear(),this.textureNode.updateTextureBits(this.textureBits)},getTextureTransform(){return this.textureTransformNode},getTextureTransformMapping(){return this.textureTransformMapping},getShader(e,t){return this.materialNode.getShader(e,t)},getBackShader(e,t){return this.backMaterialNode.getShader(e,t)},getBlendMode(){return this.blendModeNode},set_contentScale__(){this.set_pointProperties__(),this.set_applied__()},set_alphaMode__(){this.alphaMode=Aw.enum(Ol,this._alphaMode.getValue(),Ol.AUTO),this.set_alphaCutoff__()},set_alphaCutoff__(){this.alphaCutoff=this.alphaMode===Ol.MASK?this._alphaCutoff.getValue():0},set_pointProperties__(){if(this.stylePropertiesNode[0]=zl(c.PointProperties,this._pointProperties),!this.stylePropertiesNode[0]){const e=this.getBrowser();1!==e.getRenderingProperty("ContentScale")&&(this.stylePropertiesNode[0]=e.getDefaultPointProperties())}},set_lineProperties__(){this.linePropertiesNode&&this.linePropertiesNode._applied.removeInterest("set_applied__",this),this.linePropertiesNode=zl(c.LineProperties,this._lineProperties),this.linePropertiesNode&&this.linePropertiesNode._applied.addInterest("set_applied__",this),this.set_applied__()},set_applied__(){if(this.linePropertiesNode&&this.linePropertiesNode._applied.getValue())this.stylePropertiesNode[1]=this.linePropertiesNode;else{const e=this.getBrowser();1!==e.getRenderingProperty("ContentScale")?this.stylePropertiesNode[1]=e.getDefaultLineProperties():this.stylePropertiesNode[1]=null}},set_fillProperties__(){this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.removeInterest("set_transparent__",this),this.stylePropertiesNode[2]=zl(c.FillProperties,this._fillProperties),this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.addInterest("set_transparent__",this),this.stylePropertiesNode[3]=this.stylePropertiesNode[2]},set_material__(){this.materialNode&&this.materialNode._transparent.removeInterest("set_transparent__",this),this.materialNode=zl(c.X3DMaterialNode,this._material),this.materialNode||(this.materialNode=this.getBrowser().getDefaultMaterial()),this.materialNode&&this.materialNode._transparent.addInterest("set_transparent__",this),zl(c.TwoSidedMaterial,this.materialNode)&&this.set_backMaterial__()},set_backMaterial__(){this.backMaterialNode&&this.backMaterialNode._transparent.removeInterest("set_transparent__",this),this.backMaterialNode=zl(c.X3DOneSidedMaterialNode,this._backMaterial),this.backMaterialNode&&this.backMaterialNode._transparent.addInterest("set_transparent__",this),!this.backMaterialNode&&zl(c.TwoSidedMaterial,this.materialNode)&&(this.backMaterialNode=this.materialNode)},set_texture__(){this.textureNode&&(this.textureNode.removeInterest("updateTextureBits",this),this.textureNode._transparent.removeInterest("set_transparent__",this)),this.textureNode=zl(c.X3DTextureNode,this._texture),this.textureNode?(this.textureNode.addInterest("updateTextureBits",this),this.textureNode._transparent.addInterest("set_transparent__",this),this.updateTextureBits()):this.textureBits.clear()},set_textureTransform__(){this.textureTransformNode&&this.textureTransformNode.removeInterest("updateTextureTransformMapping",this),this.textureTransformNode=zl(c.X3DTextureTransformNode,this._textureTransform),this.textureTransformNode||(this.textureTransformNode=this.getBrowser().getDefaultTextureTransform()),this.textureTransformNode.addInterest("updateTextureTransformMapping",this),this.updateTextureTransformMapping()},updateTextureTransformMapping(){this.textureTransformMapping.clear(),this.textureTransformNode.getTextureTransformMapping(this.textureTransformMapping)},set_shaders__(){const e=this.shaderNodes;for(const t of e)t._isValid.removeInterest("set_shader__",this);e.length=0;for(const t of this._shaders){const n=zl(c.X3DShaderNode,t);n&&e.push(n)}for(const t of e)t._isValid.addInterest("set_shader__",this);this.set_shader__()},set_shader__:function(){function e(){return this.shaderNode}return function(){const t=this.shaderNodes;this.shaderNode&&this.shaderNode.deselect(),this.shaderNode=null;for(const e of t)if(e._isValid.getValue()){this.shaderNode=e;break}this.shaderNode?(this.shaderNode.select(),this.getShader=e,this.getBackShader=e):(delete this.getShader,delete this.getBackShader)}}(),set_blendMode__(){this.blendModeNode=zl(c.BlendMode,this._blendMode)},set_transparent__(){switch(this.alphaMode){case Ol.AUTO:this.setTransparent(!!(this.stylePropertiesNode[3]?.isTransparent()||this.materialNode?.isTransparent()||this.backMaterialNode?.isTransparent()||this.textureNode?.isTransparent()||this.blendModeNode));break;case Ol.OPAQUE:case Ol.MASK:this.setTransparent(!1);break;case Ol.BLEND:this.setTransparent(!0)}},traverse(e,t){this.textureNode&&this.textureNode.traverse(e,t)}}),Object.defineProperties(Vw,{typeName:{value:"Appearance",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"appearance",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"alphaMode",new Qi.SFString("AUTO")),new H(c.inputOutput,"alphaCutoff",new Qi.SFFloat(.5)),new H(c.inputOutput,"pointProperties",new Qi.SFNode),new H(c.inputOutput,"lineProperties",new Qi.SFNode),new H(c.inputOutput,"fillProperties",new Qi.SFNode),new H(c.inputOutput,"material",new Qi.SFNode),new H(c.inputOutput,"backMaterial",new Qi.SFNode),new H(c.inputOutput,"texture",new Qi.SFNode),new H(c.inputOutput,"textureTransform",new Qi.SFNode),new H(c.inputOutput,"shaders",new Qi.MFNode),new H(c.inputOutput,"blendMode",new Qi.SFNode),new H(c.inputOutput,"acousticProperties",new Qi.SFNode)]),enumerable:!0}});const Lw=Vw;n.set("x_ite/Components/Shape/Appearance",Lw);const Bw=Lw;function Uw(e){Bl.call(this,e),this.addType(c.FillProperties),this.addChildObjects("transparent",new Qi.SFBool),this._transparent.setAccessType(c.outputOnly),this.hatchColor=new Float32Array(3)}Object.assign(Object.setPrototypeOf(Uw.prototype,Bl.prototype),{initialize(){Bl.prototype.initialize.call(this),this._filled.addInterest("set_filled__",this),this._hatched.addInterest("set_hatched__",this),this._hatchColor.addInterest("set_hatchColor__",this),this._hatchStyle.addInterest("set_hatchStyle__",this),this.set_filled__(),this.set_hatched__(),this.set_hatchColor__(),this.set_hatchStyle__(),this.getBrowser().getHatchStyleTexture(this.hatchStyle)},set_filled__(){this.filled=this._filled.getValue(),this.setTransparent(!this.filled)},set_hatched__(){this.hatched=this._hatched.getValue()},set_hatchColor__(){this.hatchColor[0]=this._hatchColor[0],this.hatchColor[1]=this._hatchColor[1],this.hatchColor[2]=this._hatchColor[2]},set_hatchStyle__(){let e=this._hatchStyle.getValue();(e<1||e>19)&&(e=1),this.hatchStyle=e},setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()},setShaderUniforms(e,t){const n=this.hatched;if(e.uniform1i(t.x3d_FillPropertiesFilled,this.filled),e.uniform1i(t.x3d_FillPropertiesHatched,n),n){const n=this.getBrowser(),i=n.getHatchStyleTexture(this.hatchStyle),s=n.getTexture2DUnit();e.uniform3fv(t.x3d_FillPropertiesHatchColor,this.hatchColor),e.uniform1f(t.x3d_FillPropertiesScale,n.getRenderingProperty("ContentScale")),e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,i.getTexture()),e.uniform1i(t.x3d_FillPropertiesTexture,s)}}}),Object.defineProperties(Uw,{typeName:{value:"FillProperties",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"fillProperties",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"filled",new Qi.SFBool(!0)),new H(c.inputOutput,"hatched",new Qi.SFBool(!0)),new H(c.inputOutput,"hatchColor",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"hatchStyle",new Qi.SFInt32(1))]),enumerable:!0}});const Xw=Uw;n.set("x_ite/Components/Shape/FillProperties",Xw);const jw=Xw;function kw(e){Bl.call(this,e),this.addType(c.LineProperties)}Object.assign(Object.setPrototypeOf(kw.prototype,Bl.prototype),{initialize(){Bl.prototype.initialize.call(this);this.getBrowser().getRenderingProperties()._ContentScale.addInterest("set_linewidthScaleFactor__",this),this._applied.addInterest("set_applied__",this),this._linetype.addInterest("set_linetype__",this),this._linewidthScaleFactor.addInterest("set_linewidthScaleFactor__",this),this.set_applied__(),this.set_linetype__(),this.set_linewidthScaleFactor__(),this.getBrowser().getLinetypeTexture()},getApplied(){return this.applied},getLinetype(){return this.linetype},getLinewidthScaleFactor(){return this.linewidthScaleFactor},getTransformLines(){return this.transformLines},set_applied__(){this.applied=this._applied.getValue()},set_linetype__(){let e=this._linetype.getValue();(e<1||e>16)&&(e=1),this.linetype=e},set_linewidthScaleFactor__(){const e=this.getBrowser(),t=e.getContext(),n=e.getRenderingProperty("ContentScale");this.linewidthScaleFactor=Math.max(1,this._linewidthScaleFactor.getValue())*n,this.transformLines=t.HAS_FEATURE_TRANSFORMED_LINES&&this.linewidthScaleFactor>1},setShaderUniforms(e,t){const n=this.getBrowser();if(this.applied){const i=n.getTexture2DUnit();e.lineWidth(this.linewidthScaleFactor),e.uniform1i(t.x3d_LinePropertiesLinetype,this.linetype),e.uniform1f(t.x3d_LineStippleScale,n.getLineStippleScale()),e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,n.getLinetypeTexture().getTexture()),e.uniform1i(t.x3d_LinePropertiesTexture,i)}else e.lineWidth(n.getRenderingProperty("ContentScale")),e.uniform1i(t.x3d_LinePropertiesLinetype,16),e.uniform1f(t.x3d_LineStippleScale,1)}}),Object.defineProperties(kw,{typeName:{value:"LineProperties",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"lineProperties",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"applied",new Qi.SFBool(!0)),new H(c.inputOutput,"linetype",new Qi.SFInt32(1)),new H(c.inputOutput,"linewidthScaleFactor",new Qi.SFFloat)]),enumerable:!0}});const zw=kw;n.set("x_ite/Components/Shape/LineProperties",zw);const Gw=zw;function Hw(e){Bl.call(this,e),this.addType(c.X3DMaterialNode),this.addChildObjects("transparent",new Qi.SFBool),this._transparent.setAccessType(c.outputOnly),this.textureBits=new Ml,this.shaderNodes=this.getBrowser().getShaders()}Object.assign(Object.setPrototypeOf(Hw.prototype,Bl.prototype),{initialize(){Bl.prototype.initialize.call(this),this.getBrowser().getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()},getBaseTexture:()=>null,setTexture(e,t){const n=t?t.getTextureType()-1:0;this.textureBits.set(2*e+0,1&n),this.textureBits.set(2*e+1,2&n)},getTextureBits(){return this.textureBits},getShader(e,t){let n="";if(n+=this.textureBits.toString(4),n+=".",n+=e.geometryKey,t){const{renderObject:i,transparent:s,shadows:r,fogNode:o,shapeNode:a,appearanceNode:l,textureNode:u,objectsCount:h}=t;n+=this.logarithmicDepthBuffer||i.getViewpoint().getLogarithmicDepthBuffer()?1:0,n+=l.getNormalizedAlphaMode(s),n+=this.getMaterialKey(r),n+=r?1:0,n+=o?.getFogType()??0,n+=a.getShapeKey(),n+=l.getStyleProperties(e.geometryType)?1:0,n+=l.getTextureTransformMapping().size||1,n+=e.textureCoordinateMapping.size||1,n+=".",n+=h[0],n+=".",n+=h[1],n+=".",n+=h[2],n+=".",n+=u?1:l.getTextureBits().toString(4)}else{const{textureNode:t,objectsCount:i}=e;n+=this.logarithmicDepthBuffer?1:0,n+=e.alphaMode,n+=this.getMaterialKey(!1),n+="000011",n+=".",n+=i[0],n+=".",n+=i[1],n+=".",n+=i[2],n+=".",n+=t?1:0}return this.shaderNodes.get(n)??this.createShader(n,e,t)},getShaderOptions(e,t){const n=this.getBrowser(),i=[];if(i.push(`X3D_GEOMETRY_${e.geometryType}D`),e.hasFogCoords&&i.push("X3D_FOG_COORDS"),e.colorMaterial&&i.push("X3D_COLOR_MATERIAL"),e.hasNormals&&i.push("X3D_NORMALS"),t){const{renderObject:s,fogNode:r,shapeNode:o,appearanceNode:a,objectsCount:l}=t;switch((this.logarithmicDepthBuffer||s.getViewpoint().getLogarithmicDepthBuffer())&&i.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),a.getNormalizedAlphaMode(t.transparent)){case Ol.OPAQUE:i.push("X3D_ALPHA_MODE_OPAQUE");break;case Ol.MASK:i.push("X3D_ALPHA_MODE_MASK");break;case Ol.BLEND:i.push("X3D_ALPHA_MODE_BLEND")}switch(t.shadows&&i.push("X3D_SHADOWS","X3D_PCF_FILTERING"),r?.getFogType()){case 1:i.push("X3D_FOG","X3D_FOG_LINEAR");break;case 2:i.push("X3D_FOG","X3D_FOG_EXPONENTIAL")}if(l[0]&&(i.push("X3D_CLIP_PLANES"),i.push(`X3D_NUM_CLIP_PLANES ${Math.min(l[0],n.getMaxClipPlanes())}`)),l[1]&&(i.push("X3D_LIGHTING"),i.push(`X3D_NUM_LIGHTS ${Math.min(l[1],n.getMaxLights())}`)),l[2]&&(i.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),i.push(`X3D_NUM_TEXTURE_PROJECTORS ${Math.min(l[2],n.getMaxTextures())}`)),a.getStyleProperties(e.geometryType)&&i.push("X3D_STYLE_PROPERTIES"),+this.textureBits&&i.push("X3D_MATERIAL_TEXTURES"),t.textureNode)i.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D");else{if(+a.getTextureBits()&&!this.getBaseTexture()){const e=a.getTexture();i.push("X3D_TEXTURE"),i.push(`X3D_NUM_TEXTURES ${e.getCount()}`),e.getType().includes(c.MultiTexture)&&i.push("X3D_MULTI_TEXTURING"),e.getShaderOptions(i)}i.push(`X3D_NUM_TEXTURE_TRANSFORMS ${a.getTextureTransformMapping().size||1}`),i.push(`X3D_NUM_TEXTURE_COORDINATES ${e.textureCoordinateMapping.size||1}`)}switch(o.getShapeKey()){case 1:i.push("X3D_PARTICLE_SYSTEM");break;case 2:i.push("X3D_PARTICLE_SYSTEM","X3D_TEX_COORD_RAMP")}}else{const{textureNode:t,objectsCount:s}=e;this.logarithmicDepthBuffer&&i.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),s[0]&&(i.push("X3D_CLIP_PLANES"),i.push(`X3D_NUM_CLIP_PLANES ${Math.min(s[0],n.getMaxClipPlanes())}`)),s[1]&&(i.push("X3D_LIGHTING"),i.push(`X3D_NUM_LIGHTS ${Math.min(s[1],n.getMaxLights())}`)),s[2]&&(i.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),i.push(`X3D_NUM_TEXTURE_PROJECTORS ${Math.min(s[2],n.getMaxTextures())}`)),t&&i.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D")}return i}}),Object.defineProperties(Hw,{typeName:{value:"X3DMaterialNode",enumerable:!0},componentName:{value:"Shape",enumerable:!0}});const qw=Hw;n.set("x_ite/Components/Shape/X3DMaterialNode",qw);const Yw=qw;function Ww(e){Yw.call(this,e),this.addType(c.X3DOneSidedMaterialNode),this.addChildObjects("textures",new Qi.SFTime),this.emissiveColor=new Float32Array(3)}Object.assign(Object.setPrototypeOf(Ww.prototype,Yw.prototype),{initialize(){Yw.prototype.initialize.call(this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._emissiveTexture.addInterest("set_emissiveTexture__",this),this._normalTexture.addInterest("set_normalTexture__",this),this._transparency.addInterest("set_transparency__",this),this._transparency.addInterest("set_transparent__",this),this.set_emissiveColor__(),this.set_emissiveTexture__(),this.set_normalTexture__(),this.set_transparency__()},set_emissiveColor__(){const e=this.emissiveColor,t=this._emissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_emissiveTexture__(){this.emissiveTextureNode=zl(c.X3DSingleTextureNode,this._emissiveTexture),this.setTexture(this.getTextureIndices().EMISSIVE_TEXTURE,this.emissiveTextureNode)},set_normalTexture__(){this.normalTextureNode=zl(c.X3DSingleTextureNode,this._normalTexture),this.setTexture(this.getTextureIndices().NORMAL_TEXTURE,this.normalTextureNode)},set_transparency__(){this.transparency=f.clamp(this._transparency.getValue(),0,1)},set_transparent__(){this.setTransparent(!!this.transparency)},getBaseTexture(){return this.getEmissiveTexture()},getEmissiveTexture(){return this.emissiveTextureNode},getNormalTexture(){return this.normalTextureNode},getTransparency(){return this.transparency},getTextureIndices:function(){let e=0;const t={EMISSIVE_TEXTURE:e++,NORMAL_TEXTURE:e++};return function(){return t}}(),getShaderOptions(e,t){const n=Yw.prototype.getShaderOptions.call(this,e,t);return+this.getTextureBits()&&(this.getEmissiveTexture()&&n.push("X3D_EMISSIVE_TEXTURE",`X3D_EMISSIVE_TEXTURE_${this.getEmissiveTexture().getTextureTypeString()}`),this.getNormalTexture()&&n.push("X3D_NORMAL_TEXTURE",`X3D_NORMAL_TEXTURE_${this.getNormalTexture().getTextureTypeString()}`)),n},setShaderUniforms(e,t,n,i,s){if(e.uniform3fv(t.x3d_EmissiveColor,this.emissiveColor),e.uniform1f(t.x3d_Transparency,this.transparency),+this.getTextureBits()){if(this.emissiveTextureNode){const r=this._emissiveTextureMapping.getValue(),o=t.x3d_EmissiveTexture;this.emissiveTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}if(this.normalTextureNode){const r=this._normalTextureMapping.getValue(),o=t.x3d_NormalTexture;e.uniform1f(t.x3d_NormalScale,Math.max(this._normalScale.getValue(),0)),this.normalTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}}}}),Object.defineProperties(Ww,{typeName:{value:"X3DOneSidedMaterialNode",enumerable:!0},componentName:{value:"Shape",enumerable:!0}});const $w=Ww;n.set("x_ite/Components/Shape/X3DOneSidedMaterialNode",$w);const Kw=$w;function Jw(e){Kw.call(this,e),this.addType(c.Material),e.getSpecificationVersion()<4&&(this.getMaterialKey=Zw),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3)}function Zw(e){return e||+this.getTextureBits()||this.getBrowser().getBrowserOptions().getShading()===xl.PHONG?"2":"1"}Object.assign(Object.setPrototypeOf(Jw.prototype,Kw.prototype),{initialize(){Kw.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._ambientTexture.addInterest("set_ambientTexture__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._diffuseTexture.addInterest("set_diffuseTexture__",this),this._specularColor.addInterest("set_specularColor__",this),this._specularTexture.addInterest("set_specularTexture__",this),this._shininess.addInterest("set_shininess__",this),this._shininessTexture.addInterest("set_shininessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_ambientIntensity__(),this.set_ambientTexture__(),this.set_diffuseColor__(),this.set_diffuseTexture__(),this.set_specularColor__(),this.set_specularTexture__(),this.set_shininess__(),this.set_shininessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_ambientIntensity__(){this.ambientIntensity=f.clamp(this._ambientIntensity.getValue(),0,1)},set_ambientTexture__(){this.ambientTextureNode=zl(c.X3DSingleTextureNode,this._ambientTexture),this.setTexture(this.getTextureIndices().AMBIENT_TEXTURE,this.ambientTextureNode)},set_diffuseColor__(){const e=this.diffuseColor,t=this._diffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_diffuseTexture__(){this.diffuseTextureNode&&this.diffuseTextureNode._transparent.removeInterest("set_transparent__",this),this.diffuseTextureNode=zl(c.X3DSingleTextureNode,this._diffuseTexture),this.diffuseTextureNode&&this.diffuseTextureNode._transparent.addInterest("set_transparent__",this),this.setTexture(this.getTextureIndices().DIFFUSE_TEXTURE,this.diffuseTextureNode)},set_specularColor__(){const e=this.specularColor,t=this._specularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_specularTexture__(){this.specularTextureNode=zl(c.X3DSingleTextureNode,this._specularTexture),this.setTexture(this.getTextureIndices().SPECULAR_TEXTURE,this.specularTextureNode)},set_shininess__(){this.shininess=f.clamp(this._shininess.getValue(),0,1)},set_shininessTexture__(){this.shininessTextureNode=zl(c.X3DSingleTextureNode,this._shininessTexture),this.setTexture(this.getTextureIndices().SHININESS_TEXTURE,this.shininessTextureNode)},set_occlusionStrength__(){this.occlusionStrength=f.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__(){this.occlusionTextureNode=zl(c.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__(){this.setTransparent(!(!this.getTransparency()&&!this.diffuseTextureNode?.isTransparent()))},getBaseTexture(){return this.diffuseTexture},getTextureIndices:function(){let e=0;const t={EMISSIVE_TEXTURE:e++,NORMAL_TEXTURE:e++,AMBIENT_TEXTURE:e++,DIFFUSE_TEXTURE:e++,SPECULAR_TEXTURE:e++,SHININESS_TEXTURE:e++,OCCLUSION_TEXTURE:e++};return function(){return t}}(),getMaterialKey:()=>"2",createShader(e,t,n){const i=this.getBrowser(),s=this.getShaderOptions(t,n);if(t.hasNormals)switch(s.push("X3D_MATERIAL"),+this.getTextureBits()&&(this.ambientTextureNode&&s.push("X3D_AMBIENT_TEXTURE",`X3D_AMBIENT_TEXTURE_${this.ambientTextureNode.getTextureTypeString()}`),this.diffuseTextureNode&&s.push("X3D_DIFFUSE_TEXTURE",`X3D_DIFFUSE_TEXTURE_${this.diffuseTextureNode.getTextureTypeString()}`),this.specularTextureNode&&s.push("X3D_SPECULAR_TEXTURE",`X3D_SPECULAR_TEXTURE_${this.specularTextureNode.getTextureTypeString()}`),this.shininessTextureNode&&s.push("X3D_SHININESS_TEXTURE",`X3D_SHININESS_TEXTURE_${this.shininessTextureNode.getTextureTypeString()}`),this.occlusionTextureNode&&s.push("X3D_OCCLUSION_TEXTURE",`X3D_OCCLUSION_TEXTURE_${this.occlusionTextureNode.getTextureTypeString()}`)),this.getMaterialKey(n&&n.shadows)){case"1":var r=i.createShader("GouraudShader","Gouraud","Gouraud",s);break;case"2":r=i.createShader("PhongShader","Default","Phong",s)}else{s.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",s);i.getShaders().set(e.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(e,r),r},setShaderUniforms(e,t,n,i,s){if(Kw.prototype.setShaderUniforms.call(this,e,t,n,i,s),e.uniform1f(t.x3d_AmbientIntensity,this.ambientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.diffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.specularColor),e.uniform1f(t.x3d_Shininess,this.shininess),+this.getTextureBits()){if(this.ambientTextureNode){const r=this._ambientTextureMapping.getValue(),o=t.x3d_AmbientTexture;this.ambientTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}if(this.diffuseTextureNode){const r=this._diffuseTextureMapping.getValue(),o=t.x3d_DiffuseTexture;this.diffuseTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}if(this.specularTextureNode){const r=this._specularTextureMapping.getValue(),o=t.x3d_SpecularTexture;this.specularTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}if(this.shininessTextureNode){const r=this._shininessTextureMapping.getValue(),o=t.x3d_ShininessTexture;this.shininessTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}if(this.occlusionTextureNode){const r=this._occlusionTextureMapping.getValue(),o=t.x3d_OcclusionTexture;e.uniform1f(t.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}}}}),Object.defineProperties(Jw,{typeName:{value:"Material",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"material",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"ambientIntensity",new Qi.SFFloat(.2)),new H(c.inputOutput,"ambientTextureMapping",new Qi.SFString),new H(c.inputOutput,"ambientTexture",new Qi.SFNode),new H(c.inputOutput,"diffuseColor",new Qi.SFColor(.8,.8,.8)),new H(c.inputOutput,"diffuseTextureMapping",new Qi.SFString),new H(c.inputOutput,"diffuseTexture",new Qi.SFNode),new H(c.inputOutput,"specularColor",new Qi.SFColor),new H(c.inputOutput,"specularTextureMapping",new Qi.SFString),new H(c.inputOutput,"specularTexture",new Qi.SFNode),new H(c.inputOutput,"emissiveColor",new Qi.SFColor),new H(c.inputOutput,"emissiveTextureMapping",new Qi.SFString),new H(c.inputOutput,"emissiveTexture",new Qi.SFNode),new H(c.inputOutput,"shininess",new Qi.SFFloat(.2)),new H(c.inputOutput,"shininessTextureMapping",new Qi.SFString),new H(c.inputOutput,"shininessTexture",new Qi.SFNode),new H(c.inputOutput,"occlusionStrength",new Qi.SFFloat(1)),new H(c.inputOutput,"occlusionTextureMapping",new Qi.SFString),new H(c.inputOutput,"occlusionTexture",new Qi.SFNode),new H(c.inputOutput,"normalScale",new Qi.SFFloat(1)),new H(c.inputOutput,"normalTextureMapping",new Qi.SFString),new H(c.inputOutput,"normalTexture",new Qi.SFNode),new H(c.inputOutput,"transparency",new Qi.SFFloat)]),enumerable:!0}});const Qw=Jw;n.set("x_ite/Components/Shape/Material",Qw);const eb=Qw;function tb(e){Kw.call(this,e),this.addType(c.PhysicalMaterial),this.baseColor=new Float32Array(3)}Object.assign(Object.setPrototypeOf(tb.prototype,Kw.prototype),{initialize(){Kw.prototype.initialize.call(this),this._baseColor.addInterest("set_baseColor__",this),this._baseTexture.addInterest("set_baseTexture__",this),this._metallic.addInterest("set_metallic__",this),this._roughness.addInterest("set_roughness__",this),this._metallicRoughnessTexture.addInterest("set_metallicRoughnessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_baseColor__(),this.set_baseTexture__(),this.set_metallic__(),this.set_roughness__(),this.set_metallicRoughnessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_baseColor__(){const e=this.baseColor,t=this._baseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_baseTexture__(){this.baseTextureNode&&this.baseTextureNode._transparent.removeInterest("set_transparent__",this),this.baseTextureNode=zl(c.X3DSingleTextureNode,this._baseTexture),this.setTexture(this.getTextureIndices().BASE_TEXTURE,this.baseTextureNode),this.baseTextureNode&&this.baseTextureNode._transparent.addInterest("set_transparent__",this)},set_metallic__(){this.metallic=f.clamp(this._metallic.getValue(),0,1)},set_roughness__(){this.roughness=f.clamp(this._roughness.getValue(),0,1)},set_metallicRoughnessTexture__(){this.metallicRoughnessTextureNode=zl(c.X3DSingleTextureNode,this._metallicRoughnessTexture),this.setTexture(this.getTextureIndices().METALLIC_ROUGHNESS_TEXTURE,this.metallicRoughnessTextureNode)},set_occlusionStrength__(){this.occlusionStrength=f.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__(){this.occlusionTextureNode=zl(c.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__(){this.setTransparent(!(!this.getTransparency()&&!this.baseTextureNode?.isTransparent()))},getBaseTexture(){return this.baseTextureNode},getTextureIndices:function(){let e=0;const t={EMISSIVE_TEXTURE:e++,NORMAL_TEXTURE:e++,BASE_TEXTURE:e++,METALLIC_ROUGHNESS_TEXTURE:e++,OCCLUSION_TEXTURE:e++};return function(){return t}}(),getMaterialKey:()=>"3",createShader(e,t,n){const i=this.getBrowser(),s=this.getShaderOptions(t,n);if(t.hasNormals){s.push("X3D_PHYSICAL_MATERIAL","MANUAL_SRGB"),+this.getTextureBits()&&(this.baseTextureNode&&s.push("X3D_BASE_TEXTURE",`X3D_BASE_TEXTURE_${this.baseTextureNode.getTextureTypeString()}`),this.metallicRoughnessTextureNode&&s.push("X3D_METALLIC_ROUGHNESS_TEXTURE",`X3D_METALLIC_ROUGHNESS_TEXTURE_${this.metallicRoughnessTextureNode.getTextureTypeString()}`),this.occlusionTextureNode&&s.push("X3D_OCCLUSION_TEXTURE",`X3D_OCCLUSION_TEXTURE_${this.occlusionTextureNode.getTextureTypeString()}`));var r=i.createShader("PhysicalMaterialShader","Default","PBR",s)}else{s.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",s);i.getShaders().set(e.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(e,r),r},setShaderUniforms(e,t,n,i,s){if(Kw.prototype.setShaderUniforms.call(this,e,t,n,i,s),e.uniform3fv(t.x3d_BaseColor,this.baseColor),e.uniform1f(t.x3d_Metallic,this.metallic),e.uniform1f(t.x3d_Roughness,this.roughness),+this.getTextureBits()){if(this.baseTextureNode){const r=this._baseTextureMapping.getValue(),o=t.x3d_BaseTexture;this.baseTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}if(this.metallicRoughnessTextureNode){const r=this._metallicRoughnessTextureMapping.getValue(),o=t.x3d_MetallicRoughnessTexture;this.metallicRoughnessTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}if(this.occlusionTextureNode){const r=this._occlusionTextureMapping.getValue(),o=t.x3d_OcclusionTexture;e.uniform1f(t.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(e,t,n,o),e.uniform1i(o.textureTransformMapping,i.get(r)??0),e.uniform1i(o.textureCoordinateMapping,s.get(r)??0)}}}}),Object.defineProperties(tb,{typeName:{value:"PhysicalMaterial",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"material",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"baseColor",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"baseTextureMapping",new Qi.SFString),new H(c.inputOutput,"baseTexture",new Qi.SFNode),new H(c.inputOutput,"emissiveColor",new Qi.SFColor(0,0,0)),new H(c.inputOutput,"emissiveTextureMapping",new Qi.SFString),new H(c.inputOutput,"emissiveTexture",new Qi.SFNode),new H(c.inputOutput,"metallic",new Qi.SFFloat(1)),new H(c.inputOutput,"roughness",new Qi.SFFloat(1)),new H(c.inputOutput,"metallicRoughnessTextureMapping",new Qi.SFString),new H(c.inputOutput,"metallicRoughnessTexture",new Qi.SFNode),new H(c.inputOutput,"occlusionStrength",new Qi.SFFloat(1)),new H(c.inputOutput,"occlusionTextureMapping",new Qi.SFString),new H(c.inputOutput,"occlusionTexture",new Qi.SFNode),new H(c.inputOutput,"normalScale",new Qi.SFFloat(1)),new H(c.inputOutput,"normalTextureMapping",new Qi.SFString),new H(c.inputOutput,"normalTexture",new Qi.SFNode),new H(c.inputOutput,"transparency",new Qi.SFFloat)]),enumerable:!0}});const nb=tb;n.set("x_ite/Components/Shape/PhysicalMaterial",nb);const ib=nb;function sb(e){Bl.call(this,e),this.addType(c.PointProperties),this.attenuation=new Float32Array(3)}Object.assign(Object.setPrototypeOf(sb.prototype,Bl.prototype),{initialize(){Bl.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getContext();this.pointSizeRange=t.getParameter(t.ALIASED_POINT_SIZE_RANGE),e.getRenderingProperties()._ContentScale.addInterest("set_contentScale__",this),this._pointSizeScaleFactor.addInterest("set_pointSizeScaleFactor__",this),this._pointSizeMinValue.addInterest("set_pointSizeMinValue__",this),this._pointSizeMaxValue.addInterest("set_pointSizeMaxValue__",this),this._attenuation.addInterest("set_attenuation__",this),this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__(),this.set_attenuation__()},set_contentScale__(){this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__()},set_pointSizeScaleFactor__(){const e=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeScaleFactor=Math.max(this._pointSizeScaleFactor.getValue(),0)*e},set_pointSizeMinValue__(){const e=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeMinValue=f.clamp(this._pointSizeMinValue.getValue(),0,this.pointSizeRange[1])*e},set_pointSizeMaxValue__(){const e=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeMaxValue=f.clamp(this._pointSizeMaxValue.getValue(),0,this.pointSizeRange[1])*e},set_attenuation__(){const e=this._attenuation.length;this.attenuation[0]=e>0?Math.max(0,this._attenuation[0]):1,this.attenuation[1]=e>1?Math.max(0,this._attenuation[1]):0,this.attenuation[2]=e>2?Math.max(0,this._attenuation[2]):0},setShaderUniforms(e,t){e.uniform1f(t.x3d_PointPropertiesPointSizeScaleFactor,this.pointSizeScaleFactor),e.uniform1f(t.x3d_PointPropertiesPointSizeMinValue,this.pointSizeMinValue),e.uniform1f(t.x3d_PointPropertiesPointSizeMaxValue,this.pointSizeMaxValue),e.uniform3fv(t.x3d_PointPropertiesAttenuation,this.attenuation)}}),Object.defineProperties(sb,{typeName:{value:"PointProperties",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"pointProperties",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"pointSizeScaleFactor",new Qi.SFFloat(1)),new H(c.inputOutput,"pointSizeMinValue",new Qi.SFFloat(1)),new H(c.inputOutput,"pointSizeMaxValue",new Qi.SFFloat(1)),new H(c.inputOutput,"attenuation",new Qi.MFFloat(1,0,0))]),enumerable:!0}});const rb=sb;n.set("x_ite/Components/Shape/PointProperties",rb);const ob=rb;function ab(e){Ys.call(this,e),Uu.call(this,e),this.addType(c.X3DShapeNode),this.bbox=new La,this.bboxSize=new Et(0,0,0),this.bboxCenter=new Et(0,0,0)}Object.assign(Object.setPrototypeOf(ab.prototype,Ys.prototype),Uu.prototype,{initialize(){Ys.prototype.initialize.call(this),Uu.prototype.initialize.call(this),this._bboxSize.addInterest("set_bbox__",this),this._bboxCenter.addInterest("set_bbox__",this),this._appearance.addInterest("set_appearance__",this),this._geometry.addInterest("set_geometry__",this),this._appearance.addInterest("set_transparent__",this),this._geometry.addInterest("set_transparent__",this),this.set_appearance__(),this.set_geometry__(),this.set_transparent__()},getBBox(e,t){return t?this._castShadow.getValue()?e.assign(this.bbox):e.set():e.assign(this.bbox)},getBBoxSize(){return this.bboxSize},getBBoxCenter(){return this.bboxCenter},getAppearance(){return this.appearanceNode},getGeometry(){return this.geometryNode},setTransparent(e){this.transparent=e},isTransparent(){return this.transparent},set_bbox__(){this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.getGeometry()?this.bbox.assign(this.getGeometry().getBBox()):this.bbox.set():this.bbox.set(this._bboxSize.getValue(),this._bboxCenter.getValue()),this.bboxSize.assign(this.bbox.size),this.bboxCenter.assign(this.bbox.center)},set_appearance__(){this.appearanceNode&&this.appearanceNode._transparent.removeInterest("set_transparent__",this),this.appearanceNode=zl(c.X3DAppearanceNode,this._appearance),this.appearanceNode?(this.appearanceNode._alphaMode.addInterest("set_transparent__",this),this.appearanceNode._transparent.addInterest("set_transparent__",this)):this.appearanceNode=this.getBrowser().getDefaultAppearance()},set_geometry__(){this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.geometryNode=zl(c.X3DGeometryNode,this._geometry),this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.set_bbox__()},set_transparent__(){this.appearanceNode.getAlphaMode()===Ol.AUTO?this.transparent=!(!this.appearanceNode.isTransparent()&&!this.geometryNode?.isTransparent()):this.transparent=this.appearanceNode.isTransparent()},dispose(){Uu.prototype.dispose.call(this),Ys.prototype.dispose.call(this)}}),Object.defineProperties(ab,{typeName:{value:"X3DShapeNode",enumerable:!0},componentName:{value:"Shape",enumerable:!0}});const lb=ab;n.set("x_ite/Components/Shape/X3DShapeNode",lb);const ub=lb;function hb(e){ub.call(this,e),this.addType(c.Shape)}Object.assign(Object.setPrototypeOf(hb.prototype,ub.prototype),{initialize(){ub.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this.set_transformSensors__()},getShapeKey:()=>0,getGeometryContext:ub.prototype.getGeometry,set_geometry__(){ub.prototype.set_geometry__.call(this),this.getGeometry()?delete this.traverse:this.traverse=Function.prototype},set_transformSensors__(){this.setPickableObject(this.getTransformSensors().size)},intersectsBox(e,t,n){return this.getGeometry().intersectsBox(e,t,n)},traverse(e,t){switch(e){case Na.POINTER:t.addPointingShape(this);break;case Na.PICKING:this.picking(t);break;case Na.COLLISION:t.addCollisionShape(this);break;case Na.SHADOW:this._castShadow.getValue()&&t.addShadowShape(this);break;case Na.DISPLAY:t.addDisplayShape(this)&&this.getAppearance().traverse(e,t)}this.getGeometry().traverse(e,t)},picking(e){const t=e.getModelViewMatrix().get();if(this.getTransformSensors().size)for(const e of this.getTransformSensors())e.collect(t);const n=this.getBrowser(),i=n.getPickSensors(),s=n.getPickingHierarchy();s.push(this);for(const e of i.at(-1))e.collect(this.getGeometry(),t,s);s.pop()},displaySimple(e,t,n){this.getGeometry().displaySimple(e,t,n)},display(e,t){this.getGeometry().display(e,t)}}),Object.defineProperties(hb,{typeName:{value:"Shape",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"visible",new Qi.SFBool(!0)),new H(c.inputOutput,"castShadow",new Qi.SFBool(!0)),new H(c.inputOutput,"bboxDisplay",new Qi.SFBool),new H(c.initializeOnly,"bboxSize",new Qi.SFVec3f(-1,-1,-1)),new H(c.initializeOnly,"bboxCenter",new Qi.SFVec3f),new H(c.inputOutput,"appearance",new Qi.SFNode),new H(c.inputOutput,"geometry",new Qi.SFNode)]),enumerable:!0}});const cb=hb;n.set("x_ite/Components/Shape/Shape",cb);const db=cb;function pb(e){console.warn("TwoSidedMaterial is depreciated, please use Appearance backMaterial field."),Yw.call(this,e),this.addType(c.TwoSidedMaterial),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3),this.emissiveColor=new Float32Array(3),this.backDiffuseColor=new Float32Array(3),this.backSpecularColor=new Float32Array(3),this.backEmissiveColor=new Float32Array(3)}Object.assign(Object.setPrototypeOf(pb.prototype,Yw.prototype),{initialize(){Yw.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._specularColor.addInterest("set_specularColor__",this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._shininess.addInterest("set_shininess__",this),this._transparency.addInterest("set_transparency__",this),this._backAmbientIntensity.addInterest("set_backAmbientIntensity__",this),this._backDiffuseColor.addInterest("set_backDiffuseColor__",this),this._backSpecularColor.addInterest("set_backSpecularColor__",this),this._backEmissiveColor.addInterest("set_backEmissiveColor__",this),this._backShininess.addInterest("set_backShininess__",this),this._backTransparency.addInterest("set_backTransparency__",this),this._separateBackColor.addInterest("set_transparent__",this),this._transparency.addInterest("set_transparent__",this),this._backTransparency.addInterest("set_transparent__",this),this.set_ambientIntensity__(),this.set_diffuseColor__(),this.set_specularColor__(),this.set_emissiveColor__(),this.set_shininess__(),this.set_transparency__(),this.set_backAmbientIntensity__(),this.set_backDiffuseColor__(),this.set_backSpecularColor__(),this.set_backEmissiveColor__(),this.set_backShininess__(),this.set_backTransparency__(),this.set_transparent__()},set_ambientIntensity__(){this.ambientIntensity=Math.max(this._ambientIntensity.getValue(),0)},set_diffuseColor__(){const e=this.diffuseColor,t=this._diffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_specularColor__(){const e=this.specularColor,t=this._specularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_emissiveColor__(){const e=this.emissiveColor,t=this._emissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_shininess__(){this.shininess=f.clamp(this._shininess.getValue(),0,1)},set_transparency__(){this.transparency=f.clamp(this._transparency.getValue(),0,1)},set_backAmbientIntensity__(){this.backAmbientIntensity=Math.max(this._backAmbientIntensity.getValue(),0)},set_backDiffuseColor__(){const e=this.backDiffuseColor,t=this._backDiffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backSpecularColor__(){const e=this.backSpecularColor,t=this._backSpecularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backEmissiveColor__(){const e=this.backEmissiveColor,t=this._backEmissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backShininess__(){this.backShininess=f.clamp(this._backShininess.getValue(),0,1)},set_backTransparency__(){this.backTransparency=f.clamp(this._backTransparency.getValue(),0,1)},set_transparent__(){this.setTransparent(!!(this._transparency.getValue()||this._separateBackColor.getValue()&&this._backTransparency.getValue()))},getBaseTexture:eb.prototype.getBaseTexture,getMaterialKey:eb.prototype.getMaterialKey,createShader:eb.prototype.createShader,setShaderUniforms(e,t,n,i,s,r){!r&&this._separateBackColor.getValue()?(e.uniform1f(t.x3d_AmbientIntensity,this.backAmbientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.backDiffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.backSpecularColor),e.uniform3fv(t.x3d_EmissiveColor,this.backEmissiveColor),e.uniform1f(t.x3d_Shininess,this.backShininess),e.uniform1f(t.x3d_Transparency,this.backTransparency)):(e.uniform1f(t.x3d_AmbientIntensity,this.ambientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.diffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.specularColor),e.uniform3fv(t.x3d_EmissiveColor,this.emissiveColor),e.uniform1f(t.x3d_Shininess,this.shininess),e.uniform1f(t.x3d_Transparency,this.transparency))}}),Object.defineProperties(pb,{typeName:{value:"TwoSidedMaterial",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"material",enumerable:!0},specificationRange:{value:Object.freeze(["3.2","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"separateBackColor",new Qi.SFBool),new H(c.inputOutput,"ambientIntensity",new Qi.SFFloat(.2)),new H(c.inputOutput,"diffuseColor",new Qi.SFColor(.8,.8,.8)),new H(c.inputOutput,"specularColor",new Qi.SFColor),new H(c.inputOutput,"emissiveColor",new Qi.SFColor),new H(c.inputOutput,"shininess",new Qi.SFFloat(.2)),new H(c.inputOutput,"transparency",new Qi.SFFloat),new H(c.inputOutput,"backAmbientIntensity",new Qi.SFFloat(.2)),new H(c.inputOutput,"backDiffuseColor",new Qi.SFColor(.8,.8,.8)),new H(c.inputOutput,"backSpecularColor",new Qi.SFColor),new H(c.inputOutput,"backEmissiveColor",new Qi.SFColor),new H(c.inputOutput,"backShininess",new Qi.SFFloat(.2)),new H(c.inputOutput,"backTransparency",new Qi.SFFloat)]),enumerable:!0}});const gb=pb;n.set("x_ite/Components/Shape/TwoSidedMaterial",gb);const fb=gb;function mb(e){Kw.call(this,e),this.addType(c.UnlitMaterial)}Object.assign(Object.setPrototypeOf(mb.prototype,Kw.prototype),{initialize(){Kw.prototype.initialize.call(this),this.set_transparent__()},set_emissiveTexture__(){this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.removeInterest("set_transparent__",this),Kw.prototype.set_emissiveTexture__.call(this),this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.addInterest("set_transparent__",this)},set_transparent__(){this.setTransparent(!(!this.getTransparency()&&!this.getEmissiveTexture()?.isTransparent()))},getMaterialKey:()=>"0",createShader(e,t,n){const i=this.getBrowser(),s=this.getShaderOptions(t,n);s.push("X3D_UNLIT_MATERIAL");const r=i.createShader("UnlitShader","Default","Unlit",s);return i.getShaders().set(e,r),r}}),Object.defineProperties(mb,{typeName:{value:"UnlitMaterial",enumerable:!0},componentName:{value:"Shape",enumerable:!0},containerField:{value:"material",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"emissiveColor",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"emissiveTextureMapping",new Qi.SFString),new H(c.inputOutput,"emissiveTexture",new Qi.SFNode),new H(c.inputOutput,"normalScale",new Qi.SFFloat(1)),new H(c.inputOutput,"normalTextureMapping",new Qi.SFString),new H(c.inputOutput,"normalTexture",new Qi.SFNode),new H(c.inputOutput,"transparency",new Qi.SFFloat)]),enumerable:!0}});const _b=mb;n.set("x_ite/Components/Shape/UnlitMaterial",_b);const xb=_b,yb={name:"Shape",concreteNodes:[Mw,Bw,jw,Gw,eb,ib,ob,db,fb,xb],abstractNodes:[Bl,Rw,Yw,Kw,ub]};n.set("x_ite/Components/Shape",yb);const wb=yb;function bb(e){Ys.call(this,e),du.call(this,e),this.addType(c.X3DSoundProcessingNode),this.addChildObjects("loop",new Qi.SFBool)}Object.assign(Object.setPrototypeOf(bb.prototype,Ys.prototype),du.prototype,{initialize(){Ys.prototype.initialize.call(this),du.prototype.initialize.call(this)},dispose(){du.prototype.dispose.call(this),Ys.prototype.dispose.call(this)}}),Object.defineProperties(bb,{typeName:{value:"X3DSoundProcessingNode",enumerable:!0},componentName:{value:"Sound",enumerable:!0}});const Sb=bb;n.set("x_ite/Components/Sound/X3DSoundProcessingNode",Sb);const vb=Sb;function Tb(e){vb.call(this,e),this.addType(c.Analyser)}Object.setPrototypeOf(Tb.prototype,vb.prototype),Object.defineProperties(Tb,{typeName:{value:"Analyser",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"fftSize",new Qi.SFInt32(2048)),new H(c.inputOutput,"frequencyBinCount",new Qi.SFInt32(1024)),new H(c.inputOutput,"minDecibels",new Qi.SFFloat(-100)),new H(c.inputOutput,"maxDecibels",new Qi.SFFloat(-30)),new H(c.inputOutput,"smoothingTimeConstant",new Qi.SFFloat(.8)),new H(c.inputOutput,"tailTime",new Qi.SFTime),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const Ob=Tb;n.set("x_ite/Components/Sound/Analyser",Ob);const Eb=Ob;function Cb(e){Ys.call(this,e),du.call(this,e),this.addType(c.X3DSoundSourceNode),this.volume=0,this.media=null}Object.assign(Object.setPrototypeOf(Cb.prototype,Ys.prototype),du.prototype,{initialize(){Ys.prototype.initialize.call(this),du.prototype.initialize.call(this)},set_live__(){du.prototype.set_live__.call(this),this.getDisabled()?(this.getBrowser()._volume.removeInterest("set_volume__",this),this.getBrowser()._mute.removeInterest("set_volume__",this)):(this.getBrowser()._volume.addInterest("set_volume__",this),this.getBrowser()._mute.addInterest("set_volume__",this),this.set_volume__())},setMedia(e){this.media&&(this.media.muted=!0,this.media.pause()),this.media=e,e&&(this.media.muted=!0,this.media.volume=0,this.media.loop=this._loop.getValue(),this.setVolume(0),this._duration_changed=this.media.duration,this.resetElapsedTime(),this._isActive.getValue()?this._isPaused.getValue()?this.set_pause():this.getLiveState()?this.set_start():this.set_pause():this.set_stop())},setVolume(e){this.volume=f.clamp(e,0,1),this.set_volume__()},set_loop(){this.media&&(this.media.loop=this._loop.getValue())},set_volume__(){if(!this.media)return;const e=!this.getBrowser()._mute.getValue()*f.clamp(this.getBrowser()._volume.getValue(),0,1)*this.volume;this.media.muted=0===e,this.media.volume=e},set_speed(){},set_pitch(){},set_start(){this.media&&this._speed.getValue()&&(this.media.currentTime=0,this.media.play().catch(Function.prototype))},set_pause(){this.media&&this.media.pause()},set_resume(){this.media&&this._speed.getValue()&&this.media.play().catch(Function.prototype)},set_stop(){this.media&&this.media.pause()},set_end(){this._loop.getValue()||this.stop()},set_time(){this.media&&(this._elapsedTime=this.getElapsedTime(),this.media.currentTime<this.media.duration||this.set_end())},dispose(){du.prototype.dispose.call(this),Ys.prototype.dispose.call(this)}}),Object.defineProperties(Cb,{typeName:{value:"X3DSoundSourceNode",enumerable:!0},componentName:{value:"Sound",enumerable:!0}});const Nb=Cb;n.set("x_ite/Components/Sound/X3DSoundSourceNode",Nb);const Fb=Nb;var Ib=i(666);function Mb(e){Fb.call(this,e),Rr.call(this,e),this.addType(c.AudioClip),this.addChildObjects("speed",new Qi.SFFloat(1)),this.audio=Ib("<audio></audio>"),this.urlStack=new Qi.MFString}Object.assign(Object.setPrototypeOf(Mb.prototype,Fb.prototype),Rr.prototype,{initialize(){Fb.prototype.initialize.call(this),Rr.prototype.initialize.call(this),this.audio.on("abort error",this.setError.bind(this)),this.audio.on("suspend stalled",this.setTimeout.bind(this)),this.audio.prop("crossOrigin","Anonymous"),this.audio.prop("preload","auto"),this.audio.prop("muted",!0),this.requestImmediateLoad().catch(Function.prototype)},getElement(){return this.audio[0]},set_live__(){Fb.prototype.set_live__.call(this),Rr.prototype.set_live__.call(this)},unloadData(){this.setMedia(null)},loadData(){this.setMedia(null),this.urlStack.setValue(this._url),this.audio.on("canplaythrough",this.setAudio.bind(this)),this.loadNext()},loadNext(){if(0===this.urlStack.length)return this.audio.off("canplaythrough"),this._duration_changed=-1,void this.setLoadState(c.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.audio.attr("src",this.URL.href),this.audio.get(0).load()},setTimeout(e){setTimeout((()=>{this.checkLoadState()===c.IN_PROGRESS_STATE&&this.setError(e)}),3e3)},setError(e){"data:"!==this.URL.protocol&&console.warn(`Error loading audio '${decodeURI(this.URL.href)}'`,e.type),this.loadNext()},setAudio(){this.audio.unbind("canplaythrough"),this.setMedia(this.audio[0]),this.setLoadState(c.COMPLETE_STATE)},dispose(){Rr.prototype.dispose.call(this),Fb.prototype.dispose.call(this)}}),Object.defineProperties(Mb,{typeName:{value:"AudioClip",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"source",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"pitch",new Qi.SFFloat(1)),new H(c.inputOutput,"loop",new Qi.SFBool),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.outputOnly,"duration_changed",new Qi.SFTime(-1))]),enumerable:!0}});const Pb=Mb;n.set("x_ite/Components/Sound/AudioClip",Pb);const Db=Pb;function Rb(e){Ys.call(this,e),this.addType(c.X3DSoundNode)}Object.setPrototypeOf(Rb.prototype,Ys.prototype),Object.defineProperties(Rb,{typeName:{value:"X3DSoundNode",enumerable:!0},componentName:{value:"Sound",enumerable:!0}});const Ab=Rb;n.set("x_ite/Components/Sound/X3DSoundNode",Ab);const Vb=Ab;function Lb(e){Vb.call(this,e),this.addType(c.X3DSoundDestinationNode)}Object.setPrototypeOf(Lb.prototype,Vb.prototype),Object.defineProperties(Lb,{typeName:{value:"X3DSoundDestinationNode",enumerable:!0},componentName:{value:"Sound",enumerable:!0}});const Bb=Lb;n.set("x_ite/Components/Sound/X3DSoundDestinationNode",Bb);const Ub=Bb;function Xb(e){Ub.call(this,e),this.addType(c.AudioDestination)}Object.setPrototypeOf(Xb.prototype,Ub.prototype),Object.defineProperties(Xb,{typeName:{value:"AudioDestination",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"maxChannelCount",new Qi.SFInt32(2)),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.outputOnly,"mediaDeviceID",new Qi.SFString),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const jb=Xb;n.set("x_ite/Components/Sound/AudioDestination",jb);const kb=jb;function zb(e){vb.call(this,e),this.addType(c.BiquadFilter)}Object.setPrototypeOf(zb.prototype,vb.prototype),Object.defineProperties(zb,{typeName:{value:"BiquadFilter",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"detune",new Qi.SFFloat(0)),new H(c.inputOutput,"frequency",new Qi.SFFloat(350)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"qualityFactor",new Qi.SFFloat(1)),new H(c.inputOutput,"tailTime",new Qi.SFTime),new H(c.inputOutput,"type",new Qi.SFString("lowpass")),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const Gb=zb;n.set("x_ite/Components/Sound/BiquadFilter",Gb);const Hb=Gb;function qb(e){Fb.call(this,e),Rr.call(this,e),this.addType(c.BufferAudioSource),this.addChildObjects("speed",new Qi.SFFloat(1))}Object.assign(Object.setPrototypeOf(qb.prototype,Fb.prototype),Rr.prototype,{initialize(){Fb.prototype.initialize.call(this),Rr.prototype.initialize.call(this)},dispose(){Rr.prototype.dispose.call(this),Fb.prototype.dispose.call(this)}}),Object.defineProperties(qb,{typeName:{value:"BufferAudioSource",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"buffer",new Qi.MFFloat),new H(c.inputOutput,"detune",new Qi.SFFloat(0)),new H(c.inputOutput,"bufferDuration",new Qi.SFTime),new H(c.inputOutput,"loopStart",new Qi.SFTime),new H(c.inputOutput,"loopEnd",new Qi.SFTime),new H(c.inputOutput,"numberOfChannels",new Qi.SFInt32),new H(c.inputOutput,"playbackRate",new Qi.SFFloat(1)),new H(c.inputOutput,"sampleRate",new Qi.SFFloat(0)),new H(c.outputOnly,"bufferLength",new Qi.SFInt32),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"loop",new Qi.SFBool),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime)]),enumerable:!0}});const Yb=qb;n.set("x_ite/Components/Sound/BufferAudioSource",Yb);const Wb=Yb;function $b(e){Vb.call(this,e),this.addType(c.X3DSoundChannelNode)}Object.setPrototypeOf($b.prototype,Vb.prototype),Object.defineProperties($b,{typeName:{value:"X3DSoundChannelNode",enumerable:!0},componentName:{value:"Sound",enumerable:!0}});const Kb=$b;n.set("x_ite/Components/Sound/X3DSoundChannelNode",Kb);const Jb=Kb;function Zb(e){Jb.call(this,e),this.addType(c.ChannelMerger)}Object.setPrototypeOf(Zb.prototype,Jb.prototype),Object.defineProperties(Zb,{typeName:{value:"ChannelMerger",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const Qb=Zb;n.set("x_ite/Components/Sound/ChannelMerger",Qb);const eS=Qb;function tS(e){Jb.call(this,e),this.addType(c.ChannelSelector)}Object.setPrototypeOf(tS.prototype,Jb.prototype),Object.defineProperties(tS,{typeName:{value:"ChannelSelector",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"channelSelection",new Qi.SFInt32(0)),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const nS=tS;n.set("x_ite/Components/Sound/ChannelSelector",nS);const iS=nS;function sS(e){Jb.call(this,e),this.addType(c.ChannelSplitter)}Object.setPrototypeOf(sS.prototype,Jb.prototype),Object.defineProperties(sS,{typeName:{value:"ChannelSplitter",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"children",new Qi.MFNode),new H(c.inputOutput,"outputs",new Qi.MFNode)]),enumerable:!0}});const rS=sS;n.set("x_ite/Components/Sound/ChannelSplitter",rS);const oS=rS;function aS(e){vb.call(this,e),this.addType(c.Convolver)}Object.setPrototypeOf(aS.prototype,vb.prototype),Object.defineProperties(aS,{typeName:{value:"Convolver",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"buffer",new Qi.MFFloat),new H(c.inputOutput,"normalize",new Qi.SFBool),new H(c.inputOutput,"tailTime",new Qi.SFTime),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const lS=aS;n.set("x_ite/Components/Sound/Convolver",lS);const uS=lS;function hS(e){vb.call(this,e),this.addType(c.Delay)}Object.setPrototypeOf(hS.prototype,vb.prototype),Object.defineProperties(hS,{typeName:{value:"Delay",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"delayTime",new Qi.SFTime),new H(c.inputOutput,"maxDelayTime",new Qi.SFTime(1)),new H(c.inputOutput,"tailTime",new Qi.SFTime),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const cS=hS;n.set("x_ite/Components/Sound/Delay",cS);const dS=cS;function pS(e){vb.call(this,e),this.addType(c.DynamicsCompressor)}Object.setPrototypeOf(pS.prototype,vb.prototype),Object.defineProperties(pS,{typeName:{value:"DynamicsCompressor",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"attack",new Qi.SFFloat(.003)),new H(c.inputOutput,"knee",new Qi.SFFloat(30)),new H(c.inputOutput,"ratio",new Qi.SFFloat(12)),new H(c.inputOutput,"reduction",new Qi.SFFloat),new H(c.inputOutput,"release",new Qi.SFTime(.25)),new H(c.inputOutput,"threshold",new Qi.SFFloat(-24)),new H(c.inputOutput,"tailTime",new Qi.SFTime),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const gS=pS;n.set("x_ite/Components/Sound/DynamicsCompressor",gS);const fS=gS;function mS(e){vb.call(this,e),this.addType(c.Gain)}Object.setPrototypeOf(mS.prototype,vb.prototype),Object.defineProperties(mS,{typeName:{value:"Gain",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"tailTime",new Qi.SFTime),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const _S=mS;n.set("x_ite/Components/Sound/Gain",_S);const xS=_S;function yS(e){Fb.call(this,e),this.addType(c.ListenerPointSource),this.addChildObjects("loop",new Qi.SFBool,"speed",new Qi.SFFloat(1)),this._position.setUnit("length")}Object.setPrototypeOf(yS.prototype,Fb.prototype),Object.defineProperties(yS,{typeName:{value:"ListenerPointSource",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"position",new Qi.SFVec3f),new H(c.inputOutput,"orientation",new Qi.SFRotation),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"dopplerEnabled",new Qi.SFBool),new H(c.inputOutput,"interauralDistance",new Qi.SFFloat),new H(c.inputOutput,"trackCurrentView",new Qi.SFBool),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime)]),enumerable:!0}});const wS=yS;n.set("x_ite/Components/Sound/ListenerPointSource",wS);const bS=wS;function SS(e){Fb.call(this,e),this.addType(c.MicrophoneSource),this.addChildObjects("loop",new Qi.SFBool,"speed",new Qi.SFFloat(1))}Object.setPrototypeOf(SS.prototype,Fb.prototype),Object.defineProperties(SS,{typeName:{value:"MicrophoneSource",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"mediaDeviceID",new Qi.SFString),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime)]),enumerable:!0}});const vS=SS;n.set("x_ite/Components/Sound/MicrophoneSource",vS);const TS=vS;function OS(e){Fb.call(this,e),this.addType(c.OscillatorSource),this.addChildObjects("loop",new Qi.SFBool,"speed",new Qi.SFFloat(1))}Object.setPrototypeOf(OS.prototype,Fb.prototype),Object.defineProperties(OS,{typeName:{value:"OscillatorSource",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"detune",new Qi.SFFloat),new H(c.inputOutput,"frequency",new Qi.SFFloat),new H(c.inputOutput,"periodicWave",new Qi.SFNode),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime)]),enumerable:!0}});const ES=OS;n.set("x_ite/Components/Sound/OscillatorSource",ES);const CS=ES;function NS(e){Vb.call(this,e),this.addType(c.PeriodicWave)}Object.setPrototypeOf(NS.prototype,Vb.prototype),Object.defineProperties(NS,{typeName:{value:"PeriodicWave",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"periodicWave",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"optionsReal",new Qi.MFFloat),new H(c.inputOutput,"optionsImag",new Qi.MFFloat),new H(c.inputOutput,"type",new Qi.SFString("square"))]),enumerable:!0}});const FS=NS;n.set("x_ite/Components/Sound/PeriodicWave",FS);const IS=FS;function MS(e){Vb.call(this,e),this.addType(c.Sound),this.addChildObjects("traversed",new Qi.SFBool(!0)),this._location.setUnit("length"),this._minBack.setUnit("length"),this._minFront.setUnit("length"),this._maxBack.setUnit("length"),this._maxFront.setUnit("length"),this.currentTraversed=!0}Object.assign(Object.setPrototypeOf(MS.prototype,Vb.prototype),{initialize(){Vb.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this._source.addInterest("set_source__",this),this.set_live__(),this.set_source__()},setTraversed(e){e?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=e},getTraversed(){return this.currentTraversed},set_live__(){this.getLive().getValue()&&this._traversed.getValue()?this.getBrowser().sensorEvents().addInterest("update",this):this.getBrowser().sensorEvents().removeInterest("update",this)},set_source__(){this.sourceNode&&this.sourceNode.setVolume(0),this.sourceNode=zl(c.X3DSoundSourceNode,this._source)},update(){this.getTraversed()||this.sourceNode&&this.sourceNode.setVolume(0),this.setTraversed(!1)},traverse:function(){const e={distance:0,intersection:new Et(0,0,0)},t={distance:0,intersection:new Et(0,0,0)};return function(n,i){if(n!==Na.DISPLAY)return;if(!this.sourceNode)return;if(!this.sourceNode._isActive.getValue()||this.sourceNode._isPaused.getValue())return;this.setTraversed(!0);const s=i.getModelViewMatrix().get();if(this.getEllipsoidParameter(s,Math.max(this._maxBack.getValue(),0),Math.max(this._maxFront.getValue(),0),t),t.distance<1)if(this.getEllipsoidParameter(s,Math.max(this._minBack.getValue(),0),Math.max(this._minFront.getValue(),0),e),e.distance<1)this.sourceNode.setVolume(this._intensity.getValue());else{const n=t.intersection.magnitude(),i=t.intersection.distance(e.intersection),s=Math.min(n/i,1),r=f.clamp(this._intensity.getValue(),0,1)*s;this.sourceNode.setVolume(r)}else this.sourceNode.setVolume(0)}}(),getEllipsoidParameter:function(){const e=new Et(0,0,0),t=new _n,n=new _n,i=new dn,s=new Et(1,1,1),r=new fm(1,Et.Zero),o=new Et(0,0,0),a=new Xa(Et.Zero,Et.zAxis),l=new Et(0,0,0),u=new Et(0,0,0);return function(h,c,d,p){if(0==c||0==d)return t.multVecMatrix(p.intersection.assign(this._location.getValue())),void(p.distance=1);const g=(c+d)/2,f=g-c,m=Math.sqrt(g*g-f*f);e.set(0,0,f),s.set(m,m,g),i.setFromToVec(Et.zAxis,this._direction.getValue()),t.assign(h).translate(this._location.getValue()).rotate(i).translate(e).scale(s),n.assign(t).inverse();const _=n.origin;e.negate().divVec(s),o.assign(e).subtract(_).normalize(),a.set(_,o),r.intersectsLine(a,l,u),p.intersection.assign(t.multVecMatrix(l)),p.distance=_.magnitude()}}()}),Object.defineProperties(MS,{typeName:{value:"Sound",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.initializeOnly,"spatialize",new Qi.SFBool(!0)),new H(c.inputOutput,"intensity",new Qi.SFFloat(1)),new H(c.inputOutput,"location",new Qi.SFVec3f),new H(c.inputOutput,"direction",new Qi.SFVec3f(0,0,1)),new H(c.inputOutput,"minBack",new Qi.SFFloat(1)),new H(c.inputOutput,"minFront",new Qi.SFFloat(1)),new H(c.inputOutput,"maxBack",new Qi.SFFloat(10)),new H(c.inputOutput,"maxFront",new Qi.SFFloat(10)),new H(c.inputOutput,"priority",new Qi.SFFloat),new H(c.inputOutput,"source",new Qi.SFNode),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const PS=MS;n.set("x_ite/Components/Sound/Sound",PS);const DS=PS;function RS(e){Vb.call(this,e),this.addType(c.SpatialSound),this._location.setUnit("length")}Object.setPrototypeOf(RS.prototype,Vb.prototype),Object.defineProperties(RS,{typeName:{value:"SpatialSound",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.initializeOnly,"spatialize",new Qi.SFBool(!0)),new H(c.inputOutput,"coneInnerAngle",new Qi.SFFloat(6.2832)),new H(c.inputOutput,"coneOuterAngle",new Qi.SFFloat(6.2832)),new H(c.inputOutput,"coneOuterGain",new Qi.SFFloat(0)),new H(c.inputOutput,"direction",new Qi.SFVec3f(0,0,1)),new H(c.inputOutput,"distanceModel",new Qi.SFString("INVERSE")),new H(c.inputOutput,"dopplerEnabled",new Qi.SFBool),new H(c.inputOutput,"enableHRTF",new Qi.SFBool),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"intensity",new Qi.SFFloat(1)),new H(c.inputOutput,"location",new Qi.SFVec3f),new H(c.inputOutput,"maxDistance",new Qi.SFFloat(1e4)),new H(c.inputOutput,"priority",new Qi.SFFloat),new H(c.inputOutput,"referenceDistance",new Qi.SFFloat(1)),new H(c.inputOutput,"rolloffFactor",new Qi.SFFloat(1)),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const AS=RS;n.set("x_ite/Components/Sound/SpatialSound",AS);const VS=AS;function LS(e){Ub.call(this,e),this.addType(c.StreamAudioDestination)}Object.setPrototypeOf(LS.prototype,Ub.prototype),Object.defineProperties(LS,{typeName:{value:"StreamAudioDestination",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"streamIdentifier",new Qi.MFString),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.outputOnly,"mediaDeviceID",new Qi.SFString),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const BS=LS;n.set("x_ite/Components/Sound/StreamAudioDestination",BS);const US=BS;function XS(e){Fb.call(this,e),this.addType(c.StreamAudioSource),this.addChildObjects("loop",new Qi.SFBool,"speed",new Qi.SFFloat(1))}Object.setPrototypeOf(XS.prototype,Fb.prototype),Object.defineProperties(XS,{typeName:{value:"StreamAudioSource",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"streamIdentifier",new Qi.MFString),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime)]),enumerable:!0}});const jS=XS;n.set("x_ite/Components/Sound/StreamAudioSource",jS);const kS=jS;function zS(e){vb.call(this,e),this.addType(c.WaveShaper)}Object.setPrototypeOf(zS.prototype,vb.prototype),Object.defineProperties(zS,{typeName:{value:"WaveShaper",enumerable:!0},componentName:{value:"Sound",enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze(["4.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"curve",new Qi.MFFloat),new H(c.inputOutput,"oversample",new Qi.SFString("none")),new H(c.inputOutput,"tailTime",new Qi.SFTime),new H(c.outputOnly,"channelCount",new Qi.SFInt32),new H(c.inputOutput,"channelCountMode",new Qi.SFString("max")),new H(c.inputOutput,"channelInterpretation",new Qi.SFString("speakers")),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.inputOutput,"children",new Qi.MFNode)]),enumerable:!0}});const GS=zS;n.set("x_ite/Components/Sound/WaveShaper",GS);const HS={name:"Sound",concreteNodes:[Eb,Db,kb,Hb,Wb,eS,iS,oS,uS,dS,fS,xS,bS,TS,CS,IS,DS,VS,US,kS,GS],abstractNodes:[Jb,Ub,Vb,vb,Fb]};n.set("x_ite/Components/Sound",HS);const qS=HS;const YS=function(e,t){let n=0,i=!1;Object.defineProperties(e,{currentTime:{get(){return!i&&n<this.cycle?this.duration:t._elapsedTime%this.duration},set:Function.prototype},duration:{get(){return this.get_duration_ms()/1e3}},loop:{get:()=>i,set(e){n=this.cycle,i=e}},cycle:{get(){return Math.floor(t._elapsedTime/this.duration)}},currentFrame:{get(){const e=this.get_length();return this.get_frames()[Math.max(Math.ceil(this.currentTime/this.duration*e)-1,0)]}},play:{value(){return n=this.cycle,Promise.resolve()}}})};n.set("x_ite/Browser/Texturing/GIFMedia",YS);const WS=YS;var $S=i(666),KS=i(546);function JS(e){Kl.call(this,e),Fb.call(this,e),Rr.call(this,e),this.addType(c.MovieTexture),this.video=$S("<video></video>"),this.urlStack=new Qi.MFString}Object.assign(Object.setPrototypeOf(JS.prototype,Kl.prototype),Fb.prototype,Rr.prototype,{initialize(){Kl.prototype.initialize.call(this),Fb.prototype.initialize.call(this),Rr.prototype.initialize.call(this),this.video.on("abort error",this.setError.bind(this)),this.video.on("suspend stalled",this.setTimeout.bind(this)),this.video.prop("crossOrigin","Anonymous"),this.video.prop("preload","auto"),this.video.prop("muted",!0),this.requestImmediateLoad().catch(Function.prototype)},getElement(){return this.video[0]},set_live__(){Fb.prototype.set_live__.call(this),Rr.prototype.set_live__.call(this)},unloadData(){this.clearTexture()},loadData(){delete this.gif,this.setMedia(null),this.urlStack.setValue(this._url),this.video.on("canplaythrough",this.setVideo.bind(this)),this.loadNext()},loadNext(){if(0===this.urlStack.length)return this.video.off("canplaythrough"),this._duration_changed=-1,this.clearTexture(),void this.setLoadState(c.FAILED_STATE);if(this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.URL.pathname.endsWith(".gif")){const e=$S("<img></img>").appendTo($S("<div></div>")),t=new KS({gif:e[0],on_error:e=>this.setError({type:e})});t.load_url(this.URL,this.setGif.bind(this,t)),this.setTimeout({type:"timeout"})}else this.video.attr("src",this.URL.href),this.video.get(0).load()},setTimeout(e){setTimeout((()=>{this.checkLoadState()===c.IN_PROGRESS_STATE&&this.setError(e)}),3e3)},setError(e){"data:"!==this.URL.protocol&&console.warn(`Error loading movie '${decodeURI(this.URL.href)}'`,e.type),this.loadNext()},setVideo(){try{this.video.unbind("canplaythrough");const e=this.video[0],t=e.videoWidth,n=e.videoHeight;if(!f.isPowerOfTwo(t)||!f.isPowerOfTwo(n))throw new Error("The movie texture is a non power-of-two texture.");this.setMedia(this.video[0]),this.setTexture(t,n,!1,e,!0),this.setLoadState(c.COMPLETE_STATE)}catch(e){this.setError({type:e.message})}},setGif(e){try{this.gif=e,WS(e,this),e.pause(),this.setMedia(e),this.setTexture(e.get_canvas().width,e.get_canvas().height,!1,e.get_frames()[0].data,!0),this.setLoadState(c.COMPLETE_STATE)}catch(e){this.setError({type:e.message})}},set_time(){Fb.prototype.set_time.call(this),this.checkLoadState()===c.COMPLETE_STATE&&(this.gif?this.updateTexture(this.gif.currentFrame.data,!0):this.updateTexture(this.video[0],!0))},traverse:Kl.prototype.traverse,dispose(){Rr.prototype.dispose.call(this),Fb.prototype.dispose.call(this),Kl.prototype.dispose.call(this)}}),Object.defineProperties(JS,{typeName:{value:"MovieTexture",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"enabled",new Qi.SFBool(!0)),new H(c.inputOutput,"load",new Qi.SFBool(!0)),new H(c.inputOutput,"url",new Qi.MFString),new H(c.inputOutput,"autoRefresh",new Qi.SFTime),new H(c.inputOutput,"autoRefreshTimeLimit",new Qi.SFTime(3600)),new H(c.inputOutput,"gain",new Qi.SFFloat(1)),new H(c.inputOutput,"speed",new Qi.SFFloat(1)),new H(c.inputOutput,"pitch",new Qi.SFFloat(1)),new H(c.inputOutput,"loop",new Qi.SFBool),new H(c.inputOutput,"startTime",new Qi.SFTime),new H(c.inputOutput,"resumeTime",new Qi.SFTime),new H(c.inputOutput,"pauseTime",new Qi.SFTime),new H(c.inputOutput,"stopTime",new Qi.SFTime),new H(c.outputOnly,"isPaused",new Qi.SFBool),new H(c.outputOnly,"isActive",new Qi.SFBool),new H(c.outputOnly,"elapsedTime",new Qi.SFTime),new H(c.outputOnly,"duration_changed",new Qi.SFTime(-1)),new H(c.initializeOnly,"repeatS",new Qi.SFBool(!0)),new H(c.initializeOnly,"repeatT",new Qi.SFBool(!0)),new H(c.initializeOnly,"textureProperties",new Qi.SFNode)]),enumerable:!0}});const ZS=JS;n.set("x_ite/Components/Texturing/MovieTexture",ZS);const QS=ZS;function ev(e){jl.call(this,e),this.addType(c.MultiTexture),this.addChildObjects("loadState",new Qi.SFInt32(c.NOT_STARTED_STATE));const t=this.getBrowser();this.maxTextures=t.getMaxTextures(),this.color=new Float32Array(4),this.modes=[],this.alphaModes=[],this.sources=[],this.functions=[],this.textureNodes=[]}Object.assign(Object.setPrototypeOf(ev.prototype,jl.prototype),{initialize(){jl.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this._alpha.addInterest("set_alpha__",this),this._mode.addInterest("set_mode__",this),this._source.addInterest("set_source__",this),this._function.addInterest("set_function__",this),this._texture.addInterest("set_texture__",this),this.set_color__(),this.set_alpha__(),this.set_mode__(),this.set_source__(),this.set_function__(),this.set_texture__(),this._loadState=c.COMPLETE_STATE},getCount(){return Math.min(this.maxTextures,this.textureNodes.length)},getMode(e){return e<this.modes.length?this.modes[e]:rx.MODULATE},getAlphaMode(e){return e<this.alphaModes.length?this.alphaModes[e]:rx.MODULATE},getSource(e){return e<this.sources.length?this.sources[e]:lx.DEFAULT},getFunction(e){return e<this.functions.length?this.functions[e]:cx.DEFAULT},set_color__(){this.color[0]=this._color.r,this.color[1]=this._color.g,this.color[2]=this._color.b},set_alpha__(){this.color[3]=this._alpha},set_mode__:function(){const e=new Map([["REPLACE",rx.REPLACE],["MODULATE",rx.MODULATE],["MODULATE2X",rx.MODULATE2X],["MODULATE4X",rx.MODULATE4X],["ADD",rx.ADD],["ADDSIGNED",rx.ADDSIGNED],["ADDSIGNED2X",rx.ADDSIGNED2X],["ADDSMOOTH",rx.ADDSMOOTH],["SUBTRACT",rx.SUBTRACT],["BLENDDIFFUSEALPHA",rx.BLENDDIFFUSEALPHA],["BLENDTEXTUREALPHA",rx.BLENDTEXTUREALPHA],["BLENDFACTORALPHA",rx.BLENDFACTORALPHA],["BLENDCURRENTALPHA",rx.BLENDCURRENTALPHA],["MODULATEALPHA_ADDCOLOR",rx.MODULATEALPHA_ADDCOLOR],["MODULATEINVALPHA_ADDCOLOR",rx.MODULATEINVALPHA_ADDCOLOR],["MODULATEINVCOLOR_ADDALPHA",rx.MODULATEINVCOLOR_ADDALPHA],["DOTPRODUCT3",rx.DOTPRODUCT3],["SELECTARG1",rx.SELECTARG1],["SELECTARG2",rx.SELECTARG2],["OFF",rx.OFF]]);return function(){this.modes.length=0,this.alphaModes.length=0;for(const t of this._mode){const n=t.split(",");for(let e=0,t=n.length;e<t;++e)n[e]=n[e].trim();0===n.length&&n.push("MODULATE"),n.length<2&&n.push(n[0]);const i=e.get(n[0]);void 0!==i?this.modes.push(i):this.modes.push(rx.MODULATE);const s=e.get(n[1]);void 0!==s?this.alphaModes.push(s):this.alphaModes.push(rx.MODULATE)}}}(),set_source__:function(){const e=new Map([["DIFFUSE",lx.DIFFUSE],["SPECULAR",lx.SPECULAR],["FACTOR",lx.FACTOR]]);return function(){this.sources.length=0;for(const t of this._source){const n=e.get(t);void 0!==n?this.sources.push(n):this.sources.push(lx.DEFAULT)}}}(),set_function__:function(){const e=new Map([["COMPLEMENT",cx.COMPLEMENT],["ALPHAREPLICATE",cx.ALPHAREPLICATE]]);return function(){this.functions.length=0;for(const t of this._function){const n=e.get(t);void 0!==n?this.functions.push(n):this.functions.push(cx.DEFAULT)}}}(),set_texture__(){this.textureNodes.length=0;for(const e of this._texture){const t=zl(c.X3DSingleTextureNode,e);t&&this.textureNodes.push(t)}},updateTextureBits(e){const t=this.maxTextures,n=this.textureNodes,i=Math.min(t,n.length);for(let t=0;t<i;++t)n[t].updateTextureBits(e,t);e.set(2*t,1)},getShaderOptions(e){const t=this.textureNodes,n=Math.min(this.maxTextures,t.length);for(let i=0;i<n;++i)t[i].getShaderOptions(e,i)},traverse(e,t){for(const n of this.textureNodes)n.traverse(e,t)},setShaderUniforms(e,t,n){const i=this.textureNodes,s=Math.min(this.maxTextures,i.length);e.uniform4fv(t.x3d_MultiTextureColor,this.color);for(let r=0;r<s;++r)i[r].setShaderUniforms(e,t,n,t.x3d_Texture[r]),e.uniform1i(t.x3d_MultiTextureMode[r],this.getMode(r)),e.uniform1i(t.x3d_MultiTextureAlphaMode[r],this.getAlphaMode(r)),e.uniform1i(t.x3d_MultiTextureSource[r],this.getSource(r)),e.uniform1i(t.x3d_MultiTextureFunction[r],this.getFunction(r))}}),Object.defineProperties(ev,{typeName:{value:"MultiTexture",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"color",new Qi.SFColor(1,1,1)),new H(c.inputOutput,"alpha",new Qi.SFFloat(1)),new H(c.inputOutput,"mode",new Qi.MFString),new H(c.inputOutput,"source",new Qi.MFString),new H(c.inputOutput,"function",new Qi.MFString),new H(c.inputOutput,"texture",new Qi.MFNode)]),enumerable:!0}});const tv=ev;n.set("x_ite/Components/Texturing/MultiTexture",tv);const nv=tv;function iv(e){Qh.call(this,e),this.addType(c.X3DTextureCoordinateNode)}Object.setPrototypeOf(iv.prototype,Qh.prototype),Object.defineProperties(iv,{typeName:{value:"X3DTextureCoordinateNode",enumerable:!0},componentName:{value:"Texturing",enumerable:!0}});const sv=iv;n.set("x_ite/Components/Texturing/X3DTextureCoordinateNode",sv);const rv=sv;function ov(e){rv.call(this,e),this.addType(c.MultiTextureCoordinate);const t=this.getBrowser();this.maxTexCoords=t.getMaxTexCoords(),this.textureCoordinateNodes=[]}Object.assign(Object.setPrototypeOf(ov.prototype,rv.prototype),{initialize(){rv.prototype.initialize.call(this),this._texCoord.addInterest("set_texCoord__",this),this.set_texCoord__()},set_texCoord__(){const e=this.textureCoordinateNodes;for(const t of e)t.removeInterest("addNodeEvent",this);e.length=0;for(const t of this._texCoord){const n=zl(c.X3DSingleTextureCoordinateNode,t);n&&e.push(n)}for(const t of e)t.addInterest("addNodeEvent",this)},getCount(){return Math.min(this.maxTexCoords,this.textureCoordinateNodes.length)},isEmpty:()=>!0,getSize:()=>0,get1Point(e,t){for(const n of this.textureCoordinateNodes)return n.get1Point(e,t);return t.set(0,0,0,1)},getPoints(e){for(const t of this.textureCoordinateNodes)return t.getPoints(e);return e},init(e){const t=this.textureCoordinateNodes,n=Math.min(this.maxTexCoords,t.length);for(let i=0;i<n;++i)t[i].init(e)},addPoint(e,t){const n=this.textureCoordinateNodes,i=Math.min(this.maxTexCoords,n.length);for(let s=0;s<i;++s)n[s].addPointToChannel(e,t[s])},getTextureCoordinateMapping(e){const t=this.textureCoordinateNodes,n=Math.min(this.maxTexCoords,t.length);for(let i=0;i<n;++i)t[i].getTextureCoordinateMapping(e,i)},setShaderUniforms(e,t){const n=this.textureCoordinateNodes,i=Math.min(this.maxTexCoords,n.length);if(i)for(let s=0;s<i;++s)n[s].setShaderUniforms(e,t,s);else this.getBrowser().getDefaultTextureCoordinate().setShaderUniforms(e,t,0)}}),Object.defineProperties(ov,{typeName:{value:"MultiTextureCoordinate",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"texCoord",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"texCoord",new Qi.MFNode)]),enumerable:!0}});const av=ov;n.set("x_ite/Components/Texturing/MultiTextureCoordinate",av);const lv=av;function uv(e){Bl.call(this,e),this.addType(c.X3DTextureTransformNode)}Object.setPrototypeOf(uv.prototype,Bl.prototype),Object.defineProperties(uv,{typeName:{value:"X3DTextureTransformNode",enumerable:!0},componentName:{value:"Texturing",enumerable:!0}});const hv=uv;n.set("x_ite/Components/Texturing/X3DTextureTransformNode",hv);const cv=hv;function dv(e){cv.call(this,e),this.addType(c.MultiTextureTransform);const t=this.getBrowser();this.maxTextureTransforms=t.getMaxTextureTransforms(),this.textureTransformNodes=[]}Object.assign(Object.setPrototypeOf(dv.prototype,cv.prototype),{initialize(){cv.prototype.initialize.call(this),this._textureTransform.addInterest("set_textureTransform__",this),this.set_textureTransform__()},set_textureTransform__(){const e=this.textureTransformNodes;e.length=0;for(const t of this._textureTransform){const n=zl(c.X3DSingleTextureTransformNode,t);n&&e.push(n)}e.length||e.push(this.getBrowser().getDefaultTextureTransform())},getCount(){return Math.min(this.maxTextureTransforms,this.textureTransformNodes.length)},getTextureTransformMapping(e){const t=this.textureTransformNodes,n=Math.min(this.maxTextureTransforms,t.length);for(let i=0;i<n;++i)t[i].getTextureTransformMapping(e,i)},setShaderUniforms(e,t){const n=this.textureTransformNodes,i=Math.min(this.maxTextureTransforms,n.length);for(let s=0;s<i;++s)n[s].setShaderUniforms(e,t,s)},transformPoint(e){return this.textureTransformNodes[0].transformPoint(e)}}),Object.defineProperties(dv,{typeName:{value:"MultiTextureTransform",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"textureTransform",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"textureTransform",new Qi.MFNode)]),enumerable:!0}});const pv=dv;n.set("x_ite/Components/Texturing/MultiTextureTransform",pv);const gv=pv;var fv=i(666);function mv(e){Kl.call(this,e),this.addType(c.PixelTexture),this.addChildObjects("loadState",new Qi.SFInt32(c.NOT_STARTED_STATE))}Object.assign(Object.setPrototypeOf(mv.prototype,Kl.prototype),{initialize(){Kl.prototype.initialize.call(this),this._image.addInterest("set_image__",this),this.canvas1=fv("<canvas></canvas>"),this.canvas2=fv("<canvas></canvas>"),this.set_image__()},checkLoadState(){return this._loadState.getValue()},convert(e,t,n,i){switch(t){case 1:for(let t=0,s=0;t<i;++t,s+=4){const i=n[t];e[s]=e[s+1]=e[s+2]=255&i,e[s+3]=255}break;case 2:for(let t=0,s=0;t<i;++t,s+=4){const i=n[t];e[s]=e[s+1]=e[s+2]=i>>>8&255,e[s+3]=255&i}break;case 3:for(let t=0,s=0;t<i;++t,s+=4){const i=n[t];e[s]=i>>>16&255,e[s+1]=i>>>8&255,e[s+2]=255&i,e[s+3]=255}break;case 4:for(let t=0,s=0;t<i;++t,s+=4){const i=n[t];e[s]=i>>>24,e[s+1]=i>>>16&255,e[s+2]=i>>>8&255,e[s+3]=255&i}}},resize(e,t,n,i,s){const r=new Uint8Array(i*s*4),o=i/t,a=s/n;for(let n=0;n<s;++n){const s=Math.floor(n/a)*t,l=n*i;for(let t=0;t<i;++t){const n=4*(s+Math.floor(t/o)),i=4*(l+t);r[i]=e[n],r[i+1]=e[n+1],r[i+2]=e[n+2],r[i+3]=e[n+3]}}return r},set_image__(){const e=this.getBrowser().getContext(),t=this._image.comp,n=this._image.array,i=!(t%2);let s=this._image.width,r=this._image.height,o=null;if(s>0&&r>0&&t>0&&t<5){if(e.getVersion()>=2||f.isPowerOfTwo(s)&&f.isPowerOfTwo(r))o=new Uint8Array(s*r*4),this.convert(o,t,n.getValue(),n.length);else if(Math.max(s,r)<this.getBrowser().getMinTextureSize()&&!this._textureProperties.getValue()){o=new Uint8Array(s*r*4),this.convert(o,t,n.getValue(),n.length);const e=s,i=r;s=8*f.nextPowerOfTwo(e),r=8*f.nextPowerOfTwo(i),o=this.resize(o,e,i,s,r)}else{const e=this.canvas1[0],i=this.canvas2[0],a=e.getContext("2d",{willReadFrequently:!0}),l=i.getContext("2d",{willReadFrequently:!0}),u=a.createImageData(s,r);e.width=s,e.height=r,this.convert(u.data,t,n,n.length),a.putImageData(u,0,0),s=f.nextPowerOfTwo(s),r=f.nextPowerOfTwo(r),i.width=s,i.height=r,l.clearRect(0,0,s,r),l.drawImage(e,0,0,e.width,e.height,0,0,s,r),o=l.getImageData(0,0,s,r).data}this.setTexture(s,r,i,new Uint8Array(o.buffer),!1),this._loadState=c.COMPLETE_STATE}else this.clearTexture(),this._loadState=c.FAILED_STATE}}),Object.defineProperties(mv,{typeName:{value:"PixelTexture",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"description",new Qi.SFString),new H(c.inputOutput,"image",new Qi.SFImage(0,0,0,new Qi.MFInt32)),new H(c.initializeOnly,"repeatS",new Qi.SFBool(!0)),new H(c.initializeOnly,"repeatT",new Qi.SFBool(!0)),new H(c.initializeOnly,"textureProperties",new Qi.SFNode)]),enumerable:!0}});const _v=mv;n.set("x_ite/Components/Texturing/PixelTexture",_v);const xv=_v;function yv(e){rv.call(this,e),this.addType(c.X3DSingleTextureCoordinateNode),this.texCoordArray=Sl.createArray()}Object.assign(Object.setPrototypeOf(yv.prototype,rv.prototype),{getCount:()=>1,init(e){this.texCoordArray.length=0,e.push(this.texCoordArray)},addPoint(e,t){this.addPointToChannel(e,t[0])},getTextureCoordinateMapping(e,t=0){e.set(this._mapping.getValue()||t,t)},setShaderUniforms(e,t,n=0){e.uniform1i(t.x3d_TextureCoordinateGeneratorMode[n],0)}}),Object.defineProperties(yv,{typeName:{value:"X3DSingleTextureCoordinateNode",enumerable:!0},componentName:{value:"Texturing",enumerable:!0}});const wv=yv;n.set("x_ite/Components/Texturing/X3DSingleTextureCoordinateNode",wv);const bv=wv;function Sv(e){bv.call(this,e),this.addType(c.TextureCoordinate)}Object.assign(Object.setPrototypeOf(Sv.prototype,bv.prototype),{initialize(){bv.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty(){return 0===this.length},getSize(){return this.length},get1Point(e,t){if(e>=0&&e<this.length){const n=this.point;return e*=2,t.set(n[e],n[e+1],0,1)}if(e>=0&&this.length){const n=this.point;return e%=this.length,e*=2,t.set(n[e],n[e+1],0,1)}return t.set(0,0,0,1)},getPoints(e){const t=this.point,n=this.length;for(let i=0,s=0;i<n;++i,s+=2)e.push(t[s],t[s+1],0,1);return e},addPointToChannel(e,t){if(e>=0&&e<this.length){const n=this.point;e*=2,t.push(n[e],n[e+1],0,1)}else if(e>=0&&this.length){const n=this.point;e%=this.length,e*=2,t.push(n[e],n[e+1],0,1)}else t.push(0,0,0,1)}}),Object.defineProperties(Sv,{typeName:{value:"TextureCoordinate",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"texCoord",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"mapping",new Qi.SFString),new H(c.inputOutput,"point",new Qi.MFVec2f)]),enumerable:!0}});const vv=Sv;n.set("x_ite/Components/Texturing/TextureCoordinate",vv);const Tv=vv;function Ov(e){bv.call(this,e),this.addType(c.TextureCoordinateGenerator),this.mode=gx.SPHERE,this.parameter=new Float32Array(6)}Object.assign(Object.setPrototypeOf(Ov.prototype,bv.prototype),{initialize(){bv.prototype.initialize.call(this),this._mode.addInterest("set_mode__",this),this._parameter.addInterest("set_parameter__",this),this.set_mode__(),this.set_parameter__()},set_mode__:function(){const e=new Map([["SPHERE",gx.SPHERE],["CAMERASPACENORMAL",gx.CAMERASPACENORMAL],["CAMERASPACEPOSITION",gx.CAMERASPACEPOSITION],["CAMERASPACEREFLECTIONVECTOR",gx.CAMERASPACEREFLECTIONVECTOR],["SPHERE-LOCAL",gx.SPHERE_LOCAL],["COORD",gx.COORD],["COORD-EYE",gx.COORD_EYE],["NOISE",gx.NOISE],["NOISE-EYE",gx.NOISE_EYE],["SPHERE-REFLECT",gx.SPHERE_REFLECT],["SPHERE-REFLECT-LOCAL",gx.SPHERE_REFLECT_LOCAL]]);return function(){this.mode=e.get(this._mode.getValue()),void 0===this.mode&&(this.mode=gx.SPHERE)}}(),set_parameter__(){const e=Math.min(this.parameter.length,this._parameter.length);for(let t=0;t<e;++t)this.parameter[t]=this._parameter[t];this.parameter.fill(0,e)},get1Point:(e,t)=>t,getPoints:e=>e,addPointToChannel(e,t){t.push(0,0,0,1)},setShaderUniforms(e,t,n=0){e.uniform1i(t.x3d_TextureCoordinateGeneratorMode[n],this.mode),e.uniform1fv(t.x3d_TextureCoordinateGeneratorParameter[n],this.parameter)}}),Object.defineProperties(Ov,{typeName:{value:"TextureCoordinateGenerator",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"texCoord",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"mapping",new Qi.SFString),new H(c.inputOutput,"mode",new Qi.SFString("SPHERE")),new H(c.inputOutput,"parameter",new Qi.MFFloat)]),enumerable:!0}});const Ev=Ov;n.set("x_ite/Components/Texturing/TextureCoordinateGenerator",Ev);const Cv=Ev;function Nv(e){vs.call(this,e),this.addType(c.TextureProperties),e.getSpecificationVersion()<4&&(this._minificationFilter="DEFAULT",this._magnificationFilter="DEFAULT",this._textureCompression="DEFAULT")}Object.assign(Object.setPrototypeOf(Nv.prototype,vs.prototype),{getBorderWidth(){return f.clamp(this._borderWidth.getValue(),0,1)},getBoundaryMode:function(){const e=new Map([["CLAMP","CLAMP_TO_EDGE"],["CLAMP_TO_EDGE","CLAMP_TO_EDGE"],["CLAMP_TO_BOUNDARY","CLAMP_TO_EDGE"],["MIRRORED_REPEAT","MIRRORED_REPEAT"],["REPEAT","REPEAT"]]);return function(t){const n=e.get(t);return void 0!==n?n:"REPEAT"}}(),getBoundaryModeS(){return this.getBoundaryMode(this._boundaryModeS.getValue())},getBoundaryModeT(){return this.getBoundaryMode(this._boundaryModeT.getValue())},getBoundaryModeR(){return this.getBoundaryMode(this._boundaryModeR.getValue())},getMinificationFilter:function(){const e=new Map([["AVG_PIXEL_AVG_MIPMAP","LINEAR_MIPMAP_LINEAR"],["AVG_PIXEL","LINEAR"],["AVG_PIXEL_NEAREST_MIPMAP","LINEAR_MIPMAP_NEAREST"],["NEAREST_PIXEL_AVG_MIPMAP","NEAREST_MIPMAP_LINEAR"],["NEAREST_PIXEL_NEAREST_MIPMAP","NEAREST_MIPMAP_NEAREST"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR_MIPMAP_LINEAR"],["FASTEST","NEAREST"]]);return function(){if(this._generateMipMaps.getValue()){const t=e.get(this._minificationFilter.getValue());return void 0!==t?t:this.getBrowser().getDefaultTextureProperties().getMinificationFilter()}return"LINEAR"}}(),getMagnificationFilter:function(){const e=new Map([["AVG_PIXEL","LINEAR"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR"],["FASTEST","NEAREST"]]);return function(){const t=e.get(this._magnificationFilter.getValue());return void 0!==t?t:this.getBrowser().getDefaultTextureProperties().getMagnificationFilter()}}(),getTextureCompression:function(){const e=new Map([["DEFAULT","RGBA"],["NICEST","RGBA"],["FASTEST","RGBA"],["LOW","RGBA"],["MEDIUM","RGBA"],["HIGH","RGBA"]]);return function(){const t=this.getBrowser().getContext(),n=t.getExtension("WEBGL_compressed_texture_etc"),i=n?n[e.get(this._textureCompression.getValue())]:void 0;return void 0!==i?i:t.RGBA}}()}),Object.defineProperties(Nv,{typeName:{value:"TextureProperties",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"textureProperties",enumerable:!0},specificationRange:{value:Object.freeze(["3.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"borderColor",new Qi.SFColorRGBA),new H(c.inputOutput,"borderWidth",new Qi.SFInt32),new H(c.inputOutput,"anisotropicDegree",new Qi.SFFloat(1)),new H(c.initializeOnly,"generateMipMaps",new Qi.SFBool),new H(c.inputOutput,"minificationFilter",new Qi.SFString("FASTEST")),new H(c.inputOutput,"magnificationFilter",new Qi.SFString("FASTEST")),new H(c.inputOutput,"boundaryModeS",new Qi.SFString("REPEAT")),new H(c.inputOutput,"boundaryModeT",new Qi.SFString("REPEAT")),new H(c.inputOutput,"boundaryModeR",new Qi.SFString("REPEAT")),new H(c.inputOutput,"textureCompression",new Qi.SFString("FASTEST")),new H(c.inputOutput,"texturePriority",new Qi.SFFloat)]),enumerable:!0}});const Fv=Nv;n.set("x_ite/Components/Texturing/TextureProperties",Fv);const Iv=Fv;function Mv(e){cv.call(this,e),this.addType(c.X3DSingleTextureTransformNode),this.matrixArray=new Float32Array(_n.Identity)}Object.assign(Object.setPrototypeOf(Mv.prototype,cv.prototype),{getCount:()=>1,setMatrix(e){this.matrixArray.set(e)},getTextureTransformMapping(e,t=0){e.set(this._mapping.getValue()||t,t)},setShaderUniforms(e,t,n=0){e.uniformMatrix4fv(t.x3d_TextureMatrix[n],!1,this.matrixArray)},transformPoint(e){return _n.prototype.multVecMatrix.call(this.matrixArray,e)}}),Object.defineProperties(Mv,{typeName:{value:"X3DSingleTextureTransformNode",enumerable:!0},componentName:{value:"Texturing",enumerable:!0}});const Pv=Mv;n.set("x_ite/Components/Texturing/X3DSingleTextureTransformNode",Pv);const Dv=Pv;function Rv(e){Dv.call(this,e),this.addType(c.TextureTransform),this._rotation.setUnit("angle"),this.matrix=new _n}Object.assign(Object.setPrototypeOf(Rv.prototype,Dv.prototype),{initialize(){Dv.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},getMatrix(){return this.matrix},eventsProcessed:function(){const e=new wt(0,0),t=new Bt;return function(){const n=this._translation.getValue(),i=this._rotation.getValue(),s=this._scale.getValue(),r=this._center.getValue(),o=this.matrix;t.identity(),r.equals(wt.Zero)||t.translate(e.assign(r).negate()),s.equals(wt.One)||t.scale(s),0!==i&&t.rotate(i),r.equals(wt.Zero)||t.translate(r),n.equals(wt.Zero)||t.translate(n),o[0]=t[0],o[1]=t[1],o[4]=t[3],o[5]=t[4],o[12]=t[6],o[13]=t[7],this.setMatrix(o)}}()}),Object.defineProperties(Rv,{typeName:{value:"TextureTransform",enumerable:!0},componentName:{value:"Texturing",enumerable:!0},containerField:{value:"textureTransform",enumerable:!0},specificationRange:{value:Object.freeze(["2.0","Infinity"]),enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"metadata",new Qi.SFNode),new H(c.inputOutput,"mapping",new Qi.SFString),new H(c.inputOutput,"translation",new Qi.SFVec2f),new H(c.inputOutput,"rotation",new Qi.SFFloat),new H(c.inputOutput,"scale",new Qi.SFVec2f(1,1)),new H(c.inputOutput,"center",new Qi.SFVec2f)]),enumerable:!0}});const Av=Rv;n.set("x_ite/Components/Texturing/TextureTransform",Av);const Vv=Av,Lv={name:"Texturing",concreteNodes:[eu,QS,nv,lv,gv,xv,Tv,Cv,Iv,Vv],abstractNodes:[bv,ql,Dv,Kl,rv,jl,cv]};n.set("x_ite/Components/Texturing",Lv);const Bv=Lv,Uv={name:"Time",concreteNodes:[fu],abstractNodes:[du]};n.set("x_ite/Components/Time",Uv);const Xv=Uv;function jv(e=[]){return Z.call(this,Array.from(e,(e=>[e.typeName,e])),Function)}Object.assign(Object.setPrototypeOf(jv.prototype,Z.prototype),{add(e,t){c.addNode(t),is.addConcreteNode(t),Z.prototype.add.call(this,e,t)},update(e,t,n){c.addNode(n),is.addConcreteNode(n),Z.prototype.update.call(this,e,t,n)}});for(const e of Reflect.ownKeys(jv.prototype))Object.defineProperty(jv.prototype,e,{enumerable:!1});Object.defineProperties(jv,{typeName:{value:"ConcreteNodesArray",enumerable:!0}});const kv=jv;n.set("x_ite/Configuration/ConcreteNodesArray",kv);const zv=kv,Gv=new zv;n.set("x_ite/Configuration/ConcreteNodes",Gv);const Hv=Gv,qv=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_sRGB","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","EXT_float_blend","OES_fbo_render_mipmap","WEBGL_get_buffer_sub_data_async","WEBGL_multiview","WEBGL_security_sensitive_resources","WEBGL_shared_resources","EXT_clip_cull_distance","WEBGL_debug","WEBGL_dynamic_texture","WEBGL_subarray_uploads","WEBGL_texture_multisample","WEBGL_texture_source_iframe","WEBGL_video_texture","EXT_texture_storage","OES_depth24","WEBGL_debug_shader_precision","WEBGL_draw_elements_no_range_check","WEBGL_subscribe_uniform","WEBGL_texture_from_depth_video"],Yv={create(e,t,n){const i={preserveDrawingBuffer:n};let s=null;if(t>=2&&!s&&(s=e.getContext("webgl2",{...i,antialias:!1}),s&&(s.getVersion=function(){return 2})),t>=1&&!s&&(s=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),s)){s.getVersion=function(){return 1};{const e=s.getExtension("OES_vertex_array_object");s.bindVertexArray=e.bindVertexArrayOES.bind(e),s.createVertexArray=e.createVertexArrayOES.bind(e),s.deleteVertexArray=e.deleteVertexArrayOES.bind(e),s.isVertexArray=e.isVertexArrayOES.bind(e)}}if(!s)throw new Error("Couldn't create WebGL context.");const r=s.getParameter(s.ALIASED_LINE_WIDTH_RANGE);if(1===r[0]&&1===r[1]?(s.lineWidth=Function.prototype,s.HAS_FEATURE_TRANSFORMED_LINES=s.getVersion()>=2):s.HAS_FEATURE_TRANSFORMED_LINES=!1,s.HAS_FEATURE_DEPTH_TEXTURE=s.getVersion()>=2||!!s.getExtension("WEBGL_depth_texture"),s.HAS_FEATURE_FRAG_DEPTH=s.getVersion()>=2||!!s.getExtension("EXT_frag_depth"),1===s.getVersion()){const e=s.getExtension("WEBGL_color_buffer_float"),t=s.getExtension("WEBGL_draw_buffers");s.RGBA32F=e.RGBA32F_EXT,s.MAX_COLOR_ATTACHMENTS=t.MAX_COLOR_ATTACHMENTS_WEBGL,s.drawBuffers=t.drawBuffersWEBGL.bind(t);for(let e=0,n=s.getParameter(s.MAX_COLOR_ATTACHMENTS);e<n;++e){const n=t.COLOR_ATTACHMENT0_WEBGL+e;void 0===s[`COLOR_ATTACHMENT${e}`]&&(s[`COLOR_ATTACHMENT${e}`]=n)}}for(const e of qv)s.getExtension(e);return Object.assign(s,1===s.getVersion()?{readPixelsAsync:s.readPixels}:{clientWaitAsync(e,t,n){return new Promise(((i,s)=>{const r=()=>{switch(this.clientWaitSync(e,t,0)){case this.WAIT_FAILED:return void s();case this.TIMEOUT_EXPIRED:return void setTimeout(r,n);default:return void i()}};setTimeout(r)}))},getBufferSubDataAsync:async function(e,t,n,i,s,r){const o=this.fenceSync(this.SYNC_GPU_COMMANDS_COMPLETE,0);this.flush(),await this.clientWaitAsync(o,0,10),this.deleteSync(o),this.bindBuffer(e,t),this.getBufferSubData(e,n,i,s,r),this.bindBuffer(e,null)},readPixelsAsync:async function(e,t,n,i,s,r,o,a){const l=this.createBuffer();this.bindBuffer(this.PIXEL_PACK_BUFFER,l),this.bufferData(this.PIXEL_PACK_BUFFER,o.byteLength,this.STREAM_READ),this.readPixels(e,t,n,i,s,r,0),this.bindBuffer(this.PIXEL_PACK_BUFFER,null),await this.getBufferSubDataAsync(this.PIXEL_PACK_BUFFER,l,0,o,a),this.deleteBuffer(l)}}),s}},Wv=Yv;n.set("x_ite/Browser/Core/Context",Wv);const $v=Wv,Kv='msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:56+0100\n"\n"PO-Revision-Date: 2015-12-23 04:57+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: de\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Weniger Eigenschaften"\n\nmsgid "More Properties"\nmsgstr "Mehr Eigenschaften"\n\nmsgid "Frame rate"\nmsgstr "Bildrate"\n\nmsgid "fps"\nmsgstr "BpS"\n\nmsgid "Speed"\nmsgstr "Geschwindigkeit"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr ""\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D gesamt"\n\nmsgid "Event Processing"\nmsgstr "Ereignisverarbeitung"\n\nmsgid "Pointer"\nmsgstr "Zeigegerät"\n\nmsgid "Camera"\nmsgstr "Kamera"\n\nmsgid "Collision Detection"\nmsgstr "Kollisionserkennung"\n\nmsgid "Rendering"\nmsgstr "Rendering"\n\nmsgid "Number of Shapes"\nmsgstr "Anzahl der Formen"\n\nmsgid "Number of Sensors"\nmsgstr "Anzahl der Sensoren"\n\nmsgid "Browser Timings"\nmsgstr "Zeitberechnung"\n\nmsgid "X_ITE Browser"\nmsgstr ""\n\nmsgid "Viewpoints"\nmsgstr "Ansichtspunkte"\n\nmsgid "Available Viewers"\nmsgstr "Verfügbare Betrachter"\n\nmsgid "Straighten Horizon"\nmsgstr "Horizont gerade richten"\n\nmsgid "Primitive Quality"\nmsgstr "Qualität der Grundobjekte"\n\nmsgid "High"\nmsgstr "Hoch"\n\nmsgid "high"\nmsgstr "hoch"\n\nmsgid "Medium"\nmsgstr "Mittel"\n\nmsgid "medium"\nmsgstr "mittel"\n\nmsgid "Low"\nmsgstr "Niedrig"\n\nmsgid "low"\nmsgstr "niedrig"\n\nmsgid "Texture Quality"\nmsgstr "Textur Qualität"\n\nmsgid "Display Rubberband"\nmsgstr "Gummiband anzeigen"\n\nmsgid "Rubberband"\nmsgstr "Gummiband"\n\nmsgid "on"\nmsgstr "an"\n\nmsgid "off"\nmsgstr "aus"\n\nmsgid "Mute Browser"\nmsgstr "Browser stumm schalten"\n\nmsgid "Browser muted"\nmsgstr "Browser stumm geschalten"\n\nmsgid "Browser unmuted"\nmsgstr "Browser Ton an"\n\nmsgid "Leave Fullscreen"\nmsgstr "Vollbild verlassen"\n\nmsgid "Fullscreen"\nmsgstr "Vollbild"\n\nmsgid "About X_ITE"\nmsgstr "Über X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Untersuchen"\n\nmsgid "Walk Viewer"\nmsgstr "Laufen"\n\nmsgid "Fly Viewer"\nmsgstr "Fliegen"\n\nmsgid "Plane Viewer"\nmsgstr "Ebenen Betrachter"\n\nmsgid "Look At Viewer"\nmsgstr "Auf Objekte zielen"\n\nmsgid "None Viewer"\nmsgstr "Kein Betrachter"\n\nmsgid "Points"\nmsgstr "Punkte"\n\nmsgid "Flat"\nmsgstr "Flach"\n\nmsgid "Wireframe"\nmsgstr "Drahtgittermodel"\n\nmsgid "Loading %1 file"\nmsgstr "Lade %1 Datei"\n\nmsgid "Loading %1 files"\nmsgstr "Lade %1 Dateien"\n\nmsgid "Loading done"\nmsgstr "Fertig mit Laden"\n\nmsgid "Failed loading world."\nmsgstr "Laden der Dateien fehlgeschlagen."\n\nmsgid "Show World Info"\nmsgstr "World Info anzeigen"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Ansichtspunkt wurde in die Zwischenablage kopiert."\n';n.set("locale/de.po",Kv);const Jv=Kv,Zv='msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:58+0100\n"\n"PO-Revision-Date: 2015-12-23 05:07+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: fr\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Moins de Propriétés"\n\nmsgid "More Properties"\nmsgstr "Plus de Propriétés"\n\nmsgid "Frame rate"\nmsgstr "Fréquence d\'Images"\n\nmsgid "fps"\nmsgstr "fps"\n\nmsgid "Speed"\nmsgstr "Vélocité"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D total"\n\nmsgid "Event Processing"\nmsgstr "Traitement des Événements"\n\nmsgid "Pointer"\nmsgstr "Pointeur"\n\nmsgid "Camera"\nmsgstr "Caméra"\n\nmsgid "Collision Detection"\nmsgstr "Détection des Collisions"\n\nmsgid "Rendering"\nmsgstr "Rendement"\n\nmsgid "Number of Shapes"\nmsgstr "Nombre de Formes"\n\nmsgid "Number of Sensors"\nmsgstr "Nombre de Senseurs"\n\nmsgid "Browser Timings"\nmsgstr "Calcul du Temps"\n\nmsgid "X_ITE Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "Viewpoints"\nmsgstr "Points de Vue"\n\nmsgid "Available Viewers"\nmsgstr "Visionneurs disponibles"\n\nmsgid "Straighten Horizon"\nmsgstr "Redresser l\'Horizon"\n\nmsgid "Primitive Quality"\nmsgstr "Qualité des Objets simples"\n\nmsgid "High"\nmsgstr "Haut"\n\nmsgid "high"\nmsgstr "haut"\n\nmsgid "Medium"\nmsgstr "Moyenne"\n\nmsgid "medium"\nmsgstr "moyenne"\n\nmsgid "Low"\nmsgstr "Faible"\n\nmsgid "low"\nmsgstr "faible"\n\nmsgid "Texture Quality"\nmsgstr "Qualité des Textures"\n\nmsgid "Display Rubberband"\nmsgstr "Présenter le Bande élastique"\n\nmsgid "Rubberband"\nmsgstr "Bande élastique"\n\nmsgid "on"\nmsgstr "marche"\n\nmsgid "off"\nmsgstr "arrêt"\n\nmsgid "Mute Browser"\nmsgstr "Rendre Navigateur muet"\n\nmsgid "Browser muted"\nmsgstr "Navigateur muet"\n\nmsgid "Browser unmuted"\nmsgstr "Son de Navigateur réactivé"\n\nmsgid "Leave Fullscreen"\nmsgstr "Laisser le plein Écran"\n\nmsgid "Fullscreen"\nmsgstr "Plein Écran"\n\nmsgid "About X_ITE"\nmsgstr "À propos de X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Examiner"\n\nmsgid "Walk Viewer"\nmsgstr "Aller"\n\nmsgid "Fly Viewer"\nmsgstr "Voler"\n\nmsgid "Plane Viewer"\nmsgstr "Visionneur de la Plaine"\n\nmsgid "Look At Viewer"\nmsgstr "Regarder un Objet de près"\n\nmsgid "None Viewer"\nmsgstr "Pas de Visionneur"\n\nmsgid "Flat"\nmsgstr "Plat"\n\nmsgid "Wireframe"\nmsgstr "Image filaire"\n\nmsgid "Loading %1 file"\nmsgstr "Télécharger %1 Fichier"\n\nmsgid "Loading %1 files"\nmsgstr "Télécharger %1 Fichiers"\n\nmsgid "Loading done"\nmsgstr "Téléchargement fini"\n\nmsgid "Failed loading world."\nmsgstr "Le chargement des Fichiers a échoué."\n\nmsgid "Show World Info"\nmsgstr "Afficher World Info"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Le point de Vue est copié dans le Presse-Papiers."\n';n.set("locale/fr.po",Zv);const Qv={en:"C",de:Jv,fr:Zv},eT=/msgid\s+"(.*?)"\nmsgstr\s+"(.*?)"\n/g,tT=function(){for(const e of navigator.languages){const t=e.split("-")[0];if(Qv[t])return t}return(navigator.language||navigator.userLanguage).split("-")[0]}();!function(e){if(Qv[e]){const i=function(e,t){const n=[];let i=null;for(;i=e.exec(t);)n.push(i);return n}(eT,Qv[e]),s=Qv[e]={};for(var t=0,n=i.length;t<n;++t)i[t][2].length&&(s[i[t][1]]=i[t][2])}}(tT);const nT=function(e){const t=Qv[tT];if(void 0===t)return e;const n=t[e];return void 0===n?e:n};n.set("locale/gettext",nT);const iT=nT;var sT=i(666);function rT(e){xs.call(this,e),this.localStorage=this.getBrowser().getLocalStorage().addNameSpace("BrowserTimings."),this.fps=new ka}Object.assign(Object.setPrototypeOf(rT.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this),this.getBrowser().getBrowserOptions()._Timings.addInterest("set_enabled__",this),this.localStorage.addDefaultValues({type:"LESS"}),this.element=sT("<div></div>").hide().addClass("x_ite-private-browser-timings").appendTo(this.getBrowser().getSurface()),this.table=sT("<table></table>").appendTo(this.element),this.header=sT("<thead></thead>").append(sT("<tr></tr>").append(sT("<th colspan='2'></th>").text(iT("Browser Timings")))).appendTo(this.table),this.body=sT("<tbody></tbody>").appendTo(this.table),this.footer=sT("<tfoot></tfoot>").append(sT("<tr></tr>").append(sT("<td colspan='2'></td>"))).appendTo(this.table),this.button=sT("<button></button>").attr("type","button").appendTo(this.footer.find("td")),this.frameRate=sT("<td></td>"),this.speed=sT("<td></td>"),this.frameRate=sT("<td></td>"),this.speed=sT("<td></td>"),this.browserTime=sT("<td></td>"),this.x3dTotal=sT("<td></td>"),this.eventProcessing=sT("<td></td>"),this.pointerTime=sT("<td></td>"),this.cameraTime=sT("<td></td>"),this.pickingTime=sT("<td></td>"),this.collisionTime=sT("<td></td>"),this.renderTime=sT("<td></td>"),this.numShapes=sT("<td></td>"),this.sensors=sT("<td></td>"),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Frame rate")+":")).append(this.frameRate)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Speed")+":")).append(this.speed).addClass("x_ite-private-more")),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Browser")+":")).append(this.browserTime)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("X3D total")+":")).append(this.x3dTotal)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Event Processing")+":")).append(this.eventProcessing)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Pointer")+":")).append(this.pointerTime)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Camera")+":")).append(this.cameraTime)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Picking")+":")).append(this.pickingTime)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Collision Detection")+":")).append(this.collisionTime)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Rendering")+":")).append(this.renderTime)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Number of Shapes")+":")).append(this.numShapes)),this.body.append(sT("<tr></tr>").append(sT("<td></td>").text(iT("Number of Sensors")+":")).append(this.sensors)),this.button.on("click touchend",this.set_type__.bind(this)),this.localStorage.type="MORE"===this.localStorage.type?"LESS":"MORE",this.set_type__()},set_enabled__(){this.getBrowser().getBrowserOption("Timings")?(this.element.stop(!0,!0).fadeIn(),this.fps.reset(),this.getBrowser().prepareEvents().addInterest("update",this),this.update(),this.build()):(this.element.stop(!0,!0).fadeOut(),this.getBrowser().prepareEvents().removeInterest("update",this))},set_type__(){"MORE"===this.localStorage.type?(this.localStorage.type="LESS",this.table.addClass("less"),this.table.removeClass("more")):(this.localStorage.type="MORE",this.table.addClass("more"),this.table.removeClass("less")),this.set_button__(),this.build()},set_button__(){"MORE"===this.localStorage.type?this.button.text(iT("Less Properties")):this.button.text(iT("More Properties"))},update(){this.fps.stop(),this.fps.elapsedTime>1e3&&(this.build(),this.fps.reset()),this.fps.start()},build(){const e=this.getBrowser();if(this.frameRate.text(`${oT(1e3/this.fps.averageTime)} ${iT("fps")}`),this.speed.text(`${oT(this.getSpeed(e.currentSpeed))} ${this.getSpeedUnit(e.currentSpeed)}`),"MORE"!==this.localStorage.type||!e.getWorld())return;const t=e.getWorld().getLayerSet().getLayers(),n=e.getActiveLayer(),i=n&&e.getCollisionCount()?n.getCollisionTime().averageTime:0,s=e.getCollisionTime().averageTime+i,r=Math.max(0,e.getBrowserTime().averageTime-(e.getCameraTime().averageTime+e.getCollisionTime().averageTime+e.getDisplayTime().averageTime)),o=e.prepareEvents().getInterests().size-1,a=e.sensorEvents().getInterests().size,l=t.reduce(((e,t)=>e+t.getNumOpaqueShapes()),0),u=t.reduce(((e,t)=>e+t.getNumTransparentShapes()),0);this.browserTime.text(`${oT(e.getSystemTime().averageTime)} ${iT("ms")}`),this.x3dTotal.text(`${oT(e.getBrowserTime().averageTime)} ${iT("ms")}`),this.eventProcessing.text(`${oT(r)} ${iT("ms")}`),this.pointerTime.text(`${oT(e.getPointingTime().averageTime)} ${iT("ms")}`),this.cameraTime.text(`${oT(e.getCameraTime().averageTime)} ${iT("ms")}`),this.pickingTime.text(`${oT(e.getPickingTime().averageTime)} ${iT("ms")}`),this.collisionTime.text(`${oT(s)} ${iT("ms")}`),this.renderTime.text(`${oT(e.getDisplayTime().averageTime)} ${iT("ms")}`),this.numShapes.text(`${l} + ${u}`),this.sensors.text(o+a),e.getSystemTime().reset(),e.getBrowserTime().reset(),e.getPointingTime().reset(),e.getCameraTime().reset(),e.getPickingTime().reset(),e.getCollisionTime().reset(),e.getDisplayTime().reset(),n?.getCollisionTime().reset()},getSpeed:e=>e<15?e:3.6*e,getSpeedUnit:e=>iT(e<15?"m/s":"km/h")}),Object.defineProperties(rT,{typeName:{value:"BrowserTimings",enumerable:!0}});const oT=function(){const e=new Intl.NumberFormat(navigator.language||navigator.userLanguage,{notation:"standard",minimumFractionDigits:2,maximumFractionDigits:2}).format;return function(t){return e(Number.isFinite(t)?t:0)}}(),aT=rT;n.set("x_ite/Browser/Core/BrowserTimings",aT);const lT=aT;let uT=0;const hT={LOW:uT++,MEDIUM:uT++,HIGH:uT++};n.set("x_ite/Browser/Core/PrimitiveQuality",hT);const cT=hT;let dT=0;const pT={LOW:dT++,MEDIUM:dT++,HIGH:dT++};n.set("x_ite/Browser/Core/TextureQuality",pT);const gT=pT;var fT=i(666);function mT(e){xs.call(this,e),this.addAlias("AntiAliased",this._Antialiased);const t=this.getBrowser();this.localStorage=t.getLocalStorage().addNameSpace("BrowserOptions."),this.textureQuality=gT.MEDIUM,this.primitiveQuality=cT.MEDIUM,this.shading=xl.GOURAUD}Object.assign(Object.setPrototypeOf(mT.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this),this.localStorage.addDefaultValues({Rubberband:this._Rubberband.getValue(),PrimitiveQuality:this._PrimitiveQuality.getValue(),TextureQuality:this._TextureQuality.getValue(),StraightenHorizon:this._StraightenHorizon.getValue(),Timings:this._Timings.getValue()}),this._Rubberband.addInterest("set_rubberband__",this),this._Antialiased.addInterest("set_antialiased__",this),this._PrimitiveQuality.addInterest("set_primitiveQuality__",this),this._TextureQuality.addInterest("set_textureQuality__",this),this._Shading.addInterest("set_shading__",this),this._StraightenHorizon.addInterest("set_straightenHorizon__",this),this._AutoUpdate.addInterest("set_autoUpdate__",this),this._ContentScale.addInterest("set_contentScale__",this),this._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this._Multisampling.addInterest("set_multisampling__",this),this._Timings.addInterest("set_timings__",this),this.set_antialiased__(this._Antialiased),this.set_shading__(this._Shading),this.set_contentScale__(this._ContentScale),this.set_logarithmicDepthBuffer__(this._LogarithmicDepthBuffer),this.set_multisampling__(this._Multisampling),this.configure()},configure:function(){const e=new Set(["Antialiased","AutoUpdate","Cache","ContentScale","ContextMenu","Debug","Multisampling","Notifications","SplashScreen"]),t=new Set(["PrimitiveQuality","Rubberband","StraightenHorizon","TextureQuality","Timings"]);return function(){const n=this.getBrowser(),i=this.localStorage;for(const{name:s,value:r}of this.getFieldDefinitions()){if(e.has(s)){const e=fT.toLowerCaseFirst(s),t=n.getElement().attr(e);if(void 0!==t){n.attributeChangedCallback(e,null,t);continue}}if(t.has(s)){const e=i[s],t=this.getField(s);e!==t.getValue()&&t.setValue(e);continue}const o=this.getField(s);o.equals(r)||o.assign(r)}}}(),getPrimitiveQuality(){return this.primitiveQuality},getShading(){return this.shading},getTextureQuality(){return this.textureQuality},set_rubberband__(e){this.localStorage.Rubberband=e.getValue()},set_antialiased__(){this.set_multisampling__(this._Multisampling)},set_primitiveQuality__(e){const t=this.getBrowser(),n=e.getValue().toUpperCase();this.localStorage.PrimitiveQuality=n,this.primitiveQuality=fT.enum(cT,n,cT.MEDIUM),"function"==typeof t.setPrimitiveQuality2D&&t.setPrimitiveQuality2D(this.primitiveQuality),"function"==typeof t.setPrimitiveQuality3D&&t.setPrimitiveQuality3D(this.primitiveQuality)},set_textureQuality__(e){const t=this.getBrowser(),n=e.getValue().toUpperCase();this.localStorage.TextureQuality=n,this.textureQuality=fT.enum(gT,n,gT.MEDIUM),"function"==typeof t.setTextureQuality&&t.setTextureQuality(this.textureQuality)},set_shading__:function(){const e={[xl.POINT]:"POINT",[xl.WIREFRAME]:"WIREFRAME",[xl.FLAT]:"FLAT",[xl.GOURAUD]:"GOURAUD",[xl.PHONG]:"PHONG"};return function(t){const n=this.getBrowser(),i=t.getValue().toUpperCase().replace("POINTSET","POINT");this.shading=fT.enum(xl,i,xl.GOURAUD),n.getRenderingProperties()._Shading=e[this.shading],n.setShading(this.shading)}}(),set_straightenHorizon__(e){this.localStorage.StraightenHorizon=e.getValue(),e.getValue()&&this.getBrowser().getActiveLayer()?.straightenView()},updateContentScale(){const e=this.getBrowser(),t=window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),n=this.updateContentScale.bind(this);this.removeUpdateContentScale&&this.removeUpdateContentScale(),this.removeUpdateContentScale=function(){t.removeEventListener("change",n)},t.addEventListener("change",n),e.getRenderingProperties()._ContentScale=window.devicePixelRatio,e.reshape()},set_autoUpdate__(e){const t=["resize","scroll","load"].map((e=>`${e}.${this.getTypeName()}${this.getId()}`)).join(" ");if(e.getValue()){const e=this.getBrowser(),n=e.getElement(),i=()=>{n.isInViewport()?e.isLive()||e.beginUpdate():e.isLive()&&e.endUpdate()};fT(window).on(t,i),i()}else fT(window).off(t)},set_contentScale__(e){const t=this.getBrowser();this.removeUpdateContentScale&&this.removeUpdateContentScale(),-1===e.getValue()?this.updateContentScale():t.getRenderingProperties()._ContentScale=Math.max(e.getValue(),0)||1,t.reshape()},set_logarithmicDepthBuffer__(e){const t=this.getBrowser(),n=t.getContext();t.getRenderingProperties()._LogarithmicDepthBuffer=e.getValue()&&n.HAS_FEATURE_FRAG_DEPTH},set_multisampling__(e){const t=this.getBrowser(),n=f.clamp(e.getValue(),0,t.getMaxSamples());t.getRenderingProperties()._Multisampling=this._Antialiased.getValue()?n:0,t.getRenderingProperties()._Antialiased=t.getAntialiased(),t.reshape()},set_timings__(e){this.localStorage.Timings=e.getValue()}}),Object.defineProperties(mT,{typeName:{value:"BrowserOptions",enumerable:!0},fieldDefinitions:{value:new te([new H(c.inputOutput,"SplashScreen",new Qi.SFBool(!0)),new H(c.inputOutput,"Dashboard",new Qi.SFBool(!0)),new H(c.inputOutput,"Rubberband",new Qi.SFBool(!0)),new H(c.inputOutput,"EnableInlineViewpoints",new Qi.SFBool(!0)),new H(c.inputOutput,"Antialiased",new Qi.SFBool(!0)),new H(c.inputOutput,"TextureQuality",new Qi.SFString("MEDIUM")),new H(c.inputOutput,"PrimitiveQuality",new Qi.SFString("MEDIUM")),new H(c.inputOutput,"QualityWhenMoving",new Qi.SFString("SAME")),new H(c.inputOutput,"Shading",new Qi.SFString("GOURAUD")),new H(c.inputOutput,"MotionBlur",new Qi.SFBool),new H(c.inputOutput,"AutoUpdate",new Qi.SFBool(!1)),new H(c.inputOutput,"Cache",new Qi.SFBool(!0)),new H(c.inputOutput,"ContentScale",new Qi.SFDouble(1)),new H(c.inputOutput,"ContextMenu",new Qi.SFBool(!0)),new H(c.inputOutput,"Debug",new Qi.SFBool),new H(c.inputOutput,"Gravity",new Qi.SFDouble(9.80665)),new H(c.inputOutput,"LogarithmicDepthBuffer",new Qi.SFBool),new H(c.inputOutput,"Notifications",new Qi.SFBool(!0)),new H(c.inputOutput,"Multisampling",new Qi.SFInt32(4)),new H(c.inputOutput,"StraightenHorizon",new Qi.SFBool(!0)),new H(c.inputOutput,"Timings",new Qi.SFBool)]),enumerable:!0}});const _T=mT;n.set("x_ite/Browser/Core/BrowserOptions",_T);const xT=_T;function yT(e){xs.call(this,e)}Object.setPrototypeOf(yT.prototype,xs.prototype),Object.defineProperties(yT,{typeName:{value:"BrowserProperties",enumerable:!0},fieldDefinitions:{value:new te([new H(c.initializeOnly,"ABSTRACT_NODES",new Qi.SFBool(!0)),new H(c.initializeOnly,"CONCRETE_NODES",new Qi.SFBool(!0)),new H(c.initializeOnly,"EXTERNAL_INTERACTIONS",new Qi.SFBool(!0)),new H(c.initializeOnly,"PROTOTYPE_CREATE",new Qi.SFBool(!0)),new H(c.initializeOnly,"DOM_IMPORT",new Qi.SFBool(!0)),new H(c.initializeOnly,"XML_ENCODING",new Qi.SFBool(!0)),new H(c.initializeOnly,"CLASSIC_VRML_ENCODING",new Qi.SFBool(!0)),new H(c.initializeOnly,"BINARY_ENCODING",new Qi.SFBool)]),enumerable:!0}});const wT=yT;n.set("x_ite/Browser/Core/BrowserProperties",wT);const bT=wT;function ST(e){xs.call(this,e),this.addAlias("AntiAliased",this._Antialiased)}Object.assign(Object.setPrototypeOf(ST.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this);const e=this.getBrowser();this._MaxTextureSize=e.getMaxTextureSize(),this._TextureUnits=e.getMaxCombinedTextureUnits(),this._MaxLights=e.getMaxLights(),this._ColorDepth=e.getColorDepth(),this._TextureMemory=e.getTextureMemory(),this._MaxSamples=e.getMaxSamples()}}),Object.defineProperties(ST,{typeName:{value:"RenderingProperties",enumerable:!0},fieldDefinitions:{value:new te([new H(c.outputOnly,"Shading",new Qi.SFString),new H(c.outputOnly,"MaxTextureSize",new Qi.SFInt32),new H(c.outputOnly,"TextureUnits",new Qi.SFInt32),new H(c.outputOnly,"MaxLights",new Qi.SFInt32),new H(c.outputOnly,"Antialiased",new Qi.SFBool(!0)),new H(c.outputOnly,"ColorDepth",new Qi.SFInt32),new H(c.outputOnly,"TextureMemory",new Qi.SFDouble),new H(c.outputOnly,"ContentScale",new Qi.SFDouble(1)),new H(c.outputOnly,"LogarithmicDepthBuffer",new Qi.SFBool),new H(c.outputOnly,"MaxSamples",new Qi.SFInt32),new H(c.outputOnly,"Multisampling",new Qi.SFInt32(4))]),enumerable:!0}});const vT=ST;n.set("x_ite/Browser/Core/RenderingProperties",vT);const TT=vT;var OT=i(666);function ET(e){xs.call(this,e),this.addChildObjects("string",new Hn)}OT.fn.textWidth=function(e){const t=OT(this).children(),n="<span>"+OT(this).html()+"</span>";OT(this).html(n);const i=OT(this).find("span:first").width();return OT(this).empty(),OT(this).append(t),i},Object.assign(Object.setPrototypeOf(ET.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this),this.element=OT("<div></div>").hide().addClass("x_ite-private-notification").appendTo(this.getBrowser().getSurface()).animate({width:0}),OT("<span></span>").appendTo(this.element),this._string.addInterest("set_string__",this)},set_string__(){this.getBrowser().getBrowserOption("Notifications")&&0!==this._string.length&&(this.element.children().text(this._string.getValue()),this.element.stop(!0,!0).fadeIn(0).animate({width:this.element.textWidth()}).animate({delay:1},5e3).animate({width:0}).fadeOut(0))}}),Object.defineProperties(ET,{typeName:{value:"Notification",enumerable:!0}});const CT=ET;n.set("x_ite/Browser/Core/Notification",CT);const NT=CT;i(31);var FT=i(666);const IT=Symbol();function MT(e){xs.call(this,e),this[IT]=null}Object.assign(Object.setPrototypeOf(MT.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this);const e=this.getBrowser();this.init({element:e.getElement(),appendTo:e.getShadow(),build:this.build.bind(this),animation:{duration:500,show:"fadeIn",hide:"fadeOut"}})},getUserMenu(){return this[IT]},setUserMenu(e){this[IT]=e},createUserMenu(){const e={};if("function"==typeof this[IT]){const t=this[IT]();if(FT.isPlainObject(t))for(const n in t)e["user-"+n]=t[n]}return e},build(e){const t=this.getBrowser(),n=t.getElement().fullScreen();if(!t.getBrowserOption("ContextMenu"))return;const i={className:"x_ite-private-menu",items:{title:{name:t.getName()+" Browser v"+t.getVersion(),className:"context-menu-title context-menu-not-selectable"},separator0:"--------",viewpoints:{name:iT("Viewpoints"),className:"context-menu-icon x_ite-private-icon-viewpoint",items:this.getViewpoints()},"available-viewers":{name:iT("Available Viewers"),items:this.getAvailableViewers()},"straighten-horizon":{name:iT("Straighten Horizon"),type:"checkbox",selected:t.getBrowserOption("StraightenHorizon"),events:{click:e=>{const n=FT(e.target).is(":checked");t.setBrowserOption("StraightenHorizon",n),t.getNotification()._string=n?iT("Straighten Horizon")+": "+iT("on"):iT("Straighten Horizon")+": "+iT("off")}}},"display-rubberband":{name:iT("Display Rubberband"),type:"checkbox",selected:t.getBrowserOption("Rubberband"),events:{click:e=>{const n=FT(e.target).is(":checked");t.setBrowserOption("Rubberband",n),t.getNotification()._string=n?iT("Rubberband")+": "+iT("on"):iT("Rubberband")+": "+iT("off")}}},separator1:"--------","primitive-quality":{name:iT("Primitive Quality"),className:"context-menu-icon x_ite-private-icon-primitive-quality",items:{high:{name:iT("High"),type:"radio",radio:"primitive-quality",selected:"HIGH"===t.getBrowserOption("PrimitiveQuality"),events:{click:()=>{t.setBrowserOption("PrimitiveQuality","HIGH"),t.getNotification()._string=iT("Primitive Quality")+": "+iT("high")}}},medium:{name:iT("Medium"),type:"radio",radio:"primitive-quality",selected:"MEDIUM"===t.getBrowserOption("PrimitiveQuality"),events:{click:()=>{t.setBrowserOption("PrimitiveQuality","MEDIUM"),t.getNotification()._string=iT("Primitive Quality")+": "+iT("medium")}}},low:{name:iT("Low"),type:"radio",radio:"primitive-quality",selected:"LOW"===t.getBrowserOption("PrimitiveQuality"),events:{click:()=>{t.setBrowserOption("PrimitiveQuality","LOW"),t.getNotification()._string=iT("Primitive Quality")+": "+iT("low")}}}}},"texture-quality":{name:iT("Texture Quality"),className:"context-menu-icon x_ite-private-icon-texture-quality",items:{high:{name:iT("High"),type:"radio",radio:"texture-quality",selected:"HIGH"===t.getBrowserOption("TextureQuality"),events:{click:()=>{t.setBrowserOption("TextureQuality","HIGH"),t.getNotification()._string=iT("Texture Quality")+": "+iT("high")}}},medium:{name:iT("Medium"),type:"radio",radio:"texture-quality",selected:"MEDIUM"===t.getBrowserOption("TextureQuality"),events:{click:()=>{t.setBrowserOption("TextureQuality","MEDIUM"),t.getNotification()._string=iT("Texture Quality")+": "+iT("medium")}}},low:{name:iT("Low"),type:"radio",radio:"texture-quality",selected:"LOW"===t.getBrowserOption("TextureQuality"),events:{click:()=>{t.setBrowserOption("TextureQuality","LOW"),t.getNotification()._string=iT("Texture Quality")+": "+iT("low")}}}}},shading:{name:iT("Shading"),className:"context-menu-icon x_ite-private-icon-shading",items:{point:{name:iT("Points"),type:"radio",radio:"shading",selected:"POINT"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","POINT"),t.getNotification()._string=iT("Shading")+": "+iT("Points")}}},wireframe:{name:iT("Wireframe"),type:"radio",radio:"shading",selected:"WIREFRAME"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","WIREFRAME"),t.getNotification()._string=iT("Shading")+": "+iT("Wireframe")}}},flat:{name:iT("Flat"),type:"radio",radio:"shading",selected:"FLAT"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","FLAT"),t.getNotification()._string=iT("Shading")+": "+iT("Flat")}}},gouraud:{name:iT("Gouraud"),type:"radio",radio:"shading",selected:"GOURAUD"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","GOURAUD"),t.getNotification()._string=iT("Shading")+": "+iT("Gouraud")}}},phong:{name:iT("Phong"),type:"radio",radio:"shading",selected:"PHONG"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","PHONG"),t.getNotification()._string=iT("Shading")+": "+iT("Phong")}}}}},separator2:"--------","browser-timings":{name:iT("Browser Timings"),type:"checkbox",selected:t.getBrowserOption("Timings"),events:{click:e=>{t.setBrowserOption("Timings",FT(e.target).is(":checked")),t.getSurface().focus()}}},fullscreen:{name:iT(n?"Leave Fullscreen":"Fullscreen"),className:"context-menu-icon "+(n?"x_ite-private-icon-leave-fullscreen":"x_ite-private-icon-enter-fullscreen"),callback:()=>{t.getElement().toggleFullScreen()}},separator3:"--------"}};Object.assign(i.items,this.createUserMenu()),Object.assign(i.items,{separator4:"--------","world-info":{name:iT("Show World Info"),className:"context-menu-icon x_ite-private-icon-world-info",callback(){t.getShadow().find(".x_ite-private-world-info").remove();const e=t.getShadow().find(".x_ite-private-browser"),n=FT("<div></div>").addClass("x_ite-private-world-info-overlay").appendTo(e),i=FT("<div></div>").addClass("x_ite-private-world-info").appendTo(n),s=t.getExecutionContext().getWorldInfos()[0],r=s.title,o=s.info;FT("<div></div>").addClass("x_ite-private-world-info-top").text("World Info").appendTo(i),r.length&&FT("<div></div>").addClass("x_ite-private-world-info-title").text(r).appendTo(i);for(const e of o)FT("<div></div>").addClass("x_ite-private-world-info-info").text(e).appendTo(i);i.find("a").on("click",(function(e){e.stopPropagation()})),i.find("a[href^=http]").each((function(){-1===this.href.indexOf(location.hostname)&&FT(this).attr("target","_blank")})),n.on("click",(function(){n.remove()}))}},about:{name:iT("About X_ITE"),className:"context-menu-icon x_ite-private-icon-help-about",callback(){window.open(t.getProviderUrl())}}}),FT.isEmptyObject(i.items.viewpoints.items)&&delete i.items.viewpoints,Object.keys(i.items["available-viewers"].items).length<2&&delete i.items["available-viewers"],t.getCurrentViewer().match(/^(?:EXAMINE|FLY)$/)||delete i.items["straighten-horizon"],t.getBrowserOption("Debug")||delete i.items.shading;const s=t.getExecutionContext().getWorldInfos()[0];return(!s||0===s.title.length&&0===s.info.length)&&delete i.items["world-info"],i},getViewpoints(){const e=this.getBrowser(),t=e.getActiveLayer();if(!t)return{};const n=e.getBrowserOption("EnableInlineViewpoints"),i=e.currentScene,s=t.getViewpoints().get(),r=t.getViewpoint(),o={};for(const t of s){const s=t._description.getValue();if(""===s)continue;if(!n&&t.getScene()!==i)continue;const a={name:s,callback:()=>{e.bindViewpoint(e.getActiveLayer(),t),e.getSurface().focus()}};t===r&&(a.className="context-menu-selected"),o["Viewpoint"+t.getId()]=a}return o},getAvailableViewers(){const e=this.getBrowser(),t=e._viewer.getValue(),n=e._availableViewers,i={};for(const s of n)i[s]={name:iT(this.getViewerName(s)),className:"context-menu-icon x_ite-private-icon-"+s.toLowerCase()+"-viewer",callback:()=>{e._viewer=s,e.getNotification()._string=iT(this.getViewerName(s)),e.getSurface().focus()}},s===t&&(i[s].className+=" context-menu-selected");return i},getViewerName(e){switch(e){case"EXAMINE":return iT("Examine Viewer");case"WALK":return iT("Walk Viewer");case"FLY":return iT("Fly Viewer");case"PLANE":return iT("Plane Viewer");case"LOOKAT":return iT("Look At Viewer");case"NONE":return iT("None Viewer")}},init(e){this.show=this.createRoot.bind(this,e),e.element.on("contextmenu",this.show)},show(e){},hide(e){},createRoot(e,t){const n=e.build(t);if(!n)return;const i=FT("<div></div>").addClass("context-menu-layer").addClass(n.className).appendTo(e.appendTo),s=this.hide=()=>(delete this.hide,i.remove(),r[e.animation.hide](e.animation.duration,(function(){r.remove(),e.events&&"function"==typeof e.events.hide&&e.events.hide()})),!1),r=FT("<ul></ul>").hide().addClass("context-menu-root").addClass("context-menu-list").addClass(n.className).appendTo(e.appendTo).offset({left:t.pageX,top:t.pageY});for(const e in n.items)r.append(this.createItem(n.items[e],"context-menu-root",e,2,s));return r[e.animation.show](e.animation.duration),r.offset({left:t.pageX,top:t.pageY}),r.offset().left-FT(document).scrollLeft()+r.outerWidth()>FT(window).width()&&r.offset({left:FT(document).scrollLeft()+Math.max(0,FT(window).width()-r.outerWidth())}),r.offset().top-FT(document).scrollTop()+r.outerHeight()>FT(window).height()&&r.offset({top:FT(document).scrollTop()+Math.max(0,FT(window).height()-r.outerHeight())}),r.find("ul").each((function(e,t){const n=(t=FT(t)).outerWidth()+r.outerWidth(),i=r.offset().left-FT(document).scrollLeft()+n>FT(window).width()?"right":"left";t.css("width",t.outerWidth()),t.css(i,t.parent().closest("ul").width()),t.outerHeight()>=FT(window).height()&&t.css({"max-height":"100vh","overflow-y":"scroll"})})),r.find("li").on("mouseenter touchstart",(function(e){e.stopImmediatePropagation();const t=FT(e.target).closest("li").children("ul");if(!t.length)return;t.css("top","");const n=t.offset().top+t.outerHeight()-FT(window).scrollTop()-FT(window).height();n>0&&t.offset({top:t.offset().top-n})})),i.on("click contextmenu",s),r.on("contextmenu",s),e.events&&"function"==typeof e.events.show&&e.events.show(r),!1},createItem(e,t,n,i,s){const r=FT("<li></li>").addClass("context-menu-item");switch(typeof e){case"string":e.match(/^-+$/)&&r.addClass(["context-menu-separator","context-menu-not-selectable"]);break;case"object":switch(e.className&&r.addClass(e.className),e.type){case"radio":case"checkbox":{const n=FT("<label></label>").appendTo(r),i=FT("<input></input>").appendTo(n);i.attr("type",e.type).attr("name","context-menu-input-"+(e.radio||t)),FT("<span></span>").text(e.name).appendTo(n),e.selected&&i.attr("checked","checked");for(const t in e.events)"function"==typeof e.events[t]&&i.on(t,e.events[t]);r.addClass("context-menu-input");break}default:e.name&&FT("<span></span>").text(e.name).appendTo(r),"function"==typeof e.callback&&r.on("click",e.callback).on("click",s)}}if("object"==typeof e.items&&i<3){const t=FT("<ul></ul>").addClass("context-menu-list").css({"z-index":i}).appendTo(r);for(const r in e.items)t.append(this.createItem(e.items[r],n,r,i+1,s));r.addClass("context-menu-submenu")}return r}}),Object.defineProperties(MT,{typeName:{value:"ContextMenu",enumerable:!0}});const PT=MT;n.set("x_ite/Browser/Core/ContextMenu",PT);const DT=PT;function RT(e,t,n,i,s=!1,r=[]){Object.defineProperties(this,{name:{value:e,enumerable:!0},level:{value:t,enumerable:!0},title:{value:n,enumerable:!0},providerUrl:{value:i||uo.getProviderUrl(s&&e),enumerable:!0},external:{value:s},dependencies:{value:r}})}Object.assign(Object.setPrototypeOf(RT.prototype,F.prototype),{toVRMLStream(e){e.string+=e.Indent(),e.string+="COMPONENT",e.string+=e.Space(),e.string+=this.name,e.string+=e.TidySpace(),e.string+=":",e.string+=e.TidySpace(),e.string+=this.level},toXMLStream(e){e.string+=e.Indent(),e.string+="<component",e.string+=e.Space(),e.string+="name='",e.string+=this.name,e.string+="'",e.string+=e.Space(),e.string+="level='",e.string+=this.level,e.string+="'",e.string+=e.closingTags?"></component>":"/>"},toJSONStream(e){e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=this.name,e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@level",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+=this.level,e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Reflect.ownKeys(RT.prototype))Object.defineProperty(RT.prototype,e,{enumerable:!1});Object.defineProperties(RT,{typeName:{value:"ComponentInfo",enumerable:!0}});const AT=RT;n.set("x_ite/Configuration/ComponentInfo",AT);const VT=AT;function LT(e=[]){return Z.call(this,Array.from(e,(e=>[e.name,e])),VT)}Object.assign(Object.setPrototypeOf(LT.prototype,Z.prototype),{add(e,{level:t,title:n,providerUrl:i,external:s=!1,dependencies:r=[]}){Z.prototype.add.call(this,e,new VT(e,t,n,i,s,r))}});for(const e of Reflect.ownKeys(LT.prototype))Object.defineProperty(LT.prototype,e,{enumerable:!1});Object.defineProperties(LT,{typeName:{value:"ComponentInfoArray",enumerable:!0}});const BT=LT;n.set("x_ite/Configuration/ComponentInfoArray",BT);const UT=BT;function XT(e,t,n){Object.defineProperties(this,{category:{value:e,enumerable:!0},name:{value:t,enumerable:!0},conversionFactor:{value:n,enumerable:!0}})}Object.assign(Object.setPrototypeOf(XT.prototype,F.prototype),{toVRMLStream(e){e.string+=e.Indent(),e.string+="UNIT",e.string+=e.Space(),e.string+=this.category,e.string+=e.Space(),e.string+=this.name,e.string+=e.Space(),e.string+=this.conversionFactor},toXMLStream(e){e.string+=e.Indent(),e.string+="<unit",e.string+=e.Space(),e.string+="category='",e.string+=this.category,e.string+="'",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.name),e.string+="'",e.string+=e.Space(),e.string+="conversionFactor='",e.string+=this.conversionFactor,e.string+="'",e.string+=e.closingTags?"></unit>":"/>"},toJSONStream(e,t){if(1===this.conversionFactor)throw new Error("conversionFactor is 1");e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@category",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=this.category,e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.name),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@conversionFactor",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+=this.conversionFactor,e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Reflect.ownKeys(XT.prototype))Object.defineProperty(XT.prototype,e,{enumerable:!1});Object.defineProperty(XT.prototype,"conversion_factor",{get(){return this.conversionFactor}}),Object.defineProperties(XT,{typeName:{value:"UnitInfo",enumerable:!0}});const jT=XT;n.set("x_ite/Configuration/UnitInfo",jT);const kT=jT;function zT(e=[]){return Z.call(this,Array.from(e,(e=>[e.category,e])),kT)}Object.setPrototypeOf(zT.prototype,Z.prototype);for(const e of Reflect.ownKeys(zT.prototype))Object.defineProperty(zT.prototype,e,{enumerable:!1});Object.defineProperties(zT,{typeName:{value:"UnitInfoArray",enumerable:!0}});const GT=zT;n.set("x_ite/Configuration/UnitInfoArray",GT);const HT=GT,qT=Symbol(),YT=Symbol();function WT(e,t){F.call(this),this[qT]=e,this[YT]=t}Object.assign(Object.setPrototypeOf(WT.prototype,F.prototype),{getExportedName(){return this[qT]},getLocalNode(){return this[YT]},toVRMLStream(e){const t=e.LocalName(this[YT]);e.string+=e.Indent(),e.string+="EXPORT",e.string+=e.Space(),e.string+=t,this[qT]!==t&&(e.string+=e.Space(),e.string+="AS",e.string+=e.Space(),e.string+=this[qT])},toXMLStream(e){const t=e.LocalName(this[YT]);e.string+=e.Indent(),e.string+="<EXPORT",e.string+=e.Space(),e.string+="localDEF='",e.string+=e.XMLEncode(t),e.string+="'",this[qT]!==t&&(e.string+=e.Space(),e.string+="AS='",e.string+=e.XMLEncode(this[qT]),e.string+="'"),e.string+=e.closingTags?"></EXPORT>":"/>"},toJSONStream(e){const t=e.LocalName(this[YT]);e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="EXPORT",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@localDEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t),e.string+='"',this[qT]!==t?(e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@AS",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this[qT]),e.string+='"',e.string+=e.TidyBreak()):e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Reflect.ownKeys(WT.prototype))Object.defineProperty(WT.prototype,e,{enumerable:!1});Object.defineProperties(WT.prototype,{exportedName:{get(){return this[qT]},enumerable:!0},localNode:{get(){return Tn.get(this[YT])},enumerable:!0}}),Object.defineProperties(WT,{typeName:{value:"X3DExportedNode",enumerable:!0}});const $T=WT;n.set("x_ite/Execution/X3DExportedNode",$T);const KT=$T;function JT(e=[]){return Z.call(this,Array.from(e,(e=>[e.getExportedName(),e])),KT)}Object.setPrototypeOf(JT.prototype,Z.prototype);for(const e of Reflect.ownKeys(JT.prototype))Object.defineProperty(JT.prototype,e,{enumerable:!1});Object.defineProperties(JT,{typeName:{value:"ExportedNodesArray",enumerable:!0}});const ZT=JT;n.set("x_ite/Execution/ExportedNodesArray",ZT);const QT=ZT,eO=Symbol.for("X_ITE.X3DEventObject.browser"),tO=Symbol(),nO=Symbol(),iO=Symbol(),sO=Symbol(),rO=Symbol(),oO=Symbol(),aO=Symbol(),lO=Symbol(),uO=Symbol(),hO="4.0";function cO(e){this[eO]=e,jh.call(this,this),this.addType(c.X3DScene),this.addChildObjects("profile_changed",new Qi.SFTime,"metadata_changed",new Qi.SFTime,"initLoadCount",new Qi.SFInt32,"loadCount",new Qi.SFInt32),this[tO]=hO,this[nO]="SCRIPTED",this[iO]=null,this[sO]=new UT([]),this[rO]=location.toString(),this[oO]=new HT,this[oO].add("angle",new kT("angle","radian",1)),this[oO].add("force",new kT("force","newton",1)),this[oO].add("length",new kT("length","metre",1)),this[oO].add("mass",new kT("mass","kilogram",1)),this[aO]=new Map,this[lO]=new QT,this[uO]=new Set,this[sO].addParent(this),this[oO].addParent(this),this[lO].addParent(this),this.getRootNodes().setAccessType(c.inputOutput),this.setLive(!1)}Object.assign(Object.setPrototypeOf(cO.prototype,jh.prototype),{isMainScene(){return this===this.getExecutionContext()},isScene:()=>!0,setSpecificationVersion(e){this[tO]=String(e)},getSpecificationVersion(){return this[tO]},setEncoding(e){this[nO]=String(e)},getEncoding(){return this[nO]},setWorldURL(e){this[rO]=String(e)},getWorldURL(){return this[rO]},setProfile(e){this[iO]=e,this._profile_changed=this.getBrowser().getCurrentTime()},getProfile(){return this[iO]},hasComponent(e){return(this[iO]?.components.has(e)??!0)||this[sO].has(e)},addComponent(e){this[sO].add(e.name,e),this._components_changed=this.getBrowser().getCurrentTime()},updateComponent(e){this[sO].update(e.name,e.name,e),this._components_changed=this.getBrowser().getCurrentTime()},removeComponent(e){this[sO].remove(e),this._components_changed=this.getBrowser().getCurrentTime()},getComponents(){return this[sO]},updateUnit(e,t,n){this[oO].has(e)&&(this[oO].update(e,e,new kT(e,String(t),Number(n))),this._units_changed=this.getBrowser().getCurrentTime())},getUnit(e){return this[oO].get(e)},getUnits(){return this[oO]},fromUnit(e,t){switch(e){case"angle":case"force":case"length":case"mass":return t*this.getUnits().get(e).conversionFactor;case"acceleration:":case"speed":return t*this.getUnits().get("length").conversionFactor;case"angularRate":return t*this.getUnits().get("angle").conversionFactor;case"area":return t*Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return t*Math.pow(this.getUnits().get("length").conversionFactor,3)}return t},toUnit(e,t){switch(e){case"angle":case"force":case"length":case"mass":return t/this.getUnits().get(e).conversionFactor;case"acceleration:":case"speed":return t/this.getUnits().get("length").conversionFactor;case"angularRate":return t/this.getUnits().get("angle").conversionFactor;case"area":return t/Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return t/Math.pow(this.getUnits().get("length").conversionFactor,3)}return t},setMetaData(e,t){if(!(e=String(e)).length)throw new Error("Couldn't add metadata: name is empty.");if(Array.isArray(t)||(t=[String(t)]),!t.length)throw new Error("Couldn't add metadata: values length is 0.");this[aO].set(e,t.map((e=>String(e)))),this._metadata_changed=this.getBrowser().getCurrentTime()},addMetaData(e,t){if(e=String(e),t=String(t),!e.length)throw new Error("Couldn't add metadata: name is empty.");let n=this[aO].get(e);n||this[aO].set(e,n=[]),n.push(t)},removeMetaData(e){e=String(e),this[aO].delete(e),this._metadata_changed=this.getBrowser().getCurrentTime()},getMetaData(e){e=String(e);const t=this[aO].get(e);if(t)return Array.from(t)},getMetaDatas(){return new Map(this[aO])},addExportedNode(e,t){if(e=String(e),this[lO].has(e))throw new Error(`Couldn't add exported node: exported name '${e}' already in use.`);this.updateExportedNode(e,t),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},updateExportedNode(e,t){if(e=String(e),t=zl(c.X3DNode,t,!1),0===e.length)throw new Error("Couldn't update exported node: node exported name is empty.");if(!t)throw new Error("Couldn't update exported node: node must be of type X3DNode.");this.removeExportedNode(e);const n=new KT(e,t);this[lO].add(e,n),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},removeExportedNode(e){e=String(e),this[lO].remove(e),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},getExportedNode(e){e=String(e);const t=this[lO].get(e);if(t)return Tn.get(t.getLocalNode());throw new Error(`Exported node '${e}' not found.`)},getExportedNodes(){return this[lO]},getUniqueExportName(e){return d(this[lO],e)},addRootNode(e){e=Tn.get(zl(c.X3DNode,e,!1));const t=this.getRootNodes();for(const n of t)if(n.equals(e))return;t.push(e)},removeRootNode(e){e=Tn.get(zl(c.X3DNode,e,!1));const t=this.getRootNodes();t.assign(t.filter((t=>t!==e)))},setRootNodes(e){if(!(e instanceof Qi.MFNode))throw new Error("Value must be of type MFNode.");this.getRootNodes().assign(e)},toVRMLStream(e){e.string+=e.Indent(),e.string+="#X3D V",e.string+=hO,e.string+=e.Space(),e.string+="utf8",e.string+=e.Space(),e.string+=this.getBrowser().name,e.string+=e.Space(),e.string+="V",e.string+=this.getBrowser().version,e.string+=e.ForceBreak(),e.string+=e.ForceBreak();const t=this.getProfile();t&&(t.toVRMLStream(e),e.string+=e.Break(),e.string+=e.TidyBreak());const n=this.getComponents();n.length&&(n.toVRMLStream(e),e.string+=e.TidyBreak());const i=this.getUnits().filter((e=>1!==e.conversionFactor));if(i.length){for(const t of i)t.toVRMLStream(e),e.string+=e.Break();e.string+=e.TidyBreak()}const s=this.getMetaDatas();if(s.size){for(const[t,n]of s)for(const i of n)e.string+=e.Indent(),e.string+="META",e.string+=e.Space(),e.string+=new Qi.SFString(t).toString(),e.string+=e.Space(),e.string+=new Qi.SFString(i).toString(),e.string+=e.Break();e.string+=e.TidyBreak()}const r=this.getExportedNodes();e.PushExecutionContext(this),e.EnterScope(),e.ExportedNodes(r),jh.prototype.toVRMLStream.call(this,e),r.length&&(e.string+=e.TidyBreak(),r.toVRMLStream(e)),e.LeaveScope(),e.PopExecutionContext()},toXMLStream(e){if(e.html||(e.string+=e.Indent(),e.string+='<?xml version="1.0" encoding="UTF-8"?>',e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D ',e.string+=hO,e.string+='//EN" "http://www.web3d.org/specifications/x3d-',e.string+=hO,e.string+='.dtd">',e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+="<X3D",e.string+=e.Space(),e.string+="profile='",e.string+=this.getProfile()?this.getProfile().name:"Full",e.string+="'",e.string+=e.Space(),e.string+="version='",e.string+=hO,e.string+="'",e.string+=e.Space(),e.string+="xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance'",e.string+=e.Space(),e.string+="xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-",e.string+=hO,e.string+=".xsd'>",e.string+=e.TidyBreak(),e.IncIndent(),this.getComponents().length||this.getUnits().some((e=>1!==e.conversionFactor))||this.getMetaDatas().size){e.string+=e.Indent(),e.string+="<head>",e.string+=e.TidyBreak(),e.IncIndent(),this.getComponents().toXMLStream(e);for(const t of this.getUnits())1!==t.conversionFactor&&(t.toXMLStream(e),e.string+=e.TidyBreak());for(const[t,n]of this.getMetaDatas())for(const i of n)e.string+=e.Indent(),e.string+="<meta",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(t),e.string+="'",e.string+=e.Space(),e.string+="content='",e.string+=e.XMLEncode(i),e.string+="'",e.string+=e.closingTags?"></meta>":"/>",e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="</head>",e.string+=e.TidyBreak()}if(this.getExternProtoDeclarations().length||this.getProtoDeclarations().length||this.getRootNodes().length){e.string+=e.Indent(),e.string+="<Scene>",e.string+=e.TidyBreak(),e.IncIndent();const t=this.getExportedNodes();e.PushExecutionContext(this),e.EnterScope(),e.ExportedNodes(t),jh.prototype.toXMLStream.call(this,e),t.toXMLStream(e),e.LeaveScope(),e.PopExecutionContext(),e.DecIndent(),e.string+=e.Indent(),e.string+="</Scene>",e.string+=e.TidyBreak()}else e.string+=e.Indent(),e.string+="<Scene/>",e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="</X3D>"},toJSONStream(e){e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="X3D",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="encoding",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+="UTF-8",e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@profile",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=this.getProfile()?this.getProfile().name:"Full",e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@version",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=hO,e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@xsd:noNamespaceSchemaLocation",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+="http://www.web3d.org/specifications/x3d-",e.string+=hO,e.string+=".xsd",e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="JSON schema",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+="http://www.web3d.org/specifications/x3d-",e.string+=hO,e.string+="-JSONSchema.json",e.string+='"',e.string+=",",e.string+=e.TidyBreak();const t=this.getUnits().some((e=>1!==e.conversionFactor));if(this.getComponents().length||t||this.getMetaDatas().size){let n=!1;if(e.string+=e.Indent(),e.string+='"',e.string+="head",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),this.getMetaDatas().size){n&&(e.string+=",",e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+='"',e.string+="meta",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const[t,[n,i]]of[...this.getMetaDatas()].entries())for(const[s,r]of i.entries())e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@content",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(r),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",t===this.getMetaDatas().size-1&&s===i.length-1||(e.string+=","),e.string+=e.TidyBreak();e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",n=!0}this.getComponents().length&&(n&&(e.string+=",",e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+='"',e.string+="component",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),this.getComponents().toJSONStream(e),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",n=!0),t&&(n&&(e.string+=",",e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+='"',e.string+="unit",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),this.getUnits().toJSONStream(e),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",n=!0),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=",",e.string+=e.TidyBreak()}e.string+=e.Indent(),e.string+='"',e.string+="Scene",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();const n=this.getExportedNodes();e.PushExecutionContext(this),e.EnterScope(),e.ExportedNodes(n),jh.prototype.toJSONStream.call(this,e),this.getExportedNodes().toJSONStream(e,!0),e.JSONRemoveComma(),e.LeaveScope(),e.PopExecutionContext(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}},{setExecutionContext(e){if(!this.isMainScene()){const e=this.getScene();for(const t of this[uO])e.removeLoadingObject(t)}if(jh.prototype.setExecutionContext.call(this,e),!this.isMainScene()){const e=this.getScene();for(const t of this[uO])e.addLoadingObject(t)}},addInitLoadCount(e){this._initLoadCount=this._initLoadCount.getValue()+1},removeInitLoadCount(e){this._initLoadCount=this._initLoadCount.getValue()-1},getLoadingObjects(){return this[uO]},addLoadingObject(e){if(this[uO].has(e))return;this[uO].add(e),this._loadCount=this[uO].size;const t=this.getBrowser(),n=this.getScene();this!==t.getExecutionContext()&&this.loader!==t.loader||t.addLoadingObject(e),this.isMainScene()||n.addLoadingObject(e)},removeLoadingObject(e){if(!this[uO].has(e))return;this[uO].delete(e),this._loadCount=this[uO].size;const t=this.getBrowser(),n=this.getScene();this!==t.getExecutionContext()&&this.loader!==t.loader||t.removeLoadingObject(e),this.isMainScene()||n.removeLoadingObject(e)}});for(const e of Reflect.ownKeys(cO.prototype))Object.defineProperty(cO.prototype,e,{enumerable:!1});Object.defineProperties(cO.prototype,{specificationVersion:{get:cO.prototype.getSpecificationVersion,enumerable:!0},encoding:{get:cO.prototype.getEncoding,enumerable:!0},profile:{get:cO.prototype.getProfile,enumerable:!0},profile_changed:{get(){return this._profile_changed},enumerable:!1},components:{get:cO.prototype.getComponents,enumerable:!0},worldURL:{get:cO.prototype.getWorldURL,enumerable:!0},units:{get:cO.prototype.getUnits,enumerable:!0},metadata_changed:{get(){return this._metadata_changed},enumerable:!1},rootNodes:{get:cO.prototype.getRootNodes,set:cO.prototype.setRootNodes,enumerable:!0},exportedNodes:{get:cO.prototype.getExportedNodes,enumerable:!0},sceneGraph_changed:{get(){return this._sceneGraph_changed},enumerable:!1}}),Object.defineProperties(cO,{typeName:{value:"X3DScene",enumerable:!0}}),c.addNode(cO);const dO=cO;n.set("x_ite/Execution/X3DScene",dO);const pO=dO,gO=new WeakMap,fO=new WeakMap,mO=new WeakMap,_O={get(e,t){const n=e[t];if(void 0!==n)return n;const i=e.getStorage()[e.getNameSpace()+t];if(void 0===i||"undefined"===i||null===i)return e.getDefaultValue(t);return JSON.parse(i)},set:(e,t,n)=>(void 0===n?e.getStorage().removeItem(e.getNameSpace()+t):e.getStorage()[e.getNameSpace()+t]=JSON.stringify(n),!0)};function xO(e,t){return this.target=this,gO.set(this,e),fO.set(this,t),mO.set(this,{}),new Proxy(this,_O)}Object.assign(xO.prototype,{getStorage(){return gO.get(this.target)},getNameSpace(){return fO.get(this.target)},addNameSpace(e){return new xO(this.getStorage(),this.getNameSpace()+e)},addDefaultValues(e){Object.assign(mO.get(this.target),e)},getDefaultValue(e){const t=mO.get(this.target)[e];return void 0===t?void 0:JSON.parse(JSON.stringify(t))},clear(){const e=this.getStorage(),t=this.getNameSpace();for(const n of Object.keys(e))n.startsWith(t)&&e.removeItem(n)}});const yO=xO;n.set("standard/Utility/DataStorage",yO);const wO=yO;var bO=i(666);const SO=Symbol(),vO=Symbol(),TO=Symbol(),OO=Symbol(),EO=Symbol(),CO=Symbol(),NO=Symbol(),FO=Symbol(),IO=Symbol(),MO=Symbol(),PO=Symbol(),DO=Symbol(),RO=Symbol(),AO=Symbol(),VO=Symbol(),LO=Symbol(),BO=Symbol(),UO=Symbol(),XO=Symbol();let jO=0;function kO(e){const t=bO("<div></div>").addClass("x_ite-private-browser").attr("tabindex",0),n=bO("<div></div>").addClass("x_ite-private-surface").appendTo(t),i=bO("<div></div>").hide().addClass("x_ite-private-splash-screen").appendTo(t),s=(bO("<div></div>").addClass("x_ite-private-spinner").appendTo(i),bO("<div></div>").addClass("x_ite-private-progress").appendTo(i));if("x3d-canvas"===e.prop("nodeName").toLowerCase()){const n=bO(e[0].attachShadow({mode:"open",delegatesFocus:!0})),i=bO("<link/>");i.on("load",(()=>t.show())).attr("rel","stylesheet").attr("type","text/css").attr("href",new URL("x_ite.css",uo.getScriptUrl()).href),this[TO]=n.append(i).append(t.hide())}else this[TO]=e.prepend(t);bO("<div></div>").addClass("x_ite-private-x_ite").html(this.getName()+"<span class='x_ite-private-x3d'>X3D</span>").appendTo(s),bO("<div></div>").addClass("x_ite-private-progressbar").appendTo(s).append(bO("<div></div>")),bO("<div></div>").addClass("x_ite-private-spinner-text").appendTo(s),this[SO]=++jO,this[vO]=e,this[OO]=n,this[EO]=bO("<canvas></canvas>").addClass("x_ite-private-canvas").prependTo(n),this[CO]=$v.create(this[EO][0],2,"true"===e.attr("preserveDrawingBuffer")),this[NO]=i,this[FO]=new wO(localStorage,"X_ITE.X3DBrowser("+this[SO]+")."),this[IO]=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this[RO]=new TT(this.getPrivateScene()),this[PO]=new xT(this.getPrivateScene()),this[DO]=new bT(this.getPrivateScene()),this[MO]=new lT(this.getPrivateScene()),this[AO]=new NT(this.getPrivateScene()),this[VO]=new DT(this.getPrivateScene());const r=bO("<div></div>").hide().css("height","10in").appendTo(bO("body"));this[XO]=r.height()/720||1,r.remove(),this.addChildObjects("controlKey",new Qi.SFBool,"shiftKey",new Qi.SFBool,"altKey",new Qi.SFBool,"altGrKey",new Qi.SFBool)}Object.assign(kO.prototype,{initialize(){this[RO].setup(),this[PO].setup(),this[DO].setup(),this[MO].setup(),this[AO].setup(),this[VO].setup(),Object.defineProperties(this.getElement().get(0),{browser:{value:this,enumerable:!0},src:{get:()=>this.getExecutionContext().getWorldURL(),set:e=>{this.loadURL(new Qi.MFString(e)).catch((e=>console.error(e)))},enumerable:!0},url:{get:()=>new Qi.MFString(this.getExecutionContext().getWorldURL()),set:e=>{this.loadURL(e).catch((e=>console.error(e)))},enumerable:!0}}),this.getElement().on("keydown.X3DCoreContext",this[BO].bind(this)).on("keyup.X3DCoreContext",this[UO].bind(this))},getInstanceId(){return this[SO]},isStrict:()=>!1,getElement(){return this[vO]},getShadow(){return this[TO]},getSurface(){return this[OO]},getSplashScreen(){return this[NO]},getCanvas(){return this[EO]},getContext(){return this[CO]},getMobile(){return this[IO]},getLocalStorage(){return this[FO]},getBrowserTimings(){return this[MO]},getBrowserOptions(){return this[PO]},getBrowserProperties(){return this[DO]},getRenderingProperties(){return this[RO]},getNotification(){return this[AO]},getContextMenu(){return this[VO]},getPrivateScene(){return this[LO]||(this[LO]=new pO(this),this[LO].setPrivate(!0),this[LO].setLive(!0),this[LO].setup()),this[LO]},getPixelPerPoint(){return this[XO]*this.getRenderingProperty("ContentScale")},connectedCallback(){},attributeChangedCallback(e,t,n){switch(e){case"antialiased":this.setBrowserOption("Antialiased",this.parseBooleanAttribute(n,!0));break;case"baseURL":case"baseurl":this.setBaseURL(n);break;case"cache":this.setBrowserOption("Cache",this.parseBooleanAttribute(n,!0));break;case"contentScale":case"contentscale":this.setBrowserOption("ContentScale","auto"===n?-1:parseFloat(n));break;case"contextMenu":case"contextmenu":this.setBrowserOption("ContextMenu",this.parseBooleanAttribute(n,!0));break;case"debug":this.setBrowserOption("Debug",this.parseBooleanAttribute(n,!1));break;case"multisampling":{const e=parseInt(n);this.setBrowserOption("Multisampling",isNaN(e)?4:e);break}case"notifications":this.setBrowserOption("Notifications",this.parseBooleanAttribute(n,!0));break;case"oninitialized":case"onshutdown":try{this.getElement()[0][e]=new Function("event",n)}catch(e){console.error(e)}break;case"splashScreen":case"splashscreen":this.setBrowserOption("SplashScreen",this.parseBooleanAttribute(n,!0)),this.getBrowserOption("SplashScreen")||(this.getCanvas().show(),this.getSplashScreen().stop(!0,!0).hide());break;case"src":n&&this.loadURL(new Qi.MFString(n)).catch((e=>console.error(e)));break;case"timings":this.setBrowserOption("Timings",this.parseBooleanAttribute(n,!1));break;case"update":"auto"===n?this.setBrowserOption("AutoUpdate",!0):(this.setBrowserOption("AutoUpdate",!1),this.parseBooleanAttribute(n,!0)?this.beginUpdate():this.endUpdate());break;case"url":n&&this.loadURL(this.parseUrlAttribute(n)).catch((e=>console.error(e)))}},parseBooleanAttribute:(e,t)=>"true"===e||"false"!==e&&t,parseUrlAttribute(e){const t=new Qi.MFString;return t.fromString("["+e+"]",this.getExecutionContext()),t},callBrowserEventHandler:function(){const e=new Set(["error","load"]);return function(t){const n=this.getElement()[0];for(const i of t.split(" ")){const t=new CustomEvent(i);try{e.has(i)||n[`on${i}`]?.(t)}catch(e){console.error(e)}n.dispatchEvent(t)}}}(),getShiftKey(){return this._shiftKey.getValue()},getControlKey(){return this._controlKey.getValue()},getAltKey(){return this._altKey.getValue()},getAltGrKey(){return this._altGrKey.getValue()},[BO](e){switch(e.keyCode){case 16:this._shiftKey=!0;break;case 17:this._controlKey=!0;break;case 18:this._altKey=!0;break;case 49:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","POINT"),this.getNotification()._string="Shading: Pointset");break;case 50:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","WIREFRAME"),this.getNotification()._string="Shading: Wireframe");break;case 51:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","FLAT"),this.getNotification()._string="Shading: Flat");break;case 52:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","GOURAUD"),this.getNotification()._string="Shading: Gouraud");break;case 53:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","PHONG"),this.getNotification()._string="Shading: Phong");break;case 83:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.isLive()?this.endUpdate():this.beginUpdate(),this.getNotification()._string=this.getLive().getValue()?"Begin Update":"End Update");break;case 225:this._altGrKey=!0;break;case 171:case 187:this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Timings",!this.getBrowserOption("Timings")));break;case 36:e.preventDefault(),this.firstViewpoint();break;case 35:e.preventDefault(),this.lastViewpoint();break;case 33:e.preventDefault(),this.previousViewpoint();break;case 34:e.preventDefault(),this.nextViewpoint();break;case 119:if(this.getShiftKey()){e.preventDefault();const t=this.getActiveViewpoint();if(!t)break;const n=this.getPrivateScene().createNode(t.getTypeName());switch(t.getTypeName()){case"Viewpoint":n.position=t.getUserPosition(),n.orientation=t.getUserOrientation(),n.centerOfRotation=t.getUserCenterOfRotation(),n.fieldOfView=t.getFieldOfView();break;case"OrthoViewpoint":n.position=t.getUserPosition(),n.orientation=t.getUserOrientation(),n.centerOfRotation=t.getUserCenterOfRotation(),n.fieldOfView=new Qi.MFFloat(t.getMinimumX(),t.getMinimumY(),t.getMaximumX(),t.getMaximumY());break;case"GeoViewpoint":{const e=t._geoOrigin,i=new Et(0,0,0);if(e.getValue()&&"GeoOrigin"===e.getNodeTypeName()){const t=this.getPrivateScene().createNode("GeoOrigin");n.geoOrigin=t,t.geoSystem=e.geoSystem,t.geoCoords=e.geoCoords,t.rotateYUp=e.rotateYUp}n.geoSystem=t._geoSystem,n.position=t.getGeoCoord(t.getUserPosition(),i),n.orientation=t.getUserOrientation(),n.centerOfRotation=t.getGeoCoord(t.getUserCenterOfRotation(),i),n.fieldOfView=t.getFieldOfView();break}}let i;switch(this.getExecutionContext().getEncoding()){case"ASCII":case"VRML":i=n.toVRMLString();break;case"JSON":i=n.toJSONString();break;default:i=n.toXMLString()}i+="\n",this.copyToClipboard(i),this.getNotification()._string=iT("Viewpoint copied to clipboard."),console.log("Viewpoint copied to clipboard."),console.debug(i)}}},[UO](e){switch(e.which){case 16:this._shiftKey=!1;break;case 17:this._controlKey=!1;break;case 18:this._altKey=!1;break;case 225:this._altGrKey=!1}},copyToClipboard(e){const t=bO("<textarea></textarea>");this.getShadow().find(".x_ite-private-browser").prepend(t),t.text(e).trigger("select"),document.execCommand("copy"),t.remove()},dispose(){this[CO].getExtension("WEBGL_lose_context")?.loseContext()}});const zO=kO;n.set("x_ite/Browser/Core/X3DCoreContext",zO);const GO=zO,HO=Symbol();function qO(){}Object.assign(qO.prototype,{getBackgroundTextureProperties(){return this[HO]=new Iv(this.getPrivateScene()),this[HO]._boundaryModeS="CLAMP_TO_EDGE",this[HO]._boundaryModeT="CLAMP_TO_EDGE",this[HO]._boundaryModeR="CLAMP_TO_EDGE",this[HO]._minificationFilter="NICEST",this[HO]._magnificationFilter="NICEST",this[HO]._textureCompression="DEFAULT",this[HO].setup(),this.getBackgroundTextureProperties=function(){return this[HO]},Object.defineProperty(this,"getBackgroundTextureProperties",{enumerable:!1}),this[HO]}});const YO=qO;n.set("x_ite/Browser/EnvironmentalEffects/X3DEnvironmentalEffectsContext",YO);const WO=YO;function $O(e){xs.call(this,e)}Object.assign(Object.setPrototypeOf($O.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this)},getGeometry(){if(this.geometry)return this.geometry;this.geometry=new up(this.getExecutionContext()),this.geometry._texCoord=new Tv(this.getExecutionContext()),this.geometry._coord=new Um(this.getExecutionContext());const e=this.geometry,t=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();return e._texCoordIndex=new Qi.MFInt32(0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1),e._coordIndex=new Qi.MFInt32(0,1,2,3,-1,5,4,7,6,-1,1,5,6,2,-1,4,0,3,7,-1,4,5,1,0,-1,3,2,6,7,-1),t._point=new Qi.MFVec2f(new Qi.SFVec2f(1,1),new Qi.SFVec2f(0,1),new Qi.SFVec2f(0,0),new Qi.SFVec2f(1,0)),n._point=new Qi.MFVec3f(new Qi.SFVec3f(1,1,1),new Qi.SFVec3f(-1,1,1),new Qi.SFVec3f(-1,-1,1),new Qi.SFVec3f(1,-1,1),new Qi.SFVec3f(1,1,-1),new Qi.SFVec3f(-1,1,-1),new Qi.SFVec3f(-1,-1,-1),new Qi.SFVec3f(1,-1,-1)),t.setup(),n.setup(),e.setup(),this.geometry}}),Object.defineProperties($O,{typeName:{value:"BoxOptions",enumerable:!0}});const KO=$O;n.set("x_ite/Browser/Geometry3D/BoxOptions",KO);const JO=KO;function ZO(e){xs.call(this,e),this.addChildObjects("xDimension",new Qi.SFInt32(20),"yDimension",new Qi.SFInt32(1))}Object.setPrototypeOf(ZO.prototype,xs.prototype),Object.defineProperties(ZO,{typeName:{value:"ConeOptions",enumerable:!0}});const QO=ZO;n.set("x_ite/Browser/Geometry3D/ConeOptions",QO);const eE=QO;function tE(e){xs.call(this,e),this.addChildObjects("xDimension",new Qi.SFInt32(20),"yDimension",new Qi.SFInt32(1))}Object.setPrototypeOf(tE.prototype,xs.prototype),Object.defineProperties(tE,{typeName:{value:"CylinderOptions",enumerable:!0}});const nE=tE;n.set("x_ite/Browser/Geometry3D/CylinderOptions",nE);const iE=nE;function sE(e){xs.call(this,e),this.addChildObjects("xDimension",new Qi.SFInt32(32),"yDimension",new Qi.SFInt32(15))}Object.assign(Object.setPrototypeOf(sE.prototype,xs.prototype),{initialize(){xs.prototype.initialize.call(this),this.addInterest("eventsProcessed",this)},getGeometry(){return this.geometry||this.eventsProcessed(),this.geometry},createTexCoordIndex(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),n=this.geometry._texCoordIndex;for(let t=0,i=e-1;t<i;++t)n.push(t),n.push(t+e-1),n.push(t+e),n.push(-1);for(let i=e-1,s=0,r=t-3;s<r;++s,++i)for(let t=0,s=e-1;t<s;++t,++i)n.push(i),n.push(i+e),n.push(i+e+1),n.push(i+1),n.push(-1);let i=(t-2)*e-1;for(let t=0,s=e-1;t<s;++t,++i)n.push(i+e),n.push(i+1),n.push(i),n.push(-1)},createTexCoord(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),n=this.geometry._texCoord.getValue()._point,i=-.5/(e-1);for(let t=1;t<e;++t){const s=t/(e-1)+i;n.push(new wt(s,1))}for(let i=1,s=t-1;i<s;++i){const s=1-i/(t-1);for(let t=0;t<e;++t){const i=t/(e-1);n.push(new wt(i,s))}}for(let t=1;t<e;++t){const s=t/(e-1)+i;n.push(new wt(s,0))}},createCoordIndex(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),n=this.geometry._coordIndex;let i=1;for(const t=e-1;i<t;++i)n.push(0),n.push(i),n.push(i+1),n.push(-1);n.push(0),n.push(i),n.push(1),n.push(-1);let s=1;for(let i=0,r=t-3;i<r;++i,++s){for(let t=0,i=e-2;t<i;++t,++s)n.push(s),n.push(s+e-1),n.push(s+e),n.push(s+1),n.push(-1);n.push(s),n.push(s+e-1),n.push(s+1),n.push(s-e+2),n.push(-1)}const r=s+e-1;for(let t=0,i=e-2;t<i;++t,++s)n.push(r),n.push(s+1),n.push(s),n.push(-1);n.push(r),n.push(r-e+1),n.push(s),n.push(-1)},createPoints(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),n=this.geometry._coord.getValue()._point;n.push(new Et(0,1,0));for(let i=1,s=t-1;i<s;++i){const t=Ro.Polar(1,-Math.PI*i/s);for(let i=0,s=e-1;i<s;++i){const e=Ro.Polar(t.imag,2*Math.PI*i/s);n.push(new Et(e.imag,t.real,e.real))}}n.push(new Et(0,-1,0))},eventsProcessed(){this.geometry=new up(this.getExecutionContext()),this.geometry._texCoord=new Tv(this.getExecutionContext()),this.geometry._coord=new Um(this.getExecutionContext()),this.createTexCoordIndex(),this.createTexCoord(),this.createCoordIndex(),this.createPoints();const e=this.geometry,t=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();e._creaseAngle=Math.PI,t.setup(),n.setup(),e.setup()}}),Object.defineProperties(sE,{typeName:{value:"QuadSphereOptions",enumerable:!0}});const rE=sE;n.set("x_ite/Browser/Geometry3D/QuadSphereOptions",rE);const oE=rE;function aE(){}function lE(e,t){const n=new t(this.getPrivateScene());return n.setup(),this[e]=function(){return n},Object.defineProperty(this,e,{enumerable:!1}),n}Object.assign(aE.prototype,{initialize(){this.setPrimitiveQuality3D(this.getBrowserOptions().getPrimitiveQuality())},getBoxOptions(){return lE.call(this,"getBoxOptions",JO)},getConeOptions(){return lE.call(this,"getConeOptions",eE)},getCylinderOptions(){return lE.call(this,"getCylinderOptions",iE)},getSphereOptions(){return lE.call(this,"getSphereOptions",oE)},setPrimitiveQuality3D(e){const t=this.getConeOptions(),n=this.getCylinderOptions(),i=this.getSphereOptions();switch(e){case cT.LOW:t._xDimension=16,n._xDimension=16,i._xDimension=20,i._yDimension=9;break;case cT.MEDIUM:t._xDimension=20,n._xDimension=20,i._xDimension=32,i._yDimension=15;break;case cT.HIGH:t._xDimension=32,n._xDimension=32,i._xDimension=64,i._yDimension=31}}});const uE=aE;n.set("x_ite/Browser/Geometry3D/X3DGeometry3DContext",uE);const hE=uE,cE=Symbol();function dE(){}Object.assign(dE.prototype,{getBBoxNode(){const e=new db(this.getPrivateScene()),t=new Hm(this.getPrivateScene()),n=new Um(this.getPrivateScene());return e._geometry=t,t._coordIndex=[0,1,2,3,0,-1,4,5,6,7,4,-1,0,4,-1,1,5,-1,2,6,-1,3,7,-1],t._coord=n,n._point=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5],n.setup(),t.setup(),e.setup(),this[cE]=e,this.getBBoxNode=function(){return this[cE]},Object.defineProperty(this,"getBBoxNode",{enumerable:!1}),e}});const pE=dE;n.set("x_ite/Browser/Grouping/X3DGroupingContext",pE);const gE=pE,fE=Symbol();function mE(){this[fE]=new Ig(this.getPrivateScene())}Object.assign(mE.prototype,{initialize(){this[fE].setPrivate(!0),this[fE].setup()},getDefaultViewport(){return this[fE]}});const _E=mE;n.set("x_ite/Browser/Layering/X3DLayeringContext",_E);const xE=_E,yE=Symbol(),wE=Symbol();function bE(){const e=this.getContext(),t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this[yE]=t>8?8:2,this[wE]=[]}Object.assign(bE.prototype,{getMaxLights(){return this[yE]},popShadowBuffer(e){try{const t=this[wE][e];if(t){if(t.length)return t.pop()}else this[wE][e]=[];return new Oa(this,e,e,!0)}catch(e){return console.error(e),null}},pushShadowBuffer(e){e&&this[wE][e.getWidth()].push(e)}});const SE=bE;n.set("x_ite/Browser/Lighting/X3DLightingContext",SE);const vE=SE;function TE(e,t){xs.call(this,e),this.navigationInfo=t}Object.assign(Object.setPrototypeOf(TE.prototype,xs.prototype),{getActiveLayer(){return this.getBrowser().getActiveLayer()},getViewport(){return this.getBrowser().getActiveLayer().getViewport().getRectangle()},getNavigationInfo(){return this.navigationInfo},getActiveViewpoint(){return this.getBrowser().getActiveLayer().getViewpoint()},getStraightenHorizon(){return this.getBrowser().getBrowserOption("StraightenHorizon")},getButton(e){return 0===e&&this.getBrowser().getAltKey()?1:e},getPointer(e){const t=this.getBrowser(),n=t.getRenderingProperty("ContentScale"),i=t.getSurface().offset();return[(e.pageX-i.left)*n,t.getViewport()[3]-(e.pageY-i.top)*n]},isPointerInRectangle:function(){const e=new wt(0,0);return function(t,n){const i=this.getBrowser(),s=this.getViewport();return i.isPointerInRectangle(s,e.set(t,n))}}(),getPointOnCenterPlane:function(){const e=new Et(0,0,-1),t=new Et(0,0,0),n=new Et(0,0,0);return function(i,s,r){const o=this.getNavigationInfo(),a=this.getActiveViewpoint(),l=this.getViewport(),u=a.getProjectionMatrixWithLimits(o.getNearValue(),o.getFarValue(a),l);if(Sa.unProjectPoint(i,s,.9,_n.Identity,u,l,n),a instanceof _f)return r.set(n.x,n.y,-this.getDistanceToCenter(t).magnitude());const h=n.normalize();return r.assign(h).multiply(this.getDistanceToCenter(t).magnitude()/h.dot(e))}}(),getDistanceToCenter(e,t){const n=this.getActiveViewpoint();return e.assign(n.getPosition()).add(t||n._positionOffset.getValue()).subtract(n.getUserCenterOfRotation())},trackballProjectToSphere(e,t,n){const i=this.getViewport();return e=(e-i[0])/i[2]-.5,t=(t-i[1])/i[3]-.5,n.set(e,t,function(e,t,n){const i=Math.hypot(t,n);if(i<e*Math.sqrt(.5))return Math.sqrt(e*e-i*i);const s=e/Math.sqrt(2);return s*s/i}(.5,e,t))},lookAtPoint(e,t,n){if(!this.touch(e,t))return;const i=this.getActiveViewpoint(),s=this.getBrowser().getHit();i.lookAtPoint(this.getActiveLayer(),s.point,.381966,n)},lookAtBBox(e,t,n){if(!this.touch(e,t))return;const i=this.getActiveViewpoint(),s=this.getBrowser().getHit(),r=s.shapeNode.getBBox(new La).multRight(s.modelViewMatrix).multRight(i.getCameraSpaceMatrix());i.lookAtBBox(this.getActiveLayer(),r,.381966,n)},touch(e,t){return this.getBrowser().touch(e,t)}});const OE=TE;n.set("x_ite/Browser/Navigation/X3DViewer",OE);const EE=OE;i(906);var CE=i(666);const NE=/Mac OS X/i.test(navigator.userAgent),FE=NE?1/120:.05;function IE(e,t){EE.call(this,e,t),this.button=-1,this.orientationOffset=new dn,this.fromVector=new Et(0,0,0),this.toVector=new Et(0,0,0),this.fromPoint=new Et(0,0,0),this.toPoint=new Et(0,0,0),this.rotation=new dn,this.direction=new Et(0,0,0),this.axis=new Et(0,0,0),this.pressTime=0,this.motionTime=0,this.touchMode=0,this.touch1=new wt(0,0),this.touch2=new wt(0,0),this.tapStart=0,this.dblTapInterval=.4,this.initialPositionOffset=new Et(0,0,0),this.initialOrientationOffset=new dn,this.positionChaser=new xd(e),this.centerOfRotationChaser=new xd(e),this.rotationChaser=new hd(e),this.timeSensor=new fu(e)}Object.assign(Object.setPrototypeOf(IE.prototype,EE.prototype),{initialize(){EE.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getSurface();this.getNavigationInfo()._transitionStart.addInterest("disconnect",this),e.getBrowserOptions()._StraightenHorizon.addInterest("disconnect",this),e._activeViewpoint.addInterest("set_activeViewpoint__",this),t.on("mousedown.ExamineViewer",this.mousedown.bind(this)),t.on("mouseup.ExamineViewer",this.mouseup.bind(this)),t.on("dblclick.ExamineViewer",this.dblclick.bind(this)),t.on("mousewheel.ExamineViewer",this.mousewheel.bind(this)),t.on("touchstart.ExamineViewer",this.touchstart.bind(this)),t.on("touchend.ExamineViewer",this.touchend.bind(this)),this.positionChaser._duration=.2,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.2,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.rotationChaser._duration=.2,this.rotationChaser.setPrivate(!0),this.rotationChaser.setup(),this.timeSensor._loop=!0,this.timeSensor._stopTime=e.getCurrentTime(),this.timeSensor.setPrivate(!0),this.timeSensor.setup(),this.timeSensor._fraction_changed.addInterest("spin",this),this.set_activeViewpoint__()},set_activeViewpoint__(){if(this.getStraightenHorizon()){const e=this.getActiveViewpoint();e&&(e._orientationOffset=this.getOrientationOffset(dn.Identity,e._orientationOffset.getValue(),!1))}this.disconnect()},mousedown(e){if(this.button>=0)return;this.pressTime=Date.now();const[t,n]=this.getPointer(e);if(this.isPointerInRectangle(t,n))switch(this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,CE(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),CE(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),CE(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),CE(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.trackballProjectToSphere(t,n,this.fromVector),this.rotation.assign(dn.Identity),this.motionTime=0,this._isActive=!0;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,CE(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),CE(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),CE(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),CE(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(t,n,this.fromPoint),this._isActive=!0}},mouseup(e){if(e.button===this.button)switch(this.button=-1,CE(document).off(".ExamineViewer"+this.getId()),this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),Math.abs(this.rotation.angle)>.003&&Date.now()-this.motionTime<40&&this.addSpinning(this.rotation),this._isActive=!1;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1}},dblclick(e){e.preventDefault(),e.stopImmediatePropagation();const[t,n]=this.getPointer(e);this.disconnect(),this.lookAtBBox(t,n,this.getStraightenHorizon())},mousemove:function(){const e=new Et(0,0,0);return function(t){const[n,i]=this.getPointer(t);switch(this.getButton(this.button)){case 0:{t.preventDefault(),t.stopImmediatePropagation();const e=this.trackballProjectToSphere(n,i,this.toVector);if(this.rotation.setFromToVec(e,this.fromVector),Math.abs(this.rotation.angle)<.003&&Date.now()-this.pressTime<50)return;this.addRotate(this.rotation),this.fromVector.assign(e),this.motionTime=Date.now();break}case 1:{t.preventDefault(),t.stopImmediatePropagation();const s=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(n,i,this.toPoint),o=s.getUserOrientation().multVecRot(e.assign(this.fromPoint).subtract(r));this.addMove(o,o),this.fromPoint.assign(r);break}}}}(),mousewheel:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n){const[i,s]=this.getPointer(n);if(!this.isPointerInRectangle(i,s))return;n.preventDefault(),n.stopImmediatePropagation();const r=this.getBrowser(),o=this.getActiveViewpoint();r.prepareEvents().removeInterest("spin",this),o.transitionStop(),this.getDistanceToCenter(e).multiply(n.zoomFactor||FE),o.getUserOrientation().multVecRot(t.set(0,0,e.magnitude())),n.deltaY>0?this.addMove(t.negate(),Et.Zero):n.deltaY<0&&this.addMove(t,Et.Zero)}}(),touchstart(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY);break;case 2:this.touchend(e),e.button=1,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY),this.touch2.set(t[1].pageX,t[1].pageY);break;case 3:this.touchend(e)}},touchend(e){switch(this.button){case 0:e.button=0,e.pageX=this.touch1.x,e.pageY=this.touch1.y,this.mouseup(e),this.tapedTwice?this.dblclick(e):(this.tapedTwice=!0,setTimeout((()=>this.tapedTwice=!1),300));break;case 1:this.touchMode=0,e.button=1,this.mouseup(e)}},touchmove:function(){const e=new wt(0,0),t=new wt(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:n.pageX=i[0].pageX,n.pageY=i[0].pageY,this.mousemove(n);break;case 2:{e.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),t.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const s=e.dot(t)>.7,r=e.dot(t)<-.7;switch(this.touchMode||(s?1:r?2:0)){case 1:this.touchMode=1,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);break;case 2:{this.touchMode=2;const e=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const t=this.touch1.distance(this.touch2)-e;n.deltaY=t,n.zoomFactor=Math.abs(t)/CE(window).width(),n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousewheel(n);break}}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),set_positionOffset__(e){this.getActiveViewpoint()._positionOffset=e},set_centerOfRotationOffset__(e){this.getActiveViewpoint()._centerOfRotationOffset=e},set_rotation__(e){const t=this.getActiveViewpoint();t._orientationOffset=this.getOrientationOffset(e.getValue(),this.initialOrientationOffset,!1),t._positionOffset=this.getPositionOffset(this.initialPositionOffset,this.initialOrientationOffset,t._orientationOffset.getValue())},addRotate:function(){const e=new dn;return function(t){const n=this.getActiveViewpoint();if(this.rotationChaser._isActive.getValue()&&this.rotationChaser._value_changed.hasInterest("set_rotation__",this))try{e.assign(this.rotationChaser._set_destination.getValue()).multLeft(t),this.getOrientationOffset(e,this.initialOrientationOffset,!0),this.rotationChaser._set_destination=e}catch{t=this.getHorizonRotation(t),e.assign(this.rotationChaser._set_destination.getValue()).multLeft(t),this.rotationChaser._set_destination=e}else try{this.initialOrientationOffset.assign(n._orientationOffset.getValue()),this.initialPositionOffset.assign(n._positionOffset.getValue()),this.getOrientationOffset(t,this.initialOrientationOffset,!0),this.rotationChaser._set_value=dn.Identity,this.rotationChaser._set_destination=t}catch{this.rotationChaser._set_value=dn.Identity,this.rotationChaser._set_destination=this.getHorizonRotation(t)}this.disconnect(),this.rotationChaser._value_changed.addInterest("set_rotation__",this)}}(),addSpinning(e){if(this.disconnect(),this.getStraightenHorizon()){const t=this.getActiveViewpoint(),n=t.getUserPosition(),i=t.getUserCenterOfRotation(),s=n.copy().subtract(i),r=this.getHorizonRotation(e),o=t.getUpVector(!0);this.axis.assign(o),r.getAxis(new Et(0,0,0)).dot(Et.yAxis)<0!=r.angle<0&&this.axis.negate(),this.timeSensor._cycleInterval=Math.PI/(.4*e.angle*30),this.timeSensor._startTime=this.getBrowser().getCurrentTime();const a=t.getLookAtRotation(n,i);this.direction.assign(s),this.orientationOffset.assign(t.getUserOrientation()).multRight(a.inverse())}else this.getBrowser().prepareEvents().addInterest("spin",this),this.rotation.assign(e)},spin:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new dn,i=new dn;return function(){const s=this.getActiveViewpoint();if(this.getStraightenHorizon()){const i=s.getUserCenterOfRotation(),r=this.timeSensor._fraction_changed.getValue(),o=new dn(this.axis,2*Math.PI*r).multVecRot(e.assign(this.direction)).add(i),a=s.getLookAtRotation(o,s.getUserCenterOfRotation());t.assign(o).subtract(s.getPosition()),n.assign(s.getOrientation()).inverse().multRight(this.orientationOffset).multRight(a),s._positionOffset=t,s._orientationOffset=n}else i.assign(dn.Identity).slerp(this.rotation,24/this.getBrowser().getCurrentFrameRate()),this.orientationOffset.assign(s._orientationOffset.getValue()),s._orientationOffset=this.getOrientationOffset(i,this.orientationOffset),s._positionOffset=this.getPositionOffset(s._positionOffset.getValue(),this.orientationOffset,s._orientationOffset.getValue())}}(),addMove:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i){const s=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(e.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=e):(e.assign(s._positionOffset.getValue()).add(n),this.positionChaser._set_value=s._positionOffset,this.positionChaser._set_destination=e),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(t.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=t):(t.assign(s._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=s._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=t),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),getPositionOffset:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new dn;return function(i,s,r){return this.getDistanceToCenter(e,i),n.assign(s).inverse().multRight(r).multVecRot(t.assign(e)).subtract(e).add(i)}}(),getOrientationOffset:function(){const e=new dn,t=new dn,n=new Et(0,0,0);return function(i,s,r){const o=this.getActiveViewpoint(),a=this.getStraightenHorizon();e.assign(i).multRight(o.getOrientation()).multRight(s),a&&o.straightenHorizon(e);const l=t.assign(o.getOrientation()).inverse().multRight(e);if(a){if(!r)return l;const t=e.multVecRot(n.assign(Et.zAxis));if(Math.abs(o.getUpVector(!0).dot(t))<.97)return l;throw new Error("Critical angle")}return l}}(),getHorizonRotation:function(){const e=new Et(0,0,0);return function(t){const n=t.multVecRot(e.assign(Et.zAxis)),i=Et.yAxis.copy().cross(n).copy().cross(Et.yAxis);return new dn(Et.zAxis,i)}}(),disconnect(){const e=this.getBrowser();this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this),this.rotationChaser._value_changed.removeInterest("set_rotation__",this),this.timeSensor._stopTime=e.getCurrentTime(),e.prepareEvents().removeInterest("spin",this)},dispose(){const e=this.getBrowser();this.disconnect(),this.getNavigationInfo()._transitionStart.removeInterest("disconnect",this),e.getBrowserOptions()._StraightenHorizon.removeInterest("disconnect",this),e._activeViewpoint.removeInterest("set_activeViewpoint__",this),e.getSurface().off(".ExamineViewer"),CE(document).off(".ExamineViewer"+this.getId())}}),Object.defineProperties(IE,{typeName:{value:"ExamineViewer",enumerable:!0},fieldDefinitions:{value:new te([new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const ME=IE;n.set("x_ite/Browser/Navigation/ExamineViewer",ME);const PE=ME;i(906);var DE=i(666);const RE=/Mac OS X/i.test(navigator.userAgent),AE=.007,VE=RE?Math.PI/512:Math.PI/32;function LE(e,t){EE.call(this,e,t);const n=this.getBrowser().getContext();this.button=-1,this.fromVector=new Et(0,0,0),this.toVector=new Et(0,0,0),this.direction=new Et(0,0,0),this.startTime=0,this.event=null,this.lookAround=!1,this.orientationChaser=new hd(e),this.lineCount=2,this.lineArray=new Float32Array(4*this.lineCount).fill(1),this.lineBuffer=n.createBuffer(),this.lineArrayObject=new fl(n),this.geometryContext=new Nl({geometryType:1})}Object.assign(Object.setPrototypeOf(LE.prototype,EE.prototype),{initialize(){EE.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getSurface();t.on("mousedown.X3DFlyViewer",this.mousedown.bind(this)),t.on("mouseup.X3DFlyViewer",this.mouseup.bind(this)),t.on("mousewheel.X3DFlyViewer",this.mousewheel.bind(this)),t.on("touchstart.X3DFlyViewer",this.touchstart.bind(this)),t.on("touchend.X3DFlyViewer",this.touchend.bind(this)),e._controlKey.addInterest("set_controlKey__",this),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},addCollision(){},removeCollision(){},set_controlKey__(){this.event&&0===this.event.button&&(this.button=-1,this.mousedown(this.event))},mousedown(e){if(this.button>=0)return;this.event=e;const[t,n]=this.getPointer(e);if(this.isPointerInRectangle(t,n))switch(this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,DE(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),DE(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),DE(document).on("touchend.X3DFlyViewer"+this.getId(),this.touchend.bind(this)),DE(document).on("touchmove.X3DFlyViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.getBrowser().getControlKey()||this.lookAround?this.trackballProjectToSphere(t,n,this.fromVector):(this.fromVector.set(t,0,-n),this.toVector.assign(this.fromVector),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.addFly(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finishedEvents().addInterest("display",this,0)),this._isActive=!0;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,DE(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),DE(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.fromVector.set(t,n,0),this.toVector.assign(this.fromVector),this.direction.set(0,0,0),this.addPan(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finishedEvents().addInterest("display",this,1),this._isActive=!0}},mouseup(e){e.preventDefault(),e.button===this.button&&(this.event=null,this.button=-1,DE(document).off(".X3DFlyViewer"+this.getId()),this.disconnect(),this.getBrowser().setCursor("DEFAULT"),this.removeCollision(),this._isActive=!1)},mousemove(e){const t=this.getBrowser();t.addBrowserEvent(),this.event=e;const[n,i]=this.getPointer(e);switch(this.getButton(this.button)){case 0:if(t.getControlKey()||this.lookAround){e.preventDefault(),e.stopImmediatePropagation();const t=this.trackballProjectToSphere(n,i,this.toVector);this.addRotation(this.fromVector,t),this.fromVector.assign(t);break}this.toVector.set(n,0,-i),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.direction.divide(t.getRenderingProperty("ContentScale"));break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.toVector.set(n,i,0),this.direction.assign(this.toVector).subtract(this.fromVector),this.direction.divide(t.getRenderingProperty("ContentScale"))}},mousewheel(e){const[t,n]=this.getPointer(e);if(!this.isPointerInRectangle(t,n))return;e.preventDefault(),e.stopImmediatePropagation();this.getActiveViewpoint().transitionStop(),e.deltaY>0?this.addRoll(-VE):e.deltaY<0&&this.addRoll(VE)},touchstart(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e);break;case 2:this.touchend(e),this.lookAround=!0,e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e);break;case 3:this.touchend(e)}},touchend(e){if(0===this.button)this.lookAround=!1,e.button=0,this.mouseup(e)},touchmove(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousemove(e);break;case 2:e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousemove(e)}},fly:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new Et(0,0,0),i=new dn,s=new dn,r=new dn;return function(){const o=this.getNavigationInfo(),a=this.getActiveViewpoint(),l=Date.now(),u=(l-this.startTime)/1e3;e.assign(a.getUpVector()),this.direction.z>0?r.setFromToVec(this.direction,n.set(0,0,1)):r.setFromToVec(n.set(0,0,-1),this.direction);const h=this.direction.magnitude();let c=1-r.angle/(Math.PI/2);c*=o._speed.getValue(),c*=a.getSpeedFactor(),c*=this.getBrowser().getShiftKey()?.028:AE,c*=u;const d=this.getTranslationOffset(t.assign(this.direction).multiply(c));this.getActiveLayer().constrainTranslation(d,!0),a._positionOffset=d.add(a._positionOffset.getValue());const p=1.4*u*Math.pow(h/(h+40),2);i.assign(dn.Identity).slerp(r,p).multRight(a.getUserOrientation()),this.getStraightenHorizon()&&a.straightenHorizon(i),s.assign(a.getOrientation()).inverse().multRight(i),a._orientationOffset=s,this.startTime=l}}(),pan:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(){const n=this.getNavigationInfo(),i=this.getActiveViewpoint(),s=Date.now(),r=(s-this.startTime)/1e3,o=i.getUpVector();this.constrainPanDirection(e.assign(this.direction));let a=1;a*=n._speed.getValue(),a*=i.getSpeedFactor(),a*=this.getBrowser().getShiftKey()?.0098:.007,a*=r;const l=i.getUserOrientation().multRight(new dn(i.getUserOrientation().multVecRot(t.assign(Et.yAxis)),o)).multVecRot(e.multiply(a));this.getActiveLayer().constrainTranslation(l,!0),i._positionOffset=l.add(i._positionOffset.getValue()),this.startTime=s}}(),set_orientationOffset__(e){this.getActiveViewpoint()._orientationOffset=e},addFly(){this.startTime||(this.getBrowser().prepareEvents().addInterest("fly",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addPan(){this.startTime||(this.disconnect(),this.getBrowser().prepareEvents().addInterest("pan",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addRoll:function(){const e=new dn,t=new dn;return function(n){const i=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.assign(i.getOrientation()).inverse().multRight(t.set(1,0,0,n)).multRight(i.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.orientationChaser._set_destination=e):(e.assign(i.getOrientation()).inverse().multRight(t.set(1,0,0,n)).multRight(i.getUserOrientation()),this.orientationChaser._set_value=i._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),addRotation:function(){const e=new dn,t=new dn;return function(n,i){const s=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.setFromToVec(i,n).multRight(s.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.getStraightenHorizon()&&s.straightenHorizon(e),t.assign(s.getOrientation()).inverse().multRight(e),this.orientationChaser._set_destination=t):(e.setFromToVec(i,n).multRight(s.getUserOrientation()),this.getStraightenHorizon()&&s.straightenHorizon(e),t.assign(s.getOrientation()).inverse().multRight(e),this.orientationChaser._set_value=s._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),display:function(){const e=new Et(0,0,0),t=new Et(0,0,0),n=new _n,i=new Float32Array(_n.Identity),s=new Float32Array(_n.Identity),r=[];return function(o){const a=this.getBrowser(),l=a.getContext(),u=a.getViewport(),h=u[2],c=u[3];switch(i.set(Ra.ortho(0,h,0,c,-1,1,n)),o){case 0:e.set(this.fromVector.x,-this.fromVector.z,0),t.set(this.toVector.x,-this.toVector.z,0);break;case 1:e.set(this.fromVector.x,this.fromVector.y,0),t.set(this.toVector.x,this.toVector.y,0)}this.lineArray.set(e,0),this.lineArray.set(t,4),l.bindBuffer(l.ARRAY_BUFFER,this.lineBuffer),l.bufferData(l.ARRAY_BUFFER,this.lineArray,l.DYNAMIC_DRAW);const d=a.getDefaultMaterial().getShader(this.geometryContext);d.enable(l),d.setClipPlanes(l,r),l.uniformMatrix4fv(d.x3d_ProjectionMatrix,!1,i),l.uniformMatrix4fv(d.x3d_ModelViewMatrix,!1,s),this.lineArrayObject.enable(d)&&d.enableVertexAttribute(l,this.lineBuffer,0,0),l.disable(l.DEPTH_TEST),l.uniform3f(d.x3d_EmissiveColor,0,0,0),l.uniform1f(d.x3d_Transparency,0),l.drawArrays(l.LINES,0,this.lineCount),l.uniform3f(d.x3d_EmissiveColor,1,1,1),l.drawArrays(l.LINES,0,this.lineCount)}}(),disconnect(){const e=this.getBrowser();e.addBrowserEvent(),e.prepareEvents().removeInterest("fly",this),e.prepareEvents().removeInterest("pan",this),e.finishedEvents().removeInterest("display",this),this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.startTime=0},dispose(){const e=this.getBrowser().getContext();e.deleteBuffer(this.lineBuffer),this.lineArrayObject.delete(e),this.disconnect(),this.getBrowser()._controlKey.removeInterest("set_controlKey__",this),this.getBrowser().getSurface().off(".X3DFlyViewer"),DE(document).off(".X3DFlyViewer"+this.getId())}});const BE=LE;n.set("x_ite/Browser/Navigation/X3DFlyViewer",BE);const UE=BE;function XE(e,t){UE.call(this,e,t)}Object.assign(Object.setPrototypeOf(XE.prototype,UE.prototype),{initialize(){UE.prototype.initialize.call(this),this.getBrowser().addCollision(this)},getStraightenHorizon:()=>!0,getFlyDirection:(e,t,n)=>n.assign(t).subtract(e),getTranslationOffset:function(){const e=new Et(0,0,0),t=new dn,n=new dn;return function(i){const s=this.getActiveViewpoint(),r=s.getUpVector();t.assign(s.getUserOrientation()),t.multVecRot(e.assign(Et.yAxis)),n.setFromToVec(e,r);return t.multRight(n).multVecRot(i)}}(),constrainPanDirection:e=>(e.y<0&&(e.y=0),e),dispose(){this.getBrowser().removeCollision(this),UE.prototype.dispose.call(this)}}),Object.defineProperties(XE,{typeName:{value:"WalkViewer",enumerable:!0},fieldDefinitions:{value:new te([new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const jE=XE;n.set("x_ite/Browser/Navigation/WalkViewer",jE);const kE=jE;function zE(e,t){UE.call(this,e,t)}Object.assign(Object.setPrototypeOf(zE.prototype,UE.prototype),{addCollision(){this.getBrowser().addCollision(this)},removeCollision(){this.getBrowser().removeCollision(this)},getFlyDirection:(e,t,n)=>n.assign(t).subtract(e),getTranslationOffset(e){return this.getActiveViewpoint().getUserOrientation().multVecRot(e)},constrainPanDirection:e=>e}),Object.defineProperties(zE,{typeName:{value:"FlyViewer",enumerable:!0},fieldDefinitions:{value:new te([new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const GE=zE;n.set("x_ite/Browser/Navigation/FlyViewer",GE);const HE=GE;i(906);var qE=i(666);const YE=/Mac OS X/i.test(navigator.userAgent)?1/160:.05,WE=new Et(0,0,0),$E=new Et(0,0,0),KE=new Et(0,0,0);function JE(e,t){EE.call(this,e,t),this.button=-1,this.fromPoint=new Et(0,0,0),this.toPoint=new Et(0,0,0)}Object.assign(Object.setPrototypeOf(JE.prototype,EE.prototype),{initialize(){EE.prototype.initialize.call(this);const e=this.getBrowser().getSurface();e.on("mousedown.PlaneViewer",this.mousedown.bind(this)),e.on("mouseup.PlaneViewer",this.mouseup.bind(this)),e.on("mousemove.PlaneViewer",this.mousemove.bind(this)),e.on("mousewheel.PlaneViewer",this.mousewheel.bind(this))},mousedown(e){if(this.button>=0)return;const[t,n]=this.getPointer(e);if(this.isPointerInRectangle(t,n)&&1===this.getButton(e.button))e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,this.getBrowser().getSurface().off("mousemove.PlaneViewer"),qE(document).on("mouseup.PlaneViewer"+this.getId(),this.mouseup.bind(this)),qE(document).on("mousemove.PlaneViewer"+this.getId(),this.mousemove.bind(this)),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(t,n,this.fromPoint),this._isActive=!0},mouseup(e){e.preventDefault(),e.stopImmediatePropagation(),e.button===this.button&&(this.button=-1,qE(document).off(".PlaneViewer"+this.getId()),this.getBrowser().getSurface().on("mousemove.PlaneViewer",this.mousemove.bind(this)),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1)},mousemove(e){const[t,n]=this.getPointer(e);switch(this.getButton(this.button)){case 1:{e.preventDefault(),e.stopImmediatePropagation();const i=this.getActiveViewpoint(),s=this.getPointOnCenterPlane(t,n,this.toPoint),r=i.getUserOrientation().multVecRot(this.fromPoint.subtract(s));i._positionOffset=$E.assign(i._positionOffset.getValue()).add(r),i._centerOfRotationOffset=KE.assign(i._centerOfRotationOffset.getValue()).add(r),this.fromPoint.assign(s);break}}},mousewheel(e){const[t,n]=this.getPointer(e);if(!this.isPointerInRectangle(t,n))return;e.preventDefault(),e.stopImmediatePropagation();const i=this.getActiveViewpoint(),s=this.getPointOnCenterPlane(t,n,this.fromPoint);i.transitionStop(),e.deltaY>0?i._fieldOfViewScale=Math.max(1e-5,i._fieldOfViewScale.getValue()*(1-YE)):e.deltaY<0&&(i._fieldOfViewScale=i._fieldOfViewScale.getValue()*(1+YE),this.constrainFieldOfViewScale());const r=this.getPointOnCenterPlane(t,n,this.toPoint),o=i.getUserOrientation().multVecRot(WE.assign(s).subtract(r));i._positionOffset=$E.assign(i._positionOffset.getValue()).add(o),i._centerOfRotationOffset=KE.assign(i._centerOfRotationOffset.getValue()).add(o)},constrainFieldOfViewScale(){const e=this.getActiveViewpoint();e.getTypeName().match(/^(?:Viewpoint|GeoViewpoint)$/)&&e._fieldOfView.getValue()*e._fieldOfViewScale.getValue()>=Math.PI&&(e._fieldOfViewScale=(Math.PI-.001)/e._fieldOfView.getValue())},dispose(){this.getBrowser().getSurface().off(".PlaneViewer"),qE(document).off(".PlaneViewer"+this.getId())}}),Object.defineProperties(JE,{typeName:{value:"PlaneViewer",enumerable:!0},fieldDefinitions:{value:new te([new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const ZE=JE;n.set("x_ite/Browser/Navigation/PlaneViewer",ZE);const QE=ZE;function eC(e,t){EE.call(this,e,t)}Object.setPrototypeOf(eC.prototype,EE.prototype),Object.defineProperties(eC,{typeName:{value:"NoneViewer",enumerable:!0},fieldDefinitions:{value:new te([new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const tC=eC;n.set("x_ite/Browser/Navigation/NoneViewer",tC);const nC=tC;i(906);var iC=i(666);const sC=/Mac OS X/i.test(navigator.userAgent)?1/120:.05;function rC(e,t){EE.call(this,e,t),this.button=-1,this.fromVector=new Et(0,0,0),this.toVector=new Et(0,0,0),this.touch1=new wt(0,0),this.touch2=new wt(0,0),this.tapStart=0,this.dblTapInterval=.4,this.positionChaser=new xd(e),this.centerOfRotationChaser=new xd(e),this.orientationChaser=new hd(e)}Object.assign(Object.setPrototypeOf(rC.prototype,EE.prototype),{initialize(){EE.prototype.initialize.call(this);const e=this.getBrowser().getSurface();e.on("mousedown.LookAtViewer",this.mousedown.bind(this)),e.on("mouseup.LookAtViewer",this.mouseup.bind(this)),e.on("dblclick.LookAtViewer",this.dblclick.bind(this)),e.on("mousewheel.LookAtViewer",this.mousewheel.bind(this)),e.on("touchstart.LookAtViewer",this.touchstart.bind(this)),e.on("touchend.LookAtViewer",this.touchend.bind(this)),this.positionChaser._duration=.3,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.3,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},mousedown(e){if(this.button>=0)return;const[t,n]=this.getPointer(e);if(this.isPointerInRectangle(t,n)&&0===e.button)e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,iC(document).on("mouseup.LookAtViewer"+this.getId(),this.mouseup.bind(this)),iC(document).on("mousemove.LookAtViewer"+this.getId(),this.mousemove.bind(this)),iC(document).on("touchend.LookAtViewer"+this.getId(),this.mouseup.bind(this)),iC(document).on("touchmove.LookAtViewer"+this.getId(),this.touchmove.bind(this)),this.getActiveViewpoint().transitionStop(),this.trackballProjectToSphere(t,n,this.fromVector),this._isActive=!0},mouseup(e){if(e.button===this.button&&(this.button=-1,iC(document).off(".LookAtViewer"+this.getId()),0===e.button))e.preventDefault(),e.stopImmediatePropagation(),this._isActive=!1},dblclick(e){e.preventDefault(),e.stopImmediatePropagation();const[t,n]=this.getPointer(e);this.disconnect(),this.lookAtPoint(t,n,this.getStraightenHorizon())},mousemove(e){this.getBrowser().addBrowserEvent(),this.event=e;const[t,n]=this.getPointer(e);switch(this.button){case 0:{e.preventDefault(),e.stopImmediatePropagation();const i=this.trackballProjectToSphere(t,n,this.toVector);this.addRotation(this.fromVector,i),this.fromVector.assign(i);break}}},mousewheel:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n){const[i,s]=this.getPointer(n);if(!this.isPointerInRectangle(i,s))return;n.preventDefault(),n.stopImmediatePropagation();const r=this.getActiveViewpoint();r.transitionStop(),this.getDistanceToCenter(e).multiply(n.zoomFactor||sC),r.getUserOrientation().multVecRot(t.set(0,0,e.magnitude())),n.deltaY>0?this.addMove(t.negate(),Et.Zero):n.deltaY<0&&this.addMove(t,Et.Zero)}}(),touchstart(e){const t=e.originalEvent.touches;switch(t.length){case 1:this.touch1.set(t[0].pageX,t[0].pageY);break;case 2:this.touchend(e),e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY),this.touch2.set(t[1].pageX,t[1].pageY);break;case 3:this.touchend(e)}},touchend(e){if(0===this.button)this.mouseup(e);this.getBrowser().getCurrentTime()-this.tapStart<this.dblTapInterval&&(e.button=1,e.pageX=this.touch1.x,e.pageY=this.touch1.y,this.dblclick(e)),this.tapStart=this.getBrowser().getCurrentTime()},touchmove:function(){const e=new wt(0,0),t=new wt(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:break;case 2:{e.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),t.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const s=e.dot(t)>.7,r=e.dot(t)<-.7;if(s)n.button=0,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);else if(r){const e=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const t=this.touch1.distance(this.touch2)-e;n.deltaY=t,n.zoomFactor=Math.abs(t)/iC(window).width(),n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousewheel(n)}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),set_positionOffset__(e){this.getActiveViewpoint()._positionOffset=e},set_centerOfRotationOffset__(e){this.getActiveViewpoint()._centerOfRotationOffset=e},set_orientationOffset__(e){this.getActiveViewpoint()._orientationOffset=e},addMove:function(){const e=new Et(0,0,0),t=new Et(0,0,0);return function(n,i){const s=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(e.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=e):(e.assign(s._positionOffset.getValue()).add(n),this.positionChaser._set_value=s._positionOffset,this.positionChaser._set_destination=e),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(t.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=t):(t.assign(s._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=s._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=t),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),addRotation:function(){const e=new dn,t=new dn;return function(n,i){const s=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.setFromToVec(i,n).multRight(s.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),s.straightenHorizon(e),t.assign(s.getOrientation()).inverse().multRight(e),this.orientationChaser._set_destination=t):(e.setFromToVec(i,n).multRight(s.getUserOrientation()),s.straightenHorizon(e),t.assign(s.getOrientation()).inverse().multRight(e),this.orientationChaser._set_value=s._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),disconnect(){this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this)},dispose(){this.getBrowser().getSurface().off(".LookAtViewer"),iC(document).off(".LookAtViewer"+this.getId())}}),Object.defineProperties(rC,{typeName:{value:"LookAtViewer",enumerable:!0},fieldDefinitions:{value:new te([new H(c.outputOnly,"isActive",new Qi.SFBool)]),enumerable:!0}});const oC=rC;n.set("x_ite/Browser/Navigation/LookAtViewer",oC);const aC=oC,lC=Symbol(),uC=Symbol(),hC=Symbol();function cC(){this.addChildObjects("activeLayer",new Qi.SFNode,"activeNavigationInfo",new Qi.SFNode,"activeViewpoint",new Qi.SFNode,"availableViewers",new Qi.MFString,"viewer",new Qi.SFString("EXAMINE")),this[lC]=new Set,this[uC]=new nC(this.getPrivateScene())}Object.assign(cC.prototype,{initialize(){this._viewer.addInterest("set_viewer__",this),this.initialized().addInterest("set_world__",this),this.shutdown().addInterest("remove_world__",this),this[hC]=function(e){const t=new Xg(e.getPrivateScene());t.setup();const n=t.getLights().pop();return n.set(t,null,_n.Identity),n.dispose=Function.prototype,n}(this),this[uC].setup()},getHeadlight(){return this[hC]},getActiveLayer(){return this._activeLayer.getValue()},getActiveNavigationInfo(){return this._activeNavigationInfo.getValue()},getActiveViewpoint(){return this._activeViewpoint.getValue()},getCurrentViewer(){return this._viewer.getValue()},getViewer(){return this[uC]},addCollision(e){this[lC].add(e)},removeCollision(e){this[lC].delete(e)},getCollisionCount(){return this[lC].size},remove_world__(){this.getWorld()._activeLayer.removeInterest("set_activeLayer__",this)},set_world__(){this.getWorld()._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__()},set_activeLayer__(){this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().removeInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().removeInterest("set_activeViewpoint__",this)),this._activeLayer=this.getWorld().getActiveLayer(),this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().addInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().addInterest("set_activeViewpoint__",this)),this.set_activeNavigationInfo__(),this.set_activeViewpoint__()},set_activeNavigationInfo__(){this._activeNavigationInfo.getValue()?._viewer.removeFieldInterest(this._viewer),this._activeLayer.getValue()?(this._activeNavigationInfo=this._activeLayer.getValue().getNavigationInfo(),this._activeNavigationInfo.getValue()._viewer.addFieldInterest(this._viewer),this._viewer=this._activeNavigationInfo.getValue()._viewer):(this._activeNavigationInfo=null,this._viewer="NONE")},set_activeViewpoint__(){this._activeLayer.getValue()?this._activeViewpoint=this._activeLayer.getValue().getViewpoint():this._activeViewpoint=null},set_viewer__(e){const t=this._activeNavigationInfo.getValue();switch(t?this._availableViewers=t._availableViewers:this._availableViewers.length=0,this[uC]?.dispose(),e.getValue()){case"EXAMINE":default:this[uC]=new PE(this.getPrivateScene(),t);break;case"WALK":this[uC]=new kE(this.getPrivateScene(),t);break;case"FLY":this[uC]=new HE(this.getPrivateScene(),t);break;case"PLANE":case"PLANE_create3000.github.io":case"PLANE_create3000.de":this[uC]=new QE(this.getPrivateScene(),t);break;case"NONE":this[uC]=new nC(this.getPrivateScene(),t);break;case"LOOKAT":this[uC]=new aC(this.getPrivateScene(),t)}this[uC].setup()},dispose(){this[uC]?.dispose()}});const dC=cC;n.set("x_ite/Browser/Navigation/X3DNavigationContext",dC);const pC=dC,gC=Symbol(),fC=Symbol(),mC=Symbol(),_C=Symbol(),xC=Symbol(),yC=Symbol(),wC=Symbol();function bC(e){let t=e.prop("baseURI");return t.startsWith("about:")&&(t=document.baseURI),t}function SC(){this.addChildObjects("loadCount",new Qi.SFInt32),this[gC]=0,this[fC]=0,this[mC]=new Set,this[_C]=!1,this[xC]=bC(this.getElement())}Object.assign(SC.prototype,{initialize(){this._loadCount.addInterest(wC,this)},getProviderUrl:()=>uo.getProviderUrl(),getBaseURL(){return this[xC]},setBaseURL(e){const t=bC(this.getElement()),n=new URL(e,t);this[xC]="data:"===n.protocol?t:n.href},getDefaultScene(){return this[yC]=this.createScene(),this[yC].setPrivate(!0),this[yC].setLive(!0),this.getDefaultScene=function(){return this[yC]},Object.defineProperty(this,"getDefaultScene",{enumerable:!1}),this[yC]},getBrowserLoading(){return this[_C]},setBrowserLoading(e){this[_C]=e,e?(this[mC].has(this)||this.resetLoadCount(),this.getShadow().find(".x_ite-private-world-info").remove(),this.getBrowserOption("SplashScreen")&&(this.getContextMenu().hide(),this.getCanvas().hide(),this.getSplashScreen().stop(!0,!0).show())):this.getBrowserOption("SplashScreen")&&(this.getCanvas().show(),this.getSplashScreen().stop(!0,!0).show().fadeOut(2e3))},getLoadingObjects(){return this[mC]},addLoadingObject(e){this[mC].has(e)||(++this[fC],this[mC].add(e),this.setLoadCount(this[mC].size),this.setCursor("DEFAULT"))},removeLoadingObject(e){this[mC].has(e)&&(this[mC].delete(e),this.setLoadCount(this[mC].size),this.setCursor(this.getCursor()))},getDisplayLoadCount(){return[...this[mC]].reduce(((e,t)=>e+!(t.isPrivate?.()??1)),0)},setLoadCount(e){this._loadCount=e},resetLoadCount(){this._loadCount=0,this[gC]=0,this[fC]=0,this[mC].clear();for(const e of this.getPrivateScene().getLoadingObjects())this.addLoadingObject(e)},[wC](){const e=this.getDisplayLoadCount();if(this._loadCount.getValue()||this[_C])var t=iT(1===(e||1)?"Loading %1 file":"Loading %1 files").replace("%1",e||1);else{t=iT("Loading done");this.setCursor("DEFAULT")}this[_C]?(this.getSplashScreen().find(".x_ite-private-spinner-text").text(t),this.getSplashScreen().find(".x_ite-private-progressbar div").css("width",100-100*this._loadCount.getValue()/this[fC]+"%")):e!==this[gC]&&(this.getNotification()._string=t),this[gC]=e}});const vC=SC;n.set("x_ite/Browser/Networking/X3DNetworkingContext",vC);const TC=vC,OC=Symbol(),EC=Symbol(),CC=Symbol(),NC=Symbol(),FC=Symbol();function IC(){this[OC]=new Set,this[EC]=[new Set],this[CC]=[],this[NC]=[!1],this[FC]=new ka}Object.assign(IC.prototype,{addTransformSensor(e){this[OC].add(e),this.enablePicking()},removeTransformSensor(e){this[OC].delete(e),this.enablePicking()},addPickSensor(e){this[EC][0].add(e),this.enablePicking()},removePickSensor(e){this[EC][0].delete(e),this.enablePicking()},getPickSensors(){return this[EC]},getPickingHierarchy(){return this[CC]},getPickable(){return this[NC]},enablePicking(){this[OC].size||this[EC][0].size?this._sensorEvents.addInterest("picking",this):this._sensorEvents.removeInterest("picking",this)},picking(){this[FC].start(),this.getWorld().traverse(Na.PICKING);for(const e of this[OC])e.process();for(const e of this[EC][0])e.process();this[FC].stop()},getPickingTime(){return this[FC]}});const MC=IC;n.set("x_ite/Browser/Picking/X3DPickingContext",MC);const PC=MC;i(906);var DC=i(666);function RC(e){xs.call(this,e),this.cursor="DEFAULT",this.isOver=!1,this.motionTime=0}Object.assign(Object.setPrototypeOf(RC.prototype,xs.prototype),{initialize(){const e=this.getBrowser().getSurface();e.on("mousedown.PointingDevice"+this.getId(),this.mousedown.bind(this)),e.on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),e.on("dblclick.PointingDevice"+this.getId(),this.dblclick.bind(this)),e.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),e.on("mouseout.PointingDevice"+this.getId(),this.onmouseout.bind(this)),e.on("touchstart.PointingDevice"+this.getId(),this.touchstart.bind(this)),e.on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this))},getPointer(e){const t=this.getBrowser(),n=t.getRenderingProperty("ContentScale"),i=t.getSurface().offset();return[(e.pageX-i.left)*n,t.getViewport()[3]-(e.pageY-i.top)*n]},mousewheel(e){},mousedown(e){const t=this.getBrowser(),n=t.getSurface();if(t.getElement().focus(),!(t.getShiftKey()&&t.getControlKey()||0!==e.button)){const[i,s]=this.getPointer(e);n.off("mousemove.PointingDevice"+this.getId()),DC(document).on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),DC(document).on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),DC(document).on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this)),DC(document).on("touchmove.PointingDevice"+this.getId(),this.touchmove.bind(this)),t.buttonPressEvent(i,s)&&(e.preventDefault(),e.stopImmediatePropagation(),t.setCursor("HAND"),t.finishedEvents().addInterest("onverifymotion",this,i,s))}},mouseup(e){if(e.preventDefault(),0===e.button){const t=this.getBrowser(),n=t.getSurface(),[i,s]=this.getPointer(e);DC(document).off(".PointingDevice"+this.getId()),n.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),t.buttonReleaseEvent(),t.setCursor(this.isOver?"HAND":"DEFAULT"),t.finishedEvents().addInterest("onverifymotion",this,i,s),t.addBrowserEvent(),this.cursor="DEFAULT"}},dblclick(e){this.isOver&&e.stopImmediatePropagation()},mousemove(e){e.preventDefault();const t=this.getBrowser();if(this.motionTime===t.getCurrentTime())return;this.motionTime=t.getCurrentTime();const[n,i]=this.getPointer(e);this.onmotion(n,i)},touchstart(e){const t=e.originalEvent.touches;switch(t.length){case 1:{e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e);const n=this.getBrowser().getHit();0!==n.id&&0!==n.sensors.length||(this.touchX=e.pageX,this.touchY=e.pageY,this.touchTimeout=setTimeout(this.showContextMenu.bind(this,e),1200));break}case 2:this.touchend(e)}},touchend(e){e.button=0,this.mouseup(e),clearTimeout(this.touchTimeout)},touchmove(e){const t=e.originalEvent.touches;if(1===t.length)e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousemove(e),Math.hypot(this.touchX-e.pageX,this.touchY-e.pageY)>7&&clearTimeout(this.touchTimeout)},onmotion(e,t){const n=this.getBrowser();n.motionNotifyEvent(e,t)?this.isOver||(this.isOver=!0,this.cursor=n.getCursor(),n.setCursor("HAND")):this.isOver&&(this.isOver=!1,n.setCursor(this.cursor))},onmouseout(e){this.getBrowser().leaveNotifyEvent()},onverifymotion(e,t){this.getBrowser().finishedEvents().removeInterest("onverifymotion",this),this.onmotion(e,t)},showContextMenu(e){this.getBrowser().getContextMenu().show(e)}}),Object.defineProperties(RC,{typeName:{value:"PointingDevice",enumerable:!0}});const AC=RC;n.set("x_ite/Browser/PointingDeviceSensor/PointingDevice",AC);const VC=AC;function LC(e){const t=e.getContext();this.browser=e,this.array=new Float32Array(4),this.lastBuffer=t.getParameter(t.FRAMEBUFFER_BINDING),this.frameBuffer=t.createFramebuffer(),this.colorBuffers=[],this.frameBuffers=[];for(let e=0;e<3;++e)this.colorBuffers[e]=t.createRenderbuffer(),this.frameBuffers[e]=t.createFramebuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.colorBuffers[e]),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA32F,1,1),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,this.colorBuffers[e]),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffers[e]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this.colorBuffers[e]);if(t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),t.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.depthTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);const e=t.getVersion()>=2?t.DEPTH_COMPONENT24:t.DEPTH_COMPONENT;t.texImage2D(t.TEXTURE_2D,0,e,1,1,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,1,1),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer);const n=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;if(t.bindFramebuffer(t.FRAMEBUFFER,this.lastBuffer),!n)throw new Error("Couldn't create frame buffer.")}Object.assign(LC.prototype,{bind(){const e=this.browser.getContext();this.lastBuffer=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},unbind(){const e=this.browser.getContext();e.bindFramebuffer(e.FRAMEBUFFER,this.lastBuffer)},getHit(e){const t=this.browser.getContext(),n=this.array;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffers[0]),t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,n),e.id=n[3],e.point.set(n[0],n[1],n[2]),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffers[1]),t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,n),e.normal.set(n[0],n[1],n[2]),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffers[2]),t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,n),e.texCoord.set(n[0],n[1],n[2],n[3]),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer)},dispose(){const e=this.browser.getContext();e.deleteFramebuffer(this.frameBuffer);for(const t of this.frameBuffers)e.deleteFramebuffer(t);for(const t of this.colorBuffers)e.deleteRenderbuffer(t);e.deleteRenderbuffer(this.depthBuffer),e.deleteTexture(this.depthTexture)}});const BC=LC;n.set("x_ite/Rendering/PointingBuffer",BC);const UC=BC,XC=Symbol(),jC=Symbol(),kC=Symbol(),zC=Symbol(),GC=Symbol(),HC=Symbol(),qC=Symbol(),YC=Symbol(),WC=Symbol(),$C=Symbol(),KC=Symbol(),JC=Symbol(),ZC=Symbol();function QC(){this[XC]=new VC(this.getPrivateScene()),this[jC]=new Set,this[zC]=new wt(0,0),this[HC]=[],this[qC]=[],this[YC]=null,this[WC]=new ka,this[$C]=new UC(this),this[KC]=new Map,this[ZC]=[],this[GC]={id:0,pointer:this[zC],hitRay:null,sensors:[],modelViewMatrix:new _n,point:new Et(0,0,0),normal:new Et(0,0,0),texCoord:new Yt(0,0,0,0),layerNode:null,shapeNode:null}}Object.assign(QC.prototype,{initialize(){this.setCursor("DEFAULT"),this[XC].setup()},getPointingTime(){return this[WC]},addPointingDeviceSensor(e){this[jC].add(e)},removePointingDeviceSensor(e){this[jC].delete(e)},setCursor(e){const t=this.getSurface();switch(this[kC]=e,e){case"HAND":t.css("cursor","pointer");break;case"MOVE":t.css("cursor","move");break;case"CROSSHAIR":t.css("cursor","crosshair");break;default:this.getDisplayLoadCount()?t.css("cursor","wait"):this[XC]?.isOver?t.css("cursor","pointer"):t.css("cursor","default")}},getCursor(){return this[kC]},getPointer(){return this[zC]},isPointerInRectangle(e,t=this[zC]){return t.x>=e.x&&t.x<=e.x+e.z&&t.y>=e.y&&t.y<=e.y+e.w},getPointingLayer(){return this[YC]},getHit(){return this[GC]},addPointingShape(e){const t=++this[JC];return this[ZC][t]=e,t},buttonPressEvent(e,t){if(!this[jC].size)return!1;if(!this.touch(e,t))return!1;const n=this[GC];this[qC]=n.sensors,this[YC]=n.layerNode;for(const e of this[qC])e.set_active__(!0,n);return!!n.sensors.length},buttonReleaseEvent(){if(this[jC].size){for(const e of this[qC])e.set_active__(!1,null);this[qC]=Array.prototype,this[YC]=null}},motionNotifyEvent(e,t){return!!this[jC].size&&(this.touch(e,t),this.motion(),!!this[GC].sensors.length)},leaveNotifyEvent(){},touch(e,t){if(this[WC].start(),this.getViewer()._isActive.getValue())return this[WC].reset(),!1;const n=this[GC];if(this[JC]=0,this[zC].set(e,t),this[$C].bind(),this.getWorld().traverse(Na.POINTER),this[$C].getHit(n),this[$C].unbind(),Number.isInteger(n.id)&&n.id>0&&n.id<=this[JC]){const e=this[ZC][n.id],t=e.shapeNode,i=t.getAppearance(),s=t.getGeometryContext();n.hitRay=e.renderObject.getHitRay(),n.sensors=e.sensors.slice(),n.layerNode=e.renderObject,n.shapeNode=t,n.modelViewMatrix.assign(e.modelViewMatrix),s.hasNormals?n.modelViewMatrix.submatrix.inverse().transpose().multVecMatrix(n.normal).normalize():n.normal.assign(Et.zAxis),i.getTextureTransform().transformPoint(n.texCoord)}else n.id=0,n.hitRay=this[YC]?this[YC].getHitRay():null,n.sensors=Array.prototype,n.layerNode=this[YC],n.shapeNode=null,n.modelViewMatrix.assign(_n.Identity);return this.addBrowserEvent(),this[WC].stop(),!!n.id},motion(){const e=this[GC];if(e.id)var t=this[HC].filter((t=>!e.sensors.find((e=>t.node===e.node))));else t=this[HC];for(const n of t)n.set_over__(!1,e);if(e.id){this[HC]=e.sensors;for(const t of this[HC])t.set_over__(!0,e)}else this[HC]=Array.prototype;for(const t of this[qC])t.set_motion__(e)},getPointingShader(e,t){const n=t.getGeometryContext();let i="";if(i+=e,i+=".",i+=t.getShapeKey(),i+=n.geometryType,n.geometryType>=2)i+="0.0.0";else{const e=t.getAppearance();i+=e.getStyleProperties(n.geometryType)?1:0,i+=".",i+=e.getTextureBits().toString(4),i+=".",i+=e.getMaterial().getTextureBits().toString(4)}return this[KC].get(i)||this.createPointingShader(i,e,t)},createPointingShader(e,t,n){const i=n.getAppearance(),s=n.getGeometryContext(),r=[];t&&(r.push("X3D_CLIP_PLANES"),r.push("X3D_NUM_CLIP_PLANES "+t)),n.getShapeKey()>0&&r.push("X3D_PARTICLE_SYSTEM"),r.push(`X3D_GEOMETRY_${s.geometryType}D`),i.getStyleProperties(s.geometryType)&&r.push("X3D_STYLE_PROPERTIES"),(+i.getTextureBits()||+i.getMaterial().getTextureBits())&&r.push("X3D_TEXTURE","X3D_NUM_TEXTURE_COORDINATES 1");const o=this.createShader("PointingShader","Pointing","Pointing",r);return this[KC].set(e,o),o}});const eN=QC;n.set("x_ite/Browser/PointingDeviceSensor/X3DPointingDeviceSensorContext",eN);const tN=eN;function nN(e,t,n,i){const s=e.getContext();if(1===s.getVersion()||0===t||0===n)return iN;this.browser=e,this.width=t,this.height=n,this.samples=Math.min(i,s.getParameter(s.MAX_SAMPLES)),this.lastBuffer=s.getParameter(s.FRAMEBUFFER_BINDING),this.frameBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer),this.colorBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this.colorBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,s.RGBA8,t,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,this.colorBuffer),this.depthBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this.depthBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,s.DEPTH_COMPONENT24,t,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this.depthBuffer);const r=s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE;if(s.bindFramebuffer(s.FRAMEBUFFER,this.lastBuffer),!r)throw new Error("Couldn't create frame buffer.")}Object.assign(nN.prototype,{getWidth(){return this.width},getHeight(){return this.height},getSamples(){return this.samples},bind(){const e=this.browser.getContext();this.lastBuffer=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer)},unbind(){const e=this.browser.getContext();e.bindFramebuffer(e.FRAMEBUFFER,this.lastBuffer)},blit(){const e=this.browser.getContext();e.viewport(0,0,this.width,this.height),e.scissor(0,0,this.width,this.height),e.bindFramebuffer(e.READ_FRAMEBUFFER,this.frameBuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,e.COLOR_BUFFER_BIT,e.LINEAR)},dispose(){const e=this.browser.getContext();e.deleteFramebuffer(this.frameBuffer),e.deleteRenderbuffer(this.colorBuffer),e.deleteRenderbuffer(this.depthBuffer)}});const iN={getWidth:Function.prototype,getHeight:Function.prototype,getSamples:Function.prototype,bind:Function.prototype,unbind:Function.prototype,blit:Function.prototype,dispose:Function.prototype},sN=nN;n.set("x_ite/Rendering/MultiSampleFrameBuffer",sN);const rN=sN;var oN=i(666),aN=i(5);const lN=Symbol(),uN=Symbol(),hN=Symbol(),cN=Symbol(),dN=Symbol();function pN(){this[lN]=new Yt(0,0,300,150),this[uN]=new rN(this,300,150,4),this[cN]=[],this[dN]=new Map}Object.assign(pN.prototype,{initialize(){const e=this.getContext();e.enable(e.SCISSOR_TEST),e.depthFunc(e.LEQUAL),e.clearDepth(1),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),oN(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",this.onfullscreen.bind(this)),this[hN]=new aN(this.getSurface(),this.reshape.bind(this)),this.getSurface().css("position",""),this.reshape()},getRenderer(){const e=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return e.getParameter(t.UNMASKED_RENDERER_WEBGL)}return e.getParameter(e.RENDERER)},getVendor(){const e=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return e.getParameter(t.UNMASKED_VENDOR_WEBGL)}return e.getParameter(e.VENDOR)},getWebGLVersion(){const e=this.getContext();return e.getParameter(e.VERSION)},getAntialiased(){const e=this.getContext();return e.getParameter(e.SAMPLES)>0||e.getVersion()>1&&this.getRenderingProperty("Multisampling")>0},getMaxSamples(){const e=this.getContext();return e.getVersion()>1?e.getParameter(e.MAX_SAMPLES):0},getMaxClipPlanes:()=>6,getDepthSize(){const e=this.getContext();return e.getParameter(e.DEPTH_BITS)},getColorDepth(){const e=this.getContext();return e.getParameter(e.RED_BITS)+e.getParameter(e.BLUE_BITS)+e.getParameter(e.GREEN_BITS)+e.getParameter(e.ALPHA_BITS)},getViewport(){return this[lN]},getLocalObjects(){return this[cN]},getFrameBuffer(){return this[uN]},getDepthShader(e,t){const n=t.getGeometryContext();let i="";if(i+=e,i+=".",i+=t.getShapeKey(),i+=n.geometryType,n.geometryType>=2)i+="0.0.0";else{const e=t.getAppearance();i+=e.getStyleProperties(n.geometryType)?1:0,i+=".",i+=e.getTextureBits().toString(4),i+=".",i+=e.getMaterial().getTextureBits().toString(4)}return this[dN].get(i)||this.createDepthShader(i,e,t)},createDepthShader(e,t,n){const i=n.getAppearance(),s=n.getGeometryContext(),r=[];t&&(r.push("X3D_CLIP_PLANES"),r.push("X3D_NUM_CLIP_PLANES "+t)),n.getShapeKey()>0&&r.push("X3D_PARTICLE_SYSTEM"),r.push(`X3D_GEOMETRY_${s.geometryType}D`),i.getStyleProperties(s.geometryType)&&r.push("X3D_STYLE_PROPERTIES"),(+i.getTextureBits()||+i.getMaterial().getTextureBits())&&r.push("X3D_TEXTURE","X3D_NUM_TEXTURE_COORDINATES 1");const o=this.createShader("DepthShader","Depth","Depth",r);return this[dN].set(e,o),o},reshape(){const e=this.getCanvas(),t=this.getRenderingProperty("ContentScale"),n=this.getRenderingProperty("Multisampling"),i=e.width()*t,s=e.height()*t,r=e[0];r.width=i,r.height=s,this[lN][2]=i,this[lN][3]=s,i===this[uN].getWidth()&&s===this[uN].getHeight()&&n===this[uN].getSamples()||(this[uN].dispose(),this[uN]=new rN(this,i,s,n)),this.addBrowserEvent()},onfullscreen(){const e=this.getElement();e.fullScreen()?e.addClass("x_ite-fullscreen"):e.removeClass("x_ite-fullscreen")}});const gN=pN;n.set("x_ite/Browser/Rendering/X3DRenderingContext",gN);const fN=gN,mN=Symbol();function _N(){this[mN]=[this]}Object.assign(_N.prototype,{isExternal(){return 1===this[mN].length},getScriptStack(){return this[mN]}});const xN=_N;n.set("x_ite/Browser/Scripting/X3DScriptingContext",xN);const yN=xN,wN=Symbol(),bN=Symbol(),SN=Symbol();function vN(){this[wN]=!1,this[bN]=new Map,this[SN]=new Map}Object.assign(vN.prototype,{initialize(){this.setShading(this.getBrowserOptions().getShading())},getShadingLanguageVersion(){const e=this.getContext();return e.getParameter(e.SHADING_LANGUAGE_VERSION)},getMaxVertexUniformVectors(){const e=this.getContext();return e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS)},getMaxFragmentUniformVectors(){const e=this.getContext();return e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS)},getMaxVertexAttribs(){const e=this.getContext();return e.getParameter(e.MAX_VERTEX_ATTRIBS)},getMaxVaryingVectors(){const e=this.getContext();return e.getParameter(e.MAX_VARYING_VECTORS)},getWireframe(){return this[wN]},getPrimitiveMode(e){return this[bN].get(e)},getShaders(){return this[SN]},setShading(e){const t=this.getContext();switch(e){case xl.POINT:this[wN]=!1,this[bN].set(t.POINTS,t.POINTS),this[bN].set(t.LINES,t.POINTS),this[bN].set(t.TRIANGLES,t.POINTS);break;case xl.WIREFRAME:this[wN]=!0,this[bN].set(t.POINTS,t.POINTS),this[bN].set(t.LINES,t.LINES),this[bN].set(t.TRIANGLES,t.LINE_LOOP);break;default:this[wN]=!1,this[bN].set(t.POINTS,t.POINTS),this[bN].set(t.LINES,t.LINES),this[bN].set(t.TRIANGLES,t.TRIANGLES)}},createShader(e,t,n=t,i=[],s=[],r=[]){this.getBrowserOption("Debug")&&console.info("Initializing "+e);const o=this.getContext().getVersion(),a=new Tw(this.getPrivateScene());a._url.push(encodeURI(t.startsWith("data:")?t:"data:x-shader/x-vertex,"+fw.vertex[o][t])),a.setPrivate(!0),a.setName(e+"Vertex"),a.setOptions(i),a.setup();const l=new Tw(this.getPrivateScene());l._type="FRAGMENT",l._url.push(encodeURI(n.startsWith("data:")?n:"data:x-shader/x-fragment,"+fw.fragment[o][n])),l.setPrivate(!0),l.setName(e+"Fragment"),l.setOptions(i),l.setup();const u=new V_(this.getPrivateScene());return u._language="GLSL",u._parts.push(a),u._parts.push(l),u.setPrivate(!0),u.setName(e),u.setUniformNames(s),u.setTransformFeedbackVaryings(r),u.setup(),u}});const TN=vN;n.set("x_ite/Browser/Shaders/X3DShadersContext",TN);const ON=TN,EN=Symbol(),CN=Symbol(),NN=Symbol(),FN=Symbol(),IN=Symbol(),MN=Symbol(),PN=Symbol(),DN=Symbol(),RN=Symbol();function AN(){this[CN]=[]}Object.assign(AN.prototype,{getDefaultAppearance(){return this[NN]=new Bw(this.getPrivateScene()),this[NN].setPrivate(!0),this[NN].setup(),this.getDefaultAppearance=function(){return this[NN]},Object.defineProperty(this,"getDefaultAppearance",{enumerable:!1}),this[NN]},getLineStippleScale(){return 1/(32*this.getPixelPerPoint())},getDefaultPointProperties(){return this[FN]=new ob(this.getPrivateScene()),this[FN].setPrivate(!0),this[FN].setup(),this.getDefaultPointProperties=function(){return this[FN]},Object.defineProperty(this,"getDefaultPointProperties",{enumerable:!1}),this[FN]},getDefaultLineProperties(){return this[IN]=new Gw(this.getPrivateScene()),this[IN]._applied=!1,this[IN].setPrivate(!0),this[IN].setup(),this.getDefaultLineProperties=function(){return this[IN]},Object.defineProperty(this,"getDefaultLineProperties",{enumerable:!1}),this[IN]},getDefaultMaterial(){return this[MN]=new xb(this.getPrivateScene()),this[MN].setPrivate(!0),this[MN].setup(),this.getDefaultMaterial=function(){return this[MN]},Object.defineProperty(this,"getDefaultMaterial",{enumerable:!1}),this[MN]},getLinetypeTexture(){return this[EN]=new eu(this.getPrivateScene()),this[EN]._url[0]=uo.getLinetypeUrl(),this[EN]._textureProperties=this.getLineFillTextureProperties(),this[EN].setPrivate(!0),this[EN].setup(),this.getLinetypeTexture=function(){return this[EN]},Object.defineProperty(this,"getLinetypeTexture",{enumerable:!1}),this[EN]},getHatchStyleTexture(e){let t=this[CN][e];return t||(t=this[CN][e]=new eu(this.getPrivateScene()),t._url[0]=uo.getHatchingUrl(e),t._textureProperties=this.getLineFillTextureProperties(),t.setPrivate(!0),t.setup(),t)},getLineFillTextureProperties(){return this[PN]=new Iv(this.getPrivateScene()),this[PN]._minificationFilter="NEAREST_PIXEL",this[PN]._magnificationFilter="NEAREST_PIXEL",this[PN]._textureCompression="DEFAULT",this[PN].setPrivate(!0),this[PN].setup(),this.getLineFillTextureProperties=function(){return this[PN]},Object.defineProperty(this,"getLineFillTextureProperties",{enumerable:!1}),this[PN]},getLineTransformShader(){return this[DN]=this.createShader("LineTransformShader","LineTransform","LineTransform",[],["viewport","modelViewProjectionMatrix","invModelViewProjectionMatrix","scale"],["lineStipple0","fogDepth0","color0","normal0","vertex0","lineStipple1","fogDepth1","color1","normal1","vertex1","lineStipple2","fogDepth2","color2","normal2","vertex2"]),this.getLineTransformShader=function(){return this[DN]},Object.defineProperty(this,"getLineTransformShader",{enumerable:!1}),this[DN]},getLineTransformFeedback(){const e=this.getContext();return this[RN]=e.createTransformFeedback(),this.getLineTransformFeedback=function(){return this[RN]},Object.defineProperty(this,"getLineTransformFeedback",{enumerable:!1}),this[RN]}});const VN=AN;n.set("x_ite/Browser/Shape/X3DShapeContext",VN);const LN=VN;const BN=function(){this.addChildObjects("volume",new Qi.SFFloat(1),"mute",new Qi.SFBool)};n.set("x_ite/Browser/Sound/X3DSoundContext",BN);const UN=BN,XN=Symbol(),jN=Symbol(),kN=Symbol(),zN=Symbol(),GN=Symbol(),HN=Symbol(),qN=Symbol(),YN=Symbol(),WN=Symbol(),$N=Symbol(),KN=Symbol(),JN=Symbol(),ZN=Symbol(),QN=Symbol();function eF(){const e=this.getContext(),t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this[XN]=t>8?2:1}Object.assign(eF.prototype,{initialize(){const e=this.getContext();e.pixelStorei(e.UNPACK_ALIGNMENT,1);const t=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this[jN]=[...Array(t).keys()],this[kN]=[this[jN].pop()],this[zN]=[this[jN].pop()],this[GN]=[this[jN].pop()];const n=new Uint8Array([255,255,255,255]);this[WN]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[kN][0]),e.bindTexture(e.TEXTURE_2D,this[WN]),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n),e.getVersion()>=2&&(this[$N]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[zN][0]),e.bindTexture(e.TEXTURE_3D,this[$N]),e.texImage3D(e.TEXTURE_3D,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n)),this[KN]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[GN][0]),e.bindTexture(e.TEXTURE_CUBE_MAP,this[KN]),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n),this.resetTextureUnits(),this.setTextureQuality(this.getBrowserOptions().getTextureQuality())},getMaxTextures(){return this[XN]},getMaxTextureTransforms:()=>4,getMaxTexCoords:()=>4,getMinTextureSize:()=>16,getMaxTextureSize(){const e=this.getContext();return e.getParameter(e.MAX_TEXTURE_SIZE)},getMaxCombinedTextureUnits(){const e=this.getContext();return e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},popTexture2DUnit(){return this[HN]>0?(--this[HN],this[kN].pop()):this[jN].pop()},pushTexture2DUnit(e){void 0!==e&&(++this[HN],this[kN].push(e))},getTexture2DUnit(){if(this[HN]>0)return this[kN][--this[HN]];const e=this[jN].pop();return void 0!==e&&this[kN].push(e),e},getTexture3DUnit(){if(this[qN]>0)return this[zN][--this[qN]];const e=this[jN].pop();return void 0!==e&&this[zN].push(e),e},getTextureCubeUnit(){if(this[YN]>0)return this[GN][--this[YN]];const e=this[jN].pop();return void 0!==e&&this[GN].push(e),e},getTextureUnit(e){switch(e){case 2:return this.getTexture2DUnit();case 3:return this.getTexture3DUnit();case 4:return this.getTextureCubeUnit()}},resetTextureUnits(){this[HN]=this[kN].length,this[qN]=this[zN].length,this[YN]=this[GN].length},getDefaultTexture2DUnit(){return this[kN][0]},getDefaultTexture3DUnit(){return this[zN][0]},getDefaultTextureCubeUnit(){return this[GN][0]},getTextureMemory:()=>NaN,getDefaultTextureProperties(){return this[JN]=new Iv(this.getPrivateScene()),this[JN]._magnificationFilter="NICEST",this[JN]._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",this[JN]._generateMipMaps=!0,this[JN]._textureCompression="NICEST",this[JN].setup(),this.getDefaultTextureProperties=function(){return this[JN]},Object.defineProperty(this,"getDefaultTextureProperties",{enumerable:!1}),this[JN]},getDefaultTextureTransform(){return this[ZN]=new Vv(this.getPrivateScene()),this[ZN].setPrivate(!0),this[ZN].setup(),this.getDefaultTextureTransform=function(){return this[ZN]},Object.defineProperty(this,"getDefaultTextureTransform",{enumerable:!1}),this[ZN]},getDefaultTextureCoordinate(){return this[QN]=new Tv(this.getPrivateScene()),this[QN].setPrivate(!0),this[QN].setup(),this.getDefaultTextureCoordinate=function(){return this[QN]},Object.defineProperty(this,"getDefaultTextureCoordinate",{enumerable:!1}),this[QN]},setTextureQuality(e){const t=this.getDefaultTextureProperties();switch(e){case gT.LOW:t._magnificationFilter="AVG_PIXEL",t._minificationFilter="AVG_PIXEL",t._textureCompression="FASTEST",t._generateMipMaps=!0;break;case gT.MEDIUM:t._magnificationFilter="NICEST",t._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",t._textureCompression="NICEST",t._generateMipMaps=!0;break;case gT.HIGH:t._magnificationFilter="NICEST",t._minificationFilter="NICEST",t._textureCompression="NICEST",t._generateMipMaps=!0}}});const tF=eF;n.set("x_ite/Browser/Texturing/X3DTexturingContext",tF);const nF=tF,iF=Symbol(),sF=Symbol(),rF=Symbol(),oF=Symbol();function aF(){this[iF]=Date.now()/1e3,this[sF]=60,this[rF]=new Et(0,0,0),this[oF]=0}Object.assign(aF.prototype,{getCurrentTime(){return this[iF]},getCurrentFrameRate(){return this[sF]},getCurrentSpeed(){return this[oF]},advanceTime:function(){const e=new Et(0,0,0);return function(){const t=Date.now()/1e3,n=t-this[iF];if(this[iF]=t,this[sF]=n?1/n:60,this.getWorld()&&this.getActiveLayer()){const t=this.getActiveLayer().getViewpoint().getCameraSpaceMatrix();e.assign(this[rF]),this[rF].set(t[12],t[13],t[14]),this[oF]=e.subtract(this[rF]).magnitude()*this[sF]}else this[oF]=0}}()});const lF=aF;n.set("x_ite/Browser/Time/X3DTimeContext",lF);const uF=lF,hF=Symbol(),cF=Symbol(),dF=Symbol(),pF=Symbol();function gF(){this[hF]=[],this[cF]=[],this[dF]=[],this[pF]=[]}Object.assign(gF.prototype,{initialize(){},addTaintedField(e,t){this[hF].push(e,t)},addTaintedNode(e){this[dF].push(e)},[Symbol.for("X_ITE.X3DRoutingContext.processEvents")](){do{do{const e=this[hF];this[hF]=this[cF],this[hF].length=0;for(let t=0,n=e.length;t<n;t+=2)e[t].processEvent(e[t+1]);this[cF]=e}while(this[hF].length);do{const e=this[dF];this[dF]=this[pF],this[dF].length=0;for(const t of e)t.processEvent();this[pF]=e}while(!this[hF].length&&this[dF].length)}while(this[hF].length)},dispose(){}});const fF=gF;n.set("x_ite/Routing/X3DRoutingContext",fF);const mF=fF,_F=Symbol(),xF=Symbol(),yF=Symbol(),wF=Symbol(),bF=Symbol(),SF=Symbol(),vF=Symbol(),TF=Symbol(),OF=Symbol(),EF=Symbol(),CF=Symbol(),NF=Symbol.for("X_ITE.X3DRoutingContext.processEvents"),FF=new Set,IF=[];function MF(e){xs.call(this,this),mF.call(this),yN.call(this),GO.call(this,e),TC.call(this),nF.call(this),ON.call(this),fN.call(this),LN.call(this),gE.call(this),hE.call(this),tN.call(this),pC.call(this),xE.call(this),WO.call(this),vE.call(this),PC.call(this),UN.call(this),uF.call(this),FF.add(this);for(const e of IF)e.call(this);this.addChildObjects("initialized",new Wn,"shutdown",new Wn,"prepareEvents",new Wn,"timeEvents",new Wn,"sensorEvents",new Wn,"displayEvents",new Wn,"finishedEvents",new Wn),this[xF]=0,this[SF]=0,this[bF]=this[wF].bind(this),this[vF]=new ka,this[TF]=new ka,this[OF]=new ka,this[EF]=new ka,this[CF]=new ka}Object.assign(Object.setPrototypeOf(MF.prototype,xs.prototype),GO.prototype,WO.prototype,hE.prototype,gE.prototype,xE.prototype,vE.prototype,pC.prototype,TC.prototype,PC.prototype,tN.prototype,fN.prototype,mF.prototype,yN.prototype,ON.prototype,LN.prototype,UN.prototype,nF.prototype,uF.prototype,{initialize(){xs.prototype.initialize?.call(this),mF.prototype.initialize?.call(this),yN.prototype.initialize?.call(this),GO.prototype.initialize?.call(this),TC.prototype.initialize?.call(this),nF.prototype.initialize?.call(this),ON.prototype.initialize?.call(this),fN.prototype.initialize?.call(this),LN.prototype.initialize?.call(this),gE.prototype.initialize?.call(this),hE.prototype.initialize?.call(this),tN.prototype.initialize?.call(this),pC.prototype.initialize?.call(this),xE.prototype.initialize?.call(this),WO.prototype.initialize?.call(this),vE.prototype.initialize?.call(this),PC.prototype.initialize?.call(this),UN.prototype.initialize?.call(this),uF.prototype.initialize?.call(this);for(const e of IF)e.prototype.initialize?.call(this)},initialized(){return this._initialized},shutdown(){return this._shutdown},prepareEvents(){return this._prepareEvents},timeEvents(){return this._timeEvents},sensorEvents(){return this._sensorEvents},displayEvents(){return this._displayEvents},finishedEvents(){return this._finishedEvents},getBrowser(){return this},getWorld(){return this[_F]},getExecutionContext(){return this[_F].getExecutionContext()},setExecutionContext(e){this[_F]=new th(e),this[_F].setup()},addBrowserEvent(){this[xF]!==this.getCurrentTime()&&(this[xF]=this.getCurrentTime(),requestAnimationFrame(this[bF]))},[yF](e){return e===this[SF]?(requestAnimationFrame(this[bF]),!0):(this[SF]=e,!1)},[wF](e){if(this[yF](e))return;this[vF].stop(),this[TF].start(),this.advanceTime(),this.addTaintedField(this._prepareEvents),this[NF](),this.addTaintedField(this._timeEvents),this[NF](),this[OF].start(),this[_F].traverse(Na.CAMERA),this[OF].stop(),this[EF].start(),this.getCollisionCount()&&this[_F].traverse(Na.COLLISION),this[EF].stop(),this.addTaintedField(this._sensorEvents),this[NF](),this[CF].start(),this.addTaintedField(this._displayEvents),this[NF]();const t=this.getContext();this.getFrameBuffer().bind(),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this[_F].traverse(Na.DISPLAY),this.getFrameBuffer().blit(),this[CF].stop(),this.addTaintedField(this._finishedEvents),this[NF](),this[TF].stop(),this[vF].start()},getSystemTime(){return this[vF]},getBrowserTime(){return this[TF]},getCameraTime(){return this[OF]},getCollisionTime(){return this[EF]},getDisplayTime(){return this[CF]},dispose(){FF.delete(this);for(const e of IF)e.prototype.dispose?.call(this);uF.prototype.dispose?.call(this),UN.prototype.dispose?.call(this),PC.prototype.dispose?.call(this),vE.prototype.dispose?.call(this),WO.prototype.dispose?.call(this),xE.prototype.dispose?.call(this),pC.prototype.dispose?.call(this),tN.prototype.dispose?.call(this),hE.prototype.dispose?.call(this),gE.prototype.dispose?.call(this),LN.prototype.dispose?.call(this),fN.prototype.dispose?.call(this),ON.prototype.dispose?.call(this),nF.prototype.dispose?.call(this),TC.prototype.dispose?.call(this),GO.prototype.dispose?.call(this),yN.prototype.dispose?.call(this),mF.prototype.dispose?.call(this),xs.prototype.dispose?.call(this)}});for(const e of Reflect.ownKeys(MF.prototype))Object.defineProperty(MF.prototype,e,{enumerable:!1});Object.assign(MF,{addBrowserContext(e){IF.push(e);const t=Object.keys(e.prototype).filter((e=>!e.match(/^(initialize|dispose)$/))).concat(Object.getOwnPropertySymbols(e.prototype));for(const n of t)Object.defineProperty(MF.prototype,n,{value:e.prototype[n],writable:!0});for(const t of FF)e.call(t),e.prototype.initialize?.call(t),t[NF]()}});const PF=MF;n.set("x_ite/Browser/X3DBrowserContext",PF);const DF=PF;let RF=!1;const AF={add({name:e,concreteNodes:t,abstractNodes:n,browserContext:i}){if(t)for(const e of t)Hv.add(e.typeName,e);if(n)for(const e of n)ar.add(e.typeName,e);i&&DF.addBrowserContext(i)}};AF.add(Kh),AF.add(uc),AF.add(Tc),AF.add(kd),AF.add(pp),AF.add(Rp),AF.add(vg),AF.add(Pg),AF.add(rf),AF.add(vf),AF.add($f),AF.add(ym),AF.add(O_),AF.add(Nw),AF.add(wb),AF.add(qS),AF.add(Bv),AF.add(Xv),RF=!0;const VF=AF;n.set("x_ite/Components",VF);var LF=i(666);const BF=class{constructor(e){this.browser=e,this.rootElement=void 0,this.canvasObserver=new MutationObserver((()=>this.processCanvasMutation(e))),this.canvasObserver.observe(e.getElement()[0],{childList:!0}),this.processCanvasMutation(e)}processCanvasMutation(e){this.processRootElement(e,e.getElement().children("X3D").get(-1))}async processRootElement(e,t){try{if(t===this.rootElement)return;if(this.rootElement=t,t){e.setBrowserLoading(!0),e.addLoadingObject(this);const n=e.createScene();this.parser=new Qr(n),this.parser.setInput(t),await new Promise(this.parser.parseIntoScene.bind(this.parser)),e.replaceWorld(n),this.observer=new MutationObserver((e=>{for(const t of e)this.processMutation(t)})),this.observer.observe(t,{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeOldValue:!0}),this.processInlineElements(t),this.addEventDispatchersAll(t),e.removeLoadingObject(this)}else e.replaceWorld(null)}catch(e){console.error("Error importing document:",e)}}processMutation(e){switch(e.type){case"attributes":this.processAttribute(e,e.target);break;case"childList":for(const t of e.addedNodes)this.processAddedNode(t);for(const t of e.removedNodes)this.processRemovedNode(t)}}processAttribute(e,t){const n=this.parser;if(LF.data(t,"node")){const i=e.attributeName,s=t.attributes.getNamedItem(i);n.nodeAttribute(s,LF.data(t,"node"))}else{const e=t.parentNode,i=LF.data(e,"node");n.pushExecutionContext(i.getExecutionContext()),n.pushParent(i),n.childElement(t),n.popParent(),n.popExecutionContext()}}processAddedNode(e){if(e.nodeType!==Node.ELEMENT_NODE)return;if("X3D"===e.nodeName)return;if(LF.data(e,"node"))return;const t=e.parentNode,n=this.parser;if(t.nodeName.match(/^(?:Scene|SCENE)$/)){const i=LF.data(t,"node");n.pushExecutionContext(i),n.childElement(e),n.popExecutionContext()}else if(LF.data(t,"node")){const i=LF.data(t,"node"),s=i.getExecutionContext();n.pushExecutionContext(s),n.pushParent(i),n.childElement(e),n.popParent(),n.popExecutionContext()}else{const t=this.browser.currentScene;n.pushExecutionContext(t),n.childElement(e),n.popExecutionContext()}this.processInlineElements(e),this.addEventDispatchers(e),this.addEventDispatchersAll(e)}processRemovedNode(e){const t=LF.data(e,"node");t&&(t.dispose(),LF.data(e,"node",null))}processInlineElements(e){e.nodeName.match(/^(?:Inline|INLINE)$/)&&this.processInlineElement(e);for(const t of e.querySelectorAll("Inline"))this.processInlineElement(t)}processInlineElement(e){const t=LF.data(e,"node");t&&(t._loadState.addInterest("appendInlineChildElement",this,e),this.appendInlineChildElement(e))}appendInlineChildElement(e){const t=LF.data(e,"node");switch(t.checkLoadState()){case c.NOT_STARTED_STATE:case c.FAILED_STATE:for(;e.firstChild;)e.removeChild(e.lastChild);break;case c.COMPLETE_STATE:{for(;e.firstChild;)e.removeChild(e.lastChild);const n=LF.data(t.getInternalScene(),"X3D");n&&e.appendChild(n),this.processInlineElements(n),this.addEventDispatchersAll(n);break}}switch(t.checkLoadState()){case c.COMPLETE_STATE:{const n=new CustomEvent("load",{detail:{node:Tn.get(t)}});e.dispatchEvent(n);break}case c.FAILED_STATE:{const n=new CustomEvent("error",{detail:{node:Tn.get(t)}});e.dispatchEvent(n);break}}}addEventDispatchersAll(e){const t=e.querySelectorAll("*");for(const e of t)this.addEventDispatchers(e)}addEventDispatchers(e){if("ROUTE"===e.nodeName)return;const t=LF.data(e,"node");if(t){for(const n of t.getPredefinedFields())this.bindFieldCallback(n,e);for(const n of t.getUserDefinedFields())this.bindFieldCallback(n,e)}}bindFieldCallback(e,t){e.isOutput()&&(e.addInterest("fieldCallback",this,t),this.trace&&e.addInterest("fieldTraceCallback",this,t))}fieldCallback(e,t){const n=LF.data(e,"node");if(!n)return;const i=new CustomEvent(t.getName(),{detail:{node:Tn.get(n),value:t.valueOf()}});e.dispatchEvent(i)}fieldTraceCallback(e,t){const n=Date.now(),i=r.getBrowser().getCurrentTime(),s=n-1e3*i,r=LF.data(e,"node");console.log("%f: at %f dt of %s ms %s '%s' %s: %s",n,i,s.toFixed(3),r.getTypeName(),r.getName(),t.getName(),t.valueOf())}};n.set("x_ite/Browser/DOMIntegration",BF);const UF=BF;var XF=i(666);const jF={elements(e,t){e.length&&(console.warn("Use of <X3DCanvas> element is depreciated, please use <x3d-canvas> element instead. See https://create3000.github.io/x_ite/#embedding-x_ite-within-a-web-page."),XF.map(e,(e=>new t(e))))},browser(e){const t=e.getElement();"X3DCANVAS"===t.prop("nodeName").toUpperCase()&&(t.attr("src")?e.attributeChangedCallback("src",void 0,t.attr("src")):t.attr("url")&&e.attributeChangedCallback("url",void 0,t.attr("url")),t.attr("tabindex",t.attr("tabindex")??0))},error(e,t){console.error(t),e.children(".x_ite-private-browser").hide(),e.children(":not(.x_ite-private-browser)").show()}},kF=jF;n.set("x_ite/Browser/Legacy",kF);const zF=kF;function GF(e,t,n,i){Object.defineProperties(this,{name:{value:e,enumerable:!0},title:{value:t,enumerable:!0},providerUrl:{value:n,enumerable:!0},components:{value:i,enumerable:!0}})}Object.assign(Object.setPrototypeOf(GF.prototype,F.prototype),{toVRMLStream(e){e.string+=e.Indent(),e.string+="PROFILE",e.string+=e.Space(),e.string+=this.name},toXMLStream(e){e.string+=this.name},toJSONStream(e){e.string+=this.name}});for(const e of Reflect.ownKeys(GF.prototype))Object.defineProperty(GF.prototype,e,{enumerable:!1});Object.defineProperties(GF,{typeName:{value:"ProfileInfo",enumerable:!0}});const HF=GF;n.set("x_ite/Configuration/ProfileInfo",HF);const qF=HF;function YF(e=[]){return Z.call(this,Array.from(e,(e=>[e.name,e])),qF)}Object.assign(Object.setPrototypeOf(YF.prototype,Z.prototype),{add(e,{title:t,providerUrl:n,components:i}){Z.prototype.add.call(this,e,new qF(e,t,n,new UT(i)))}});for(const e of Reflect.ownKeys(YF.prototype))Object.defineProperty(YF.prototype,e,{enumerable:!1});Object.defineProperties(YF,{typeName:{value:"ProfileInfoArray",enumerable:!0}});const WF=YF;n.set("x_ite/Configuration/ProfileInfoArray",WF);const $F=WF,KF=new UT([]);KF.add("Annotation",{title:"Annotation",level:2,external:!0}),KF.add("CADGeometry",{title:"CAD geometry",level:2,external:!0}),KF.add("Core",{title:"Core",level:2}),KF.add("CubeMapTexturing",{title:"Cube map environmental texturing",level:3,external:!0}),KF.add("DIS",{title:"Distributed interactive simulation",level:2,external:!0}),KF.add("EnvironmentalEffects",{title:"Environmental effects",level:4}),KF.add("EnvironmentalSensor",{title:"Environmental sensor",level:3}),KF.add("EventUtilities",{title:"Event utilities",level:1,external:!0}),KF.add("Followers",{title:"Followers",level:1}),KF.add("Geometry2D",{title:"Geometry2D",level:2,external:!0}),KF.add("Geometry3D",{title:"Geometry3D",level:4}),KF.add("Geospatial",{title:"Geospatial",level:2,external:!0}),KF.add("Grouping",{title:"Grouping",level:3}),KF.add("HAnim",{title:"Humanoid animation (HAnim)",level:3,external:!0}),KF.alias("H-Anim","HAnim"),KF.add("Interpolation",{title:"Interpolation",level:5}),KF.add("KeyDeviceSensor",{title:"Key device sensor",level:2,external:!0}),KF.add("Layering",{title:"Layering",level:1}),KF.add("Layout",{title:"Layout",level:2,external:!0,dependencies:["Text"]}),KF.add("Lighting",{title:"Lighting",level:3}),KF.add("Navigation",{title:"Navigation",level:3}),KF.add("Networking",{title:"Networking",level:4}),KF.add("NURBS",{title:"NURBS",level:4,external:!0}),KF.add("ParticleSystems",{title:"Particle systems",level:3,external:!0}),KF.add("Picking",{title:"Picking",level:3,external:!0,dependencies:["RigidBodyPhysics"]}),KF.add("PointingDeviceSensor",{title:"Pointing device sensor",level:1}),KF.add("Shaders",{title:"Programmable shaders",level:1}),KF.add("TextureProjector",{title:"Texture Projector",level:2,external:!0}),KF.alias("ProjectiveTextureMapping","TextureProjector"),KF.add("Rendering",{title:"Rendering",level:5}),KF.add("RigidBodyPhysics",{title:"Rigid body physics",level:2,external:!0}),KF.add("Scripting",{title:"Scripting",level:1,external:!0}),KF.add("Shape",{title:"Shape",level:4}),KF.add("Sound",{title:"Sound",level:3}),KF.add("Text",{title:"Text",level:1,external:!0}),KF.add("Texturing",{title:"Texturing",level:4}),KF.add("Texturing3D",{title:"Texturing3D",level:2,external:!0}),KF.add("Time",{title:"Time",level:2}),KF.add("VolumeRendering",{title:"Volume rendering",level:4,external:!0,dependencies:["CADGeometry","Texturing3D"]}),KF.add("X_ITE",{title:"X_ITE",level:1,external:!0});const JF=KF;n.set("x_ite/Configuration/SupportedComponents",JF);const ZF=JF,QF=new $F;QF.add("CADInterchange",{title:"Computer-Aided Design (CAD) interchange",providerUrl:uo.getProviderUrl(),components:[ZF.get("CADGeometry"),ZF.get("Core"),ZF.get("Grouping"),ZF.get("Lighting"),ZF.get("Navigation"),ZF.get("Networking"),ZF.get("Rendering"),ZF.get("Shaders"),ZF.get("Shape"),ZF.get("Texturing")]}),QF.add("Core",{title:"Core",providerUrl:uo.getProviderUrl(),components:[ZF.get("Core")]}),QF.add("Full",{title:"Full",providerUrl:uo.getProviderUrl(),components:[ZF.get("CADGeometry"),ZF.get("Core"),ZF.get("CubeMapTexturing"),ZF.get("DIS"),ZF.get("EnvironmentalEffects"),ZF.get("EnvironmentalSensor"),ZF.get("EventUtilities"),ZF.get("Followers"),ZF.get("Geometry2D"),ZF.get("Geometry3D"),ZF.get("Geospatial"),ZF.get("Grouping"),ZF.get("HAnim"),ZF.get("Interpolation"),ZF.get("KeyDeviceSensor"),ZF.get("Layering"),ZF.get("Layout"),ZF.get("Lighting"),ZF.get("Navigation"),ZF.get("Networking"),ZF.get("NURBS"),ZF.get("ParticleSystems"),ZF.get("Picking"),ZF.get("PointingDeviceSensor"),ZF.get("TextureProjector"),ZF.get("Rendering"),ZF.get("RigidBodyPhysics"),ZF.get("Scripting"),ZF.get("Shaders"),ZF.get("Shape"),ZF.get("Sound"),ZF.get("Text"),ZF.get("Texturing"),ZF.get("Texturing3D"),ZF.get("Time"),ZF.get("VolumeRendering")]}),QF.add("Immersive",{title:"Immersive",providerUrl:uo.getProviderUrl(),components:[ZF.get("Core"),ZF.get("EnvironmentalEffects"),ZF.get("EnvironmentalSensor"),ZF.get("EventUtilities"),ZF.get("Geometry2D"),ZF.get("Geometry3D"),ZF.get("Grouping"),ZF.get("Interpolation"),ZF.get("KeyDeviceSensor"),ZF.get("Lighting"),ZF.get("Navigation"),ZF.get("Networking"),ZF.get("PointingDeviceSensor"),ZF.get("Rendering"),ZF.get("Scripting"),ZF.get("Shape"),ZF.get("Sound"),ZF.get("Text"),ZF.get("Texturing"),ZF.get("Time")]}),QF.add("Interactive",{title:"Interactive",providerUrl:uo.getProviderUrl(),components:[ZF.get("Core"),ZF.get("EnvironmentalEffects"),ZF.get("EnvironmentalSensor"),ZF.get("EventUtilities"),ZF.get("Geometry3D"),ZF.get("Grouping"),ZF.get("Interpolation"),ZF.get("KeyDeviceSensor"),ZF.get("Lighting"),ZF.get("Navigation"),ZF.get("Networking"),ZF.get("PointingDeviceSensor"),ZF.get("Rendering"),ZF.get("Shape"),ZF.get("Texturing"),ZF.get("Time")]}),QF.add("Interchange",{title:"Interchange",providerUrl:uo.getProviderUrl(),components:[ZF.get("Core"),ZF.get("EnvironmentalEffects"),ZF.get("Geometry3D"),ZF.get("Grouping"),ZF.get("Interpolation"),ZF.get("Lighting"),ZF.get("Navigation"),ZF.get("Networking"),ZF.get("Rendering"),ZF.get("Shape"),ZF.get("Texturing"),ZF.get("Time")]}),QF.add("MedicalInterchange",{title:"Medical interchange",providerUrl:uo.getProviderUrl(),components:[ZF.get("Core"),ZF.get("EnvironmentalEffects"),ZF.get("EventUtilities"),ZF.get("Geometry2D"),ZF.get("Geometry3D"),ZF.get("Grouping"),ZF.get("Interpolation"),ZF.get("Lighting"),ZF.get("Navigation"),ZF.get("Networking"),ZF.get("Rendering"),ZF.get("Shape"),ZF.get("Text"),ZF.get("Texturing"),ZF.get("Texturing3D"),ZF.get("Time"),ZF.get("VolumeRendering")]}),QF.add("MPEG-4",{title:"MPEG-4 interactive",providerUrl:uo.getProviderUrl(),components:[ZF.get("Core"),ZF.get("EnvironmentalEffects"),ZF.get("EnvironmentalSensor"),ZF.get("Geometry3D"),ZF.get("Grouping"),ZF.get("Interpolation"),ZF.get("Lighting"),ZF.get("Navigation"),ZF.get("Networking"),ZF.get("PointingDeviceSensor"),ZF.get("Rendering"),ZF.get("Shape"),ZF.get("Texturing"),ZF.get("Time")]});const eI=QF;n.set("x_ite/Configuration/SupportedProfiles",eI);const tI=eI;var nI=i(666);const iI=Symbol(),sI=Symbol(),rI=Symbol(),oI=Symbol(),aI=Symbol(),lI=Symbol.for("X_ITE.X3DRoutingContext.processEvents");function uI(e){if((e=nI(e)).prop("browser"))throw new Error("Couldn't create browser, element has already a browser.");DF.call(this,e),this.addType(c.X3DBrowser),this[oI]=new Map,this[aI]=document.getElementsByClassName("x_ite-console"),this.setup()}Object.assign(Object.setPrototypeOf(uI.prototype,DF.prototype),{initialize(){DF.prototype.initialize.call(this),this.replaceWorld(this.createScene()).catch(Function.prototype),this[iI]=new UF(this),zF.browser(this),this[lI].call(this),this.getInstanceId()>1||this.getBrowserOption("Debug")&&this.printWelcomeMessage()},printWelcomeMessage(){this.print(`Welcome to ${this.name} X3D Browser v${this.version}:\n   Current Graphics Renderer\n      Name: ${this.getVendor()} ${this.getRenderer()}\n      WebGL version: ${this.getWebGLVersion()}\n      Shading language: ${this.getShadingLanguageVersion()}\n   Rendering Properties\n      Antialiased: ${this.getAntialiased()}\n      Max samples: ${this.getMaxSamples()}\n      Depth size: ${this.getDepthSize()} bits\n      Color depth: ${this.getColorDepth()} bits\n      Max clip planes per shape: ${this.getMaxClipPlanes()}\n      Max lights per shape: ${this.getMaxLights()}\n      Max multi textures per shape: ${this.getMaxTextures()}\n      Texture units: ${this.getMaxCombinedTextureUnits()}\n      Max texture size: ${this.getMaxTextureSize()} × ${this.getMaxTextureSize()} pixels\n      Texture memory: ${this.getTextureMemory()}\n      Max vertex uniform vectors: ${this.getMaxVertexUniformVectors()}\n      Max fragment uniform vectors: ${this.getMaxFragmentUniformVectors()}\n      Max vertex attribs: ${this.getMaxVertexAttribs()}\n      Max varying vectors: ${this.getMaxVaryingVectors()}\n`)},getName:()=>"X_ITE",getVersion:()=>ws,getDescription(){return this.getNotification()._string.getValue()},setDescription(e){this.getNotification()._string=e},getWorldURL(){return this.currentScene.worldURL},getProfile(e){e=String(e);const t=tI.get(e);if(t)return t;throw Error(`Profile '${e}' is not supported.`)},getSupportedProfiles:()=>tI,getComponent(e,t=0){e=String(e),t|=0;const n=ZF.get(e);if(n)return new VT(e,f.clamp(t||n.level,1,n.level),n.title,n.providerUrl,n.external,n.dependencies);throw Error(`Component '${e}' at level '${t}' is not supported.`)},getSupportedComponents:()=>ZF,loadComponents:function(){function e(t,n){return Promise.all(t.map((t=>async function({name:t,providerUrl:n,external:s,dependencies:r},o){if(o.has(t))return;if(o.add(t),await e(r.map((e=>ZF.get(e))),o),!s)return;ao.NODE_ENV?i.g.require(i.g.require("url").fileURLToPath(n)):await import(n)}(t,n))))}return function(...t){const n=[];for(const e of t)e instanceof qF?n.push(...e.components):e instanceof UT?n.push(...e):e instanceof VT?n.push(e):"string"==typeof e&&n.push(ZF.get(e));return e(n,new Set)}}(),addConcreteNode(e,t){Hv.add(String(e),t)},updateConcreteNode(e,t){Hv.update(String(e),String(e),t)},removeConcreteNode(e){Hv.remove(String(e))},getConcreteNode:e=>Hv.get(String(e)),getConcreteNodes:()=>Hv,addAbstractNode(e,t){ar.add(String(e),t)},updateAbstractNode(e,t){ar.update(String(e),String(e),t)},removeAbstractNode(e){ar.remove(String(e))},getAbstractNode:e=>ar.get(String(e)),getAbstractNodes:()=>ar,createScene(e,...t){const n=new pO(this);if(arguments.length){if(!(e instanceof qF))throw new Error("Couldn't create scene: profile must be of type ProfileInfo.");n.setProfile(e);for(const e of t){if(!(e instanceof VT))throw new Error("Couldn't create scene: component must be of type ComponentInfo.");n.addComponent(e)}}return n.setup(),n},replaceWorld(e){return new Promise(((t,n)=>{if(this[rI]?.abort(),this[sI]?.("Replacing world aborted."),this[sI]=n,this.initialized().getValue()&&(this.getExecutionContext().setLive(!1),this.shutdown().processInterests(),this.callBrowserCallbacks(c.SHUTDOWN_EVENT),this.callBrowserEventHandler("shutdown")),e instanceof Qi.MFNode){const t=e;e=this.createScene();for(const n of t.filter((e=>e)))e.getLive().addInterest("setLive",n.getValue().getExecutionContext());e.setRootNodes(t)}e instanceof pO||(e=this.createScene()),e.getExecutionContext().getLive().removeInterest("setLive",e),e.setExecutionContext(e),this.setDescription(""),this.getBrowserOptions().configure(),this.setBrowserLoading(!0),this._loadCount.addInterest("checkLoadCount",this,t);for(const t of e.getLoadingObjects())this.addLoadingObject(t);this.setExecutionContext(e),this.getWorld().bindBindables(),e.setLive(this.isLive())}))},checkLoadCount(e,t){t.getValue()||(t.removeInterest("checkLoadCount",this),this.setBrowserLoading(!1),this.initialized().set(this.getCurrentTime()),this.initialized().processInterests(),this.callBrowserCallbacks(c.INITIALIZED_EVENT),this.callBrowserEventHandler("initialized load"),e())},createVrmlFromString(e){e=String(e);const t=this.currentScene,n=this.isExternal(),i=new hh(this.getWorld()).createX3DFromString(t.getWorldURL(),e);return n||(t.getLive().addInterest("setLive",i),i.setExecutionContext(t),i.setLive(t.isLive())),i.rootNodes},createX3DFromString:async function(e){e=String(e);const t=this.currentScene,n=this.isExternal(),i=new hh(this.getWorld()),s=await new Promise(((n,s)=>{i.createX3DFromString(t.getWorldURL(),e,n,s)}));return n||(t.getLive().addInterest("setLive",s),s.setExecutionContext(t),s.setLive(t.isLive())),s},createVrmlFromURL(e,t,n){if(t=zl(c.X3DNode,t,!1),n=String(n),!(e instanceof Qi.MFString))throw new Error("Browser.createVrmlFromURL: url must be of type MFString.");if(!t)throw new Error("Browser.createVrmlFromURL: node must be of type X3DNode.");const i=t.getField(n);if(!i.isInput())throw new Error(`Browser.createVrmlFromURL: event named '${n}' must be a input field.`);if(i.getType()!==c.MFNode)throw new Error(`Browser.createVrmlFromURL: event named '${n}' must be of type MFNode.`);const s=this.currentScene,r=this.isExternal(),o=new hh(this.getWorld());this.addLoadingObject(o),o.createX3DFromURL(e,null,(e=>{this.removeLoadingObject(o),e&&(r||(s.getLive().addInterest("setLive",e),e.setExecutionContext(s),e.setLive(s.isLive())),i.setValue(e.rootNodes))}))},createX3DFromURL(e,t,n){if(3===arguments.length)return this.createVrmlFromURL(e,t,n);if(!(e instanceof Qi.MFString))throw new Error("Browser.createX3DFromURL: url must be of type MFString.");return new Promise(((t,n)=>{const i=this.currentScene,s=this.isExternal(),r=new hh(this.getWorld());this.addLoadingObject(r),r.createX3DFromURL(e,null,(e=>{this.removeLoadingObject(r),e?(s||(i.getLive().addInterest("setLive",e),e.setExecutionContext(i),e.setLive(i.isLive())),t(e)):n(new Error("Couldn't load X3D file."))}))}))},loadURL(e,t=new Qi.MFString){return new Promise(((n,i)=>{if(!(e instanceof Qi.MFString))throw new Error("Browser.loadURL: url must be of type MFString.");if(!(t instanceof Qi.MFString))throw new Error("Browser.loadURL: parameter must be of type MFString.");const s=new hh(this.getWorld());s.createX3DFromURL(e,t,(e=>{this[rI]!==s?i(new Error("Loading of X3D file aborted.")):(this.getBrowserOption("SplashScreen")||this.getCanvas().show(),e?(this.addLoadingObject(this),this.replaceWorld(e).then(n).catch(i),this.removeLoadingObject(this),this.removeLoadingObject(s)):(this.callBrowserCallbacks(c.CONNECTION_ERROR),this.callBrowserEventHandler("error"),setTimeout((()=>{this.getSplashScreen().find(".x_ite-private-spinner-text").text(iT("Failed loading world."))})),i(new Error("Couldn't load X3D file."))))}),(e=>{s.ready=!0,this.changeViewpoint(e),this.removeLoadingObject(s),n()}),((e,t)=>{s.ready=!0,t?window.open(e,t):location=e,this.removeLoadingObject(s),n()})),s.ready||(this[rI]?.abort(),this.setBrowserLoading(!0),this.addLoadingObject(this[rI]=s))}))},addBrowserListener(e,t){},removeBrowserListener(e){},addBrowserCallback(e,t){this[oI].set(e,t)},removeBrowserCallback(e){this[oI].delete(e)},getBrowserCallbacks(){return this[oI]},callBrowserCallbacks:function(){const e=[];return function(t){if(this[oI].size)for(const n of b.values(e,this[oI]))n(t)}}(),importDocument(e){const t=this.currentScene,n=this.createScene();this.isExternal()||(t.getLive().addInterest("setLive",n),n.setExecutionContext(t),n.setLive(t.isLive()));const i=new Qr(n);return i.setInput(e),new Promise(i.parseIntoScene.bind(i))},importJS(e){const t=this.currentScene,n=this.createScene();this.isExternal()||(t.getLive().addInterest("setLive",n),n.setExecutionContext(t),n.setLive(t.isLive()));const i=new no(n);return i.setInput(e),new Promise(i.parseIntoScene.bind(i))},getBrowserProperty(e){return this.getBrowserProperties().getField(e).getValue()},setBrowserOption(e,t){this.getBrowserOptions().getField(e).setValue(t)},getBrowserOption(e){return this.getBrowserOptions().getField(e).getValue()},getRenderingProperty(e){return this.getRenderingProperties().getField(e).getValue()},viewAll(e){(e=zl(c.X3DLayerNode,e)??this.getActiveLayer())&&e.viewAll(1,this.getBrowserOption("StraightenHorizon"))},firstViewpoint(e){const t=(e=zl(c.X3DLayerNode,e)??this.getActiveLayer()).getUserViewpoints();t.length&&this.bindViewpoint(e,t[0])},previousViewpoint(e){if(!(e=zl(c.X3DLayerNode,e)??this.getActiveLayer()))return;const t=e.getUserViewpoints();if(0!==t.length){for(var n=0,i=t.length;n<i&&!t[n]._isBound.getValue();++n);n<t.length?0===n?this.bindViewpoint(e,t.at(-1)):this.bindViewpoint(e,t[n-1]):this.bindViewpoint(e,t.at(-1))}},nextViewpoint(e){if(!(e=zl(c.X3DLayerNode,e)??this.getActiveLayer()))return;const t=e.getUserViewpoints();if(0!==t.length){for(var n=0,i=t.length;n<i&&!t[n]._isBound.getValue();++n);n<t.length?n===t.length-1?this.bindViewpoint(e,t[0]):this.bindViewpoint(e,t[n+1]):this.bindViewpoint(e,t[0])}},lastViewpoint(e){if(!(e=zl(c.X3DLayerNode,e)??this.getActiveLayer()))return;const t=e.getUserViewpoints();t.length&&this.bindViewpoint(e,t.at(-1))},changeViewpoint(e,t){if(1===arguments.length&&(t=String(e),e=this.getActiveLayer()),e=zl(c.X3DLayerNode,e)??this.getActiveLayer())for(const n of e.getViewpoints().get())if(n.getName()===t){this.bindViewpoint(e,n);break}},bindViewpoint(e,t){if(e=zl(c.X3DLayerNode,e),t=zl(c.X3DViewpointNode,t),!e)throw new Error("Browser.bindViewpoint: layerNode must be of type X3DLayerNode.");if(!t)throw new Error("Browser.bindViewpoint: viewpointNode must be of type X3DViewpointNode.");t.setVRMLTransition(!0),t._set_bind=!0},addRoute(e,t,n,i){this.currentScene.addRoute(e,t,n,i)},deleteRoute(e,t,n,i){try{const s=this.currentScene.getRoute(e,t,n,i);s&&this.currentScene.deleteRoute(s)}catch(e){console.error(e)}},beginUpdate(){this.setLive(!0),this.getExecutionContext().setLive(!0),this.advanceTime(),this.addBrowserEvent()},endUpdate(){this.setLive(!1),this.getExecutionContext().setLive(!1)},print(...e){const t=e.join("");console.log(t);for(const e of this[aI])e.append(document.createTextNode(t))},println(...e){const t=e.join("");console.log(t);for(const e of this[aI])e.append(document.createTextNode(`${t}\n`))},toVRMLStream(e){this.currentScene.toVRMLStream(e)},toXMLStream(e){this.currentScene.toXMLStream(e)},toJSONStream(e){this.currentScene.toJSONStream(e)}});for(const e of Reflect.ownKeys(uI.prototype))Object.defineProperty(uI.prototype,e,{enumerable:!1});Object.defineProperties(uI.prototype,{name:{get:uI.prototype.getName,enumerable:!0},version:{value:ws,enumerable:!0},currentFrameRate:{get:uI.prototype.getCurrentFrameRate,enumerable:!0},currentSpeed:{get:uI.prototype.getCurrentSpeed,enumerable:!0},description:{get:uI.prototype.getDescription,set:uI.prototype.setDescription,enumerable:!0},baseURL:{get:uI.prototype.getBaseURL,set:uI.prototype.setBaseURL,enumerable:!0},currentScene:{get(){return this.getScriptStack().at(-1).getExecutionContext()},enumerable:!0},supportedProfiles:{value:tI,enumerable:!0},supportedComponents:{value:ZF,enumerable:!0},concreteNodes:{value:Hv,enumerable:!0},abstractNodes:{value:ar,enumerable:!0}}),Object.defineProperties(uI,{typeName:{value:"X3DBrowser",enumerable:!0}}),c.addNode(uI);const hI=uI;n.set("x_ite/Browser/X3DBrowser",hI);const cI=hI;function dI(e){let t=0,n=0;return function(){const i=e.call(this);return i>n?(t=0,n=i,i):n=i+ ++t/1e3}}for(const e of[performance,Date])Object.defineProperty(e,"now",{value:dI(e.now),configurable:!0,writable:!0});const pI=void 0;n.set("standard/Time/MicroTime",pI);var gI=i(666),fI=i(76);Object.assign(gI,{decodeText:e=>"string"==typeof e?e:(new TextDecoder).decode(e),ungzip(e){try{return fI.ungzip(e,{to:"raw"}).buffer}catch(t){return e}},toLowerCaseFirst:e=>e[0].toLowerCase()+e.slice(1),try(e){try{return e()}catch{}},enum:(e,t,n)=>e.hasOwnProperty(t)?e[t]:n}),Object.assign(gI.fn,{isInViewport(){const e=gI(this),t=gI(window),n=e.offset().top,i=n+e.outerHeight(),s=t.scrollTop(),r=s+t.height();return i>s&&n<r}});const mI=gI;n.set("lib/jquery",mI);const _I=i(132);n.set("lib/libtess",_I);var xI=i(666);const yI=xI.Deferred(),wI=xI.Deferred();let bI=!1;function SI(e,t){return new Promise(((n,i)=>{"function"==typeof e&&yI.done(e),"function"==typeof t&&wI.done(t),yI.done(n),wI.done(i),bI||(bI=!0,xI((function(){try{zF.elements(xI("X3DCanvas"),cI),[...xI("x3d-canvas")].every((e=>e.browser))?yI.resolve():wI.resolve(new Error("Couldn't create browser."))}catch(e){zF.error(xI("X3DCanvas"),e),wI.resolve(e)}})))}))}Object.assign(SI,{require(e){if(!n.has(e))throw new Error(`Unknown module '${e}'.`);return n.get(e)},noConflict:function(){const e=window.hasOwnProperty("X3D"),t=window.X3D;return function(){return window.X3D===SI&&(e?window.X3D=t:delete window.X3D),SI}}(),getBrowser:e=>xI(e||"x3d-canvas, X3DCanvas").prop("browser"),createBrowser(e,t){const n=document.createElement("x3d-canvas");return arguments.length&&n.browser.loadURL(e,t),n}}),Object.assign(SI,{X3DConstants:c,X3DBrowser:cI,X3DExecutionContext:jh,X3DScene:pO,ComponentInfo:VT,ComponentInfoArray:UT,ProfileInfo:qF,ProfileInfoArray:$F,ConcreteNodesArray:zv,AbstractNodesArray:rr,UnitInfo:kT,UnitInfoArray:HT,NamedNodesArray:hr,ImportedNodesArray:wr,X3DImportedNode:_r,ExportedNodesArray:QT,X3DExportedNode:KT,ExternProtoDeclarationArray:xh,ProtoDeclarationArray:bh,X3DExternProtoDeclaration:fh,X3DProtoDeclaration:Cr,X3DProtoDeclarationNode:vr,RouteArray:Ph,X3DRoute:Fh,X3DBaseNode:xs,X3DFieldDefinition:H,FieldDefinitionArray:te,X3DField:fe,X3DArrayField:ei,SFColor:Qi.SFColor,SFColorRGBA:Qi.SFColorRGBA,SFImage:Qi.SFImage,SFMatrix3d:Qi.SFMatrix3d,SFMatrix3f:Qi.SFMatrix3f,SFMatrix4d:Qi.SFMatrix4d,SFMatrix4f:Qi.SFMatrix4f,SFNode:Qi.SFNode,SFRotation:Qi.SFRotation,SFVec2d:Qi.SFVec2d,SFVec2f:Qi.SFVec2f,SFVec3d:Qi.SFVec3d,SFVec3f:Qi.SFVec3f,SFVec4d:Qi.SFVec4d,SFVec4f:Qi.SFVec4f,VrmlMatrix:Qi.VrmlMatrix,MFBool:Qi.MFBool,MFColor:Qi.MFColor,MFColorRGBA:Qi.MFColorRGBA,MFDouble:Qi.MFDouble,MFFloat:Qi.MFFloat,MFImage:Qi.MFImage,MFInt32:Qi.MFInt32,MFMatrix3d:Qi.MFMatrix3d,MFMatrix3f:Qi.MFMatrix3f,MFMatrix4d:Qi.MFMatrix4d,MFMatrix4f:Qi.MFMatrix4f,MFNode:Qi.MFNode,MFRotation:Qi.MFRotation,MFString:Qi.MFString,MFTime:Qi.MFTime,MFVec2d:Qi.MFVec2d,MFVec2f:Qi.MFVec2f,MFVec3d:Qi.MFVec3d,MFVec3f:Qi.MFVec3f,MFVec4d:Qi.MFVec4d,MFVec4f:Qi.MFVec4f});const vI=SI;n.set("x_ite/X3D",vI);const TI=vI;var OI=i(666);class EI extends HTMLElement{constructor(){try{super(),new cI(this)}catch(e){console.error(e),OI(this.shadowRoot).append(OI("<slot></slot>")).children(".x_ite-private-browser").remove()}}connectedCallback(){this.browser?.connectedCallback()}static get observedAttributes(){return["antialiased","baseURL","baseurl","cache","contentScale","contentscale","contextMenu","contextmenu","debug","multisampling","notifications","oninitialized","onshutdown","splashScreen","splashscreen","src","timings","update","url"]}attributeChangedCallback(e,t,n){this.browser?.attributeChangedCallback(e,t,n)}captureStream(...e){return this.browser?.getCanvas()[0].captureStream(...e)}toBlob(...e){return this.browser?.getCanvas()[0].toBlob(...e)}toDataURL(...e){return this.browser?.getCanvas()[0].toDataURL(...e)}}document.createElement("X3DCanvas");const CI=EI;n.set("x_ite/X3DCanvasElement",CI);const NI=CI;!function(){function e(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}const t=Reflect.getPrototypeOf(Int8Array);for(const n of[Array,String,t])void 0===n.prototype.at&&Object.defineProperty(n.prototype,"at",{value:e,writable:!0,enumerable:!1,configurable:!0})}();const FI=void 0;n.set("shim",FI);window[Symbol.for("X_ITE.X3D-8.7.8")]=TI,customElements.define("x3d-canvas",NI),TI();const II=TI;n.set("x_ite",II);const MI=II})(),s=s.default})()));
>>>>>>> development
